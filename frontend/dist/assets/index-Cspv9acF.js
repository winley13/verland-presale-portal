const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ccip-DhugKRZf.js","assets/localBatchGatewayRequest-CwJV1K3B.js","assets/ui-vendor-v3QJ5Cvk.js","assets/utils-vendor-COyYjcU6.js","assets/router-vendor-CCFckGes.js","assets/query-vendor-zvy22aj4.js","assets/index-CK3LYl2A.js","assets/parseSignature-B6rZ1goB.js","assets/hashTypedData-B6EFZcO0.js","assets/features-CUu0URF-.js","assets/embedded-wallet-DuJbZl46.js","assets/email-Q324fM_V.js","assets/index-HcZVVnwx.js","assets/socials-B00vKuvs.js","assets/swaps-BldsiCTg.js","assets/SwapController-CGPByv7w.js","assets/index-BK48LVL1.js","assets/send-I1Ezn5Ih.js","assets/index-KoTuQ2iS.js","assets/receive-BL-C18pE.js","assets/onramp-CpihnIxQ.js","assets/pay-with-exchange-CXnV7RkL.js","assets/transactions-BY6jWmOK.js","assets/index-1Sc4efZJ.js","assets/index-KBfzVV5i.js","assets/data-capture-BOzcniwQ.js","assets/w3m-modal-CNrQ2CsD.js","assets/PhArrowCircleDown-B305t-Sh.js","assets/property-C9JG5tag.js","assets/PhArrowClockwise-CJPxQhr_.js","assets/PhArrowDown-C4hT9BVu.js","assets/PhArrowLeft-Way4Cu-r.js","assets/PhArrowRight-Cp5ZME0F.js","assets/PhArrowSquareOut-NnrK69c5.js","assets/PhArrowsDownUp-BjBI4ckC.js","assets/PhArrowsLeftRight-CuLpbKRk.js","assets/PhArrowUp-Dph6j8rm.js","assets/PhArrowUpRight-BpJjRRRh.js","assets/PhArrowsClockwise-CFUT8X7R.js","assets/PhBank-Dchr4XQJ.js","assets/PhBrowser-dUu2TrC1.js","assets/PhCaretDown-78IuKU3V.js","assets/PhCaretLeft-_aiyH7n1.js","assets/PhCaretRight-8zJQEuDX.js","assets/PhCaretUp-CiCxKWwN.js","assets/PhCheck-CcADx8br.js","assets/PhCircleHalf-BYzSzd2h.js","assets/PhClock-UItiXeJq.js","assets/PhCompass-CUy3uA7t.js","assets/PhCopy-C-PDgSlZ.js","assets/PhCreditCard-CWRaUT6F.js","assets/PhCurrencyDollar-Cqla3AXT.js","assets/PhDesktop-BBIPrYLl.js","assets/PhDeviceMobile-BdsPaATg.js","assets/PhDotsThree-BMXCQl-0.js","assets/PhVault-l2PHF38a.js","assets/PhEnvelope-yUsis6yU.js","assets/PhFunnelSimple-Ba7BbWTp.js","assets/PhGlobe-DgLxBk5U.js","assets/PhIdentificationCard-Czjmq9Z3.js","assets/PhImage-BAJ_erz6.js","assets/PhInfo-Cr4DhVUE.js","assets/PhLightbulb-BX_7duTr.js","assets/PhMagnifyingGlass-Mygfryvz.js","assets/PhPaperPlaneRight-BeuCA660.js","assets/PhPlus-BMjcHjsT.js","assets/PhPower-CGffGmdb.js","assets/PhPuzzlePiece-wm_GpVSi.js","assets/PhQrCode-DRwRzXCH.js","assets/PhQuestion-M09j2U0T.js","assets/PhQuestionMark-BP9EMB6h.js","assets/PhSealCheck-BfG80yKn.js","assets/PhSignOut-C5YOWlPT.js","assets/PhSpinner-BXooDYzU.js","assets/PhTrash-Biq6rmmL.js","assets/PhUser-CAgZSpGe.js","assets/PhWallet-w25D16It.js","assets/PhWarning-DPEydIPw.js","assets/PhWarningCircle-BqjT745H.js","assets/PhX-s-SmVExa.js","assets/index-BAfHE5_y.js"])))=>i.map(i=>d[i]);
import{b as Nne,r as qt,d as On,e as Mne,j as ot,C as PV,P as Lne,c as Tc,a as Zm,g as Bne,S as Fne,f as RV}from"./ui-vendor-v3QJ5Cvk.js";import{t as $ne,c as zne,a as OV,S as Une,b as jne,W as Vne,M as Wne,d as Hne,X as sF,C as Gne,e as qne,Z as oF,f as Zne}from"./utils-vendor-COyYjcU6.js";import{L as ym,B as Kne,R as Yne,a as F4}from"./router-vendor-CCFckGes.js";import{Q as Xne,a as Jne}from"./query-vendor-zvy22aj4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();const X1={routeTree:[{path:"/",hasElement:!0,elementName:"LandingPage",isWildcard:!1,isIndex:!1},{path:"/map",hasElement:!0,elementName:"MapPage",isWildcard:!1,isIndex:!1},{path:"/*",hasElement:!0,elementName:"NotFound",isWildcard:!0,isIndex:!1}],routes:[{path:"/",elementName:"LandingPage"},{path:"/map",elementName:"MapPage"},{path:"/*",elementName:"NotFound"}],pageCount:0,total:3,generatedAt:"2026-02-23T12:40:18.029Z"};X1.routeTree;X1.routes;X1.pageCount;X1.total;function aF(){if(console.log("[routes-scanner] notifyParentWindow",X1),typeof window<"u"&&window.parent&&window.parent!==window)try{window.parent.postMessage({type:"routes-manifest",targetName:window.name,data:X1},"*")}catch(t){console.warn("[routes-scanner] Failed to notify parent window:",t)}}typeof window<"u"&&(document.readyState==="complete"?aF():window.addEventListener("load",aF));var kV,cF=Nne;kV=cF.createRoot,cF.hydrateRoot;var lF=["light","dark"],Qne="(prefers-color-scheme: dark)",eie=qt.createContext(void 0),tie={setTheme:t=>{},themes:[]},nie=()=>{var t;return(t=qt.useContext(eie))!=null?t:tie};qt.memo(({forcedTheme:t,storageKey:e,attribute:n,enableSystem:i,enableColorScheme:o,defaultTheme:l,value:h,attrs:s,nonce:w})=>{let x=l==="system",A=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(z=>`'${z}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,P=o?lF.includes(l)&&l?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${l}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",D=(z,U=!1,G=!0)=>{let ne=h?h[z]:z,oe=U?z+"|| ''":`'${ne}'`,Q="";return o&&G&&!U&&lF.includes(z)&&(Q+=`d.style.colorScheme = '${z}';`),n==="class"?U||ne?Q+=`c.add(${oe})`:Q+="null":ne&&(Q+=`d[s](n,${oe})`),Q},M=t?`!function(){${A}${D(t)}}()`:i?`!function(){try{${A}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${x})){var t='${Qne}',m=window.matchMedia(t);if(m.media!==t||m.matches){${D("dark")}}else{${D("light")}}}else if(e){${h?`var x=${JSON.stringify(h)};`:""}${D(h?"x[e]":"e",!0)}}${x?"":"else{"+D(l,!1,!1)+"}"}${P}}catch(e){}}()`:`!function(){try{${A}var e=localStorage.getItem('${e}');if(e){${h?`var x=${JSON.stringify(h)};`:""}${D(h?"x[e]":"e",!0)}}else{${D(l,!1,!1)};}${P}}catch(t){}}();`;return qt.createElement("script",{nonce:w,dangerouslySetInnerHTML:{__html:M}})});var iie=t=>{switch(t){case"success":return oie;case"info":return cie;case"warning":return aie;case"error":return lie;default:return null}},rie=Array(12).fill(0),sie=({visible:t,className:e})=>On.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},On.createElement("div",{className:"sonner-spinner"},rie.map((n,i)=>On.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${i}`})))),oie=On.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},On.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),aie=On.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},On.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),cie=On.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},On.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),lie=On.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},On.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),uie=On.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},On.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),On.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),die=()=>{let[t,e]=On.useState(document.hidden);return On.useEffect(()=>{let n=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t},zR=1,hie=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let n=this.subscribers.indexOf(e);this.subscribers.splice(n,1)}),this.publish=e=>{this.subscribers.forEach(n=>n(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var n;let{message:i,...o}=e,l=typeof(e==null?void 0:e.id)=="number"||((n=e.id)==null?void 0:n.length)>0?e.id:zR++,h=this.toasts.find(w=>w.id===l),s=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),h?this.toasts=this.toasts.map(w=>w.id===l?(this.publish({...w,...e,id:l,title:i}),{...w,...e,id:l,dismissible:s,title:i}):w):this.addToast({title:i,...o,dismissible:s,id:l}),l},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(n=>{this.subscribers.forEach(i=>i({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:e,dismiss:!0})),e),this.message=(e,n)=>this.create({...n,message:e}),this.error=(e,n)=>this.create({...n,message:e,type:"error"}),this.success=(e,n)=>this.create({...n,type:"success",message:e}),this.info=(e,n)=>this.create({...n,type:"info",message:e}),this.warning=(e,n)=>this.create({...n,type:"warning",message:e}),this.loading=(e,n)=>this.create({...n,type:"loading",message:e}),this.promise=(e,n)=>{if(!n)return;let i;n.loading!==void 0&&(i=this.create({...n,promise:e,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let o=e instanceof Promise?e:e(),l=i!==void 0,h,s=o.then(async x=>{if(h=["resolve",x],On.isValidElement(x))l=!1,this.create({id:i,type:"default",message:x});else if(pie(x)&&!x.ok){l=!1;let A=typeof n.error=="function"?await n.error(`HTTP error! status: ${x.status}`):n.error,P=typeof n.description=="function"?await n.description(`HTTP error! status: ${x.status}`):n.description;this.create({id:i,type:"error",message:A,description:P})}else if(n.success!==void 0){l=!1;let A=typeof n.success=="function"?await n.success(x):n.success,P=typeof n.description=="function"?await n.description(x):n.description;this.create({id:i,type:"success",message:A,description:P})}}).catch(async x=>{if(h=["reject",x],n.error!==void 0){l=!1;let A=typeof n.error=="function"?await n.error(x):n.error,P=typeof n.description=="function"?await n.description(x):n.description;this.create({id:i,type:"error",message:A,description:P})}}).finally(()=>{var x;l&&(this.dismiss(i),i=void 0),(x=n.finally)==null||x.call(n)}),w=()=>new Promise((x,A)=>s.then(()=>h[0]==="reject"?A(h[1]):x(h[1])).catch(A));return typeof i!="string"&&typeof i!="number"?{unwrap:w}:Object.assign(i,{unwrap:w})},this.custom=(e,n)=>{let i=(n==null?void 0:n.id)||zR++;return this.create({jsx:e(i),id:i,...n}),i},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Jc=new hie,fie=(t,e)=>{let n=(e==null?void 0:e.id)||zR++;return Jc.addToast({title:t,...e,id:n}),n},pie=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",mie=fie,gie=()=>Jc.toasts,yie=()=>Jc.getActiveToasts();Object.assign(mie,{success:Jc.success,info:Jc.info,warning:Jc.warning,error:Jc.error,custom:Jc.custom,message:Jc.message,promise:Jc.promise,dismiss:Jc.dismiss,loading:Jc.loading},{getHistory:gie,getToasts:yie});function _ie(t,{insertAt:e}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",e==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}_ie(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function M5(t){return t.label!==void 0}var wie=3,bie="32px",vie="16px",uF=4e3,xie=356,Eie=14,Cie=20,Tie=200;function Qu(...t){return t.filter(Boolean).join(" ")}function Aie(t){let[e,n]=t.split("-"),i=[];return e&&i.push(e),n&&i.push(n),i}var Sie=t=>{var e,n,i,o,l,h,s,w,x,A,P;let{invert:D,toast:M,unstyled:z,interacting:U,setHeights:G,visibleToasts:ne,heights:oe,index:Q,toasts:de,expanded:he,removeToast:Ie,defaultRichColors:ke,closeButton:Ue,style:ze,cancelButtonStyle:ht,actionButtonStyle:ft,className:ct="",descriptionClassName:je="",duration:Ye,position:re,gap:le,loadingIcon:Ae,expandByDefault:Le,classNames:De,icons:He,closeButtonAriaLabel:Et="Close toast",pauseWhenPageIsHidden:Ct}=t,[Dt,Bt]=On.useState(null),[Yt,yn]=On.useState(null),[mn,oi]=On.useState(!1),[sn,_n]=On.useState(!1),[ai,er]=On.useState(!1),[ui,Yr]=On.useState(!1),[$s,Xs]=On.useState(!1),[la,xr]=On.useState(0),[_l,Ra]=On.useState(0),Lo=On.useRef(M.duration||Ye||uF),oc=On.useRef(null),Bo=On.useRef(null),Js=Q===0,zs=Q+1<=ne,ts=M.type,co=M.dismissible!==!1,Fc=M.className||"",wl=M.descriptionClassName||"",hs=On.useMemo(()=>oe.findIndex(Si=>Si.toastId===M.id)||0,[oe,M.id]),Id=On.useMemo(()=>{var Si;return(Si=M.closeButton)!=null?Si:Ue},[M.closeButton,Ue]),Fo=On.useMemo(()=>M.duration||Ye||uF,[M.duration,Ye]),Lu=On.useRef(0),$o=On.useRef(0),Is=On.useRef(0),zo=On.useRef(null),[bl,Zl]=re.split("-"),$c=On.useMemo(()=>oe.reduce((Si,cr,Zi)=>Zi>=hs?Si:Si+cr.height,0),[oe,hs]),vl=die(),Kl=M.invert||D,Yl=ts==="loading";$o.current=On.useMemo(()=>hs*le+$c,[hs,$c]),On.useEffect(()=>{Lo.current=Fo},[Fo]),On.useEffect(()=>{oi(!0)},[]),On.useEffect(()=>{let Si=Bo.current;if(Si){let cr=Si.getBoundingClientRect().height;return Ra(cr),G(Zi=>[{toastId:M.id,height:cr,position:M.position},...Zi]),()=>G(Zi=>Zi.filter(ua=>ua.toastId!==M.id))}},[G,M.id]),On.useLayoutEffect(()=>{if(!mn)return;let Si=Bo.current,cr=Si.style.height;Si.style.height="auto";let Zi=Si.getBoundingClientRect().height;Si.style.height=cr,Ra(Zi),G(ua=>ua.find(lo=>lo.toastId===M.id)?ua.map(lo=>lo.toastId===M.id?{...lo,height:Zi}:lo):[{toastId:M.id,height:Zi,position:M.position},...ua])},[mn,M.title,M.description,G,M.id]);let zi=On.useCallback(()=>{_n(!0),xr($o.current),G(Si=>Si.filter(cr=>cr.toastId!==M.id)),setTimeout(()=>{Ie(M)},Tie)},[M,Ie,G,$o]);On.useEffect(()=>{if(M.promise&&ts==="loading"||M.duration===1/0||M.type==="loading")return;let Si;return he||U||Ct&&vl?(()=>{if(Is.current<Lu.current){let cr=new Date().getTime()-Lu.current;Lo.current=Lo.current-cr}Is.current=new Date().getTime()})():Lo.current!==1/0&&(Lu.current=new Date().getTime(),Si=setTimeout(()=>{var cr;(cr=M.onAutoClose)==null||cr.call(M,M),zi()},Lo.current)),()=>clearTimeout(Si)},[he,U,M,ts,Ct,vl,zi]),On.useEffect(()=>{M.delete&&zi()},[zi,M.delete]);function Ps(){var Si,cr,Zi;return He!=null&&He.loading?On.createElement("div",{className:Qu(De==null?void 0:De.loader,(Si=M==null?void 0:M.classNames)==null?void 0:Si.loader,"sonner-loader"),"data-visible":ts==="loading"},He.loading):Ae?On.createElement("div",{className:Qu(De==null?void 0:De.loader,(cr=M==null?void 0:M.classNames)==null?void 0:cr.loader,"sonner-loader"),"data-visible":ts==="loading"},Ae):On.createElement(sie,{className:Qu(De==null?void 0:De.loader,(Zi=M==null?void 0:M.classNames)==null?void 0:Zi.loader),visible:ts==="loading"})}return On.createElement("li",{tabIndex:0,ref:Bo,className:Qu(ct,Fc,De==null?void 0:De.toast,(e=M==null?void 0:M.classNames)==null?void 0:e.toast,De==null?void 0:De.default,De==null?void 0:De[ts],(n=M==null?void 0:M.classNames)==null?void 0:n[ts]),"data-sonner-toast":"","data-rich-colors":(i=M.richColors)!=null?i:ke,"data-styled":!(M.jsx||M.unstyled||z),"data-mounted":mn,"data-promise":!!M.promise,"data-swiped":$s,"data-removed":sn,"data-visible":zs,"data-y-position":bl,"data-x-position":Zl,"data-index":Q,"data-front":Js,"data-swiping":ai,"data-dismissible":co,"data-type":ts,"data-invert":Kl,"data-swipe-out":ui,"data-swipe-direction":Yt,"data-expanded":!!(he||Le&&mn),style:{"--index":Q,"--toasts-before":Q,"--z-index":de.length-Q,"--offset":`${sn?la:$o.current}px`,"--initial-height":Le?"auto":`${_l}px`,...ze,...M.style},onDragEnd:()=>{er(!1),Bt(null),zo.current=null},onPointerDown:Si=>{Yl||!co||(oc.current=new Date,xr($o.current),Si.target.setPointerCapture(Si.pointerId),Si.target.tagName!=="BUTTON"&&(er(!0),zo.current={x:Si.clientX,y:Si.clientY}))},onPointerUp:()=>{var Si,cr,Zi,ua;if(ui||!co)return;zo.current=null;let lo=Number(((Si=Bo.current)==null?void 0:Si.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Tt=Number(((cr=Bo.current)==null?void 0:cr.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),bo=new Date().getTime()-((Zi=oc.current)==null?void 0:Zi.getTime()),da=Dt==="x"?lo:Tt,Oa=Math.abs(da)/bo;if(Math.abs(da)>=Cie||Oa>.11){xr($o.current),(ua=M.onDismiss)==null||ua.call(M,M),yn(Dt==="x"?lo>0?"right":"left":Tt>0?"down":"up"),zi(),Yr(!0),Xs(!1);return}er(!1),Bt(null)},onPointerMove:Si=>{var cr,Zi,ua,lo;if(!zo.current||!co||((cr=window.getSelection())==null?void 0:cr.toString().length)>0)return;let Tt=Si.clientY-zo.current.y,bo=Si.clientX-zo.current.x,da=(Zi=t.swipeDirections)!=null?Zi:Aie(re);!Dt&&(Math.abs(bo)>1||Math.abs(Tt)>1)&&Bt(Math.abs(bo)>Math.abs(Tt)?"x":"y");let Oa={x:0,y:0};Dt==="y"?(da.includes("top")||da.includes("bottom"))&&(da.includes("top")&&Tt<0||da.includes("bottom")&&Tt>0)&&(Oa.y=Tt):Dt==="x"&&(da.includes("left")||da.includes("right"))&&(da.includes("left")&&bo<0||da.includes("right")&&bo>0)&&(Oa.x=bo),(Math.abs(Oa.x)>0||Math.abs(Oa.y)>0)&&Xs(!0),(ua=Bo.current)==null||ua.style.setProperty("--swipe-amount-x",`${Oa.x}px`),(lo=Bo.current)==null||lo.style.setProperty("--swipe-amount-y",`${Oa.y}px`)}},Id&&!M.jsx?On.createElement("button",{"aria-label":Et,"data-disabled":Yl,"data-close-button":!0,onClick:Yl||!co?()=>{}:()=>{var Si;zi(),(Si=M.onDismiss)==null||Si.call(M,M)},className:Qu(De==null?void 0:De.closeButton,(o=M==null?void 0:M.classNames)==null?void 0:o.closeButton)},(l=He==null?void 0:He.close)!=null?l:uie):null,M.jsx||qt.isValidElement(M.title)?M.jsx?M.jsx:typeof M.title=="function"?M.title():M.title:On.createElement(On.Fragment,null,ts||M.icon||M.promise?On.createElement("div",{"data-icon":"",className:Qu(De==null?void 0:De.icon,(h=M==null?void 0:M.classNames)==null?void 0:h.icon)},M.promise||M.type==="loading"&&!M.icon?M.icon||Ps():null,M.type!=="loading"?M.icon||(He==null?void 0:He[ts])||iie(ts):null):null,On.createElement("div",{"data-content":"",className:Qu(De==null?void 0:De.content,(s=M==null?void 0:M.classNames)==null?void 0:s.content)},On.createElement("div",{"data-title":"",className:Qu(De==null?void 0:De.title,(w=M==null?void 0:M.classNames)==null?void 0:w.title)},typeof M.title=="function"?M.title():M.title),M.description?On.createElement("div",{"data-description":"",className:Qu(je,wl,De==null?void 0:De.description,(x=M==null?void 0:M.classNames)==null?void 0:x.description)},typeof M.description=="function"?M.description():M.description):null),qt.isValidElement(M.cancel)?M.cancel:M.cancel&&M5(M.cancel)?On.createElement("button",{"data-button":!0,"data-cancel":!0,style:M.cancelButtonStyle||ht,onClick:Si=>{var cr,Zi;M5(M.cancel)&&co&&((Zi=(cr=M.cancel).onClick)==null||Zi.call(cr,Si),zi())},className:Qu(De==null?void 0:De.cancelButton,(A=M==null?void 0:M.classNames)==null?void 0:A.cancelButton)},M.cancel.label):null,qt.isValidElement(M.action)?M.action:M.action&&M5(M.action)?On.createElement("button",{"data-button":!0,"data-action":!0,style:M.actionButtonStyle||ft,onClick:Si=>{var cr,Zi;M5(M.action)&&((Zi=(cr=M.action).onClick)==null||Zi.call(cr,Si),!Si.defaultPrevented&&zi())},className:Qu(De==null?void 0:De.actionButton,(P=M==null?void 0:M.classNames)==null?void 0:P.actionButton)},M.action.label):null))};function dF(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function Iie(t,e){let n={};return[t,e].forEach((i,o)=>{let l=o===1,h=l?"--mobile-offset":"--offset",s=l?vie:bie;function w(x){["top","right","bottom","left"].forEach(A=>{n[`${h}-${A}`]=typeof x=="number"?`${x}px`:x})}typeof i=="number"||typeof i=="string"?w(i):typeof i=="object"?["top","right","bottom","left"].forEach(x=>{i[x]===void 0?n[`${h}-${x}`]=s:n[`${h}-${x}`]=typeof i[x]=="number"?`${i[x]}px`:i[x]}):w(s)}),n}var Pie=qt.forwardRef(function(t,e){let{invert:n,position:i="bottom-right",hotkey:o=["altKey","KeyT"],expand:l,closeButton:h,className:s,offset:w,mobileOffset:x,theme:A="light",richColors:P,duration:D,style:M,visibleToasts:z=wie,toastOptions:U,dir:G=dF(),gap:ne=Eie,loadingIcon:oe,icons:Q,containerAriaLabel:de="Notifications",pauseWhenPageIsHidden:he}=t,[Ie,ke]=On.useState([]),Ue=On.useMemo(()=>Array.from(new Set([i].concat(Ie.filter(Ct=>Ct.position).map(Ct=>Ct.position)))),[Ie,i]),[ze,ht]=On.useState([]),[ft,ct]=On.useState(!1),[je,Ye]=On.useState(!1),[re,le]=On.useState(A!=="system"?A:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ae=On.useRef(null),Le=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),De=On.useRef(null),He=On.useRef(!1),Et=On.useCallback(Ct=>{ke(Dt=>{var Bt;return(Bt=Dt.find(Yt=>Yt.id===Ct.id))!=null&&Bt.delete||Jc.dismiss(Ct.id),Dt.filter(({id:Yt})=>Yt!==Ct.id)})},[]);return On.useEffect(()=>Jc.subscribe(Ct=>{if(Ct.dismiss){ke(Dt=>Dt.map(Bt=>Bt.id===Ct.id?{...Bt,delete:!0}:Bt));return}setTimeout(()=>{Mne.flushSync(()=>{ke(Dt=>{let Bt=Dt.findIndex(Yt=>Yt.id===Ct.id);return Bt!==-1?[...Dt.slice(0,Bt),{...Dt[Bt],...Ct},...Dt.slice(Bt+1)]:[Ct,...Dt]})})})}),[]),On.useEffect(()=>{if(A!=="system"){le(A);return}if(A==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?le("dark"):le("light")),typeof window>"u")return;let Ct=window.matchMedia("(prefers-color-scheme: dark)");try{Ct.addEventListener("change",({matches:Dt})=>{le(Dt?"dark":"light")})}catch{Ct.addListener(({matches:Bt})=>{try{le(Bt?"dark":"light")}catch(Yt){console.error(Yt)}})}},[A]),On.useEffect(()=>{Ie.length<=1&&ct(!1)},[Ie]),On.useEffect(()=>{let Ct=Dt=>{var Bt,Yt;o.every(yn=>Dt[yn]||Dt.code===yn)&&(ct(!0),(Bt=Ae.current)==null||Bt.focus()),Dt.code==="Escape"&&(document.activeElement===Ae.current||(Yt=Ae.current)!=null&&Yt.contains(document.activeElement))&&ct(!1)};return document.addEventListener("keydown",Ct),()=>document.removeEventListener("keydown",Ct)},[o]),On.useEffect(()=>{if(Ae.current)return()=>{De.current&&(De.current.focus({preventScroll:!0}),De.current=null,He.current=!1)}},[Ae.current]),On.createElement("section",{ref:e,"aria-label":`${de} ${Le}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Ue.map((Ct,Dt)=>{var Bt;let[Yt,yn]=Ct.split("-");return Ie.length?On.createElement("ol",{key:Ct,dir:G==="auto"?dF():G,tabIndex:-1,ref:Ae,className:s,"data-sonner-toaster":!0,"data-theme":re,"data-y-position":Yt,"data-lifted":ft&&Ie.length>1&&!l,"data-x-position":yn,style:{"--front-toast-height":`${((Bt=ze[0])==null?void 0:Bt.height)||0}px`,"--width":`${xie}px`,"--gap":`${ne}px`,...M,...Iie(w,x)},onBlur:mn=>{He.current&&!mn.currentTarget.contains(mn.relatedTarget)&&(He.current=!1,De.current&&(De.current.focus({preventScroll:!0}),De.current=null))},onFocus:mn=>{mn.target instanceof HTMLElement&&mn.target.dataset.dismissible==="false"||He.current||(He.current=!0,De.current=mn.relatedTarget)},onMouseEnter:()=>ct(!0),onMouseMove:()=>ct(!0),onMouseLeave:()=>{je||ct(!1)},onDragEnd:()=>ct(!1),onPointerDown:mn=>{mn.target instanceof HTMLElement&&mn.target.dataset.dismissible==="false"||Ye(!0)},onPointerUp:()=>Ye(!1)},Ie.filter(mn=>!mn.position&&Dt===0||mn.position===Ct).map((mn,oi)=>{var sn,_n;return On.createElement(Sie,{key:mn.id,icons:Q,index:oi,toast:mn,defaultRichColors:P,duration:(sn=U==null?void 0:U.duration)!=null?sn:D,className:U==null?void 0:U.className,descriptionClassName:U==null?void 0:U.descriptionClassName,invert:n,visibleToasts:z,closeButton:(_n=U==null?void 0:U.closeButton)!=null?_n:h,interacting:je,position:Ct,style:U==null?void 0:U.style,unstyled:U==null?void 0:U.unstyled,classNames:U==null?void 0:U.classNames,cancelButtonStyle:U==null?void 0:U.cancelButtonStyle,actionButtonStyle:U==null?void 0:U.actionButtonStyle,removeToast:Et,toasts:Ie.filter(ai=>ai.position==mn.position),heights:ze.filter(ai=>ai.position==mn.position),setHeights:ht,expandByDefault:l,gap:ne,loadingIcon:oe,expanded:ft,pauseWhenPageIsHidden:he,swipeDirections:t.swipeDirections})})):null}))});const Rie=({...t})=>{const{theme:e="system"}=nie();return ot.jsx(Pie,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};function ES(...t){return $ne(zne(t))}const Oie=Lne,kie=qt.forwardRef(({className:t,sideOffset:e=4,...n},i)=>ot.jsx(PV,{ref:i,sideOffset:e,className:ES("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));kie.displayName=PV.displayName;let Die={data:""},Nie=t=>{if(typeof window=="object"){let e=(t?t.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(t||document.head).appendChild(e),e.firstChild}return t||Die},Mie=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Lie=/\/\*[^]*?\*\/|  +/g,hF=/\n+/g,dm=(t,e)=>{let n="",i="",o="";for(let l in t){let h=t[l];l[0]=="@"?l[1]=="i"?n=l+" "+h+";":i+=l[1]=="f"?dm(h,l):l+"{"+dm(h,l[1]=="k"?"":e)+"}":typeof h=="object"?i+=dm(h,e?e.replace(/([^,])+/g,s=>l.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,w=>/&/.test(w)?w.replace(/&/g,s):s?s+" "+w:w)):l):h!=null&&(l=/^--/.test(l)?l:l.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=dm.p?dm.p(l,h):l+":"+h+";")}return n+(e&&o?e+"{"+o+"}":o)+i},lf={},DV=t=>{if(typeof t=="object"){let e="";for(let n in t)e+=n+DV(t[n]);return e}return t},Bie=(t,e,n,i,o)=>{let l=DV(t),h=lf[l]||(lf[l]=(w=>{let x=0,A=11;for(;x<w.length;)A=101*A+w.charCodeAt(x++)>>>0;return"go"+A})(l));if(!lf[h]){let w=l!==t?t:(x=>{let A,P,D=[{}];for(;A=Mie.exec(x.replace(Lie,""));)A[4]?D.shift():A[3]?(P=A[3].replace(hF," ").trim(),D.unshift(D[0][P]=D[0][P]||{})):D[0][A[1]]=A[2].replace(hF," ").trim();return D[0]})(t);lf[h]=dm(o?{["@keyframes "+h]:w}:w,n?"":"."+h)}let s=n&&lf.g?lf.g:null;return n&&(lf.g=lf[h]),((w,x,A,P)=>{P?x.data=x.data.replace(P,w):x.data.indexOf(w)===-1&&(x.data=A?w+x.data:x.data+w)})(lf[h],e,i,s),h},Fie=(t,e,n)=>t.reduce((i,o,l)=>{let h=e[l];if(h&&h.call){let s=h(n),w=s&&s.props&&s.props.className||/^go/.test(s)&&s;h=w?"."+w:s&&typeof s=="object"?s.props?"":dm(s,""):s===!1?"":s}return i+o+(h??"")},"");function CS(t){let e=this||{},n=t.call?t(e.p):t;return Bie(n.unshift?n.raw?Fie(n,[].slice.call(arguments,1),e.p):n.reduce((i,o)=>Object.assign(i,o&&o.call?o(e.p):o),{}):n,Nie(e.target),e.g,e.o,e.k)}let NV,UR,jR;CS.bind({g:1});let jf=CS.bind({k:1});function $ie(t,e,n,i){dm.p=e,NV=t,UR=n,jR=i}function Km(t,e){let n=this||{};return function(){let i=arguments;function o(l,h){let s=Object.assign({},l),w=s.className||o.className;n.p=Object.assign({theme:UR&&UR()},s),n.o=/ *go\d+/.test(w),s.className=CS.apply(n,i)+(w?" "+w:"");let x=t;return t[0]&&(x=s.as||t,delete s.as),jR&&x[0]&&jR(s),NV(x,s)}return o}}var zie=t=>typeof t=="function",nA=(t,e)=>zie(t)?t(e):t,Uie=(()=>{let t=0;return()=>(++t).toString()})(),MV=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),jie=20,yk="default",LV=(t,e)=>{let{toastLimit:n}=t.settings;switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,n)};case 1:return{...t,toasts:t.toasts.map(h=>h.id===e.toast.id?{...h,...e.toast}:h)};case 2:let{toast:i}=e;return LV(t,{type:t.toasts.find(h=>h.id===i.id)?1:0,toast:i});case 3:let{toastId:o}=e;return{...t,toasts:t.toasts.map(h=>h.id===o||o===void 0?{...h,dismissed:!0,visible:!1}:h)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(h=>h.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let l=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(h=>({...h,pauseDuration:h.pauseDuration+l}))}}},NT=[],BV={toasts:[],pausedAt:void 0,settings:{toastLimit:jie}},ph={},FV=(t,e=yk)=>{ph[e]=LV(ph[e]||BV,t),NT.forEach(([n,i])=>{n===e&&i(ph[e])})},$V=t=>Object.keys(ph).forEach(e=>FV(t,e)),Vie=t=>Object.keys(ph).find(e=>ph[e].toasts.some(n=>n.id===t)),TS=(t=yk)=>e=>{FV(e,t)},Wie={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Hie=(t={},e=yk)=>{let[n,i]=qt.useState(ph[e]||BV),o=qt.useRef(ph[e]);qt.useEffect(()=>(o.current!==ph[e]&&i(ph[e]),NT.push([e,i]),()=>{let h=NT.findIndex(([s])=>s===e);h>-1&&NT.splice(h,1)}),[e]);let l=n.toasts.map(h=>{var s,w,x;return{...t,...t[h.type],...h,removeDelay:h.removeDelay||((s=t[h.type])==null?void 0:s.removeDelay)||(t==null?void 0:t.removeDelay),duration:h.duration||((w=t[h.type])==null?void 0:w.duration)||(t==null?void 0:t.duration)||Wie[h.type],style:{...t.style,...(x=t[h.type])==null?void 0:x.style,...h.style}}});return{...n,toasts:l}},Gie=(t,e="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:(n==null?void 0:n.id)||Uie()}),pE=t=>(e,n)=>{let i=Gie(e,t,n);return TS(i.toasterId||Vie(i.id))({type:2,toast:i}),i.id},Ls=(t,e)=>pE("blank")(t,e);Ls.error=pE("error");Ls.success=pE("success");Ls.loading=pE("loading");Ls.custom=pE("custom");Ls.dismiss=(t,e)=>{let n={type:3,toastId:t};e?TS(e)(n):$V(n)};Ls.dismissAll=t=>Ls.dismiss(void 0,t);Ls.remove=(t,e)=>{let n={type:4,toastId:t};e?TS(e)(n):$V(n)};Ls.removeAll=t=>Ls.remove(void 0,t);Ls.promise=(t,e,n)=>{let i=Ls.loading(e.loading,{...n,...n==null?void 0:n.loading});return typeof t=="function"&&(t=t()),t.then(o=>{let l=e.success?nA(e.success,o):void 0;return l?Ls.success(l,{id:i,...n,...n==null?void 0:n.success}):Ls.dismiss(i),o}).catch(o=>{let l=e.error?nA(e.error,o):void 0;l?Ls.error(l,{id:i,...n,...n==null?void 0:n.error}):Ls.dismiss(i)}),t};var qie=1e3,Zie=(t,e="default")=>{let{toasts:n,pausedAt:i}=Hie(t,e),o=qt.useRef(new Map).current,l=qt.useCallback((P,D=qie)=>{if(o.has(P))return;let M=setTimeout(()=>{o.delete(P),h({type:4,toastId:P})},D);o.set(P,M)},[]);qt.useEffect(()=>{if(i)return;let P=Date.now(),D=n.map(M=>{if(M.duration===1/0)return;let z=(M.duration||0)+M.pauseDuration-(P-M.createdAt);if(z<0){M.visible&&Ls.dismiss(M.id);return}return setTimeout(()=>Ls.dismiss(M.id,e),z)});return()=>{D.forEach(M=>M&&clearTimeout(M))}},[n,i,e]);let h=qt.useCallback(TS(e),[e]),s=qt.useCallback(()=>{h({type:5,time:Date.now()})},[h]),w=qt.useCallback((P,D)=>{h({type:1,toast:{id:P,height:D}})},[h]),x=qt.useCallback(()=>{i&&h({type:6,time:Date.now()})},[i,h]),A=qt.useCallback((P,D)=>{let{reverseOrder:M=!1,gutter:z=8,defaultPosition:U}=D||{},G=n.filter(Q=>(Q.position||U)===(P.position||U)&&Q.height),ne=G.findIndex(Q=>Q.id===P.id),oe=G.filter((Q,de)=>de<ne&&Q.visible).length;return G.filter(Q=>Q.visible).slice(...M?[oe+1]:[0,oe]).reduce((Q,de)=>Q+(de.height||0)+z,0)},[n]);return qt.useEffect(()=>{n.forEach(P=>{if(P.dismissed)l(P.id,P.removeDelay);else{let D=o.get(P.id);D&&(clearTimeout(D),o.delete(P.id))}})},[n,l]),{toasts:n,handlers:{updateHeight:w,startPause:s,endPause:x,calculateOffset:A}}},Kie=jf`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Yie=jf`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Xie=jf`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Jie=Km("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Kie} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Yie} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Xie} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Qie=jf`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ere=Km("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${Qie} 1s linear infinite;
`,tre=jf`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,nre=jf`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,ire=Km("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${tre} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${nre} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,rre=Km("div")`
  position: absolute;
`,sre=Km("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,ore=jf`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,are=Km("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${ore} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,cre=({toast:t})=>{let{icon:e,type:n,iconTheme:i}=t;return e!==void 0?typeof e=="string"?qt.createElement(are,null,e):e:n==="blank"?null:qt.createElement(sre,null,qt.createElement(ere,{...i}),n!=="loading"&&qt.createElement(rre,null,n==="error"?qt.createElement(Jie,{...i}):qt.createElement(ire,{...i})))},lre=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,ure=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,dre="0%{opacity:0;} 100%{opacity:1;}",hre="0%{opacity:1;} 100%{opacity:0;}",fre=Km("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,pre=Km("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,mre=(t,e)=>{let n=t.includes("top")?1:-1,[i,o]=MV()?[dre,hre]:[lre(n),ure(n)];return{animation:e?`${jf(i)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${jf(o)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},gre=qt.memo(({toast:t,position:e,style:n,children:i})=>{let o=t.height?mre(t.position||e||"top-center",t.visible):{opacity:0},l=qt.createElement(cre,{toast:t}),h=qt.createElement(pre,{...t.ariaProps},nA(t.message,t));return qt.createElement(fre,{className:t.className,style:{...o,...n,...t.style}},typeof i=="function"?i({icon:l,message:h}):qt.createElement(qt.Fragment,null,l,h))});$ie(qt.createElement);var yre=({id:t,className:e,style:n,onHeightUpdate:i,children:o})=>{let l=qt.useCallback(h=>{if(h){let s=()=>{let w=h.getBoundingClientRect().height;i(t,w)};s(),new MutationObserver(s).observe(h,{subtree:!0,childList:!0,characterData:!0})}},[t,i]);return qt.createElement("div",{ref:l,className:e,style:n},o)},_re=(t,e)=>{let n=t.includes("top"),i=n?{top:0}:{bottom:0},o=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:MV()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(n?1:-1)}px)`,...i,...o}},wre=CS`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,L5=16,bre=({reverseOrder:t,position:e="top-center",toastOptions:n,gutter:i,children:o,toasterId:l,containerStyle:h,containerClassName:s})=>{let{toasts:w,handlers:x}=Zie(n,l);return qt.createElement("div",{"data-rht-toaster":l||"",style:{position:"fixed",zIndex:9999,top:L5,left:L5,right:L5,bottom:L5,pointerEvents:"none",...h},className:s,onMouseEnter:x.startPause,onMouseLeave:x.endPause},w.map(A=>{let P=A.position||e,D=x.calculateOffset(A,{reverseOrder:t,gutter:i,defaultPosition:e}),M=_re(P,D);return qt.createElement(yre,{id:A.id,key:A.id,onHeightUpdate:x.updateHeight,className:A.visible?wre:"",style:M},A.type==="custom"?nA(A.message,A):o?o(A):qt.createElement(gre,{toast:A,position:P}))}))};function vre(){const[t,e]=qt.useState(1),[n,i]=qt.useState({days:0,hours:0,minutes:0,seconds:0});qt.useEffect(()=>{const l=new Date;l.setDate(l.getDate()+15);const h=setInterval(()=>{const s=new Date().getTime(),w=l.getTime()-s;if(w<0){clearInterval(h);return}i({days:Math.floor(w/(1e3*60*60*24)),hours:Math.floor(w%(1e3*60*60*24)/(1e3*60*60)),minutes:Math.floor(w%(1e3*60*60)/(1e3*60)),seconds:Math.floor(w%(1e3*60)/1e3)})},1e3);return()=>clearInterval(h)},[]);const o=l=>{const h=Math.max(1,t+l);e(h)};return ot.jsxs("div",{className:"landing-body",children:[ot.jsxs("div",{className:"landing-bg-wrapper",children:[ot.jsx("nav",{className:"landing-navbar",children:ot.jsxs("div",{className:"landing-container",children:[ot.jsxs(ym,{to:"/",className:"landing-logo",children:["NEO",ot.jsx("span",{children:"VERSE"})]}),ot.jsxs("ul",{className:"landing-nav-links",children:[ot.jsx("li",{children:ot.jsx("a",{href:"#about",children:"Concept"})}),ot.jsx("li",{children:ot.jsx(ym,{to:"/map",children:"World Map"})}),ot.jsx("li",{children:ot.jsx("a",{href:"#presale",children:"Presale"})})]})]})}),ot.jsx("header",{className:"landing-hero",children:ot.jsxs("div",{className:"landing-container",children:[ot.jsxs("div",{className:"landing-hero-content",children:[ot.jsx("span",{className:"landing-badge",children:"Phase 01 Live"}),ot.jsxs("h1",{children:["The Future of ",ot.jsx("br",{}),ot.jsx("span",{className:"landing-highlight",children:"Digital Ownership"})]}),ot.jsx("p",{children:"Own a piece of the next evolution. High-fidelity virtual plots with infinite utility in the Neon-Grid ecosystem."}),ot.jsxs("div",{className:"landing-hero-btns",children:[ot.jsx("a",{href:"#presale",className:"landing-btn landing-btn-primary",children:"Buy Land Now"}),ot.jsx(ym,{to:"/map",className:"landing-btn landing-btn-secondary",children:"Explore Map"})]})]}),ot.jsx("div",{className:"landing-hero-stats",children:ot.jsxs("div",{className:"landing-stat-card",children:[ot.jsxs("h3",{id:"timer",children:[String(n.days).padStart(2,"0"),":",String(n.hours).padStart(2,"0"),":",String(n.minutes).padStart(2,"0"),":",String(n.seconds).padStart(2,"0")]}),ot.jsx("p",{children:"Presale Ends In"})]})})]})}),ot.jsx("section",{id:"about",className:"landing-features",children:ot.jsxs("div",{className:"landing-container",children:[ot.jsx("h2",{className:"landing-section-title",children:"Why Neon-Grid?"}),ot.jsxs("div",{className:"landing-grid",children:[ot.jsxs("div",{className:"landing-card",children:[ot.jsx("div",{className:"landing-icon",children:""}),ot.jsx("h3",{children:"High Performance"}),ot.jsx("p",{children:"Sub-millisecond latency for seamless social and gaming experiences."})]}),ot.jsxs("div",{className:"landing-card",children:[ot.jsx("div",{className:"landing-icon",children:""}),ot.jsx("h3",{children:"Creator Tools"}),ot.jsx("p",{children:"Drag-and-drop building engine to monetize your digital space."})]}),ot.jsxs("div",{className:"landing-card",children:[ot.jsx("div",{className:"landing-icon",children:""}),ot.jsx("h3",{children:"Asset Portability"}),ot.jsx("p",{children:"Fully compatible with ERC-721 and standard metaverse protocols."})]})]})]})}),ot.jsx("section",{id:"presale",className:"landing-presale-area",children:ot.jsx("div",{className:"landing-container",children:ot.jsxs("div",{className:"landing-presale-box",children:[ot.jsxs("div",{className:"landing-presale-info",children:[ot.jsx("h2",{children:"Presale Details"}),ot.jsx("p",{children:"Early access pricing is currently active. Secure your Tier 1 plots before the public launch."}),ot.jsx("div",{className:"landing-progress-container",children:ot.jsx("div",{className:"landing-progress-bar",style:{width:"65%"}})}),ot.jsx("p",{className:"landing-progress-text",children:"65% of Total Supply Minted"})]}),ot.jsxs("div",{className:"landing-mint-ui",children:[ot.jsxs("div",{className:"landing-price-row",children:[ot.jsx("span",{children:"Price per Plot:"}),ot.jsx("span",{className:"landing-Green-text",children:"0.02 ETH"})]}),ot.jsxs("div",{className:"landing-input-group",children:[ot.jsx("button",{onClick:()=>o(-1),children:"-"}),ot.jsx("input",{type:"number",id:"mint-qty",value:t,readOnly:!0}),ot.jsx("button",{onClick:()=>o(1),children:"+"})]}),ot.jsx("button",{className:"landing-btn landing-btn-primary landing-btn-full",children:"Mint Land Parcel"})]})]})})})]}),ot.jsx("footer",{className:"landing-footer",children:ot.jsxs("div",{className:"landing-container",children:[ot.jsxs("div",{className:"landing-footer-grid",children:[ot.jsxs("div",{className:"landing-footer-brand",children:[ot.jsxs(ym,{to:"/",className:"landing-logo",children:["NEO",ot.jsx("span",{children:"VERSE"})]}),ot.jsx("p",{children:"Building the infrastructure for the decentralized web."})]}),ot.jsxs("div",{className:"landing-footer-links",children:[ot.jsx("h4",{children:"Community"}),ot.jsx("a",{href:"#",children:"Discord"}),ot.jsx("a",{href:"#",children:"Twitter"}),ot.jsx("a",{href:"#",children:"Medium"})]})]}),ot.jsx("div",{className:"landing-footer-bottom",children:ot.jsx("p",{children:" 2026 Neo-Verse Metaverse. All Rights Reserved."})})]})})]})}var zV={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Tc,function(){var n,i,o;function l(s,w){if(!n)n=w;else if(!i)i=w;else{var x="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",A={};n(A),o=w(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}l(["exports"],function(s){var w=1e-6,x=typeof Float32Array<"u"?Float32Array:Array;function A(u,r){var c=r[0],d=r[1],p=r[2],y=r[3],_=c*y-p*d;return _?(u[0]=y*(_=1/_),u[1]=-d*_,u[2]=-p*_,u[3]=c*_,u):null}function P(){var u=new x(9);return x!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function D(u,r){var c=r[0],d=r[1],p=r[2],y=r[3],_=r[4],v=r[5],T=r[6],S=r[7],O=r[8];return u[0]=_*O-v*S,u[1]=p*S-d*O,u[2]=d*v-p*_,u[3]=v*T-y*O,u[4]=c*O-p*T,u[5]=p*y-c*v,u[6]=y*S-_*T,u[7]=d*T-c*S,u[8]=c*_-d*y,u}function M(u,r,c){var d=r[0],p=r[1],y=r[2],_=r[3],v=r[4],T=r[5],S=r[6],O=r[7],k=r[8],N=c[0],F=c[1],$=c[2],H=c[3],K=c[4],q=c[5],X=c[6],te=c[7],se=c[8];return u[0]=N*d+F*_+$*S,u[1]=N*p+F*v+$*O,u[2]=N*y+F*T+$*k,u[3]=H*d+K*_+q*S,u[4]=H*p+K*v+q*O,u[5]=H*y+K*T+q*k,u[6]=X*d+te*_+se*S,u[7]=X*p+te*v+se*O,u[8]=X*y+te*T+se*k,u}function z(){var u=new x(16);return x!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function U(u){var r=new x(16);return r[0]=u[0],r[1]=u[1],r[2]=u[2],r[3]=u[3],r[4]=u[4],r[5]=u[5],r[6]=u[6],r[7]=u[7],r[8]=u[8],r[9]=u[9],r[10]=u[10],r[11]=u[11],r[12]=u[12],r[13]=u[13],r[14]=u[14],r[15]=u[15],r}function G(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ne(u,r){var c=r[0],d=r[1],p=r[2],y=r[3],_=r[4],v=r[5],T=r[6],S=r[7],O=r[8],k=r[9],N=r[10],F=r[11],$=r[12],H=r[13],K=r[14],q=r[15],X=c*v-d*_,te=c*T-p*_,se=c*S-y*_,ge=d*T-p*v,me=d*S-y*v,Ee=p*S-y*T,Te=O*H-k*$,xe=O*K-N*$,Oe=O*q-F*$,Be=k*K-N*H,lt=k*q-F*H,it=N*q-F*K,st=X*it-te*lt+se*Be+ge*Oe-me*xe+Ee*Te;return st?(u[0]=(v*it-T*lt+S*Be)*(st=1/st),u[1]=(p*lt-d*it-y*Be)*st,u[2]=(H*Ee-K*me+q*ge)*st,u[3]=(N*me-k*Ee-F*ge)*st,u[4]=(T*Oe-_*it-S*xe)*st,u[5]=(c*it-p*Oe+y*xe)*st,u[6]=(K*se-$*Ee-q*te)*st,u[7]=(O*Ee-N*se+F*te)*st,u[8]=(_*lt-v*Oe+S*Te)*st,u[9]=(d*Oe-c*lt-y*Te)*st,u[10]=($*me-H*se+q*X)*st,u[11]=(k*se-O*me-F*X)*st,u[12]=(v*xe-_*Be-T*Te)*st,u[13]=(c*Be-d*xe+p*Te)*st,u[14]=(H*te-$*ge-K*X)*st,u[15]=(O*ge-k*te+N*X)*st,u):null}function oe(u,r,c){var d=r[0],p=r[1],y=r[2],_=r[3],v=r[4],T=r[5],S=r[6],O=r[7],k=r[8],N=r[9],F=r[10],$=r[11],H=r[12],K=r[13],q=r[14],X=r[15],te=c[0],se=c[1],ge=c[2],me=c[3];return u[0]=te*d+se*v+ge*k+me*H,u[1]=te*p+se*T+ge*N+me*K,u[2]=te*y+se*S+ge*F+me*q,u[3]=te*_+se*O+ge*$+me*X,u[4]=(te=c[4])*d+(se=c[5])*v+(ge=c[6])*k+(me=c[7])*H,u[5]=te*p+se*T+ge*N+me*K,u[6]=te*y+se*S+ge*F+me*q,u[7]=te*_+se*O+ge*$+me*X,u[8]=(te=c[8])*d+(se=c[9])*v+(ge=c[10])*k+(me=c[11])*H,u[9]=te*p+se*T+ge*N+me*K,u[10]=te*y+se*S+ge*F+me*q,u[11]=te*_+se*O+ge*$+me*X,u[12]=(te=c[12])*d+(se=c[13])*v+(ge=c[14])*k+(me=c[15])*H,u[13]=te*p+se*T+ge*N+me*K,u[14]=te*y+se*S+ge*F+me*q,u[15]=te*_+se*O+ge*$+me*X,u}function Q(u,r,c){var d,p,y,_,v,T,S,O,k,N,F,$,H=c[0],K=c[1],q=c[2];return r===u?(u[12]=r[0]*H+r[4]*K+r[8]*q+r[12],u[13]=r[1]*H+r[5]*K+r[9]*q+r[13],u[14]=r[2]*H+r[6]*K+r[10]*q+r[14],u[15]=r[3]*H+r[7]*K+r[11]*q+r[15]):(p=r[1],y=r[2],_=r[3],v=r[4],T=r[5],S=r[6],O=r[7],k=r[8],N=r[9],F=r[10],$=r[11],u[0]=d=r[0],u[1]=p,u[2]=y,u[3]=_,u[4]=v,u[5]=T,u[6]=S,u[7]=O,u[8]=k,u[9]=N,u[10]=F,u[11]=$,u[12]=d*H+v*K+k*q+r[12],u[13]=p*H+T*K+N*q+r[13],u[14]=y*H+S*K+F*q+r[14],u[15]=_*H+O*K+$*q+r[15]),u}function de(u,r,c){var d=c[0],p=c[1],y=c[2];return u[0]=r[0]*d,u[1]=r[1]*d,u[2]=r[2]*d,u[3]=r[3]*d,u[4]=r[4]*p,u[5]=r[5]*p,u[6]=r[6]*p,u[7]=r[7]*p,u[8]=r[8]*y,u[9]=r[9]*y,u[10]=r[10]*y,u[11]=r[11]*y,u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15],u}function he(u,r,c){var d=Math.sin(c),p=Math.cos(c),y=r[4],_=r[5],v=r[6],T=r[7],S=r[8],O=r[9],k=r[10],N=r[11];return r!==u&&(u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[3],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[4]=y*p+S*d,u[5]=_*p+O*d,u[6]=v*p+k*d,u[7]=T*p+N*d,u[8]=S*p-y*d,u[9]=O*p-_*d,u[10]=k*p-v*d,u[11]=N*p-T*d,u}function Ie(u,r,c){var d=Math.sin(c),p=Math.cos(c),y=r[0],_=r[1],v=r[2],T=r[3],S=r[8],O=r[9],k=r[10],N=r[11];return r!==u&&(u[4]=r[4],u[5]=r[5],u[6]=r[6],u[7]=r[7],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[0]=y*p-S*d,u[1]=_*p-O*d,u[2]=v*p-k*d,u[3]=T*p-N*d,u[8]=y*d+S*p,u[9]=_*d+O*p,u[10]=v*d+k*p,u[11]=T*d+N*p,u}function ke(u,r,c){var d=Math.sin(c),p=Math.cos(c),y=r[0],_=r[1],v=r[2],T=r[3],S=r[4],O=r[5],k=r[6],N=r[7];return r!==u&&(u[8]=r[8],u[9]=r[9],u[10]=r[10],u[11]=r[11],u[12]=r[12],u[13]=r[13],u[14]=r[14],u[15]=r[15]),u[0]=y*p+S*d,u[1]=_*p+O*d,u[2]=v*p+k*d,u[3]=T*p+N*d,u[4]=S*p-y*d,u[5]=O*p-_*d,u[6]=k*p-v*d,u[7]=N*p-T*d,u}function Ue(u,r){return u[0]=r[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=r[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=r[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ze(u,r,c){var d,p,y,_=c[0],v=c[1],T=c[2],S=Math.sqrt(_*_+v*v+T*T);return S<w?null:(_*=S=1/S,v*=S,T*=S,d=Math.sin(r),p=Math.cos(r),u[0]=_*_*(y=1-p)+p,u[1]=v*_*y+T*d,u[2]=T*_*y-v*d,u[3]=0,u[4]=_*v*y-T*d,u[5]=v*v*y+p,u[6]=T*v*y+_*d,u[7]=0,u[8]=_*T*y+v*d,u[9]=v*T*y-_*d,u[10]=T*T*y+p,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function ht(u,r){var c=r[0],d=r[1],p=r[2],y=r[4],_=r[5],v=r[6],T=r[8],S=r[9],O=r[10];return u[0]=Math.sqrt(c*c+d*d+p*p),u[1]=Math.sqrt(y*y+_*_+v*v),u[2]=Math.sqrt(T*T+S*S+O*O),u}function ft(u,r){var c=r[0],d=r[1],p=r[2],y=r[3],_=c+c,v=d+d,T=p+p,S=c*_,O=d*_,k=d*v,N=p*_,F=p*v,$=p*T,H=y*_,K=y*v,q=y*T;return u[0]=1-k-$,u[1]=O+q,u[2]=N-K,u[3]=0,u[4]=O-q,u[5]=1-S-$,u[6]=F+H,u[7]=0,u[8]=N+K,u[9]=F-H,u[10]=1-S-k,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var ct=oe;function je(){var u=new x(3);return x!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function Ye(u){var r=new x(3);return r[0]=u[0],r[1]=u[1],r[2]=u[2],r}function re(u){var r=u[0],c=u[1],d=u[2];return Math.sqrt(r*r+c*c+d*d)}function le(u,r,c){var d=new x(3);return d[0]=u,d[1]=r,d[2]=c,d}function Ae(u,r,c,d){return u[0]=r,u[1]=c,u[2]=d,u}function Le(u,r,c){return u[0]=r[0]+c[0],u[1]=r[1]+c[1],u[2]=r[2]+c[2],u}function De(u,r,c){return u[0]=r[0]-c[0],u[1]=r[1]-c[1],u[2]=r[2]-c[2],u}function He(u,r,c){return u[0]=r[0]*c[0],u[1]=r[1]*c[1],u[2]=r[2]*c[2],u}function Et(u,r,c){return u[0]=Math.min(r[0],c[0]),u[1]=Math.min(r[1],c[1]),u[2]=Math.min(r[2],c[2]),u}function Ct(u,r,c){return u[0]=Math.max(r[0],c[0]),u[1]=Math.max(r[1],c[1]),u[2]=Math.max(r[2],c[2]),u}function Dt(u,r,c){return u[0]=r[0]*c,u[1]=r[1]*c,u[2]=r[2]*c,u}function Bt(u,r,c,d){return u[0]=r[0]+c[0]*d,u[1]=r[1]+c[1]*d,u[2]=r[2]+c[2]*d,u}function Yt(u,r){var c=r[0]-u[0],d=r[1]-u[1],p=r[2]-u[2];return Math.sqrt(c*c+d*d+p*p)}function yn(u,r){var c=r[0]-u[0],d=r[1]-u[1],p=r[2]-u[2];return c*c+d*d+p*p}function mn(u){var r=u[0],c=u[1],d=u[2];return r*r+c*c+d*d}function oi(u,r){return u[0]=-r[0],u[1]=-r[1],u[2]=-r[2],u}function sn(u,r){var c=r[0],d=r[1],p=r[2],y=c*c+d*d+p*p;return y>0&&(y=1/Math.sqrt(y)),u[0]=r[0]*y,u[1]=r[1]*y,u[2]=r[2]*y,u}function _n(u,r){return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]}function ai(u,r,c){var d=r[0],p=r[1],y=r[2],_=c[0],v=c[1],T=c[2];return u[0]=p*T-y*v,u[1]=y*_-d*T,u[2]=d*v-p*_,u}function er(u,r,c,d){var p=r[0],y=r[1],_=r[2];return u[0]=p+d*(c[0]-p),u[1]=y+d*(c[1]-y),u[2]=_+d*(c[2]-_),u}function ui(u,r,c){var d=r[0],p=r[1],y=r[2],_=c[3]*d+c[7]*p+c[11]*y+c[15];return u[0]=(c[0]*d+c[4]*p+c[8]*y+c[12])/(_=_||1),u[1]=(c[1]*d+c[5]*p+c[9]*y+c[13])/_,u[2]=(c[2]*d+c[6]*p+c[10]*y+c[14])/_,u}function Yr(u,r,c){var d=r[0],p=r[1],y=r[2];return u[0]=d*c[0]+p*c[3]+y*c[6],u[1]=d*c[1]+p*c[4]+y*c[7],u[2]=d*c[2]+p*c[5]+y*c[8],u}function $s(u,r,c){var d=c[0],p=c[1],y=c[2],_=c[3],v=r[0],T=r[1],S=r[2],O=p*S-y*T,k=y*v-d*S,N=d*T-p*v;return u[0]=v+_*(O+=O)+p*(N+=N)-y*(k+=k),u[1]=T+_*k+y*O-d*N,u[2]=S+_*N+d*k-p*O,u}function Xs(u){return u[0]=0,u[1]=0,u[2]=0,u}function la(u,r){return u[0]===r[0]&&u[1]===r[1]&&u[2]===r[2]}var xr=De,_l=He,Ra=re;function Lo(){var u=new x(4);return x!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function oc(u,r,c){return u[0]=r[0]*c,u[1]=r[1]*c,u[2]=r[2]*c,u[3]=r[3]*c,u}function Bo(u,r){var c=r[0],d=r[1],p=r[2],y=r[3],_=c*c+d*d+p*p+y*y;return _>0&&(_=1/Math.sqrt(_)),u[0]=c*_,u[1]=d*_,u[2]=p*_,u[3]=y*_,u}function Js(u,r){return u[0]*r[0]+u[1]*r[1]+u[2]*r[2]+u[3]*r[3]}function zs(u,r,c){var d=r[0],p=r[1],y=r[2],_=r[3];return u[0]=c[0]*d+c[4]*p+c[8]*y+c[12]*_,u[1]=c[1]*d+c[5]*p+c[9]*y+c[13]*_,u[2]=c[2]*d+c[6]*p+c[10]*y+c[14]*_,u[3]=c[3]*d+c[7]*p+c[11]*y+c[15]*_,u}function ts(){var u=new x(4);return x!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function co(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function Fc(u,r,c){c*=.5;var d=r[0],p=r[1],y=r[2],_=r[3],v=Math.sin(c),T=Math.cos(c);return u[0]=d*T+_*v,u[1]=p*T+y*v,u[2]=y*T-p*v,u[3]=_*T-d*v,u}function wl(u,r,c){c*=.5;var d=r[0],p=r[1],y=r[2],_=r[3],v=Math.sin(c),T=Math.cos(c);return u[0]=d*T-y*v,u[1]=p*T+_*v,u[2]=y*T+d*v,u[3]=_*T-p*v,u}je(),Lo();var hs,Id,Fo,Lu=Bo,$o=(hs=je(),Id=le(1,0,0),Fo=le(0,1,0),function(u,r,c){var d=_n(r,c);return d<-.999999?(ai(hs,Id,r),Ra(hs)<1e-6&&ai(hs,Fo,r),sn(hs,hs),function(p,y,_){_*=.5;var v=Math.sin(_);p[0]=v*y[0],p[1]=v*y[1],p[2]=v*y[2],p[3]=Math.cos(_)}(u,hs,Math.PI),u):d>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(ai(hs,r,c),u[0]=hs[0],u[1]=hs[1],u[2]=hs[2],u[3]=1+d,Lu(u,u))});function Is(){var u=new x(2);return x!=Float32Array&&(u[0]=0,u[1]=0),u}function zo(u,r){var c=new x(2);return c[0]=u,c[1]=r,c}function bl(u,r,c){return u[0]=r,u[1]=c,u}function Zl(u,r,c){return u[0]=r[0]+c[0],u[1]=r[1]+c[1],u}function $c(u,r,c){return u[0]=r[0]-c[0],u[1]=r[1]-c[1],u}function vl(u,r,c){return u[0]=r[0]*c,u[1]=r[1]*c,u}function Kl(u){var r=u[0],c=u[1];return Math.sqrt(r*r+c*c)}function Yl(u,r){var c=r[0],d=r[1],p=c*c+d*d;return p>0&&(p=1/Math.sqrt(p)),u[0]=r[0]*p,u[1]=r[1]*p,u}function zi(u,r){return u[0]*r[0]+u[1]*r[1]}ts(),ts(),P();var Ps,Si,cr=$c;function Zi(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}Is();var ua=function(){if(Si)return Ps;function u(r,c,d,p){this.cx=3*r,this.bx=3*(d-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(p-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=c,this.p2x=d,this.p2y=p}return Si=1,Ps=u,u.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,c){if(c===void 0&&(c=1e-6),r<0)return 0;if(r>1)return 1;for(var d=r,p=0;p<8;p++){var y=this.sampleCurveX(d)-r;if(Math.abs(y)<c)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var v=0,T=1;for(d=r,p=0;p<20&&(y=this.sampleCurveX(d),!(Math.abs(y-r)<c));p++)r>y?v=d:T=d,d=.5*(T-v)+v;return d},solve:function(r,c){return this.sampleCurveY(this.solveCurveX(r,c))}},Ps}(),lo=Zi(ua);function Tt(u,r){this.x=u,this.y=r}function bo(u,r){if(Array.isArray(u)){if(!Array.isArray(r)||u.length!==r.length)return!1;for(let c=0;c<u.length;c++)if(!bo(u[c],r[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&r!==null){if(typeof r!="object"||Object.keys(u).length!==Object.keys(r).length)return!1;for(const c in u)if(!bo(u[c],r[c]))return!1;return!0}return u===r}Tt.prototype={clone(){return new Tt(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,r){return this.clone()._rotateAround(u,r)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const r=u.x-this.x,c=u.y-this.y;return r*r+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,r){return Math.atan2(this.x*r-this.y*u,this.x*u+this.y*r)},_matMult(u){const r=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=r,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const r=Math.cos(u),c=Math.sin(u),d=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=d,this},_rotateAround(u,r){const c=Math.cos(u),d=Math.sin(u),p=r.y+d*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-d*(this.y-r.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Tt},Tt.convert=function(u){if(u instanceof Tt)return u;if(Array.isArray(u))return new Tt(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new Tt(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const da=Math.PI/180,Oa=180/Math.PI;function _i(u){return u*da}function qe(u){return u*Oa}const ee=[[0,0],[1,0],[1,1],[0,1]];function ae(u){if(u<=0)return 0;if(u>=1)return 1;const r=u*u,c=r*u;return 4*(u<.5?c:3*(u-r)+c-.75)}function _e(u,r,c,d){const p=new lo(u,r,c,d);return function(y){return p.solve(y)}}const $e=_e(.25,.1,.25,1);function ve(u,r,c){return Math.min(c,Math.max(r,u))}function Ve(u,r,c){return(c=ve((c-u)/(r-u),0,1))*c*(3-2*c)}function et(u,r,c){const d=c-r,p=((u-r)%d+d)%d+r;return p===r?c:p}function Ge(u,r,c){if(!u.length)return c(null,[]);let d=u.length;const p=new Array(u.length);let y=null;u.forEach((_,v)=>{r(_,(T,S)=>{T&&(y=T),p[v]=S,--d===0&&c(y,p)})})}let rt=1;function It(){return rt++}function At(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function Xt(u,r){u.forEach(c=>{r[c]&&(r[c]=r[c].bind(r))})}function pn(u,r,c){const d={};for(const p in u)d[p]=r.call(this,u[p],p,u);return d}function bn(u,r,c){const d={};for(const p in u)r.call(this,u[p],p,u)&&(d[p]=u[p]);return d}function $n(u){return Array.isArray(u)?u.map($n):typeof u=="object"&&u?pn(u,$n):u}function Yn(u,r){for(let c=0;c<u.length;c++)if(r.indexOf(u[c])>=0)return!0;return!1}const kn={};function In(u){kn[u]||(typeof console<"u"&&console.warn(u),kn[u]=!0)}function tr(u,r,c){return(c.y-u.y)*(r.x-u.x)>(r.y-u.y)*(c.x-u.x)}function ss(u){let r=0;for(let c,d,p=0,y=u.length,_=y-1;p<y;_=p++)c=u[p],d=u[_],r+=(d.x-c.x)*(c.y+d.y);return r}function Nr([u,r,c]){const d=_i(r+90),p=_i(c);return{x:u*Math.cos(d)*Math.sin(p),y:u*Math.sin(d)*Math.sin(p),z:u*Math.cos(p),azimuthal:r,polar:c}}function Mr(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function dr(u){const r={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,p,y)=>{const _=p||y;return r[d]=!_||_.toLowerCase(),""}),r["max-age"]){const c=parseInt(r["max-age"],10);isNaN(c)?delete r["max-age"]:r["max-age"]=c}return r}let fi=null;function mr(u,r){return[u[4*r],u[4*r+1],u[4*r+2],u[4*r+3]]}function Wi(u,r,c,d){for(;r<c;){const p=r+c>>1;u[p]<d?r=p+1:c=p}return r}function Hi(u,r,c,d){for(;r<c;){const p=r+c>>1;u[p]<=d?r=p+1:c=p}return r}function Pr(u){return u>0?1/(1.001-u):1+u}function Qs(u){return u>0?1-1/(1.001-u):-u}function Us(u,r,c){return(u-r.min)*(c.max-c.min)/(r.max-r.min)+c.min}const fs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!fs.API_URL)return null;try{const u=new URL(fs.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Pd(u){return fs.API_URL_REGEX.test(u)}function vo(u){return fs.API_SPRITE_REGEX.test(u)}let ka,zc,xl,Da,Uo,Bu;function $h(){return ka==null&&(ka=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ka}const ac={now:()=>Da!==void 0?Da:performance.now(),setNow(u){Da=u},restoreNow(){Da=void 0},frame(u){const r=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(u,r=0){const{width:c,height:d}=u;Uo||(Uo=document.createElement("canvas"));const p=Uo.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(c>Uo.width||d>Uo.height)&&(Uo.width=c,Uo.height=d),p.clearRect(-r,-r,c+2*r,d+2*r),p.drawImage(u,0,0,c,d),p.getImageData(-r,-r,c+2*r,d+2*r)},resolveURL:u=>(zc||(zc=document.createElement("a")),zc.href=u,zc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(xl==null&&(xl=window.matchMedia("(prefers-reduced-motion: reduce)")),xl.matches)},hasCanvasFingerprintNoise(){if(Bu!==void 0)return Bu;if(!$h())return Bu=!1,!1;const u=new OffscreenCanvas(85,1),r=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let p=0;p<u.width;++p)r.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,r.fillRect(p,0,1,1);const d=r.getImageData(0,0,u.width,u.height);c=0;for(let p=0;p<d.data.length;++p)if(p%4!=3&&c++!==d.data[p])return Bu=!0,!0;return Bu=!1,!1}};function ag(u,r){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(r).toString()}`;const d=new URLSearchParams(u.slice(c));for(const p in r)d.set(p,r[p]);return`${u.slice(0,c)}?${d.toString()}`}function cg(u,r={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const d=new URLSearchParams,p=new URLSearchParams(u.slice(c));for(const _ of r.persistentParams){const v=p.get(_);v&&d.set(_,v)}const y=d.toString();return`${u.slice(0,c)}${y.length>0?`?${y}`:""}`}const h3="mapbox-tiles";let f3=500,Yw=50;const Xw=["language","worldview","jobid"];let js,cc;function Fu(){try{return caches}catch{}}function lc(){const u=Fu();u&&js==null&&(js=u.open(h3))}let Xl=1/0;const tp={supported:!1,testSupport:function(u){!Rd&&zh&&(Uy?m3(u):np=u)}};let np,zh,Rd=!1,Uy=!1;const p3=typeof self<"u"?self:{};function m3(u){const r=u.createTexture();u.bindTexture(u.TEXTURE_2D,r);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,zh),u.isContextLost())return;tp.supported=!0}catch{}u.deleteTexture(r),Rd=!0}p3.document&&(zh=p3.document.createElement("img"),zh.onload=function(){np&&m3(np),np=null,Uy=!0},zh.onerror=function(){Rd=!0,np=null},zh.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ha={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ha);class lg extends Error{constructor(r,c,d){c===401&&Pd(d)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=c,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ug=Mr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$u=function(u,r){if(!(/^file:/.test(c=u.url)||/^file:/.test(ug())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,p){const y=new AbortController,_=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:ug(),referrerPolicy:d.referrerPolicy,signal:y.signal});let v=!1,T=!1;const S=(O=_.url).indexOf("sku=")>0&&Pd(O);var O;d.type==="json"&&_.headers.set("Accept","application/json");const k=(F,$,H)=>{if(T)return;if(F&&F.message!=="SecurityError"&&In(F.toString()),$&&H)return N($);const K=Date.now();fetch(_).then(q=>{if(q.ok){const X=S?q.clone():null;return N(q,X,K)}return p(new lg(q.statusText,q.status,d.url))}).catch(q=>{q.name!=="AbortError"&&p(new Error(`${q.message} ${d.url}`))})},N=(F,$,H)=>{(d.type==="arrayBuffer"?F.arrayBuffer():d.type==="json"?F.json():F.text()).then(K=>{T||($&&H&&function(q,X,te){if(lc(),js==null)return;const se=dr(X.headers.get("Cache-Control")||"");if(se["no-store"])return;const ge={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((Te,xe)=>ge.headers.set(xe,Te)),se["max-age"]&&ge.headers.set("Expires",new Date(te+1e3*se["max-age"]).toUTCString());const me=ge.headers.get("Expires");if(!me||new Date(me).getTime()-te<42e4)return;let Ee=cg(q.url,{persistentParams:Xw});if(X.status===206){const Te=q.headers.get("Range");if(!Te)return;ge.status=200,Ee=ag(Ee,{range:Te})}(function(Te,xe){if(cc===void 0)try{new Response(new ReadableStream),cc=!0}catch{cc=!1}cc?xe(Te.body):Te.blob().then(xe).catch(Oe=>In(Oe.message))})(X,Te=>{const xe=new Response((Oe=X.status)!==200&&Oe!==404&&[101,103,204,205,304].includes(Oe)?null:Te,ge);var Oe;lc(),js!=null&&js.then(Be=>Be.put(Ee,xe)).catch(Be=>In(Be.message))})}(_,$,H),v=!0,p(null,K,F.headers))}).catch(K=>{T||p(new Error(K.message))})};return S?function(F,$){if(lc(),js==null)return $(null);js.then(H=>{let K=cg(F.url,{persistentParams:Xw});const q=F.headers.get("Range");q&&(K=ag(K,{range:q})),H.match(K).then(X=>{const te=function(se){if(!se)return!1;const ge=new Date(se.headers.get("Expires")||0),me=dr(se.headers.get("Cache-Control")||"");return Number(ge)>Date.now()&&!me["no-cache"]}(X);H.delete(K).catch($),te&&H.put(K,X.clone()).catch($),$(null,X,te)}).catch($)}).catch($)}(_,k):k(null,null),{cancel:()=>{T=!0,v||y.abort()}}}(u,r);if(Mr(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,r,void 0,!0)}var c;return function(d,p){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const _ in d.headers)y.setRequestHeader(_,d.headers[_]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let _=y.response;if(d.type==="json")try{_=JSON.parse(y.response)}catch(T){return p(T)}const v=new Headers;y.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(T=>{const S=T.split(": "),O=S.shift(),k=S.join(": ");v.append(O,k)}),p(null,_,v)}else p(new lg(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(u,r)},dg=function(u,r){return $u(Object.assign(u,{type:"arrayBuffer"}),r)};function RI(u){const r=document.createElement("a");return r.href=u,r.protocol===location.protocol&&r.host===location.host}const Jw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let vi,ip;vi=[],ip=0;const jy=function(u,r){if(tp.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),ip>=fs.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:u,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return vi.push(y),y}ip++;let c=!1;const d=()=>{if(!c)for(c=!0,ip--;vi.length&&ip<fs.MAX_PARALLEL_IMAGE_REQUESTS;){const y=vi.shift(),{requestParameters:_,callback:v,cancelled:T}=y;T||(y.cancel=jy(_,v).cancel)}},p=dg(u,(y,_,v)=>{d(),y?r(y):_&&(self.createImageBitmap?function(T,S){const O=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(O).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,S)=>r(T,S,v)):function(T,S){const O=new Image;O.onload=()=>{S(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=Jw})},O.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(T)],{type:"image/png"});O.src=T.byteLength?URL.createObjectURL(k):Jw}(_,(T,S)=>r(T,S,v)))});return{cancel:()=>{p.cancel(),d()}}};var g3,y3,hg,Od={exports:{}},fg={exports:{}},Vy={exports:{}},OI=function(){if(hg)return Od.exports;hg=1;var u=(g3||(g3=1,fg.exports=function(c,d){var p,y,_,v,T,S,O,k;for(y=c.length-(p=3&c.length),_=d,T=3432918353,S=461845907,k=0;k<y;)O=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24,++k,_=27492+(65535&(v=5*(65535&(_=(_^=O=(65535&(O=(O=(65535&O)*T+(((O>>>16)*T&65535)<<16)&4294967295)<<15|O>>>17))*S+(((O>>>16)*S&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+(((v>>>16)+58964&65535)<<16);switch(O=0,p){case 3:O^=(255&c.charCodeAt(k+2))<<16;case 2:O^=(255&c.charCodeAt(k+1))<<8;case 1:_^=O=(65535&(O=(O=(65535&(O^=255&c.charCodeAt(k)))*T+(((O>>>16)*T&65535)<<16)&4294967295)<<15|O>>>17))*S+(((O>>>16)*S&65535)<<16)&4294967295}return _^=c.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),fg.exports),r=(y3||(y3=1,Vy.exports=function(c,d){for(var p,y=c.length,_=d^y,v=0;y>=4;)p=1540483477*(65535&(p=255&c.charCodeAt(v)|(255&c.charCodeAt(++v))<<8|(255&c.charCodeAt(++v))<<16|(255&c.charCodeAt(++v))<<24))+((1540483477*(p>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++v;switch(y){case 3:_^=(255&c.charCodeAt(v+2))<<16;case 2:_^=(255&c.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&c.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Vy.exports);return Od.exports=u,Od.exports.murmur3=u,Od.exports.murmur2=r,Od.exports}(),rp=Zi(OI);class zu{constructor(r,...c){Object.assign(this,c[0]||{}),this.type=r}}class pg extends zu{constructor(r,c={}){super("error",Object.assign({error:r},c))}}function _3(u,r,c){c[u]&&c[u].indexOf(r)!==-1||(c[u]=c[u]||[],c[u].push(r))}function Uh(u,r,c){if(c&&c[u]){const d=c[u].indexOf(r);d!==-1&&c[u].splice(d,1)}}class Uu{on(r,c){return this._listeners=this._listeners||{},_3(r,c,this._listeners),this}off(r,c){return Uh(r,c,this._listeners),Uh(r,c,this._oneTimeListeners),this}once(r,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},_3(r,c,this._oneTimeListeners),this):new Promise(d=>{this.once(r,d)})}fire(r,c){const d=typeof r=="string"?new zu(r,c):r,p=d.type;if(this.listens(p)){d.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const T of y)T.call(this,d);const _=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const T of _)Uh(p,T,this._oneTimeListeners),T.call(this,d);const v=this._eventedParent;if(v){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(d,T),v.fire(d)}}else d instanceof pg&&console.error(d.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,c){return this._eventedParent=r,this._eventedParentData=c,this}}class fa{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new fa(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[c,d]=r.split("");return new fa({name:c,iconsetId:d})}static isEqual(r,c){return r.name===c.name&&r.iconsetId===c.iconsetId}toString(){return fa.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Uc,Wy={},w3=function(){if(Uc)return Wy;Uc=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(y){return(y=Math.round(y))<0?0:y>255?255:y}function c(y){return r(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(_=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:_>1?1:_;var _}function p(y,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?y+(_-y)*v*6:2*v<1?_:3*v<2?y+(_-y)*(2/3-v)*6:y}try{Wy.parseCSSColor=function(y){var _,v=y.replace(/ /g,"").toLowerCase();if(v in u)return u[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var T=v.indexOf("("),S=v.indexOf(")");if(T!==-1&&S+1===v.length){var O=v.substr(0,T),k=v.substr(T+1,S-(T+1)).split(","),N=1;switch(O){case"rgba":if(k.length!==4)return null;N=d(k.pop());case"rgb":return k.length!==3?null:[c(k[0]),c(k[1]),c(k[2]),N];case"hsla":if(k.length!==4)return null;N=d(k.pop());case"hsl":if(k.length!==3)return null;var F=(parseFloat(k[0])%360+360)%360/360,$=d(k[1]),H=d(k[2]),K=H<=.5?H*($+1):H+$-H*$,q=2*H-K;return[r(255*p(q,K,F+1/3)),r(255*p(q,K,F)),r(255*p(q,K,F-1/3)),N];default:return null}}return null}}catch{}return Wy}();class Di{constructor(r,c,d,p=1){this.r=r,this.g=c,this.b=d,this.a=p}static parse(r){if(!r)return;if(r instanceof Di)return r;if(typeof r!="string")return;const c=w3.parseCSSColor(r);return c?new Di(c[0]/255,c[1]/255,c[2]/255,c[3]):void 0}toString(){const[r,c,d,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*c)},${Math.round(255*d)},${p})`}toNonPremultipliedRenderColor(r){const{r:c,g:d,b:p,a:y}=this;return new b3(r,c,d,p,y)}toPremultipliedRenderColor(r){const{r:c,g:d,b:p,a:y}=this;return new v3(r,c*y,d*y,p*y,y)}clone(){return new Di(this.r,this.g,this.b,this.a)}}class Qw{constructor(r,c,d,p,y,_=!1){if(this.premultiplied=!1,this.premultiplied=_,r){const v=r.image.height,T=v*v;this.premultiplied?(c=y===0?0:c/y*(v-1),d=y===0?0:d/y*(v-1),p=y===0?0:p/y*(v-1)):(c*=v-1,d*=v-1,p*=v-1),c=Math.max(0,Math.min(v-1,c)),d=Math.max(0,Math.min(v-1,d)),p=Math.max(0,Math.min(v-1,p));const S=Math.floor(c),O=Math.floor(d),k=Math.floor(p),N=Math.ceil(c),F=Math.ceil(d),$=Math.ceil(p),H=c-S,K=d-O,q=p-k,X=r.image.data,te=4*(S+O*T+k*v),se=4*(S+O*T+$*v),ge=4*(S+F*T+k*v),me=4*(S+F*T+$*v),Ee=4*(N+O*T+k*v),Te=4*(N+O*T+$*v),xe=4*(N+F*T+k*v),Oe=4*(N+F*T+$*v);this.r=xn(xn(xn(X[te],X[se],q),xn(X[ge],X[me],q),K),xn(xn(X[Ee],X[Te],q),xn(X[xe],X[Oe],q),K),H)/255*(this.premultiplied?y:1),this.g=xn(xn(xn(X[te+1],X[se+1],q),xn(X[ge+1],X[me+1],q),K),xn(xn(X[Ee+1],X[Te+1],q),xn(X[xe+1],X[Oe+1],q),K),H)/255*(this.premultiplied?y:1),this.b=xn(xn(xn(X[te+2],X[se+2],q),xn(X[ge+2],X[me+2],q),K),xn(xn(X[Ee+2],X[Te+2],q),xn(X[xe+2],X[Oe+2],q),K),H)/255*(this.premultiplied?y:1),this.a=y}else this.r=c,this.g=d,this.b=p,this.a=y}toArray(){const{r,g:c,b:d,a:p}=this;return[255*r,255*c,255*d,p]}toHslaArray(){let{r,g:c,b:d,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const $=1/p;r*=$,c*=$,d*=$}const y=Math.min(Math.max(r,0),1),_=Math.min(Math.max(c,0),1),v=Math.min(Math.max(d,0),1),T=Math.min(y,_,v),S=Math.max(y,_,v),O=S-T,k=.5*(T+S);if(O===0)return[0,0,100*k,p];const N=k>.5?O/(2-S-T):O/(S+T);let F;switch(S){case y:F=60*((_-v)/O+(_<v?6:0));break;case _:F=60*((v-y)/O+2);break;default:F=60*((y-_)/O+4)}return[F,100*N,100*k,p]}toArray01(){const{r,g:c,b:d,a:p}=this;return[r,c,d,p]}toArray01Scaled(r){const{r:c,g:d,b:p}=this;return[c*r,d*r,p*r]}toArray01Linear(){const{r,g:c,b:d,a:p}=this;return[Math.pow(r,2.2),Math.pow(c,2.2),Math.pow(d,2.2),p]}}class b3 extends Qw{constructor(r,c,d,p,y){super(r,c,d,p,y,!1)}}class v3 extends Qw{constructor(r,c,d,p,y){super(r,c,d,p,y,!0)}}function xn(u,r,c){return u*(1-c)+r*c}function eb(u,r,c){return u.map((d,p)=>xn(d,r[p],c))}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1),Di.blue=new Di(0,0,1,1);var jh=Object.freeze({__proto__:null,array:eb,color:function(u,r,c){return new Di(xn(u.r,r.r,c),xn(u.g,r.g,c),xn(u.b,r.b,c),xn(u.a,r.a,c))},number:xn});class jo extends Error{constructor(r,c){super(c),this.message=c,this.key=r}}class Hy{constructor(r,c=[]){this.parent=r,this.bindings={};for(const[d,p]of c)this.bindings[d]=p}concat(r){return new Hy(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const pa={kind:"null"},un={kind:"number"},Oi={kind:"string"},Ti={kind:"boolean"},Vo={kind:"color"},sp={kind:"object"},Mi={kind:"value"},Gy={kind:"collator"},op={kind:"formatted"},Vh={kind:"resolvedImage"};function xo(u,r){return{kind:"array",itemType:u,N:r}}function Wr(u){if(u.kind==="array"){const r=Wr(u.itemType);return typeof u.N=="number"?`array<${r}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${r}>`}return u.kind}const kI=[pa,un,Oi,Ti,Vo,op,sp,xo(Mi),Vh];function mg(u,r){if(r.kind==="error")return null;if(u.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!mg(u.itemType,r.itemType))&&(typeof u.N!="number"||u.N===r.N))return null}else{if(u.kind===r.kind)return null;if(u.kind==="value"){for(const c of kI)if(!mg(c,r))return null}}return`Expected ${Wr(u)} but found ${Wr(r)} instead.`}function tb(u,r){return r.some(c=>c.kind===u.kind)}function gg(u,r){return r.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function qy(u,r){return u.kind==="array"&&r.kind==="array"?u.N===r.N&&qy(u.itemType,r.itemType):u.kind===r.kind}class nb{constructor(r,c,d){this.sensitivity=r?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,c){return this.collator.compare(r,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zy{constructor(r,c,d,p,y){this.text=r.normalize?r.normalize():r,this.image=c,this.scale=d,this.fontStack=p,this.textColor=y}}class Eo{constructor(r){this.sections=r}static fromString(r){return new Eo([new Zy(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof Eo?r:Eo.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const c of this.sections){if(c.image){const p=c.image.getPrimary().id.toString();r.push(["image",p]);continue}r.push(c.text);const d={};c.fontStack&&(d["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(d["font-scale"]=c.scale),c.textColor&&(d["text-color"]=["rgba"].concat(c.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(d)}return r}}class ma{constructor(r,c={}){this.id=fa.from(r),this.params=c.params,this.sx=c.sx||1,this.sy=c.sy||1}toString(){return JSON.stringify(this)}static parse(r){let c,d,p,y;try{({id:c,params:d,sx:p,sy:y}=JSON.parse(r)||{})}catch{return null}return c?new ma(c,{params:d,sx:p,sy:y}):null}scaleSelf(r,c=r){return this.sx*=r,this.sy*=c,this}}class ga{constructor(r,c,d,p,y=!1){this.primaryId=fa.from(r),this.primaryOptions=c,d&&(this.secondaryId=fa.from(d)),this.secondaryOptions=p,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ma(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ma(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?ga.build({name:r}):r}static build(r,c,d,p){return!r||typeof r=="object"&&!("name"in r)?null:new ga(r,d,c,p)}}function ib(u,r,c,d){return typeof u=="number"&&u>=0&&u<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[u,r,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[u,r,c,d]:[u,r,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kd(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Di||u instanceof nb||u instanceof Eo||u instanceof ga)return!0;if(Array.isArray(u)){for(const r of u)if(!kd(r))return!1;return!0}if(typeof u=="object"){for(const r in u)if(!kd(u[r]))return!1;return!0}return!1}function xs(u){if(u===null)return pa;if(typeof u=="string")return Oi;if(typeof u=="boolean")return Ti;if(typeof u=="number")return un;if(u instanceof Di)return Vo;if(u instanceof nb)return Gy;if(u instanceof Eo)return op;if(u instanceof ga)return Vh;if(Array.isArray(u)){const r=u.length;let c;for(const d of u){const p=xs(d);if(c){if(c===p)continue;c=Mi;break}c=p}return xo(c||Mi,r)}return sp}function Jl(u){const r=typeof u;return u===null?"":r==="string"||r==="number"||r==="boolean"?String(u):u instanceof Eo||u instanceof ga||u instanceof Di?u.toString():JSON.stringify(u)}class ju{constructor(r,c){this.type=r,this.value=c}static parse(r,c){if(r.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!kd(r[1]))return c.error("invalid value");const d=r[1];let p=xs(d);const y=c.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new ju(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Di?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Eo?this.value.serialize():this.value}}class ps{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Dd={string:Oi,number:un,boolean:Ti,object:sp};class Nn{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");let d,p=1;const y=r[0];if(y==="array"){let v,T;if(r.length>2){const S=r[1];if(typeof S!="string"||!(S in Dd)||S==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);v=Dd[S],p++}else v=Mi;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return c.error('The length argument to "array" must be a positive integer literal',2);T=r[2],p++}d=xo(v,T)}else d=Dd[y];const _=[];for(;p<r.length;p++){const v=c.parse(r[p],p,Mi);if(!v)return null;_.push(v)}return new Nn(d,_)}evaluate(r){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(r);if(!mg(this.type,xs(d)))return d;if(c===this.args.length-1)throw new ps(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${Wr(xs(d))} but was expected to be of type ${Wr(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,c=[r.kind];if(r.kind==="array"){const d=r.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){c.push(d.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&c.push(p)}}return c.concat(this.args.map(d=>d.serialize()))}}class cn{constructor(r){this.type=op,this.sections=r}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const p=[];let y=!1;for(let _=1;_<=r.length-1;++_){const v=r[_];if(y&&typeof v=="object"&&!Array.isArray(v)){y=!1;let T=null;if(v["font-scale"]&&(T=c.parseObjectValue(v["font-scale"],_,"font-scale",un),!T))return null;let S=null;if(v["text-font"]&&(S=c.parseObjectValue(v["text-font"],_,"text-font",xo(Oi)),!S))return null;let O=null;if(v["text-color"]&&(O=c.parseObjectValue(v["text-color"],_,"text-color",Vo),!O))return null;const k=p[p.length-1];k.scale=T,k.font=S,k.textColor=O}else{const T=c.parse(r[_],_,Mi);if(!T)return null;const S=T.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new cn(p)}evaluate(r){return new Eo(this.sections.map(c=>{const d=c.content.evaluate(r);return qy(xs(d),Vh)?new Zy("",d,null,null,null):new Zy(Jl(d),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)}))}eachChild(r){for(const c of this.sections)r(c.content),c.scale&&r(c.scale),c.font&&r(c.font),c.textColor&&r(c.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const c of this.sections){r.push(c.content.serialize());const d={};c.scale&&(d["font-scale"]=c.scale.serialize()),c.font&&(d["text-font"]=c.font.serialize()),c.textColor&&(d["text-color"]=c.textColor.serialize()),r.push(d)}return r}}class ap{constructor(r,c,d,p){this._imageWarnHistory={},this.type=Vh,this.namePrimary=r,this.nameSecondary=c,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(r,c){if(r.length<2)return c.error("Expected two or more arguments.");let d=1;const p=[];function y(){if(d<r.length){const v=c.parse(r[d],d++,Oi);return v?(p.push({image:v,options:{}}),!0):(c.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(d<r.length){const T=r[d];if((v=T)===null||typeof v!="object"||Array.isArray(v))return!0;const S=T.params,O=T.iconset,k=c.concat(d);if(!S&&!O)return d++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return k.error('Image options "params" should be an object'),!1;const N={},F=k.concat(void 0,"params");for(const $ in S){if(!$)return F.error("Image parameter name should be non-empty"),!1;const H=F.concat(void 0,$).parse(S[$],void 0,Vo,void 0,{typeAnnotation:"coerce"});if(!H)return!1;N[$]=H}p[p.length-1].options.params=N}if(O){if(typeof O!="object"||O.constructor!==Object)return k.error('Image options "iconset" should be an object'),!1;if(!O.id)return k.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=O}return d++,!0}var v;return!0}for(let v=0;v<2;v++)if(!y()||!_())return;return new ap(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(r,c){const d={};if(c){for(const p in c)if(c[p])try{d[p]=c[p].evaluate(r)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(r){const c={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,p=ga.build(c,d,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(p&&r.availableImages){const y=p.getPrimary().id;if(p.available=r.availableImages.some(_=>fa.isEqual(_,y)),p.available){const _=p.getSecondary()?p.getSecondary().id:null;_&&(p.available=r.availableImages.some(v=>fa.isEqual(v,_)))}}return p}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&r(this.paramsPrimary[c]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&r(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(r,c){const d={};if(c&&(d.iconset={id:c}),r){d.params={};for(const p in r)r[p]&&(d.params[p]=r[p].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&r.push(c)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&r.push(c)}return r}}function Pn(u){return yg(u)?"string":En(u)?"number":rb(u)?"boolean":Array.isArray(u)?"array":u===null?"null":Ky(u)?"object":typeof u}function Ky(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function yg(u){return typeof u=="string"||u instanceof String}function En(u){return typeof u=="number"||u instanceof Number}function rb(u){return typeof u=="boolean"||u instanceof Boolean}const sb={"to-boolean":Ti,"to-color":Vo,"to-number":un,"to-string":Oi};class Ql{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[0],p=[];let y=pa;if(d==="to-array"){if(!Array.isArray(r[1]))return null;const _=r[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);y=xo(c.expectedType.itemType,_)}else{if(!(_>0&&kd(r[1][0])))return null;y=xo(xs(r[1][0]),_)}for(let v=0;v<_;v++){const T=r[1][v];let S;if(Array.isArray(T))S=c.parse(T,void 0,y.itemType);else{const O=Pn(T);if(O!==y.itemType.kind)return c.error(`Expected ${y.itemType.kind} but found ${O}.`);S=c.registry.literal.parse(["literal",T===void 0?null:T],c)}if(!S)return null;p.push(S)}}else{if((d==="to-boolean"||d==="to-string")&&r.length!==2)return c.error("Expected one argument.");y=sb[d];for(let _=1;_<r.length;_++){const v=c.parse(r[_],_,Mi);if(!v)return null;p.push(v)}}return new Ql(y,p)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let c,d;for(const p of this.args){if(c=p.evaluate(r),d=null,c instanceof Di)return c;if(typeof c=="string"){const y=r.parseColor(c);if(y)return y}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:ib(c[0],c[1],c[2],c[3]),!d))return new Di(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new ps(d||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const d of this.args){if(c=d.evaluate(r),c===null)return 0;const p=Number(c);if(!isNaN(p))return p}throw new ps(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?Eo.fromString(Jl(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?ga.build(Jl(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(c=>c.evaluate(r)):Jl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new cn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ap(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{r.push(c.serialize())}),r}}const x3=["Unknown","Point","LineString","Polygon"];class cp{constructor(r,c,d){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=c,this.iconImageUseTheme=d}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?x3[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:d,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*c-r[0])+this.featureDistanceData.bearing[1]*(p*c-r[1])}return 0}parseColor(r){let c=this._parseColorCache[r];return c||(c=this._parseColorCache[r]=Di.parse(r)),c}getConfig(r){return this.options?this.options.get(r):null}}class ya{constructor(r,c,d,p,y){this.name=r,this.type=c,this._evaluate=d,this.args=p,this._overloadIndex=y}evaluate(r){if(!this._evaluate){const c=ya.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,c){const d=r[0],p=ya.definitions[d];if(!p)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,v=[];let T=null,S=-1;for(const[O,k]of _){if(Array.isArray(O)&&O.length!==r.length-1)continue;v.push(O),S++,T=new s_(c.registry,c.path,null,c.scope,void 0,c._scope,c.options,c.iconImageUseTheme);const N=[];let F=!1;for(let $=1;$<r.length;$++){const H=r[$],K=Array.isArray(O)?O[$-1]:O.type,q=T.parse(H,1+N.length,K);if(!q){F=!0;break}N.push(q)}if(!F)if(Array.isArray(O)&&O.length!==N.length)T.error(`Expected ${O.length} arguments, but found ${N.length} instead.`);else{for(let $=0;$<N.length;$++){const H=Array.isArray(O)?O[$]:O.type,K=N[$];T.concat($+1).checkSubtype(H,K.type)}if(T.errors.length===0)return new ya(d,y,k,N,S)}}if(v.length===1)c.errors.push(...T.errors);else{const O=(v.length?v:_.map(([N])=>N)).map(ob).join(" | "),k=[];for(let N=1;N<r.length;N++){const F=c.parse(r[N],1+k.length);if(!F)return null;k.push(Wr(F.type))}c.error(`Expected arguments of type ${O}, but found (${k.join(", ")}) instead.`)}return null}static register(r,c){ya.definitions=c;for(const d in c)r[d]=ya}}function ob(u){return Array.isArray(u)?`(${u.map(Wr).join(", ")})`:`(${Wr(u.type)}...)`}class eu{constructor(r,c,d){this.type=Gy,this.locale=d,this.caseSensitive=r,this.diacriticSensitive=c}static parse(r,c){if(r.length!==2)return c.error("Expected one argument.");const d=r[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const p=d["case-sensitive"]===void 0?c.parse(!1,1,Ti):c.parseObjectValue(d["case-sensitive"],1,"case-sensitive",Ti);if(!p)return null;const y=d["diacritic-sensitive"]===void 0?c.parse(!1,1,Ti):c.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",Ti);if(!y)return null;let _=null;return d.locale&&(_=c.parseObjectValue(d.locale,1,"locale",Oi),!_)?null:new eu(p,y,_)}evaluate(r){return new nb(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function Yy(u,r,c=0,d=u.length-1,p=Nd){for(;d>c;){if(d-c>600){const T=d-c+1,S=r-c+1,O=Math.log(T),k=.5*Math.exp(2*O/3),N=.5*Math.sqrt(O*k*(T-k)/T)*(S-T/2<0?-1:1);Yy(u,r,Math.max(c,Math.floor(r-S*k/T+N)),Math.min(d,Math.floor(r+(T-S)*k/T+N)),p)}const y=u[r];let _=c,v=d;for(jc(u,c,r),p(u[d],y)>0&&jc(u,c,d);_<v;){for(jc(u,_,v),_++,v--;p(u[_],y)<0;)_++;for(;p(u[v],y)>0;)v--}p(u[c],y)===0?jc(u,c,v):(v++,jc(u,v,d)),v<=r&&(c=v+1),r<=v&&(d=v-1)}}function jc(u,r,c){const d=u[r];u[r]=u[c],u[c]=d}function Nd(u,r){return u<r?-1:u>r?1:0}function DI(u){let r=0;for(let c,d,p=0,y=u.length,_=y-1;p<y;_=p++)c=u[p],d=u[_],r+=(d.x-c.x)*(c.y+d.y);return r}function _g(u,r){u[0]=Math.min(u[0],r[0]),u[1]=Math.min(u[1],r[1]),u[2]=Math.max(u[2],r[0]),u[3]=Math.max(u[3],r[1])}function wg(u,r){return!(u[0]<=r[0]||u[2]>=r[2]||u[1]<=r[1]||u[3]>=r[3])}function Xy(u,r,c){const d=u[0]-r[0],p=u[1]-r[1],y=u[0]-c[0],_=u[1]-c[1];return d*_-y*p===0&&d*y<=0&&p*_<=0}function E3(u,r,c){return r[1]>u[1]!=c[1]>u[1]&&u[0]<(c[0]-r[0])*(u[1]-r[1])/(c[1]-r[1])+r[0]}function Vc(u,r,c=!1){let d=!1;for(let p=0,y=r.length;p<y;p++){const _=r[p];for(let v=0,T=_.length,S=T-1;v<T;S=v++){const O=_[S],k=_[v];if(Xy(u,O,k))return c;E3(u,O,k)&&(d=!d)}}return d}function C3(u,r,c,d){const p=d[0]-c[0],y=d[1]-c[1],_=(u[0]-c[0])*y-p*(u[1]-c[1]),v=(r[0]-c[0])*y-p*(r[1]-c[1]);return _>0&&v<0||_<0&&v>0}function Jy(u,r,c,d){return(p=[d[0]-c[0],d[1]-c[1]])[0]*(y=[r[0]-u[0],r[1]-u[1]])[1]-p[1]*y[0]!==0&&!(!C3(u,r,c,d)||!C3(c,d,u,r));var p,y}function bg(u){const r=new Tt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new Tt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of u[0])r.x>d.x&&(r.x=d.x),r.y>d.y&&(r.y=d.y),c.x<d.x&&(c.x=d.x),c.y<d.y&&(c.y=d.y);return{min:r,max:c}}const Md=8192;function NI(u,r){const c=(180+u[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(c*p*Md),Math.round(d*p*Md)]}function T3(u,r){for(let c=0;c<r.length;c++)if(Vc(u,r[c]))return!0;return!1}function MI(u,r,c){for(const d of c)for(let p=0,y=d.length,_=y-1;p<y;_=p++)if(Jy(u,r,d[_],d[p]))return!0;return!1}function ab(u,r){for(let c=0;c<u.length;++c)if(!Vc(u[c],r))return!1;for(let c=0;c<u.length-1;++c)if(MI(u[c],u[c+1],r))return!1;return!0}function LI(u,r){for(let c=0;c<r.length;c++)if(ab(u,r[c]))return!0;return!1}function Vu(u,r,c){const d=[];for(let p=0;p<u.length;p++){const y=[];for(let _=0;_<u[p].length;_++){const v=NI(u[p][_],c);_g(r,v),y.push(v)}d.push(y)}return d}function A3(u,r,c){const d=[];for(let p=0;p<u.length;p++){const y=Vu(u[p],r,c);d.push(y)}return d}function S3(u,r,c,d){if(u[0]<c[0]||u[0]>c[2]){const p=.5*d;let y=u[0]-c[0]>p?-d:c[0]-u[0]>p?d:0;y===0&&(y=u[0]-c[2]>p?-d:c[2]-u[0]>p?d:0),u[0]+=y}_g(r,u)}function Qy(u,r,c,d){const p=Math.pow(2,d.z)*Md,y=[d.x*Md,d.y*Md],_=[];if(!u)return _;for(const v of u)for(const T of v){const S=[T.x+y[0],T.y+y[1]];S3(S,r,c,p),_.push(S)}return _}function cb(u,r,c,d){const p=Math.pow(2,d.z)*Md,y=[d.x*Md,d.y*Md],_=[];if(!u)return _;for(const T of u){const S=[];for(const O of T){const k=[O.x+y[0],O.y+y[1]];_g(r,k),S.push(k)}_.push(S)}if(r[2]-r[0]<=p/2){(v=r)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of _)for(const S of T)S3(S,r,c,p)}var v;return _}class Ld{constructor(r,c){this.type=Ti,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(kd(r[1])){const d=r[1];if(d.type==="FeatureCollection")for(let p=0;p<d.features.length;++p){const y=d.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ld(d,d.features[p].geometry)}else if(d.type==="Feature"){const p=d.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ld(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Ld(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(c,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=c.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const v=Vu(d.coordinates,y,_),T=Qy(c.geometry(),p,y,_);if(!wg(p,y))return!1;for(const S of T)if(!Vc(S,v))return!1}if(d.type==="MultiPolygon"){const v=A3(d.coordinates,y,_),T=Qy(c.geometry(),p,y,_);if(!wg(p,y))return!1;for(const S of T)if(!T3(S,v))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(c,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=c.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const v=Vu(d.coordinates,y,_),T=cb(c.geometry(),p,y,_);if(!wg(p,y))return!1;for(const S of T)if(!ab(S,v))return!1}if(d.type==="MultiPolygon"){const v=A3(d.coordinates,y,_),T=cb(c.geometry(),p,y,_);if(!wg(p,y))return!1;for(const S of T)if(!LI(S,v))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Na={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},lb=1/298.257223563,ub=lb*(2-lb),lp=Math.PI/180;class up{static fromTile(r,c,d){const p=Math.PI*(1-2*(r+.5)/Math.pow(2,c)),y=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/lp;return new up(y,d)}static get units(){return Na}constructor(r,c){if(r===void 0)throw new Error("No latitude given.");if(c&&!Na[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Na).join(", ")}`);const d=6378.137*lp*(c?Na[c]:1),p=Math.cos(r*lp),y=1/(1-ub*(1-p*p)),_=Math.sqrt(y);this.kx=d*_*p,this.ky=d*_*y*(1-ub)}distance(r,c){const d=uc(r[0]-c[0])*this.kx,p=(r[1]-c[1])*this.ky;return Math.sqrt(d*d+p*p)}bearing(r,c){const d=uc(c[0]-r[0])*this.kx;return Math.atan2(d,(c[1]-r[1])*this.ky)/lp}destination(r,c,d){const p=d*lp;return this.offset(r,Math.sin(p)*c,Math.cos(p)*c)}offset(r,c,d){return[r[0]+c/this.kx,r[1]+d/this.ky]}lineDistance(r){let c=0;for(let d=0;d<r.length-1;d++)c+=this.distance(r[d],r[d+1]);return c}area(r){let c=0;for(let d=0;d<r.length;d++){const p=r[d];for(let y=0,_=p.length,v=_-1;y<_;v=y++)c+=uc(p[y][0]-p[v][0])*(p[y][1]+p[v][1])*(d?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(r,c){let d=0;if(c<=0)return r[0];for(let p=0;p<r.length-1;p++){const y=r[p],_=r[p+1],v=this.distance(y,_);if(d+=v,d>c)return e_(y,_,(c-(d-v))/v)}return r[r.length-1]}pointToSegmentDistance(r,c,d){let[p,y]=c,_=uc(d[0]-p)*this.kx,v=(d[1]-y)*this.ky;if(_!==0||v!==0){const T=(uc(r[0]-p)*this.kx*_+(r[1]-y)*this.ky*v)/(_*_+v*v);T>1?(p=d[0],y=d[1]):T>0&&(p+=_/this.kx*T,y+=v/this.ky*T)}return _=uc(r[0]-p)*this.kx,v=(r[1]-y)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(r,c){let d=1/0,p=r[0][0],y=r[0][1],_=0,v=0;for(let T=0;T<r.length-1;T++){let S=r[T][0],O=r[T][1],k=uc(r[T+1][0]-S)*this.kx,N=(r[T+1][1]-O)*this.ky,F=0;k===0&&N===0||(F=(uc(c[0]-S)*this.kx*k+(c[1]-O)*this.ky*N)/(k*k+N*N),F>1?(S=r[T+1][0],O=r[T+1][1]):F>0&&(S+=k/this.kx*F,O+=N/this.ky*F)),k=uc(c[0]-S)*this.kx,N=(c[1]-O)*this.ky;const $=k*k+N*N;$<d&&(d=$,p=S,y=O,_=T,v=F)}return{point:[p,y],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(r,c,d){let p=this.pointOnLine(d,r),y=this.pointOnLine(d,c);if(p.index>y.index||p.index===y.index&&p.t>y.t){const S=p;p=y,y=S}const _=[p.point],v=p.index+1,T=y.index;!db(d[v],_[0])&&v<=T&&_.push(d[v]);for(let S=v+1;S<=T;S++)_.push(d[S]);return db(d[T],y.point)||_.push(y.point),_}lineSliceAlong(r,c,d){let p=0;const y=[];for(let _=0;_<d.length-1;_++){const v=d[_],T=d[_+1],S=this.distance(v,T);if(p+=S,p>r&&y.length===0&&y.push(e_(v,T,(r-(p-S))/S)),p>=c)return y.push(e_(v,T,(c-(p-S))/S)),y;p>r&&y.push(T)}return y}bufferPoint(r,c){const d=c/this.ky,p=c/this.kx;return[r[0]-p,r[1]-d,r[0]+p,r[1]+d]}bufferBBox(r,c){const d=c/this.ky,p=c/this.kx;return[r[0]-p,r[1]-d,r[2]+p,r[3]+d]}insideBBox(r,c){return uc(r[0]-c[0])>=0&&uc(r[0]-c[2])<=0&&r[1]>=c[1]&&r[1]<=c[3]}}function db(u,r){return u[0]===r[0]&&u[1]===r[1]}function e_(u,r,c){const d=uc(r[0]-u[0]);return[u[0]+d*c,u[1]+(r[1]-u[1])*c]}function uc(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class vg{constructor(r=[],c=(d,p)=>d<p?-1:d>p?1:0){if(this.data=r,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:c,compare:d}=this,p=c[r];for(;r>0;){const y=r-1>>1,_=c[y];if(d(p,_)>=0)break;c[r]=_,r=y}c[r]=p}_down(r){const{data:c,compare:d}=this,p=this.length>>1,y=c[r];for(;r<p;){let _=1+(r<<1);const v=_+1;if(v<this.length&&d(c[v],c[_])<0&&(_=v),d(c[_],y)>=0)break;c[r]=c[_],r=_}c[r]=y}}var zt=8192;function hb(u,r){return r.dist-u.dist}function fb(u){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==u.length)return!1;for(let c=0;c<r.length;c++)if(r[c]!==u[c])return!1;return!0}function xg(u){return u[1]-u[0]+1}function tu(u,r){const c=u[1]>=u[0]&&u[1]<r;return c||console.warn("Distance Expression: Index is out of range"),c}function pb(u,r){if(u[0]>u[1])return[null,null];const c=xg(u);if(r){if(c===2)return[u,null];const d=Math.floor(c/2);return[[u[0],u[0]+d],[u[0]+d,u[1]]]}{if(c===1)return[u,null];const d=Math.floor(c/2)-1;return[[u[0],u[0]+d],[u[0]+d+1,u[1]]]}}function Wh(u,r){const c=[1/0,1/0,-1/0,-1/0];if(!tu(r,u.length))return c;for(let d=r[0];d<=r[1];++d)_g(c,u[d]);return c}function Hh(u){const r=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let d=0;d<u[c].length;++d)_g(r,u[c][d]);return r}function Bd(u,r,c){if(fb(u)||fb(r))return NaN;let d=0,p=0;return u[2]<r[0]&&(d=r[0]-u[2]),u[0]>r[2]&&(d=u[0]-r[2]),u[1]>r[3]&&(p=u[1]-r[3]),u[3]<r[1]&&(p=r[1]-u[3]),c.distance([0,0],[d,p])}function t_(u){return 360*u-180}function I3(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function n_(u,r){const c=Math.pow(2,r.z),d=(u.y/zt+r.y)/c;return[t_((u.x/zt+r.x)/c),I3(d)]}function BI(u,r){const c=[];for(let d=0;d<u.length;++d)c.push(n_(u[d],r));return c}function P3(u,r,c){const d=c.pointOnLine(r,u).point;return c.distance(u,d)}function mb(u,r,c,d,p){const y=c.slice(d[0],d[1]+1);let _=1/0;for(let v=r[0];v<=r[1];++v)if((_=Math.min(_,P3(u[v],y,p)))===0)return 0;return _}function Fd(u,r,c,d,p){const y=Math.min(p.pointToSegmentDistance(u,c,d),p.pointToSegmentDistance(r,c,d)),_=Math.min(p.pointToSegmentDistance(c,u,r),p.pointToSegmentDistance(d,u,r));return Math.min(y,_)}function di(u,r,c,d,p){if(!tu(r,u.length)||!tu(d,c.length))return NaN;let y=1/0;for(let _=r[0];_<r[1];++_)for(let v=d[0];v<d[1];++v){if(Jy(u[_],u[_+1],c[v],c[v+1]))return 0;y=Math.min(y,Fd(u[_],u[_+1],c[v],c[v+1],p))}return y}function FI(u,r,c,d,p){if(!tu(r,u.length)||!tu(d,c.length))return NaN;let y=1/0;for(let _=r[0];_<=r[1];++_)for(let v=d[0];v<=d[1];++v)if((y=Math.min(y,p.distance(u[_],c[v])))===0)return y;return y}function $I(u,r,c){if(Vc(u,r,!0))return 0;let d=1/0;for(const p of r){const y=p.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[y-1]&&(d=Math.min(d,c.pointToSegmentDistance(u,p[y-1],p[0])))===0||(d=Math.min(d,P3(u,p,c)))===0)return d}return d}function zI(u,r,c,d){if(!tu(r,u.length))return NaN;for(let y=r[0];y<=r[1];++y)if(Vc(u[y],c,!0))return 0;let p=1/0;for(let y=r[0];y<r[1];++y)for(const _ of c)for(let v=0,T=_.length,S=T-1;v<T;S=v++){if(Jy(u[y],u[y+1],_[S],_[v]))return 0;p=Math.min(p,Fd(u[y],u[y+1],_[S],_[v],d))}return p}function gb(u,r){for(const c of u)for(let d=0;d<=c.length-1;++d)if(Vc(c[d],r,!0))return!0;return!1}function UI(u,r,c,d=1/0){const p=Hh(u),y=Hh(r);if(d!==1/0&&Bd(p,y,c)>=d)return d;if(wg(p,y)){if(gb(u,r))return 0}else if(gb(r,u))return 0;let _=d;for(const v of u)for(let T=0,S=v.length,O=S-1;T<S;O=T++)for(const k of r)for(let N=0,F=k.length,$=F-1;N<F;$=N++){if(Jy(v[O],v[T],k[$],k[N]))return 0;_=Math.min(_,Fd(v[O],v[T],k[$],k[N],c))}return _}function lr(u,r,c,d,p,y,_){if(y===null||_===null)return;const v=Bd(Wh(d,y),Wh(p,_),c);v<r&&u.push({dist:v,range1:y,range2:_})}function jI(u,r,c,d,p=1/0){let y=Math.min(d.distance(u[0],c[0][0]),p);if(y===0)return y;const _=new vg([{dist:0,range1:[0,u.length-1],range2:[0,0]}],hb),v=r?50:100,T=Hh(c);for(;_.length;){const S=_.pop();if(S.dist>=y)continue;const O=S.range1;if(xg(O)<=v){if(!tu(O,u.length))return NaN;if(r){const k=zI(u,O,c,d);if((y=Math.min(y,k))===0)return y}else for(let k=O[0];k<=O[1];++k){const N=$I(u[k],c,d);if((y=Math.min(y,N))===0)return y}}else{const k=pb(O,r);if(k[0]!==null){const N=Bd(Wh(u,k[0]),T,d);N<y&&_.push({dist:N,range1:k[0],range2:[0,0]})}if(k[1]!==null){const N=Bd(Wh(u,k[1]),T,d);N<y&&_.push({dist:N,range1:k[1],range2:[0,0]})}}}return y}function R3(u,r,c,d,p,y=1/0){let _=Math.min(y,p.distance(u[0],c[0]));if(_===0)return _;const v=new vg([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],hb),T=r?50:100,S=d?50:100;for(;v.length;){const O=v.pop();if(O.dist>=_)continue;const k=O.range1,N=O.range2;if(xg(k)<=T&&xg(N)<=S){if(!tu(k,u.length)||!tu(N,c.length))return NaN;if(r&&d?_=Math.min(_,di(u,k,c,N,p)):r||d?r&&!d?_=Math.min(_,mb(c,N,u,k,p)):!r&&d&&(_=Math.min(_,mb(u,k,c,N,p))):_=Math.min(_,FI(u,k,c,N,p)),_===0)return _}else{const F=pb(k,r),$=pb(N,d);lr(v,_,p,u,c,F[0],$[0]),lr(v,_,p,u,c,F[0],$[1]),lr(v,_,p,u,c,F[1],$[0]),lr(v,_,p,u,c,F[1],$[1])}}return _}function yb(u,r,c,d,p=1/0){let y=p;const _=Wh(u,[0,u.length-1]);for(const v of c)if(!(y!==1/0&&Bd(_,Wh(v,[0,v.length-1]),d)>=y)&&(y=Math.min(y,R3(u,r,v,!0,d,y)),y===0))return y;return y}function i_(u,r,c,d,p=1/0){let y=p;const _=Wh(u,[0,u.length-1]);for(const v of c){if(y!==1/0&&Bd(_,Hh(v),d)>=y)continue;const T=jI(u,r,v,d,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}function _b(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class Gh{constructor(r,c){this.type=un,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(kd(r[1])){const d=r[1];if(d.type==="FeatureCollection"){for(let p=0;p<d.features.length;++p)if(_b(d.features[p].geometry.type))return new Gh(d,d.features[p].geometry)}else if(d.type==="Feature"){if(_b(d.geometry.type))return new Gh(d,d.geometry)}else if(_b(d.type))return new Gh(d,d)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const c=r.geometry(),d=r.canonicalID();if(c!=null&&d!=null){if(r.geometryType()==="Point")return function(p,y,_){const v=[];for(const S of p)for(const O of S)v.push(n_(O,y));const T=new up(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?R3(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",T):_.type==="MultiLineString"?yb(v,!1,_.coordinates,T):_.type==="Polygon"||_.type==="MultiPolygon"?i_(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,T):null}(c,d,this.geometries);if(r.geometryType()==="LineString")return function(p,y,_){const v=[];for(const S of p){const O=[];for(const k of S)O.push(n_(k,y));v.push(O)}const T=new up(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return yb(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,T);if(_.type==="MultiLineString"){let S=1/0;for(let O=0;O<_.coordinates.length;O++){const k=yb(_.coordinates[O],!0,v,T,S);if(isNaN(k))return k;if((S=Math.min(S,k))===0)return S}return S}if(_.type==="Polygon"||_.type==="MultiPolygon"){let S=1/0;for(let O=0;O<v.length;O++){const k=i_(v[O],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,T,S);if(isNaN(k))return k;if((S=Math.min(S,k))===0)return S}return S}return null}(c,d,this.geometries);if(r.geometryType()==="Polygon")return function(p,y,_){const v=[];for(const S of function(O){const k=O.length;if(k<=1)return[O];const N=[];let F,$;for(let H=0;H<k;H++){const K=DI(O[H]);K!==0&&(O[H].area=Math.abs(K),$===void 0&&($=K<0),$===K<0?(F&&N.push(F),F=[O[H]]):F.push(O[H]))}return F&&N.push(F),N}(p)){const O=[];for(let k=0;k<S.length;++k)O.push(BI(S[k],y));v.push(O)}const T=new up(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return i_(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,T);if(_.type==="MultiLineString"){let S=1/0;for(let O=0;O<_.coordinates.length;O++){const k=i_(_.coordinates[O],!0,v,T,S);if(isNaN(k))return k;if((S=Math.min(S,k))===0)return S}return S}return _.type==="Polygon"||_.type==="MultiPolygon"?function(S,O,k){let N=1/0;for(const F of S)for(const $ of O){const H=UI(F,$,k,N);if(isNaN(H))return H;if((N=Math.min(N,H))===0)return N}return N}(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,T):null}(c,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function dp(u){if(u instanceof ya&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Ld||u instanceof Gh)return!1;if(u instanceof fp)return u.featureConstant;let r=!0;return u.eachChild(c=>{r&&!dp(c)&&(r=!1)}),r}function Eg(u){if(u instanceof ya&&u.name==="feature-state")return!1;let r=!0;return u.eachChild(c=>{r&&!Eg(c)&&(r=!1)}),r}function hp(u,r){if(u instanceof ya&&r.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(d=>{c&&!hp(d,r)&&(c=!1)}),c}function O3(u,r,c){return[u,r,c].filter(Boolean).join("")}function wb(u,r){switch(u){case"string":return Jl(r);case"number":return+r;case"boolean":return!!r;case"color":return Di.parse(r);case"formatted":return Eo.fromString(Jl(r));case"resolvedImage":return ga.build(Jl(r))}return r}function k3(u,r,c,d){return d!==void 0&&(u=d*Math.round(u/d)),r!==void 0&&u<r&&(u=r),c!==void 0&&u>c&&(u=c),u}class fp{constructor(r,c,d,p=!1){this.type=r,this.key=c,this.scope=d,this.featureConstant=p}static parse(r,c){let d=c.expectedType;if(d==null&&(d=Mi),r.length<2||r.length>3)return c.error("Invalid number of arguments for 'config' expression.");const p=c.parse(r[1],1);if(!(p instanceof ju))return c.error("Key name of 'config' expression must be a string literal.");let y,_=!0;const v=Jl(p.value);if(r.length>=3){const T=c.parse(r[2],2);if(!(T instanceof ju))return c.error("Scope of 'config' expression must be a string literal.");y=Jl(T.value)}if(c.options){const T=O3(v,y,c._scope),S=c.options.get(T);S&&(_=dp(S.value||S.default))}return new fp(d,v,y,_)}evaluate(r){const c=O3(this.key,this.scope,r.scope),d=r.getConfig(c);if(!d)return null;const{type:p,value:y,values:_,minValue:v,maxValue:T,stepValue:S}=d,O=d.default.evaluate(r);let k=O;if(y){const N=r.scope;r.scope=(N||"").split("").slice(1).join(""),k=y.evaluate(r),r.scope=N}return p&&(k=wb(p,k)),k===void 0||v===void 0&&T===void 0&&S===void 0||(typeof k=="number"?k=k3(k,v,T,S):Array.isArray(k)&&(k=k.map(N=>typeof N=="number"?k3(N,v,T,S):N))),y!==void 0&&k!==void 0&&_&&!_.includes(k)&&(k=O,p&&(k=wb(p,k))),(p&&p!==this.type||k!==void 0&&!qy(xs(k),this.type))&&(k=wb(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class r_{constructor(r,c){this.type=c.type,this.name=r,this.boundExpression=c}static parse(r,c){if(r.length!==2||typeof r[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=r[1];return c.scope.has(d)?new r_(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class s_{constructor(r,c=[],d,p=new Hy,y=[],_,v,T){this.registry=r,this.path=c,this.key=c.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=p,this.errors=y,this.expectedType=d,this._scope=_,this.options=v,this.iconImageUseTheme=T}parse(r,c,d,p,y={}){return c||d?this.concat(c,null,d,p)._parse(r,y):this._parse(r,y)}parseObjectValue(r,c,d,p,y,_={}){return this.concat(c,d,p,y)._parse(r,_)}_parse(r,c){function d(p,y,_){return _==="assert"?new Nn(y,[p]):_==="coerce"?new Ql(y,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(p){let y=p.parse(r,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,v=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else y=d(y,_,c.typeAnnotation||"coerce");else y=d(y,_,c.typeAnnotation||"assert")}if(!(y instanceof ju)&&y.type.kind!=="resolvedImage"&&bb(y)){const _=new cp(this._scope,this.options,this.iconImageUseTheme);try{y=new ju(y.type,y.evaluate(_))}catch(v){return this.error(v.message),null}}return y}return Ql.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,c,d,p){let y=typeof r=="number"?this.path.concat(r):this.path;y=typeof c=="string"?y.concat(c):y;const _=p?this.scope.concat(p):this.scope;return new s_(this.registry,y,d||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...c){const d=`${this.key}${c.map(p=>`[${p}]`).join("")}`;this.errors.push(new jo(d,r))}checkSubtype(r,c){const d=mg(r,c);return d&&this.error(d),d}}function bb(u){if(u instanceof r_)return bb(u.boundExpression);if(u instanceof ya&&u.name==="error"||u instanceof eu||u instanceof Ld||u instanceof Gh||u instanceof fp)return!1;const r=u instanceof Ql||u instanceof Nn;let c=!0;return u.eachChild(d=>{c=r?c&&bb(d):c&&d instanceof ju}),!!c&&dp(u)&&hp(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function o_(u,r){const c=u.length-1;let d,p,y=0,_=c,v=0;for(;y<=_;)if(v=Math.floor((y+_)/2),d=u[v],p=u[v+1],d<=r){if(v===c||r<p)return v;y=v+1}else{if(!(d>r))throw new ps("Input is not a number.");_=v-1}return 0}class Cg{constructor(r,c,d){this.type=r,this.input=c,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static parse(r,c){if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(r[1],1,un);if(!d)return null;const p=[];let y=null;c.expectedType&&c.expectedType.kind!=="value"&&(y=c.expectedType);for(let _=1;_<r.length;_+=2){const v=_===1?-1/0:r[_],T=r[_+1],S=_,O=_+1;if(typeof v!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=v)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const k=c.parse(T,O,y);if(!k)return null;y=y||k.type,p.push([v,k])}return new Cg(y,d,p)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const p=this.input.evaluate(r);if(p<=c[0])return d[0].evaluate(r);const y=c.length;return p>=c[y-1]?d[y-1].evaluate(r):d[o_(c,p)].evaluate(r)}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&r.push(this.labels[c]),r.push(this.outputs[c].serialize());return r}}const D3=.95047,N3=1.08883,M3=4/29,pp=6/29,L3=3*pp*pp,VI=pp*pp*pp,WI=Math.PI/180,HI=180/Math.PI;function vb(u){return u>VI?Math.pow(u,1/3):u/L3+M3}function xb(u){return u>pp?u*u*u:L3*(u-M3)}function Eb(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function Cb(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function B3(u){const r=Cb(u.r),c=Cb(u.g),d=Cb(u.b),p=vb((.4124564*r+.3575761*c+.1804375*d)/D3),y=vb((.2126729*r+.7151522*c+.072175*d)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-vb((.0193339*r+.119192*c+.9503041*d)/N3)),alpha:u.a}}function a_(u){let r=(u.l+16)/116,c=isNaN(u.a)?r:r+u.a/500,d=isNaN(u.b)?r:r-u.b/200;return r=1*xb(r),c=D3*xb(c),d=N3*xb(d),new Di(Eb(3.2404542*c-1.5371385*r-.4985314*d),Eb(-.969266*c+1.8760108*r+.041556*d),Eb(.0556434*c-.2040259*r+1.0572252*d),u.alpha)}function c_(u,r,c){const d=r-u;return u+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const mp={forward:B3,reverse:a_,interpolate:function(u,r,c){return{l:xn(u.l,r.l,c),a:xn(u.a,r.a,c),b:xn(u.b,r.b,c),alpha:xn(u.alpha,r.alpha,c)}}},Tg={forward:function(u){const{l:r,a:c,b:d}=B3(u),p=Math.atan2(d,c)*HI;return{h:p<0?p+360:p,c:Math.sqrt(c*c+d*d),l:r,alpha:u.a}},reverse:function(u){const r=u.h*WI,c=u.c;return a_({l:u.l,a:Math.cos(r)*c,b:Math.sin(r)*c,alpha:u.alpha})},interpolate:function(u,r,c){return{h:c_(u.h,r.h,c),c:xn(u.c,r.c,c),l:xn(u.l,r.l,c),alpha:xn(u.alpha,r.alpha,c)}}};var F3=Object.freeze({__proto__:null,hcl:Tg,lab:mp});class dc{constructor(r,c,d,p,y){this.type=r,this.operator=c,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(const[_,v]of y)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(r,c,d,p){let y=0;if(r.name==="exponential")y=l_(c,r.base,d,p);else if(r.name==="linear")y=l_(c,1,d,p);else if(r.name==="cubic-bezier"){const _=r.controlPoints;y=new lo(_[0],_[1],_[2],_[3]).solve(l_(c,1,d,p))}return y}static parse(r,c){let[d,p,y,..._]=r;if(!Array.isArray(p)||p.length===0)return c.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const S=p[1];if(typeof S!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(S.length!==4||S.some(O=>typeof O!="number"||O<0||O>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(y=c.parse(y,2,un),!y)return null;const v=[];let T=null;d==="interpolate-hcl"||d==="interpolate-lab"?T=Vo:c.expectedType&&c.expectedType.kind!=="value"&&(T=c.expectedType);for(let S=0;S<_.length;S+=2){const O=_[S],k=_[S+1],N=S+3,F=S+4;if(typeof O!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(v.length&&v[v.length-1][0]>=O)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=c.parse(k,F,T);if(!$)return null;T=T||$.type,v.push([O,$])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new dc(T,d,p,y,v):c.error(`Type ${Wr(T)} is not interpolatable.`)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const p=this.input.evaluate(r);if(p<=c[0])return d[0].evaluate(r);const y=c.length;if(p>=c[y-1])return d[y-1].evaluate(r);const _=o_(c,p),v=dc.interpolationFactor(this.interpolation,p,c[_],c[_+1]),T=d[_].evaluate(r),S=d[_+1].evaluate(r);return this.operator==="interpolate"?jh[this.type.kind.toLowerCase()](T,S,v):this.operator==="interpolate-hcl"?Tg.reverse(Tg.interpolate(Tg.forward(T),Tg.forward(S),v)):mp.reverse(mp.interpolate(mp.forward(T),mp.forward(S),v))}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,r,this.input.serialize()];for(let d=0;d<this.labels.length;d++)c.push(this.labels[d],this.outputs[d].serialize());return c}}function l_(u,r,c,d){const p=d-c,y=u-c;return p===0?0:r===1?y/p:(Math.pow(r,y)-1)/(Math.pow(r,p)-1)}class Ag{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expectected at least one argument.");let d=null;const p=c.expectedType;p&&p.kind!=="value"&&(d=p);const y=[];for(const v of r.slice(1)){const T=c.parse(v,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!T)return null;d=d||T.type,y.push(T)}const _=p&&y.some(v=>mg(p,v.type));return new Ag(_?Mi:d,y)}evaluate(r){let c,d=null,p=0;for(const y of this.args){if(p++,d=y.evaluate(r),d&&d instanceof ga&&!d.available&&(c||(c=d),d=null,p===this.args.length))return c;if(d!==null)break}return d}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(c=>{r.push(c.serialize())}),r}}class Wu{constructor(r,c){this.type=c.type,this.bindings=[].concat(r),this.result=c}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const c of this.bindings)r(c[1]);r(this.result)}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const d=[];for(let y=1;y<r.length-1;y+=2){const _=r[y];if(typeof _!="string")return c.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return c.error("Variable names must contain only alphanumeric characters or '_'.",y);const v=c.parse(r[y+1],y+1);if(!v)return null;d.push([_,v])}const p=c.parse(r[r.length-1],r.length-1,c.expectedType,d);return p?new Wu(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[c,d]of this.bindings)r.push(c,d.serialize());return r.push(this.result.serialize()),r}}class u_{constructor(r,c,d){this.type=r,this.index=c,this.input=d}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,un),p=c.parse(r[2],2,xo(c.expectedType||Mi));return d&&p?new u_(p.type.itemType,d,p):null}evaluate(r){const c=this.index.evaluate(r),d=this.input.evaluate(r);if(c<0)throw new ps("Array index out of bounds: negative index");if(c>=d.length)throw new ps("Array index out of bounds: index exceeds array size");if(c!==Math.floor(c))throw new ps("Array index must be an integer. Use at-interpolated for fractional indices");return d[c]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class d_{constructor(r,c,d){this.type=r,this.index=c,this.input=d}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,un),p=c.parse(r[2],2,xo(c.expectedType||Mi));return d&&p?new d_(p.type.itemType,d,p):null}evaluate(r){const c=this.index.evaluate(r),d=this.input.evaluate(r);if(c<0)throw new ps(`Array index out of bounds: ${c} < 0.`);if(c>d.length-1)throw new ps(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c===Math.floor(c))return d[c];const p=Math.floor(c),y=Math.ceil(c),_=d[p],v=d[y];if(typeof _!="number"||typeof v!="number")throw new ps(`Cannot interpolate between non-number values at index ${c}.`);const T=c-p;return _*(1-T)+v*T}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Tb{constructor(r,c){this.type=Ti,this.needle=r,this.haystack=c}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Mi),p=c.parse(r[2],2,Mi);return d&&p?tb(d.type,[Ti,Oi,un,pa,Mi])?new Tb(d,p):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(d.type)} instead`):null}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(d==null)return!1;if(!gg(c,["boolean","string","number","null"]))throw new ps(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(xs(c))} instead.`);if(!gg(d,["string","array"]))throw new ps(`Expected second argument to be of type array or string, but found ${Wr(xs(d))} instead.`);return d.indexOf(c)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class gp{constructor(r,c,d){this.type=un,this.needle=r,this.haystack=c,this.fromIndex=d}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Mi),p=c.parse(r[2],2,Mi);if(!d||!p)return null;if(!tb(d.type,[Ti,Oi,un,pa,Mi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(d.type)} instead`);if(r.length===4){const y=c.parse(r[3],3,un);return y?new gp(d,p,y):null}return new gp(d,p)}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!gg(c,["boolean","string","number","null"]))throw new ps(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(xs(c))} instead.`);if(!gg(d,["string","array"]))throw new ps(`Expected second argument to be of type array or string, but found ${Wr(xs(d))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return d.indexOf(c,p)}return d.indexOf(c)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Sg{constructor(r,c,d,p,y,_){this.inputType=r,this.type=c,this.input=d,this.cases=p,this.outputs=y,this.otherwise=_}static parse(r,c){if(r.length<5)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return c.error("Expected an even number of arguments.");let d,p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const y={},_=[];for(let S=2;S<r.length-1;S+=2){let O=r[S];const k=r[S+1];Array.isArray(O)||(O=[O]);const N=c.concat(S);if(O.length===0)return N.error("Expected at least one branch label.");for(const $ of O){if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,xs($)))return null}else d=xs($);if(y[String($)]!==void 0)return N.error("Branch labels must be unique.");y[String($)]=_.length}const F=c.parse(k,S,p);if(!F)return null;p=p||F.type,_.push(F)}const v=c.parse(r[1],1,Mi);if(!v)return null;const T=c.parse(r[r.length-1],r.length-1,p);return T?v.type.kind!=="value"&&c.concat(1).checkSubtype(d,v.type)?null:new Sg(d,p,v,y,_,T):null}evaluate(r){const c=this.input.evaluate(r);return(qy(xs(c),this.inputType)&&this.outputs[this.cases[c]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),d=[],p={};for(const _ of c){const v=p[this.cases[_]];v===void 0?(p[this.cases[_]]=d.length,d.push([this.cases[_],[_]])):d[v][1].push(_)}const y=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of d)r.push(v.length===1?y(v[0]):v.map(y)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}class Ig{constructor(r,c,d){this.type=r,this.branches=c,this.otherwise=d}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const p=[];for(let _=1;_<r.length-1;_+=2){const v=c.parse(r[_],_,Ti);if(!v)return null;const T=c.parse(r[_+1],_+1,d);if(!T)return null;p.push([v,T]),d=d||T.type}const y=c.parse(r[r.length-1],r.length-1,d);return y?new Ig(d,p,y):null}evaluate(r){for(const[c,d]of this.branches)if(c.evaluate(r))return d.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[c,d]of this.branches)r(c),r(d);r(this.otherwise)}outputDefined(){return this.branches.every(([r,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(c=>{r.push(c.serialize())}),r}}class h_{constructor(r,c,d,p){this.type=r,this.input=c,this.beginIndex=d,this.endIndex=p}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Mi),p=c.parse(r[2],2,un);if(!d||!p)return null;if(!tb(d.type,[xo(Mi),Oi,Mi]))return c.error(`Expected first argument to be of type array or string, but found ${Wr(d.type)} instead`);if(r.length===4){const y=c.parse(r[3],3,un);return y?new h_(d.type,d,p,y):null}return new h_(d.type,d,p)}evaluate(r){const c=this.input.evaluate(r),d=this.beginIndex.evaluate(r);if(!gg(c,["string","array"]))throw new ps(`Expected first argument to be of type array or string, but found ${Wr(xs(c))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return c.slice(d,p)}return c.slice(d)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Ab{constructor(r,c){this.type=xo(Oi),this.str=r,this.delimiter=c}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Oi),p=c.parse(r[2],2,Oi);return d&&p?new Ab(d,p):void 0}evaluate(r){const c=this.str.evaluate(r),d=this.delimiter.evaluate(r);return c.split(d)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Sb(u,r){return u==="=="||u==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Ib(u,r,c,d){return d.compare(r,c)===0}function yp(u,r,c){const d=u!=="=="&&u!=="!=";return class UV{constructor(y,_,v){this.type=Ti,this.lhs=y,this.rhs=_,this.collator=v,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const v=y[0];let T=_.parse(y[1],1,Mi);if(!T)return null;if(!Sb(v,T.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Wr(T.type)}'.`);let S=_.parse(y[2],2,Mi);if(!S)return null;if(!Sb(v,S.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Wr(S.type)}'.`);if(T.type.kind!==S.type.kind&&T.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${Wr(T.type)}' and '${Wr(S.type)}'.`);d&&(T.type.kind==="value"&&S.type.kind!=="value"?T=new Nn(S.type,[T]):T.type.kind!=="value"&&S.type.kind==="value"&&(S=new Nn(T.type,[S])));let O=null;if(y.length===4){if(T.type.kind!=="string"&&S.type.kind!=="string"&&T.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(O=_.parse(y[3],3,Gy),!O)return null}return new UV(T,S,O)}evaluate(y){const _=this.lhs.evaluate(y),v=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const T=xs(_),S=xs(v);if(T.kind!==S.kind||T.kind!=="string"&&T.kind!=="number")throw new ps(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const T=xs(_),S=xs(v);if(T.kind!=="string"||S.kind!=="string")return r(y,_,v)}return this.collator?c(y,_,v,this.collator.evaluate(y)):r(y,_,v)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[u];return this.eachChild(_=>{y.push(_.serialize())}),y}}}const GI=yp("==",function(u,r,c){return r===c},Ib),qI=yp("!=",function(u,r,c){return r!==c},function(u,r,c,d){return!Ib(0,r,c,d)}),$3=yp("<",function(u,r,c){return r<c},function(u,r,c,d){return d.compare(r,c)<0}),z3=yp(">",function(u,r,c){return r>c},function(u,r,c,d){return d.compare(r,c)>0}),f_=yp("<=",function(u,r,c){return r<=c},function(u,r,c,d){return d.compare(r,c)<=0}),ZI=yp(">=",function(u,r,c){return r>=c},function(u,r,c,d){return d.compare(r,c)>=0});class p_{constructor(r,c,d,p,y,_){this.type=Oi,this.number=r,this.locale=c,this.currency=d,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=_}static parse(r,c){if(r.length!==3)return c.error("Expected two arguments.");const d=c.parse(r[1],1,un);if(!d)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return c.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=c.parseObjectValue(p.locale,2,"locale",Oi),!y))return null;let _=null;if(p.currency&&(_=c.parseObjectValue(p.currency,2,"currency",Oi),!_))return null;let v=null;if(p.unit&&(v=c.parseObjectValue(p.unit,2,"unit",Oi),!v))return null;let T=null;if(p["min-fraction-digits"]&&(T=c.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",un),!T))return null;let S=null;return p["max-fraction-digits"]&&(S=c.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",un),!S)?null:new p_(d,y,_,v,T,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Pb{constructor(r){this.type=un,this.input=r}static parse(r,c){if(r.length!==2)return c.error(`Expected 1 argument, but found ${r.length-1} instead.`);const d=c.parse(r[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Wr(d.type)} instead.`):new Pb(d):null}evaluate(r){const c=this.input.evaluate(r);if(typeof c=="string"||Array.isArray(c))return c.length;throw new ps(`Expected value to be of type string or array, but found ${Wr(xs(c))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(c=>{r.push(c.serialize())}),r}}function U3(u){return function(){u=1831565813+(u|=0)|0;let r=Math.imul(u^u>>>15,1|u);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const qh={"==":GI,"!=":qI,">":z3,"<":$3,">=":ZI,"<=":f_,array:Nn,at:u_,"at-interpolated":d_,boolean:Nn,case:Ig,coalesce:Ag,collator:eu,format:cn,image:ap,in:Tb,"index-of":gp,interpolate:dc,"interpolate-hcl":dc,"interpolate-lab":dc,length:Pb,let:Wu,literal:ju,match:Sg,number:Nn,"number-format":p_,object:Nn,slice:h_,step:Cg,string:Nn,"to-boolean":Ql,"to-color":Ql,"to-number":Ql,"to-string":Ql,var:r_,within:Ld,distance:Gh,config:fp,split:Ab};function Rb(u,[r,c,d,p]){r=r.evaluate(u),c=c.evaluate(u),d=d.evaluate(u);const y=p?p.evaluate(u):1,_=ib(r,c,d,y);if(_)throw new ps(_);return new Di(r/255,c/255,d/255,y)}function j3(u,[r,c,d,p]){r=r.evaluate(u),c=c.evaluate(u),d=d.evaluate(u);const y=p?p.evaluate(u):1,_=function(S,O,k,N){return typeof S=="number"&&S>=0&&S<=360?typeof O=="number"&&O>=0&&O<=100&&typeof k=="number"&&k>=0&&k<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[S,O,k,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[S,O,k,N]:[S,O,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[S,O,k,N]:[S,O,k]).join(", ")}]: 'h' must be between 0 and 360.`}(r,c,d,y);if(_)throw new ps(_);const v=`hsla(${r}, ${c}%, ${d}%, ${y})`,T=Di.parse(v);if(!T)throw new ps(`Failed to parse HSLA color: ${v}`);return T}function V3(u,r){return u in r}function Ob(u,r){const c=r[u];return c===void 0?null:c}function $d(u){return{type:u}}function Zh(u){if(u instanceof fp)return new Set([u.key]);let r=new Set;return u.eachChild(c=>{r=new Set([...r,...Zh(c)])}),r}function m_(u){if(u instanceof ya&&u.name==="is-active-floor")return!0;let r=!1;return u.eachChild(c=>{!r&&m_(c)&&(r=!0)}),r}function W3(u){return{result:"success",value:u}}function zd(u){return{result:"error",value:u}}function kb(u,r){return!!u&&!!u.parameters&&u.parameters.indexOf(r)>-1}function g_(u){return u["property-type"]==="data-driven"}function Db(u){return kb(u.expression,"measure-light")}function H3(u){return kb(u.expression,"zoom")}function Nb(u){return!!u.expression&&u.expression.interpolated}function y_(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function G3(u){return u}function Mb(u,r){const c=r.type==="color",d=u.stops&&typeof u.stops[0][0]=="object",p=d||!(d||u.property!==void 0),y=u.type||(Nb(r)?"exponential":"interval");if(c&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(S=>[S[0],Di.parse(S[1])])),u.default=Di.parse(u.default?u.default:r.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!F3[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let _,v,T;if(y==="exponential")_=q3;else if(y==="interval")_=KI;else if(y==="categorical"){_=_p,v=Object.create(null);for(const S of u.stops)v[S[0]]=S[1];T=typeof u.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);_=YI}if(d){const S={},O=[];for(let F=0;F<u.stops.length;F++){const $=u.stops[F],H=$[0].zoom;S[H]===void 0&&(S[H]={zoom:H,type:u.type,property:u.property,default:u.default,stops:[]},O.push(H)),S[H].stops.push([$[0].value,$[1]])}const k=[];for(const F of O)k.push([S[F].zoom,Mb(S[F],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:dc.interpolationFactor.bind(void 0,N),zoomStops:k.map(F=>F[0]),evaluate:({zoom:F},$)=>q3({stops:k,base:u.base},r,F).evaluate(F,$)}}if(p){const S=y==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:dc.interpolationFactor.bind(void 0,S),zoomStops:u.stops.map(O=>O[0]),evaluate:({zoom:O})=>_(u,r,O,v,T)}}return{kind:"source",evaluate(S,O){const k=O&&O.properties?O.properties[u.property]:void 0;return k===void 0?Pg(u.default,r.default):_(u,r,k,v,T)}}}function Pg(u,r,c){return u!==void 0?u:r!==void 0?r:c!==void 0?c:void 0}function _p(u,r,c,d,p){return Pg(typeof c===p?d[c]:void 0,u.default,r.default)}function KI(u,r,c){if(!En(c))return Pg(u.default,r.default);const d=u.stops.length;if(d===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[d-1][0])return u.stops[d-1][1];const p=o_(u.stops.map(y=>y[0]),c);return u.stops[p][1]}function q3(u,r,c){const d=u.base!==void 0?u.base:1;if(!En(c))return Pg(u.default,r.default);const p=u.stops.length;if(p===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[p-1][0])return u.stops[p-1][1];const y=o_(u.stops.map(O=>O[0]),c),_=function(O,k,N,F){const $=F-N,H=O-N;return $===0?0:k===1?H/$:(Math.pow(k,H)-1)/(Math.pow(k,$)-1)}(c,d,u.stops[y][0],u.stops[y+1][0]),v=u.stops[y][1],T=u.stops[y+1][1];let S=jh[r.type]||G3;if(u.colorSpace&&u.colorSpace!=="rgb"){const O=F3[u.colorSpace];S=(k,N)=>O.reverse(O.interpolate(O.forward(k),O.forward(N),_))}return typeof v.evaluate=="function"?{evaluate(...O){const k=v.evaluate.apply(void 0,O),N=T.evaluate.apply(void 0,O);if(k!==void 0&&N!==void 0)return S(k,N,_)}}:S(v,T,_)}function YI(u,r,c){return r.type==="color"?c=Di.parse(c):r.type==="formatted"?c=Eo.fromString(c.toString()):r.type==="resolvedImage"?c=ga.build(c.toString()):Pn(c)===r.type||r.type==="enum"&&r.values[c]||(c=void 0),Pg(c,u.default,r.default)}ya.register(qh,{error:[{kind:"error"},[Oi],(u,[r])=>{throw new ps(r.evaluate(u))}],typeof:[Oi,[Mi],(u,[r])=>Wr(xs(r.evaluate(u)))],"to-rgba":[xo(un,4),[Vo],(u,[r])=>r.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[xo(un,4),[Vo],(u,[r])=>r.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Vo,[un,un,un],Rb],rgba:[Vo,[un,un,un,un],Rb],hsl:[Vo,[un,un,un],j3],hsla:[Vo,[un,un,un,un],j3],has:{type:Ti,overloads:[[[Oi],(u,[r])=>V3(r.evaluate(u),u.properties())],[[Oi,sp],(u,[r,c])=>V3(r.evaluate(u),c.evaluate(u))]]},get:{type:Mi,overloads:[[[Oi],(u,[r])=>Ob(r.evaluate(u),u.properties())],[[Oi,sp],(u,[r,c])=>Ob(r.evaluate(u),c.evaluate(u))]]},"feature-state":[Mi,[Oi],(u,[r])=>Ob(r.evaluate(u),u.featureState||{})],properties:[sp,[],u=>u.properties()],"geometry-type":[Oi,[],u=>u.geometryType()],worldview:[Oi,[],u=>u.globals.worldview||""],"is-active-floor":[Ti,$d(Oi),(u,r)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const c=u.globals.activeFloors;return r.some(d=>{const p=d.evaluate(u);return c.has(p)})}],id:[Mi,[],u=>u.id()],zoom:[un,[],u=>u.globals.zoom],pitch:[un,[],u=>u.globals.pitch||0],"distance-from-center":[un,[],u=>u.distanceFromCenter()],"measure-light":[un,[Oi],(u,[r])=>u.measureLight(r.evaluate(u))],"heatmap-density":[un,[],u=>u.globals.heatmapDensity||0],"line-progress":[un,[],u=>u.globals.lineProgress||0],"raster-value":[un,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[un,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[un,[],u=>u.globals.skyRadialProgress||0],accumulated:[Mi,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[un,$d(un),(u,r)=>{let c=0;for(const d of r)c+=d.evaluate(u);return c}],"*":[un,$d(un),(u,r)=>{let c=1;for(const d of r)c*=d.evaluate(u);return c}],"-":{type:un,overloads:[[[un,un],(u,[r,c])=>r.evaluate(u)-c.evaluate(u)],[[un],(u,[r])=>-r.evaluate(u)]]},"/":[un,[un,un],(u,[r,c])=>r.evaluate(u)/c.evaluate(u)],"%":[un,[un,un],(u,[r,c])=>r.evaluate(u)%c.evaluate(u)],ln2:[un,[],()=>Math.LN2],pi:[un,[],()=>Math.PI],e:[un,[],()=>Math.E],"^":[un,[un,un],(u,[r,c])=>Math.pow(r.evaluate(u),c.evaluate(u))],sqrt:[un,[un],(u,[r])=>Math.sqrt(r.evaluate(u))],log10:[un,[un],(u,[r])=>Math.log(r.evaluate(u))/Math.LN10],ln:[un,[un],(u,[r])=>Math.log(r.evaluate(u))],log2:[un,[un],(u,[r])=>Math.log2(r.evaluate(u))],sin:[un,[un],(u,[r])=>Math.sin(r.evaluate(u))],cos:[un,[un],(u,[r])=>Math.cos(r.evaluate(u))],tan:[un,[un],(u,[r])=>Math.tan(r.evaluate(u))],asin:[un,[un],(u,[r])=>Math.asin(r.evaluate(u))],acos:[un,[un],(u,[r])=>Math.acos(r.evaluate(u))],atan:[un,[un],(u,[r])=>Math.atan(r.evaluate(u))],min:[un,$d(un),(u,r)=>Math.min(...r.map(c=>c.evaluate(u)))],max:[un,$d(un),(u,r)=>Math.max(...r.map(c=>c.evaluate(u)))],abs:[un,[un],(u,[r])=>Math.abs(r.evaluate(u))],round:[un,[un],(u,[r])=>{const c=r.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[un,[un],(u,[r])=>Math.floor(r.evaluate(u))],ceil:[un,[un],(u,[r])=>Math.ceil(r.evaluate(u))],"filter-==":[Ti,[Oi,Mi],(u,[r,c])=>u.properties()[r.value]===c.value],"filter-id-==":[Ti,[Mi],(u,[r])=>u.id()===r.value],"filter-type-==":[Ti,[Oi],(u,[r])=>u.geometryType()===r.value],"filter-<":[Ti,[Oi,Mi],(u,[r,c])=>{const d=u.properties()[r.value],p=c.value;return typeof d==typeof p&&d<p}],"filter-id-<":[Ti,[Mi],(u,[r])=>{const c=u.id(),d=r.value;return typeof c==typeof d&&c<d}],"filter->":[Ti,[Oi,Mi],(u,[r,c])=>{const d=u.properties()[r.value],p=c.value;return typeof d==typeof p&&d>p}],"filter-id->":[Ti,[Mi],(u,[r])=>{const c=u.id(),d=r.value;return typeof c==typeof d&&c>d}],"filter-<=":[Ti,[Oi,Mi],(u,[r,c])=>{const d=u.properties()[r.value],p=c.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[Ti,[Mi],(u,[r])=>{const c=u.id(),d=r.value;return typeof c==typeof d&&c<=d}],"filter->=":[Ti,[Oi,Mi],(u,[r,c])=>{const d=u.properties()[r.value],p=c.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[Ti,[Mi],(u,[r])=>{const c=u.id(),d=r.value;return typeof c==typeof d&&c>=d}],"filter-has":[Ti,[Mi],(u,[r])=>r.value in u.properties()],"filter-has-id":[Ti,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Ti,[xo(Oi)],(u,[r])=>r.value.indexOf(u.geometryType())>=0],"filter-id-in":[Ti,[xo(Mi)],(u,[r])=>r.value.indexOf(u.id())>=0],"filter-in-small":[Ti,[Oi,xo(Mi)],(u,[r,c])=>c.value.indexOf(u.properties()[r.value])>=0],"filter-in-large":[Ti,[Oi,xo(Mi)],(u,[r,c])=>function(d,p,y,_){for(;y<=_;){const v=y+_>>1;if(p[v]===d)return!0;p[v]>d?_=v-1:y=v+1}return!1}(u.properties()[r.value],c.value,0,c.value.length-1)],all:{type:Ti,overloads:[[[Ti,Ti],(u,[r,c])=>r.evaluate(u)&&c.evaluate(u)],[$d(Ti),(u,r)=>{for(const c of r)if(!c.evaluate(u))return!1;return!0}]]},any:{type:Ti,overloads:[[[Ti,Ti],(u,[r,c])=>r.evaluate(u)||c.evaluate(u)],[$d(Ti),(u,r)=>{for(const c of r)if(c.evaluate(u))return!0;return!1}]]},"!":[Ti,[Ti],(u,[r])=>!r.evaluate(u)],"is-supported-script":[Ti,[Oi],(u,[r])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(r.evaluate(u))}],upcase:[Oi,[Oi],(u,[r])=>r.evaluate(u).toUpperCase()],downcase:[Oi,[Oi],(u,[r])=>r.evaluate(u).toLowerCase()],concat:[Oi,$d(Mi),(u,r)=>r.map(c=>Jl(c.evaluate(u))).join("")],"resolved-locale":[Oi,[Gy],(u,[r])=>r.evaluate(u).resolvedLocale()],random:[un,[un,un,Mi],(u,r)=>{const[c,d,p]=r.map(_=>_.evaluate(u));if(c>d||c===d)return c;let y;if(typeof p=="string")y=function(_){let v=0;if(_.length===0)return v;for(let T=0;T<_.length;T++)v=(v<<5)-v+_.charCodeAt(T),v&=v;return v}(p);else{if(typeof p!="number")throw new ps(`Invalid seed input: ${p}`);y=p}return c+U3(y)()*(d-c)}]});class __{constructor(r,c,d,p,y){this.expression=r,this._warningHistory={},this._scope=d,this._options=p,this._iconImageUseTheme=y,this._evaluator=new cp(d,p,y),this._defaultValue=c?function(_){return _.type==="color"&&(y_(_.default)||Array.isArray(_.default))?new Di(0,0,0,0):_.type==="color"?Di.parse(_.default)||null:_.default===void 0?null:_.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=Zh(r),this.isIndoorDependent=m_(r)}evaluateWithoutErrorHandling(r,c,d,p,y,_,v,T){return this._evaluator.globals=r,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(r,c,d,p,y,_,v,T,S){this._evaluator||(this._evaluator=new cp(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=r,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=S||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new ps(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){const k=O;return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function Rg(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in qh}function Ud(u,r,c,d,p){const y=new s_(qh,[],r?function(v){const T={color:Vo,string:Oi,number:un,enum:Oi,boolean:Ti,formatted:op,resolvedImage:Vh};return v.type==="array"?xo(T[v.value]||Mi,v.length):T[v.type]}(r):void 0,void 0,void 0,c,d,p),_=y.parse(u,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?W3(new __(_,r,c,d,p)):zd(y.errors)}class Og{constructor(r,c,d,p){this.kind=r,this._styleExpression=c,this.isLightConstant=d,this.isLineProgressConstant=p,this.isStateDependent=r!=="constant"&&!Eg(c.expression),this.configDependencies=Zh(c.expression),this.isIndoorDependent=m_(c.expression)}evaluateWithoutErrorHandling(r,c,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,p,y,_)}evaluate(r,c,d,p,y,_,v){return this._styleExpression.evaluate(r,c,d,p,y,_,void 0,void 0,v)}}class Kh{constructor(r,c,d,p,y,_){this.kind=r,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=r!=="camera"&&!Eg(c.expression),this.isIndoorDependent=m_(c.expression),this.isLightConstant=y,this.isLineProgressConstant=_,this.configDependencies=Zh(c.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,c,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,p,y,_)}evaluate(r,c,d,p,y,_){return this._styleExpression.evaluate(r,c,d,p,y,_)}interpolationFactor(r,c,d){return this.interpolationType?dc.interpolationFactor(this.interpolationType,r,c,d):0}}function w_(u,r,c,d,p){if((u=Ud(u,r,c,d,p)).result==="error")return u;const y=u.value.expression,_=dp(y);if(!_&&!g_(r))return zd([new jo("","data expressions not supported")]);const v=hp(y,["zoom","pitch","distance-from-center"]);if(!v&&!H3(r))return zd([new jo("","zoom expressions not supported")]);const T=hp(y,["measure-light"]);if(!T&&!Db(r))return zd([new jo("","measure-light expression not supported")]);const S=hp(y,["line-progress"]);if(!S&&!function(N){return kb(N.expression,"line-progress")}(r))return zd([new jo("","line-progress expression not supported")]);const O=r.expression&&r.expression.relaxZoomRestriction,k=b_(y);return k||v||O?k instanceof jo?zd([k]):k instanceof dc&&!Nb(r)?zd([new jo("",'"interpolate" expressions cannot be used with this property')]):W3(k?new Kh(_&&S?"camera":"composite",u.value,k.labels,k instanceof dc?k.interpolation:void 0,T,S):new Og(_&&S?"constant":"source",u.value,T,S)):zd([new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class kg{constructor(r,c){this._parameters=r,this._specification=c,Object.assign(this,Mb(this._parameters,this._specification))}static deserialize(r){return new kg(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function b_(u){let r=null;if(u instanceof Wu)r=b_(u.result);else if(u instanceof Ag){for(const c of u.args)if(r=b_(c),r)break}else(u instanceof Cg||u instanceof dc)&&u.input instanceof ya&&u.input.name==="zoom"&&(r=u);return r instanceof jo||u.eachChild(c=>{const d=b_(c);d instanceof jo?r=d:r&&d&&r!==d&&(r=new jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var nu,Z3,XI=function(){if(Z3)return nu;Z3=1,nu=r;var u=3;function r(c,d,p){var y=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var _=new Int32Array(this.arrayBuffer);c=_[0],this.d=(d=_[1])+2*(p=_[2]);for(var v=0;v<this.d*this.d;v++){var T=_[u+v],S=_[u+v+1];y.push(T===S?null:_.subarray(T,S))}var O=_[u+y.length+1];this.keys=_.subarray(_[u+y.length],O),this.bboxes=_.subarray(O),this.insert=this._insertReadonly}else{this.d=d+2*p;for(var k=0;k<this.d*this.d;k++)y.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=c,this.padding=p,this.scale=d/c,this.uid=0;var N=p/d*c;this.min=-N,this.max=c+N}return r.prototype.insert=function(c,d,p,y,_){this._forEachCell(d,p,y,_,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(_)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(c,d,p,y,_,v){this.cells[_].push(v)},r.prototype.query=function(c,d,p,y,_){var v=this.min,T=this.max;if(c<=v&&d<=v&&T<=p&&T<=y&&!_)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(c,d,p,y,this._queryCell,S,{},_),S},r.prototype._queryCell=function(c,d,p,y,_,v,T,S){var O=this.cells[_];if(O!==null)for(var k=this.keys,N=this.bboxes,F=0;F<O.length;F++){var $=O[F];if(T[$]===void 0){var H=4*$;(S?S(N[H+0],N[H+1],N[H+2],N[H+3]):c<=N[H+2]&&d<=N[H+3]&&p>=N[H+0]&&y>=N[H+1])?(T[$]=!0,v.push(k[$])):T[$]=!1}}},r.prototype._forEachCell=function(c,d,p,y,_,v,T,S){for(var O=this._convertToCellCoord(c),k=this._convertToCellCoord(d),N=this._convertToCellCoord(p),F=this._convertToCellCoord(y),$=O;$<=N;$++)for(var H=k;H<=F;H++){var K=this.d*H+$;if((!S||S(this._convertFromCellCoord($),this._convertFromCellCoord(H),this._convertFromCellCoord($+1),this._convertFromCellCoord(H+1)))&&_.call(this,c,d,p,y,K,v,T,S))return}},r.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},r.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,d=u+this.cells.length+1+1,p=0,y=0;y<this.cells.length;y++)p+=this.cells[y].length;var _=new Int32Array(d+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=d,T=0;T<c.length;T++){var S=c[T];_[u+T]=v,_.set(S,v),v+=S.length}return _[u+c.length]=v,_.set(this.keys,v),_[u+c.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},nu}(),Yh=Zi(XI);const v_={};function Qt(u,r,c={}){Object.defineProperty(u,"_classRegistryKey",{value:r,writable:!1}),v_[r]={klass:u,omit:c.omit||[]}}Qt(Object,"Object"),Yh.serialize=function(u,r){const c=u.toArrayBuffer();return r&&r.add(c),{buffer:c}},Yh.deserialize=function(u){return new Yh(u.buffer)},Object.defineProperty(Yh,"name",{value:"Grid"}),Qt(Yh,"Grid"),delete Tt.prototype.constructor,Qt(Di,"Color"),Qt(Error,"Error"),Qt(Eo,"Formatted"),Qt(Zy,"FormattedSection"),Qt(lg,"AJAXError"),Qt(ga,"ResolvedImage"),Qt(kg,"StylePropertyFunction"),Qt(__,"StyleExpression",{omit:["_evaluator"]}),Qt(fa,"ImageId"),Qt(ma,"ImageVariant"),Qt(Kh,"ZoomDependentExpression"),Qt(Og,"ZoomConstantExpression"),Qt(ya,"CompoundExpression",{omit:["_evaluate"]});for(const u in qh)v_[qh[u]._classRegistryKey]||Qt(qh[u],`Expression${u}`);function Lb(u){return u&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function El(u,r){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(Lb(u)||u instanceof ImageBitmap)return r&&r.add(u),u;if(ArrayBuffer.isView(u))return r&&r.add(u.buffer),u;if(u instanceof ImageData)return r&&r.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const d of u)c.push(El(d,r));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[d,p]of u.entries())c.entries.push(El(d),El(p,r));return c}if(u instanceof Set){const c={$name:"Set"};let d=0;for(const p of u.values())c[++d]=El(p);return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,d=c._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const p=c.serialize?c.serialize(u,r):{};if(!c.serialize){for(const y in u)u.hasOwnProperty(y)&&(v_[d].omit.indexOf(y)>=0||(p[y]=El(u[y],r)));u instanceof Error&&(p.message=u.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof u)}function Hu(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||Lb(u)||u instanceof ImageBitmap||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Hu);if(typeof u=="object"){const r=u.$name||"Object";if(r==="Map"){const p=u.entries||[],y=new Map;for(let _=0;_<p.length;_+=2)y.set(Hu(p[_]),Hu(p[_+1]));return y}if(r==="Set"){const p=new Set;for(const y of Object.keys(u))y!=="$name"&&p.add(Hu(u[y]));return p}if(r==="BigInt")return BigInt(u.value);const{klass:c}=v_[r];if(!c)throw new Error(`Can't deserialize unregistered class "${r}".`);if(c.deserialize)return c.deserialize(u);const d=Object.create(c.prototype);for(const p of Object.keys(u))p!=="$name"&&(d[p]=Hu(u[p]));return d}throw new Error("can't deserialize object of type "+typeof u)}const K3=u=>u>=1536&&u<=1791,Y3=u=>u>=1872&&u<=1919,x_=u=>u>=2208&&u<=2303,E_=u=>u>=11904&&u<=12031,Bb=u=>u>=12032&&u<=12255,Fb=u=>u>=12272&&u<=12287,wp=u=>u>=12288&&u<=12351,bp=u=>u>=12352&&u<=12447,Dg=u=>u>=12448&&u<=12543,iu=u=>u>=12544&&u<=12591,X3=u=>u>=12704&&u<=12735,J3=u=>u>=12736&&u<=12783,Q3=u=>u>=12784&&u<=12799,eC=u=>u>=12800&&u<=13055,$b=u=>u>=13056&&u<=13311,vp=u=>u>=13312&&u<=19903,C_=u=>u>=19968&&u<=40959,zb=u=>u>=40960&&u<=42127,T_=u=>u>=42128&&u<=42191,tC=u=>u>=44032&&u<=55215,nC=u=>u>=63744&&u<=64255,Ub=u=>u>=64336&&u<=65023,iC=u=>u>=65040&&u<=65055,jb=u=>u>=65072&&u<=65103,rC=u=>u>=65104&&u<=65135,Vb=u=>u>=65136&&u<=65279,Wb=u=>u>=65280&&u<=65519;function Hb(u){for(const r of u)if(jd(r.charCodeAt(0)))return!0;return!1}function JI(u){for(const r of u)if(!QI(r.charCodeAt(0)))return!1;return!0}function QI(u){return!(K3(u)||Y3(u)||x_(u)||Ub(u)||Vb(u))}function sC(u){return!(u<11904||!(X3(u)||iu(u)||jb(u)||nC(u)||$b(u)||E_(u)||J3(u)||wp(u)||vp(u)||C_(u)||eC(u)||Wb(u)||bp(u)||Fb(u)||Bb(u)||Q3(u)||Dg(u)||iC(u)||T_(u)||zb(u)))}function jd(u){return!(u!==746&&u!==747&&(u<4352||!(X3(u)||iu(u)||jb(u)&&!(u>=65097&&u<=65103)||nC(u)||$b(u)||E_(u)||J3(u)||!(!wp(u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||vp(u)||C_(u)||eC(u)||(r=>r>=12592&&r<=12687)(u)||(r=>r>=43360&&r<=43391)(u)||(r=>r>=55216&&r<=55295)(u)||(r=>r>=4352&&r<=4607)(u)||tC(u)||bp(u)||Fb(u)||(r=>r>=12688&&r<=12703)(u)||Bb(u)||Q3(u)||Dg(u)&&u!==12540||!(!Wb(u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!rC(u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||(r=>r>=5120&&r<=5759)(u)||(r=>r>=6320&&r<=6399)(u)||iC(u)||(r=>r>=19904&&r<=19967)(u)||zb(u)||T_(u))))}function oC(u){return u===12312||u===12313||u===12316||u===12540||u===12448}function Gb(u){return!(jd(u)||function(r){return!!((c=>c>=128&&c<=255)(r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||(c=>c>=8192&&c<=8303)(r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||(c=>c>=8448&&c<=8527)(r)||(c=>c>=8528&&c<=8591)(r)||(c=>c>=8960&&c<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||(c=>c>=9216&&c<=9279)(r)&&r!==9251||(c=>c>=9280&&c<=9311)(r)||(c=>c>=9312&&c<=9471)(r)||(c=>c>=9632&&c<=9727)(r)||(c=>c>=9728&&c<=9983)(r)&&!(r>=9754&&r<=9759)||(c=>c>=11008&&c<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||wp(r)||Dg(r)||(c=>c>=57344&&c<=63743)(r)||jb(r)||rC(r)||Wb(r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(u))}function A_(u){return K3(u)||Y3(u)||x_(u)||Ub(u)||Vb(u)}function aC(u){return u>=1424&&u<=2303||Ub(u)||Vb(u)}function e6(u,r){return!(!r&&aC(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||(c=>c>=6016&&c<=6143)(u))}function Vd(u){for(const r of u)if(aC(r.charCodeAt(0)))return!0;return!1}const _a={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Wd=null,Wo=_a.unavailable,Hd=null;const cC=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(Wo=_a.error),Wd&&Wd(u)};function qb(){Zb.fire(new zu("pluginStateChange",{pluginStatus:Wo,pluginURL:Hd}))}const Zb=new Uu,Kb=function(){return Wo},Yb=function(){if(Wo!==_a.deferred||!Hd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wo=_a.loading,qb(),Hd&&dg({url:Hd},u=>{u?cC(u):(Wo=_a.loaded,qb())})},Cl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wo===_a.loaded||Cl.applyArabicShaping!=null,isLoading:()=>Wo===_a.loading,setState(u){Wo=u.pluginStatus,Hd=u.pluginURL},isParsing:()=>Wo===_a.parsing,isParsed:()=>Wo===_a.parsed,getPluginURL:()=>Hd};class Ui{constructor(r,c){this.zoom=r,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness,this.worldview=c.worldview,this.activeFloors=c.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(c,d){for(const p of c)if(!e6(p.charCodeAt(0),d))return!1;return!0}(r,Cl.isLoaded())}}class Ng{constructor(r,c,d,p,y){this.property=r,this.value=c,this.expression=function(_,v,T,S,O){if(y_(_))return new kg(_,v);if(Rg(_)||Array.isArray(_)&&_.length>0){const k=w_(_,v,T,S,O);if(k.result==="error")throw new Error(k.value.map(N=>`${N.key}: ${N.message}`).join(", "));return k.value}{let k=_;return typeof _=="string"&&v.type==="color"&&(k=Di.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>k}}}(c===void 0?r.specification.default:c,r.specification,d,p,y)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,c,d,p){return this.property.possiblyEvaluate(this,r,c,d,p)}}class Mg{constructor(r,c,d,p){this.property=r,this.value=new Ng(r,void 0,c,d,p)}transitioned(r,c){return new lC(this.property,this.value,c,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new lC(this.property,this.value,null,{},0)}}class xp{constructor(r,c,d,p){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=c,this._options=d,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return $n(this._values[r].value.value)}setValue(r,c){this._values.hasOwnProperty(r)||(this._values[r]=new Mg(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new Ng(this._values[r].property,c===null?void 0:$n(c),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].value.isIndoorDependent())}setTransitionOrValue(r,c){c&&(this._options=c);const d=this._properties.properties;if(r)for(const p in r){const y=r[p];if(p.endsWith("-transition")){const _=p.slice(0,-11);d[_]&&this.setTransition(_,y)}else d.hasOwnProperty(p)&&this.setValue(p,y)}}getTransition(r){return $n(this._values[r].transition)}setTransition(r,c){this._values.hasOwnProperty(r)||(this._values[r]=new Mg(this._values[r].property)),this._values[r].transition=$n(c)||void 0}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d);const p=this.getTransition(c);p!==void 0&&(r[`${c}-transition`]=p)}return r}transitioned(r,c){const d=new uC(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(r,c._values[p]);return d}untransitioned(){const r=new uC(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].untransitioned();return r}isIndoorDependent(){return this._isIndoorDependent}}class lC{constructor(r,c,d,p,y){const _=p.delay||0,v=p.duration||0;y=y||0,this.property=r,this.value=c,this.begin=y+_,this.end=this.begin+v,r.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(r,c,d){const p=r.now||0,y=this.value.possiblyEvaluate(r,c,d),_=this.prior;if(_){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return _.possiblyEvaluate(r,c,d);{const v=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,c,d),y,ae(v))}}return y}}class uC{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,c,d){const p=new Ho(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(r,c,d);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Xb{constructor(r,c,d,p){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=c,this._options=d,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return $n(this._values[r].value)}setValue(r,c){this._values[r]=new Ng(this._values[r].property,c===null?void 0:$n(c),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].isIndoorDependent())}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d)}return r}possiblyEvaluate(r,c,d,p){const y=new Ho(this._properties);for(const _ of Object.keys(this._values))y._values[_]=this._values[_].possiblyEvaluate(r,c,d,p);return y}isIndoorDependent(){return this._isIndoorDependent}}class Xh{constructor(r,c,d,p){this.property=r,this.value=c,this.parameters=d,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,c,d,p){return this.property.evaluate(this.value,this.parameters,r,c,d,p,this.iconImageUseTheme)}}class Ho{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class kt{constructor(r){this.specification=r}possiblyEvaluate(r,c){return r.expression.evaluate(c)}interpolate(r,c,d){const p=jh[this.specification.type];return p?p(r,c,d):r}}class Vt{constructor(r,c){this.specification=r,this.overrides=c}possiblyEvaluate(r,c,d,p,y){return r.expression.kind==="constant"||r.expression.kind==="camera"?new Xh(this,{kind:"constant",value:r.expression.evaluate(c,null,{},d,p,void 0,y)},c):new Xh(this,r.expression,c,y)}interpolate(r,c,d){if(r.value.kind!=="constant"||c.value.kind!=="constant")return r;if(r.value.value===void 0||c.value.value===void 0)return new Xh(this,{kind:"constant",value:void 0},r.parameters);const p=jh[this.specification.type];return p?new Xh(this,{kind:"constant",value:p(r.value.value,c.value.value,d)},r.parameters):r}evaluate(r,c,d,p,y,_,v){return r.kind==="constant"?r.value:r.evaluate(c,d,p,y,_,void 0,v)}}class Ep{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,p){return!!r.expression.evaluate(c,null,{},d,p)}interpolate(){return!1}}class Tr{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new Ui(0,{});for(const d in r){const p=r[d];p.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new Ng(p,void 0),_=this.defaultTransitionablePropertyValues[d]=new Mg(p);this.defaultTransitioningPropertyValues[d]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(c)}}}Qt(Vt,"DataDrivenProperty"),Qt(kt,"DataConstantProperty"),Qt(Ep,"ColorRampProperty");var Ke=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function dC(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function S_(u){if(Array.isArray(u))return u.map(S_);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const r={};for(const c in u)r[c]=S_(u[c]);return r}return dC(u)}function Jb(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const r of u.slice(1))if(!Jb(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Qb(u,r="",c=null,d="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jb(u)||(u=Lg(u));const p=u;let y=!0;try{y=function(O){if(!Cp(O))return O;let k=S_(O);return ev(k),k=hC(k),k}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let _=null,v=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){v=Ke[`filter_${d}`];const O=Ud(y,v,r,c);if(O.result==="error")throw new Error(O.value.map(k=>`${k.key}: ${k.message}`).join(", "));_=(k,N,F)=>O.value.evaluate(k,N,{},F)}let T=null,S=null;if(y!==p){const O=Ud(p,v,r,c);if(O.result==="error")throw new Error(O.value.map(k=>`${k.key}: ${k.message}`).join(", "));T=(k,N,F,$,H)=>O.value.evaluate(k,N,{},F,void 0,void 0,$,H),S=!dp(O.value.expression)}return{filter:_,dynamicFilter:T||void 0,needGeometry:tv(y),needFeature:!!S}}function hC(u){if(!Array.isArray(u))return u;const r=function(c){if(t6.has(c[0])){for(let d=1;d<c.length;d++)if(Cp(c[d]))return!0}return c}(u);return r===!0?r:r.map(c=>hC(c))}function ev(u){let r=!1;const c=[];if(u[0]==="case"){for(let d=1;d<u.length-1;d+=2)r=r||Cp(u[d]),c.push(u[d+1]);c.push(u[u.length-1])}else if(u[0]==="match"){r=r||Cp(u[1]);for(let d=2;d<u.length-1;d+=2)c.push(u[d+1]);c.push(u[u.length-1])}else if(u[0]==="step"){r=r||Cp(u[1]);for(let d=1;d<u.length-1;d+=2)c.push(u[d+1])}r&&(u.length=0,u.push("any",...c));for(let d=1;d<u.length;d++)ev(u[d])}function Cp(u){if(!Array.isArray(u))return!1;if((r=u[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let c=1;c<u.length;c++)if(Cp(u[c]))return!0;return!1}const t6=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function n6(u,r){return u<r?-1:u>r?1:0}function tv(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let r=1;r<u.length;r++)if(tv(u[r]))return!0;return!1}function Lg(u){if(!u)return!0;const r=u[0];return u.length<=1?r!=="any":r==="=="?ru(u[1],u[2],"=="):r==="!="?I_(ru(u[1],u[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ru(u[1],u[2],r):r==="any"?(c=u.slice(1),["any"].concat(c.map(Lg))):r==="all"?["all"].concat(u.slice(1).map(Lg)):r==="none"?["all"].concat(u.slice(1).map(Lg).map(I_)):r==="in"?nv(u[1],u.slice(2)):r==="!in"?I_(nv(u[1],u.slice(2))):r==="has"?fC(u[1]):r!=="!has"||I_(fC(u[1]));var c}function ru(u,r,c){switch(u){case"$type":return[`filter-type-${c}`,r];case"$id":return[`filter-id-${c}`,r];default:return[`filter-${c}`,u,r]}}function nv(u,r){if(r.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(c=>typeof c!=typeof r[0])?["filter-in-large",u,["literal",r.sort(n6)]]:["filter-in-small",u,["literal",r]]}}function fC(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function I_(u){return["!",u]}const Bg="";function Jh(u,r){return r?`${u}${Bg}${r}`:u}let iv;const rv=()=>iv||(iv=new Tr({"icon-size":new Vt(Ke.layout_symbol["icon-size"]),"icon-image":new Vt(Ke.layout_symbol["icon-image"]),"icon-rotate":new Vt(Ke.layout_symbol["icon-rotate"]),"icon-offset":new Vt(Ke.layout_symbol["icon-offset"]),"text-size":new Vt(Ke.layout_symbol["text-size"]),"text-rotate":new Vt(Ke.layout_symbol["text-rotate"]),"text-offset":new Vt(Ke.layout_symbol["text-offset"])}));class pC{constructor(r,c,d,p,y,_){const v=Ud(r,Ke.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=c,d){this.properties=new Ho(rv()),this.unevaluatedLayout=new Xb(rv(),p,y,_);for(const T in d)this.unevaluatedLayout.setValue(T,d[T])}}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(r){return this.unevaluatedLayout._values[r]}recalculate(r,c,d){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(r,void 0,c,d))}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.unevaluatedLayout&&(r.properties=this.unevaluatedLayout.serialize()),r}hasIconProperties(){const r=this.hasProperty("icon-image"),c=this.hasProperty("icon-size"),d=this.hasProperty("icon-offset"),p=this.hasProperty("icon-rotate");return r||c||d||p}hasTextProperties(){const r=this.hasProperty("text-size"),c=this.hasProperty("text-offset"),d=this.hasProperty("text-rotate");return r||c||d}hasProperty(r){return this.getUnevaluatedProperty(r).value!==void 0}}const mC="-transition",gC=new Set(["fill","line","background","hillshade","raster"]);class Go extends Uu{constructor(r,c,d,p,y,_){if(super(),this.id=r.id,this.fqid=Jh(this.id,d),this.type=r.type,this.scope=d,this.lut=p,this.options=y,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const v=Ud(this.filter,Ke[`filter_${r.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(r.slot&&(this.slot=r.slot),r.appearances&&this.setAppearances(r.appearances),c.layout&&(this._unevaluatedLayout=new Xb(c.layout,this.scope,y,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),c.paint){this._transitionablePaint=new xp(c.paint,this.scope,y);for(const v in r.paint)this.setPaintProperty(v,r.paint[v]);for(const v in r.layout)this.setLayoutProperty(v,r.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ho(c.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&gC.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,c){if(this.type==="custom"&&r==="visibility")return void(this.visibility=c);const d=this._unevaluatedLayout;d._properties.properties[r]&&(d.setValue(r,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...d.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||d.isIndoorDependent(),r==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(r){this.appearances=[],r.forEach(c=>{this.appearances.push(new pC(c.condition,c.name,c.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(mC)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}isPaintProperty(r){return!!this._transitionablePaint._properties.properties[r]}setPaintProperty(r,c){const d=this._transitionablePaint,p=d._properties.properties;if(r.endsWith(mC)){const k=r.slice(0,-11);return p[k]&&d.setTransition(k,c||void 0),!1}if(!p[r])return!1;const y=d._values[r],_=y.value.isDataDriven(),v=y.value;d.setValue(r,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...d.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||d.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(r);const T=d._values[r].value,S=T.isDataDriven(),O=r.endsWith("pattern")||r==="line-dasharray";return S||_||O||this._handleOverridablePaintPropertyUpdate(r,v,T)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,c,d){return null}_handleOverridablePaintPropertyUpdate(r,c,d){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map(c=>c.serialize())),bn(r,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const c=this.paint.get(r);if(c instanceof Xh&&g_(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}for(const r of this.appearances)if(!Eg(r.condition.expression))return!0;return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Qb(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(r,c,d){return{}}queryRadius(r){}queryIntersectsFeature(r,c,d,p,y,_,v,T,S,O){}}const yC={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gd{constructor(r,c){this._structArray=r,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const i6=new ArrayBuffer(0);class sr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(r,c){return r._trim(),c&&r.arrayBuffer&&c.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const c=Object.create(this.prototype);return c.arrayBuffer=r.arrayBuffer,c.length=r.length,r.arrayBuffer?c.capacity=r.arrayBuffer.byteLength/c.bytesPerElement:(c.capacity=0,c.arrayBuffer=i6),c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this._reallocCount++,this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}reserveForAdditional(r){this.reserve(this.length+r)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ii(u,r=1){let c=0,d=0;return{members:u.map(p=>{const y=yC[p.type].BYTES_PER_ELEMENT,_=c=_C(c,Math.max(r,y)),v=p.components||1;return d=Math.max(d,y),c+=y*v,{name:p.name,type:p.type,components:v,offset:_}}),size:_C(c,Math.max(d,r)),alignment:r}}function _C(u,r){return Math.ceil(u/r)*r}class qd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const p=2*r;return this.int16[p+0]=c,this.int16[p+1]=d,r}}qd.prototype.bytesPerElement=4,Qt(qd,"StructArrayLayout2i4");class Gu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,d)}emplace(r,c,d,p){const y=3*r;return this.int16[y+0]=c,this.int16[y+1]=d,this.int16[y+2]=p,r}}Gu.prototype.bytesPerElement=6,Qt(Gu,"StructArrayLayout3i6");class qu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,p)}emplace(r,c,d,p,y){const _=4*r;return this.int16[_+0]=c,this.int16[_+1]=d,this.int16[_+2]=p,this.int16[_+3]=y,r}}qu.prototype.bytesPerElement=8,Qt(qu,"StructArrayLayout4i8");class Vs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.float32[1*r+0]=c,r}}Vs.prototype.bytesPerElement=4,Qt(Vs,"StructArrayLayout1f4");class Tp extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,d)}emplace(r,c,d,p){const y=4*r,_=2*r;return this.int16[y+0]=c,this.int16[y+1]=d,this.float32[_+1]=p,r}}Tp.prototype.bytesPerElement=8,Qt(Tp,"StructArrayLayout2i1f8");class sv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,d)}emplace(r,c,d,p){const y=4*r;return this.int16[y+0]=c,this.int16[y+1]=d,this.int16[y+2]=p,r}}sv.prototype.bytesPerElement=8,Qt(sv,"StructArrayLayout3i8");class ov extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,d,p,y)}emplace(r,c,d,p,y,_){const v=5*r;return this.int16[v+0]=c,this.int16[v+1]=d,this.int16[v+2]=p,this.int16[v+3]=y,this.int16[v+4]=_,r}}ov.prototype.bytesPerElement=10,Qt(ov,"StructArrayLayout5i10");class av extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,p,y,_,v)}emplace(r,c,d,p,y,_,v,T){const S=6*r,O=12*r,k=3*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.uint8[O+4]=p,this.uint8[O+5]=y,this.uint8[O+6]=_,this.uint8[O+7]=v,this.float32[k+2]=T,r}}av.prototype.bytesPerElement=12,Qt(av,"StructArrayLayout2i4ub1f12");class Wc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,d)}emplace(r,c,d,p){const y=3*r;return this.float32[y+0]=c,this.float32[y+1]=d,this.float32[y+2]=p,r}}Wc.prototype.bytesPerElement=12,Qt(Wc,"StructArrayLayout3f12");class su extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,d,p,y)}emplace(r,c,d,p,y,_){const v=6*r,T=3*r;return this.uint16[v+0]=c,this.uint16[v+1]=d,this.uint16[v+2]=p,this.uint16[v+3]=y,this.float32[T+2]=_,r}}su.prototype.bytesPerElement=12,Qt(su,"StructArrayLayout4ui1f12");class Ap extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,p)}emplace(r,c,d,p,y){const _=4*r;return this.uint16[_+0]=c,this.uint16[_+1]=d,this.uint16[_+2]=p,this.uint16[_+3]=y,r}}Ap.prototype.bytesPerElement=8,Qt(Ap,"StructArrayLayout4ui8");class Sp extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,p,y,_)}emplace(r,c,d,p,y,_,v){const T=6*r;return this.int16[T+0]=c,this.int16[T+1]=d,this.int16[T+2]=p,this.int16[T+3]=y,this.int16[T+4]=_,this.int16[T+5]=v,r}}Sp.prototype.bytesPerElement=12,Qt(Sp,"StructArrayLayout6i12");class cv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S,O,k,N){const F=this.length;return this.resize(F+1),this.emplace(F,r,c,d,p,y,_,v,T,S,O,k,N)}emplace(r,c,d,p,y,_,v,T,S,O,k,N,F){const $=12*r;return this.int16[$+0]=c,this.int16[$+1]=d,this.int16[$+2]=p,this.int16[$+3]=y,this.uint16[$+4]=_,this.uint16[$+5]=v,this.uint16[$+6]=T,this.uint16[$+7]=S,this.int16[$+8]=O,this.int16[$+9]=k,this.int16[$+10]=N,this.int16[$+11]=F,r}}cv.prototype.bytesPerElement=24,Qt(cv,"StructArrayLayout4i4ui4i24");class lv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,p,y,_)}emplace(r,c,d,p,y,_,v){const T=10*r,S=5*r;return this.int16[T+0]=c,this.int16[T+1]=d,this.int16[T+2]=p,this.float32[S+2]=y,this.float32[S+3]=_,this.float32[S+4]=v,r}}lv.prototype.bytesPerElement=20,Qt(lv,"StructArrayLayout3i3f20");class Zd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,p)}emplace(r,c,d,p,y){const _=4*r;return this.float32[_+0]=c,this.float32[_+1]=d,this.float32[_+2]=p,this.float32[_+3]=y,r}}Zd.prototype.bytesPerElement=16,Qt(Zd,"StructArrayLayout4f16");class uv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint32[1*r+0]=c,r}}uv.prototype.bytesPerElement=4,Qt(uv,"StructArrayLayout1ul4");class hc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const p=2*r;return this.uint16[p+0]=c,this.uint16[p+1]=d,r}}hc.prototype.bytesPerElement=4,Qt(hc,"StructArrayLayout2ui4");class Fg extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S,O,k,N,F){const $=this.length;return this.resize($+1),this.emplace($,r,c,d,p,y,_,v,T,S,O,k,N,F)}emplace(r,c,d,p,y,_,v,T,S,O,k,N,F,$){const H=20*r,K=10*r;return this.int16[H+0]=c,this.int16[H+1]=d,this.int16[H+2]=p,this.int16[H+3]=y,this.int16[H+4]=_,this.float32[K+3]=v,this.float32[K+4]=T,this.float32[K+5]=S,this.float32[K+6]=O,this.int16[H+14]=k,this.uint32[K+8]=N,this.uint16[H+18]=F,this.uint16[H+19]=$,r}}Fg.prototype.bytesPerElement=40,Qt(Fg,"StructArrayLayout5i4f1i1ul2ui40");class P_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,p,y,_,v)}emplace(r,c,d,p,y,_,v,T){const S=8*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=p,this.int16[S+4]=y,this.int16[S+5]=_,this.int16[S+6]=v,this.int16[S+7]=T,r}}P_.prototype.bytesPerElement=16,Qt(P_,"StructArrayLayout3i2i2i16");class R_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,d,p,y)}emplace(r,c,d,p,y,_){const v=4*r,T=8*r;return this.float32[v+0]=c,this.float32[v+1]=d,this.float32[v+2]=p,this.int16[T+6]=y,this.int16[T+7]=_,r}}R_.prototype.bytesPerElement=16,Qt(R_,"StructArrayLayout2f1f2i16");class O_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,p,y,_)}emplace(r,c,d,p,y,_,v){const T=20*r,S=5*r;return this.uint8[T+0]=c,this.uint8[T+1]=d,this.float32[S+1]=p,this.float32[S+2]=y,this.float32[S+3]=_,this.float32[S+4]=v,r}}O_.prototype.bytesPerElement=20,Qt(O_,"StructArrayLayout2ub4f20");class ms extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,d)}emplace(r,c,d,p){const y=3*r;return this.uint16[y+0]=c,this.uint16[y+1]=d,this.uint16[y+2]=p,r}}ms.prototype.bytesPerElement=6,Qt(ms,"StructArrayLayout3ui6");class $g extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge){const me=this.length;return this.resize(me+1),this.emplace(me,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge)}emplace(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge,me){const Ee=30*r,Te=15*r,xe=60*r;return this.int16[Ee+0]=c,this.int16[Ee+1]=d,this.int16[Ee+2]=p,this.float32[Te+2]=y,this.float32[Te+3]=_,this.uint16[Ee+8]=v,this.uint16[Ee+9]=T,this.uint32[Te+5]=S,this.uint32[Te+6]=O,this.uint32[Te+7]=k,this.uint16[Ee+16]=N,this.uint16[Ee+17]=F,this.uint16[Ee+18]=$,this.float32[Te+10]=H,this.float32[Te+11]=K,this.uint8[xe+48]=q,this.uint8[xe+49]=X,this.uint8[xe+50]=te,this.uint32[Te+13]=se,this.int16[Ee+28]=ge,this.uint8[xe+58]=me,r}}$g.prototype.bytesPerElement=60,Qt($g,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ip extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge,me,Ee,Te,xe,Oe,Be,lt,it,st,_t,gt,yt){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge,me,Ee,Te,xe,Oe,Be,lt,it,st,_t,gt,yt)}emplace(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge,me,Ee,Te,xe,Oe,Be,lt,it,st,_t,gt,yt,Qe){const bt=20*r,pt=40*r,vt=80*r;return this.float32[bt+0]=c,this.float32[bt+1]=d,this.int16[pt+4]=p,this.int16[pt+5]=y,this.int16[pt+6]=_,this.int16[pt+7]=v,this.int16[pt+8]=T,this.int16[pt+9]=S,this.int16[pt+10]=O,this.int16[pt+11]=k,this.int16[pt+12]=N,this.uint16[pt+13]=F,this.uint16[pt+14]=$,this.uint16[pt+15]=H,this.uint16[pt+16]=K,this.uint16[pt+17]=q,this.uint16[pt+18]=X,this.uint16[pt+19]=te,this.uint16[pt+20]=se,this.uint16[pt+21]=ge,this.uint16[pt+22]=me,this.uint16[pt+23]=Ee,this.uint16[pt+24]=Te,this.uint16[pt+25]=xe,this.uint16[pt+26]=Oe,this.uint16[pt+27]=Be,this.uint32[bt+14]=lt,this.float32[bt+15]=it,this.float32[bt+16]=st,this.float32[bt+17]=_t,this.float32[bt+18]=gt,this.uint8[vt+76]=yt,this.uint16[pt+39]=Qe,r}}Ip.prototype.bytesPerElement=80,Qt(Ip,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class k_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,c,d,p,y,_)}emplace(r,c,d,p,y,_,v){const T=6*r;return this.float32[T+0]=c,this.float32[T+1]=d,this.float32[T+2]=p,this.float32[T+3]=y,this.float32[T+4]=_,this.float32[T+5]=v,r}}k_.prototype.bytesPerElement=24,Qt(k_,"StructArrayLayout6f24");class Qh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,d,p,y)}emplace(r,c,d,p,y,_){const v=5*r;return this.float32[v+0]=c,this.float32[v+1]=d,this.float32[v+2]=p,this.float32[v+3]=y,this.float32[v+4]=_,r}}Qh.prototype.bytesPerElement=20,Qt(Qh,"StructArrayLayout5f20");class D_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,p,y,_,v)}emplace(r,c,d,p,y,_,v,T){const S=7*r;return this.float32[S+0]=c,this.float32[S+1]=d,this.float32[S+2]=p,this.float32[S+3]=y,this.float32[S+4]=_,this.float32[S+5]=v,this.float32[S+6]=T,r}}D_.prototype.bytesPerElement=28,Qt(D_,"StructArrayLayout7f28");class dv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S,O,k){const N=this.length;return this.resize(N+1),this.emplace(N,r,c,d,p,y,_,v,T,S,O,k)}emplace(r,c,d,p,y,_,v,T,S,O,k,N){const F=11*r;return this.float32[F+0]=c,this.float32[F+1]=d,this.float32[F+2]=p,this.float32[F+3]=y,this.float32[F+4]=_,this.float32[F+5]=v,this.float32[F+6]=T,this.float32[F+7]=S,this.float32[F+8]=O,this.float32[F+9]=k,this.float32[F+10]=N,r}}dv.prototype.bytesPerElement=44,Qt(dv,"StructArrayLayout11f44");class zg extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S){const O=this.length;return this.resize(O+1),this.emplace(O,r,c,d,p,y,_,v,T,S)}emplace(r,c,d,p,y,_,v,T,S,O){const k=9*r;return this.float32[k+0]=c,this.float32[k+1]=d,this.float32[k+2]=p,this.float32[k+3]=y,this.float32[k+4]=_,this.float32[k+5]=v,this.float32[k+6]=T,this.float32[k+7]=S,this.float32[k+8]=O,r}}zg.prototype.bytesPerElement=36,Qt(zg,"StructArrayLayout9f36");class ef extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const p=2*r;return this.float32[p+0]=c,this.float32[p+1]=d,r}}ef.prototype.bytesPerElement=8,Qt(ef,"StructArrayLayout2f8");class hv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,p)}emplace(r,c,d,p,y){const _=6*r;return this.uint32[3*r+0]=c,this.uint16[_+2]=d,this.uint16[_+3]=p,this.uint16[_+4]=y,r}}hv.prototype.bytesPerElement=12,Qt(hv,"StructArrayLayout1ul3ui12");class Ug extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint16[1*r+0]=c,r}}Ug.prototype.bytesPerElement=2,Qt(Ug,"StructArrayLayout1ui2");class fv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K){const q=this.length;return this.resize(q+1),this.emplace(q,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K)}emplace(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q){const X=16*r;return this.float32[X+0]=c,this.float32[X+1]=d,this.float32[X+2]=p,this.float32[X+3]=y,this.float32[X+4]=_,this.float32[X+5]=v,this.float32[X+6]=T,this.float32[X+7]=S,this.float32[X+8]=O,this.float32[X+9]=k,this.float32[X+10]=N,this.float32[X+11]=F,this.float32[X+12]=$,this.float32[X+13]=H,this.float32[X+14]=K,this.float32[X+15]=q,r}}fv.prototype.bytesPerElement=64,Qt(fv,"StructArrayLayout16f64");class jg extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,p,y,_,v){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,d,p,y,_,v)}emplace(r,c,d,p,y,_,v,T){const S=10*r,O=5*r;return this.uint16[S+0]=c,this.uint16[S+1]=d,this.uint16[S+2]=p,this.uint16[S+3]=y,this.float32[O+2]=_,this.float32[O+3]=v,this.float32[O+4]=T,r}}jg.prototype.bytesPerElement=20,Qt(jg,"StructArrayLayout4ui3f20");class pv extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.int16[1*r+0]=c,r}}pv.prototype.bytesPerElement=2,Qt(pv,"StructArrayLayout1i2");class N_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint8[1*r+0]=c,r}}N_.prototype.bytesPerElement=1,Qt(N_,"StructArrayLayout1ub1");class wC extends Gd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wC.prototype.size=40;class bC extends Fg{get(r){return new wC(this,r)}}Qt(bC,"CollisionBoxArray");class vC extends Gd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}vC.prototype.size=60;class xC extends $g{get(r){return new vC(this,r)}}Qt(xC,"PlacedSymbolArray");class EC extends Gd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}EC.prototype.size=80;class CC extends Ip{get(r){return new EC(this,r)}}Qt(CC,"SymbolInstanceArray");class Vg extends Vs{getoffsetX(r){return this.float32[1*r+0]}}Qt(Vg,"GlyphOffsetArray");class TC extends qd{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Qt(TC,"SymbolLineVertexArray");class AC extends Gd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}AC.prototype.size=12;class Wg extends hv{get(r){return new AC(this,r)}}Qt(Wg,"FeatureIndexArray");class SC extends hc{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Qt(SC,"FillExtrusionCentroidArray");class mv extends Gd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}mv.prototype.size=6;class IC extends Gu{get(r){return new mv(this,r)}}Qt(IC,"FillExtrusionWallArray");const PC=ii([{name:"a_pos",components:2,type:"Int16"}],4),RC=ii([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),OC=ii([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class hr{constructor(r=[]){this.segments=r}_prepareSegment(r,c,d,p){let y=this.segments[this.segments.length-1];return r>hr.MAX_VERTEX_ARRAY_LENGTH&&In(`Max vertices per segment is ${hr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!y||y.vertexLength+r>hr.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:c,primitiveOffset:d,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}prepareSegment(r,c,d,p){return this._prepareSegment(r,c.length,d.length,p)}get(){return this.segments}destroy(){for(const r of this.segments)for(const c in r.vaos)r.vaos[c].destroy()}static simpleSegment(r,c,d,p){return new hr([{vertexOffset:r,primitiveOffset:c,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}function kC(u,r){return 256*(u=ve(Math.floor(u),0,255))+ve(Math.floor(r),0,255)}hr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt(hr,"SegmentVector");const DC=ii([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),r6=ii([{name:"a_pattern_b",components:4,type:"Uint16"}]),s6=ii([{name:"a_dash",components:4,type:"Uint16"}]);class Hg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,c,d,p){this.ids.push(NC(r)),this.positions.push(c,d,p)}eachPosition(r,c){const d=NC(r);let p=0,y=this.ids.length-1;for(;p<y;){const _=p+y>>1;this.ids[_]>=d?y=_:p=_+1}for(;this.ids[p]===d;)c(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(r,c){const d=new Float64Array(r.ids),p=new Uint32Array(r.positions);return gv(d,p,0,d.length-1),c&&(c.add(d.buffer),c.add(p.buffer)),{ids:d,positions:p}}static deserialize(r){const c=new Hg;let d;c.ids=r.ids,c.positions=r.positions;for(const p of c.ids)p!==d&&c.uniqueIds.push(p),d=p;return c.indexed=!0,c}}function NC(u){const r=+u;return Number.isSafeInteger(r)?r:rp(String(u))}function gv(u,r,c,d){for(;c<d;){const p=u[c+d>>1];let y=c-1,_=d+1;for(;;){do y++;while(u[y]<p);do _--;while(u[_]>p);if(y>=_)break;Gg(u,y,_),Gg(r,3*y,3*_),Gg(r,3*y+1,3*_+1),Gg(r,3*y+2,3*_+2)}_-c<d-_?(gv(u,r,c,_),c=_+1):(gv(u,r,_+1,d),d=_)}}function Gg(u,r,c){const d=u[r];u[r]=u[c],u[c]=d}Qt(Hg,"FeaturePositionMap");class Tl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,c),this.initialized=!0),!!this.location}set(r,c,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class fc extends Tl{constructor(r){super(r),this.current=0}set(r,c,d){this.fetchUniformLocation(r,c)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Xr extends Tl{constructor(r){super(r),this.current=0}set(r,c,d){this.fetchUniformLocation(r,c)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class pc extends Tl{constructor(r){super(r),this.current=[0,0]}set(r,c,d){this.fetchUniformLocation(r,c)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class qg extends Tl{constructor(r){super(r),this.current=[0,0,0]}set(r,c,d){this.fetchUniformLocation(r,c)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class M_ extends Tl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,c,d){this.fetchUniformLocation(r,c)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class MC extends Tl{constructor(r){super(r),this.current=Di.transparent.toPremultipliedRenderColor(null)}set(r,c,d){this.fetchUniformLocation(r,c)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const o6=new Float32Array(16);class Pp extends Tl{constructor(r){super(r),this.current=o6}set(r,c,d){if(this.fetchUniformLocation(r,c)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let p=1;p<16;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const WN=new Float32Array(9),m=new Float32Array(4);class a extends Tl{constructor(r){super(r),this.current=m}set(r,c,d){if(this.fetchUniformLocation(r,c)){for(let p=0;p<4;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function f(u){return[kC(255*u.r,255*u.g),kC(255*u.b,255*u.a)]}function g(u,r,c,d,p,y,_,v){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new Ui(0,{brightness:y,worldview:v}),r,c,p,d,_)==="none":u.value==="none")}class b{constructor(r,c,d,p){this.value=r,this.uniformNames=c.map(y=>`u_${y}`),this.type=d,this.context=p}setUniform(r,c,d,p,y){const _=p.constantOr(this.value);c.set(r,y,_ instanceof Di?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(r,c){return this.type==="color"?new MC(r):new Xr(r)}}class E{constructor(r,c){this.uniformNames=c.map(d=>`u_${d}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,c){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(r,c,d,p,y){let _=null;y!=="u_pattern"&&y!=="u_dash"||(_=this.pattern),y==="u_pattern_b"&&(_=this.patternTransition),y==="u_pixel_ratio"&&(_=this.pixelRatio),_&&c.set(r,y,_)}getBinding(r,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new M_(r):new Xr(r)}}class C{constructor(r,c,d,p){this.expression=r,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,c,d,p,y,_,v,T){const S=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ui(0,{brightness:_,worldview:T}),c,{},y,p,v):this.expression.kind==="constant"&&this.expression.value,k=g(this.lutExpression,c,{},p,y,_,v,T);this.paintVertexArray.resize(r),this._setPaintValue(S,r,O,k?null:this.context.lut)}updatePaintArray(r,c,d,p,y,_,v,T){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:T},d,p,void 0,y):this.expression.kind==="constant"&&this.expression.value,O=g(this.lutExpression,d,p,y,void 0,v,void 0,T);this._setPaintValue(r,c,S,O?null:this.context.lut)}_setPaintValue(r,c,d,p){if(this.type==="color"){const y=f(d.toPremultipliedRenderColor(p));for(let _=r;_<c;_++)this.paintVertexArray.emplace(_,y[0],y[1])}else{for(let y=r;y<c;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class I{constructor(r,c,d,p,y,_){this.expression=r,this.uniformNames=c.map(v=>`u_${v}_t`),this.type=d,this.useIntegerZoom=p,this.context=y,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,c,d,p,y,_,v,T){const S=this.expression.evaluate(new Ui(this.context.zoom,{brightness:_,worldview:T}),c,{},y,p,v),O=this.expression.evaluate(new Ui(this.context.zoom+1,{brightness:_,worldview:T}),c,{},y,p,v),k=g(this.lutExpression,c,{},p,y,_,v,T),N=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(N,r,S,O,k?null:this.context.lut)}updatePaintArray(r,c,d,p,y,_,v,T){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:T},d,p,void 0,y),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:T},d,p,void 0,y),k=g(this.lutExpression,d,p,y,void 0,v,void 0,T);this._setPaintValue(r,c,S,O,k?null:this.context.lut)}_setPaintValue(r,c,d,p,y){if(this.type==="color"){const _=f(d.toPremultipliedRenderColor(y)),v=f(p.toPremultipliedRenderColor(y));for(let T=r;T<c;T++)this.paintVertexArray.emplace(T,_[0],_[1],v[0],v[1])}else{for(let _=r;_<c;_++)this.paintVertexArray.emplace(_,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,c,d,p,y){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,v=ve(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);c.set(r,y,v)}getBinding(r,c){return new Xr(r)}}class R{constructor(r,c,d,p,y){this.expression=r,this.layerId=y,this.paintVertexAttributes=(d==="array"?s6:DC).members;for(let _=0;_<c.length;++_);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Ap}populatePaintArray(r,c,d,p){const y=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(y,r,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(r,c,d,p,y,_,v){this._setPaintValues(r,c,d.patterns&&d.patterns[this.layerId],_)}_setPaintValues(r,c,d,p){if(!p||!d)return;const y=p[d[0]],_=p[d[1]];if(y){if(y){const{tl:v,br:T,pixelRatio:S}=y;for(let O=r;O<c;O++)this.paintVertexArray.emplace(O,v[0],v[1],T[0],T[1],S)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:T}=_;for(let S=r;S<c;S++)this.paintTransitionVertexArray.emplace(S,v[0],v[1],T[0],T[1])}}}upload(r){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,r6.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class L{constructor(r,c,d=()=>!0){this.binders={},this._buffers=[],this.context=c;const p=[];for(const y in r.paint._values){const _=r.paint.get(y);if(y.endsWith("-use-theme")||!d(y)||!(_ instanceof Xh&&g_(_.property.specification)))continue;const v=j(y,r.type),T=_.value,S=_.property.specification.type,O=!!_.property.useIntegerZoom,k=y==="line-dasharray"||y.endsWith("pattern"),N=r.paint.get(`${y}-use-theme`),F=y==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(T.kind!=="constant"||F)if(T.kind==="source"||F||k){const $=Z(y,S,"source");this.binders[y]=k?new R(T,v,S,$,r.id):new C(T,v,S,$),p.push(`/a_${y}`)}else{const $=Z(y,S,"composite");this.binders[y]=new I(T,v,S,O,c,$),p.push(`/z_${y}`)}else this.binders[y]=k?new E(T.value,v):new b(T.value,v,S,c),p.push(`/u_${y}`);N&&(this.binders[y].lutExpression=N.value)}this.cacheKey=p.sort().join("")}getMaxValue(r){const c=this.binders[r];return c instanceof C||c instanceof I?c.maxValue:0}populatePaintArrays(r,c,d,p,y,_,v,T){for(const S in this.binders){const O=this.binders[S];O.context=this.context,(O instanceof C||O instanceof I||O instanceof R)&&O.populatePaintArray(r,c,d,p,y,_,v,T)}}setConstantPatternPositions(r,c){for(const d in this.binders){const p=this.binders[d];p instanceof E&&p.setConstantPatternPositions(r,c)}}getPatternTransitionVertexBuffer(r){const c=this.binders[r];return c instanceof R?c.paintTransitionVertexBuffer:null}updatePaintArrays(r,c,d,p,y,_,v,T,S,O){let k=!1;const N=Object.keys(r),F=N.length!==0&&!T,$=F?N:c.uniqueIds;this.context.lut=y.lut;for(const H in this.binders){const K=this.binders[H];if(K.context=this.context,(K instanceof C||K instanceof I||K instanceof R)&&K.expression&&K.expression.kind&&K.expression.kind!=="constant"&&(K.expression.isStateDependent===!0||K.expression.isLightConstant===!1)){const q=y.paint.get(H);K.expression=q.value;for(const X of $){const te=r[X.toString()];c.eachPosition(X,(se,ge,me)=>{const Ee=p.feature(se);K.updatePaintArray(ge,me,Ee,te,_,v,S,O)})}if(!F)for(const X of d.uniqueIds){const te=r[X.toString()];d.eachPosition(X,(se,ge,me)=>{const Ee=p.feature(se);K.updatePaintArray(ge,me,Ee,te,_,v,S,O)})}k=!0}}return k}defines(){const r=[];for(const c in this.binders){const d=this.binders[c];(d instanceof b||d instanceof E)&&r.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const c=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof b||p instanceof E||p instanceof I)for(const y of p.uniformNames)c.push({name:y,property:d,binding:p.getBinding(r,y)})}return c}setUniforms(r,c,d,p,y){for(const{name:_,property:v,binding:T}of d)this.binders[v].setUniform(r,T,y,p.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const c=this.binders[r];(c instanceof C||c instanceof I||c instanceof R)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof R&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(r){for(const c in this.binders){const d=this.binders[c];(d instanceof C||d instanceof I||d instanceof R)&&d.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const c=this.binders[r];(c instanceof C||c instanceof I||c instanceof R)&&c.destroy()}}}class B{constructor(r,c,d=()=>!0){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new L(p,c,d);this.needsUpload=!1,this._featureMap=new Hg,this._featureMapWithoutIds=new Hg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,c,d,p,y,_,v,T,S){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(r,c,p,y,_,v,T,S);c.id!==void 0?this._featureMap.add(c.id,d,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,c,d,p,y,_,v,T){for(const S of d)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,c,S,p,y,_,v||0,T)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const V={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function j(u,r){return V[u]||[u.replace(`${r}-`,"").replace(/-/g,"_")]}const W={"line-pattern":{source:su,composite:su},"fill-pattern":{source:su,composite:su},"fill-extrusion-pattern":{source:su,composite:su},"line-dasharray":{source:Ap,composite:Ap}},Y={color:{source:ef,composite:Zd},number:{source:Vs,composite:ef}};function Z(u,r,c){const d=W[u];return d&&d[c]||Y[r][c]}Qt(b,"ConstantBinder"),Qt(E,"PatternConstantBinder"),Qt(C,"SourceExpressionBinder"),Qt(R,"PatternCompositeBinder"),Qt(I,"CompositeExpressionBinder"),Qt(L,"ProgramConfiguration",{omit:["_buffers"]}),Qt(B,"ProgramConfigurationSet");const J=zt/Math.PI/2,ie=64,pe=[ie,32,16],fe=-J,ce=J;function Re(u,r,c,d=J){return c=_i(c),[u*Math.sin(c)*d,-r*d,u*Math.cos(c)*d]}function Ce(u,r,c){return Re(Math.cos(_i(u)),Math.sin(_i(u)),r,c)}const Se=63710088e-1,be=2*Math.PI*Se;class ye{constructor(r,c){if(isNaN(r)||isNaN(c))throw new Error(`Invalid LngLat object: (${r}, ${c})`);if(this.lng=+r,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ye(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const c=Math.PI/180,d=this.lat*c,p=r.lat*c,y=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((r.lng-this.lng)*c);return Se*Math.acos(Math.min(y,1))}toBounds(r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new Ne({lng:this.lng-d,lat:this.lat-c},{lng:this.lng+d,lat:this.lat+c})}toEcef(r){return Ce(this.lat,this.lng,J+r*J/Se)}static convert(r){if(r instanceof ye)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new ye(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new ye(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ne{constructor(r,c){r&&(c?this.setSouthWest(r).setNorthEast(c):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof ye?new ye(r.lng,r.lat):ye.convert(r),this}setSouthWest(r){return this._sw=r instanceof ye?new ye(r.lng,r.lat):ye.convert(r),this}extend(r){const c=this._sw,d=this._ne;let p,y;if(r instanceof ye)p=r,y=r;else{if(!(r instanceof Ne))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Ne.convert(r)):this.extend(ye.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(ye.convert(r)):this;if(p=r._sw,y=r._ne,!p||!y)return this}return c||d?(c.lng=Math.min(p.lng,c.lng),c.lat=Math.min(p.lat,c.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new ye(p.lng,p.lat),this._ne=new ye(y.lng,y.lat)),this}getCenter(){return new ye((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ye(this.getWest(),this.getNorth())}getSouthEast(){return new ye(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:c,lat:d}=ye.convert(r);let p=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(r){if(r)return r instanceof Ne?r:new Ne(r)}}function We(u){return be*Math.cos(u*Math.PI/180)}function Ze(u){return(180+u)/360}function tt(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Je(u,r){return u/We(r)}function mt(u){return 360*u-180}function xt(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Xe(u,r){return u*We(xt(r))}const Me=85.051129;function dt(u){return Math.cos(_i(ve(u,-85.051129,Me)))}function nt(u,r){const c=ve(r,0,25.5),d=Math.pow(2,c);return dt(u)*be/(512*d)}function St(u){return 1/Math.cos(u*Math.PI/180)}function Rt(u,r=0){const c=Math.exp(Math.PI*(1-(u.y+r/zt)/(1<<u.z)*2));return 80150034*c/(c*c+1)/zt/(1<<u.z)}class jt{constructor(r,c,d=0){this.x=+r,this.y=+c,this.z=+d}static fromLngLat(r,c=0){const d=ye.convert(r);return new jt(Ze(d.lng),tt(d.lat),Je(c,d.lat))}toLngLat(){return new ye(mt(this.x),xt(this.y))}toAltitude(){return Xe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/be*St(xt(this.y))}}function Ot(u,r,c,d,p,y,_,v,T){const S=(r+d)/2,O=(c+p)/2,k=new Tt(S,O);v(k),function(N,F,$,H,K,q){const X=$-K,te=H-q;return Math.abs((H-F)*X-($-N)*te)/Math.hypot(X,te)}(k.x,k.y,y.x,y.y,_.x,_.y)>=T?(Ot(u,r,c,S,O,y,k,v,T),Ot(u,S,O,d,p,k,_,v,T)):u.push(_)}function Mt(u,r,c){let d=u[0],p=d.x,y=d.y;r(d);const _=[d];for(let v=1;v<u.length;v++){const T=u[v],{x:S,y:O}=T;r(T),Ot(_,p,y,S,O,d,T,r,c),p=S,y=O,d=T}return _}function rn(u,r,c,d){if(d(r,c)){const p=r.add(c)._mult(.5);rn(u,r,p,d),rn(u,p,c,d)}else u.push(c)}function tn(u,r){let c=u[0];const d=[c];for(let p=1;p<u.length;p++){const y=u[p];rn(d,c,y,r),c=y}return d}const Gt=Math.pow(2,14)-1,en=-Gt-1;function hn(u,r){const c=Math.round(u.x*r),d=Math.round(u.y*r);return u.x=ve(c,en,Gt),u.y=ve(d,en,Gt),(c<u.x||c>u.x+1||d<u.y||d>u.y+1)&&In("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Cn(u,r,c){const d=u.loadGeometry(),p=u.extent,y=zt/p;if(r&&c&&c.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:v,x:T,y:S,projection:O}=c,k=N=>{const F=mt((r.x+N.x/p)/_),$=xt((r.y+N.y/p)/_),H=O.project(F,$);N.x=(H.x*v-T)*p,N.y=(H.y*v-S)*p};for(let N=0;N<d.length;N++)if(u.type!==1)d[N]=Mt(d[N],k,1);else{const F=[];for(const $ of d[N])$.x<0||$.x>=p||$.y<0||$.y>=p||(k($),F.push($));d[N]=F}}for(const _ of d)for(const v of _)hn(v,y);return d}function Vn(u,r){return{type:u.type,id:u.id,properties:u.properties,geometry:r?Cn(u):[]}}class ci{constructor(r,c,d,p,y){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=p,this._values=y,r.readFields(Dn,this,c)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const c=r.readVarint()+r.pos,d=[];let p,y=1,_=0,v=0,T=0;for(;r.pos<c;){if(_<=0){const S=r.readVarint();y=7&S,_=S>>3}if(_--,y===1||y===2)v+=r.readSVarint(),T+=r.readSVarint(),y===1&&(p&&d.push(p),p=[]),p&&p.push(new Tt(v,T));else{if(y!==7)throw new Error(`unknown command ${y}`);p&&p.push(p[0].clone())}}return p&&d.push(p),d}bbox(){const r=this._pbf;r.pos=this._geometry;const c=r.readVarint()+r.pos;let d=1,p=0,y=0,_=0,v=1/0,T=-1/0,S=1/0,O=-1/0;for(;r.pos<c;){if(p<=0){const k=r.readVarint();d=7&k,p=k>>3}if(p--,d===1||d===2)y+=r.readSVarint(),_+=r.readSVarint(),y<v&&(v=y),y>T&&(T=y),_<S&&(S=_),_>O&&(O=_);else if(d!==7)throw new Error(`unknown command ${d}`)}return[v,S,T,O]}toGeoJSON(r,c,d){const p=this.extent*Math.pow(2,d),y=this.extent*r,_=this.extent*c,v=this.loadGeometry();function T(N){return[360*(N.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+_)/p)*Math.PI))-90]}function S(N){return N.map(T)}let O;if(this.type===1){const N=[];for(const $ of v)N.push($[0]);const F=S(N);O=N.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const N=v.map(S);O=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=function($){const H=$.length;if(H<=1)return[$];const K=[];let q,X;for(let te=0;te<H;te++){const se=wi($[te]);se!==0&&(X===void 0&&(X=se<0),X===se<0?(q&&K.push(q),q=[$[te]]):q&&q.push($[te]))}return q&&K.push(q),K}(v),F=[];for(const $ of N)F.push($.map(S));O=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const k={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(k.id=this.id),k}}function Dn(u,r,c){u===1?r.id=c.readVarint():u===2?function(d,p){const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=p._keys[d.readVarint()],v=p._values[d.readVarint()];p.properties[_]=v}}(c,r):u===3?r.type=c.readVarint():u===4&&(r._geometry=c.pos)}function wi(u){let r=0;for(let c,d,p=0,y=u.length,_=y-1;p<y;_=p++)c=u[p],d=u[_],r+=(d.x-c.x)*(c.y+d.y);return r}ci.types=["Unknown","Point","LineString","Polygon"];class Ln{constructor(r,c){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Li,this,c),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const c=this._pbf.readVarint()+this._pbf.pos;return new ci(this._pbf,c,this.extent,this._keys,this._values)}}function Li(u,r,c){u===15?r.version=c.readVarint():u===1?r.name=c.readString():u===5?r.extent=c.readVarint():u===2?r._features.push(c.pos):u===3?r._keys.push(c.readString()):u===4&&r._values.push(function(d){let p=null;const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=d.readVarint()>>3;p=_===1?d.readString():_===2?d.readFloat():_===3?d.readDouble():_===4?d.readVarint64():_===5?d.readVarint():_===6?d.readSVarint():_===7?d.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(c))}class Ni{constructor(r,c){this.layers=r.readFields(Fi,{},c)}}function Fi(u,r,c){if(u===3){const d=new Ln(c,c.readVarint()+c.pos);d.length&&(r[d.name]=d)}}const li="3d_elevation_id",zn="level";class Ii{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,c){return this._valid&&r(c(this._geometry)),this}require(r,c,d){return this.get(r,!0,c,d)}optional(r,c,d){return this.get(r,!1,c,d)}success(){return this._valid}get(r,c,d,p){const y=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?d(p?p(y):y):c&&(this._valid=!1),this}}class fr{constructor(r,c){this.featureFunc=r,this.vertexFunc=c}parseFeature(r,c,d){return this.featureFunc(r,c,d)}parseVertex(r,c,d){return this.vertexFunc(r,c,d)}}const pr=new fr((u,r,c)=>u.reset(r).require(li,d=>{c.id=d}).optional("fixed_height_relative",d=>{c.constantHeight=d},ni.decodeRelativeHeight).geometry(d=>{c.bounds=d},bg).success(),(u,r,c)=>u.reset(r).require(li,d=>{c.id=d}).require("elevation_idx",d=>{c.idx=d}).require("extent",d=>{c.extent=d}).require("height_relative",d=>{c.height=d},ni.decodeRelativeHeight).geometry(d=>{c.position=d},ni.getPoint).success()),Pi=new fr((u,r,c)=>u.reset(r).require(li,d=>{c.id=d}).optional("fixed_height",d=>{c.constantHeight=d},ni.decodeMetricHeight).geometry(d=>{c.bounds=d},bg).success(),(u,r,c)=>u.reset(r).require(li,d=>{c.id=d}).require("elevation_idx",d=>{c.idx=d}).require("extent",d=>{c.extent=d}).require("height",d=>{c.height=d},ni.decodeMetricHeight).geometry(d=>{c.position=d},ni.getPoint).success());class ni{static getPoint(r){return zo(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?Pi:void 0:pr}static parse(r){const c=[],d=[],p=r.length,y=new Ii;for(let _=0;_<p;_++){const v=r.feature(_),T=v.properties.version,S=ni.getVersionSchema(T);if(S===void 0){In(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const O=v.properties.type;if(!O)continue;const k=ci.types[v.type];if(k==="Point"&&O==="curve_point"){const N={};S.parseVertex(y,v,N)&&c.push(N)}else if(k==="Polygon"&&O==="curve_meta"){const N={};S.parseFeature(y,v,N)&&d.push(N)}}return{vertices:c,features:d}}}class jn{constructor(r,c){this.pos=r,this.dir=c}intersectsPlane(r,c,d){const p=zi(c,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((r[0]-this.pos[0])*c[0]+(r[1]-this.pos[1])*c[1])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,!0}}class Ki{constructor(r,c){this.pos=r,this.dir=c}intersectsPlane(r,c,d){const p=_n(c,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((r[0]-this.pos[0])*c[0]+(r[1]-this.pos[1])*c[1]+(r[2]-this.pos[2])*c[2])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(r,c,d){if(function(F,$){var H=F[0],K=F[1],q=F[2],X=$[0],te=$[1],se=$[2];return Math.abs(H-X)<=w*Math.max(1,Math.abs(H),Math.abs(X))&&Math.abs(K-te)<=w*Math.max(1,Math.abs(K),Math.abs(te))&&Math.abs(q-se)<=w*Math.max(1,Math.abs(q),Math.abs(se))}(this.pos,r)||c===0)return d[0]=d[1]=d[2]=0,!1;const[p,y,_]=this.dir,v=this.pos[0]-r[0],T=this.pos[1]-r[1],S=this.pos[2]-r[2],O=p*p+y*y+_*_,k=2*(v*p+T*y+S*_),N=k*k-4*O*(v*v+T*T+S*S-c*c);if(N<0){const F=Math.max(-k/2,0),$=v+p*F,H=T+y*F,K=S+_*F,q=Math.hypot($,H,K);return d[0]=$*c/q,d[1]=H*c/q,d[2]=K*c/q,!1}{const F=(-k-Math.sqrt(N))/(2*O);if(F<0){const $=Math.hypot(v,T,S);return d[0]=v*c/$,d[1]=T*c/$,d[2]=S*c/$,!1}return d[0]=v+p*F,d[1]=T+y*F,d[2]=S+_*F,!0}}}class Ar{constructor(r,c,d,p,y){this.TL=r,this.TR=c,this.BR=d,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(r,c,d){const p=[-1,1,1],y=[1,1,1],_=[1,-1,1],v=[-1,-1,1],T=ui(p,p,r),S=ui(y,y,r),O=ui(_,_,r),k=ui(v,v,r);return new Ar(T,S,O,k,c/d)}}function nr(u,r,c){let d=1/0,p=-1/0;const y=[];for(const _ of u){xr(y,_,r);const v=_n(y,c);d=Math.min(d,v),p=Math.max(p,v)}return[d,p]}function or(u,r){let c=!0;for(let d=0;d<u.planes.length;d++){const p=u.planes[d];let y=0;for(let _=0;_<r.length;_++)y+=+(_n(p,r[_])+p[3]>=0);if(y===0)return 0;y!==r.length&&(c=!1)}return c?2:1}function qo(u,r){for(const c of u.projections){const d=nr(r,u.points[0],c.axis);if(c.projection[1]<d[0]||c.projection[0]>d[1])return 0}return 1}function wa(u,r){let c=0;const d=[0,0,0,0];for(let p=0;p<u.length;p++)d[0]=u[p][0],d[1]=u[p][1],d[2]=u[p][2],d[3]=1,Js(d,r)>=0&&c++;return c}class Rs{constructor(r,c){this.points=r||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=Ri.fromPoints(this.points),this.projections=[],this.frustumEdges=[xr([],this.points[2],this.points[3]),xr([],this.points[0],this.points[3]),xr([],this.points[4],this.points[0]),xr([],this.points[5],this.points[1]),xr([],this.points[6],this.points[2]),xr([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const p=[0,-d[2],d[1]],y=[d[2],0,-d[0]];this.projections.push({axis:p,projection:nr(this.points,this.points[0],p)}),this.projections.push({axis:y,projection:nr(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(r,c,d,p){const y=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const O=zs([],S,r),k=1/O[3]/c*y;return(N=O)[0]=(F=O)[0]*($=[k,k,p?1/O[3]:k,k])[0],N[1]=F[1]*$[1],N[2]=F[2]*$[2],N[3]=F[3]*$[3],N;var N,F,$}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const O=sn([],ai([],xr([],_[S[0]],_[S[1]]),xr([],_[S[2]],_[S[1]]))),k=-_n(O,_[S[1]]);return O.concat(k)}),T=[];for(let S=0;S<_.length;S++)T.push([_[S][0],_[S][1],_[S][2]]);return new Rs(T,v)}intersectsPrecise(r,c,d){for(let p=0;p<c.length;p++)if(!wa(r,c[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!wa(r,this.planes[p]))return 0;for(const p of d)for(const y of this.frustumEdges){const _=ai([],p,y),v=re(_);if(v===0)continue;Dt(_,_,1/v);const T=nr(this.points,this.points[0],_),S=nr(r,this.points[0],_);if(T[0]>S[1]||S[0]>T[1])return 0}return 1}containsPoint(r){for(const c of this.planes){const d=c[3];if(_n([c[0],c[1],c[2]],r)+d<0)return!1}return!0}}class Ri{static fromPoints(r){const c=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const p of r)Et(c,c,p),Ct(d,d,p);return new Ri(c,d)}static fromTileIdAndHeight(r,c,d){const p=1<<r.canonical.z,y=r.canonical.x,_=r.canonical.y;return new Ri([y/p,_/p,c],[(y+1)/p,(_+1)/p,d])}static applyTransform(r,c){const d=r.getCorners();for(let p=0;p<d.length;++p)ui(d[p],d[p],c);return Ri.fromPoints(d)}static applyTransformFast(r,c){const d=[c[12],c[13],c[14]],p=[...d];for(let y=0;y<3;y++)for(let _=0;_<3;_++){const v=c[4*_+y],T=v*r.min[_],S=v*r.max[_];d[y]+=Math.min(T,S),p[y]+=Math.max(T,S)}return new Ri(d,p)}static projectAabbCorners(r,c){const d=r.getCorners();for(let p=0;p<d.length;++p)ui(d[p],d[p],c);return d}constructor(r,c){this.min=r,this.max=c,this.center=Dt([],Le([],this.min,this.max),.5)}quadrant(r){const c=[r%2==0,r<2],d=Ye(this.min),p=Ye(this.max);for(let y=0;y<c.length;y++)d[y]=c[y]?this.min[y]:this.center[y],p[y]=c[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Ri(d,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,c=this.max;return[[r[0],r[1],r[2]],[c[0],r[1],r[2]],[c[0],c[1],r[2]],[r[0],c[1],r[2]],[r[0],r[1],c[2]],[c[0],r[1],c[2]],[c[0],c[1],c[2]],[r[0],c[1],c[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?or(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?or(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,c){return c||this.intersects(r)?qo(r,this.getCorners()):0}intersectsPreciseFlat(r,c){return c||this.intersectsFlat(r)?qo(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let c=0;c<3;++c)if(this.min[c]>r.max[c]||r.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],r.min[c]),this.max[c]=Math.max(this.max[c],r.max[c])}encapsulatePoint(r){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],r[c]),this.max[c]=Math.max(this.max[c],r[c])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}Qt(Ri,"Aabb");class Ma{constructor(r,c){this.feature=r,this.metersToTile=c,this.index=0}get(){const r=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,d=c[1],p=-c[0],y=(r.extent+1)*this.metersToTile;return[new Tt(Math.trunc(r.position[0]+d*y),Math.trunc(r.position[1]+p*y)),new Tt(Math.trunc(r.position[0]-d*y),Math.trunc(r.position[1]-p*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class eo{constructor(r,c,d,p,y,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Is(),Is(),Is(),Is(),Is(),Is(),Is()],this.id=r,this.heightRange={min:d,max:d},this.safeArea=c,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=y,this.edges=this.edges.filter(v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((T=this.vertices[v.a].position)[0]===(S=this.vertices[v.b].position)[0]&&T[1]===S[1]);var T,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:zo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const T=this.vertices[v.a].position,S=this.vertices[v.b].position,O=$c(Is(),S,T),k=Kl(O),N=vl(Is(),O,1/k);this.edgeProps.push({vec:O,dir:N,len:k});const F=this.vertexProps[v.a].dir,$=this.vertexProps[v.b].dir;Zl(F,F,N),Zl($,$,N)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||Yl(v.dir,v.dir);this.tessellate(_)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(r);if(c==null)return 0;const[d,p]=c;return xn(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,p)}computeSlopeNormal(r,c){const d=this.getClosestEdge(r);if(!d)return le(0,0,1);const p=d[0],y=this.edges[p],_=this.edgeProps[p].vec,v=le(_[0],_[1],(this.vertices[y.b].height-this.vertices[y.a].height)*c),T=le(v[1],-v[0],0);ai(T,T,v);const S=re(T);return S>0?Dt(T,T,1/S):Ae(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let c=0,d=Number.POSITIVE_INFINITY,p=0;const[y,_,v,T,S,O,k]=this._tmpVec2;bl(k,r.x,r.y);const N=new jn(k,null);for(let F=0;F<this.edges.length;F++){const $=this.edges[F],H=this.edgeProps[F].dir;N.dir=H;const K=this.vertices[$.a].position,q=this.vertices[$.b].position,X=N.intersectsPlane(K,this.vertexProps[$.a].dir,y),te=N.intersectsPlane(q,this.vertexProps[$.b].dir,_);if(!X||!te)continue;$c(v,_,y),$c(T,k,y);const se=zi(v,v),ge=se>0?zi(T,v)/se:0,me=ve(ge,0,1),Ee=Math.abs((ge-me)*this.edgeProps[F].len);$c(S,k,K),bl(O,H[1],-H[0]);const Te=Ee+Math.abs(zi(S,O));Te<d&&(c=F,d=Te,p=me)}return[c,p]}tessellate(r){const c=je(),d=je(),p=je(),y=je();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,T=this.edges[_].b,{position:S,height:O,extent:k}=this.vertices[v],{position:N,height:F,extent:$}=this.vertices[T],H=this.vertexProps[v].dir,K=this.vertexProps[T].dir;if(Ae(c,S[0]/r,S[1]/r,O),Ae(d,N[0]/r,N[1]/r,F),Ae(p,H[1],-H[0],0),Dt(p,p,k),Ae(y,K[1],-K[0],0),Dt(y,y,$),this.distSqLines(le(c[0]+.5*p[0],c[1]+.5*p[1],c[2]+.5*p[2]),le(d[0]-.5*y[0],d[1]-.5*y[1],d[2]-.5*y[2]),le(c[0]-.5*p[0],c[1]-.5*p[1],c[2]-.5*p[2]),le(d[0]+.5*y[0],d[1]+.5*y[1],d[2]+.5*y[2]))<=.0025000000000000005)continue;const q=this.vertices.length,X=Zl(Is(),S,N);this.vertices.push({position:vl(X,X,.5),height:.5*(O+F),extent:.5*(k+$)});const te=Zl(Is(),H,K);this.vertexProps.push({dir:Yl(te,te)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:q}),this.edges.push({a:q,b:T});const se=$c(Is(),this.vertices[q].position,S),ge=Kl(se),me={vec:se,dir:vl(Is(),se,1/ge),len:ge};this.edgeProps.push(me),this.edgeProps.push(me)}}distSqLines(r,c,d,p){const y=De(je(),c,r),_=De(je(),p,d),v=De(je(),r,d),T=_n(y,y),S=_n(y,_),O=_n(y,v),k=_n(_,_),N=_n(_,v),F=T*k-S*S;if(F===0)return yn(er(y,d,p,_n(v,_)/_n(_,_)),r);const $=(T*N-S*O)/F;return yn(er(y,r,c,(S*N-O*k)/F),er(_,d,p,$))}}class Zo{static parseFrom(r,c){const d=ni.parse(r);if(!d)return[];let{vertices:p,features:y}=d;const _=1/Rt(c);y.sort((O,k)=>O.id-k.id),p.sort((O,k)=>O.id-k.id||O.idx-k.idx),p=p.filter((O,k,N)=>k===N.findIndex(F=>F.id===O.id&&F.idx===O.idx));const v=new Array;let T=0;const S=p.length;for(const O of y){if(O.constantHeight){v.push(new eo(O.id,O.bounds,O.constantHeight));continue}for(;T!==S&&p[T].id<O.id;)T++;if(T===S||p[T].id!==O.id)continue;const k=new Array,N=new Array,F=T;for(;T!==S&&p[T].id===O.id;){const $=p[T];if(k.push({position:$.position,height:$.height,extent:$.extent}),T!==F&&p[T-1].idx===$.idx-1){const H=T-F;N.push({a:H-1,b:H})}T++}v.push(new eo(O.id,O.bounds,void 0,k,N,_))}return v}static getElevationFeature(r,c){if(!c)return;const d=+r.properties[li];return Number.isNaN(d)?void 0:c.find(p=>p.id===d)}}class Hc{constructor(r,c){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(c)||(this.zScale=Math.pow(2,c.z-r.z),this.xOffset=(r.x*this.zScale-c.x)*zt,this.yOffset=(r.y*this.zScale-c.y)*zt)}constantElevation(r,c){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,c)}pointElevation(r,c,d){const p=this.constantElevation(c,d);return p??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(r),d))}computeBiasedHeight(r,c){return c<=0?r:r+c*Ve(0,c,r>=0?r:Math.abs(.5*r))}}Qt(eo,"ElevationFeature");class Ko{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new qd,this.indexArray=new ms,this.segments=new hr,this.programConfigurations=new B(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Vs),this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,c){}updateAppearances(r,c,d,p){}populate(r,c,d,p){const y=this.layers[0],_=[];let v=null;y.type==="circle"&&(v=y.layout.get("circle-sort-key"));for(const{feature:S,id:O,index:k,sourceLayerIndex:N}of r){const F=this.layers[0]._featureFilter.needGeometry,$=Vn(S,F);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),$,d))continue;const H=v?v.evaluate($,{},d):void 0,K={id:O,properties:S.properties,type:S.type,sourceLayerIndex:N,index:k,geometry:F?$.geometry:Cn(S,d,p),patterns:{},sortKey:H};_.push(K)}v&&_.sort((S,O)=>S.sortKey-O.sortKey);let T=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Sp,T=p.projection);for(const S of _){const{geometry:O,index:k,sourceLayerIndex:N}=S,F=r[k].feature;this.addFeature(S,O,k,c.availableImages,d,T,c.brightness,c.elevationFeatures),c.featureIndex.insert(F,O,k,N,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,c,d,p,y,_,v){this.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,PC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,OC.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,RC.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,c,d,p,y,_,v,T){let S;this.elevationMode!=="none"&&(S=Zo.getElevationFeature(r,T));for(const O of c)for(const k of O){const N=k.x,F=k.y;if(N<0||N>=zt||F<0||F>=zt)continue;if(_){const K=_.projectTilePoint(N,F,y),q=_.upVector(y,N,F);this.addGlobeExtVertex(K,q),this.addGlobeExtVertex(K,q),this.addGlobeExtVertex(K,q),this.addGlobeExtVertex(K,q)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),H=$.vertexLength;if(this.addCircleVertex(N,F,-1,-1),this.addCircleVertex(N,F,1,-1),this.addCircleVertex(N,F,1,1),this.addCircleVertex(N,F,-1,1),this.elevationMode!=="none"){const K=S?S.pointElevation(new Tt(N,F)):0;this.hasElevation=this.hasElevation||K!==0;for(let q=0;q<4;q++)this.elevatedLayoutVertexArray.emplaceBack(K)}this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,{},p,y,v,void 0,this.worldview)}addCircleVertex(r,c,d,p){this.layoutVertexArray.emplaceBack(2*r+(d+1)/2,2*c+(p+1)/2)}addGlobeExtVertex(r,c){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,c[0]*16384,c[1]*16384,c[2]*16384)}}function gr(u,r){for(let c=0;c<u.length;c++)if(Ba(r,u[c]))return!0;for(let c=0;c<r.length;c++)if(Ba(u,r[c]))return!0;return!!uo(u,r)}function jr(u,r,c){return!!Ba(u,r)||!!ou(r,u,c)}function ir(u,r){if(u.length===1)return Op(r,u[0]);for(let c=0;c<r.length;c++){const d=r[c];for(let p=0;p<d.length;p++)if(Ba(u,d[p]))return!0}for(let c=0;c<u.length;c++)if(Op(r,u[c]))return!0;for(let c=0;c<r.length;c++)if(uo(u,r[c]))return!0;return!1}function Jr(u,r,c){if(u.length>1){if(uo(u,r))return!0;for(let d=0;d<r.length;d++)if(ou(r[d],u,c))return!0}for(let d=0;d<u.length;d++)if(ou(u[d],r,c))return!0;return!1}function uo(u,r){if(u.length===0||r.length===0)return!1;for(let c=0;c<u.length-1;c++){const d=u[c],p=u[c+1];for(let y=0;y<r.length-1;y++)if(Lr(d,p,r[y],r[y+1]))return!0}return!1}function Lr(u,r,c,d){return tr(u,c,d)!==tr(r,c,d)&&tr(u,r,c)!==tr(u,r,d)}function La(u,r,c){return(u.x-c.x)*(r.y-c.y)-(u.y-c.y)*(r.x-c.x)}function Zg(u,r,c,d){const p=La(u,r,d),y=La(u,r,c);if(Math.sign(p)===Math.sign(y))return;const _=La(c,d,u),v=_+y-p;return Math.sign(_)!==Math.sign(v)?[_/(_-v),y/(y-p)]:void 0}function ou(u,r,c){const d=c*c;if(r.length===1)return u.distSqr(r[0])<d;for(let p=1;p<r.length;p++)if(Rp(u,r[p-1],r[p])<d)return!0;return!1}function Rp(u,r,c){const d=r.distSqr(c);if(d===0)return u.distSqr(r);const p=((u.x-r.x)*(c.x-r.x)+(u.y-r.y)*(c.y-r.y))/d;return u.distSqr(p<0?r:p>1?c:c.sub(r)._mult(p)._add(r))}function Op(u,r){let c,d,p,y=!1;for(let _=0;_<u.length;_++){c=u[_];for(let v=0,T=c.length-1;v<c.length;T=v++)d=c[v],p=c[T],d.y>r.y!=p.y>r.y&&r.x<(p.x-d.x)*(r.y-d.y)/(p.y-d.y)+d.x&&(y=!y)}return y}function Ba(u,r){let c=!1;for(let d=0,p=u.length-1;d<u.length;p=d++){const y=u[d],_=u[p];y.y>r.y!=_.y>r.y&&r.x<(_.x-y.x)*(r.y-y.y)/(_.y-y.y)+y.x&&(c=!c)}return c}function au(u,r,c,d,p){for(const _ of u)if(r<=_.x&&c<=_.y&&d>=_.x&&p>=_.y)return!0;const y=[new Tt(r,c),new Tt(r,p),new Tt(d,p),new Tt(d,c)];if(u.length>2){for(const _ of y)if(Ba(u,_))return!0}for(let _=0;_<u.length-1;_++)if(cu(u[_],u[_+1],y))return!0;return!1}function cu(u,r,c){const d=c[0],p=c[2];if(u.x<d.x&&r.x<d.x||u.x>p.x&&r.x>p.x||u.y<d.y&&r.y<d.y||u.y>p.y&&r.y>p.y)return!1;const y=tr(u,r,c[0]);return y!==tr(u,r,c[1])||y!==tr(u,r,c[2])||y!==tr(u,r,c[3])}function mc(u,r,c,d,p,y){let _=r.y-u.y,v=u.x-r.x;if(y=y||0){const T=_*_+v*v;if(T===0)return!0;const S=Math.sqrt(T);_/=S,v/=S}return!((c.x-u.x)*_+(c.y-u.y)*v-y<0||(d.x-u.x)*_+(d.y-u.y)*v-y<0||(p.x-u.x)*_+(p.y-u.y)*v-y<0)}function Zu(u,r,c,d,p,y,_){return!(mc(u,r,d,p,y,_)||mc(r,c,d,p,y,_)||mc(c,u,d,p,y,_)||mc(d,p,u,r,c,_)||mc(p,y,u,r,c,_)||mc(y,d,u,r,c,_))}function tf(u,r,c){const d=r.paint.get(u).value;return d.kind==="constant"?d.value:c.programConfigurations.get(r.id).getMaxValue(u)}function L_(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function HN(u,r,c,d,p){if(!r[0]&&!r[1])return u;const y=Tt.convert(r)._mult(p);c==="viewport"&&y._rotate(-d);const _=[];for(let v=0;v<u.length;v++)_.push(u[v].sub(y));return _}function GN(u,r,c,d){const p=Tt.convert(u)._mult(d);return r==="viewport"&&p._rotate(-c),p}let qN,ZN;function KN(u,r,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[u*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}Qt(Ko,"CircleBucket",{omit:["layers"]});class Kg{constructor(r,c,d){this.z=r,this.x=c,this.y=d,this.key=B_(0,r,r,c,d)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const c=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>c&&r.y===this.y>>c}url(r,c){const d=function(y,_,v){var T=KN(256*y,256*(_=Math.pow(2,v)-_-1),v),S=KN(256*(y+1),256*(_+1),v);return T[0]+","+T[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),p=function(y,_,v){let T,S="";for(let O=y;O>0;O--)T=1<<O-1,S+=(_&T?1:0)+(v&T?2:0);return S}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class YN{constructor(r,c){this.wrap=r,this.canonical=c,this.key=B_(r,c.z,c.z,c.x,c.y)}}class Yo{constructor(r,c,d,p,y){this.overscaledZ=r,this.wrap=c,this.canonical=new Kg(d,+p,+y),this.key=c===0&&r===d?this.canonical.key:B_(c,r,d,p,y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const c=this.canonical.z-r;return r>this.canonical.z?new Yo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yo(r,this.wrap,r,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(r,c=!0){if(this.overscaledZ===r&&c)return this.key;if(r>this.canonical.z)return B_(this.wrap*+c,r,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-r;return B_(this.wrap*+c,r,r,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const c=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>c&&r.canonical.y===this.canonical.y>>c}children(r){if(this.overscaledZ>=r)return[new Yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new Yo(c,this.wrap,c,d,p),new Yo(c,this.wrap,c,d+1,p),new Yo(c,this.wrap,c,d,p+1),new Yo(c,this.wrap,c,d+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Yo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new YN(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function B_(u,r,c,d,p){const y=1<<Math.min(c,22);let _=y*(p%y)+d%y;return u&&c<22&&(_+=y*y*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*_+c)+(r-c)}const MJ=[u=>{let r=u.canonical.x-1,c=u.wrap;return r<0&&(r=(1<<u.canonical.z)-1,c--),new Yo(u.overscaledZ,c,u.canonical.z,r,u.canonical.y)},u=>{let r=u.canonical.x+1,c=u.wrap;return r===1<<u.canonical.z&&(r=0,c++),new Yo(u.overscaledZ,c,u.canonical.z,r,u.canonical.y)},u=>new Yo(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new Yo(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];Qt(Kg,"CanonicalTileID"),Qt(Yo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const LJ=ii([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:LC}=LJ,BJ=ii([{name:"a_pos_3",components:3,type:"Int16"}]);var XN=ii([{name:"a_pos",type:"Int16",components:2}]);function BC(u){return u*J/Se}const FJ=[new Ri([fe,fe,fe],[ce,ce,ce]),new Ri([fe,fe,fe],[0,0,ce]),new Ri([0,fe,fe],[ce,0,ce]),new Ri([fe,0,fe],[0,ce,ce]),new Ri([0,0,fe],[ce,ce,ce])];function JN(u,r,c,d=!0){const p=Dt([],u._camera.position,u.worldSize),y=[r,c,1,1];zs(y,y,u.pixelMatrixInverse),oc(y,y,1/y[3]);const _=sn([],xr([],y,p)),v=u.globeMatrix,T=[v[12],v[13],v[14]],S=xr([],T,p),O=re(S),k=sn([],S),N=u.worldSize/(2*Math.PI),F=_n(k,_),$=Math.asin(N/O);if($<Math.acos(F)){if(!d)return null;const Oe=[],Be=[];Dt(Oe,_,O/F),sn(Be,xr(Be,Oe,S)),sn(_,Le(_,S,Dt(_,Be,Math.tan($)*O)))}const H=[];new Ki(p,_).closestPointOnSphere(T,N,H);const K=sn([],mr(v,0)),q=sn([],mr(v,1)),X=sn([],mr(v,2)),te=_n(K,H),se=_n(q,H),ge=_n(X,H),me=qe(Math.asin(-se/N));let Ee=qe(Math.atan2(te,ge));Ee=u.center.lng+function(Oe,Be){const lt=(Be-Oe+180)%360-180;return lt<-180?lt+360:lt}(u.center.lng,Ee);const Te=Ze(Ee),xe=ve(tt(me),0,1);return new jt(Te,xe)}class $J{constructor(r,c,d){this.a=xr([],r,d),this.b=xr([],c,d),this.center=d;const p=sn([],this.a),y=sn([],this.b);this.angle=Math.acos(_n(p,y))}}function a6(u,r){if(u.angle===0)return null;let c;return c=u.a[r]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[r]/u.a[r]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(d,p,y,_){const v=Math.sin(y);return d*(Math.sin((1-_)*y)/v)+p*(Math.sin(_*y)/v)}(u.a[r],u.b[r],u.angle,ve(c,0,1))+u.center[r]}function Kd(u){if(u.z<=1)return FJ[u.z+2*u.y+u.x];const r=c6(FC(u));return Ri.fromPoints(r)}function nf(u,r,c){return Dt(u,u,1-c),Bt(u,u,r,c)}function QN(u,r,c){for(const d of u)ui(d,d,r),Dt(d,d,c)}function eM(u,r,c,d){const p=r/u.worldSize,y=u.globeMatrix;if(c.z<=1){const xe=Kd(c).getCorners();return QN(xe,y,p),Ri.fromPoints(xe)}const _=FC(c,d),v=c6(_,J+BC(u._tileCoverLift));QN(v,y,p);const T=Number.MAX_VALUE,S=[-T,-T,-T],O=[T,T,T];if(_.contains(u.center)){for(const Be of v)Et(O,O,Be),Ct(S,S,Be);S[2]=0;const xe=u.point,Oe=[xe.x*p,xe.y*p,0];return Et(O,O,Oe),Ct(S,S,Oe),new Ri(O,S)}if(u._tileCoverLift>0){for(const xe of v)Et(O,O,xe),Ct(S,S,xe);return new Ri(O,S)}const k=[y[12]*p,y[13]*p,y[14]*p],N=_.getCenter(),F=ve(u.center.lat,-85.051129,Me),$=ve(N.lat,-85.051129,Me),H=Ze(u.center.lng),K=tt(F);let q=H-Ze(N.lng);const X=K-tt($);q>.5?q-=1:q<-.5&&(q+=1);let te=0;Math.abs(q)>Math.abs(X)?te=q>=0?1:3:(te=X>=0?0:2,Bt(k,k,[y[4]*p,y[5]*p,y[6]*p],-Math.sin(_i(X>=0?_.getSouth():_.getNorth()))*J));const se=v[te],ge=v[(te+1)%4],me=new $J(se,ge,k),Ee=[a6(me,0)||se[0],a6(me,1)||se[1],a6(me,2)||se[2]],Te=kp(u.zoom);if(Te>0){const xe=function({x:Be,y:lt,z:it},st,_t,gt,yt){const Qe=1/(1<<it);let bt=Be*Qe,pt=bt+Qe,vt=lt*Qe,wt=vt+Qe,Zt=0;const Kt=(bt+pt)/2-gt;return Kt>.5?Zt=-1:Kt<-.5&&(Zt=1),bt=((bt+Zt)*st-(gt*=st))*_t+gt,pt=((pt+Zt)*st-gt)*_t+gt,vt=(vt*st-(yt*=st))*_t+yt,wt=(wt*st-yt)*_t+yt,[[bt,wt,0],[pt,wt,0],[pt,vt,0],[bt,vt,0]]}(c,r,u._pixelsPerMercatorPixel,H,K);for(let Be=0;Be<v.length;Be++)nf(v[Be],xe[Be],Te);const Oe=Le([],xe[te],xe[(te+1)%4]);Dt(Oe,Oe,.5),nf(Ee,Oe,Te)}for(const xe of v)Et(O,O,xe),Ct(S,S,xe);return O[2]=Math.min(se[2],ge[2]),Et(O,O,Ee),Ct(S,S,Ee),new Ri(O,S)}function FC({x:u,y:r,z:c},d=!1){const p=1/(1<<c),y=new ye(mt(u*p),r===(1<<c)-1&&d?-90:xt((r+1)*p)),_=new ye(mt((u+1)*p),r===0&&d?90:xt(r*p));return new Ne(y,_)}function c6(u,r=J){const c=_i(u.getNorth()),d=_i(u.getSouth()),p=Math.cos(c),y=Math.cos(d),_=Math.sin(c),v=Math.sin(d),T=u.getWest(),S=u.getEast();return[Re(y,v,T,r),Re(y,v,S,r),Re(p,_,S,r),Re(p,_,T,r)]}function yv(u,r,c,d){const p=1<<c.z,y=(u/zt+c.x)/p;return Ce(xt((r/zt+c.y)/p),mt(y),d)}function $C({min:u,max:r}){return 16383/Math.max(r[0]-u[0],r[1]-u[1],r[2]-u[2])}const tM=new Float64Array(16);function zC(u){const r=$C(u),c=Ue(tM,[r,r,r]);return Q(c,c,oi([],u.min))}function l6(u){const r=function(d,p){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=p[0],d[13]=p[1],d[14]=p[2],d[15]=1,d}(tM,u.min),c=1/$C(u);return de(r,r,[c,c,c])}function u6(u){const r=zt/(2*Math.PI);return u/(2*Math.PI)/r}function nM(u,r){return zt/(512*Math.pow(2,u))*$C(Kd(r))}function iM(u,r,c,d,p){const y=u6(c),_=[u,r,-c/(2*Math.PI)],v=G(new Float64Array(16));return Q(v,v,_),de(v,v,[y,y,y]),he(v,v,_i(-p)),Ie(v,v,_i(-d)),v}function kp(u){return Ve(5,6,u)}function rM(u,r){const c=Ce(r.lat,r.lng),d=function($){const H=Ce($._center.lat,$._center.lng);let K=ai([],le(0,1,0),H);const q=ze([],-$.angle,H);K=ui(K,K,q),ze(q,-$._pitch,K);const X=sn([],H);return Dt(X,X,BC($.cameraToCenterDistance/$.pixelsPerMeter)),ui(X,X,q),Le([],H,X)}(u);return _=(p=De([],d,c))[0],v=p[1],T=p[2],S=(y=c)[0],O=y[1],k=y[2],F=(N=Math.sqrt((_*_+v*v+T*T)*(S*S+O*O+k*k)))&&_n(p,y)/N,Math.acos(Math.min(Math.max(F,-1),1));var p,y,_,v,T,S,O,k,N,F}function d6(u,r){return rM(u,r)>Math.PI/2*1.01}const sM=_i(85),zJ=Math.cos(sM),UJ=Math.sin(sM),jJ=z(),oM=u=>{const r=[];return u.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function aM(u,r,c,d,p,y,_,v,T){if(y&&u.queryGeometry.isAboveHorizon)return!1;y&&(T*=u.pixelToTileUnitsFactor);const S=u.tileID.canonical,O=c.projection.upVectorScale(S,c.center.lat,c.worldSize).metersToTile;for(const k of r)for(const N of k){const F=N.add(v),$=p&&c.elevation?c.elevation.exaggeration()*p.getElevationAt(F.x,F.y,!0):0,H=c.projection.projectTilePoint(F.x,F.y,S);if($>0){const te=c.projection.upVector(S,F.x,F.y);H.x+=te[0]*O*$,H.y+=te[1]*O*$,H.z+=te[2]*O*$}const K=y?F:VJ(H.x,H.y,H.z,d),q=y?u.tilespaceRays.map(te=>HJ(te,$)):u.queryGeometry.screenGeometry,X=zs([],[H.x,H.y,H.z,1],d);if(!_&&y?T*=X[3]/c.cameraToCenterDistance:_&&!y&&(T*=c.cameraToCenterDistance/X[3]),y){const te=xt((N.y/zt+S.y)/(1<<S.z));T/=c.projection.pixelsPerMeter(te,1)/Je(1,te)}if(jr(q,K,T))return!0}return!1}function VJ(u,r,c,d){const p=zs([],[u,r,c,1],d);return new Tt(p[0]/p[3],p[1]/p[3])}const cM=le(0,0,0),WJ=le(0,0,1);function HJ(u,r){const c=je();return cM[2]=r,u.intersectsPlane(cM,WJ,c),new Tt(c[0],c[1])}class lM extends Ko{}let uM,dM,hM,fM;function pM(u,{width:r,height:c},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*c*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*c*d);return u.width=r,u.height=c,u.data=p,u}function mM(u,r,c){const{width:d,height:p}=r;d===u.width&&p===u.height||(h6(u,r,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,d),height:Math.min(u.height,p)},c,null),u.width=d,u.height=p,u.data=r.data)}function h6(u,r,c,d,p,y,_,v){if(p.width===0||p.height===0)return r;if(p.width>u.width||p.height>u.height||c.x>u.width-p.width||c.y>u.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||d.x>r.width-p.width||d.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const T=u.data,S=r.data,O=y===4&&v;for(let k=0;k<p.height;k++){const N=((c.y+k)*u.width+c.x)*y,F=((d.y+k)*r.width+d.x)*y;if(O)for(let $=0;$<p.width;$++){const H=N+$*y+3,K=F+$*y;S[K+0]=255,S[K+1]=255,S[K+2]=255,S[K+3]=T[H]}else if(_)for(let $=0;$<p.width;$++){const H=N+$*y,K=F+$*y,q=new Di(T[H+0]/255,T[H+1]/255,T[H+2]/255,T[H+3]).toNonPremultipliedRenderColor(_).toArray();S[K+0]=q[0],S[K+1]=q[1],S[K+2]=q[2],S[K+3]=q[3]}else for(let $=0;$<p.width*y;$++)S[F+$]=T[N+$]}return r}Qt(lM,"HeatmapBucket",{omit:["layers"]});class Dp{constructor(r,c){pM(this,r,1,c)}resize(r){mM(this,new Dp(r),1)}clone(){return new Dp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,p,y){h6(r,c,d,p,y,1,null)}}class ho{constructor(r,c){pM(this,r,4,c)}resize(r){mM(this,new ho(r),4)}replace(r,c){c?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,p,y,_,v){h6(r,c,d,p,y,4,_,v)}}class gM{constructor(r,c){this.width=r.width,this.height=r.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function _v(u){const r={},c=u.resolution||256,d=u.clips?u.clips.length:1,p=u.image||new ho({width:c,height:d}),y=(_,v,T)=>{r[u.evaluationKey]=T;const S=u.expression.evaluate(r),O=S?S.toNonPremultipliedRenderColor(null):null;O&&(p.data[_+v+0]=Math.floor(255*O.r),p.data[_+v+1]=Math.floor(255*O.g),p.data[_+v+2]=Math.floor(255*O.b),p.data[_+v+3]=Math.floor(255*O.a))};if(u.clips)for(let _=0,v=0;_<d;++_,v+=4*c)for(let T=0,S=0;T<c;T++,S+=4){const O=T/(c-1),{start:k,end:N}=u.clips[_];y(v,S,k*(1-O)+N*O)}else for(let _=0,v=0;_<c;_++,v+=4)y(0,v,_/(c-1));return p}Qt(Dp,"AlphaImage"),Qt(ho,"RGBAImage");const GJ=ii([{name:"a_pos",components:2,type:"Int16"}],4),qJ=ii([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ZJ=ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),KJ=ii([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function F_(u,r,c=2){const d=r&&r.length,p=d?r[0]*c:u.length;let y=yM(u,0,p,c,!0);const _=[];if(!y||y.next===y.prev)return _;let v,T,S;if(d&&(y=function(O,k,N,F){const $=[];for(let H=0,K=k.length;H<K;H++){const q=yM(O,k[H]*F,H<K-1?k[H+1]*F:O.length,F,!1);q===q.next&&(q.steiner=!0),$.push(iQ(q))}$.sort(eQ);for(let H=0;H<$.length;H++)N=tQ($[H],N);return N}(u,r,y,c)),u.length>80*c){v=u[0],T=u[1];let O=v,k=T;for(let N=c;N<p;N+=c){const F=u[N],$=u[N+1];F<v&&(v=F),$<T&&(T=$),F>O&&(O=F),$>k&&(k=$)}S=Math.max(O-v,k-T),S=S!==0?32767/S:0}return wv(y,_,c,v,T,S,0),_}function yM(u,r,c,d,p){let y;if(p===function(_,v,T,S){let O=0;for(let k=v,N=T-S;k<T;k+=S)O+=(_[N]-_[k])*(_[k+1]+_[N+1]),N=k;return O}(u,r,c,d)>0)for(let _=r;_<c;_+=d)y=vM(_/d|0,u[_],u[_+1],y);else for(let _=c-d;_>=r;_-=d)y=vM(_/d|0,u[_],u[_+1],y);return y&&$_(y,y.next)&&(xv(y),y=y.next),y}function Yg(u,r){if(!u)return u;r||(r=u);let c,d=u;do if(c=!1,d.steiner||!$_(d,d.next)&&Os(d.prev,d,d.next)!==0)d=d.next;else{if(xv(d),d=r=d.prev,d===d.next)break;c=!0}while(c||d!==r);return r}function wv(u,r,c,d,p,y,_){if(!u)return;!_&&y&&function(T,S,O,k){let N=T;do N.z===0&&(N.z=f6(N.x,N.y,S,O,k)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==T);N.prevZ.nextZ=null,N.prevZ=null,function(F){let $,H=1;do{let K,q=F;F=null;let X=null;for($=0;q;){$++;let te=q,se=0;for(let me=0;me<H&&(se++,te=te.nextZ,te);me++);let ge=H;for(;se>0||ge>0&&te;)se!==0&&(ge===0||!te||q.z<=te.z)?(K=q,q=q.nextZ,se--):(K=te,te=te.nextZ,ge--),X?X.nextZ=K:F=K,K.prevZ=X,X=K;q=te}X.nextZ=null,H*=2}while($>1)}(N)}(u,d,p,y);let v=u;for(;u.prev!==u.next;){const T=u.prev,S=u.next;if(y?XJ(u,d,p,y):YJ(u))r.push(T.i,u.i,S.i),xv(u),u=S.next,v=S.next;else if((u=S)===v){_?_===1?wv(u=JJ(Yg(u),r),r,c,d,p,y,2):_===2&&QJ(u,r,c,d,p,y):wv(Yg(u),r,c,d,p,y,1);break}}}function YJ(u){const r=u.prev,c=u,d=u.next;if(Os(r,c,d)>=0)return!1;const p=r.x,y=c.x,_=d.x,v=r.y,T=c.y,S=d.y,O=Math.min(p,y,_),k=Math.min(v,T,S),N=Math.max(p,y,_),F=Math.max(v,T,S);let $=d.next;for(;$!==r;){if($.x>=O&&$.x<=N&&$.y>=k&&$.y<=F&&bv(p,v,y,T,_,S,$.x,$.y)&&Os($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function XJ(u,r,c,d){const p=u.prev,y=u,_=u.next;if(Os(p,y,_)>=0)return!1;const v=p.x,T=y.x,S=_.x,O=p.y,k=y.y,N=_.y,F=Math.min(v,T,S),$=Math.min(O,k,N),H=Math.max(v,T,S),K=Math.max(O,k,N),q=f6(F,$,r,c,d),X=f6(H,K,r,c,d);let te=u.prevZ,se=u.nextZ;for(;te&&te.z>=q&&se&&se.z<=X;){if(te.x>=F&&te.x<=H&&te.y>=$&&te.y<=K&&te!==p&&te!==_&&bv(v,O,T,k,S,N,te.x,te.y)&&Os(te.prev,te,te.next)>=0||(te=te.prevZ,se.x>=F&&se.x<=H&&se.y>=$&&se.y<=K&&se!==p&&se!==_&&bv(v,O,T,k,S,N,se.x,se.y)&&Os(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;te&&te.z>=q;){if(te.x>=F&&te.x<=H&&te.y>=$&&te.y<=K&&te!==p&&te!==_&&bv(v,O,T,k,S,N,te.x,te.y)&&Os(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;se&&se.z<=X;){if(se.x>=F&&se.x<=H&&se.y>=$&&se.y<=K&&se!==p&&se!==_&&bv(v,O,T,k,S,N,se.x,se.y)&&Os(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function JJ(u,r){let c=u;do{const d=c.prev,p=c.next.next;!$_(d,p)&&wM(d,c,c.next,p)&&vv(d,p)&&vv(p,d)&&(r.push(d.i,c.i,p.i),xv(c),xv(c.next),c=u=p),c=c.next}while(c!==u);return Yg(c)}function QJ(u,r,c,d,p,y){let _=u;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&rQ(_,v)){let T=bM(_,v);return _=Yg(_,_.next),T=Yg(T,T.next),wv(_,r,c,d,p,y,0),void wv(T,r,c,d,p,y,0)}v=v.next}_=_.next}while(_!==u)}function eQ(u,r){let c=u.x-r.x;return c===0&&(c=u.y-r.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(r.next.y-r.y)/(r.next.x-r.x)),c}function tQ(u,r){const c=function(p,y){let _=y;const v=p.x,T=p.y;let S,O=-1/0;if($_(p,_))return _;do{if($_(p,_.next))return _.next;if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const H=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(H<=v&&H>O&&(O=H,S=_.x<_.next.x?_:_.next,H===v))return S}_=_.next}while(_!==y);if(!S)return null;const k=S,N=S.x,F=S.y;let $=1/0;_=S;do{if(v>=_.x&&_.x>=N&&v!==_.x&&_M(T<F?v:O,T,N,F,T<F?O:v,T,_.x,_.y)){const H=Math.abs(T-_.y)/(v-_.x);vv(_,p)&&(H<$||H===$&&(_.x>S.x||_.x===S.x&&nQ(S,_)))&&(S=_,$=H)}_=_.next}while(_!==k);return S}(u,r);if(!c)return r;const d=bM(c,u);return Yg(d,d.next),Yg(c,c.next)}function nQ(u,r){return Os(u.prev,u,r.prev)<0&&Os(r.next,u,u.next)<0}function f6(u,r,c,d,p){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*p|0)|u<<8))|u<<4))|u<<2))|u<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-d)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function iQ(u){let r=u,c=u;do(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next;while(r!==u);return c}function _M(u,r,c,d,p,y,_,v){return(p-_)*(r-v)>=(u-_)*(y-v)&&(u-_)*(d-v)>=(c-_)*(r-v)&&(c-_)*(y-v)>=(p-_)*(d-v)}function bv(u,r,c,d,p,y,_,v){return!(u===_&&r===v)&&_M(u,r,c,d,p,y,_,v)}function rQ(u,r){return u.next.i!==r.i&&u.prev.i!==r.i&&!function(c,d){let p=c;do{if(p.i!==c.i&&p.next.i!==c.i&&p.i!==d.i&&p.next.i!==d.i&&wM(p,p.next,c,d))return!0;p=p.next}while(p!==c);return!1}(u,r)&&(vv(u,r)&&vv(r,u)&&function(c,d){let p=c,y=!1;const _=(c.x+d.x)/2,v=(c.y+d.y)/2;do p.y>v!=p.next.y>v&&p.next.y!==p.y&&_<(p.next.x-p.x)*(v-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==c);return y}(u,r)&&(Os(u.prev,u,r.prev)||Os(u,r.prev,r))||$_(u,r)&&Os(u.prev,u,u.next)>0&&Os(r.prev,r,r.next)>0)}function Os(u,r,c){return(r.y-u.y)*(c.x-r.x)-(r.x-u.x)*(c.y-r.y)}function $_(u,r){return u.x===r.x&&u.y===r.y}function wM(u,r,c,d){const p=jC(Os(u,r,c)),y=jC(Os(u,r,d)),_=jC(Os(c,d,u)),v=jC(Os(c,d,r));return p!==y&&_!==v||!(p!==0||!UC(u,c,r))||!(y!==0||!UC(u,d,r))||!(_!==0||!UC(c,u,d))||!(v!==0||!UC(c,r,d))}function UC(u,r,c){return r.x<=Math.max(u.x,c.x)&&r.x>=Math.min(u.x,c.x)&&r.y<=Math.max(u.y,c.y)&&r.y>=Math.min(u.y,c.y)}function jC(u){return u>0?1:u<0?-1:0}function vv(u,r){return Os(u.prev,u,u.next)<0?Os(u,r,u.next)>=0&&Os(u,u.prev,r)>=0:Os(u,r,u.prev)<0||Os(u,u.next,r)<0}function bM(u,r){const c=p6(u.i,u.x,u.y),d=p6(r.i,r.x,r.y),p=u.next,y=r.prev;return u.next=r,r.prev=u,c.next=p,p.prev=c,d.next=c,c.prev=d,y.next=d,d.prev=y,d}function vM(u,r,c,d){const p=p6(u,r,c);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function xv(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function p6(u,r,c){return{i:u,x:r,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ev(u,r){const c=u.length;if(c<=1)return[u];const d=[];let p,y;for(let _=0;_<c;_++){const v=ss(u[_]);v!==0&&(u[_].area=Math.abs(v),y===void 0&&(y=v<0),y===v<0?(p&&d.push(p),p=[u[_]]):p.push(u[_]))}if(p&&d.push(p),r>1)for(let _=0;_<d.length;_++)d[_].length<=r||(Yy(d[_],r,1,d[_].length-1,sQ),d[_]=d[_].slice(0,r));return d}function sQ(u,r){return r.area-u.area}function xM(u,r,c=1){if(!u)return null;const d=typeof u=="string"?ga.from(u).getPrimary():u.getPrimary(),p=typeof u=="string"?null:u.getSecondary();for(const y of[d,p]){if(!y)continue;const _=y.id.toString();r.has(_)||r.set(_,[]),y.scaleSelf(c),r.get(_).push(y)}return{primary:d.toString(),secondary:p?p.toString():null}}function m6(u,r,c,d){const p=d.patternDependencies;let y=!1;for(const _ of r){const v=_.paint.get(`${u}-pattern`);v.isConstant()||(y=!0),xM(v.constantOr(null),p,c)&&(y=!0)}return y}function g6(u,r,c,d,p,y){const _=y.patternDependencies;for(const v of r){const T=v.paint.get(`${u}-pattern`).value;if(T.kind!=="constant"){let S=T.evaluate({zoom:d},c,{},y.availableImages);S=S&&S.name?S.name:S;const O=xM(S,_,p);if(!O)continue;const{primary:k,secondary:N}=O;k&&(c.patterns[v.id]=[k,N].filter(Boolean))}}return c}class rf{constructor(){this.portals=[]}static isOnBorder(r,c){return r<=0&&c<=0||r>=zt&&c>=zt}static evaluate(r){if(r.length===0)return new rf;let c=[];for(const T of r)c.push(...T.portals);if(c.length===0)return new rf;for(const T of c){const S=T.va,O=T.vb;(rf.isOnBorder(S.x,O.x)||rf.isOnBorder(S.y,O.y))&&(T.type="border")}const d=c.filter(T=>T.type!=="unevaluated"),p=c.filter(T=>T.type==="unevaluated");if(p.length===0)return new rf;p.sort((T,S)=>T.hash===S.hash?T.isTunnel===S.isTunnel?0:T.isTunnel?-1:1:T.hash<S.hash?1:-1),c=d.concat(p);let y=d.length,_=y,v=y;do if(_++,_===c.length||c[y].hash!==c[_].hash){if(_-y===2){v<y&&(c[v]=c[y],c[y]=null);const T=c[v],S=c[_-1];T.type=T.isTunnel!==S.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:S.connection.a},v++}y=_}while(y!==c.length);return c.splice(v),c.sort((T,S)=>T.hash<S.hash?1:-1),{portals:c}}}Qt(rf,"ElevationPortalGraph");class oQ{constructor(r,c,d){this.outPositions=r,this.outNormals=c,this.outIndices=d,this.vertexLookup=new Map}addVertex(r,c,d){let p=r[2];d!=null&&(p*=d);const y=`${r[0]},${r[1]},${r[2]},${c[0]},${c[1]},${c[2]}`,_=this.vertexLookup.get(y);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(y,v);const T=Math.trunc(16384*c[0]),S=Math.trunc(16384*c[1]),O=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(r[0],r[1],p),this.outNormals.emplaceBack(T,S,O),v}addTriangle(r,c,d){this.outIndices.emplaceBack(r,c,d)}addTriangles(r,c,d){if(r.length===0)return;const p=d.length===1,y=je(),_=je();for(let v=0;v<r.length;v+=3){const T=c[r[v+0]],S=c[r[v+1]],O=c[r[v+2]],k=p?d[0]:d[r[v+1]],N=p?d[0]:d[r[v+2]];Ae(y,T.x,T.y,p?d[0]:d[r[v+0]]);const F=this.addVertex(y,_);Ae(y,S.x,S.y,k);const $=this.addVertex(y,_);Ae(y,O.x,O.y,N);const H=this.addVertex(y,_);this.outIndices.emplaceBack(F,$,H)}}addQuad(r,c,d,p,y,_){const v=this.addVertex(r,y,_),T=this.addVertex(c,y,_),S=this.addVertex(d,y,_),O=this.addVertex(p,y,_);this.addTriangle(v,T,S),this.addTriangle(S,O,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class gc{constructor(r,c,d,p){this.unevaluatedPortals=new rf,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Tp,this.vertexNormals=new sv,this.indexArray=new ms,this.tileToMeters=Rt(r),this.bridgeProgramConfigurations=new B(c,{zoom:d,lut:p},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new B(c,{zoom:d,lut:p},y=>y!=="fill-bridge-guard-rail-color")}addVertices(r,c){const d=this.unevalVertices.length;for(let p=0;p<r.length;p++)this.unevalVertices.push(r[p]),this.unevalHeights.push(c[p]);return d}addTriangles(r,c,d){const p=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of r)p.push(y+c)}addRenderableRing(r,c,d,p,y,_){const v=[new Tt(y.min.x,y.min.y),new Tt(y.max.x,y.min.y),new Tt(y.max.x,y.max.y),new Tt(y.min.x,y.max.y)];for(let T=0;T<d-1;T++){const S=c+T,O=S+1,k=this.unevalVertices[S],N=this.unevalVertices[O];if(!(k.x>=y.min.x&&k.x<=y.max.x&&k.y>=y.min.y&&k.y<=y.max.y||N.x>=y.min.x&&N.x<=y.max.x&&N.y>=y.min.y&&N.y<=y.max.y||cu(k,N,v))||this.isOnBorder(k.x,N.x)||this.isOnBorder(k.y,N.y))continue;const F=gc.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[O]);let $,H=this.vertexHashLookup.get(gc.computePosHash(k));H!=null?$=H.next:(H=this.vertexHashLookup.get(gc.computePosHash(N)),$=H!=null?H.prev:F),this.unevalEdges.push({polygonIdx:r,a:S,b:O,hash:F,portalHash:$,isTunnel:p,type:"unevaluated",featureInfo:_})}}addPortalCandidates(r,c,d,p,y){if(c.length!==0){this.vertexHashLookup.clear();for(const _ of c){if(_.length===0)continue;const v=_[0];let T=gc.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let S=0;S<v.length-1;S++){const O=v[S+0],k=v[S+1],N=zo(k.x-O.x,k.y-O.y),F=Kl(N);if(F===0)continue;let $="unevaluated";const H=p.pointElevation(O),K=p.pointElevation(k);Math.abs(H)<.01&&Math.abs(K)<.01?$="entrance":(this.isOnBorder(O.x,k.x)||this.isOnBorder(O.y,k.y))&&($="border");const q=gc.computeEdgeHash(O,k);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:O,vb:k,vab:N,length:F,hash:q,isTunnel:d,type:$});const X=gc.computePosHash(O);this.vertexHashLookup.set(X,{prev:T,next:q}),T=q}}}}construct(r){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},p=new oQ(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const y=c(),_=c(),v=c(),T=(N,F)=>{N.sort((H,K)=>H.type===F&&K.type!==F?-1:H.type!==F&&K.type===F?1:0);const $=N.findIndex(H=>H.type!==F);return $>=0?$:N.length};let S=0;this.unevalEdges.length>0&&(S=T(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),d(v);const O=c(),k=c();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(S),F=T(N,"tunnel")+S;this.unevalEdges.push(...N),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:F})}d(O),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(k),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(_),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(y),this.maskSegments=hr.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.depthSegments=hr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=hr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=hr.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.shadowCasterSegments=hr.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(r,c,d,p,y,_,v,T){this.bridgeProgramConfigurations.updatePaintArrays(r,c,y,d,p,_,v,T),this.tunnelProgramConfigurations.updatePaintArrays(r,c,y,d,p,_,v,T)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,ZJ.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,KJ.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,c,d,p,y){const _=(v,T)=>{for(let S=0;S<T.length-1;S++){const O=T[S].featureIndex,k=T[S+1].vertexStart,N=r.feature(O);v.populatePaintArrays(k,N,O,{},d,c,p,void 0,y)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,c,d,p,y){const _=new Map;for(let v=p;v<y;v++){const T=d[v],S=T.a,O=T.b,k=gc.computePosHash(r[S]),N=gc.computePosHash(r[O]);let F=_.get(k);F||(F={},_.set(k,F));let $=_.get(N);$||($={},_.set(N,$)),c[S]<=0&&c[O]<=0||(F.to=O,$.from=S)}return _}isTerminalVertex(r,c){const d=gc.computePosHash(this.unevalVertices[r]),p=c.get(d);return!p||!p.from||!p.to}constructBridgeStructures(r,c,d,p,y,_){r.clearVertexLookup();const v=this.computeVertexConnections(c,d,p,y.min,y.max),T=1/_,S=.5*T,O=(_t,gt)=>Ae(_t,c[gt].x,c[gt].y,d[gt]*T),k=je(),N=je(),F=je(),$=je(),H=je(),K=(_t,gt)=>{const yt=v.get(gc.computePosHash(c[gt])),Qe=yt.from,bt=yt.to;if(!Qe||!bt)return;O(k,Qe),O(N,gt),O(F,bt),Xs($),la(k,N)||(xr(H,N,k),sn($,H)),la(F,N)||(xr(H,F,N),Le($,$,sn(H,H)));const pt=Ra($);return pt>0?Dt(_t,$,1/pt):void 0};let q=Number.POSITIVE_INFINITY;this.sortSubarray(p,y.min,y.max,(_t,gt)=>_t.featureInfo.featureIndex-gt.featureInfo.featureIndex);const X=je(),te=je(),se=je(),ge=je(),me=je(),Ee=je(),Te=je(),xe=je(),Oe=je(),Be=[je(),je(),je(),je()],lt=[je(),je(),je(),je()],it=[{coord:new Tt(0,0),height:0},{coord:new Tt(0,0),height:0}],st=(_t,gt)=>_t>gt;for(let _t=y.min;_t<y.max;_t++){const gt=p[_t];if(!gt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(it,c,d,gt,st))continue;const[yt,Qe]=it;if(Ae(X,yt.coord.x,yt.coord.y,T*yt.height),Ae(te,Qe.coord.x,Qe.coord.y,T*Qe.height),la(X,te))continue;xr(se,te,X),sn(se,se);const bt=K(xe,gt.a)||se,pt=K(Oe,gt.b)||se;Ae(ge,bt[1],-bt[0],0),sn(ge,ge),Ae(me,pt[1],-pt[0],0),sn(me,me),ai(xe,ge,bt),sn(Ee,xe),ai(xe,me,pt),sn(Te,xe),Le(Be[0],X,Dt(xe,xr(xe,ge,Ee),S)),Le(Be[1],X,Dt(xe,Le(xe,ge,Ee),S)),Le(Be[2],X,Dt(xe,Ee,S)),Be[3]=X,Le(lt[0],te,Dt(xe,xr(xe,me,Te),S)),Le(lt[1],te,Dt(xe,Le(xe,me,Te),S)),Le(lt[2],te,Dt(xe,Te,S)),lt[3]=te,q=this.addFeatureSection(gt.featureInfo.featureIndex,q,this.bridgeFeatureSections,r);const vt=r.addVertex(Be[0],ge,_),wt=r.addVertex(Be[1],ge,_),Zt=r.addVertex(lt[0],me,_),Kt=r.addVertex(lt[1],me,_);r.addTriangle(vt,wt,Zt),r.addTriangle(wt,Kt,Zt);const $t=r.addVertex(Be[1],Ee,_),Ut=r.addVertex(Be[2],Ee,_),gn=r.addVertex(lt[1],Te,_),an=r.addVertex(lt[2],Te,_);r.addTriangle($t,Ut,gn),r.addTriangle(Ut,an,gn),oi(ge,ge),oi(me,me);const Wt=r.addVertex(Be[2],ge,_),Rn=r.addVertex(Be[3],ge,_),Qn=r.addVertex(lt[2],me,_),Ai=r.addVertex(lt[3],me,_);r.addTriangle(Wt,Rn,Qn),r.addTriangle(Rn,Ai,Qn);const Xn=this.isTerminalVertex(gt.a,v),ji=this.isTerminalVertex(gt.b,v);yt.height<.01&&Xn&&r.addQuad(Be[3],Be[2],Be[1],Be[0],oi(bt,bt),_),Qe.height<.01&&ji&&r.addQuad(lt[0],lt[1],lt[2],lt[3],pt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,c,d,p,y,_){r.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const T=(q,X)=>q.featureInfo.featureIndex-X.featureInfo.featureIndex;this.sortSubarray(p,y.min,y.max,T),this.sortSubarray(p,_.min,_.max,T);const S=q=>sn(q,q),O=[{coord:new Tt(0,0),height:0},{coord:new Tt(0,0),height:0}],k=(q,X)=>q<X,N=je(),F=je(),$=je(),H=je(),K=je();for(let q=y.min;q<y.max;q++){if(!this.prepareEdgePoints(O,c,d,p[q],k))continue;const[X,te]=O,se=S(Ae(K,-(te.coord.y-X.coord.y),te.coord.x-X.coord.x,0));v=this.addFeatureSection(p[q].featureInfo.featureIndex,v,this.tunnelFeatureSections,r),r.addQuad(Ae(N,X.coord.x,X.coord.y,X.height),Ae(F,te.coord.x,te.coord.y,te.height),Ae($,te.coord.x,te.coord.y,p[q].isTunnel?-.1:0),Ae(H,X.coord.x,X.coord.y,p[q].isTunnel?-.1:0),se)}for(let q=_.min;q<_.max;q++){const X=p[q];X.isTunnel&&([X.a,X.b]=[X.b,X.a]);const te=c[X.a],se=c[X.b],ge=S(Ae(K,-(se.y-te.y),se.x-te.x,0));v=this.addFeatureSection(X.featureInfo.featureIndex,v,this.tunnelFeatureSections,r),r.addQuad(Ae(N,se.x,se.y,0),Ae(F,te.x,te.y,0),Ae($,te.x,te.y,d[X.a]+4),Ae(H,se.x,se.y,d[X.b]+4),ge),r.addQuad(Ae(N,te.x,te.y,0),Ae(F,se.x,se.y,0),Ae($,se.x,se.y,d[X.b]+4),Ae(H,te.x,te.y,d[X.a]+4),ge)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,c,d,p){r.coord.x=c,r.coord.y=d,r.height=p}prepareEdgePoints(r,c,d,p,y){let _=c[p.a].x,v=c[p.a].y,T=c[p.b].x,S=c[p.b].y,O=d[p.a],k=d[p.b];const N=y(O,0),F=y(k,0);if(N&&F)return this.setElevatedPoint(r[0],_,v,O),this.setElevatedPoint(r[1],T,S,k),!0;if(!N&&!F)return!1;if(N){if(!F){const $=k/(k-O);T=xn(T,_,$),S=xn(S,v,$),k=xn(k,O,$)}}else{const $=O/(O-k);_=xn(_,T,$),v=xn(v,S,$),O=xn(O,k,$)}return this.setElevatedPoint(r[0],_,v,O),this.setElevatedPoint(r[1],T,S,k),!0}prepareEdges(r,c){if(c.length===0)return;c.sort((v,T)=>v.hash===T.hash?T.polygonIdx-v.polygonIdx:T.hash>v.hash?1:-1);let d=0,p=0,y=0,_=c[d].polygonIdx;do p++,(p===c.length||c[d].hash!==c[p].hash)&&((p-d===1||c[p-1].polygonIdx!==_)&&(y<d&&(c[y]=c[d],c[d]=null),c[y].type="none",y++),d=p,d!==c.length&&(_=c[d].polygonIdx));while(d!==c.length);if(c.splice(y),c.length!==0&&r.length!==0){c.sort((S,O)=>S.portalHash<O.portalHash?1:-1);let v=0,T=0;for(;v!==c.length&&T!==r.length;){const S=c[v],O=r[T];S.portalHash>O.hash?v++:O.hash>S.portalHash?T++:(S.type=O.type,v++)}}}isOnBorder(r,c){return r<=0&&c<=0||r>=zt&&c>=zt}addFeatureSection(r,c,d,p){return r!==c&&(c=r,d.push({featureIndex:r,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),c}sortSubarray(r,c,d,p){const y=r.slice(c,d);y.sort(p),r.splice(c,y.length,...y)}static computeEdgeHash(r,c){return(r.y===c.y&&r.x>c.x||r.y>c.y)&&([r,c]=[c,r]),BigInt(gc.computePosHash(r))<<32n|BigInt(gc.computePosHash(c))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}function aQ(u,r){return u>r?1:u<r?-1:0}class y6{constructor(r=aQ,c=!1){this._compare=r,this._root=null,this._size=0,this._noDuplicates=!!c}rotateLeft(r){var c=r.right;c&&(r.right=c.left,c.left&&(c.left.parent=r),c.parent=r.parent),r.parent?r===r.parent.left?r.parent.left=c:r.parent.right=c:this._root=c,c&&(c.left=r),r.parent=c}rotateRight(r){var c=r.left;c&&(r.left=c.right,c.right&&(c.right.parent=r),c.parent=r.parent),r.parent?r===r.parent.left?r.parent.left=c:r.parent.right=c:this._root=c,c&&(c.right=r),r.parent=c}_splay(r){for(;r.parent;){var c=r.parent;c.parent?c.left===r&&c.parent.left===c?(this.rotateRight(c.parent),this.rotateRight(c)):c.right===r&&c.parent.right===c?(this.rotateLeft(c.parent),this.rotateLeft(c)):c.left===r&&c.parent.right===c?(this.rotateRight(c),this.rotateLeft(c)):(this.rotateLeft(c),this.rotateRight(c)):c.left===r?this.rotateRight(c):this.rotateLeft(c)}}splay(r){for(var c,d,p,y,_;r.parent;)(d=(c=r.parent).parent)&&d.parent?((p=d.parent).left===d?p.left=r:p.right=r,r.parent=p):(r.parent=null,this._root=r),y=r.left,_=r.right,r===c.left?(d&&(d.left===c?(c.right?(d.left=c.right,d.left.parent=d):d.left=null,c.right=d,d.parent=c):(y?(d.right=y,y.parent=d):d.right=null,r.left=d,d.parent=r)),_?(c.left=_,_.parent=c):c.left=null,r.right=c,c.parent=r):(d&&(d.right===c?(c.left?(d.right=c.left,d.right.parent=d):d.right=null,c.left=d,d.parent=c):(_?(d.left=_,_.parent=d):d.left=null,r.right=d,d.parent=r)),y?(c.right=y,y.parent=c):c.right=null,r.left=c,c.parent=r)}replace(r,c){r.parent?r===r.parent.left?r.parent.left=c:r.parent.right=c:this._root=c,c&&(c.parent=r.parent)}minNode(r=this._root){if(r)for(;r.left;)r=r.left;return r}maxNode(r=this._root){if(r)for(;r.right;)r=r.right;return r}insert(r,c){var d=this._root,p=null,y=this._compare;if(this._noDuplicates)for(;d;){if(p=d,y(d.key,r)===0)return;d=y(d.key,r)<0?d.right:d.left}else for(;d;)p=d,d=y(d.key,r)<0?d.right:d.left;return d={key:r,data:c,left:null,right:null,parent:p},p?y(p.key,d.key)<0?p.right=d:p.left=d:this._root=d,this.splay(d),this._size++,d}find(r){for(var c=this._root,d=this._compare;c;){var p=d(c.key,r);if(p<0)c=c.right;else{if(!(p>0))return c;c=c.left}}return null}contains(r){for(var c=this._root,d=this._compare;c;){var p=d(r,c.key);if(p===0)return!0;c=p<0?c.left:c.right}return!1}remove(r){var c=this.find(r);if(!c)return!1;if(this.splay(c),c.left)if(c.right){var d=this.minNode(c.right);d.parent!==c&&(this.replace(d,d.right),d.right=c.right,d.right.parent=d),this.replace(c,d),d.left=c.left,d.left.parent=d}else this.replace(c,c.left);else this.replace(c,c.right);return this._size--,!0}removeNode(r){if(!r)return!1;if(this.splay(r),r.left)if(r.right){var c=this.minNode(r.right);c.parent!==r&&(this.replace(c,c.right),c.right=r.right,c.right.parent=c),this.replace(r,c),c.left=r.left,c.left.parent=c}else this.replace(r,r.left);else this.replace(r,r.right);return this._size--,!0}erase(r){var c=this.find(r);if(c){this.splay(c);var d=c.left,p=c.right,y=null;d&&(d.parent=null,y=this.maxNode(d),this.splay(y),this._root=y),p&&(d?y.right=p:this._root=p,p.parent=y),this._size--}}pop(){var r=this._root,c=null;if(r){for(;r.left;)r=r.left;c={key:r.key,data:r.data},this.remove(r.key)}return c}next(r){var c=r;if(c)if(c.right)for(c=c.right;c&&c.left;)c=c.left;else for(c=r.parent;c&&c.right===r;)r=c,c=c.parent;return c}prev(r){var c=r;if(c)if(c.left)for(c=c.left;c&&c.right;)c=c.right;else for(c=r.parent;c&&c.left===r;)r=c,c=c.parent;return c}forEach(r){for(var c=this._root,d=[],p=!1,y=0;!p;)c?(d.push(c),c=c.left):d.length>0?(r(c=d.pop(),y++),c=c.right):p=!0;return this}range(r,c,d,p){const y=[],_=this._compare;let v,T=this._root;for(;y.length!==0||T;)if(T)y.push(T),T=T.left;else{if(T=y.pop(),v=_(T.key,c),v>0)break;if(_(T.key,r)>=0&&d.call(p,T))return this;T=T.right}return this}keys(){for(var r=this._root,c=[],d=[],p=!1;!p;)r?(c.push(r),r=r.left):c.length>0?(r=c.pop(),d.push(r.key),r=r.right):p=!0;return d}values(){for(var r=this._root,c=[],d=[],p=!1;!p;)r?(c.push(r),r=r.left):c.length>0?(r=c.pop(),d.push(r.data),r=r.right):p=!0;return d}at(r){for(var c=this._root,d=[],p=!1,y=0;!p;)if(c)d.push(c),c=c.left;else if(d.length>0){if(c=d.pop(),y===r)return c;y++,c=c.right}else p=!0;return null}load(r=[],c=[],d=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const p=r.length;return d&&w6(r,c,0,p-1,this._compare),this._root=_6(null,r,c,0,p),this._size=p,this}min(){var r=this.minNode(this._root);return r?r.key:null}max(){var r=this.maxNode(this._root);return r?r.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(r,c,d,p,y){return new y6(d,y).load(r,c,p)}}function _6(u,r,c,d,p){const y=p-d;if(y>0){const _=d+Math.floor(y/2),v={key:r[_],data:c[_],parent:u};return v.left=_6(v,r,c,d,_),v.right=_6(v,r,c,_+1,p),v}return null}function w6(u,r,c,d,p){if(c>=d)return;const y=u[c+d>>1];let _=c-1,v=d+1;for(;;){do _++;while(p(u[_],y)<0);do v--;while(p(u[v],y)>0);if(_>=v)break;let T=u[_];u[_]=u[v],u[v]=T,T=r[_],r[_]=r[v],r[v]=T}w6(u,r,c,v,p),w6(u,r,v+1,d,p)}const EM=11102230246251565e-32,Fa=134217729,cQ=(3+8*EM)*EM;function b6(u,r,c,d,p){let y,_,v,T,S=r[0],O=d[0],k=0,N=0;O>S==O>-S?(y=S,S=r[++k]):(y=O,O=d[++N]);let F=0;if(k<u&&N<c)for(O>S==O>-S?(_=S+y,v=y-(_-S),S=r[++k]):(_=O+y,v=y-(_-O),O=d[++N]),y=_,v!==0&&(p[F++]=v);k<u&&N<c;)O>S==O>-S?(_=y+S,T=_-y,v=y-(_-T)+(S-T),S=r[++k]):(_=y+O,T=_-y,v=y-(_-T)+(O-T),O=d[++N]),y=_,v!==0&&(p[F++]=v);for(;k<u;)_=y+S,T=_-y,v=y-(_-T)+(S-T),S=r[++k],y=_,v!==0&&(p[F++]=v);for(;N<c;)_=y+O,T=_-y,v=y-(_-T)+(O-T),O=d[++N],y=_,v!==0&&(p[F++]=v);return y===0&&F!==0||(p[F++]=y),F}function Cv(u){return new Float64Array(u)}const z_=Cv(4),CM=Cv(8),TM=Cv(12),AM=Cv(16),yc=Cv(4);function Tv(u,r,c){r===null?(u.inOut=!1,u.otherInOut=!0):(u.isSubject===r.isSubject?(u.inOut=!r.inOut,u.otherInOut=r.otherInOut):(u.inOut=!r.otherInOut,u.otherInOut=r.isVertical()?!r.inOut:r.inOut),r&&(u.prevInResult=!SM(r,c)||r.isVertical()?r.prevInResult:r)),u.resultTransition=SM(u,c)?function(d,p){let y,_=!d.inOut,v=!d.otherInOut;switch(p){case 0:y=_&&v;break;case 1:y=_||v;break;case 3:y=_!==v;break;case 2:y=d.isSubject?_&&!v:v&&!_}return y?1:-1}(u,c):0}function SM(u,r){switch(u.type){case 0:switch(r){case 0:return!u.otherInOut;case 1:return u.otherInOut;case 2:return u.isSubject&&u.otherInOut||!u.isSubject&&!u.otherInOut;case 3:return!0}break;case 2:return r===0||r===1;case 3:return r===2;case 1:return!1}return!1}class U_{constructor(r,c,d,p,y){this.left=c,this.point=r,this.otherEvent=d,this.isSubject=p??!1,this.type=y||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(r){const c=this.point,d=this.otherEvent.point;return this.left?(c[0]-r[0])*(d[1]-r[1])-(d[0]-r[0])*(c[1]-r[1])>0:(d[0]-r[0])*(c[1]-r[1])-(c[0]-r[0])*(d[1]-r[1])>0}isAbove(r){return!this.isBelow(r)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const r=new U_(this.point,this.left,this.otherEvent,this.isSubject,this.type);return r.contourId=this.contourId,r.resultTransition=this.resultTransition,r.prevInResult=this.prevInResult,r.isExteriorRing=this.isExteriorRing,r.inOut=this.inOut,r.otherInOut=this.otherInOut,r}}function Yd(u,r){return u[0]===r[0]&&u[1]===r[1]}function v6(u,r,c){const d=function(p,y,_,v,T,S){const O=(y-S)*(_-T),k=(p-T)*(v-S),N=O-k;if(O===0||k===0||O>0!=k>0)return N;const F=Math.abs(O+k);return Math.abs(N)>=33306690738754716e-32*F?N:-function($,H,K,q,X,te,se){let ge,me,Ee,Te,xe,Oe,Be,lt,it,st,_t,gt,yt,Qe,bt,pt,vt,wt;const Zt=$-X,Kt=K-X,$t=H-te,Ut=q-te;Qe=Zt*Ut,Oe=Fa*Zt,Be=Oe-(Oe-Zt),lt=Zt-Be,Oe=Fa*Ut,it=Oe-(Oe-Ut),st=Ut-it,bt=lt*st-(Qe-Be*it-lt*it-Be*st),pt=$t*Kt,Oe=Fa*$t,Be=Oe-(Oe-$t),lt=$t-Be,Oe=Fa*Kt,it=Oe-(Oe-Kt),st=Kt-it,vt=lt*st-(pt-Be*it-lt*it-Be*st),_t=bt-vt,xe=bt-_t,z_[0]=bt-(_t+xe)+(xe-vt),gt=Qe+_t,xe=gt-Qe,yt=Qe-(gt-xe)+(_t-xe),_t=yt-pt,xe=yt-_t,z_[1]=yt-(_t+xe)+(xe-pt),wt=gt+_t,xe=wt-gt,z_[2]=gt-(wt-xe)+(_t-xe),z_[3]=wt;let gn=function(Ai,Xn){let ji=Xn[0];for(let pi=1;pi<4;pi++)ji+=Xn[pi];return ji}(0,z_),an=22204460492503146e-32*se;if(gn>=an||-gn>=an||(xe=$-Zt,ge=$-(Zt+xe)+(xe-X),xe=K-Kt,Ee=K-(Kt+xe)+(xe-X),xe=H-$t,me=H-($t+xe)+(xe-te),xe=q-Ut,Te=q-(Ut+xe)+(xe-te),ge===0&&me===0&&Ee===0&&Te===0)||(an=11093356479670487e-47*se+cQ*Math.abs(gn),gn+=Zt*Te+Ut*ge-($t*Ee+Kt*me),gn>=an||-gn>=an))return gn;Qe=ge*Ut,Oe=Fa*ge,Be=Oe-(Oe-ge),lt=ge-Be,Oe=Fa*Ut,it=Oe-(Oe-Ut),st=Ut-it,bt=lt*st-(Qe-Be*it-lt*it-Be*st),pt=me*Kt,Oe=Fa*me,Be=Oe-(Oe-me),lt=me-Be,Oe=Fa*Kt,it=Oe-(Oe-Kt),st=Kt-it,vt=lt*st-(pt-Be*it-lt*it-Be*st),_t=bt-vt,xe=bt-_t,yc[0]=bt-(_t+xe)+(xe-vt),gt=Qe+_t,xe=gt-Qe,yt=Qe-(gt-xe)+(_t-xe),_t=yt-pt,xe=yt-_t,yc[1]=yt-(_t+xe)+(xe-pt),wt=gt+_t,xe=wt-gt,yc[2]=gt-(wt-xe)+(_t-xe),yc[3]=wt;const Wt=b6(4,z_,4,yc,CM);Qe=Zt*Te,Oe=Fa*Zt,Be=Oe-(Oe-Zt),lt=Zt-Be,Oe=Fa*Te,it=Oe-(Oe-Te),st=Te-it,bt=lt*st-(Qe-Be*it-lt*it-Be*st),pt=$t*Ee,Oe=Fa*$t,Be=Oe-(Oe-$t),lt=$t-Be,Oe=Fa*Ee,it=Oe-(Oe-Ee),st=Ee-it,vt=lt*st-(pt-Be*it-lt*it-Be*st),_t=bt-vt,xe=bt-_t,yc[0]=bt-(_t+xe)+(xe-vt),gt=Qe+_t,xe=gt-Qe,yt=Qe-(gt-xe)+(_t-xe),_t=yt-pt,xe=yt-_t,yc[1]=yt-(_t+xe)+(xe-pt),wt=gt+_t,xe=wt-gt,yc[2]=gt-(wt-xe)+(_t-xe),yc[3]=wt;const Rn=b6(Wt,CM,4,yc,TM);Qe=ge*Te,Oe=Fa*ge,Be=Oe-(Oe-ge),lt=ge-Be,Oe=Fa*Te,it=Oe-(Oe-Te),st=Te-it,bt=lt*st-(Qe-Be*it-lt*it-Be*st),pt=me*Ee,Oe=Fa*me,Be=Oe-(Oe-me),lt=me-Be,Oe=Fa*Ee,it=Oe-(Oe-Ee),st=Ee-it,vt=lt*st-(pt-Be*it-lt*it-Be*st),_t=bt-vt,xe=bt-_t,yc[0]=bt-(_t+xe)+(xe-vt),gt=Qe+_t,xe=gt-Qe,yt=Qe-(gt-xe)+(_t-xe),_t=yt-pt,xe=yt-_t,yc[1]=yt-(_t+xe)+(xe-pt),wt=gt+_t,xe=wt-gt,yc[2]=gt-(wt-xe)+(_t-xe),yc[3]=wt;const Qn=b6(Rn,TM,4,yc,AM);return AM[Qn-1]}(p,y,_,v,T,S,F)}(u[0],u[1],r[0],r[1],c[0],c[1]);return d>0?-1:d<0?1:0}function Np(u,r){const c=u.point,d=r.point;return c[0]>d[0]?1:c[0]<d[0]?-1:c[1]!==d[1]?c[1]>d[1]?1:-1:function(p,y,_){return p.left!==y.left?p.left?1:-1:v6(_,p.otherEvent.point,y.otherEvent.point)!==0?p.isBelow(y.otherEvent.point)?-1:1:!p.isSubject&&y.isSubject?1:-1}(u,r,c)}function Mp(u,r,c){const d=new U_(r,!1,u,u.isSubject),p=new U_(r,!0,u.otherEvent,u.isSubject);return Yd(u.point,u.otherEvent.point)&&console.warn("what is that, a collapsed segment?",u),d.contourId=p.contourId=u.contourId,Np(p,u.otherEvent)>0&&(u.otherEvent.left=!0,p.left=!1),u.otherEvent.otherEvent=p,u.otherEvent=d,c.push(p),c.push(d),c}function VC(u,r){return u[0]*r[1]-u[1]*r[0]}function x6(u,r){return u[0]*r[0]+u[1]*r[1]}function E6(u,r,c){const d=function(T,S,O,k){const N=[S[0]-T[0],S[1]-T[1]],F=[k[0]-O[0],k[1]-O[1]];function $(Ee,Te,xe){return[Ee[0]+Te*xe[0],Ee[1]+Te*xe[1]]}const H=[O[0]-T[0],O[1]-T[1]];let K=VC(N,F),q=K*K;const X=x6(N,N);if(q>0){const Ee=VC(H,F)/K;if(Ee<0||Ee>1)return null;const Te=VC(H,N)/K;return Te<0||Te>1?null:Ee===0||Ee===1?[$(T,Ee,N)]:Te===0||Te===1?[$(O,Te,F)]:[$(T,Ee,N)]}if(K=VC(H,N),q=K*K,q>0)return null;const te=x6(N,H)/X,se=te+x6(N,F)/X,ge=Math.min(te,se),me=Math.max(te,se);return ge<=1&&me>=0?ge===1?[$(T,ge>0?ge:0,N)]:me===0?[$(T,me<1?me:1,N)]:[$(T,ge>0?ge:0,N),$(T,me<1?me:1,N)]:null}(u.point,u.otherEvent.point,r.point,r.otherEvent.point),p=d?d.length:0;if(p===0||p===1&&(Yd(u.point,r.point)||Yd(u.otherEvent.point,r.otherEvent.point))||p===2&&u.isSubject===r.isSubject)return 0;if(p===1)return!Yd(u.point,d[0])&&!Yd(u.otherEvent.point,d[0])&&Mp(u,d[0],c),!Yd(r.point,d[0])&&!Yd(r.otherEvent.point,d[0])&&Mp(r,d[0],c),1;const y=[];let _=!1,v=!1;return Yd(u.point,r.point)?_=!0:Np(u,r)===1?y.push(r,u):y.push(u,r),Yd(u.otherEvent.point,r.otherEvent.point)?v=!0:Np(u.otherEvent,r.otherEvent)===1?y.push(r.otherEvent,u.otherEvent):y.push(u.otherEvent,r.otherEvent),_&&v||_?(r.type=1,u.type=r.inOut===u.inOut?2:3,_&&!v&&Mp(y[1].otherEvent,y[0].point,c),2):v?(Mp(y[0],y[1].point,c),3):y[0]!==y[3].otherEvent?(Mp(y[0],y[1].point,c),Mp(y[1],y[2].point,c),3):(Mp(y[0],y[1].point,c),Mp(y[3].otherEvent,y[2].point,c),3)}function lQ(u,r){if(u===r)return 0;if(v6(u.point,u.otherEvent.point,r.point)!==0||v6(u.point,u.otherEvent.point,r.otherEvent.point)!==0)return Yd(u.point,r.point)?u.isBelow(r.otherEvent.point)?-1:1:u.point[0]===r.point[0]?u.point[1]<r.point[1]?-1:1:Np(u,r)===1?r.isAbove(u.point)?-1:1:u.isBelow(r.point)?-1:1;if(u.isSubject!==r.isSubject)return u.isSubject?-1:1;{let c=u.point,d=r.point;if(c[0]===d[0]&&c[1]===d[1])return c=u.otherEvent.point,d=r.otherEvent.point,c[0]===d[0]&&c[1]===d[1]?0:(u.contourId??0)>(r.contourId??0)?1:-1}return Np(u,r)===1?1:-1}class uQ{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function dQ(u,r,c,d){let p,y=u+1,_=r[u].point;const v=r.length;for(y<v&&(p=r[y].point);y<v&&p[0]===_[0]&&p[1]===_[1];){if(!c[y])return y;y++,y<v&&(p=r[y].point)}for(y=u-1;c[y]&&y>d;)y--;return y}function hQ(u,r,c){const d=new uQ;if(u.prevInResult!=null){const p=u.prevInResult,y=p.outputContourId;if(p.resultTransition>0){const _=r[y];if(_.holeOf!=null){const v=_.holeOf;r[v].holeIds.push(c),d.holeOf=v,d.depth=r[y].depth}else r[y].holeIds.push(c),d.holeOf=y,d.depth=r[y].depth+1}else d.holeOf=null,d.depth=r[y].depth}else d.holeOf=null,d.depth=0;return d}const IM=Math.max,PM=Math.min;let WC=0;function RM(u,r,c,d,p,y){let _,v,T,S,O,k;for(_=0,v=u.length-1;_<v;_++){if(T=u[_],S=u[_+1],O=new U_(T,!1,void 0,r),k=new U_(S,!1,O,r),O.otherEvent=k,T[0]===S[0]&&T[1]===S[1])continue;O.contourId=k.contourId=c,y||(O.isExteriorRing=!1,k.isExteriorRing=!1),Np(O,k)>0?k.left=!0:O.left=!0;const N=T[0],F=T[1];p[0]=PM(p[0],N),p[1]=PM(p[1],F),p[2]=IM(p[2],N),p[3]=IM(p[3],F),d.push(O),d.push(k)}}const HC=[];function OM(u,r,c){let d=u,p=r;typeof u[0][0][0]=="number"&&(d=[u]),typeof r[0][0][0]=="number"&&(p=[r]);let y=function(N,F,$){let H=null;return N.length*F.length===0&&($===0?H=HC:$===2?H=N:($===1||$===3)&&(H=N.length===0?F:N)),H}(d,p,c);if(y)return y===HC?null:y;const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],T=function(N,F,$,H,K){const q=new vg(void 0,Np);let X,te,se,ge,me,Ee;for(se=0,ge=N.length;se<ge;se++)for(X=N[se],me=0,Ee=X.length;me<Ee;me++)te=me===0,te&&WC++,RM(X[me],!0,WC,q,$,te);for(se=0,ge=F.length;se<ge;se++)for(X=F[se],me=0,Ee=X.length;me<Ee;me++)te=me===0,K===2&&(te=!1),te&&WC++,RM(X[me],!1,WC,q,H,te);return q}(d,p,_,v,c);if(y=function(N,F,$,H,K){let q=null;return($[0]>H[2]||H[0]>$[2]||$[1]>H[3]||H[1]>$[3])&&(K===0?q=HC:K===2?q=N:(K===1||K===3)&&(q=N.concat(F))),q}(d,p,_,v,c),y)return y===HC?null:y;const S=function(N,F,$,H,K,q){const X=new y6(lQ),te=[],se=Math.min(H[2],K[2]);let ge,me,Ee;for(;N.length!==0;){let Te=N.pop();if(te.push(Te),q===0&&Te.point[0]>se||q===2&&Te.point[0]>H[2])break;if(Te.left){me=ge=X.insert(Te),Ee=X.minNode(),ge=ge!==Ee?X.prev(ge):null,me=X.next(me);const xe=ge?ge.key:null;let Oe;if(Tv(Te,xe,q),me&&E6(Te,me.key,N)===2&&(Tv(Te,xe,q),Tv(me.key,Te,q)),ge&&E6(ge.key,Te,N)===2){let Be=ge;Be=Be!==Ee?X.prev(Be):null,Oe=Be?Be.key:null,Tv(xe,Oe,q),Tv(Te,xe,q)}}else Te=Te.otherEvent,me=ge=X.find(Te),ge&&me&&(ge=ge!==Ee?X.prev(ge):null,me=X.next(me),X.remove(Te),me&&ge&&E6(ge.key,me.key,N))}return te}(T,0,0,_,v,c),O=function(N){let F,$;const H=function(X){let te,se,ge,me,Ee;const Te=[];for(se=0,ge=X.length;se<ge;se++)te=X[se],(te.left&&te.inResult||!te.left&&te.otherEvent.inResult)&&Te.push(te);let xe=!1;for(;!xe;)for(xe=!0,se=0,ge=Te.length;se<ge;se++)se+1<ge&&Np(Te[se],Te[se+1])===1&&(me=Te[se],Te[se]=Te[se+1],Te[se+1]=me,xe=!1);for(se=0,ge=Te.length;se<ge;se++)te=Te[se],te.otherPos=se;for(se=0,ge=Te.length;se<ge;se++)te=Te[se],te.left||(Ee=te.otherPos,te.otherPos=te.otherEvent.otherPos,te.otherEvent.otherPos=Ee);return Te}(N),K={},q=[];for(F=0,$=H.length;F<$;F++){if(K[F])continue;const X=q.length,te=hQ(H[F],q,X),se=Ee=>{K[Ee]=!0,Ee<H.length&&H[Ee]&&(H[Ee].outputContourId=X)};let ge=F,me=F;for(te.points.push(H[F].point);se(ge),ge=H[ge].otherPos,se(ge),te.points.push(H[ge].point),ge=dQ(ge,H,K,me),!(ge==me||ge>=H.length)&&H[ge];);q.push(te)}return q}(S),k=[];for(let N=0;N<O.length;N++){let F=O[N];if(F.isExterior()){let $=[F.points];for(let H=0;H<F.holeIds.length;H++)$.push(O[F.holeIds[H]].points);k.push($)}}return k}function GC(u,r,c,d){const p=[],y=d===0?(_,v,T,S,O,k)=>{_.push(new Tt(k,T+(k-v)/(S-v)*(O-T)))}:(_,v,T,S,O,k)=>{_.push(new Tt(v+(k-T)/(O-T)*(S-v),k))};for(const _ of u){const v=[];for(const T of _){if(T.length<=2)continue;const S=[];for(let N=0;N<T.length-1;N++){const F=T[N].x,$=T[N].y,H=T[N+1].x,K=T[N+1].y,q=d===0?F:$,X=d===0?H:K;q<r?X>r&&y(S,F,$,H,K,r):q>c?X<c&&y(S,F,$,H,K,c):S.push(T[N]),X<r&&q>=r&&y(S,F,$,H,K,r),X>c&&q<=c&&y(S,F,$,H,K,c)}let O=T[T.length-1];const k=d===0?O.x:O.y;k>=r&&k<=c&&S.push(O),S.length&&(O=S[S.length-1],S[0].x===O.x&&S[0].y===O.y||S.push(S[0]),v.push(S))}v.length&&p.push(v)}return p}function fQ(u,r){const c=OM(C6(u),C6([r]),0);return c==null?[]:kM(c)}function pQ(u,r){let d=C6(u,65536);const p=[];for(;r.valid();r.next()){const[y,_]=r.get(),v=y.x*65536,T=y.y*65536,S=_.x*65536,O=_.y*65536,k=S-v,N=O-T,F=Math.hypot(k,N);if(F===0)continue;const $=Math.trunc(N/F*3),H=-Math.trunc(k/F*3);p.push([[[v,T],[S,O],[S+$,O+H],[v+$,T+H],[v,T]]])}return p.length>0&&(d=OM(d,p,2)),kM(d,1/65536,128)}function C6(u,r=1){return[u.map(c=>c.map(d=>[d.x*r,d.y*r]))]}function kM(u,r=1,c){return u.map(d=>d.map((p,y)=>{const _=p.map(v=>{let T=v[0],S=v[1];return c&&(T=Math.round(T/c)*c,S=Math.round(S/c)*c),new Tt(T*r,S*r)._round()});return y>0&&_.reverse(),_}))}class T6{constructor(r,c){this.layoutVertexArray=new qd,this.indexArray=new ms,this.lineIndexArray=new hc,this.triangleSegments=new hr,this.lineSegments=new hr,this.programConfigurations=new B(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new Vs)}update(r,c,d,p,y,_,v,T){this.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,GJ.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,qJ.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,c,d,p,y,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,d,p,y,_,void 0,v)}}class A6{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new T6(r,!1),this.elevationBufferData=new T6(r,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,c){}updateAppearances(r,c,d,p){}populate(r,c,d,p){this.hasPattern=m6("fill",this.layers,this.pixelRatio,c);const y=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:T,index:S,sourceLayerIndex:O}of r){const k=this.layers[0]._featureFilter.needGeometry,N=Vn(v,k);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),N,d))continue;const F=y?y.evaluate(N,{},d,c.availableImages):void 0,$={id:T,properties:v.properties,type:v.type,sourceLayerIndex:O,index:S,geometry:k?N.geometry:Cn(v,d,p),patterns:{},sortKey:F};_.push($)}y&&_.sort((v,T)=>v.sortKey-T.sortKey);for(const v of _){const{geometry:T,index:S,sourceLayerIndex:O}=v;if(this.hasPattern){const k=g6("fill",this.layers,v,this.zoom,this.pixelRatio,c);this.patternFeatures.push(k)}else this.addFeature(v,T,S,d,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(r[S].feature,T,S,O,this.index)}}update(r,c,d,p,y,_,v){this.bufferData.update(r,c,d,p,y,_,v,this.worldview),this.elevationBufferData.update(r,c,d,p,y,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,c,d,p,y,_,v,this.worldview)}addFeatures(r,c,d,p,y,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,c,d,p,_,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,c,d,p,y,_=[],v,T){const S=Ev(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,S,p,d,T):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(r,d,y,_,p,v,this.worldview),this.elevationBufferData.populatePaintArrays(r,d,y,_,p,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(r,c,d,p,y){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(c,d,p,y,this.worldview))}addElevatedRoadFeature(r,c,d,p,y){const _=new Array,v=Zo.getElevationFeature(r,y);if(!v)return void this.addGeometry(c,this.bufferData);{const S=this.clipPolygonsToTile(c,1);S.length>0&&_.push({polygons:S,elevationFeature:v,elevationTileID:d})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},d),featureIndex:p};for(const S of _)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new gc(S.elevationTileID,this.layers,this.zoom,this.lut));const k=S.elevationFeature.isTunnel();let N=0;r.properties.hasOwnProperty(zn)&&(N=+r.properties[zn]),this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,S.polygons,k,S.elevationFeature,N)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const O=new Hc(d,S.elevationTileID);this.addElevatedGeometry(S.polygons,O,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,T)}}addElevatedGeometry(r,c,d,p,y,_){const v={elevation:d,elevationSampler:c,bias:p,index:y,featureInfo:_},[T,S]=this.addGeometry(r,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(r,c,d){let p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=null;d&&(_=d.elevationSampler.constantElevation(d.elevation,d.bias),_!=null&&(p=_,y=_));const v=(T,S,O)=>{if(d!=null)if(S.push(T),_!=null)c.elevatedLayoutVertexArray.emplaceBack(_),O.push(_);else{const k=d.elevationSampler.pointElevation(T,d.elevation,d.bias);c.elevatedLayoutVertexArray.emplaceBack(k),O.push(k),p=Math.min(p,k),y=Math.max(y,k)}};for(const T of r){let S=0;for(const te of T)S+=te.length;const O=c.triangleSegments.prepareSegment(S,c.layoutVertexArray,c.indexArray),k=O.vertexLength,N=[],F=[],$=[],H=[],K=[],q=c.layoutVertexArray.length;for(const te of T){if(te.length===0)continue;te!==T[0]&&F.push(N.length/2);const se=c.lineSegments.prepareSegment(te.length,c.layoutVertexArray,c.lineIndexArray),ge=se.vertexLength;d&&K.push(c.layoutVertexArray.length-q),v(te[0],$,H),c.layoutVertexArray.emplaceBack(te[0].x,te[0].y),c.lineIndexArray.emplaceBack(ge+te.length-1,ge),N.push(te[0].x),N.push(te[0].y);for(let me=1;me<te.length;me++)v(te[me],$,H),c.layoutVertexArray.emplaceBack(te[me].x,te[me].y),c.lineIndexArray.emplaceBack(ge+me-1,ge+me),N.push(te[me].x),N.push(te[me].y);se.vertexLength+=te.length,se.primitiveLength+=te.length}const X=F_(N,F);for(let te=0;te<X.length;te+=3)c.indexArray.emplaceBack(k+X[te],k+X[te+1],k+X[te+2]);if(X.length>0&&d&&this.elevationMode==="hd-road-base"){const te=d.elevation.isTunnel(),se=d.elevation.safeArea,ge=this.elevatedStructures.addVertices($,H);this.elevatedStructures.addTriangles(X,ge,te);const me=K.length;if(me>0){for(let Ee=0;Ee<me-1;Ee++)this.elevatedStructures.addRenderableRing(d.index,K[Ee]+ge,K[Ee+1]-K[Ee],te,se,d.featureInfo);this.elevatedStructures.addRenderableRing(d.index,K[me-1]+ge,$.length-K[me-1],te,se,d.featureInfo)}}O.vertexLength+=S,O.primitiveLength+=X.length/3}return[p,y]}prepareElevatedPolygons(r,c,d){const p=1/Rt(d),y=[];for(const _ of r){const v=pQ(_,new Ma(c,p));y.push(...v)}return y}clipPolygonsToTile(r,c){const d=-c,p=-c,y=zt+c,_=zt+c;let v=0;const T=[],S=[];for(;v<r.length;v++){const N=r[v],F=bg(N);(F.min.x>=d&&F.max.x<=y&&F.min.y>=p&&F.max.y<=_?T:S).push(N)}if(T.length===r.length)return r;const O=[new Tt(d,p),new Tt(y,p),new Tt(y,_),new Tt(d,_),new Tt(d,p)],k=T;for(const N of S)k.push(...fQ(N,O));return k}}let DM,NM,MM,LM;Qt(A6,"FillBucket",{omit:["layers","patternFeatures"]}),Qt(T6,"FillBufferData"),Qt(gc,"ElevatedStructures");class qC{constructor(r,c,d,p){if(this.triangleCount=c.length/3,this.min=new Tt(0,0),this.max=new Tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[y,_]=[r[0].clone(),r[0].clone()];for(let k=1;k<r.length;++k){const N=r[k];y.x=Math.min(y.x,N.x),y.y=Math.min(y.y,N.y),_.x=Math.max(_.x,N.x),_.y=Math.max(_.y,N.y)}if(p){const k=Math.ceil(Math.max(_.x-y.x,_.y-y.y)/p);d=Math.max(d,k)}if(d===0)return;this.min=y,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const T=Math.max(v.x,v.y)/d;this.cellsX=Math.max(1,Math.ceil(v.x/T)),this.cellsY=Math.max(1,Math.ceil(v.y/T)),this.xScale=1/T,this.yScale=1/T;const S=[];for(let k=0;k<this.triangleCount;k++){const N=r[c[3*k+0]].sub(this.min),F=r[c[3*k+1]].sub(this.min),$=r[c[3*k+2]].sub(this.min),H=Xd(Math.floor(Math.min(N.x,F.x,$.x)),this.xScale,this.cellsX),K=Xd(Math.floor(Math.max(N.x,F.x,$.x)),this.xScale,this.cellsX),q=Xd(Math.floor(Math.min(N.y,F.y,$.y)),this.yScale,this.cellsY),X=Xd(Math.floor(Math.max(N.y,F.y,$.y)),this.yScale,this.cellsY),te=new Tt(0,0),se=new Tt(0,0),ge=new Tt(0,0),me=new Tt(0,0);for(let Ee=q;Ee<=X;++Ee){te.y=se.y=Ee*T,ge.y=me.y=(Ee+1)*T;for(let Te=H;Te<=K;++Te)te.x=ge.x=Te*T,se.x=me.x=(Te+1)*T,(Zu(N,F,$,te,se,me)||Zu(N,F,$,te,me,ge))&&S.push({cellIdx:Ee*this.cellsX+Te,triIdx:k})}}if(S.length===0)return;S.sort((k,N)=>k.cellIdx-N.cellIdx||k.triIdx-N.triIdx);let O=0;for(;O<S.length;){const k=S[O].cellIdx,N={start:this.payload.length,len:0};for(;O<S.length&&S[O].cellIdx===k;)++N.len,this.payload.push(S[O++].triIdx);this.cells[k]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,c){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const d=Xd(r.x-this.min.x,this.xScale,this.cellsX),p=Xd(r.y-this.min.y,this.yScale,this.cellsY),y=this.cells[p*this.cellsX+d];if(y){this._lazyInitLookup();for(let _=0;_<y.len;_++){const v=this.payload[y.start+_],T=Math.floor(v/8),S=1<<v%8;if(!(this.lookup[T]&S)&&(this.lookup[T]|=S,c.push(v),c.length===this.triangleCount))return}}}query(r,c,d){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>c.x||r.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const p=Xd(r.x-this.min.x,this.xScale,this.cellsX),y=Xd(c.x-this.min.x,this.xScale,this.cellsX),_=Xd(r.y-this.min.y,this.yScale,this.cellsY),v=Xd(c.y-this.min.y,this.yScale,this.cellsY);for(let T=_;T<=v;T++)for(let S=p;S<=y;S++){const O=this.cells[T*this.cellsX+S];if(O)for(let k=0;k<O.len;k++){const N=this.payload[O.start+k],F=Math.floor(N/8),$=1<<N%8;if(!(this.lookup[F]&$)&&(this.lookup[F]|=$,d.push(N),d.length===this.triangleCount))return}}}}function Xd(u,r,c){return Math.max(0,Math.min(c-1,Math.floor(u*r)))}Qt(qC,"TriangleGridIndex");class BM{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,c){for(const d of this.footprints)c.push({footprint:d,id:r})}updateAppearances(r,c,d,p){}populate(r,c,d,p){const y=[];for(const{feature:_,id:v,index:T,sourceLayerIndex:S}of r){const O=this.layers[0]._featureFilter.needGeometry,k=Vn(_,O);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),k,d))continue;const N={id:v,properties:_.properties,type:_.type,sourceLayerIndex:S,index:T,geometry:O?k.geometry:Cn(_,d,p),patterns:{}};y.push(N)}for(const _ of y){const{geometry:v,index:T,sourceLayerIndex:S}=_;this.addFeature(_,v,T,d,{},c.availableImages,c.brightness),c.featureIndex.insert(r[T].feature,v,T,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,c,d,p,y,_,v){}destroy(){}addFeature(r,c,d,p,y,_=[],v){for(const T of Ev(c,2)){const S=[],O=[],k=[],N=new Tt(1/0,1/0),F=new Tt(-1/0,-1/0);for(const K of T)if(K.length!==0){K!==T[0]&&k.push(O.length/2);for(let q=0;q<K.length;q++)O.push(K[q].x),O.push(K[q].y),S.push(K[q]),N.x=Math.min(N.x,K[q].x),N.y=Math.min(N.y,K[q].y),F.x=Math.max(F.x,K[q].x),F.y=Math.max(F.y,K[q].y)}const $=F_(O,k),H=new qC(S,$,8,256);this.footprints.push({vertices:S,indices:$,grid:H,min:N,max:F})}}}Qt(BM,"ClipBucket",{omit:["layers"]});const mQ=ii([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gQ=ii([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),yQ=ii([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),_Q=ii([{name:"a_centroid_pos",components:2,type:"Uint16"}]),wQ=ii([{name:"a_join_normal_inside",components:3,type:"Int16"}]),bQ=ii([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),vQ=ii([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xQ}=mQ,Av=Number.MAX_SAFE_INTEGER,EQ=Av-1;function FM(u,r,c,d){return u.order<r||u.order===Av||!(u.clipMask&c)||function(p,y){return y.length!==0&&y.find(_=>_===p)===void 0}(d,u.clipScope)}function ZC(u,r){return u.x-r.x||u.y-r.y}function $M(u,r){return ZC(u.min,r.min)===0&&ZC(u.max,r.max)===0}function S6(u,r){return!(u.min.x>r.max.x||u.max.x<r.min.x||u.min.y>r.max.y||u.max.y<r.min.y)}function KC(u,r){if(u.length!==r.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==r[c].sourceId||!$M(u[c],r[c])||u[c].order!==r[c].order||u[c].clipMask!==r[c].clipMask||!bo(u[c].clipScope,r[c].clipScope))return!1;return!0}function zM(u,r,c){const d=1/zt,p=1/(1<<c.canonical.z),y=(r.x*d+c.canonical.x)*p+c.wrap,_=(r.y*d+c.canonical.y)*p;return{min:new Tt((u.x*d+c.canonical.x)*p+c.wrap,(u.y*d+c.canonical.y)*p),max:new Tt(y,_)}}function CQ(u,r,c){const d=1<<c.canonical.z,p=((r.x-c.wrap)*d-c.canonical.x)*zt,y=(r.y*d-c.canonical.y)*zt;return{min:new Tt(((u.x-c.wrap)*d-c.canonical.x)*zt,(u.y*d-c.canonical.y)*zt),max:new Tt(p,y)}}function I6(u,r,c,d,p,y,_){const v=u.indices,T=u.vertices,S=[];for(let O=d;O<d+p;O+=3){const k=r[c[O+0]+y],N=r[c[O+1]+y],F=r[c[O+2]+y],$=Math.min(k.x,N.x,F.x),H=Math.max(k.x,N.x,F.x),K=Math.min(k.y,N.y,F.y),q=Math.max(k.y,N.y,F.y);S.length=0,u.grid.query(new Tt($,K),new Tt(H,q),S);for(let X=0;X<S.length;X++){const te=S[X];if(Zu(T[v[3*te+0]],T[v[3*te+1]],T[v[3*te+2]],k,N,F,_))return!0}}return!1}function UM(u,r,c,d){if(!u||!c)return!1;let p=u.vertices;if(!r.canonical.equals(d.canonical)||r.wrap!==d.wrap){if(c.vertices.length<u.vertices.length)return UM(c,d,u,r);const y=r.canonical,_=d.canonical,v=Math.pow(2,_.z-y.z);p=u.vertices.map(T=>new Tt((T.x+y.x*zt)*v-_.x*zt,(T.y+y.y*zt)*v-_.y*zt))}return I6(c,p,u.indices,0,u.indices.length,0,0)}function jM(u,r,c,d){const p=Math.pow(2,d.z-c.z);return new Tt((u+c.x*zt)*p-d.x*zt,(r+c.y*zt)*p-d.y*zt)}function VM(u,r){const c=[];r.grid.queryPoint(u,c);const d=r.indices,p=r.vertices;for(let y=0;y<c.length;y++){const _=c[y];if(Ba([p[d[3*_+0]],p[d[3*_+1]],p[d[3*_+2]]],u))return!0}return!1}const P6=[new Tt(0,0),new Tt(zt,0),new Tt(zt,zt),new Tt(0,zt)];function WM(u,r){const c=[];let d=[];if(!r||u.length<2)return[u];if(u.length===2)return cu(u[0],u[1],P6)?[u]:[];for(let p=0;p<u.length+2;p++){const y=u[p%u.length],_=u[(p+1)%u.length],v=cu(p===0?u[u.length-1]:u[(p-1)%u.length],y,P6),T=cu(y,_,P6),S=v||T;S&&d.push(y),S&&T||d.length>0&&(d.length>1&&c.push(d),d=[])}return d.length>1&&c.push(d),c}const R6=ci.types,TQ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],AQ=["fill-extrusion-flood-light-ground-radius"],SQ=Math.pow(2,13),IQ=Math.pow(2,15)-1,HM=new Tt(0,1),sf=2147483648;function Sv(u,r,c,d,p,y,_,v){u.emplaceBack((r<<1)+_,(c<<1)+y,(Math.floor(d*SQ)<<1)+p,Math.round(v))}function Iv(u,r,c){u.emplaceBack(r.x*zt,r.y*zt,c?1:0)}function YC(u,r,c,d,p,y){u.emplaceBack(r.x,r.y,(c.x<<1)+d,(c.y<<1)+p,y)}function Pv(u,r,c){u.emplaceBack(r.x,r.y,r.z,c[0]*16384,c[1]*16384,c[2]*16384)}class GM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class qM{constructor(){this.centroidXY=new Tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class ZM{constructor(){this.acc=new Tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,c){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=c.x,r.min.y=r.max.y=c.y)}appendEdge(r,c,d){this.accCount++,this.acc._add(c);let p=!!this.borders;c.x<r.min.x?(r.min.x=c.x,p=!0):c.x>r.max.x&&(r.max.x=c.x,p=!0),c.y<r.min.y?(r.min.y=c.y,p=!0):c.y>r.max.y&&(r.max.y=c.y,p=!0),((c.x===0||c.x===zt)&&c.x===d.x)!=((c.y===0||c.y===zt)&&c.y===d.y)&&this.processBorderOverlap(c,d),p&&this.checkBorderIntersection(c,d)}checkBorderIntersection(r,c){c.x<0!=r.x<0&&this.addBorderIntersection(0,xn(c.y,r.y,(0-c.x)/(r.x-c.x))),c.x>zt!=r.x>zt&&this.addBorderIntersection(1,xn(c.y,r.y,(zt-c.x)/(r.x-c.x))),c.y<0!=r.y<0&&this.addBorderIntersection(2,xn(c.x,r.x,(0-c.y)/(r.y-c.y))),c.y>zt!=r.y>zt&&this.addBorderIntersection(3,xn(c.x,r.x,(zt-c.y)/(r.y-c.y)))}addBorderIntersection(r,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[r];c<d[0]&&(d[0]=c),c>d[1]&&(d[1]=c)}processBorderOverlap(r,c){if(r.x===c.x){if(r.y===c.y)return;const d=r.x===0?0:1;this.addBorderIntersection(d,c.y),this.addBorderIntersection(d,r.y)}else{const d=r.y===0?2:3;this.addBorderIntersection(d,c.x),this.addBorderIntersection(d,r.x)}}centroid(){return this.accCount===0?new Tt(0,0):new Tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,c)=>r+ +(c[0]!==Number.MAX_VALUE),0):0}}function KM(u,r){const c=u.add(r)._unit(),d=ve(u.x*c.x+u.y*c.y,-1,1);var p,y,_;return _=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(_)))/4*IQ*((p=u).x*(y=r).y-p.y*y.x<0?-1:1)}const PQ=[u=>u.x<0,u=>u.x>zt,u=>u.y<0,u=>u.y>zt];function RQ(u,r,c,d){const p=[4];if(d===0)return p;c._mult(d);const y=u.sub(c),_=r.sub(c),v=[u,r,y,_];for(let T=0;T<4;T++)for(const S of v)if(PQ[T](S)){p.push(T);break}return p}class O6{constructor(r){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new ov,this.indexArray=new ms,this.programConfigurations=new B(r.layers,{zoom:r.zoom,lut:r.lut},c=>AQ.includes(c)),this._segments=new hr,this.hiddenByLandmarkVertexArray=new N_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new hr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,c,d,p=!1){const y=r.length;if(y>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let T;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const S=r[0],O=r[1];T=KM(S.sub(r[y-1])._perp()._unit(),O.sub(S)._perp()._unit())}for(let S=0;S<y;S++){const O=S===y-1?0:S+1,k=r[S],N=r[O],F=r[O===y-1?0:O+1],$=N.sub(k)._perp()._unit(),H=KM($,F.sub(N)._perp()._unit()),K=T,q=H;if(k6(k,N,c)||p&&JM(k,c)&&JM(N,c)){T=H;continue}const X=v.vertexLength;YC(this.vertexArray,k,N,1,1,K),YC(this.vertexArray,k,N,1,0,K),YC(this.vertexArray,k,N,0,1,q),YC(this.vertexArray,k,N,0,0,q),v.vertexLength+=4;const te=RQ(k,N,$,d);for(const se of te)this._segmentToGroundQuads[_].push({id:X,region:se}),this._segmentToRegionTriCounts[_][se]+=2,v.primitiveLength+=2;T=H}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),c=r.length;for(let d=0;d<c;d++)this._segmentToGroundQuads[d].sort((p,y)=>p.region-y.region);for(let d=0;d<c;d++){const p=this._segmentToGroundQuads[d],y=r[d],_=this._segmentToRegionTriCounts[d];_.reduce((T,S)=>T+S,0);let v=0;for(let T=0;T<=4;T++){const S=_[T];if(S!==0){let O=this.regionSegments[T];O||(O=this.regionSegments[T]=new hr);const k={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+v,vertexLength:y.vertexLength,primitiveLength:S};O.get().push(k)}v+=S}for(let T=0;T<p.length;T++){const S=p[T].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,c,d,p,y,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,c,d,p,y,_,void 0,v)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,gQ.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=r.createVertexBuffer(this.groundRadiusArray,yQ.members)))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,c,d,p,y,_,v,T){this.hasData()&&this.programConfigurations.updatePaintArrays(r,c,d,p,y,_,v,T)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&sf))}updateHiddenByLandmarkRange(r,c,d){if(!this.hasData())return;const p=c+r;if(c!==0){for(let y=r;y<p;++y)this.hiddenByLandmarkVertexArray.emplace(y,d?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,bQ.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const c=this.regionSegments[r];c&&c.destroy()}}}}class XC{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ms,this.footprintVertices=new qd,this.footprintSegments=[],this.layoutVertexArray=new qu,this.centroidVertexArray=new SC,this.wallVertexArray=new IC,this.indexArray=new ms,this.programConfigurations=new B(r.layers,{zoom:r.zoom,lut:r.lut},c=>TQ.includes(c)),this.segments=new hr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new O6(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,c){}updateAppearances(r,c,d,p){}populate(r,c,d,p){this.features=[],this.hasPattern=m6("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Rt(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:_,index:v,sourceLayerIndex:T}of r){const S=this.layers[0]._featureFilter.needGeometry,O=Vn(y,S);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),O,d))continue;const k={id:_,sourceLayerIndex:T,index:v,geometry:S?O.geometry:Cn(y,d,p),properties:y.properties,type:y.type,patterns:{}},N=this.layoutVertexArray.length,F=R6[k.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:g6("fill-extrusion",this.layers,k,this.zoom,this.pixelRatio,c)});else if(this.wallMode)for(const $ of k.geometry)for(const H of WM($,F))this.addFeature(y.id,k,[H],v,d,{},c.availableImages,p,c.brightness);else this.addFeature(y.id,k,k.geometry,v,d,{},c.availableImages,p,c.brightness);c.featureIndex.insert(y,k.geometry,v,T,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,c,d,p,y,_){for(const{featureId:v,feature:T}of this.features){const S=R6[T.type]==="Polygon",{geometry:O}=T;if(this.wallMode)for(const k of O)for(const N of WM(k,S))this.addFeature(v,T,[N],T.index,c,d,p,y,_);else this.addFeature(v,T,O,T.index,c,d,p,y,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,c,d,p,y,_,v){this.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v,this.worldview),this.groundEffect.update(r,c,y,d,p,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xQ),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,wQ.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,vQ.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,_Q.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,d,p,y,_,v,T,S){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(c,{})/this.tileToMeter,k=[new Tt(0,0),new Tt(zt,zt)],N=T.projection,F=N.name==="globe",$=this.wallMode||R6[c.type]==="Polygon",H=new ZM;H.centroidDataIndex=this.centroidData.length;const K=new qM;K.buildingId=r,c.properties&&c.properties.hasOwnProperty("building_id")&&(K.buildingId=Number(c.properties.building_id));const q=this.layers[0].paint.get("fill-extrusion-base").evaluate(c,{},y)<=0,X=this.layers[0].paint.get("fill-extrusion-height").evaluate(c,{},y);let te;if(K.height=X,K.vertexArrayOffset=this.layoutVertexArray.length,K.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Sp),this.wallMode){if(F)return void In("Non zero fill-extrusion-line-width is not yet supported on globe.");if(d.length!==1)return;te=function(Oe){const Be=Oe[0].x===Oe[Oe.length-1].x&&Oe[0].y===Oe[Oe.length-1].y;(function($t){let Ut=0;const gn=$t.length;for(let an=0;an<gn;an++)Ut+=($t[(an+1)%gn].x-$t[an].x)*($t[(an+1)%gn].y+$t[an].y);return Ut>=0})(Oe)||(Oe=Oe.reverse());const it={geometry:[],joinNormals:[],indices:[]},st=[],_t=[],gt=[];let yt=Oe.length;for(;yt>=2&&Oe[yt-1].equals(Oe[yt-2]);)yt--;if(yt<(Be?3:2))return it;let Qe,bt,pt,vt,wt,Zt=0;for(;Zt<yt-1&&Oe[Zt].equals(Oe[Zt+1]);)Zt++;Be&&(Qe=Oe[yt-2],wt=Oe[Zt].sub(Qe)._unit()._perp());for(let $t=Zt;$t<yt;$t++){if(pt=$t===yt-1?Be?Oe[Zt+1]:void 0:Oe[$t+1],pt&&Oe[$t].equals(pt))continue;wt&&(vt=wt),Qe&&(bt=Qe),Qe=Oe[$t],wt=pt?pt.sub(Qe)._unit()._perp():vt,vt=vt||wt;let Ut=vt.add(wt);Ut.x===0&&Ut.y===0||Ut._unit();const gn=Ut.x*wt.x+Ut.y*wt.y,an=gn!==0?1/gn:1/0,Wt=vt.x*wt.y-vt.y*wt.x>0;let Rn="miter";const Qn=2;Rn==="miter"&&an>Qn&&(Rn="bevel"),Rn==="bevel"&&(an>100&&(Rn="flipbevel"),an<Qn&&(Rn="miter"));const Ai=(Xn,ji,pi,Br)=>{const bi=new Tt(Xn.x,Xn.y),Bi=new Tt(Xn.x,Xn.y);bi.x+=ji.x*Br,bi.y+=ji.y*Br,Bi.x-=ji.x*Math.max(pi,1),Bi.y-=ji.y*Math.max(pi,1),gt.push(ji),st.push(bi),_t.push(Bi)};if(Rn==="miter")Ut._mult(an),Ai(Qe,Ut,0,0);else if(Rn==="flipbevel")Ut=wt.mult(-1),Ai(Qe,Ut,0,0),Ai(Qe,Ut.mult(-1),0,0);else{const Xn=-Math.sqrt(an*an-1),ji=Wt?Xn:0,pi=Wt?0:Xn;bt&&Ai(Qe,vt,ji,pi),pt&&Ai(Qe,wt,ji,pi)}}it.geometry=[...st,..._t.reverse(),st[0]],it.joinNormals=[...gt,...gt.reverse(),gt[gt.length-1]];const Kt=it.geometry.length-1;for(let $t=0;$t<Kt/2;$t++)if($t+1<Kt/2){let Ut=$t,gn=$t+1,an=Kt-1-$t,Wt=Kt-2-$t;Ut=Ut===0?Kt-1:Ut-1,gn=gn===0?Kt-1:gn-1,an=an===0?Kt-1:an-1,Wt=Wt===0?Kt-1:Wt-1,it.indices.push(an),it.indices.push(gn),it.indices.push(Ut),it.indices.push(an),it.indices.push(Wt),it.indices.push(gn)}return it}(d[0]),d=[te.geometry]}const se=(Oe,Be)=>Oe<(Be.length-1)/2||Oe===Be.length-1,ge=this.wallMode?[d]:Ev(d,500);for(let Oe=ge.length-1;Oe>=0;Oe--){const Be=ge[Oe];(Be.length===0||kQ(Be[0]))&&ge.splice(Oe,1)}let me;if(F)me=n9(ge,k,y);else{me=[];for(const Oe of ge)me.push({polygon:Oe,bounds:k})}const Ee=$?this.edgeRadius:0,Te=Ee>0&&this.zoom<17,xe=(Oe,Be)=>{if(Oe.length===0)return!1;const lt=Oe[Oe.length-1];return Be.x===lt.x&&Be.y===lt.y};for(const{polygon:Oe,bounds:Be}of me){let lt=0,it=0;for(const yt of Oe)$&&!yt[0].equals(yt[yt.length-1])&&yt.push(yt[0]),it+=$?yt.length-1:yt.length;const st=this.segments.prepareSegment(($?5:4)*it,this.layoutVertexArray,this.indexArray);K.footprintSegIdx<0&&(K.footprintSegIdx=this.footprintSegments.length),K.polygonSegIdx<0&&(K.polygonSegIdx=this.polygonSegments.length);const _t={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},gt=new GM;if(gt.vertexOffset=this.footprintVertices.length,gt.indexOffset=3*this.footprintIndices.length,gt.ringIndices=[],$){const yt=[],Qe=[];lt=st.vertexLength;for(let pt=0;pt<Oe.length;pt++){const vt=Oe[pt];vt.length&&pt!==0&&Qe.push(yt.length/2);const wt=[];let Zt,Kt;Zt=vt[1].sub(vt[0])._perp()._unit(),gt.ringIndices.push(vt.length-1);for(let $t=1;$t<vt.length;$t++){const Ut=vt[$t],gn=vt[$t===vt.length-1?1:$t+1],an=Ut.clone();if(Ee){Kt=gn.sub(Ut)._perp()._unit();const Wt=Zt.add(Kt)._unit(),Rn=Ee*Math.min(4,1/(Zt.x*Wt.x+Zt.y*Wt.y));an.x+=Rn*Wt.x,an.y+=Rn*Wt.y,an.x=Math.round(an.x),an.y=Math.round(an.y),Zt=Kt}if(!q||Ee!==0&&!Te||xe(wt,an)||wt.push(an),Sv(this.layoutVertexArray,an.x,an.y,0,0,1,1,0),this.wallMode){const Wt=se($t,vt);Iv(this.wallVertexArray,te.joinNormals[$t],!Wt)}st.vertexLength++,this.footprintVertices.emplaceBack(Ut.x,Ut.y),yt.push(Ut.x,Ut.y),F&&Pv(this.layoutVertexExtArray,N.projectTilePoint(an.x,an.y,y),N.upVector(y,an.x,an.y))}q&&(Ee===0||Te)&&(wt.length!==0&&xe(wt,wt[0])&&wt.pop(),this.groundEffect.addData(wt,Be,O))}const bt=this.wallMode?te.indices:F_(yt,Qe);for(let pt=0;pt<bt.length;pt+=3)this.footprintIndices.emplaceBack(gt.vertexOffset+bt[pt+0],gt.vertexOffset+bt[pt+1],gt.vertexOffset+bt[pt+2]),this.indexArray.emplaceBack(lt+bt[pt],lt+bt[pt+2],lt+bt[pt+1]),st.primitiveLength++;gt.indexCount+=bt.length,gt.vertexCount+=this.footprintVertices.length-gt.vertexOffset}for(let yt=0;yt<Oe.length;yt++){const Qe=Oe[yt];H.startRing(K,Qe[0]);let bt=Qe.length>4&&QM(Qe[Qe.length-2],Qe[0],Qe[1]),pt=Ee?OQ(Qe[Qe.length-2],Qe[0],Qe[1],Ee):0;const vt=[];let wt,Zt,Kt;Zt=Qe[1].sub(Qe[0])._perp()._unit();let $t=!0;for(let Ut=1,gn=0;Ut<Qe.length;Ut++){let an=Qe[Ut-1],Wt=Qe[Ut];const Rn=Qe[Ut===Qe.length-1?1:Ut+1];if(H.appendEdge(K,Wt,an),k6(Wt,an,Be)){Ee&&(Zt=Rn.sub(Wt)._perp()._unit(),$t=!$t);continue}const Qn=Wt.sub(an)._perp(),Ai=Qn.x/(Math.abs(Qn.x)+Math.abs(Qn.y)),Xn=Qn.y>0?1:0,ji=an.dist(Wt);if(gn+ji>32768&&(gn=0),Ee){Kt=Rn.sub(Wt)._perp()._unit();let Bi=XM(an,Wt,Rn,YM(Zt,Kt),Ee);isNaN(Bi)&&(Bi=0);const ur=Wt.sub(an)._unit();an=an.add(ur.mult(pt))._round(),Wt=Wt.add(ur.mult(-Bi))._round(),pt=Bi,Zt=Kt,q&&this.zoom>=17&&(xe(vt,an)||vt.push(an),xe(vt,Wt)||vt.push(Wt))}const pi=st.vertexLength,Br=Qe.length>4&&QM(an,Wt,Rn);let bi=e9(gn,bt,$t);if(Sv(this.layoutVertexArray,an.x,an.y,Ai,Xn,0,0,bi),Sv(this.layoutVertexArray,an.x,an.y,Ai,Xn,0,1,bi),this.wallMode){const Bi=se(Ut-1,Qe),ur=te.joinNormals[Ut-1];Iv(this.wallVertexArray,ur,Bi),Iv(this.wallVertexArray,ur,Bi)}if(gn+=ji,bi=e9(gn,Br,!$t),bt=Br,Sv(this.layoutVertexArray,Wt.x,Wt.y,Ai,Xn,0,0,bi),Sv(this.layoutVertexArray,Wt.x,Wt.y,Ai,Xn,0,1,bi),this.wallMode){const Bi=se(Ut,Qe),ur=te.joinNormals[Ut];Iv(this.wallVertexArray,ur,Bi),Iv(this.wallVertexArray,ur,Bi)}if(st.vertexLength+=4,this.indexArray.emplaceBack(pi+0,pi+1,pi+2),this.indexArray.emplaceBack(pi+1,pi+3,pi+2),st.primitiveLength+=2,Ee){const Bi=lt+(Ut===1?Qe.length-2:Ut-2),ur=Ut===1?lt:Bi+1;if(this.indexArray.emplaceBack(pi+1,Bi,pi+3),this.indexArray.emplaceBack(Bi,ur,pi+3),st.primitiveLength+=2,wt===void 0&&(wt=pi),!k6(Rn,Qe[Ut],Be)){const yr=Ut===Qe.length-1?wt:st.vertexLength;this.indexArray.emplaceBack(pi+2,pi+3,yr),this.indexArray.emplaceBack(pi+3,yr+1,yr),this.indexArray.emplaceBack(pi+3,ur,yr+1),st.primitiveLength+=3}$t=!$t}if(F){const Bi=this.layoutVertexExtArray,ur=N.projectTilePoint(an.x,an.y,y),yr=N.projectTilePoint(Wt.x,Wt.y,y),_r=N.upVector(y,an.x,an.y),Fr=N.upVector(y,Wt.x,Wt.y);Pv(Bi,ur,_r),Pv(Bi,ur,_r),Pv(Bi,yr,Fr),Pv(Bi,yr,Fr)}}$&&(lt+=Qe.length-1),q&&Ee&&this.zoom>=17&&(vt.length!==0&&xe(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Be,O,Ee>0))}this.footprintSegments.push(gt),_t.triangleCount=this.indexArray.length-_t.triangleArrayOffset,this.polygonSegments.push(_t),++K.footprintSegLen,++K.polygonSegLen}if(K.vertexCount=this.layoutVertexArray.length-K.vertexArrayOffset,K.groundVertexCount=this.groundEffect.vertexArray.length-K.groundVertexArrayOffset,K.vertexCount!==0){if(K.centroidXY=H.borders?HM:this.encodeCentroid(H,K),this.centroidData.push(K),H.borders){this.featuresOnBorder.push(H);const Oe=this.featuresOnBorder.length-1;for(let Be=0;Be<H.borders.length;Be++)H.borders[Be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Be].push(Oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,_,v,y,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(c,p,_,v,y,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,X)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((c,d)=>this.featuresOnBorder[c].borders[r][0]-this.featuresOnBorder[d].borders[r][0])}splitToSubtiles(){const r=[];for(let v=0;v<this.centroidData.length;v++){const T=this.centroidData[v],S=+(T.min.y+T.max.y>zt),O=2*S+(+(T.min.x+T.max.x>zt)^S);for(let k=0;k<T.polygonSegLen;k++){const N=T.polygonSegIdx+k;r.push({centroidIdx:v,subtile:O,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const c=new ms;r.sort((v,T)=>v.triangleSegmentIdx===T.triangleSegmentIdx?v.subtile-T.subtile:v.triangleSegmentIdx-T.triangleSegmentIdx);let d=0,p=0,y=0;for(const v of r){if(v.triangleSegmentIdx!==d)break;y++}const _=r.length;for(;p!==r.length;){d=r[p].triangleSegmentIdx;let v=0,T=p,S=p;for(let O=T;O<y&&r[O].subtile===v;O++)S++;for(;T!==y;){const O=r[T];v=O.subtile;const k=this.centroidData[O.centroidIdx].min.clone(),N=this.centroidData[O.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=T;$<S;$++){const H=r[$],K=this.polygonSegments[H.polygonSegmentIdx],q=this.centroidData[H.centroidIdx].min,X=this.centroidData[H.centroidIdx].max,te=this.indexArray.uint16;for(let se=K.triangleArrayOffset;se<K.triangleArrayOffset+K.triangleCount;se++)c.emplaceBack(te[3*se],te[3*se+1],te[3*se+2]);F.primitiveLength+=K.triangleCount,k.x=Math.min(k.x,q.x),k.y=Math.min(k.y,q.y),N.x=Math.max(N.x,X.x),N.y=Math.max(N.y,X.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:k,max:N}),T=S;for(let $=T;$<y&&r[$].subtile===r[T].subtile;$++)S++}p=y;for(let O=p;O<_&&r[O].triangleSegmentIdx===r[p].triangleSegmentIdx;O++)y++}c._trim(),this.indexArray=c}getVisibleSegments(r,c,d){const p=new hr;if(this.wallMode){for(const H of this.triangleSubSegments)p.segments.push(H.segment);return p}let y=0,_=0;const v=1<<r.canonical.z;if(c){const H=c.getMinMaxForTile(r);H&&(y=H.min,_=H.max)}_+=this.maxHeight;const T=r.toUnwrapped();let S;const O=[T.canonical.x/v+T.wrap,T.canonical.y/v],k=[(T.canonical.x+1)/v+T.wrap,(T.canonical.y+1)/v],N=(H,K,q)=>[H[0]*(1-q[0])+K[0]*q[0],H[1]*(1-q[1])+K[1]*q[1]],F=[],$=[];for(const H of this.triangleSubSegments){F[0]=H.min.x/zt,F[1]=H.min.y/zt,$[0]=H.max.x/zt,$[1]=H.max.y/zt;const K=N(O,k,F),q=N(O,k,$);if(new Ri([K[0],K[1],y],[q[0],q[1],_]).intersectsPrecise(d)===0){S&&(p.segments.push(S),S=void 0);continue}const X=H.segment;S&&S.vertexOffset!==X.vertexOffset&&(p.segments.push(S),S=void 0),S?(S.vertexLength+=X.vertexLength,S.primitiveLength+=X.primitiveLength):S={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&p.segments.push(S),p}encodeCentroid(r,c){const d=r.centroid(),p=c.span(),y=Math.min(7,Math.round(p.x*this.tileToMeter/10)),_=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Tt(ve(d.x,1,8191)<<3|y,ve(d.y,1,8191)<<3|_)}encodeBorderCentroid(r){if(!r.borders)return new Tt(0,0);const c=r.borders,d=Number.MAX_VALUE;if(c[0][0]!==d||c[1][0]!==d){const p=c[0][0]!==d?0:1;return new Tt(6|(c[0][0]!==d?0:65528),(c[p][0]+c[p][1])/2<<3|6)}{const p=c[2][0]!==d?2:3;return new Tt((c[p][0]+c[p][1])/2<<3|6,6|(c[2][0]!==d?0:65528))}}showCentroid(r){const c=this.centroidData[r.centroidDataIndex];c.flags&=2147483647,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const c=r.vertexArrayOffset,d=r.vertexCount+r.vertexArrayOffset,p=r.flags&sf?HM:r.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==p.y||y!==p.x){for(let _=c;_<d;++_)this.centroidVertexArray.emplace(_,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,c,d){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(r.toUnwrapped());if(KC(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-r.canonical.z));if(_.footprint.buildingIds)for(const T of this.centroidData)T.flags&sf||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y||_.footprint.buildingIds.has(T.buildingId)&&(T.flags|=sf);else for(const T of this.centroidData)if(!(T.flags&sf||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y))for(let S=0;S<T.footprintSegLen;S++){const O=this.footprintSegments[T.footprintSegIdx+S];if(y.length=0,DQ(this.footprintVertices,O.vertexOffset,O.vertexCount,_.footprintTileId.canonical,r.canonical,y),I6(_.footprint,y,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-v)){T.flags|=sf;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,c,d){let p=!1;for(let y=0;y<d.footprintSegLen;y++){const _=this.footprintSegments[d.footprintSegIdx+y];let v=0;for(const T of _.ringIndices){for(let S=v,O=T+v-1;S<T+v;O=S++){const k=this.footprintVertices.int16[2*(S+_.vertexOffset)+0],N=this.footprintVertices.int16[2*(S+_.vertexOffset)+1],F=this.footprintVertices.int16[2*(O+_.vertexOffset)+1];N>c!=F>c&&r<(this.footprintVertices.int16[2*(O+_.vertexOffset)+0]-k)*(c-N)/(F-N)+k&&(p=!p)}v=T}}return p}getHeightAtTileCoord(r,c){let d=Number.NEGATIVE_INFINITY,p=!0;const y=4*(r+zt)*zt+(c+zt);if(this.partLookup.hasOwnProperty(y)){const _=this.partLookup[y];return _?{height:_.height,hidden:!!(_.flags&sf)}:void 0}for(const _ of this.centroidData)r>_.max.x||_.min.x>r||c>_.max.y||_.min.y>c||_.height<=d||this.footprintContainsPoint(r,c,_)&&(d=_.height,this.partLookup[y]=_,p=!!(_.flags&sf));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.partLookup[y]=void 0}}function YM(u,r){const c=u.add(r)._unit();return u.x*c.x+u.y*c.y}function OQ(u,r,c,d){const p=r.sub(u)._perp()._unit(),y=c.sub(r)._perp()._unit();return XM(u,r,c,YM(p,y),d)}function XM(u,r,c,d,p){const y=Math.sqrt(1-d*d);return Math.min(u.dist(r)/3,r.dist(c)/3,p*y/d)}function k6(u,r,c){return u.x<c[0].x&&r.x<c[0].x||u.x>c[1].x&&r.x>c[1].x||u.y<c[0].y&&r.y<c[0].y||u.y>c[1].y&&r.y>c[1].y}function JM(u,r){return u.x<r[0].x||u.x>r[1].x||u.y<r[0].y||u.y>r[1].y}function kQ(u){return u.every(r=>r.x<=0)||u.every(r=>r.x>=zt)||u.every(r=>r.y<=0)||u.every(r=>r.y>=zt)}function QM(u,r,c){if(u.x<0||u.x>=zt||r.x<0||r.x>=zt||c.x<0||c.x>=zt)return!1;const d=c.sub(r),p=d.perp(),y=u.sub(r);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function e9(u,r,c){const d=r?2|u:-3&u;return c?1|d:-2&d}function t9(){const u=Math.PI/32,r=Math.tan(u),c=Se;return c*Math.sqrt(1+2*r*r)-c}function n9(u,r,c){const d=1<<c.z,p=mt(c.x/d),y=mt((c.x+1)/d),_=xt(c.y/d),v=xt((c.y+1)/d);return function(T,S,O,k,N=0,F){const $=[];if(!T.length||!O||!k)return $;const H=(me,Ee)=>{for(const Te of me)$.push({polygon:Te,bounds:Ee})},K=Math.ceil(Math.log2(O)),q=Math.ceil(Math.log2(k)),X=K-q,te=[];for(let me=0;me<Math.abs(X);me++)te.push(X>0?0:1);for(let me=0;me<Math.min(K,q);me++)te.push(0),te.push(1);let se=T;if(se=GC(se,S[0].y-N,S[1].y+N,1),se=GC(se,S[0].x-N,S[1].x+N,0),!se.length)return $;const ge=[];for(te.length?ge.push({polygons:se,bounds:S,depth:0}):H(se,S);ge.length;){const me=ge.pop(),Ee=me.depth,Te=te[Ee],xe=me.bounds[0],Oe=me.bounds[1],Be=Te===0?xe.x:xe.y,lt=Te===0?Oe.x:Oe.y,it=F?F(Te,Be,lt):.5*(Be+lt),st=GC(me.polygons,Be-N,it+N,Te),_t=GC(me.polygons,it-N,lt+N,Te);if(st.length){const gt=[xe,new Tt(Te===0?it:Oe.x,Te===1?it:Oe.y)];te.length>Ee+1?ge.push({polygons:st,bounds:gt,depth:Ee+1}):H(st,gt)}if(_t.length){const gt=[new Tt(Te===0?it:xe.x,Te===1?it:xe.y),Oe];te.length>Ee+1?ge.push({polygons:_t,bounds:gt,depth:Ee+1}):H(_t,gt)}}return $}(u,r,Math.ceil((y-p)/11.25),Math.ceil((_-v)/11.25),1,(T,S,O)=>{if(T===0)return .5*(S+O);{const k=xt((c.y+S/zt)/d);return(tt(.5*(xt((c.y+O/zt)/d)+k))*d-c.y)*zt}})}function DQ(u,r,c,d,p,y){const _=Math.pow(2,d.z-p.z);for(let v=0;v<c;v++){let T=u.int16[2*(v+r)+0],S=u.int16[2*(v+r)+1];T=(T+p.x*zt)*_-d.x*zt,S=(S+p.y*zt)*_-d.y*zt,y.push(new Tt(T,S))}}let i9,r9;Qt(XC,"FillExtrusionBucket",{omit:["layers","features"]}),Qt(qM,"PartData"),Qt(GM,"FootprintSegment"),Qt(ZM,"BorderCentroidData"),Qt(O6,"GroundEffect");class Xg extends Tt{constructor(r,c,d){super(r,c),this.z=d}}class s9 extends Xg{constructor(r,c,d,p){super(r,c,d),this.w=p}}function o9(u,r,c,d){const p=c==="x"?"y":"x",y=(d-u[c])/(r[c]-u[c]);u[p]=Math.round(u[p]+(r[p]-u[p])*y),u[c]=d,u.hasOwnProperty("z")&&(u.z=xn(u.z,r.z,y)),u.hasOwnProperty("w")&&(u.w=xn(u.w,r.w,y))}function a9(u,r,c,d){const p=c,y=d;for(const _ of["x","y"]){let v=u,T=r;v[_]>=T[_]&&(v=r,T=u),v[_]<p&&T[_]>p&&o9(v,T,_,p),v[_]<y&&T[_]>y&&o9(T,v,_,y)}}function JC(u,r,c,d,p,y){const _=[];for(let v=0;v<u.length;v++){const T=u[v];let S;const O=_.length;let k=0;for(let N=0;N<T.length-1;N++){let F=T[N],$=T[N+1],H=0;const K=k;let q,X;y&&(H=Math.hypot($.x-F.x,$.y-F.y),k+=H,q=F,X=$),F.x<r&&$.x<r||(F.x<r?F=new Tt(r,F.y+(r-F.x)/($.x-F.x)*($.y-F.y))._round():$.x<r&&($=new Tt(r,F.y+(r-F.x)/($.x-F.x)*($.y-F.y))._round()),F.y<c&&$.y<c||(F.y<c?F=new Tt(F.x+(c-F.y)/($.y-F.y)*($.x-F.x),c)._round():$.y<c&&($=new Tt(F.x+(c-F.y)/($.y-F.y)*($.x-F.x),c)._round()),F.x>=d&&$.x>=d||(F.x>=d?F=new Tt(d,F.y+(d-F.x)/($.x-F.x)*($.y-F.y))._round():$.x>=d&&($=new Tt(d,F.y+(d-F.x)/($.x-F.x)*($.y-F.y))._round()),F.y>=p&&$.y>=p||(F.y>=p?F=new Tt(F.x+(p-F.y)/($.y-F.y)*($.x-F.x),p)._round():$.y>=p&&($=new Tt(F.x+(p-F.y)/($.y-F.y)*($.x-F.x),p)._round()),S&&F.equals(S[S.length-1])||(S=[F],_.push(S),y&&y.push({progress:{min:K+c9(q,X,F)*H,max:1},parentIndex:v,prevPoint:q,nextPoint:X})),S.push($),y&&(y[y.length-1].progress.max=K+c9(q,X,$)*H,y[y.length-1].nextPoint=X)))))}if(y&&k>0)for(let N=O;N<_.length;N++)y[N].progress.min/=k,y[N].progress.max/=k}return _}function NQ(u,r,c,d,p){if(u.length<2)return void d.push(u);const y=[];for(;r.valid();){const[S,O]=r.get();for(let k=0;k<u.length-1;k++){const N=u[k],F=u[k+1],$=Zg(N,F,S,O);if($){const[H]=$,K=new Tt(xn(N.x,F.x,H),xn(N.y,F.y,H));y.push({t:k+H,distance:0,point:K})}}r.next()}if(y.length===0)return void d.push(u);y.sort((S,O)=>S.t-O.t);let _=0,v=0,T=[];for(d.push(T);_!==u.length;){if(v===y.length){for(;_!==u.length;)T.length!==0&&T[T.length-1].equals(u[_])||T.push(u[_]),_++;break}y[v].t<=_?(T.length!==0&&T[T.length-1].equals(y[v].point)||T.push(y[v].point),Math.trunc(y[v].t),v++):(T.length!==0&&T[T.length-1].equals(u[_])||T.push(u[_]),_++)}}function c9(u,r,c){return u.x!==r.x?(c.x-u.x)/(r.x-u.x):u.y!==r.y?(c.y-u.y)/(r.y-u.y):0}function Rv(u,r){return u.x*r.x+u.y*r.y}function l9(u,r){if(u.length===1){let c=0;const d=r[c++];let p;for(;!p||d.equals(p);)if(p=r[c++],!p)return 1/0;for(;c<r.length;c++){const y=r[c],_=u[0],v=p.sub(d),T=y.sub(d),S=_.sub(d),O=Rv(v,v),k=Rv(v,T),N=Rv(T,T),F=Rv(S,v),$=Rv(S,T),H=O*N-k*k,K=(N*F-k*$)/H,q=(O*$-k*F)/H,X=d.z*(1-K-q)+p.z*K+y.z*q;if(isFinite(X))return X}return 1/0}{let c=1/0;for(const d of r)c=Math.min(c,d.z);return c}}function u9(u,r,c){let d=1/0;ir(c,r)&&(d=l9(c,r[0]));for(let p=0;p<r.length;p++){const y=r[p],_=u[p];for(let v=0;v<y.length-1;v++){const T=y[v],S=[T,y[v+1],_[v+1],_[v],T];gr(c,S)&&(d=Math.min(d,l9(c,S)))}}return d!==1/0&&d}function d9(u,r,c,d,p,y,_,v,T,S,O){return u.projection.name==="globe"?function(k,N,F,$,H,K,q,X,te,se,ge){const me=[],Ee=[],Te=k.projection.upVectorScale(ge,k.center.lat,k.worldSize).metersToTile,xe=[0,0,0,1],Oe=[0,0,0,1],Be=(it,st,_t,gt)=>{it[0]=st,it[1]=_t,it[2]=gt,it[3]=1},lt=t9();F>0&&(F+=lt),$+=lt;for(const it of N){const st=[],_t=[];for(const gt of it){const yt=gt.x+H.x,Qe=gt.y+H.y,bt=k.projection.projectTilePoint(yt,Qe,ge),pt=k.projection.upVector(ge,gt.x,gt.y);let vt=F,wt=$;if(q){const Zt=h9(yt,Qe,F,$,q,X,te,se);vt+=Zt.base,wt+=Zt.top}F!==0?Be(xe,bt.x+pt[0]*Te*vt,bt.y+pt[1]*Te*vt,bt.z+pt[2]*Te*vt):Be(xe,bt.x,bt.y,bt.z),Be(Oe,bt.x+pt[0]*Te*wt,bt.y+pt[1]*Te*wt,bt.z+pt[2]*Te*wt),ui(xe,xe,K),ui(Oe,Oe,K),st.push(new Xg(xe[0],xe[1],xe[2])),_t.push(new Xg(Oe[0],Oe[1],Oe[2]))}me.push(st),Ee.push(_t)}return[me,Ee]}(u,r,c,d,p,y,_,v,T,S,O):_?function(k,N,F,$,H,K,q,X,te){const se=[],ge=[],me=[0,0,0,1];for(const Ee of k){const Te=[],xe=[];for(const Oe of Ee){const Be=Oe.x+$.x,lt=Oe.y+$.y,it=h9(Be,lt,N,F,K,q,X,te);me[0]=Be,me[1]=lt,me[2]=it.base,me[3]=1,zs(me,me,H),me[3]=Math.max(me[3],1e-5);const st=new Xg(me[0]/me[3],me[1]/me[3],me[2]/me[3]);me[0]=Be,me[1]=lt,me[2]=it.top,me[3]=1,zs(me,me,H),me[3]=Math.max(me[3],1e-5);const _t=new Xg(me[0]/me[3],me[1]/me[3],me[2]/me[3]);Te.push(st),xe.push(_t)}se.push(Te),ge.push(xe)}return[se,ge]}(r,c,d,p,y,_,v,T,S):function(k,N,F,$,H){const K=[],q=[],X=H[8]*N,te=H[9]*N,se=H[10]*N,ge=H[11]*N,me=H[8]*F,Ee=H[9]*F,Te=H[10]*F,xe=H[11]*F;for(const Oe of k){const Be=[],lt=[];for(const it of Oe){const st=it.x+$.x,_t=it.y+$.y,gt=H[0]*st+H[4]*_t+H[12],yt=H[1]*st+H[5]*_t+H[13],Qe=H[2]*st+H[6]*_t+H[14],bt=H[3]*st+H[7]*_t+H[15],pt=gt+X,vt=yt+te,wt=Qe+se,Zt=Math.max(bt+ge,1e-5),Kt=gt+me,$t=yt+Ee,Ut=Qe+Te,gn=Math.max(bt+xe,1e-5);Be.push(new Xg(pt/Zt,vt/Zt,wt/Zt)),lt.push(new Xg(Kt/gn,$t/gn,Ut/gn))}K.push(Be),q.push(lt)}return[K,q]}(r,c,d,p,y)}function h9(u,r,c,d,p,y,_,v){const T=_*p.getElevationAt(u,r,!0,!0),S=y[0]!==0,O=S?y[1]===0?_*(y[0]/7-450):_*function(k,N,F){const $=Math.floor(N[0]/8),H=Math.floor(N[1]/8),K=10*(N[0]-8*$),q=10*(N[1]-8*H),X=k.getElevationAt($,H,!0,!0),te=k.getMeterToDEM(F),se=Math.floor(.5*(K*te-1)),ge=Math.floor(.5*(q*te-1)),me=k.tileCoordToPixel($,H),Ee=2*se+1,Te=2*ge+1,xe=function(_t,gt,yt,Qe,bt){return[_t.getElevationAtPixel(gt,yt,!0),_t.getElevationAtPixel(gt+bt,yt,!0),_t.getElevationAtPixel(gt,yt+bt,!0),_t.getElevationAtPixel(gt+Qe,yt+bt,!0)]}(k,me.x-se,me.y-ge,Ee,Te),Oe=Math.abs(xe[0]-xe[1]),Be=Math.abs(xe[2]-xe[3]),lt=Math.abs(xe[0]-xe[2])+Math.abs(xe[1]-xe[3]),it=Math.min(.25,.5*te*(Oe+Be)/Ee),st=Math.min(.25,.5*te*lt/Te);return X+Math.max(it*K,st*q)}(p,y,v):T;return{base:T+(c===0?-1:c),top:S?Math.max(O+d,T+c+2):T+d}}class MQ{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class LQ{constructor(){this.tasks={},this.taskQueue=[],Xt(["process"],this),this.invoker=new MQ(this.process),this.nextId=0}add(r,c){const d=this.nextId++,p=function({type:y,isSymbolTile:_,zoom:v}){return v=v||0,y==="message"?0:y!=="maybePrepare"||_?y!=="parseTile"||_?y==="parseTile"&&_?300-v:y==="maybePrepare"&&_?400-v:500:200-v:100-v}(c);if(p===0){try{r()}finally{}return null}return this.tasks[d]={fn:r,metadata:c,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const c=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let r=null,c=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<c&&(c=y.priority,r=p)}if(r===null)return null;const d=this.taskQueue[r];return this.taskQueue.splice(r,1),d}remove(){this.invoker.remove()}}class f9{constructor(r,c,d){this.target=r,this.parent=c,this.mapId=d,this.callbacks={},this.cancelCallbacks={},Xt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new LQ}send(r,c,d,p,y=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=_,this.callbacks[v]=d);const T=new Set;return this.target.postMessage({id:v,type:r,hasCallback:!!d,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:El(c,T)},T),{cancel:()=>{d&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(r){const c=r.data;if(!c)return;const d=c.id;if(d&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const p=this.cancelCallbacks[d];delete this.cancelCallbacks[d],p&&p.cancel()}else if(c.mustQueue||Mr(self)){const p=this.callbacks[d],y=this.scheduler.add(()=>this.processTask(d,c),p&&p.metadata||{type:"message"});y&&(this.cancelCallbacks[d]=y)}else this.processTask(d,c)}processTask(r,c){if(delete this.cancelCallbacks[r],c.type==="<response>"){const d=this.callbacks[r];delete this.callbacks[r],d&&(c.error?d(Hu(c.error)):d(null,Hu(c.data)))}else{const d=new Set,p=c.hasCallback?(_,v)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:_?El(_):null,data:El(v,d)},d)}:()=>{},y=Hu(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,y,p);else if(this.parent.getWorkerSource){const _=c.type.split("."),{source:v,scope:T}=y;this.parent.getWorkerSource(c.sourceMapId,_[0],v,T)[_[1]](y,p)}else p(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ov={workerUrl:"",workerClass:null,workerParams:void 0};function BQ(u){return Ov.workerClass!=null?new Ov.workerClass:new self.Worker(Ov.workerUrl,Object.assign({name:u},Ov.workerParams))}const D6="mapboxgl_preloaded_worker_pool";class Jg{constructor(r){this.active={},this.name=r}acquire(r,c=Jg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;){const d=BQ(`${this.name||""}WorkerPool: ${r}-${this.workers.length}`);this.workers.push(d)}return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[D6]}numActive(){return Object.keys(this.active).length}}Jg.workerCount=2;class j_{constructor(r,c,d="Worker",p=Jg.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=It();const y=this.workerPool.acquire(this.id,p);for(let _=0;_<y.length;_++){const v=new j_.Actor(y[_],c,this.id);v.name=`${d} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,d){Ge(this.actors,(p,y)=>{p.send(r,c,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let kv,N6;function QC(){return kv||(kv=new Jg),kv}j_.Actor=f9;const M6=4096;class FQ{constructor(r){this.module=r,this.memoryStack=this.module.malloc(M6),this.memoryStackNextFree=this.memoryStack}createIntArray(r){const c=this.memoryStackNextFree;return this.memoryStackNextFree+=r.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>M6?-1:(new Int32Array(this.module.heap32.buffer,c,r.length).set(r),c)}createFloatArray(r){const c=this.memoryStackNextFree;return this.memoryStackNextFree+=r.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>M6?-1:(new Float32Array(this.module.heapF32.buffer,c,r.length).set(r),c)}readStringBuffer(r){let c="";for(;this.module.heapU8[r]!==0;)c+=String.fromCharCode(this.module.heapU8[r]),++r;return c}setStyle(r){const c=r.normalScale;this.module.setStyle(c[0],c[1],c[2],r.tileToMeters)}setAOOptions(r,c){this.module.setAOOptions(r?1:0,c)}setMetricOptions(r,c){this.module.setMetricOptions(r?1:0,c)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,c){this.module.setFacadeOptions(r,c?1:0)}setFauxFacadeOptions(r,c,d){this.module.setFauxFacadeOptions(r?1:0,c?1:0,d)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,c){this.memoryStackNextFree=this.memoryStack;for(const v of r){const T=this.createIntArray(v.ringIndices),S=this.createFloatArray(v.coordinates);if(T===-1||S===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,S,T,v.ringIndices.length-1)}for(const v of c){let T;T=v.entrances?JSON.parse(v.entrances):[];const S=this.createFloatArray(T),O=this.createFloatArray(v.coordinates);if(S===-1||O===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,S,T.length,O,v.coordinates.length)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const d=this.module.getMeshCount(),p=new Array(d);for(let v=0;v<d;v++){const T=this.module.getPositionsPtr(v),S=this.module.getPositionsLength(v),O=new Float32Array(this.module.heapF32.buffer,T,S),k=this.module.getNormalsPtr(v),N=this.module.getNormalsLength(v),F=new Float32Array(this.module.heapF32.buffer,k,N),$=this.module.getAOPtr(v),H=this.module.getAOLength(v),K=new Float32Array(this.module.heapF32.buffer,$,H),q=this.module.getUVPtr(v),X=this.module.getUVLength(v),te=new Float32Array(this.module.heapF32.buffer,q,X),se=this.module.getFauxFacadePtr(v),ge=this.module.getFauxFacadeLength(v),me=new Uint8Array(this.module.heapU8.buffer,se,ge),Ee=this.module.getIndicesPtr(v),Te=this.module.getIndicesLength(v),xe=new Int16Array(this.module.heap16.buffer,Ee,Te),Oe=this.module.getBuildingPart(v);p[v]={positions:O,normals:F,ao:K,uv:te,isFauxFacade:me,indices:xe,buildingPart:Oe}}const y=this.module.getRingCount(),_=[];for(let v=0;v<y;v++){const T=this.module.getRingPtr(v),S=this.module.getRingLength(v),O=new Float32Array(this.module.heapF32.buffer,T,S);_.push(O)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Dv,L6,Ku,V_,B6,W_=null,H_=null,p9=null,e5=null;function m9(){return Mr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:L6||fs.DRACO_URL}function g9(){if(Mr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(V_)return V_;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return V_=WebAssembly.validate(u)?fs.MESHOPT_SIMD_URL:fs.MESHOPT_URL,V_}function $Q(){return e5}const y9=5120,_9=5121,w9=5122,b9=5123,v9=5125,x9=5126,t5={[y9]:Int8Array,[_9]:Uint8Array,[w9]:Int16Array,[b9]:Uint16Array,[v9]:Uint32Array,[x9]:Float32Array},zQ={[y9]:"DT_INT8",[_9]:"DT_UINT8",[w9]:"DT_INT16",[b9]:"DT_UINT16",[v9]:"DT_UINT32",[x9]:"DT_FLOAT32"},Nv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function E9(u,r,c){const d=c.json.bufferViews.length,p=c.buffers.length;r.bufferView=d,c.json.bufferViews[d]={buffer:p,byteLength:u.byteLength},c.buffers[p]=u}const F6="KHR_draco_mesh_compression";function UQ(u,r){const c=u.extensions&&u.extensions[F6];if(!c)return;const d=new Ku.Decoder,p=S9(r,c.bufferView),y=new Ku.Mesh;if(!d.DecodeArrayToMesh(p,p.byteLength,y))throw new Error("Failed to decode Draco mesh");const _=r.json.accessors[u.indices],v=t5[_.componentType],T=_.count*v.BYTES_PER_ELEMENT,S=Ku._malloc(T);v===Uint16Array?d.GetTrianglesUInt16Array(y,T,S):d.GetTrianglesUInt32Array(y,T,S),E9(Ku.memory.buffer.slice(S,S+T),_,r),Ku._free(S);for(const O of Object.keys(c.attributes)){const k=d.GetAttributeByUniqueId(y,c.attributes[O]),N=r.json.accessors[u.attributes[O]],F=zQ[N.componentType],$=N.count*Nv[N.type]*t5[N.componentType].BYTES_PER_ELEMENT,H=Ku._malloc($);d.GetAttributeDataArrayForAllPoints(y,k,Ku[F],$,H),E9(Ku.memory.buffer.slice(H,H+$),N,r),Ku._free(H)}d.destroy(),y.destroy(),delete u.extensions[F6]}const n5="EXT_meshopt_compression";function jQ(u,r){if(!u.extensions||!u.extensions[n5])return;const c=u.extensions[n5],d=new Uint8Array(r.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),p=new Uint8Array(c.count*c.byteStride);B6.decodeGltfBuffer(p,c.count,c.byteStride,d,c.mode,c.filter),u.buffer=r.buffers.length,u.byteOffset=0,r.buffers[u.buffer]=p.buffer,delete u.extensions[n5]}const C9=1179937895,T9=new TextDecoder("utf8");function A9(u,r){return new URL(u,r).href}function VQ(u,r,c,d){return fetch(A9(u.uri,d)).then(p=>p.arrayBuffer()).then(p=>{r.buffers[c]=p})}function S9(u,r){const c=u.json.bufferViews[r];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function WQ(u,r,c,d){if(u.uri){const p=A9(u.uri,d);return fetch(p).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{r.images[c]=y})}if(u.bufferView!==void 0){const p=S9(r,u.bufferView),y=new Blob([p],{type:u.mimeType});return createImageBitmap(y).then(_=>{r.images[c]=_})}}function I9(u,r=0,c){const d={json:null,images:[],buffers:[]};if(new Uint32Array(u,r,1)[0]===C9){const O=new Uint32Array(u,r);let k=2;const N=(O[k++]>>2)-3,F=O[k++]>>2;if(k++,d.json=JSON.parse(T9.decode(O.subarray(k,k+F))),k+=F,k<N){const $=O[k++];k++;const H=r+(k<<2);d.buffers[0]=u.slice(H,H+$)}}else d.json=JSON.parse(T9.decode(new Uint8Array(u,r)));const{buffers:p,images:y,meshes:_,extensionsUsed:v,bufferViews:T}=d.json;let S=Promise.resolve();if(p){const O=[];for(let k=0;k<p.length;k++){const N=p[k];N.uri?O.push(VQ(N,d,k,c)):d.buffers[k]||(d.buffers[k]=null)}S=Promise.all(O)}return S.then(()=>{const O=[],k=v&&v.includes(F6),N=v&&v.includes(n5);if(k&&O.push(function(){if(!Ku)return Dv??(Dv=function(F){let $,H=null;function K(){$=new Uint8Array(H.buffer)}function q(){throw new Error("Unexpected Draco error.")}const X={a:{a:q,d:function(te,se,ge){return $.copyWithin(te,se,se+ge)},c:function(te){const se=$.length,ge=Math.max(te>>>0,Math.ceil(1.2*se)),me=Math.ceil((ge-se)/65536);try{return H.grow(me),K(),!0}catch{return!1}},b:q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,X):F.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,X))).then(te=>{const{Rb:se,Qb:ge,P:me,T:Ee,X:Te,Ja:xe,La:Oe,Qa:Be,Va:lt,Wa:it,eb:st,jb:_t,f:gt,e:yt,yb:Qe,zb:bt,Ab:pt,Bb:vt,Db:wt,Gb:Zt}=te.instance.exports;H=yt;const Kt=(()=>{let $t=0,Ut=0,gn=0,an=0;return Wt=>{gn&&(se(an),se($t),Ut+=gn,gn=$t=0),$t||(Ut+=128,$t=ge(Ut));const Rn=Wt.length+7&-8;let Qn=$t;Rn>=Ut&&(gn=Rn,Qn=an=ge(Rn));for(let Ai=0;Ai<Wt.length;Ai++)$[Qn+Ai]=Wt[Ai];return Qn}})();return K(),gt(),{memory:yt,_free:se,_malloc:ge,Mesh:class{constructor(){this.ptr=me()}destroy(){Ee(this.ptr)}},Decoder:class{constructor(){this.ptr=xe()}destroy(){_t(this.ptr)}DecodeArrayToMesh($t,Ut,gn){const an=Kt($t),Wt=Oe(this.ptr,an,Ut,gn.ptr);return!!Te(Wt)}GetAttributeByUniqueId($t,Ut){return{ptr:Be(this.ptr,$t.ptr,Ut)}}GetTrianglesUInt16Array($t,Ut,gn){lt(this.ptr,$t.ptr,Ut,gn)}GetTrianglesUInt32Array($t,Ut,gn){it(this.ptr,$t.ptr,Ut,gn)}GetAttributeDataArrayForAllPoints($t,Ut,gn,an,Wt){st(this.ptr,$t.ptr,Ut.ptr,gn,an,Wt)}},DT_INT8:Qe(),DT_UINT8:bt(),DT_INT16:pt(),DT_UINT16:vt(),DT_UINT32:wt(),DT_FLOAT32:Zt()}})}(fetch(m9())),Dv.then(F=>{Ku=F,Dv=void 0}))}()),N&&O.push(function(){if(B6)return;const F=function($){let H;const K=WebAssembly.instantiateStreaming($,{}).then(te=>{H=te.instance,H.exports.__wasm_call_ctors()}),q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(te,se,ge,me,Ee,Te){(function(xe,Oe,Be,lt,it,st,_t){const gt=xe.exports.sbrk,yt=lt+3&-4,Qe=gt(yt*it),bt=gt(st.length),pt=new Uint8Array(xe.exports.memory.buffer);pt.set(st,bt);const vt=Oe(Qe,lt,it,bt,st.length);if(vt===0&&_t&&_t(Qe,yt,it),Be.set(pt.subarray(Qe,Qe+lt*it)),gt(Qe-gt(0)),vt!==0)throw new Error(`Malformed buffer data: ${vt}`)})(H,H.exports[X[Ee]],te,se,ge,me,H.exports[q[Te]])}}}(fetch(g9()));return F.ready.then(()=>{B6=F})}()),y)for(let F=0;F<y.length;F++)O.push(WQ(y[F],d,F,c));return(O.length?Promise.all(O):Promise.resolve()).then(()=>{if(k&&_)for(const{primitives:F}of _)for(const $ of F)UQ($,d);if(N&&_&&T)for(const F of T)jQ(F,d);return d})})}function P9(u){return fetch(u).then(r=>r.arrayBuffer()).then(r=>I9(r,0,u))}function $6(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function z6(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class U6{constructor(r,c,d,p){this.context=r,this.format=d,this.useMipmap=p&&p.useMipmap,this.texture=r.gl.createTexture(),this.update(c,{premultiply:p&&p.premultiply})}update(r,c){const d=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,p=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:y}=this,{gl:_}=y,{x:v,y:T}=c&&c.position?c.position:{x:0,y:0},S=v+d,O=T+p;!this.size||this.size[0]===S&&this.size[1]===O||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!c||c.premultiply!==!1));const k=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&S>0&&O>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(S,O)))+1:1;_.texStorage2D(_.TEXTURE_2D,N,this.format,S,O),this.size=[S,O]}this.size&&(k?_.texSubImage2D(_.TEXTURE_2D,0,v,T,$6(this.format),z6(this.format),r):"data"in r&&r.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,T,d,p,$6(this.format),z6(this.format),r.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(r,c,d=!1){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),r!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!d?r===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),c!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,c),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(r,c,d,p,y){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),c!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,c),this.magFilter=c),r!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?r===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),d!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,d),this.wrapS=d),p!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,p),this.wrapT=p),y!==this.compareMode&&(y?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,y)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=y)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Mv{constructor(r,c){this.context=r,this.texture=c}bind(r,c){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,r),this.minFilter=r),c!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapS=c)}}const HQ=ii([{name:"a_pos_3f",components:3,type:"Float32"}]),GQ=ii([{name:"a_color_3f",components:3,type:"Float32"}]),qQ=ii([{name:"a_color_4f",components:4,type:"Float32"}]),ZQ=ii([{name:"a_uv_2f",components:2,type:"Float32"}]),KQ=ii([{name:"a_normal_3f",components:3,type:"Float32"}]),YQ=ii([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),XQ=ii([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function R9(u,r){const c=i5(u.projection,u.zoom,u.width,u.height),d=function(y,_,v,T,S){const O=new ye(v.lng-180*Lp,v.lat),k=new ye(v.lng+180*Lp,v.lat),N=y.project(O.lng,O.lat),F=y.project(k.lng,k.lat),$=-Math.atan2(F.y-N.y,F.x-N.x),H=jt.fromLngLat(v);H.y=ve(H.y,-1+Lp,1-Lp);const K=H.toLngLat(),q=y.project(K.lng,K.lat),X=jt.fromLngLat(K);X.x+=Lp;const te=X.toLngLat(),se=y.project(te.lng,te.lat),ge=k9(se.x-q.x,se.y-q.y,$),me=jt.fromLngLat(K);me.y+=Lp;const Ee=me.toLngLat(),Te=y.project(Ee.lng,Ee.lat),xe=k9(Te.x-q.x,Te.y-q.y,$),Oe=Math.abs(ge.x)/Math.abs(xe.y),Be=G([]);ke(Be,Be,-$*(1-(S?0:T)));const lt=G([]);return de(lt,lt,[1,1-(1-Oe)*T,1]),lt[4]=-xe.x/xe.y*T,ke(lt,lt,$),oe(lt,Be,lt),lt}(u.projection,0,u.center,c,r),p=O9(u);return de(d,d,[p,p,1]),d}function O9(u){const r=u.projection,c=i5(u.projection,u.zoom,u.width,u.height),d=j6(r,u.center),p=j6(r,ye.convert(r.center));return Math.pow(2,d*c+(1-c)*p)}function i5(u,r,c,d,p=1/0){const y=u.range;if(!y)return 0;const _=Math.min(p,Math.max(c,d)),v=Math.log2(_/1024);return Ve(y[0]+v,y[1]+v,r)}const Lp=1/4e4;function j6(u,r){const c=ve(r.lat,-85.051129,Me),d=new ye(r.lng-180*Lp,c),p=new ye(r.lng+180*Lp,c),y=u.project(d.lng,c),_=u.project(p.lng,c),v=jt.fromLngLat(d),T=jt.fromLngLat(p),S=_.x-y.x,O=_.y-y.y,k=T.x-v.x,N=T.y-v.y,F=Math.sqrt((k*k+N*N)/(S*S+O*O));return Math.log2(F)}function k9(u,r,c){const d=Math.cos(c),p=Math.sin(c);return{x:u*d-r*p,y:u*p+r*d}}function D9(u,r,c){G(u),ke(u,u,_i(r[2])),he(u,u,_i(r[0])),Ie(u,u,_i(r[1])),de(u,u,c),oe(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function r5(u,r,c,d,p,y,_,v){const T=[c[0]-r[0],c[1]-r[1],0],S=[d[0]-r[0],d[1]-r[1],0];if(re(T)<1e-12||re(S)<1e-12)return co(u);const O=ai([],T,S);sn(O,O),De(S,d,r),T[2]=(y-p)*v,S[2]=(_-p)*v;const k=T;return ai(k,T,S),sn(k,k),$o(u,O,k)}function s5(u,r,c=!1){const d=kp(r.zoom),p=function(y,_,v){const T=_.worldSize,S=[y[12],y[13],y[14]],O=xt(S[1]/T),k=mt(S[0]/T),N=G([]),F=Je(1,O)*T,$=Je(1,0)*T*nt(O,_.zoom),H=1/u6(T);let K=$*H;if(v){const se=i5(_.projection,_.zoom,_.width,_.height,1024);K=H*_.projection.pixelSpaceConversion(_.center.lat,T,se)}const q=Ce(O,k);Le(q,q,Dt([],sn([],q),F*K*S[2]));const X=function(se){const ge=[se[0],se[1],se[2]];let me=[0,1,0];const Ee=ai([],me,ge);return ai(me,ge,Ee),mn(me)===0&&(me=[0,1,0],ai(Ee,ge,me)),sn(Ee,Ee),sn(me,me),sn(ge,ge),[Ee[0],Ee[1],Ee[2],0,me[0],me[1],me[2],0,ge[0],ge[1],ge[2],0,se[0],se[1],se[2],1]}(q);de(N,N,[K,K,K*F]),Q(N,N,[-S[0],-S[1],-S[2]]);const te=oe([],_.globeMatrix,X);return oe(te,te,N),oe(te,te,y),te}(u,r,c);if(d>0){const y=function(_,v){const T=v.worldSize,S=Je(1,0)*T*nt(v.center.lat,v.zoom)/u6(T),O=Je(1,v.center.lat)*T,k=G([]);Ie(k,k,_i(v.center.lng)),he(k,k,_i(v.center.lat)),Q(k,k,[0,0,J]),de(k,k,[S,S,S*O]);const N=v.point;return Q(k,k,[-N.x,-N.y,0]),oe(k,k,_),oe(k,v.globeMatrix,k)}(u,r);return function(_,v,T){const S=($,H,K)=>{const q=re($),X=re(H),te=nf($,H,K);return Dt(te,te,1/re(te)*xn(q,X,K))},O=S([_[0],_[1],_[2]],[v[0],v[1],v[2]],T),k=S([_[4],_[5],_[6]],[v[4],v[5],v[6]],T),N=S([_[8],_[9],_[10]],[v[8],v[9],v[10]],T),F=nf([_[12],_[13],_[14]],[v[12],v[13],v[14]],T);return[O[0],O[1],O[2],0,k[0],k[1],k[2],0,N[0],N[1],N[2],0,F[0],F[1],F[2],1]}(p,y,d)}return p}function V6(u,r,c,d){const p=Ri.projectAabbCorners(d,c);let y=Number.MAX_VALUE;for(let v=0;v<p.length;++v){const T=p[v];T[0]=(.5*T[0]+.5)*r.width,T[1]=(.5-.5*T[1])*r.height,T[2]<y&&(y=T[2])}const _=function(v){const T=[];let S=0;for(let F=1;F<v.length;F++)(v[F][0]<v[S][0]||v[F][0]===v[S][0]&&v[F][1]<v[S][1])&&(S=F);let O,k=S;const N=new Uint8Array(v.length);do{if(N[k])break;T.push(new Tt(v[k][0],v[k][1])),N[k]=1,O=(k+1)%v.length;for(let F=0;F<v.length;F++){if(v[F][0]===v[O][0]&&v[F][1]===v[O][1]||v[F][0]===v[k][0]&&v[F][1]===v[k][1])continue;const $=[v[F][0]-v[k][0],v[F][1]-v[k][1]],H=[v[O][0]-v[k][0],v[O][1]-v[k][1]],K=$[0]*H[1]-$[1]*H[0];(K>0||K===0&&$[0]*H[0]+$[1]*H[1]>=0&&$[0]*$[0]+$[1]*$[1]>H[0]*H[0]+H[1]*H[1])&&(O=F)}k=O}while(k!==S);return T.length>0&&T.push(T[0]),T}(p);if(gr(u,_))return y}const Qg=64,G_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function o5(u,r,c,d,p,y,_,v,T,S=!1){const O=c.zoom,k=c.project(d),N=nt(d.lat,O),F=1/N;G(u),Q(u,u,[k.x+_[0]*F,k.y+_[1]*F,_[2]]);let $=1,H=1;const K=c.worldSize;if(S){if(c.projection.name==="mercator"){let se=0;c.elevation&&(se=c.elevation.getAtPointOrZero(new jt(k.x/K,k.y/K),0));const ge=zs([],[k.x,k.y,se,1],c.projMatrix)[3]/c.cameraToCenterDistance;$=ge,H=ge*nt(c.center.lat,O)}else if(c.projection.name==="globe"){const se=s5(u,c),ge=[0,0,0,1];zs(ge,ge,oe([],c.projMatrix,se));const me=ge[3]/c.cameraToCenterDistance,Ee=kp(O),Te=c.projection.pixelsPerMeter(d.lat,K)*nt(d.lat,O),xe=c.projection.pixelsPerMeter(c.center.lat,K)*nt(c.center.lat,O);$=me/xn(Te,dt(c.center.lat),Ee),H=me*N/Te,$*=xe,H*=xe}}else $=F;de(u,u,[$,$,H]);const q=[...u],X=r.orientation,te=[];if(D9(te,[X[0]+(p?p[0]:0),X[1]+(p?p[1]:0),X[2]+(p?p[2]:0)],y),oe(u,q,te),v&&c.elevation){let se=0;const ge=[];if(T&&c.elevation){se=function(Ee,Te,xe,Oe,Be){const lt=Te.elevation;if(!lt)return 0;const it=Ri.projectAabbCorners(xe,Oe),st=Je(1,Be.lat)*Te.worldSize,_t=function(Ut,gn){const an=[0,0,1],Wt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Rn of Wt){const Qn=Ut[Rn.corners[0]],Ai=Ut[Rn.corners[1]],Xn=Ut[Rn.corners[2]],ji=[Ai[0]-Qn[0],Ai[1]-Qn[1],gn*(Ai[2]-Qn[2])],pi=ai(ji,ji,[Xn[0]-Qn[0],Xn[1]-Qn[1],gn*(Xn[2]-Qn[2])]);sn(pi,pi),Rn.dotProductWithUp=_n(pi,an)}return Wt.sort((Rn,Qn)=>Rn.dotProductWithUp-Qn.dotProductWithUp),Wt[0].corners}(it,st),gt=it[_t[0]],yt=it[_t[1]],Qe=it[_t[2]],bt=it[_t[3]],pt=lt.getAtPointOrZero(new jt(gt[0]/Te.worldSize,gt[1]/Te.worldSize),0),vt=lt.getAtPointOrZero(new jt(yt[0]/Te.worldSize,yt[1]/Te.worldSize),0),wt=lt.getAtPointOrZero(new jt(Qe[0]/Te.worldSize,Qe[1]/Te.worldSize),0),Zt=lt.getAtPointOrZero(new jt(bt[0]/Te.worldSize,bt[1]/Te.worldSize),0),Kt=(pt+Zt)/2,$t=(vt+wt)/2;return Kt>$t?vt<wt?r5(Ee,yt,bt,gt,vt,Zt,pt,st):r5(Ee,Qe,gt,bt,wt,pt,Zt,st):pt<Zt?r5(Ee,gt,yt,Qe,pt,vt,wt,st):r5(Ee,bt,Qe,yt,Zt,wt,vt,st),Math.max(Kt,$t)}(ge,c,r.aabb,u,d);const me=oe([],ft([],ge),te);oe(u,q,me)}else se=c.elevation.getAtPointOrZero(new jt(k.x/K,k.y/K),0);se!==0&&(u[14]+=se)}}class N9{constructor(r,c,d,p,y){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=r,this.uri=c,this.position=d!=null?new ye(d[0],d[1]):new ye(0,0),this.orientation=p??[0,0,0],this.nodes=y,this.uploaded=!1,this.aabb=new Ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,c){oe(r.globalMatrix,c,r.localMatrix);const d=this.nodeOverrides.get(r.name);if(d!==void 0){const _=[];y=d.orientation,G(p=_),Ie(p,p,_i(y[1])),ke(p,p,_i(y[2])),he(p,p,_i(y[0])),oe(r.globalMatrix,r.globalMatrix,_)}var p,y;if(r.meshes)for(const _ of r.meshes){const v=Ri.applyTransformFast(_.aabb,r.globalMatrix);this.aabb.encapsulate(v)}if(r.children)for(const _ of r.children)this._applyTransformations(_,r.globalMatrix)}computeBoundsAndApplyParent(){const r=G([]);this.aabb=new Ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.nodes)this._applyTransformations(c,r)}computeModelMatrix(r,c,d,p,y,_,v=!1){o5(this.matrix,this,r.transform,this.position,c,d,p,y,_,v)}upload(r){if(!this.uploaded){for(const c of this.nodes)W6(c,r);for(const c of this.nodes)a5(c);this.uploaded=!0}}destroy(){for(const r of this.nodes)H6(r)}}function Lv(u,r,c=!1){u.uploaded||(u.gfxTexture=new U6(r,u.image,c?r.gl.R8:r.gl.RGBA8,{useMipmap:u.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function JQ(u,r,c){u.indexBuffer=r.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=r.createVertexBuffer(u.vertexArray,HQ.members,!1,!0),u.normalArray&&(u.normalBuffer=r.createVertexBuffer(u.normalArray,KQ.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=r.createVertexBuffer(u.texcoordArray,ZQ.members,!1,!0)),u.colorArray&&(u.colorBuffer=r.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?GQ:qQ).members,!1,!0)),u.featureArray&&(u.pbrBuffer=r.createVertexBuffer(u.featureArray,XQ.members,!0)),u.segments=hr.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const d=u.material;d.pbrMetallicRoughness.baseColorTexture&&Lv(d.pbrMetallicRoughness.baseColorTexture,r),d.pbrMetallicRoughness.metallicRoughnessTexture&&Lv(d.pbrMetallicRoughness.metallicRoughnessTexture,r),d.normalTexture&&Lv(d.normalTexture,r),d.occlusionTexture&&Lv(d.occlusionTexture,r,c),d.emissionTexture&&Lv(d.emissionTexture,r)}function W6(u,r,c){if(u.meshes)for(const d of u.meshes)JQ(d,r,c);if(u.children)for(const d of u.children)W6(d,r,c)}function a5(u){if(u.meshes)for(const r of u.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(u.children)for(const r of u.children)a5(r)}function QQ(u){u.pbrMetallicRoughness.baseColorTexture&&u.pbrMetallicRoughness.baseColorTexture.gfxTexture&&u.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),u.pbrMetallicRoughness.metallicRoughnessTexture&&u.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&u.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),u.normalTexture&&u.normalTexture.gfxTexture&&u.normalTexture.gfxTexture.destroy(),u.emissionTexture&&u.emissionTexture.gfxTexture&&u.emissionTexture.gfxTexture.destroy(),u.occlusionTexture&&u.occlusionTexture.gfxTexture&&u.occlusionTexture.gfxTexture.destroy()}function H6(u){if(u.meshes)for(const r of u.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&QQ(r.material));if(u.children)for(const r of u.children)H6(r)}function e0(u,r){const c=u.json.bufferViews[r.bufferView],d=t5[r.componentType];return new d(u.buffers[c.buffer],(r.byteOffset||0)+(c.byteOffset||0),r.count*(c.byteStride&&c.byteStride!==Nv[r.type]*d.BYTES_PER_ELEMENT?c.byteStride/d.BYTES_PER_ELEMENT:Nv[r.type]))}function G6(u,r,c,d){const p=t5[r.componentType],y=function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),_=u.json.bufferViews[r.bufferView],v=_.byteStride?_.byteStride/p.BYTES_PER_ELEMENT:Nv[r.type],T=c.float32,S=T.length/c.capacity;for(let O=0,k=0;O<r.count*v;O+=v,k+=S)for(let N=0;N<S;N++)T[k+N]=d[O+N]*y;c._trim()}function eee(u,r,c){const d=u.indices,p=u.attributes,y={};y.indexArray=new ms;const _=r.json.accessors[d],v=_.count/3;y.indexArray.reserve(v);const T=e0(r,_);for(let N=0;N<v;N++)y.indexArray.emplaceBack(T[3*N],T[3*N+1],T[3*N+2]);y.indexArray._trim(),y.vertexArray=new Wc;const S=r.json.accessors[p.POSITION];y.vertexArray.reserve(S.count);const O=e0(r,S);for(let N=0;N<S.count;N++)y.vertexArray.emplaceBack(O[3*N],O[3*N+1],O[3*N+2]);if(y.vertexArray._trim(),y.aabb=new Ri(S.min,S.max),y.centroid=function(N,F){const $=[0,0,0],H=N.length;if(H>0){for(let K=0;K<H;K++){const q=3*N[K];$[0]+=F[q],$[1]+=F[q+1],$[2]+=F[q+2]}$[0]/=H,$[1]/=H,$[2]/=H}return $}(T,O),p.COLOR_0!==void 0){const N=r.json.accessors[p.COLOR_0],F=Nv[N.type],$=e0(r,N);y.colorArray=F===3?new Wc:new Zd,y.colorArray.resize(N.count),G6(r,N,y.colorArray,$)}if(p.NORMAL!==void 0){y.normalArray=new Wc;const N=r.json.accessors[p.NORMAL];y.normalArray.resize(N.count);const F=e0(r,N);G6(r,N,y.normalArray,F)}if(p.TEXCOORD_0!==void 0&&c.length>0){y.texcoordArray=new ef;const N=r.json.accessors[p.TEXCOORD_0];y.texcoordArray.resize(N.count);const F=e0(r,N);G6(r,N,y.texcoordArray,F)}if(p._FEATURE_ID_RGBA4444!==void 0){const N=r.json.accessors[p._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=e0(r,N))}p._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(e0(r,r.json.accessors[p._FEATURE_RGBA4444]).buffer));const k=u.material;return y.material=function(N,F){const{emissiveFactor:$=[0,0,0],alphaMode:H="OPAQUE",alphaCutoff:K=.5,normalTexture:q,occlusionTexture:X,emissiveTexture:te,doubleSided:se,name:ge}=N,{baseColorFactor:me=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Te=1,baseColorTexture:xe,metallicRoughnessTexture:Oe}=N.pbrMetallicRoughness||{},Be=X?F[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&Be){const lt=X.extensions.KHR_texture_transform;Be.offsetScale=[lt.offset[0],lt.offset[1],lt.scale[0],lt.scale[1]]}return{name:ge,pbrMetallicRoughness:{baseColorFactor:new Di(...me),metallicFactor:Ee,roughnessFactor:Te,baseColorTexture:xe?F[xe.index]:void 0,metallicRoughnessTexture:Oe?F[Oe.index]:void 0},doubleSided:se,emissiveFactor:new Di(...$),alphaMode:H,alphaCutoff:K,normalTexture:q?F[q.index]:void 0,occlusionTexture:Be,emissionTexture:te?F[te.index]:void 0,defined:N.defined===void 0}}(k!==void 0?r.json.materials[k]:{defined:!1},c),y}function M9(u,r,c){const{matrix:d,rotation:p,translation:y,scale:_,mesh:v,extras:T,children:S,name:O}=u,k={};if(k.name=O,k.localMatrix=d||function(N,F,$,H){var K=F[0],q=F[1],X=F[2],te=F[3],se=K+K,ge=q+q,me=X+X,Ee=K*se,Te=K*ge,xe=K*me,Oe=q*ge,Be=q*me,lt=X*me,it=te*se,st=te*ge,_t=te*me,gt=H[0],yt=H[1],Qe=H[2];return N[0]=(1-(Oe+lt))*gt,N[1]=(Te+_t)*gt,N[2]=(xe-st)*gt,N[3]=0,N[4]=(Te-_t)*yt,N[5]=(1-(Ee+lt))*yt,N[6]=(Be+it)*yt,N[7]=0,N[8]=(xe+st)*Qe,N[9]=(Be-it)*Qe,N[10]=(1-(Ee+Oe))*Qe,N[11]=0,N[12]=$[0],N[13]=$[1],N[14]=$[2],N[15]=1,N}([],p||[0,0,0,1],y||[0,0,0],_||[1,1,1]),k.globalMatrix=U(k.localMatrix),v!==void 0){k.meshes=c[v];const N=k.anchor=[0,0];for(const F of k.meshes){const{min:$,max:H}=F.aabb;N[0]+=$[0]+H[0],N[1]+=$[1]+H[1]}N[0]=Math.floor(N[0]/k.meshes.length/2),N[1]=Math.floor(N[1]/k.meshes.length/2)}if(T&&(T.id&&(k.id=T.id),T.lights&&(k.lights=function(N){if(!N.length)return[];const F=function(X){const te=atob(X),se=new Uint8Array(te.length);for(let ge=0;ge<te.length;ge++)se[ge]=te.codePointAt(ge);return se}(N),$=[],H=F.length/24,K=new Uint16Array(F.buffer),q=new Float32Array(F.buffer);for(let X=0;X<H;X++){const te=K[2*X*6]/30,se=K[2*X*6+1]/30,ge=K[2*X*6+10]/100,me=q[6*X+1],Ee=q[6*X+2],Te=q[6*X+3],xe=q[6*X+4],Oe=Te-me,Be=xe-Ee,lt=Math.hypot(Oe,Be);$.push({pos:[me+.5*Oe,Ee+.5*Be,se],normal:[Be/lt,-Oe/lt,0],width:lt,height:te,depth:ge,points:[me,Ee,Te,xe]})}return $}(T.lights)),T.MAPBOX_geometry_bloom&&(k.isGeometryBloom=T.MAPBOX_geometry_bloom)),S){const N=[];for(const F of S)N.push(M9(r.json.nodes[F],r,c));k.children=N}return k}function tee(u){if(u.vertices.length===0||u.indices.length===0)return null;const r=new qC(u.vertices,u.indices,8,256),[c,d]=[r.min.clone(),r.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:r,min:c,max:d}}function nee(u){if(!u.extras||!u.extras.ground)return null;const r=u.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const c=r[0];if(!c||!Array.isArray(c)||c.length===0)return null;const d=[];for(const _ of c){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],T=_[1];typeof v=="number"&&typeof T=="number"&&d.push(new Tt(v,T))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let p=0;for(let _=0;_<d.length;_++){const v=d[_],T=d[(_+1)%d.length],S=d[(_+2)%d.length];p+=(v.x-T.x)*(S.y-T.y)-(S.x-T.x)*(v.y-T.y)}p>0&&d.reverse();const y=F_(d.flatMap(_=>[_.x,_.y]),[]);return y.length===0?null:{vertices:d,indices:y}}function iee(u,r){const c=[],d=[];let p=0;const y=[];for(const _ of u){p=c.length;const v=_.vertexArray.float32,T=_.indexArray.uint16;for(let S=0;S<_.vertexArray.length;S++)y[0]=v[3*S+0],y[1]=v[3*S+1],y[2]=v[3*S+2],ui(y,y,r),c.push(new Tt(y[0],y[1]));for(let S=0;S<3*_.indexArray.length;S++)d.push(T[S]+p)}if(d.length%3!=0)return null;for(let _=0;_<d.length;_+=3){const v=c[d[_+0]],T=c[d[_+1]],S=c[d[_+2]];(v.x-T.x)*(S.y-T.y)-(S.x-T.x)*(v.y-T.y)>0&&([d[_+1],d[_+2]]=[d[_+2],d[_+1]])}return{vertices:c,indices:d}}function q6(u){const r=function(T,S){const O=[],k=WebGL2RenderingContext;if(T.json.textures)for(const N of T.json.textures){const F={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};N.sampler!==void 0&&Object.assign(F,T.json.samplers[N.sampler]),O.push({image:S[N.source],sampler:F,uploaded:!1})}return O}(u,u.images),c=function(T,S){const O=[];for(const k of T.json.meshes){const N=[];for(const F of k.primitives)N.push(eee(F,T,S));O.push(N)}return O}(u,r),{scenes:d,scene:p,nodes:y}=u.json,_=d?d[p||0].nodes:[...y.keys()],v=[];for(const T of _)v.push(M9(y[T],u,c));return function(T,S,O){const k={},N=new Set;for(let F=0;F<T.length;F++){const $=O[S[F]];if(!$.extras)continue;const H=$.extras["mapbox:footprint:version"],K=$.extras["mapbox:footprint:id"];(H||K)&&N.add(F),H==="1.0.0"&&K&&(k[K]=F)}for(let F=0;F<T.length;F++){if(N.has(F))continue;const $=T[F],H=O[S[F]];if(!H.extras)continue;let K=null;$.id in k&&(K=iee(T[k[$.id]].meshes,$.localMatrix)),K||(K=nee(H)),K&&($.footprint=tee(K))}if(N.size>0){const F=Array.from(N.values()).sort(($,H)=>$-H);for(let $=F.length-1;$>=0;$--)T.splice(F[$],1)}}(v,_,u.json.nodes),v}function ree(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const r=u.vertexArray.float32,c=u.aabb.min[0]-1,d=u.aabb.min[1]-1,p=Qg/(u.aabb.max[0]-c+2),y=Qg/(u.aabb.max[1]-d+2);for(let _=0;_<r.length;_+=3){const v=r[_+2],T=(r[_+0]-c)*p|0,S=(r[_+1]-d)*y|0;v>u.heightmap[S*Qg+T]&&(u.heightmap[S*Qg+T]=v)}}function L9(u,r,c,d,p){c.reserve(c.length+4*u.length),d.reserve(d.length+10*u.length),p.reserve(p.length+10*u.length);let y=d.length;for(const _ of u){const v=Math.min(10,Math.max(4,1.3*_.height))*r,T=[-_.normal[1],_.normal[0],0],S=Math.min(.29,.1*_.width/_.depth),O=_.width-2*_.depth*r*(S+.01),k=Bt([],_.pos,T,O/2),N=Bt([],_.pos,T,-O/2),F=[k[0],k[1],k[2]+_.height],$=[N[0],N[1],N[2]+_.height],H=Bt([],_.normal,T,S);Dt(H,H,v);const K=Bt([],_.normal,T,-S);Dt(K,K,v),Le(H,k,H),Le(K,N,K),k[2]+=.1,N[2]+=.1,d.emplaceBack(H[0],H[1],H[2]),d.emplaceBack(K[0],K[1],K[2]),d.emplaceBack(k[0],k[1],k[2]),d.emplaceBack(N[0],N[1],N[2]),d.emplaceBack(F[0],F[1],F[2]),d.emplaceBack($[0],$[1],$[2]),d.emplaceBack(k[0],k[1],k[2]),d.emplaceBack(N[0],N[1],N[2]),d.emplaceBack(H[0],H[1],H[2]),d.emplaceBack(K[0],K[1],K[2]);const q=O/v/2;p.emplaceBack(-q-S,-1,q,.8),p.emplaceBack(q+S,-1,q,.8),p.emplaceBack(-q,0,q,1.3),p.emplaceBack(q,0,q,1.3),p.emplaceBack(q+S,-.8,q,.7),p.emplaceBack(q+S,-.8,q,.7),p.emplaceBack(0,0,q,1.3),p.emplaceBack(0,0,q,1.3),p.emplaceBack(q+S,-1.2,q,.8),p.emplaceBack(q+S,-1.2,q,.8),c.emplaceBack(6+y,4+y,8+y),c.emplaceBack(7+y,9+y,5+y),c.emplaceBack(0+y,1+y,2+y),c.emplaceBack(1+y,3+y,2+y),y+=10}}function see(u,r){const c={};c.indexArray=new ms,c.vertexArray=new Wc,c.colorArray=new Zd,L9(u,r,c.indexArray,c.vertexArray,c.colorArray);const d={defined:!0};d.emissiveFactor=Di.black;const p={};return p.baseColorFactor=Di.white,d.pbrMetallicRoughness=p,c.material=d,c.aabb=new Ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}const B9=ii([{name:"a_pos_3f",components:3,type:"Float32"}]),oee=ii([{name:"a_normal_3",components:3,type:"Int16"}]),aee=ii([{name:"a_centroid_3",components:3,type:"Int16"}]),F9=ii([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),cee=ii([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),lee=ii([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),uee=ii([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),dee=ii([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),hee=ii([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),$9=ci.types,c5=32767;function fee(u,r){const c=zt+r;for(const d of u)for(const p of d)if(p.x<-r||p.x>c||p.y<-r||p.y>c)return!1;return!0}function pee(u){switch(u){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${u}`)}}class Z6{constructor(){this.layoutVertexArray=new Wc,this.layoutAttenuationArray=new Zd,this.layoutColorArray=new hc,this.indexArray=new ms,this.indexArrayForConflation=new ms,this.segmentsBucket=new hr}}class K6{constructor(r){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new hr,this.entranceBloom=new Z6;const c=66560;this.layoutVertexArray=new Wc,this.layoutVertexArray.reserve(c),this.layoutNormalArray=new Gu,this.layoutNormalArray.reserve(c),this.layoutCentroidArray=new Gu,this.layoutCentroidArray.reserve(c),this.layoutColorArray=new hc,this.layoutColorArray.reserve(c),this.layoutFloodLightDataArray=new Ug,this.layoutFloodLightDataArray.reserve(c),this.layoutAOArray=new N_,this.layoutAOArray.reserve(c),this.indexArray=new ms,this.indexArray.reserve(66560),this.indexArrayForConflation=new ms,this.segmentsBucket=new hr,this.entranceBloom=new Z6,r&&(this.layoutFacadePaintArray=new hc,this.layoutFacadeDataArray=new Ap,this.layoutFacadeVerticalRangeArray=new hc)}reserve(r,c,d){this.layoutVertexArray.reserveForAdditional(r),this.layoutCentroidArray.reserveForAdditional(r),this.layoutFloodLightDataArray.reserveForAdditional(r),this.layoutNormalArray.reserveForAdditional(r),this.layoutAOArray.reserveForAdditional(r),this.layoutColorArray.reserveForAdditional(r),this.indexArray.reserveForAdditional(c),d&&(this.layoutFacadePaintArray.reserveForAdditional(r),this.layoutFacadeDataArray.reserveForAdditional(r),this.layoutFacadeVerticalRangeArray.reserveForAdditional(r))}}class z9{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new ef,this.footprintsIndices=new Ug,this.footprintsMin=new Tt(1/0,1/0),this.footprintsMax=new Tt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new K6(!1),this.buildingWithFacade=new K6(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.programConfigurations=new B(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=r.projection,this.groundEffect=new O6(r),this.groundEffect.groundRadiusArray=new Vs,this.hasAppearances=null}updateFootprints(r,c){const d=new qC([],[],1),p={vertices:[],indices:new Uint32Array(0),grid:d,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};c.push({footprint:p,id:r})}updateAppearances(r,c,d,p){}prepare(){return function(){if(e5!=null||p9!=null)return null;if(H_!=null)return H_;const r=fetch(fs.BUILDING_GEN_URL);return H_=function(c){let d,p,y,_,v;function T(){d=new Uint8Array(v.buffer),p=new Int16Array(v.buffer),y=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const O=()=>{},k={a:{a:S,f:function(N){const F=d.length,$=Math.max(N>>>0,Math.ceil(1.2*F)),H=Math.ceil(($-F)/65536);try{return v.grow(H),T(),!0}catch{return!1}},g:S,b:O,c:O,d:O,e:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(c,k):c.then(N=>N.arrayBuffer()).then(N=>WebAssembly.instantiate(N,k))).then(N=>{const F=N.instance.exports;return(0,F.g)(),v=F.f,T(),new FQ({setStyle:F.h,setAOOptions:F.i,setMetricOptions:F.j,setStructuralOptions:F.k,setFacadeOptions:F.l,setFauxFacadeOptions:F.m,setFacadeClassifierOptions:F.n,addFeature:F.o,addFacade:F.p,generateMesh:F.q,getLastError:F.r,getOuterRingLength:F.s,getMeshCount:F.t,getPositionsPtr:F.u,getPositionsLength:F.v,getNormalsPtr:F.w,getNormalsLength:F.x,getAOPtr:F.y,getAOLength:F.z,getUVPtr:F.A,getUVLength:F.B,getFauxFacadePtr:F.C,getFauxFacadeLength:F.D,getIndicesPtr:F.E,getIndicesLength:F.F,getBuildingPart:F.G,getRingCount:F.H,getRingPtr:F.I,getRingLength:F.J,malloc:F.K,free:F.L,heapU8:d,heap16:p,heap32:y,heapF32:_})})}(r).then(c=>(H_=null,e5=c,e5)).catch(c=>{In("Could not load building-gen"),H_=null,p9=c}),H_}()}populate(r,c,d,p){const y=$Q();if(!y)return;const _=Rt(d);this.tileToMeter=_,this.brightness=c.brightness,y.setStyle({normalScale:[1,-1,_],tileToMeters:_}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeClassifierOptions(3);const v=new Map,T=new Map;let S=0;for(const{feature:q}of r){if($9[q.type]!=="LineString"){v.set(q.id,q.properties.source_id);continue}const X=this.layers[0]._featureFilter.needGeometry;if(X&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),q,d))continue;const te=Vn(q,X);if(!X&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),te,d))continue;const se=X?te.geometry:Cn(q,d,p),ge=[];for(const xe of se)for(const Oe of xe)ge.push(Oe.x),ge.push(Oe.y);const me={coordinates:ge,crossPerc:q.properties.cross_perc,distanceToRoad:q.properties.distance_to_road,entrances:q.properties.entrances,sourceId:0},Ee=q.properties.source_id;let Te=T.get(Ee);Te||(Te=[],T.set(Ee,Te)),Te.push(me),++S}this.maxHeight=0;const O=new Array,k=new Set,N=q=>{q!=null&&k.add(q)},F=(q,X)=>{q!=null&&O.push({buildingId:q,footprintIndex:X})},$=64*(r.length-S),H=$/2;this.buildingWithFacade.reserve($,H,!0),this.buildingWithoutFacade.reserve(2*$,2*H,!1),this.footprintsIndices.reserve(16*(r.length-S)),this.footprintsVertices.reserve(8*(r.length-S));for(const{feature:q,id:X,index:te,sourceLayerIndex:se}of r){if($9[q.type]==="LineString")continue;const ge=this.layers[0]._featureFilter.needGeometry;if(ge&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),q,d))continue;let me=null;if(q.properties&&q.properties.hasOwnProperty("building_id")&&(me=Number(q.properties.building_id),k.has(me)))continue;const Ee=Vn(q,ge);if(!ge&&!this.layers[0]._featureFilter.filter(new Ui(this.zoom),Ee,d))continue;const Te=ge?Ee.geometry:Cn(q,d,p),xe=Ev(Te,500);let Oe=!1;for(const Jn of xe)if(Jn.length!==1){Oe=!0;break}if(Oe){N(me);continue}if(!fee(Te,163)){N(me);continue}const Be=this.layers[0],lt=pee(Be.layout.get("building-roof-shape").evaluate(q,{},d)),it=Be.layout.get("building-base").evaluate(q,{},d),st=Be.layout.get("building-height").evaluate(q,{},d),_t=Be.layout.get("building-flood-light-ground-radius").evaluate(q,{},d),gt=Be.paint.get("building-ambient-occlusion-intensity"),yt=_t/this.tileToMeter;q.properties["building-part"]="roof";const Qe=Be.paint.get("building-color").evaluate(q,{},this.canonical).toPremultipliedRenderColor(this.lut),bt=Be.paint.get("building-emissive-strength").evaluate(q,{},this.canonical);q.properties["building-part"]="wall";const pt=Be.paint.get("building-color").evaluate(q,{},this.canonical).toPremultipliedRenderColor(this.lut),vt=Be.paint.get("building-emissive-strength").evaluate(q,{},this.canonical);q.properties["building-part"]="window";const wt=Be.paint.get("building-color").evaluate(q,{},this.canonical).toPremultipliedRenderColor(this.lut),Zt=Be.paint.get("building-emissive-strength").evaluate(q,{},this.canonical);q.properties["building-part"]="door";const Kt=Be.paint.get("building-color").evaluate(q,{},this.canonical).toPremultipliedRenderColor(this.lut),$t=Be.paint.get("building-emissive-strength").evaluate(q,{},this.canonical);let Ut=Be.layout.get("building-flood-light-wall-radius").evaluate(q,{},d);Ut=ve(Ut,0,2048);const gn=Ut/2048*c5,an=v.get(X),Wt=T.get(an)||[],Rn=Wt.length!==0&&Be.layout.get("building-facade").evaluate(q,{},d);y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(Rn,!1,1);let Qn=0,Ai=0,Xn=0,ji=0,pi=0,Br=0,bi=0,Bi=0,ur=0,yr=0,_r=0;if(Rn){let Jn=Math.round(Be.layout.get("building-facade-floors").evaluate(q,{},d));if(it===0){Jn=Math.max(1,Jn-(Wt.length>0?1:0));let $r=4;if(st>100){const _s=[10,13,15];$r=_s[q.id?q.id%_s.length:0]}else st<=10&&($r=3);y.setFacadeOptions($r,!0),pi=(st<15?1.3:1.61803)*$r/_}else pi=it/_;Br=st/_,pi=Math.min(pi,Br),Xn=Be.layout.get("building-facade-unit-width").evaluate(q,{},d)/_,ji=(Br-pi)/Jn,y.setFauxFacadeOptions(!0,!0,Xn);const Ds=Be.layout.get("building-facade-window").evaluate(q,{},d);Qn=Ds[0],Ai=Ds[1],bi=Math.floor(65535*Math.min(1,pi/zt)),Bi=Math.floor(65535*Math.min(1,Br/zt)),ur=Math.floor(255*Qn)<<8|Math.floor(255*Ai),yr=Math.floor(65535*Math.min(1,Xn/zt)),_r=Math.floor(65535*Math.min(1,ji/zt))}const Fr=Array(xe.length),Ws={x:1/0,y:1/0},fo={x:-1/0,y:-1/0},os={x:0,y:0};let ys=0;for(let Jn=0;Jn<xe.length;Jn++){const Ds=xe[Jn];if(Ds.length>0){const $r=[],_s=Array(Ds.length+1);_s[0]=0;for(let Il=0;Il<Ds.length;Il++){const $a=Ds[Il];for(let bc=0;bc<$a.length;bc++){const Ns=$a[$a.length-bc-1];Ws.x=Math.min(Ws.x,Ns.x),Ws.y=Math.min(Ws.y,Ns.y),fo.x=Math.max(fo.x,Ns.x),fo.y=Math.max(fo.y,Ns.y),os.x+=Ns.x,os.y+=Ns.y,ys++,$r.push(Ns.x),$r.push(Ns.y)}_s[Il+1]=$r.length}Fr[Jn]={id:q.id?q.id:0,height:st,minHeight:it,sourceId:0,roofType:lt,coordinates:$r,ringIndices:_s}}}os.x/=ys||1,os.y/=ys||1;const Es=y.generateMesh(Fr,Wt);if(typeof Es=="string"){In(`Unable to generate building ${q.id}: ${Es}`),N(me);continue}if(Es.meshes.length===0||Es.modifiedPolygonRings.length===0){N(me);continue}const qn=Rn?this.buildingWithFacade:this.buildingWithoutFacade;let wr=0;for(const Jn of Es.meshes)wr+=Jn.positions.length/3;const Sr=qn.segmentsBucket.prepareSegment(wr,qn.layoutVertexArray,qn.indexArray),wc=[];let Xo=null,Hs=0,Jo=-1;const Jd=qn.layoutVertexArray.length,Co=Jd+wr;qn.layoutVertexArray.resize(Co),qn.layoutCentroidArray.resize(Co),qn.layoutNormalArray.resize(Co),qn.layoutAOArray.resize(Co),qn.layoutColorArray.resize(Co),qn.layoutFloodLightDataArray.resize(Co),Rn&&(qn.layoutFacadePaintArray.resize(Co),qn.layoutFacadeDataArray.resize(Co),qn.layoutFacadeVerticalRangeArray.resize(Co));const D5=qn.indexArray.length;let r1=0,ba=Jd;for(const Jn of Es.meshes){let Ds,$r;if(Jn.buildingPart===1)Ds=Qe,$r=bt;else if(Jn.buildingPart===0)Ds=pt,$r=vt;else if(Jn.buildingPart===2)Ds=wt,$r=Zt;else{if(Jn.buildingPart!==3)continue;Ds=Kt,$r=$t}if($r=ve($r,0,1),Jn.buildingPart===3){const as=new Array;for(let Ao=0;Ao<Jn.positions.length;Ao+=12){const Up=Jn.positions[Ao+0],qs=Jn.positions[Ao+1],za=Jn.positions[Ao+3],du=Jn.positions[Ao+4],th=Jn.positions[Ao+2],N4=Jn.positions[Ao+8]-th,M4=1,ox=za-Up,o1=du-qs,Ju=Math.hypot(ox,o1);as.push({pos:[Up+.5*ox,qs+.5*o1,th],normal:[o1/Ju,-ox/Ju,0],width:Ju,height:N4,depth:M4,points:[Up,qs,za,du]})}const Gs=qn.entranceBloom.segmentsBucket.prepareSegment(10*as.length,qn.entranceBloom.layoutVertexArray,qn.entranceBloom.indexArray),ws=qn.entranceBloom.layoutVertexArray.length;Hs=qn.entranceBloom.indexArray.length,L9(as,.5/this.tileToMeter,qn.entranceBloom.indexArray,qn.entranceBloom.layoutVertexArray,qn.entranceBloom.layoutAttenuationArray);const To=qn.entranceBloom.layoutVertexArray.length-ws;Jo=qn.entranceBloom.indexArray.length-Hs;for(let Ao=0;Ao<To;Ao++)qn.entranceBloom.layoutColorArray.emplaceBack(255*Kt.r<<8|255*Kt.g,255*Kt.b<<8|51*$t);Gs.vertexLength+=To,Gs.primitiveLength+=Jo,Xo={part:Jn.buildingPart,vertexOffset:ws,vertexLength:To}}qn.layoutVertexArray.float32.set(Jn.positions,3*ba);const _s=Jn.positions.length/3;for(let as=0;as<_s;++as){const Gs=3*as;r1=Math.max(r1,Jn.positions[Gs+2]);const ws=Jn.normals[Gs+1]*c5,To=Jn.normals[Gs+2]*c5,Ao=3*(ba+as);qn.layoutNormalArray.int16[Ao]=Jn.normals[Gs]*c5,qn.layoutNormalArray.int16[Ao+1]=ws,qn.layoutNormalArray.int16[Ao+2]=To;const Up=Jn.ao[as];qn.layoutAOArray.uint8[ba+as]=255*Up;const qs=1+(Up-1)*gt,za=255*Ds.b*qs<<8|255*$r;qn.layoutColorArray.uint16[2*(ba+as)]=255*Ds.r*qs<<8|255*Ds.g*qs,qn.layoutColorArray.uint16[2*(ba+as)+1]=za}const Il=Math.floor(os.x),$a=Math.floor(os.y),bc=Math.floor(st);for(let as=0;as<_s;++as){const Gs=3*(ba+as);qn.layoutCentroidArray.int16[Gs]=Il,qn.layoutCentroidArray.int16[Gs+1]=$a,qn.layoutCentroidArray.int16[Gs+2]=bc}if(qn.layoutFloodLightDataArray.uint16.fill(Jn.buildingPart===0?gn:0,ba,ba+_s),Rn){const as=255*wt.r<<8|255*wt.g,Gs=255*wt.b<<8|255*Zt;for(let ws=0;ws<_s;++ws){const To=2*(ba+ws);qn.layoutFacadePaintArray.uint16[To]=as,qn.layoutFacadePaintArray.uint16[To+1]=Gs}for(let ws=0;ws<_s;++ws)if(Jn.isFauxFacade[ws]){const To=Math.min(65535,Math.floor(Jn.uv[2*ws]*Es.outerRingLength));qn.layoutFacadeDataArray.emplace(ba+ws,1|To,ur,yr,_r),qn.layoutFacadeVerticalRangeArray.emplace(ba+ws,bi,Bi)}else qn.layoutFacadeDataArray.emplace(ba+ws,0,0,0,0),qn.layoutFacadeVerticalRangeArray.emplace(ba+ws,0,0)}const Ns=Sr.vertexLength,sx=Jn.indices.length/3,eh=qn.indexArray.length;qn.indexArray.resize(eh+sx);for(let as=0;as<sx;++as){const Gs=3*as,ws=3*eh+Gs;qn.indexArray.uint16[ws]=Ns+Jn.indices[Gs],qn.indexArray.uint16[ws+1]=Ns+Jn.indices[Gs+1],qn.indexArray.uint16[ws+2]=Ns+Jn.indices[Gs+2]}Jn.buildingPart!==1&&Jn.buildingPart!==0&&Jn.buildingPart!==2&&Jn.buildingPart!==3||wc.push({part:Jn.buildingPart,vertexOffset:ba,vertexLength:Jn.positions.length/3}),ba+=_s,Sr.vertexLength+=_s,Sr.primitiveLength+=Jn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,r1);const N5=qn.indexArray.length-D5,Qd=this.footprintsIndices.length,cf=this.footprintsVertices.length,zp=[],Sl=new Tt(1/0,1/0),uu=new Tt(-1/0,-1/0),rx=this.groundEffect.vertexArray.length;for(const Jn of Es.modifiedPolygonRings){const Ds=[],$r=new Tt(1/0,1/0),_s=new Tt(-1/0,-1/0);for(let Il=0;Il<Jn.length;Il+=2){const $a=Jn.length-Il-2;$r.x=Math.min($r.x,Jn[$a]),$r.y=Math.min($r.y,Jn[$a+1]),_s.x=Math.max(_s.x,Jn[$a]),_s.y=Math.max(_s.y,Jn[$a+1]);const bc=new Tt(Jn[$a],Jn[$a+1]);Ds.push(bc),zp.push(bc.x,bc.y),this.footprintsVertices.emplaceBack(bc.x,bc.y)}Sl.x=Math.min(Sl.x,$r.x),Sl.y=Math.min(Sl.y,$r.y),uu.x=Math.max(uu.x,_s.x),uu.y=Math.max(uu.y,_s.y),this.groundEffect.addData(Ds,[$r,_s],yt)}const s1=this.groundEffect.vertexArray.length-rx;this.groundEffect.groundRadiusArray.reserveForAdditional(s1);for(let Jn=0;Jn<s1;Jn++)this.groundEffect.groundRadiusArray.emplaceBack(_t);(Ws.x<0||fo.x>zt||Ws.y<0||fo.y>zt)&&this.featuresOnBorder.push({featureId:q.id,footprintIndex:this.footprints.length});{const Jn=F_(zp,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Jn.length),this.footprintsIndices.uint16.set(Jn,Qd),this.buildingIds.add(me??q.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Sl.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Sl.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,uu.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,uu.y);const Ds={footprintVertexOffset:cf,footprintVertexLength:this.footprintsVertices.length-cf,footprintIndexOffset:Qd,footprintIndexLength:this.footprintsIndices.length-Qd,min:Sl,max:uu,hiddenFlags:0,indicesOffset:D5,indicesLength:N5,bloomIndicesOffset:Hs,bloomIndicesLength:Jo,groundEffectVertexOffset:rx,groundEffectVertexLength:s1,hasFauxFacade:Rn,height:r1,promoteId:X,feature:Ee,parts:wc,buildingBloom:Xo},$r=this.footprints.length;q.id!==void 0&&this.featureFootprintLookup.set(q.id,$r),F(me,$r),this.footprints.push(Ds)}this.programConfigurations.populatePaintArrays(qn.layoutVertexArray.length,q,te,{},c.availableImages,d,c.brightness),this.groundEffect.addPaintPropertiesData(q,te,{},c.availableImages,d,c.brightness),c.featureIndex.insert(q,Te,te,se,this.index,Jd)}O.forEach(({buildingId:q,footprintIndex:X})=>{k.has(q)&&(this.footprints[X].hiddenFlags|=4)});const K=new Set;this.buildingIds.forEach((q,X,te)=>{k.has(q)||K.add(q)}),this.buildingIds=K,this.groundEffect.prepareBorderSegments()}update(r,c,d,p,y,_,v){this.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v),this.groundEffect.update(r,c,y,d,p,_,v),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const c=d=>{d.layoutVertexBuffer=r.createVertexBuffer(d.layoutVertexArray,B9.members),d.layoutNormalBuffer=r.createVertexBuffer(d.layoutNormalArray,oee.members),d.layoutCentroidBuffer=r.createVertexBuffer(d.layoutCentroidArray,aee.members),d.layoutFloodLightDataBuffer=r.createVertexBuffer(d.layoutFloodLightDataArray,hee.members),d.layoutFacadeDataArray&&d.layoutFacadeDataArray.length&&(d.layoutFacadeDataBuffer=r.createVertexBuffer(d.layoutFacadeDataArray,lee.members)),d.layoutFacadeVerticalRangeArray&&d.layoutFacadeVerticalRangeArray.length&&(d.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(d.layoutFacadeVerticalRangeArray,uee.members)),d.entranceBloom.layoutVertexArray.length&&(d.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(d.entranceBloom.layoutVertexArray,B9.members),d.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(d.entranceBloom.layoutAttenuationArray,dee.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=c=>{c.layoutVertexBuffer&&(c.layoutVertexBuffer.destroy(),c.layoutNormalBuffer.destroy(),c.layoutColorBuffer.destroy(),c.segmentsBucket.destroy(),c.indexBuffer&&c.indexBuffer.destroy(),c.entranceBloom.layoutVertexBuffer&&(c.entranceBloom.layoutVertexBuffer.destroy(),c.entranceBloom.layoutColorBuffer.destroy(),c.entranceBloom.layoutAttenuationBuffer.destroy(),c.entranceBloom.indexBuffer.destroy(),c.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,c,d=!0){let p=!1;const y=d?c:0,_=0|(d?-1:~c);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of r){const T=this.footprints[v],S=T.hiddenFlags&_|y;T.hiddenFlags!==S&&(T.hiddenFlags=S,p=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const c=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};c(this.buildingWithoutFacade),c(this.buildingWithFacade);for(const p of this.footprints){const y=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let T=p.indicesOffset;T<_;T++)y.indexArrayForConflation.uint16[3*T+0]=0,y.indexArrayForConflation.uint16[3*T+1]=0,y.indexArrayForConflation.uint16[3*T+2]=0;const v=p.bloomIndicesOffset+p.bloomIndicesLength;for(let T=p.bloomIndicesOffset;T<v;T++)y.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,y.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,y.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const d=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=r.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=r.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};d(this.buildingWithoutFacade),d(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const c=d=>{d.layoutColorBuffer?d.layoutColorBuffer.updateData(d.layoutColorArray):d.layoutColorBuffer=r.createVertexBuffer(d.layoutColorArray,F9.members,!0),d.layoutFacadePaintArray&&(d.layoutFacadePaintBuffer?d.layoutFacadePaintBuffer.updateData(d.layoutFacadePaintArray):d.layoutFacadePaintBuffer=r.createVertexBuffer(d.layoutFacadePaintArray,cee.members,!0)),d.entranceBloom.layoutColorBuffer?d.entranceBloom.layoutColorBuffer.updateData(d.entranceBloom.layoutColorArray):d.entranceBloom.layoutColorBuffer=r.createVertexBuffer(d.entranceBloom.layoutColorArray,F9.members,!0)};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,c){const d=r.paint.get("building-ambient-occlusion-intensity");for(const p of this.footprints){if(4&p.hiddenFlags)continue;const y=c[p.promoteId],_=p.feature;_.properties["building-part"]="roof";const v=r.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),T=r.paint.get("building-emissive-strength").evaluate(_,y,this.canonical);_.properties["building-part"]="wall";const S=r.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),O=r.paint.get("building-emissive-strength").evaluate(_,y,this.canonical);_.properties["building-part"]="window";const k=r.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),N=r.paint.get("building-emissive-strength").evaluate(_,y,this.canonical);_.properties["building-part"]="door";const F=r.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),$=r.paint.get("building-emissive-strength").evaluate(_,y,this.canonical),H=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const q of p.parts){let X,te=v;q.part===1?(te=v,X=T):q.part===0?(te=S,X=O):q.part===2?(te=k,X=N):q.part===3&&(te=F,X=$),X=ve(X,0,1);for(let se=0;se<q.vertexLength;se++){const ge=q.vertexOffset+se,me=1+(H.layoutAOArray.uint8[ge]/255-1)*d;H.layoutColorArray.emplace(ge,te.r*me*255<<8|te.g*me*255,te.b*me*255<<8|255*X),p.hasFauxFacade&&H.layoutFacadePaintArray.emplace(ge,255*k.r<<8|255*k.g,255*k.b<<8|255*N)}}const K=p.buildingBloom;if(K)for(let q=0;q<K.vertexLength;q++)H.entranceBloom.layoutColorArray.emplace(K.vertexOffset+q,255*F.r<<8|255*F.g,255*F.b<<8|51*$)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,c,d){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(r.toUnwrapped());if(KC(this.activeReplacements,p))return;this.activeReplacements=p;for(const _ of this.footprints)_.hiddenFlags&=-2;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-r.canonical.z));for(const T of this.footprints)T.min.x>_.max.x||T.max.x<_.min.x||T.min.y>_.max.y||T.max.y<_.min.y||(y.length=0,gee(this.footprintsVertices,T.footprintVertexOffset,T.footprintVertexLength,_.footprintTileId.canonical,r.canonical,y),I6(_.footprint,y,this.footprintsIndices.uint16,T.footprintIndexOffset,T.footprintIndexLength,0,-v)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(r){if(r.id!==void 0){const c=this.featureFootprintLookup.get(r.id);return this.footprints[c]}return null}getHeightAtTileCoord(r,c){let d=Number.NEGATIVE_INFINITY,p=!0;const y=4*(r+zt)*zt+(c+zt);if(this.footprintLookup.hasOwnProperty(y)){const v=this.footprintLookup[y];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new Tt(r,c);for(const v of this.footprints)r>v.max.x||v.min.x>r||c>v.max.y||v.min.y>c||v.height<=d||mee(_,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(d=v.height,this.footprintLookup[y]=v,p=v.hiddenFlags!==0);if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.footprintLookup[y]=void 0}}function mee(u,r,c){for(let d=0;d<c.length;d+=3){const p=c[d],y=c[d+1],_=c[d+2],v=r[2*p+0],T=r[2*p+1],S=r[2*y+0],O=r[2*y+1],k=r[2*_+0],N=r[2*_+1],F=(v-k)*(u.y-N)-(T-N)*(u.x-k),$=(S-v)*(u.y-T)-(O-T)*(u.x-v);if(F<0!=$<0&&F!==0&&$!==0)continue;const H=(k-S)*(u.y-O)-(N-O)*(u.x-S);if(H===0||H<0==F+$<=0)return!0}return!1}function gee(u,r,c,d,p,y){const _=Math.pow(2,d.z-p.z);for(let v=0;v<c;v++){let T=u.float32[2*(v+r)+0],S=u.float32[2*(v+r)+1];T=(T+p.x*zt)*_-d.x*zt,S=(S+p.y*zt)*_-d.y*zt,y.push(new Tt(T,S))}}let U9,j9;Qt(z9,"BuildingBucket",{omit:["layers"]}),Qt(K6,"BuildingGeometry"),Qt(Z6,"BuildingBloomGeometry");const yee=ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),_ee=ii([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:wee}=yee,bee=ii([{name:"a_packed",components:3,type:"Float32"}]),{members:vee}=bee,xee=ii([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Eee}=xee;class V9{constructor(r,c){this.width=r,this.height=c,this.nextRow=0,this.image=new Dp({width:r,height:c}),this.positions={},this.uploaded=!1}getDash(r,c){const d=this.getKey(r,c);return this.positions[d]}trim(){const r=this.width,c=this.height=At(this.nextRow);this.image.resize({width:r,height:c})}getKey(r,c){return r.join(",")+c}getDashRanges(r,c,d){const p=[];let y=r.length%2==1?-r[r.length-1]*d:0,_=r[0]*d,v=!0;p.push({left:y,right:_,isDash:v,zeroLength:r[0]===0});let T=r[0];for(let S=1;S<r.length;S++){v=!v;const O=r[S];y=T*d,T+=O,_=T*d,p.push({left:y,right:_,isDash:v,zeroLength:O===0})}return p}addRoundDash(r,c,d){const p=c/2;for(let y=-d;y<=d;y++){const _=this.width*(this.nextRow+d+y);let v=0,T=r[v];for(let S=0;S<this.width;S++){S/T.right>1&&(T=r[++v]);const O=Math.abs(S-T.left),k=Math.abs(S-T.right),N=Math.min(O,k);let F;const $=y/d*(p+1);if(T.isDash){const H=p-Math.abs($);F=Math.sqrt(N*N+H*H)}else F=p-Math.sqrt(N*N+$*$);this.image.data[_+S]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(r,c){for(let T=r.length-1;T>=0;--T){const S=r[T],O=r[T+1];S.zeroLength?r.splice(T,1):O&&O.isDash===S.isDash&&(O.left=S.left,r.splice(T,1))}const d=r[0],p=r[r.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const y=this.width*this.nextRow;let _=0,v=r[_];for(let T=0;T<this.width;T++){T/v.right>1&&(v=r[++_]);const S=Math.abs(T-v.left),O=Math.abs(T-v.right),k=Math.min(S,O);this.image.data[y+T]=Math.max(0,Math.min(255,(v.isDash?k:-k)+c+128))}}addDash(r,c){const d=this.getKey(r,c);if(this.positions[d])return this.positions[d];const p=c==="round",y=p?7:0,_=2*y+1;if(this.nextRow+_>this.height)return In("LineAtlas out of space"),null;r.length===0&&r.push(1);let v=0;for(let O=0;O<r.length;O++)r[O]<0&&(In("Negative value is found in line dasharray, replacing values with 0"),r[O]=0),v+=r[O];if(v!==0){const O=this.width/v,k=this.getDashRanges(r,this.width,O);p?this.addRoundDash(k,O,y):this.addRegularDash(k,c==="square"?.5*O:0)}const T=this.nextRow+y;this.nextRow+=_;const S={tl:[T,y],br:[v,0]};return this.positions[d]=S,S}}Qt(V9,"LineAtlas");const Cee=ci.types,Tee=Math.cos(Math.PI/180*37.5),Aee=Math.cos(Math.PI/180*5);class Y6{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new av,this.layoutVertexArray2=new Wc,this.patternVertexArray=new Wc,this.indexArray=new ms,this.programConfigurations=new B(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new hr,this.maxLineLength=0,this.zOffsetVertexArray=new Wc,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:128,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,c){}updateAppearances(r,c,d,p){}populate(r,c,d,p){this.hasPattern=m6("line",this.layers,this.pixelRatio,c);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Rt(d);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const N=this.layers[0].layout.get("line-z-offset"),F=N.isConstant()&&!N.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&F?"none":"offset",this.elevationType==="offset"&&_==="none"&&In(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const T=[];for(const{feature:N,id:F,index:$,sourceLayerIndex:H}of r){const K=this.layers[0]._featureFilter.needGeometry,q=Vn(N,K);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,d))continue;const X=y?y.evaluate(q,{},d):void 0,te={id:F,properties:N.properties,type:N.type,sourceLayerIndex:H,index:$,geometry:K?q.geometry:Cn(N,d,p),patterns:{},sortKey:X};T.push(te)}y&&T.sort((N,F)=>N.sortKey-F.sortKey);const{lineAtlas:S,featureIndex:O}=c,k=this.addConstantDashes(S);for(const N of T){const{geometry:F,index:$,sourceLayerIndex:H}=N;if(k&&this.addFeatureDashes(N,S),this.hasPattern){const K=g6("line",this.layers,N,this.zoom,this.pixelRatio,c);this.patternFeatures.push(K)}else this.addFeature(N,F,$,d,S.positions,c.availableImages,c.brightness,c.elevationFeatures);O.insert(r[$].feature,F,$,H,this.index)}}addConstantDashes(r){let c=!1;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(p.kind!=="constant"||y.kind!=="constant")c=!0;else{const _=y.value,v=p.value;if(!v)continue;r.addDash(v,_)}}return c}addFeatureDashes(r,c){const d=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,_=p.layout.get("line-cap").value;if(y.kind==="constant"&&_.kind==="constant")continue;let v,T;if(y.kind==="constant"){if(v=y.value,!v)continue}else v=y.evaluate({zoom:d},r);T=_.kind==="constant"?_.value:_.evaluate({zoom:d},r),c.addDash(v,T),r.patterns[p.id]=[c.getKey(v,T)]}}update(r,c,d,p,y,_,v,T){this.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v,T)}addFeatures(r,c,d,p,y,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,c,d,p,_,r.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,vee)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,Eee)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,_ee.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,wee),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,c){let d,p;if(c&&c>0?(d=`mapbox_clip_start_${c}`,p=`mapbox_clip_end_${c}`):(d="mapbox_clip_start",p="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(d)&&r.properties.hasOwnProperty(p))return{start:+r.properties[d],end:+r.properties[p]}}addFeature(r,c,d,p,y,_,v,T){const S=this.layers[0].layout,O=S.get("line-join").evaluate(r,{}),k=S.get("line-cap").evaluate(r,{}),N=S.get("line-miter-limit"),F=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const $=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=S.get("line-z-offset").value;const H=this.layers[0].paint.get("line-width").value;if(H.kind!=="constant"&&H.isLineProgressConstant===!1&&(this.variableWidthValue=H),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,c,p,T,O,k,N,F)){const[q,X]=this.clipRuntimeLinesToTile(c,1);for(let te=0;te<q.length;te++){const se=q[te],ge=X[te],me={progress:{min:ge.progress.min,max:ge.progress.max},nextDir:this.computeSegNextDir(ge,se),prevDir:this.computeSegPrevDir(ge,se)};this.addLine(se,r,p,O,k,N,F,me,$&&ge.parentIndex>0?ge.parentIndex:null)}this.fillNonElevatedRoadSegment(K)}}else for(let K=0;K<c.length;K++)this.addLine(c[K],r,p,O,k,N,F,void 0,$&&K>0?K:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,_,p,v,void 0,this.worldview)}computeSegNextDir(r,c){return r.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(r,c){return c[1].sub(r.prevPoint).unit()}clipLinesToTile(r,c){return JC(r,-c,-c,zt+c,zt+c)}clipRuntimeLinesToTile(r,c){const d=[];return[JC(r,-c,-c,zt+c,zt+c,d),d]}addElevatedRoadFeature(r,c,d,p,y,_,v,T){const S=[],O=Zo.getElevationFeature(r,p);if(O){const k=this.clipLinesToTile(c,1),N=this.prepareElevatedLines(k,O,d);for(const F of N)S.push({geometry:F,elevation:O,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const k of S){const N=this.layoutVertexArray.length;this.addLine(k.geometry,r,d,y,_,v,T);const F=new Hc(d,k.elevationTileID);if(k.elevation)for(let $=N;$<this.layoutVertexArray.length;$++){const H=new Tt(this.layoutVertexArray.int16[6*$]>>1,this.layoutVertexArray.int16[6*$+1]>>1),K=F.pointElevation(H,k.elevation,.05);this.updateHeightRange(K),this.zOffsetVertexArray.emplaceBack(K,0,0)}else this.fillNonElevatedRoadSegment(N)}return!0}prepareElevatedLines(r,c,d){if(c.constantHeight!=null)return r;const p=[],y=1/Rt(d);for(const _ of r)NQ(_,new Ma(c,y),0,p);return p}fillNonElevatedRoadSegment(r){for(let c=r;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,c,d,p,y,_,v,T,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=S?this.lineFeatureClips(c,S):this.lineClips;const O=p==="none";this.patternJoinNone=this.hasPattern&&O,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const k=T&&T.progress.min>0,N=T&&T.progress.max<1;if(this.lineClips){let xe={min:this.lineClips.start,max:this.lineClips.end},Oe=1;if(T){const it=this.lineClips.end-this.lineClips.start;xe=function(st,_t,gt){return{min:Us(st.min,_t,gt),max:Us(st.max,_t,gt)}}(T.progress,{min:0,max:1},xe),it>0&&(Oe=(xe.max-xe.min)/it)}const Be=+c.properties.mapbox_clip_feature_len,lt=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(Be)||Number.isNaN(lt)){for(let st=0;st<r.length-1;st++)this.totalDistance+=r[st].dist(r[st+1]);const it=this.totalDistance/(xe.max-xe.min);this.totalFeatureLength=Number.isFinite(it)?it:0,this.lineClips.start=xe.min,this.lineClips.end=xe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Be,this.distance=lt*Oe,this.lineClips.start=xe.min,this.lineClips.end=xe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const F=Cee[c.type]==="Polygon";let $=r.length;for(;$>=2&&r[$-1].equals(r[$-2]);)$--;let H=0;for(;H<$-1&&r[H].equals(r[H+1]);)H++;if($<(F?3:2))return;p==="bevel"&&(_=1.05);const K=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let q,X,te,se,ge,me,Ee,Te;T&&T.prevDir&&(me=T.prevDir.perp()),T&&T.nextDir&&(Ee=T.nextDir.perp()),this.e1=this.e2=-1,F&&(q=r[$-2],ge=r[H].sub(q)._unit()._perp());for(let xe=H;xe<$;xe++){if(te=xe===$-1?F?r[H+1]:void 0:r[xe+1],te&&r[xe].equals(te))continue;ge&&(se=ge),q&&(X=q),q=r[xe],Te=this.evaluateLineProgressFeatures(X?X.dist(q):0),ge=te?te.sub(q)._unit()._perp():se,se=se||ge;const Oe=X&&te;let Be=Oe?p:F||O?"butt":y;const lt=se.x*ge.x+se.y*ge.y;if(O){const pt=function(vt){if(vt.patternJoinNone){const wt=vt.segmentPoints.length/2,Zt=vt.lineSoFar-vt.segmentStart;for(let Kt=0;Kt<wt;++Kt){const $t=vt.segmentPoints[2*Kt+1],Ut=Math.round(vt.segmentPoints[2*Kt])+.5+.25*$t;vt.patternVertexArray.emplaceBack(Ut,Zt,vt.segmentStart),vt.patternVertexArray.emplaceBack(Ut,Zt,vt.segmentStart)}vt.segmentPoints.length=0}vt.e1=vt.e2=-1};if(Oe&&lt<Aee){this.updateDistance(X,q),this.addCurrentVertex(q,se,1,1,K,Te),pt(this),this.addCurrentVertex(q,ge,-1,-1,K,Te);continue}if(X){if(!te){this.updateDistance(X,q),this.addCurrentVertex(q,se,1,1,K,Te),pt(this);continue}Be="miter"}}let it=se.add(ge);it.x===0&&it.y===0||it._unit();const st=it.x*ge.x+it.y*ge.y,_t=st!==0?1/st:1/0,gt=2*Math.sqrt(2-2*st),yt=st<Tee&&X&&te,Qe=se.x*ge.y-se.y*ge.x>0,bt=this.overscaling<=16?122880/(512*this.overscaling):0;if(Oe&&Be==="round"){if(_t<v)Be="miter";else if(_t<=2){const pt=X6(q,-10,8202);Be=this.elevationType==="offset"&&(pt||this.hasCrossSlope)?"miter":"fakeround"}}if(Be==="miter"&&_t>_&&(Be="bevel"),Be==="bevel"&&(_t>2&&(Be="flipbevel"),_t<_&&(Be="miter")),X&&!(Be==="miter"&&yt)&&this.updateDistance(X,q),Be==="miter")if(yt){const pt=q.dist(X);if(pt>2*bt){const wt=q.sub(q.sub(X)._mult(bt/pt)._round());this.updateDistance(X,wt),this.addCurrentVertex(wt,se,0,0,K,Te),X=wt}this.updateDistance(X,q),it._mult(_t),this.addCurrentVertex(q,it,0,0,K,Te);const vt=q.dist(te);if(vt>2*bt){const wt=q.add(te.sub(q)._mult(bt/vt)._round());this.updateDistance(q,wt),this.addCurrentVertex(wt,ge,0,0,K,Te),q=wt}}else it._mult(_t),this.addCurrentVertex(q,it,0,0,K,Te);else if(Be==="flipbevel"){if(_t>100)it=ge.mult(-1);else{const pt=_t*se.add(ge).mag()/se.sub(ge).mag();it._perp()._mult(pt*(Qe?-1:1))}this.addCurrentVertex(q,it,0,0,K,Te),this.addCurrentVertex(q,it.mult(-1),0,0,K,Te)}else if(Be==="bevel"||Be==="fakeround"){Te!=null&&X&&this.addCurrentVertex(q,Ee||se,-1,-1,K,Te);const pt=q.dist(X)<=2*bt&&Be!=="bevel",vt=it.mult(Qe?1:-1);vt._mult(_t);const wt=ge.mult(Qe?-1:1),Zt=se.mult(Qe?-1:1),Kt=this.evaluateLineProgressFeatures(this.distance);if(Te==null&&(this.addHalfVertex(q,vt.x,vt.y,!1,!Qe,0,K,Kt),pt||this.addHalfVertex(q,vt.x+2*Zt.x,vt.y+2*Zt.y,!1,Qe,0,K,Kt)),Be==="fakeround"){const $t=Math.round(180*gt/Math.PI/20);this.addHalfVertex(q,Zt.x,Zt.y,!1,Qe,0,K,Kt);for(let Ut=0;Ut<$t;Ut++){let gn=Ut/$t;if(gn!==.5){const Wt=gn-.5;gn+=gn*Wt*(gn-1)*((1.0904+lt*(lt*(3.55645-1.43519*lt)-3.2452))*Wt*Wt+(.848013+lt*(.215638*lt-1.06021)))}const an=wt.sub(Zt)._mult(gn)._add(Zt)._unit();this.addHalfVertex(q,an.x,an.y,!1,Qe,0,K,Kt)}this.addHalfVertex(q,wt.x,wt.y,!1,Qe,0,K,Kt)}pt||Te!=null||this.addHalfVertex(q,vt.x+2*wt.x,vt.y+2*wt.y,!1,Qe,0,K,Kt),Te!=null&&te&&this.addCurrentVertex(q,me||ge,1,1,K,Te)}else if(Be==="butt")this.addCurrentVertex(q,it,0,0,K,Te);else if(Be==="square"){if(!X){const pt=k?0:-1;this.addCurrentVertex(q,it,pt,pt,K,Te)}if(this.addCurrentVertex(q,it,0,0,K,Te),X){const pt=N?0:1;this.addCurrentVertex(q,it,pt,pt,K,Te)}}else if(Be==="round"){if(X){const pt=!Oe&&Ee?Ee:se;this.addCurrentVertex(q,pt,0,0,K,Te),!Oe&&N||this.addCurrentVertex(q,pt,1,1,K,Te,!0)}if(te){const pt=!Oe&&me?me:ge;!Oe&&k||this.addCurrentVertex(q,pt,-1,-1,K,Te,!0),this.addCurrentVertex(q,pt,0,0,K,Te)}}}}addVerticesTo(r,c,d,p,y,_,v,T,S,O){const k=(c.w-r.w)/this.tessellationStep|0;let N=0;const F=this.scaledDistance;if(k>1){this.lineSoFar=r.w;const H=(c.x-r.x)/k,K=(c.y-r.y)/k,q=(c.z-r.z)/k,X=(c.w-r.w)/k;for(let te=1;te<k;++te){r.x+=H,r.y+=K,r.z+=q,this.lineSoFar+=X,N+=X;const se=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(r,d,p,O,!1,v,S,se),this.addHalfVertex(r,y,_,O,!0,-T,S,se)}}this.lineSoFar=c.w,this.scaledDistance=F;const $=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,d,p,O,!1,v,S,$),this.addHalfVertex(c,y,_,O,!0,-T,S,$)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):In(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(r,c,d,p,y,_,v=!1){const T=c.x+c.y*d,S=c.y-c.x*d,O=c.y*p-c.x,k=-c.y-c.x*p;if(_!=null){const N=this.elevationType==="offset",F=-10,$=8202,H=_.zOffset,K=new s9(r.x,r.y,H,this.lineSoFar),q=!!N&&X6(r,F,$),X=this.lineSoFar,te=this.distance;if(this.currentVertex)if(q){const se=this.currentVertexIsOutside,ge=this.currentVertex,me=new s9(r.x,r.y,H,this.lineSoFar);if(a9(ge,me,F,$),!X6(me,F,$)){if(se){this.e1=this.e2=-1,this.distance-=ge.dist(K),this.lineSoFar=ge.w;const Ee=this.evaluateLineProgressFeatures(ge.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ge,T,S,v,!1,d,y,Ee),this.addHalfVertex(ge,O,k,v,!0,-p,y,Ee),this.prevDistance=this.distance}this.distance=this.prevDistance+ge.dist(me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ge,me,T,S,O,k,d,p,y,v),this.distance=te,this.scaledDistance=this.distance/this.totalDistance}}else{const se=this.currentVertex;if(this.currentVertexIsOutside){a9(se,K,F,$),this.e1=this.e2=-1,this.distance-=se.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=se.w;const ge=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,T,S,v,!1,d,y,ge),this.addHalfVertex(se,O,k,v,!0,-p,y,ge),this.prevDistance=this.distance,this.distance=te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(se,K,T,S,O,k,d,p,y,v)}else q||(this.addHalfVertex(r,T,S,v,!1,d,y,_),this.addHalfVertex(r,O,k,v,!0,-p,y,_));this.currentVertex=K,this.currentVertexIsOutside=q,this.lineSoFar=X}else this.addHalfVertex(r,T,S,v,!1,d,y,_),this.addHalfVertex(r,O,k,v,!0,-p,y,_)}addHalfVertex({x:r,y:c},d,p,y,_,v,T,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(c<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const k=xn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,k)}const O=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),T.primitiveLength++),_?this.e2=O:this.e1=O,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,c){this.prevDistance=this.distance,this.distance+=r.dist(c),this.updateScaledDistance()}}function X6(u,r,c){return u.x<r||u.x>c||u.y<r||u.y>c}let W9,H9;function G9(u,r,c){return r*(zt/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}Qt(Y6,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const q9=(u,r,c)=>(1-c)*u+c*r;function Z9(u,r){return 1/G9(u,1,r.tileZoom)}function K9(u,r,c,d){return u.translatePosMatrix(d||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Y9=u=>{const r=[];X9(u)&&r.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const d=u.layout.get("line-join").constantOr("miter")==="none",p=!!u.paint.get("line-pattern").constantOr(1);return d&&p&&r.push("LINE_JOIN_NONE"),r};function X9(u){const r=u.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let J6;const J9=()=>J6||(J6={layout:W9||(W9=new Tr({"line-cap":new Vt(Ke.layout_line["line-cap"]),"line-join":new Vt(Ke.layout_line["line-join"]),"line-miter-limit":new kt(Ke.layout_line["line-miter-limit"]),"line-round-limit":new kt(Ke.layout_line["line-round-limit"]),"line-sort-key":new Vt(Ke.layout_line["line-sort-key"]),"line-z-offset":new Vt(Ke.layout_line["line-z-offset"]),"line-elevation-reference":new kt(Ke.layout_line["line-elevation-reference"]),"line-cross-slope":new kt(Ke.layout_line["line-cross-slope"]),visibility:new kt(Ke.layout_line.visibility),"line-width-unit":new kt(Ke.layout_line["line-width-unit"])})),paint:H9||(H9=new Tr({"line-opacity":new Vt(Ke.paint_line["line-opacity"]),"line-color":new Vt(Ke.paint_line["line-color"]),"line-translate":new kt(Ke.paint_line["line-translate"]),"line-translate-anchor":new kt(Ke.paint_line["line-translate-anchor"]),"line-width":new Vt(Ke.paint_line["line-width"]),"line-gap-width":new Vt(Ke.paint_line["line-gap-width"]),"line-offset":new Vt(Ke.paint_line["line-offset"]),"line-blur":new Vt(Ke.paint_line["line-blur"]),"line-dasharray":new Vt(Ke.paint_line["line-dasharray"]),"line-pattern":new Vt(Ke.paint_line["line-pattern"]),"line-pattern-cross-fade":new kt(Ke.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ep(Ke.paint_line["line-gradient"]),"line-trim-offset":new kt(Ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new kt(Ke.paint_line["line-trim-fade-range"]),"line-trim-color":new kt(Ke.paint_line["line-trim-color"]),"line-emissive-strength":new Vt(Ke.paint_line["line-emissive-strength"]),"line-border-width":new Vt(Ke.paint_line["line-border-width"]),"line-border-color":new Vt(Ke.paint_line["line-border-color"]),"line-occlusion-opacity":new kt(Ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},J6);class See extends Vt{possiblyEvaluate(r,c){return c=new Ui(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition,worldview:c.worldview}),super.possiblyEvaluate(r,c)}evaluate(r,c,d,p){return c=Object.assign({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(r,c,d,p)}}let Bv;function Q9(u,r){return r>0?r+2*u:u}const Iee=ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pee=ii([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ree=ii([{name:"a_projected_pos",components:4,type:"Float32"}],4);ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Oee=ii([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),kee=ii([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Dee=ii([{name:"a_texb",components:2,type:"Uint16"}]),Nee=ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Mee=ii([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ii([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const eL=ii([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Lee=ii([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ii([{name:"triangle",components:3,type:"Uint16"}]),ii([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ii([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ii([{type:"Float32",name:"offsetX"}]),ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ks=24;function Bee(u,r,c){return u.sections.forEach(d=>{d.text=function(p,y,_){const v=y.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?p=p.toLocaleUpperCase():v==="lowercase"&&(p=p.toLocaleLowerCase()),Cl.applyArabicShaping&&(p=Cl.applyArabicShaping(p)),p}(d.text,r,c)}),u}const Fv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Fee(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function $ee(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}const Q6=4294967296,tL=1/Q6,nL=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let l5=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,r,c=this.length){for(;this.pos<c;){const d=this.readVarint(),p=d>>3,y=this.pos;this.type=7&d,u(p,r,this),this.pos===y&&this.skip(d)}return r}readMessage(u,r){return this.readFields(u,r,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Q6;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Q6;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const r=this.buf;let c,d;return d=r[this.pos++],c=127&d,d<128?c:(d=r[this.pos++],c|=(127&d)<<7,d<128?c:(d=r[this.pos++],c|=(127&d)<<14,d<128?c:(d=r[this.pos++],c|=(127&d)<<21,d<128?c:(d=r[this.pos],c|=(15&d)<<28,function(p,y,_){const v=_.buf;let T,S;if(S=v[_.pos++],T=(112&S)>>4,S<128||(S=v[_.pos++],T|=(127&S)<<3,S<128)||(S=v[_.pos++],T|=(127&S)<<10,S<128)||(S=v[_.pos++],T|=(127&S)<<17,S<128)||(S=v[_.pos++],T|=(127&S)<<24,S<128)||(S=v[_.pos++],T|=(1&S)<<31,S<128))return q_(p,T,y);throw new Error("Expected varint not more than 10 bytes")}(c,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,r=this.pos;return this.pos=u,u-r>=12&&nL?nL.decode(this.buf.subarray(r,u)):function(c,d,p){let y="",_=d;for(;_<p;){const v=c[_];let T,S,O,k=null,N=v>239?4:v>223?3:v>191?2:1;if(_+N>p)break;N===1?v<128&&(k=v):N===2?(T=c[_+1],(192&T)==128&&(k=(31&v)<<6|63&T,k<=127&&(k=null))):N===3?(T=c[_+1],S=c[_+2],(192&T)==128&&(192&S)==128&&(k=(15&v)<<12|(63&T)<<6|63&S,(k<=2047||k>=55296&&k<=57343)&&(k=null))):N===4&&(T=c[_+1],S=c[_+2],O=c[_+3],(192&T)==128&&(192&S)==128&&(192&O)==128&&(k=(15&v)<<18|(63&T)<<12|(63&S)<<6|63&O,(k<=65535||k>=1114112)&&(k=null))),k===null?(k=65533,N=1):k>65535&&(k-=65536,y+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),y+=String.fromCharCode(k),_+=N}return y}(this.buf,r,u)}readBytes(){const u=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,u);return this.pos=u,r}readPackedVarint(u=[],r){const c=this.readPackedEnd();for(;this.pos<c;)u.push(this.readVarint(r));return u}readPackedSVarint(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const r=this.readPackedEnd();for(;this.pos<r;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const r=7&u;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(u,r){this.writeVarint(u<<3|r)}realloc(u){let r=this.length||16;for(;r<this.pos+u;)r*=2;if(r!==this.length){const c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*tL),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*tL),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(r,c){let d,p;if(r>=0?(d=r%4294967296|0,p=r/4294967296|0):(d=~(-r%4294967296),p=~(-r/4294967296),4294967295^d?d=d+1|0:(d=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(y,_,v){v.buf[v.pos++]=127&y|128,y>>>=7,v.buf[v.pos++]=127&y|128,y>>>=7,v.buf[v.pos++]=127&y|128,y>>>=7,v.buf[v.pos++]=127&y|128,v.buf[v.pos]=127&(y>>>=7)}(d,0,c),function(y,_){const v=(7&y)<<4;_.buf[_.pos++]|=v|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(p,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const r=this.pos;this.pos=function(d,p,y){for(let _,v,T=0;T<p.length;T++){if(_=p.charCodeAt(T),_>55295&&_<57344){if(!v){_>56319||T+1===p.length?(d[y++]=239,d[y++]=191,d[y++]=189):v=_;continue}if(_<56320){d[y++]=239,d[y++]=191,d[y++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(d[y++]=239,d[y++]=191,d[y++]=189,v=null);_<128?d[y++]=_:(_<2048?d[y++]=_>>6|192:(_<65536?d[y++]=_>>12|224:(d[y++]=_>>18|240,d[y++]=_>>12&63|128),d[y++]=_>>6&63|128),d[y++]=63&_|128)}return y}(this.buf,u,this.pos);const c=this.pos-r;c>=128&&iL(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const r=u.length;this.writeVarint(r),this.realloc(r);for(let c=0;c<r;c++)this.buf[this.pos++]=u[c]}writeRawMessage(u,r){this.pos++;const c=this.pos;u(r,this);const d=this.pos-c;d>=128&&iL(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d}writeMessage(u,r,c){this.writeTag(u,2),this.writeRawMessage(r,c)}writePackedVarint(u,r){r.length&&this.writeMessage(u,zee,r)}writePackedSVarint(u,r){r.length&&this.writeMessage(u,Uee,r)}writePackedBoolean(u,r){r.length&&this.writeMessage(u,Wee,r)}writePackedFloat(u,r){r.length&&this.writeMessage(u,jee,r)}writePackedDouble(u,r){r.length&&this.writeMessage(u,Vee,r)}writePackedFixed32(u,r){r.length&&this.writeMessage(u,Hee,r)}writePackedSFixed32(u,r){r.length&&this.writeMessage(u,Gee,r)}writePackedFixed64(u,r){r.length&&this.writeMessage(u,qee,r)}writePackedSFixed64(u,r){r.length&&this.writeMessage(u,Zee,r)}writeBytesField(u,r){this.writeTag(u,2),this.writeBytes(r)}writeFixed32Field(u,r){this.writeTag(u,5),this.writeFixed32(r)}writeSFixed32Field(u,r){this.writeTag(u,5),this.writeSFixed32(r)}writeFixed64Field(u,r){this.writeTag(u,1),this.writeFixed64(r)}writeSFixed64Field(u,r){this.writeTag(u,1),this.writeSFixed64(r)}writeVarintField(u,r){this.writeTag(u,0),this.writeVarint(r)}writeSVarintField(u,r){this.writeTag(u,0),this.writeSVarint(r)}writeStringField(u,r){this.writeTag(u,2),this.writeString(r)}writeFloatField(u,r){this.writeTag(u,5),this.writeFloat(r)}writeDoubleField(u,r){this.writeTag(u,1),this.writeDouble(r)}writeBooleanField(u,r){this.writeVarintField(u,+r)}};function q_(u,r,c){return c?4294967296*r+(u>>>0):4294967296*(r>>>0)+(u>>>0)}function iL(u,r,c){const d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));c.realloc(d);for(let p=c.pos-1;p>=u;p--)c.buf[p+d]=c.buf[p]}function zee(u,r){for(let c=0;c<u.length;c++)r.writeVarint(u[c])}function Uee(u,r){for(let c=0;c<u.length;c++)r.writeSVarint(u[c])}function jee(u,r){for(let c=0;c<u.length;c++)r.writeFloat(u[c])}function Vee(u,r){for(let c=0;c<u.length;c++)r.writeDouble(u[c])}function Wee(u,r){for(let c=0;c<u.length;c++)r.writeBoolean(u[c])}function Hee(u,r){for(let c=0;c<u.length;c++)r.writeFixed32(u[c])}function Gee(u,r){for(let c=0;c<u.length;c++)r.writeSFixed32(u[c])}function qee(u,r){for(let c=0;c<u.length;c++)r.writeFixed64(u[c])}function Zee(u,r){for(let c=0;c<u.length;c++)r.writeSFixed64(u[c])}function Kee(u,r,c){r.glyphs=[],u===1&&c.readMessage(Yee,r)}function Yee(u,r,c){if(u===3){const{id:d,bitmap:p,width:y,height:_,left:v,top:T,advance:S}=c.readMessage(Xee,{});r.glyphs.push({id:d,bitmap:new Dp({width:y+6,height:_+6},p),metrics:{width:y,height:_,left:v,top:T,advance:S}})}else u===4?r.ascender=c.readSVarint():u===5&&(r.descender=c.readSVarint())}function Xee(u,r,c){u===1?r.id=c.readVarint():u===2?r.bitmap=c.readBytes():u===3?r.width=c.readVarint():u===4?r.height=c.readVarint():u===5?r.left=c.readSVarint():u===6?r.top=c.readSVarint():u===7&&(r.advance=c.readVarint())}const _c={horizontal:1,vertical:2,horizontalOnly:3};class $v{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,c){const d=new $v;return d.scale=r||1,d.fontStack=c,d}static forImage(r){const c=new $v;return c.image=r,c}}class Z_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,c,d){const p=new Z_;for(let y=0;y<r.sections.length;y++){const _=r.sections[y];_.image?p.addImageSection(_,d):p.addTextSection(_,c)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(c,d){let p="";for(let y=0;y<c.length;y++){const _=c.charCodeAt(y+1)||null,v=c.charCodeAt(y-1)||null;p+=!d&&(_&&Gb(_)&&!Fv[c[y+1]]||v&&Gb(v)&&!Fv[c[y-1]])||!Fv[c[y]]?c[y]:Fv[c[y]]}return p}(this.text,r)}trim(){let r=0;for(let d=0;d<this.text.length&&u5[this.text.charCodeAt(d)];d++)r++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=r&&u5[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(r,c),this.sectionIndex=this.sectionIndex.slice(r,c)}substring(r,c){const d=new Z_;return d.text=this.text.substring(r,c),d.sectionIndex=this.sectionIndex.slice(r,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,c)=>Math.max(r,this.sections[c].scale),0)}addTextSection(r,c){this.text+=r.text,this.sections.push($v.forText(r.scale,r.fontStack||c));const d=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(d)}addImageSection(r,c){const d=r.image?r.image.getPrimary():null;if(!d)return void In("Can't add FormattedSection with an empty image.");d.scaleSelf(c);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push($v.forImage(d)),this.sectionIndex.push(this.sections.length-1)):In("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function e4(u,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H=1){const K=Z_.fromFeature(u,p,H);k===_c.vertical&&K.verticalizePunctuation(N);let q=[];const X=function(Ee,Te,xe,Oe,Be,lt){if(!Ee)return[];const it=[],st=function(yt,Qe,bt,pt,vt,wt){let Zt=0;for(let Kt=0;Kt<yt.length();Kt++){const $t=yt.getSection(Kt);Zt+=rL(yt.getCodePoint(Kt),$t,pt,vt,Qe,wt)}return Zt/Math.max(1,Math.ceil(Zt/bt))}(Ee,Te,xe,Oe,Be,lt),_t=Ee.text.indexOf("")>=0;let gt=0;for(let yt=0;yt<Ee.length();yt++){const Qe=Ee.getSection(yt),bt=Ee.getCodePoint(yt);if(u5[bt]||(gt+=rL(bt,Qe,Oe,Be,Te,lt)),yt<Ee.length()-1){const pt=sC(bt);(Jee[bt]||pt||Qe.image)&&it.push(oL(yt+1,gt,st,it,Qee(bt,Ee.getCodePoint(yt+1),pt&&_t),!1))}}return aL(oL(Ee.length(),gt,st,it,0,!0))}(K,S,y,r,d,F),{processBidirectionalText:te,processStyledBidirectionalText:se}=Cl;if(te&&K.sections.length===1){const Ee=te(K.toString(),X);for(const Te of Ee){const xe=new Z_;xe.text=Te,xe.sections=K.sections;for(let Oe=0;Oe<Te.length;Oe++)xe.sectionIndex.push(0);q.push(xe)}}else if(se){const Ee=se(K.text,K.sectionIndex,X);for(const Te of Ee){const xe=new Z_;xe.text=Te[0],xe.sectionIndex=Te[1],xe.sections=K.sections,q.push(xe)}}else q=function(Ee,Te){const xe=[],Oe=Ee.text;let Be=0;for(const lt of Te)xe.push(Ee.substring(Be,lt)),Be=lt;return Be<Oe.length&&xe.push(Ee.substring(Be,Oe.length)),xe}(K,X);const ge=[],me={positionedLines:ge,text:K.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ee,Te,xe,Oe,Be,lt,it,st,_t,gt,yt,Qe){let bt=0,pt=0,vt=0;const wt=st==="right"?1:st==="left"?0:.5;let Zt=!1;for(const an of Be){const Wt=an.getSections();for(const Rn of Wt){if(Rn.image)continue;const Qn=Te[Rn.fontStack];if(Qn&&(Zt=Qn.ascender!==void 0&&Qn.descender!==void 0,!Zt))break}if(!Zt)break}let Kt=0;for(const an of Be){an.trim();const Wt=an.getMaxScale(),Rn=(Wt-1)*ks,Qn={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[Kt]=Qn;const Ai=Qn.positionedGlyphs;let Xn=0;if(!an.length()){pt+=lt,++Kt;continue}let ji=0,pi=0;for(let bi=0;bi<an.length();bi++){const Bi=an.getSection(bi),ur=an.getSectionIndex(bi),yr=an.getCodePoint(bi);let _r=Bi.scale,Fr=null,Ws=null,fo=null,os=ks,ys=0,Es=_t;Es===_c.vertical&&oC(yr)&&(Es=_c.horizontal);const qn=!(Es===_c.horizontal||!yt&&!jd(yr)||yt&&(u5[yr]||A_(yr)));if(Bi.image){const wr=Oe.get(Bi.image.toString());if(!wr)continue;fo=Bi.image,Ee.iconsInText=Ee.iconsInText||!0,Ws=wr.paddedRect;const Sr=wr.displaySize;_r=_r*ks/Qe,Fr={width:Sr[0],height:Sr[1],left:0,top:-3,advance:qn?Sr[1]:Sr[0],localGlyph:!1},ys=Zt?-Fr.height*_r:Wt*ks-17-Sr[1]*_r,os=Fr.advance;const wc=(qn?Sr[0]:Sr[1])*_r-ks*Wt;wc>0&&wc>Xn&&(Xn=wc)}else{const wr=xe[Bi.fontStack];if(!wr)continue;wr[yr]&&(Ws=wr[yr]);const Sr=Te[Bi.fontStack];if(!Sr)continue;const wc=Sr.glyphs[yr];if(!wc)continue;if(Fr=wc.metrics,os=yr!==8203?ks:0,Zt){const Xo=Sr.ascender!==void 0?Math.abs(Sr.ascender):0,Hs=Sr.descender!==void 0?Math.abs(Sr.descender):0,Jo=(Xo+Hs)*_r;ji<Jo&&(ji=Jo,pi=(Xo-Hs)/2*_r),ys=-Xo*_r}else ys=(Wt-_r)*ks-17}qn?(Ee.verticalizable=!0,Ai.push({glyph:yr,image:fo,x:bt,y:pt+ys,vertical:qn,scale:_r,localGlyph:Fr.localGlyph,fontStack:Bi.fontStack,sectionIndex:ur,metrics:Fr,rect:Ws}),bt+=os*_r+gt):(Ai.push({glyph:yr,image:fo,x:bt,y:pt+ys,vertical:qn,scale:_r,localGlyph:Fr.localGlyph,fontStack:Bi.fontStack,sectionIndex:ur,metrics:Fr,rect:Ws}),bt+=Fr.advance*_r+gt)}Ai.length!==0&&(vt=Math.max(bt-gt,vt),Zt?cL(Ai,wt,Xn,pi,lt*Wt/2):cL(Ai,wt,Xn,0,lt/2)),bt=0;const Br=lt*Wt+Xn;Qn.lineOffset=Math.max(Xn,Rn),pt+=Br,++Kt}const $t=pt,{horizontalAlign:Ut,verticalAlign:gn}=t4(it);(function(an,Wt,Rn,Qn,Ai,Xn){const ji=(Wt-Rn)*Ai,pi=-Xn*Qn;for(const Br of an)for(const bi of Br.positionedGlyphs)bi.x+=ji,bi.y+=pi})(Ee.positionedLines,wt,Ut,gn,vt,$t),Ee.top+=-gn*$t,Ee.bottom=Ee.top+$t,Ee.left+=-Ut*vt,Ee.right=Ee.left+vt,Ee.hasBaseline=Zt}(me,r,c,d,q,_,v,T,k,S,N,$),!function(Ee){for(const Te of Ee)if(Te.positionedGlyphs.length!==0)return!1;return!0}(ge))return me}const u5={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jee={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rL(u,r,c,d,p,y){if(r.image){const _=d.get(r.image.toString());return _?_.displaySize[0]*r.scale*ks/y+p:0}{const _=c[r.fontStack],v=_&&_.glyphs[u];return v?v.metrics.advance*r.scale+p:0}}function sL(u,r,c,d){const p=Math.pow(u-r,2);return d?u<r?p/2:2*p:p+Math.abs(c)*c}function Qee(u,r,c){let d=0;return u===10&&(d-=1e4),c&&(d+=150),u!==40&&u!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function oL(u,r,c,d,p,y){let _=null,v=sL(r,c,p,y);for(const T of d){const S=sL(r-T.x,c,p,y)+T.badness;S<=v&&(_=T,v=S)}return{index:u,x:r,priorBreak:_,badness:v}}function aL(u){return u?aL(u.priorBreak).concat(u.index):[]}function t4(u){let r=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:r,verticalAlign:c}}function cL(u,r,c,d,p){if(!(r||c||d||p))return;const y=u.length-1,_=u[y],v=(_.x+_.metrics.advance*_.scale)*r;for(let T=0;T<=y;T++)u[T].x-=v,u[T].y+=c+d+p}function n4(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function d5(u,r,c,d){const{horizontalAlign:p,verticalAlign:y}=t4(d),_=c[0]-u.displaySize[0]*p,v=c[1]-u.displaySize[1]*y;return{imagePrimary:u,imageSecondary:r,top:v,bottom:v+u.displaySize[1],left:_,right:_+u.displaySize[0]}}function i4(u,r,c,d,p,y){const _=u.imagePrimary;let v;if(_.content){const K=_.content,q=_.pixelRatio||1;v=[K[0]/q,K[1]/q,_.displaySize[0]-K[2]/q,_.displaySize[1]-K[3]/q]}const T=r.left*y,S=r.right*y;let O,k,N,F;c==="width"||c==="both"?(F=p[0]+T-d[3],k=p[0]+S+d[1]):(F=p[0]+(T+S-_.displaySize[0])/2,k=F+_.displaySize[0]);const $=r.top*y,H=r.bottom*y;return c==="height"||c==="both"?(O=p[1]+$-d[0],N=p[1]+H+d[2]):(O=p[1]+($+H-_.displaySize[1])/2,N=O+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:O,right:k,bottom:N,left:F,collisionPadding:v}}function lL(u){return!u.imagePrimary.stretchX}function uL(u){return!u.imagePrimary.stretchY}function dL(u){return{width:u.right-u.left,height:u.bottom-u.top}}const of=128;function t0(u,r,c,d){const{expression:p}=r;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Ui(u+1,{worldview:c}),void 0,void 0,void 0,d)};if(p.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:_}=p;let v=0;for(;v<y.length&&y[v]<=u;)v++;v=Math.max(0,v-1);let T=v;for(;T<y.length&&y[T]<u+1;)T++;T=Math.min(y.length-1,T);const S=y[v],O=y[T];return p.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:O,interpolationType:_}:{kind:"camera",minZoom:S,maxZoom:O,minSize:p.evaluate(new Ui(S,{worldview:c}),void 0,void 0,void 0,d),maxSize:p.evaluate(new Ui(O,{worldview:c}),void 0,void 0,void 0,d),interpolationType:_}}}function r4(u,{uSize:r,uSizeT:c},{lowerSize:d,upperSize:p}){return u.kind==="source"?d/of:u.kind==="composite"?xn(d/of,p/of,c):r}function K_(u,r,c=1){let d=0,p=0;if(u.kind==="constant")p=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:y,minZoom:_,maxZoom:v}=u,T=y?ve(dc.interpolationFactor(y,r,_,v),0,1):0;u.kind==="camera"?p=xn(u.minSize,u.maxSize,T)*c:d=T*c}return{uSizeT:d,uSize:p}}class af extends Tt{constructor(r,c,d,p,y){super(r,c),this.angle=p,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new af(this.x,this.y,this.z,this.angle,this.segment)}}function hL(u,r,c,d,p){if(r.segment===void 0)return!0;let y=r,_=r.segment+1,v=0;for(;v>-c/2;){if(_--,_<0)return!1;v-=u[_].dist(y),y=u[_]}v+=u[_].dist(u[_+1]),_++;const T=[];let S=0;for(;v<c/2;){const O=u[_],k=u[_+1];if(!k)return!1;let N=u[_-1].angleTo(O)-O.angleTo(k);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:N}),S+=N;v-T[0].distance>d;)S-=T.shift().angleDelta;if(S>p)return!1;_++,v+=O.dist(k)}return!0}function fL(u){let r=0;for(let c=0;c<u.length-1;c++)r+=u[c].dist(u[c+1]);return r}function pL(u,r,c){return u?.6*r*c:0}function mL(u,r){return Math.max(u?u.right-u.left:0,r?r.right-r.left:0)}function ete(u,r,c,d,p,y){const _=pL(c,p,y),v=mL(c,d)*y;let T=0;const S=fL(u)/2;for(let O=0;O<u.length-1;O++){const k=u[O],N=u[O+1],F=k.dist(N);if(T+F>S){const $=(S-T)/F,H=xn(k.x,N.x,$),K=xn(k.y,N.y,$),q=new af(H,K,0,N.angleTo(k),O);return!_||hL(u,q,v,_,r)?q:void 0}T+=F}}function tte(u,r,c,d,p,y,_,v,T){const S=pL(d,y,_),O=mL(d,p),k=O*_,N=u[0].x===0||u[0].x===T||u[0].y===0||u[0].y===T;return r-k<r/4&&(r=k+r/4),gL(u,N?r/2*v%r:(O/2+2*y)*_*v%r,r,S,c,k,N,!1,T)}function gL(u,r,c,d,p,y,_,v,T){const S=y/2,O=fL(u);let k=0,N=r-c,F=[];for(let $=0;$<u.length-1;$++){const H=u[$],K=u[$+1],q=H.dist(K),X=K.angleTo(H);for(;N+c<k+q;){N+=c;const te=(N-k)/q,se=xn(H.x,K.x,te),ge=xn(H.y,K.y,te);if(se>=0&&se<T&&ge>=0&&ge<T&&N-S>=0&&N+S<=O){const me=new af(se,ge,0,X,$);d&&!hL(u,me,y,d,p)||F.push(me)}}k+=q}return v||F.length||_||(F=gL(u,k/2,c,d,p,y,_,!0,T)),F}function yL(u){let r=0,c=0;for(const _ of u)r+=_.w*_.h,c=Math.max(c,_.w);u.sort((_,v)=>v.h-_.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),c),h:1/0}];let p=0,y=0;for(const _ of u)for(let v=d.length-1;v>=0;v--){const T=d[v];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,y=Math.max(y,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===T.w&&_.h===T.h){const S=d.pop();S&&v<d.length&&(d[v]=S)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(d.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:p,h:y,fill:r/(p*y)||0}}Qt(af,"Anchor");class zv{static getImagePositionScale(r,c,d){if(c&&r){const{sx:p,sy:y}=r;return{x:p,y}}return{x:d,y:d}}constructor(r,c,d,p){this.paddedRect=r;const{pixelRatio:y,version:_,stretchX:v,stretchY:T,content:S,sdf:O,usvg:k}=c;this.pixelRatio=y,this.stretchX=v,this.stretchY=T,this.content=S,this.version=_,this.padding=d,this.sdf=O,this.usvg=k,this.scale=zv.getImagePositionScale(p,k,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function s4(u,r,c){const d=ma.parse(u),p=function(y,_,v=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*v[0])+2*_,h:(y.data?y.data.height:y.height*v[1])+2*_}}(r,c,[d.sx,d.sy]);return{bin:p,imagePosition:new zv(p,r,c,d),imageVariant:d}}class _L{constructor(r,c,d){const p=new Map,y=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(r,p,1,_),this.addImages(c,y,2,_);const{w:v,h:T}=yL(_),S=new ho({width:v||1,height:T||1});for(const[O,k]of r.entries()){const N=p.get(O).paddedRect;ho.copy(k.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},k.data,null,k.sdf)}for(const[O,k]of c.entries()){const N=y.get(O),F=N.paddedRect;let $=N.padding;const H=F.x+$,K=F.y+$,q=k.data.width,X=k.data.height;$=$>1?$-1:$,ho.copy(k.data,S,{x:0,y:0},{x:H,y:K},k.data,d),ho.copy(k.data,S,{x:0,y:X-$},{x:H,y:K-$},{width:q,height:$},d),ho.copy(k.data,S,{x:0,y:0},{x:H,y:K+X},{width:q,height:$},d),ho.copy(k.data,S,{x:q-$,y:0},{x:H-$,y:K},{width:$,height:X},d),ho.copy(k.data,S,{x:0,y:0},{x:H+q,y:K},{width:$,height:X},d),ho.copy(k.data,S,{x:q-$,y:X-$},{x:H-$,y:K-$},{width:$,height:$},d),ho.copy(k.data,S,{x:0,y:X-$},{x:H+q,y:K-$},{width:$,height:$},d),ho.copy(k.data,S,{x:0,y:0},{x:H+q,y:K+X},{width:$,height:$},d),ho.copy(k.data,S,{x:q-$,y:0},{x:H-$,y:K+X},{width:$,height:$},d)}this.lut=d,this.image=S,this.iconPositions=p,this.patternPositions=y}addImages(r,c,d,p){for(const[y,_]of r.entries()){const{bin:v,imagePosition:T,imageVariant:S}=s4(y,_,d);c.set(y,T),p.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(r,c,d,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(y=>r.hasImage(y,d)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const y of r.getUpdatedImages(d)){for(const _ of this.iconPositions.keys()){const v=ma.parse(_);if(fa.isEqual(v.id,y)){const T=r.getImage(y,d);this.patchUpdatedImage(this.iconPositions.get(_),T,c,null)}}for(const _ of this.patternPositions.keys()){const v=ma.parse(_);if(fa.isEqual(v.id,y)){const T=r.getImage(y,d);this.patchUpdatedImage(this.patternPositions.get(_),T,c,p||this.lut)}}}}patchUpdatedImage(r,c,d,p=null){if(!r||!c||r.version===c.version)return;r.version=c.version;const[y,_]=r.tl,v=r.sdf;if(this.lut||v){const T={width:c.data.width,height:c.data.height},S=new ho(T);ho.copy(c.data,S,{x:0,y:0},{x:0,y:0},T,p,v),d.update(S,{position:{x:y,y:_}})}else d.update(c.data,{position:{x:y,y:_}})}}Qt(zv,"ImagePosition"),Qt(_L,"ImageAtlas",{omit:["lut"]});const Uv=1e20;function wL(u,r,c,d,p,y,_,v,T){for(let S=r;S<r+d;S++)bL(u,c*y+S,y,p,_,v,T);for(let S=c;S<c+p;S++)bL(u,S*y+r,1,d,_,v,T)}function bL(u,r,c,d,p,y,_){y[0]=0,_[0]=-Uv,_[1]=Uv,p[0]=u[r];for(let v=1,T=0,S=0;v<d;v++){p[v]=u[r+v*c];const O=v*v;do{const k=y[T];S=(p[v]-p[k]+O-k*k)/(v-k)/2}while(S<=_[T]&&--T>-1);T++,y[T]=v,_[T]=S,_[T+1]=Uv}for(let v=0,T=0;v<d;v++){for(;_[T+1]<v;)T++;const S=y[T],O=v-S;u[r+v*c]=p[S]+O*O}}const o4={none:0,ideographs:1,all:2};class Y_{constructor(r,c,d){this.requestManager=r,this.localGlyphMode=c,this.localFontFamily=d,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,c){const d=[],p=this.url||fs.GLYPHS_URL;for(const y in r)for(const _ of r[y])d.push({stack:y,id:_});Ge(d,({stack:y,id:_},v)=>{let T=this.entries[y];T||(T=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=T.glyphs[_];if(S!==void 0)return void v(null,{stack:y,id:_,glyph:S});if(S=this._tinySDF(T,y,_),S)return T.glyphs[_]=S,void v(null,{stack:y,id:_,glyph:S});const O=Math.floor(_/256);if(256*O>65535)return In("glyphs > 65535 not supported"),void v(null,{stack:y,id:_,glyph:S});if(T.ranges[O])return void v(null,{stack:y,id:_,glyph:S});let k=T.requests[O];k||(k=T.requests[O]=[],Y_.loadGlyphRange(y,O,p,this.requestManager,(N,F)=>{if(F){T.ascender=F.ascender,T.descender=F.descender;for(const $ in F.glyphs)this._doesCharSupportLocalGlyph(+$)||(T.glyphs[+$]=F.glyphs[+$]);T.ranges[O]=!0}for(const $ of k)$(N,F);delete T.requests[O]})),k.push((N,F)=>{N?v(N):F&&v(null,{stack:y,id:_,glyph:F.glyphs[_]||null})})},(y,_)=>{if(y)c(y);else if(_){const v={};for(const{stack:T,id:S,glyph:O}of _)v[T]===void 0&&(v[T]={}),v[T].glyphs===void 0&&(v[T].glyphs={}),v[T].glyphs[S]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},v[T].ascender=this.entries[T].ascender,v[T].descender=this.entries[T].descender;c(null,v)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==o4.none&&(this.localGlyphMode===o4.all?!!this.localFontFamily:!!this.localFontFamily&&(C_(r)||tC(r)||bp(r)||Dg(r)||wp(r)||vp(r)||(c=r)>=131072&&c<=173791||(d=>d>=66736&&d<=66815)(r)));var c}_tinySDF(r,c,d){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=r.tinySDF;if(!y){let H="400";/bold/i.test(c)?H="900":/medium/i.test(c)?H="500":/light/i.test(c)&&(H="200"),y=r.tinySDF=new Y_.TinySDF({fontFamily:p,fontWeight:H,fontSize:48,buffer:6,radius:16}),y.fontWeight=H}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const _=String.fromCodePoint(d),{data:v,width:T,height:S,glyphWidth:O,glyphHeight:k,glyphLeft:N,glyphTop:F,glyphAdvance:$}=y.draw(_);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new Dp({width:T,height:S},v),metrics:{width:O/2,height:k/2,left:N/2,top:F/2-27,advance:$/2,localGlyph:!0}}}}function vL(u,r){return u+r[1]-r[0]}function a4(u,r,c,d,p=1){const y=[],_=u.imagePrimary,v=_.pixelRatio,T=_.paddedRect.w-2,S=_.paddedRect.h-2,O=(u.right-u.left)*p,k=(u.bottom-u.top)*p,N=_.stretchX||[[0,T]],F=_.stretchY||[[0,S]],$=N.reduce(vL,0),H=F.reduce(vL,0),K=T-$,q=S-H;let X=0,te=$,se=0,ge=H,me=0,Ee=K,Te=0,xe=q;if(_.content&&d){const Be=_.content;X=h5(N,0,Be[0]),se=h5(F,0,Be[1]),te=h5(N,Be[0],Be[2]),ge=h5(F,Be[1],Be[3]),me=Be[0]-X,Te=Be[1]-se,Ee=Be[2]-Be[0]-te,xe=Be[3]-Be[1]-ge}const Oe=(Be,lt,it,st)=>{const _t=f5(Be.stretch-X,te,O,u.left*p),gt=p5(Be.fixed-me,Ee,Be.stretch,$),yt=f5(lt.stretch-se,ge,k,u.top*p),Qe=p5(lt.fixed-Te,xe,lt.stretch,H),bt=f5(it.stretch-X,te,O,u.left*p),pt=p5(it.fixed-me,Ee,it.stretch,$),vt=f5(st.stretch-se,ge,k,u.top*p),wt=p5(st.fixed-Te,xe,st.stretch,H),Zt=new Tt(_t,yt),Kt=new Tt(bt,yt),$t=new Tt(bt,vt),Ut=new Tt(_t,vt),gn=new Tt(gt/v,Qe/v),an=new Tt(pt/v,wt/v),Wt=r*Math.PI/180;if(Wt){const pi=Math.sin(Wt),Br=Math.cos(Wt),bi=[Br,-pi,pi,Br];Zt._matMult(bi),Kt._matMult(bi),Ut._matMult(bi),$t._matMult(bi)}const Rn=Be.stretch+Be.fixed,Qn=it.stretch+it.fixed,Ai=lt.stretch+lt.fixed,Xn=st.stretch+st.fixed,ji=u.imageSecondary;return{tl:Zt,tr:Kt,bl:Ut,br:$t,texPrimary:{x:_.paddedRect.x+1+Rn,y:_.paddedRect.y+1+Ai,w:Qn-Rn,h:Xn-Ai},texSecondary:ji?{x:ji.paddedRect.x+1+Rn,y:ji.paddedRect.y+1+Ai,w:Qn-Rn,h:Xn-Ai}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gn,pixelOffsetBR:an,minFontScaleX:Ee/v/O,minFontScaleY:xe/v/k,isSDF:c}};if(_.stretchX||_.stretchY){const Be=xL(N,K,$),lt=xL(F,q,H);for(let it=0;it<Be.length-1;it++){const st=Be[it],_t=Be[it+1];for(let gt=0;gt<lt.length-1;gt++)y.push(Oe(st,lt[gt],_t,lt[gt+1]))}}else y.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:S+1}));return y}function nte(u,r){const c=u.stretchY||[[0,u.paddedRect.h-2]];return u.stretchX||u.stretchY?EL(u.stretchX||[[0,u.paddedRect.w-2]])*EL(c):1}function h5(u,r,c){let d=0;for(const p of u)d+=Math.max(r,Math.min(c,p[1]))-Math.max(r,Math.min(c,p[0]));return d}function xL(u,r,c){const d=[{fixed:-1,stretch:0}];for(const[p,y]of u){const _=d[d.length-1];d.push({fixed:p-_.stretch,stretch:_.stretch}),d.push({fixed:p-_.stretch,stretch:_.stretch+(y-p)})}return d.push({fixed:r+1,stretch:c}),d}function EL(u){return 2*u.length+1}function f5(u,r,c,d){return u/r*c+d}function p5(u,r,c,d){return u-r*c/d}function ite(u,r,c,d){const p=r+u.positionedLines[d].lineOffset;return d===0?c+p/2:c+(p+(r+u.positionedLines[d-1].lineOffset))/2}function CL(u,r,c,d,p,y,_,v,T){const S=[];if(r.positionedLines.length===0)return S;const O=(T!==void 0?T:d.layout.get("text-rotate").evaluate(y,{}))*Math.PI/180,k=function(K){const q=K[0],X=K[1],te=q*X;return te>0?[q,-X]:te<0?[-q,X]:q===0?[X,q]:[X,-q]}(c);let N=Math.abs(r.top-r.bottom);for(const K of r.positionedLines)N-=K.lineOffset;const F=r.positionedLines.length,$=N/F;let H=r.top-c[1];for(let K=0;K<F;++K){const q=r.positionedLines[K];H=ite(r,$,H,K);for(const X of q.positionedGlyphs){if(!X.rect)continue;const te=X.rect||{};let se=4,ge=!0,me=1,Ee=0;if(X.image){const Kt=_.get(X.image.toString());if(!Kt)continue;if(Kt.sdf){In("SDF images are not supported in formatted text and will be ignored.");continue}ge=!1,me=Kt.pixelRatio,se=1/me}const Te=(p||v)&&X.vertical,xe=X.metrics.advance*X.scale/2,Oe=X.metrics,Be=X.rect;if(Be===null)continue;v&&r.verticalizable&&(Ee=X.image?xe-X.metrics.width*X.scale/2:0);const lt=p?[X.x+xe,X.y]:[0,0];let it=[0,0],st=[0,0],_t=!1;p||(Te?(st=[X.x+xe+k[0],X.y+k[1]-Ee],_t=!0):it=[X.x+xe+c[0],X.y+c[1]-Ee]);const gt=Be.w*X.scale/(me*(X.localGlyph?2:1)),yt=Be.h*X.scale/(me*(X.localGlyph?2:1));let Qe,bt,pt,vt;if(Te){const Kt=X.y-H,$t=new Tt(-xe,xe-Kt),Ut=-Math.PI/2,gn=new Tt(...st);Qe=new Tt(-xe+it[0],it[1]),Qe._rotateAround(Ut,$t)._add(gn),Qe.x+=-Kt+xe,Qe.y-=(Oe.left-se)*X.scale;const an=X.image?Oe.advance*X.scale:ks*X.scale,Wt=String.fromCodePoint(X.glyph);Fee(Wt)?Qe.x+=(1-se)*X.scale:$ee(Wt)?Qe.x+=an-Oe.height*X.scale+(-se-1)*X.scale:Qe.x+=X.image||Oe.width+2*se===Be.w&&Oe.height+2*se===Be.h?(an-yt)/2:(an-(Oe.height+2*se)*X.scale)/2,bt=new Tt(Qe.x,Qe.y-gt),pt=new Tt(Qe.x+yt,Qe.y),vt=new Tt(Qe.x+yt,Qe.y-gt)}else{const Kt=(Oe.left-se)*X.scale-xe+it[0],$t=(-Oe.top-se)*X.scale+it[1],Ut=Kt+gt,gn=$t+yt;Qe=new Tt(Kt,$t),bt=new Tt(Ut,$t),pt=new Tt(Kt,gn),vt=new Tt(Ut,gn)}if(O){let Kt;Kt=p?new Tt(0,0):_t?new Tt(k[0],k[1]):new Tt(c[0],c[1]),Qe._rotateAround(O,Kt),bt._rotateAround(O,Kt),pt._rotateAround(O,Kt),vt._rotateAround(O,Kt)}const wt=new Tt(0,0),Zt=new Tt(0,0);S.push({tl:Qe,tr:bt,bl:pt,br:vt,texPrimary:te,texSecondary:void 0,writingMode:r.writingMode,glyphOffset:lt,sectionIndex:X.sectionIndex,isSDF:ge,pixelOffsetTL:wt,pixelOffsetBR:Zt,minFontScaleX:0,minFontScaleY:0})}}return S}function rte(u,r=1,c=!1){let d=1/0,p=1/0,y=-1/0,_=-1/0;const v=u[0];for(let F=0;F<v.length;F++){const $=v[F];(!F||$.x<d)&&(d=$.x),(!F||$.y<p)&&(p=$.y),(!F||$.x>y)&&(y=$.x),(!F||$.y>_)&&(_=$.y)}const T=Math.min(y-d,_-p);let S=T/2;const O=new vg([],ste);if(T===0)return new Tt(d,p);for(let F=d;F<y;F+=T)for(let $=p;$<_;$+=T)O.push(new X_(F+S,$+S,S,u));let k=function(F){let $=0,H=0,K=0;const q=F[0];for(let X=0,te=q.length,se=te-1;X<te;se=X++){const ge=q[X],me=q[se],Ee=ge.x*me.y-me.x*ge.y;H+=(ge.x+me.x)*Ee,K+=(ge.y+me.y)*Ee,$+=3*Ee}return new X_(H/$,K/$,0,F)}(u),N=O.length;for(;O.length;){const F=O.pop();(F.d>k.d||!k.d)&&(k=F,c&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,N)),F.max-k.d<=r||(S=F.h/2,O.push(new X_(F.p.x-S,F.p.y-S,S,u)),O.push(new X_(F.p.x+S,F.p.y-S,S,u)),O.push(new X_(F.p.x-S,F.p.y+S,S,u)),O.push(new X_(F.p.x+S,F.p.y+S,S,u)),N+=4)}return c&&(console.log(`num probes: ${N}`),console.log(`best distance: ${k.d}`)),k.p}function ste(u,r){return r.max-u.max}Y_.loadGlyphRange=function(u,r,c,d,p){const y=256*r,_=y+255,v=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${y}-${_}`),ha.Glyphs);dg(v,(T,S)=>{if(T)p(T);else if(S){const O={},k=function(N){return new l5(N).readFields(Kee,{})}(S);for(const N of k.glyphs)O[N.id]=N;p(null,{glyphs:O,ascender:k.ascender,descender:k.descender})}})},Y_.TinySDF=class{constructor({fontSize:u=24,buffer:r=3,radius:c=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=r,this.cutoff=d,this.radius=c,this.lang=v;const T=this.size=u+4*r,S=this._createCanvas(T),O=this.ctx=S.getContext("2d",{willReadFrequently:!0});O.font=`${_} ${y} ${u}px ${p}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(u){const r=document.createElement("canvas");return r.width=r.height=u,r}draw(u){const{width:r,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(u),_=Math.ceil(c),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),T=Math.min(this.size-this.buffer,_+Math.ceil(d)),S=v+2*this.buffer,O=T+2*this.buffer,k=Math.max(S*O,0),N=new Uint8ClampedArray(k),F={data:N,width:S,height:O,glyphWidth:v,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(v===0||T===0)return F;const{ctx:$,buffer:H,gridInner:K,gridOuter:q}=this;this.lang&&($.lang=this.lang),$.clearRect(H,H,v,T),$.fillText(u,H,H+_);const X=$.getImageData(H,H,v,T);q.fill(Uv,0,k),K.fill(0,0,k);for(let te=0;te<T;te++)for(let se=0;se<v;se++){const ge=X.data[4*(te*v+se)+3]/255;if(ge===0)continue;const me=(te+H)*S+se+H;if(ge===1)q[me]=0,K[me]=Uv;else{const Ee=.5-ge;q[me]=Ee>0?Ee*Ee:0,K[me]=Ee<0?Ee*Ee:0}}wL(q,0,0,S,O,S,this.f,this.v,this.z),wL(K,H,H,v,T,S,this.f,this.v,this.z);for(let te=0;te<k;te++){const se=Math.sqrt(q[te])-Math.sqrt(K[te]);N[te]=Math.round(255-255*(se/this.radius+this.cutoff))}return F}};class X_{constructor(r,c,d,p){this.p=new Tt(r,c),this.h=d,this.d=function(y,_){let v=!1,T=1/0;for(let S=0;S<_.length;S++){const O=_[S];for(let k=0,N=O.length,F=N-1;k<N;F=k++){const $=O[k],H=O[F];$.y>y.y!=H.y>y.y&&y.x<(H.x-$.x)*(y.y-$.y)/(H.y-$.y)+$.x&&(v=!v),T=Math.min(T,Rp(y,$,H))}}return(v?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const ote=Object.keys,c4=Number.POSITIVE_INFINITY,ate=Math.sqrt(2);function Bp(u,r,c,d,p){const y=n4(u)&&u.collisionPadding?u.collisionPadding:[0,0,0,0],_={top:u.top-y[1],bottom:u.bottom+y[3],left:u.left-y[0],right:u.right+y[2],scaled:!1};return d!==void 0&&function(v,T){v.top*=T,v.bottom*=T,v.left*=T,v.right*=T,v.scaled=!0}(_,d),c&&function(v,T){if(!T)return;const S=_i(T),O=new Tt(v.left,v.top),k=new Tt(v.right,v.top),N=new Tt(v.left,v.bottom),F=new Tt(v.right,v.bottom),$=new Tt(0,0);O._rotateAround(S,$),k._rotateAround(S,$),N._rotateAround(S,$),F._rotateAround(S,$),v.left=Math.min(O.x,k.x,N.x,F.x),v.right=Math.max(O.x,k.x,N.x,F.x),v.top=Math.min(O.y,k.y,N.y,F.y),v.bottom=Math.max(O.y,k.y,N.y,F.y)}(_,c),p&&(_.left+=p[0],_.right+=p[0],_.top+=p[1],_.bottom+=p[1]),r?{top:Math.min(r.top,_.top),bottom:Math.max(r.bottom,_.bottom),left:Math.min(r.left,_.left),right:Math.max(r.right,_.right),scaled:r.scaled||_.scaled}:_}function TL(u,[r,c]){let d=0,p=0;if(c===c4){r<0&&(r=0);const y=r/ate;switch(u){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-r;break;case"top":p=r-7}switch(u){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=r;break;case"right":d=-r}}else{switch(r=Math.abs(r),c=Math.abs(c),u){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(u){case"top-right":case"bottom-right":case"right":d=-r;break;case"top-left":case"bottom-left":case"left":d=r}}return[d,p]}function cte(u,r,c,d,p,y,_,v,T,S,O,k,N,F,$){const H=u.layers[0],K=H.appearances;if(K.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const q={iconBBox:null,iconVerticalBBox:null},X={textBBox:null,textVerticalBBox:null},{baseIconRotate:te,baseTextRotate:se,iconScaleFactor:ge}=function(Ee,Te,xe){const Oe=Ee.get("icon-rotate").evaluate(Te,{},xe),Be=Ee.get("text-rotate").evaluate(Te,{},xe),[lt,it]=Ee.get("icon-size-scale-range");return{baseIconRotate:Oe,baseTextRotate:Be,iconScaleFactor:ve(1,lt,it)}}(d,p,y);r&&(q.iconBBox=Bp(r,q.iconBBox,te,_),c)&&(q.iconVerticalBBox=Bp(c,q.iconVerticalBBox,te+90,_));const me=g5(k.horizontal);me&&(X.textBBox=Bp(me,X.textBBox,se,1,F)),k.vertical&&(X.textVerticalBBox=Bp(k.vertical,X.textVerticalBBox,se+90,1,F));for(const Ee of K)Ee.hasIconProperties()&&lte(q,u,H,Ee,p,y,v,te,_,T,r,S,ge,O,$),Ee.hasTextProperties()&&ute(X,H,Ee,p,y,F,se,N,me,k.vertical);return{iconBBox:q.iconBBox,iconVerticalBBox:q.iconVerticalBBox,textBBox:X.textBBox,textVerticalBBox:X.textVerticalBBox}}function lte(u,r,c,d,p,y,_,v,T,S,O,k,N,F,$){const{appearanceIconOffset:H,appearanceIconRotate:K,appearanceIconSize:q}=AL(d,c,p,y,_,v,T,S.iconScaleFactor);let X=null,te=null,se=null;d.hasProperty("icon-image")?se=function(ge,me,Ee,Te,xe,Oe,Be,lt){let it=null;const st=me.getAppearanceValueAndResolveTokens(Ee,"icon-image",Te,xe,lt);if(st){const _t=ge.getResolvedImageFromTokens(st),gt=Ee.getUnevaluatedProperty("icon-size"),yt=jv(_t,t0(ge.zoom,gt,ge.worldview,lt),gt,xe,ge.zoom,Te,ge.pixelRatio,Be,ge.worldview,lt);it=Oe.get(yt.iconPrimary.toString())}return it}(r,c,d,p,y,k,N,$):O&&(se=O.imagePrimary),se&&(X=d5(se,null,H,F),r.allowVerticalPlacement&&(te=d5(se,null,H,F))),X&&(u.iconBBox=Bp(X,u.iconBBox,K,q)),te&&(u.iconVerticalBBox=Bp(te,u.iconVerticalBBox,K+90,q))}function AL(u,r,c,d,p,y,_,v){const T=u.hasProperty("icon-offset")?r.getAppearanceValueAndResolveTokens(u,"icon-offset",c,d,[]):null,S=T&&Array.isArray(T)?T:p,O=u.hasProperty("icon-rotate")?r.getAppearanceValueAndResolveTokens(u,"icon-rotate",c,d,[]):null,k=typeof O=="number"?O:y,N=u.hasProperty("icon-size")?r.getAppearanceValueAndResolveTokens(u,"icon-size",c,d,[]):null;return{appearanceIconOffset:S,appearanceIconRotate:k,appearanceIconSize:typeof N=="number"?N*v:_}}function ute(u,r,c,d,p,y,_,v,T,S){const{appearanceTextOffset:O,appearanceTextRotate:k,appearanceTextSize:N}=SL(c,r,d,p,y,_,v),F=N/v;T&&(u.textBBox=Bp(T,u.textBBox,k,F,O)),S&&(u.textVerticalBBox=Bp(S,u.textVerticalBBox,k+90,F,O))}function SL(u,r,c,d,p,y,_){const v=u.hasProperty("text-offset")?r.getAppearanceValueAndResolveTokens(u,"text-offset",c,d,[]):null,T=v&&Array.isArray(v)?[v[0]*ks,v[1]*ks]:p,S=u.hasProperty("text-rotate")?r.getAppearanceValueAndResolveTokens(u,"text-rotate",c,d,[]):null,O=typeof S=="number"?S:y,k=u.hasProperty("text-size")?r.getAppearanceValueAndResolveTokens(u,"text-size",c,d,[]):null;return{appearanceTextOffset:T,appearanceTextRotate:O,appearanceTextSize:typeof k=="number"?k:_}}function m5(u,r,c,d,p,y,_,v,T){if(!r||!r.usvg)return;const S=dL(d),O=dL(p),k=y!=="both"&&y!=="width"||!lL(d)?1:O.width/S.width,N=y!=="both"&&y!=="height"||!uL(d)?1:O.height/S.height;c.scaleSelf(k,N);const F=c.toString();_.set(F,c),v.set(F,r);const{imagePosition:$}=s4(F,r,1);T.set(F,$)}function IL(u,r,c,d,p,y,_,v,T,S){if(!u)return;const O=function(k,N,F,$,H,K,q){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const X=N.possiblyEvaluate(new Ui(k.maxZoom,{worldview:K}),F,q).evaluate(H,{},F,q),te=N.possiblyEvaluate(new Ui(k.minZoom,{worldview:K}),F,q).evaluate(H,{},F,q);return Math.max(X,te)}return N.possiblyEvaluate(new Ui($,{worldview:K}),F,q).evaluate(H,{},F,q)}(r,c,d,p,y,T,S);return u.scaleSelf(O*v*_)}function jv(u,r,c,d,p,y,_,v,T,S){return{iconPrimary:IL(u.getPrimary(),r,c,d,p,y,_,v,T,S),iconSecondary:IL(u.getSecondary(),r,c,d,p,y,_,v,T,S)}}function dte(u,r,c){if(!r)return;const d=c.get(u.toString()),p=c.get(r.toString());d&&p&&(d.paddedRect.w===p.paddedRect.w&&d.paddedRect.h===p.paddedRect.h||In(`Mismatch in icon variant sizes: ${u.toString()} and ${r.toString()}`),d.usvg!==p.usvg&&In(`Mismatch in icon variant image types: ${u.id} and ${r.id}`))}function PL(u,r,c,d){if(!u)return;const p=r.get(c.toString());if(u.imagePrimary=p,d){const y=r.get(d.toString());u.imageSecondary=y}}function hte(u,r){for(const c in u.horizontal)RL(u.horizontal[c],r);RL(u.vertical,r)}function RL(u,r){if(u){for(const c of u.positionedLines)for(const d of c.positionedGlyphs)if(d.image!==null){const p=d.image.toString();d.rect=r.get(p).paddedRect}}}function l4(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fte(u,r,c,d,p,y,_,v,T){const S=g5(y.horizontal)||y.vertical,O=c.get("icon-text-fit-padding").evaluate(d,{},p);let k,N=r;return r&&T!=="none"&&(u.allowVerticalPlacement&&y.vertical&&(k=i4(r,y.vertical,T,O,v,_)),S&&(N=i4(r,S,T,O,v,_))),{defaultShapedIcon:N,verticallyShapedIcon:k}}function OL(u,r){return u*r/24}function pte(u,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X,te,se,ge,me,Ee){let Te=_.textMaxSize.evaluate(r,{},N);Te===void 0?Te=v*_.textScaleFactor:Te*=_.textScaleFactor;const xe=u.layers[0].layout,Oe=OL(v,_.textScaleFactor),Be=g5(c.horizontal)||c.vertical,lt=u.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((K!=="none"||lt)&&u.appearanceFeatureData&&u.featureToAppearanceIndex[r.index]<u.appearanceFeatureData.length){const $t=u.appearanceFeatureData[u.featureToAppearanceIndex[r.index]];$t&&($t.textShaping=Be,$t.iconTextFitPadding=xe.get("icon-text-fit-padding").evaluate(r,{},N),$t.fontScale=Oe,$t.textScaleFactor=_.textScaleFactor)}const it=F.name==="globe",st=u.tilePixelRatio*Te/24,_t=(vt=u.overscaling,u.zoom>18&&vt>2&&(vt>>=1),Math.max(zt/(512*vt),1)*xe.get("symbol-spacing")),gt=xe.get("text-padding")*u.tilePixelRatio,yt=xe.get("icon-padding")*u.tilePixelRatio,Qe=_i(xe.get("text-max-angle")),bt=xe.get("icon-rotation-alignment")==="map"&&te!=="point",pt=_t/2;var vt;u.hasAnyIconTextFit===!1&&K!=="none"&&(u.hasAnyIconTextFit=!0);const wt=r.properties?+r.properties[li]:null,Zt=wt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(wt):65535,Kt=($t,Ut,gn)=>{if(Ut.x<0||Ut.x>=zt||Ut.y<0||Ut.y>=zt)return;let an=null;if(it){const{x:Wt,y:Rn,z:Qn}=F.projectTilePoint(Ut.x,Ut.y,gn);an={anchor:new af(Wt,Rn,Qn,0,void 0),up:F.upVector(gn,Ut.x,Ut.y)}}(function(Wt,Rn,Qn,Ai,Xn,ji,pi,Br,bi,Bi,ur,yr,_r,Fr,Ws,fo,os,ys,Es,qn,wr,Sr,wc,Xo,Hs,Jo,Jd,Co,D5,r1,ba,N5){const Qd=Wt.addToLineVertexArray(Rn,Ai);let cf,zp,Sl,uu,rx,s1,Jn,Ds=0,$r=0,_s=0,Il=0,$a=-1,bc=-1;const Ns={};let sx=rp("");const eh=Qn?Qn.anchor:Rn,as=Co!=="none";let Gs=0,ws=0;if(bi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const qs=bi.layout.get("text-offset").evaluate(wr,{},Hs);Gs=qs[0]*ks,ws=qs[1]*ks}else Gs=bi.layout.get("text-radial-offset").evaluate(wr,{},Hs)*ks,ws=c4;if(Wt.allowVerticalPlacement&&Xn.vertical){const qs=Xn.vertical;if(Ws)s1=h4(qs),Br&&(Jn=h4(Br));else{const za=bi.layout.get("text-rotate").evaluate(wr,{},Hs)+90;Sl=y5(Bi,eh,Rn,ur,yr,_r,qs,Fr,za,fo,N5),Br&&(uu=y5(Bi,eh,Rn,ur,yr,_r,Br,ys,za,null,ba))}}if(ji){const qs=bi.layout.get("icon-rotate").evaluate(wr,{},Hs),za=a4(ji,qs,wc,as,Sr.iconScaleFactor),du=Br?a4(Br,qs,wc,as,Sr.iconScaleFactor):void 0;zp=y5(Bi,eh,Rn,ur,yr,_r,ji,ys,qs,null,r1);const th=function(Ju,Ane,KB,Sne,Ine,YB,XB,Pne,$9e,L4){const JB=Ju.layers[0],QB=JB.appearances;let a1=Ane.length;if(KB&&(a1=Math.max(a1,KB.length)),QB.length===0)return a1;const[Rne,One]=Sne.get("icon-size-scale-range"),kne=ve(1,Rne,One);for(const B4 of QB){const eF=B4.getUnevaluatedProperties();if(eF._values["icon-image"].value!==void 0){const tF=JB.getAppearanceValueAndResolveTokens(B4,"icon-image",YB,XB,L4);if(tF){const nF=Ju.getResolvedImageFromTokens(tF);if(nF){const iF=B4.hasProperty("icon-size")?eF._values["icon-size"]:Ine._values["icon-size"],Dne=jv(nF,t0(Ju.zoom,iF,Ju.worldview,L4),iF,XB,Ju.zoom,YB,Ju.pixelRatio,kne,Ju.worldview,L4),rF=Pne.get(Dne.iconPrimary.toString());rF&&(a1=Math.max(a1,nte(rF)))}}}}return a1}(Wt,za,du,bi.layout,bi._unevaluatedLayout,wr,Hs,Wt.iconAtlasPositions,0,Xo);Ds=4*th;const N4=bi.layout.get("icon-size").evaluate(wr,{},Hs,Xo),M4=Sr.compositeIconSizes?Sr.compositeIconSizes[0].evaluate(wr,{},Hs,Xo):0,ox=Sr.compositeIconSizes?Sr.compositeIconSizes[1].evaluate(wr,{},Hs,Xo):0,o1=d4(Wt.layerIds[0],Wt.iconSizeData,N4,Sr.iconScaleFactor,M4,ox);Wt.addSymbols(Wt.icon,za,o1,qn,Es,wr,void 0,Qn,Rn,Qd.lineStartIndex,Qd.lineLength,-1,Xo,Hs,Jo,Jd,Wt.symbolInstances.length,th),$a=Wt.icon.placedSymbolArray.length-1,du&&($r=4*th,Wt.addSymbols(Wt.icon,du,o1,qn,Es,wr,_c.vertical,Qn,Rn,Qd.lineStartIndex,Qd.lineLength,-1,Xo,Hs,Jo,Jd,Wt.symbolInstances.length,th),bc=Wt.icon.placedSymbolArray.length-1)}for(const qs in Xn.horizontal){const za=qs,du=Xn.horizontal[za];cf||(sx=rp(du.text),Ws?rx=h4(du):cf=y5(Bi,eh,Rn,ur,yr,_r,du,Fr,bi.layout.get("text-rotate").evaluate(wr,{},Hs),fo,N5));const th=du.positionedLines.length===1;if(_s+=kL(Wt,Qn,Rn,du,pi,bi,Ws,wr,fo,Qd,Xn.vertical?_c.horizontal:_c.horizontalOnly,th?ote(Xn.horizontal):[za],Ns,$a,Sr,Xo,Hs,Wt.symbolInstances.length,Jo),th)break}Xn.vertical&&(Il+=kL(Wt,Qn,Rn,Xn.vertical,pi,bi,Ws,wr,fo,Qd,_c.vertical,["vertical"],Ns,bc,Sr,Xo,Hs,Wt.symbolInstances.length,Jo));let To=-1;const Ao=(qs,za)=>qs?Math.max(qs,za):za;To=Ao(rx,To),To=Ao(s1,To),To=Ao(Jn,To);const Up=To>-1?1:0;Wt.glyphOffsetArray.length>=65535&&In("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wr.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,wr.sortKey),Wt.symbolInstances.emplaceBack(Rn.x,Rn.y,eh.x,eh.y,eh.z,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical>=0?Ns.vertical:-1,$a,bc,sx,cf!==void 0?cf:Wt.collisionBoxArray.length,cf!==void 0?cf+1:Wt.collisionBoxArray.length,Sl!==void 0?Sl:Wt.collisionBoxArray.length,Sl!==void 0?Sl+1:Wt.collisionBoxArray.length,zp!==void 0?zp:Wt.collisionBoxArray.length,zp!==void 0?zp+1:Wt.collisionBoxArray.length,uu||Wt.collisionBoxArray.length,uu?uu+1:Wt.collisionBoxArray.length,ur,_s,Il,Ds,$r,Up,0,Gs,ws,To,0,as?1:0,D5)})(u,Ut,an,$t,c,d,y,p,u.layers[0],u.collisionBoxArray,r.index,r.sourceLayerIndex,u.index,gt,X,S,0,yt,bt,q,r,_,O,k,N,$,H,K,Zt,se,ge,me)};if(te==="line")for(const $t of JC(r.geometry,0,0,zt,zt)){const Ut=tte($t,_t,Qe,c.vertical||Be,d,24,st,u.overscaling,zt);for(const gn of Ut)Be&&mte(u,Be.text,pt,gn)||Kt($t,gn,N)}else if(te==="line-center"){for(const $t of r.geometry)if($t.length>1){const Ut=ete($t,Qe,c.vertical||Be,d,24,st);Ut&&Kt($t,Ut,N)}}else if(r.type==="Polygon")for(const $t of Ev(r.geometry,0)){const Ut=rte($t,16);Kt($t[0],new af(Ut.x,Ut.y,0,0,void 0),N)}else if(r.type==="LineString")for(const $t of r.geometry)Kt($t,new af($t[0].x,$t[0].y,0,0,void 0),N);else if(r.type==="Point")for(const $t of r.geometry)for(const Ut of $t)Kt([Ut],new af(Ut.x,Ut.y,0,0,void 0),N)}const u4=255,n0=u4*of;function kL(u,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X){const te=CL(0,d,T,y,_,v,p,u.allowVerticalPlacement,void 0),se=y.layout.get("text-size").evaluate(v,{},K),ge=$.compositeTextSizes?$.compositeTextSizes[0].evaluate(v,{},K):0,me=$.compositeTextSizes?$.compositeTextSizes[1].evaluate(v,{},K):0,Ee=d4(u.layerIds[0],u.textSizeData,se,$.textScaleFactor,ge,me);u.addSymbols(u.text,te,Ee,T,_,v,O,r,c,S.lineStartIndex,S.lineLength,F,H,K,X,!1,q,te.length);for(const Te of k)N[Te]=u.text.placedSymbolArray.length-1;return 4*te.length}function d4(u,r,c,d,p,y){const _=r;let v=null;return _.kind==="source"?(v=[of*c*d],v[0]>n0&&In(`${u}: Value for "text-size" is >= ${u4}. Reduce your "text-size".`)):_.kind==="composite"&&(v=[of*p*d,of*y*d],(v[0]>n0||v[1]>n0)&&In(`${u}: Value for "text-size" is >= ${u4}. Reduce your "text-size".`)),v}function g5(u){for(const r in u)return u[r];return null}function y5(u,r,c,d,p,y,_,v,T,S,O){let k,N,F,$;if(k=O?O.top:_.top,N=O?O.bottom:_.bottom,F=O?O.left:_.left,$=O?O.right:_.right,n4(_)&&_.collisionPadding){const H=_.collisionPadding;F-=H[0],k-=H[1],$+=H[2],N+=H[3]}if(T){const H=new Tt(F,k),K=new Tt($,k),q=new Tt(F,N),X=new Tt($,N),te=_i(T);let se=new Tt(0,0);S&&(se=new Tt(S[0],S[1])),H._rotateAround(te,se),K._rotateAround(te,se),q._rotateAround(te,se),X._rotateAround(te,se),F=Math.min(H.x,K.x,q.x,X.x),$=Math.max(H.x,K.x,q.x,X.x),k=Math.min(H.y,K.y,q.y,X.y),N=Math.max(H.y,K.y,q.y,X.y)}return u.emplaceBack(r.x,r.y,r.z,c.x,c.y,F,k,$,N,v,d,p,y),u.length-1}function h4(u){n4(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const r=u.bottom-u.top;return r>0?Math.max(10,r):null}function mte(u,r,c,d){const p=u.compareText;if(r in p){const y=p[r];for(let _=y.length-1;_>=0;_--)if(d.dist(y[_])<c)return!0}else p[r]=[];return p[r].push(d),!1}function DL(u,r){const c=u.fovAboveCenter,d=u.elevation?u.elevation.getMinElevationBelowMSL()*r:0,p=(u._camera.position[2]*u.worldSize-d)/Math.cos(u._pitch),y=Math.sin(c)*p/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let _=Math.sin(u._pitch)*y+p;const v=p*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let T=Math.max(u.zoom-17,0);u.isOrthographic&&(T/=10),_*=1+T}return Math.min(1.01*_,v)}function Vv(u,r){if(!r.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:r};const c=Math.pow(2,-u.z),d=u.x*c,p=(u.x+1)*c,y=u.y*c,_=(u.y+1)*c,v=mt(d),T=mt(p),S=xt(y),O=xt(_),k=r.project(v,S),N=r.project(T,S),F=r.project(T,O),$=r.project(v,O);let H=Math.min(k.x,N.x,F.x,$.x),K=Math.min(k.y,N.y,F.y,$.y),q=Math.max(k.x,N.x,F.x,$.x),X=Math.max(k.y,N.y,F.y,$.y);const te=c/16;function se(me,Ee,Te,xe,Oe,Be){const lt=(Te+Oe)/2,it=(xe+Be)/2,st=r.project(mt(lt),xt(it)),_t=Math.max(0,H-st.x,K-st.y,st.x-q,st.y-X);H=Math.min(H,st.x),q=Math.max(q,st.x),K=Math.min(K,st.y),X=Math.max(X,st.y),_t>te&&(se(me,st,Te,xe,lt,it),se(st,Ee,lt,it,Oe,Be))}se(k,N,d,y,p,y),se(N,F,p,y,p,_),se(F,$,p,_,d,_),se($,k,d,_,d,y),H-=te,K-=te,q+=te,X+=te;const ge=1/Math.max(q-H,X-K);return{scale:ge,x:H*ge,y:K*ge,x2:q*ge,y2:X*ge,projection:r}}function NL(u,{x:r,y:c},d=0){return new Tt(((r-d)*u.scale-u.x)*zt,(c*u.scale-u.y)*zt)}const gte=G(new Float32Array(16));class Fp{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,c){return{x:0,y:0,z:0}}unproject(r,c){return new ye(0,0)}projectTilePoint(r,c,d){return{x:r,y:c,z:0}}locationPoint(r,c,d,p=!0){return r._coordinatePoint(r.locationCoordinate(c,d),p)}pixelsPerMeter(r,c){return Je(1,r)*c}pixelSpaceConversion(r,c,d){return 1}farthestPixelDistance(r){return DL(r,r.pixelsPerMeter)}pointCoordinate(r,c,d,p){const y=r.horizonLineFromTop(!1),_=new Tt(c,Math.max(y,d));return r.rayIntersectionCoordinate(r.pointRayIntersection(_,p))}pointCoordinate3D(r,c,d){const p=new Tt(c,d);if(r.elevation)return r.elevation.pointCoordinate(p);{const y=this.pointCoordinate(r,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(r,c){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,c.x,c.y);const d=r.horizonLineFromTop();return c.y<d}createInversionMatrix(r,c){return gte}createTileMatrix(r,c,d){let p,y,_;const v=d.canonical,T=G(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Vv(v,this);p=1,y=S.x+d.wrap*S.scale,_=S.y,de(T,T,[p/S.scale,p/S.scale,r.pixelsPerMeter/c])}else p=c/r.zoomScale(v.z),y=(v.x+Math.pow(2,v.z)*d.wrap)*p,_=v.y*p;return Q(T,T,[y,_,0]),de(T,T,[p/zt,p/zt,1]),T}upVector(r,c,d){return[0,0,1]}upVectorScale(r,c,d){return{metersToTile:1}}}class yte extends Fp{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[c,d]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(_i(c));this.n=(p+Math.sin(_i(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,c){const{n:d,c:p,r0:y}=this,_=_i(r-this.center[0]),v=_i(c),T=Math.sqrt(p-2*d*Math.sin(v))/d;return{x:T*Math.sin(_*d),y:T*Math.cos(_*d)-y,z:0}}unproject(r,c){const{n:d,c:p,r0:y}=this,_=y+c;let v=Math.atan2(r,Math.abs(_))*Math.sign(_);_*d<0&&(v-=Math.PI*Math.sign(r)*Math.sign(_));const T=_i(this.center[0])*d;v=et(v,-Math.PI-T,Math.PI-T);const S=ve(qe(v/d)+this.center[0],-180,180),O=Math.asin(ve((p-(r*r+_*_)*d*d)/(2*d),-1,1)),k=ve(qe(O),-85.051129,Me);return new ye(S,k)}}const Wv=1.340264,Hv=-.081106,Gv=893e-6,qv=.003796,_5=Math.sqrt(3)/2;class _te extends Fp{project(r,c){c=c/180*Math.PI,r=r/180*Math.PI;const d=Math.asin(_5*Math.sin(c)),p=d*d,y=p*p*p;return{x:.5*(r*Math.cos(d)/(_5*(Wv+3*Hv*p+y*(7*Gv+9*qv*p)))/Math.PI+.5),y:1-.5*(d*(Wv+Hv*p+y*(Gv+qv*p))/Math.PI+1),z:0}}unproject(r,c){r=(2*r-.5)*Math.PI;let d=c=(2*(1-c)-1)*Math.PI,p=d*d,y=p*p*p;for(let O,k,N,F=0;F<12&&(k=d*(Wv+Hv*p+y*(Gv+qv*p))-c,N=Wv+3*Hv*p+y*(7*Gv+9*qv*p),O=k/N,d=ve(d-O,-Math.PI/3,Math.PI/3),p=d*d,y=p*p*p,!(Math.abs(O)<1e-12));++F);const _=_5*r*(Wv+3*Hv*p+y*(7*Gv+9*qv*p))/Math.cos(d),v=Math.asin(Math.sin(d)/_5),T=ve(180*_/Math.PI,-180,180),S=ve(180*v/Math.PI,-85.051129,Me);return new ye(T,S)}}class wte extends Fp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,c){return{x:.5+r/360,y:.5-c/360,z:0}}unproject(r,c){const d=360*(r-.5),p=ve(360*(.5-c),-85.051129,Me);return new ye(d,p)}}const J_=Math.PI/2;function w5(u){return Math.tan((J_+u)/2)}class bte extends Fp{constructor(r){super(r),this.center=r.center||[0,30];const[c,d]=this.parallels=r.parallels||[30,30];let p=_i(c),y=_i(d);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const _=Math.cos(p),v=w5(p);this.n=p===y?Math.sin(p):Math.log(_/Math.cos(y))/Math.log(w5(y)/v),this.f=_*Math.pow(w5(p),this.n)/this.n}project(r,c){c=_i(c),this.southernCenter&&(c=-c),r=_i(r-this.center[0]);const d=1e-6,{n:p,f:y}=this;y>0?c<-J_+d&&(c=-J_+d):c>J_-d&&(c=J_-d);const _=y/Math.pow(w5(c),p);let v=_*Math.sin(p*r),T=y-_*Math.cos(p*r);return v=.5*(v/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:v,y:this.southernCenter?T:1-T,z:0}}unproject(r,c){r=(2*r-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:d,f:p}=this,y=p-c,_=Math.sign(y),v=Math.sign(d)*Math.sqrt(r*r+y*y);let T=Math.atan2(r,Math.abs(y))*_;y*d<0&&(T-=Math.PI*Math.sign(r)*_);const S=ve(qe(T/d)+this.center[0],-180,180),O=ve(qe(2*Math.atan(Math.pow(p/v,1/d))-J_),-85.051129,Me);return new ye(S,this.southernCenter?-O:O)}}class ML extends Fp{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,c){return{x:Ze(r),y:tt(c),z:0}}unproject(r,c){const d=mt(r),p=xt(c);return new ye(d,p)}}const LL=_i(Me);class vte extends Fp{project(r,c){const d=(c=_i(c))*c,p=d*d;return{x:.5*((r=_i(r))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,c){r=(2*r-.5)*Math.PI;let d=c=(2*(1-c)-1)*Math.PI,p=25,y=0,_=d*d;do{_=d*d;const S=_*_;y=(d*(1.007226+_*(.015085+S*(.028874*_-.044475-.005916*S)))-c)/(1.007226+_*(.045255+S*(.259866*_-.311325-.005916*11*S))),d=ve(d-y,-LL,LL)}while(Math.abs(y)>1e-6&&--p>0);_=d*d;const v=ve(qe(r/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=qe(d);return new ye(v,T)}}const BL=_i(Me);class xte extends Fp{project(r,c){c=_i(c),r=_i(r);const d=Math.cos(c),p=2/Math.PI,y=Math.acos(d*Math.cos(r/2)),_=Math.sin(y)/y,v=.5*(r*p+2*d*Math.sin(r/2)/_)||0,T=.5*(c+Math.sin(c)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(r,c){let d=r=(2*r-.5)*Math.PI,p=c=(2*(1-c)-1)*Math.PI,y=25;const _=1e-6;let v=0,T=0;do{const S=Math.cos(p),O=Math.sin(p),k=2*O*S,N=O*O,F=S*S,$=Math.cos(d/2),H=Math.sin(d/2),K=2*$*H,q=H*H,X=1-F*$*$,te=X?1/X:0,se=X?Math.acos(S*$)*Math.sqrt(1/X):0,ge=.5*(2*se*S*H+2*d/Math.PI)-r,me=.5*(se*O+p)-c,Ee=.5*te*(F*q+se*S*$*N)+1/Math.PI,Te=te*(K*k/4-se*O*H),xe=.125*te*(k*H-se*O*F*K),Oe=.5*te*(N*$+se*q*S)+.5,Be=Te*xe-Oe*Ee;v=(me*Te-ge*Oe)/Be,T=(ge*xe-me*Ee)/Be,d=ve(d-v,-Math.PI,Math.PI),p=ve(p-T,-BL,BL)}while((Math.abs(v)>_||Math.abs(T)>_)&&--y>0);return new ye(qe(d),qe(p))}}class FL extends Fp{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_i(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,c){const{scale:d,cosPhi:p}=this;return{x:_i(r)*p*d+.5,y:-Math.sin(_i(c))/p*d+.5,z:0}}unproject(r,c){const{scale:d,cosPhi:p}=this,y=-(c-.5)/d,_=ve(qe((r-.5)/d)/p,-180,180),v=Math.asin(ve(y*p,-1,1)),T=ve(qe(v),-85.051129,Me);return new ye(_,T)}}class Ete extends ML{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,c,d){const p=yv(r,c,d);return ui(p,p,zC(Kd(d))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,c,d){const p=Ce(c.lat,c.lng),y=sn([],p),_=d?r._centerAltitude+d:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(c),r._centerAltitude):r._centerAltitude;Bt(p,p,y,Je(1,0)*zt*_);const v=G(new Float64Array(16));return oe(v,r.pixelMatrix,r.globeMatrix),ui(p,p,v),new Tt(p[0],p[1])}pixelsPerMeter(r,c){return Je(1,0)*c}pixelSpaceConversion(r,c,d){const p=Je(1,r)*c,y=xn(Je(1,45)*c,p,d);return this.pixelsPerMeter(r,c)/y}createTileMatrix(r,c,d){const p=l6(Kd(d.canonical));return oe(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,c){const{center:d}=r,p=zC(Kd(c));return Ie(p,p,_i(d.lng)),he(p,p,_i(d.lat)),de(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,c,d,p){return JN(r,c,d,!0)||new jt(0,0)}pointCoordinate3D(r,c,d){const p=this.pointCoordinate(r,c,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,c){return!JN(r,c.x,c.y,!1)}farthestPixelDistance(r){const c=function(p,y){const _=p.cameraToCenterDistance,v=p._centerAltitude*y,T=p._camera,S=p._camera.forward(),O=Le([],Dt([],S,-_),[0,0,v]),k=p.worldSize/(2*Math.PI),N=[0,0,-k],F=p.width/p.height,$=Math.tan(p.fovAboveCenter),H=Dt([],T.up(),$),K=Dt([],T.right(),$*F),q=sn([],Le([],Le([],S,H),K)),X=[];let te;if(new Ki(O,q).closestPointOnSphere(N,k,X)){const se=Le([],X,N),ge=xr([],se,O);te=Math.cos(p.fovAboveCenter)*re(ge)}else{const se=xr([],O,N),ge=xr([],N,O);sn(ge,ge);const me=re(se)-k;te=Math.sqrt(me*(me+2*k));const Ee=Math.acos(te/(k+me))-Math.acos(_n(S,ge));te*=Math.cos(Ee)}return 1.01*te}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),d=kp(r.zoom);if(d>0){const p=DL(r,Je(1,r.center.lat)*r.worldSize),y=r.worldSize/(2*Math.PI),_=Math.max(r.width,r.height)/r.worldSize*Math.PI;return xn(c,p+y*(1-Math.cos(_)),Math.pow(d,10))}return c}upVector(r,c,d){return yv(c,d,r,1)}upVectorScale(r){return{metersToTile:BC($C(Kd(r)))}}}function $L(u){const r=u.parallels,c=!!r&&Math.abs(r[0]+r[1])<.01;switch(u.name){case"mercator":return new ML(u);case"equirectangular":return new wte(u);case"naturalEarth":return new vte(u);case"equalEarth":return new _te(u);case"winkelTripel":return new xte(u);case"albers":return c?new FL(u):new yte(u);case"lambertConformalConic":return c?new FL(u):new bte(u);case"globe":return new Ete(u)}throw new Error(`Invalid projection name: ${u.name}`)}const Cte=ci.types,Tte=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zv(u,r,c,d,p,y,_,v,T,S,O,k,N){const F=v?Math.min(n0,Math.round(v[0])):0,$=v?Math.min(n0,Math.round(v[1])):0;u.emplaceBack(r,c,Math.round(32*d),Math.round(32*p),y,_,(F<<1)+(T?1:0),0+($<<1),16*S,16*O,256*k,256*N)}function Kv(u,r,c){u.emplaceBack(r,c)}function Yv(u,r,c,d,p,y,_){u.emplaceBack(r,c,d,p,y,_)}const b5=(u,r,c,d)=>{for(let p=0;p<r;p++)u.emplaceBack(c[0],c[1],c[2],d[0],d[1],d[2])};function Q_(u,r,c,d,p){u.emplaceBack(r,c,d,p),u.emplaceBack(r,c,d,p),u.emplaceBack(r,c,d,p),u.emplaceBack(r,c,d,p)}function Ate(u){for(const r of u.sections)if(Vd(r.text))return!0;return!1}class f4{constructor(r){this.layoutVertexArray=new cv,this.indexArray=new ms,this.programConfigurations=r,this.segments=new hr,this.dynamicLayoutVertexArray=new Zd,this.opacityVertexArray=new uv,this.placedSymbolArray=new xC,this.iconTransitioningVertexArray=new hc,this.globeExtVertexArray=new lv,this.zOffsetVertexArray=new Vs,this.orientationVertexArray=new k_,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(r,c){const d=[],p=this.layoutVertexArray.uint16;for(let y=0;y<c;++y){const _=12*(r+y);d.push(...p.slice(_,_+12))}return d}updateSymbolVertexData(r,c,d,p,y,_,v,T,S,O,k,N,F){const $=this.layoutVertexArray.uint16,H=12*r;$[H]=c,$[H+1]=d,$[H+2]=p,$[H+3]=y,$[H+4]=_,$[H+5]=v,$[H+6]=T,$[H+7]=S,$[H+8]=O,$[H+9]=k,$[H+10]=N,$[H+11]=F}upload(r,c,d,p,y,_){this.isEmpty()||(d&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Iee.members,!!_),this.indexBuffer=r.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Ree.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Tte,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,Dee.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Pee.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,Oee.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,kee.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Qt(f4,"SymbolBuffers");class p4{constructor(r,c,d){this.layoutVertexArray=new r,this.layoutAttributes=c,this.indexArray=new d,this.segments=new hr,this.collisionVertexArray=new O_,this.collisionVertexArrayExt=new Zd}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Nee.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,Mee.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Qt(p4,"CollisionBuffers");class v5{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=G([]),this.placementViewportMatrix=G([]);const c=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.localizable=r.localizable,this.textSizeData=t0(this.zoom,c["text-size"],this.worldview,r.availableImages),this.iconSizeData=t0(this.zoom,c["icon-size"],this.worldview,r.availableImages);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.lut=r.lut,this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(_=>_c[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(r){const c=this.layers[0].getAppearances();if(!c||c.length===0)return!1;const d=Array.isArray(r)?r:[r];return c.some(p=>d.some(y=>p.getProperty(y)!=null))}createArrays(){this.text=new f4(new B(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new f4(new B(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new Vg,this.lineVertexArray=new TC,this.symbolInstances=new CC}calculateGlyphDependencies(r,c,d,p,y){for(const _ of r){const v=_.codePointAt(0);if(v===void 0)break;if(c[v]=!0,p&&y&&v<=65535){const T=Fv[_];T&&(c[T.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(r,c,d,p,y,_,v){if(!r.hasProperty("icon-size"))return v*_;let T=1;const S=r.getUnevaluatedProperties()._values["icon-size"],O=t0(this.zoom,S,this.worldview,y),k=K_(O,c);if(O.kind!=="constant"&&O.kind!=="camera"||(T=k.uSize),O.kind==="composite"){const{minZoom:N,maxZoom:F}=O,$=S.possiblyEvaluate(new Ui(N,{worldview:this.worldview}),p),H=S.possiblyEvaluate(new Ui(F,{worldview:this.worldview}),p),K=$.evaluate(d,{},p,y);T=K+(H.evaluate(d,{},p,y)-K)*k.uSizeT}return O.kind==="source"&&(T=S.possiblyEvaluate(new Ui(this.zoom,{worldview:this.worldview}),p).evaluate(d,{},p,y)),T*_}updateFootprints(r,c){}updateReplacement(r,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const d=c.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!KC(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}getResolvedImageFromTokens(r){return typeof r=="string"?ga.build(r):r}populate(r,c,d,p){const y=this.layers[0],_=y.layout,v=this.projection.name==="globe",T=_.get("text-font"),S=_.get("text-field"),O=_.get("icon-image"),[k,N]=_.get("icon-size-scale-range"),F=ve(c.scaleFactor||1,k,N),$=(S.value.kind!=="constant"||S.value.value instanceof Eo&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),H=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,K=this.hasAnyAppearanceProperty("icon-image"),q=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!$&&!H&&!K)return;const X=c.iconDependencies,te=c.glyphDependencies,se=c.availableImages,ge=new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),me=Ee=>{const Te=Ee.id.toString();X.has(Te)?X.get(Te).push(Ee):X.set(Te,[Ee])};for(const Ee of r){const{feature:Te,id:xe,index:Oe,sourceLayerIndex:Be}=Ee,lt=y._featureFilter.needGeometry,it=Vn(Te,lt);if(!y._featureFilter.filter(ge,it,d))continue;if(lt||(it.geometry=Cn(Te,d,p)),v&&Te.type!==1&&d.z<=5){const vt=it.geometry,wt=.98078528056,Zt=(Kt,$t)=>_n(yv(Kt.x,Kt.y,d,1),yv($t.x,$t.y,d,1))<wt;for(let Kt=0;Kt<vt.length;Kt++)vt[Kt]=tn(vt[Kt],Zt)}let st,_t;if($){const vt=y.getValueAndResolveTokens("text-field",it,d,se),wt=Eo.factory(vt);Ate(wt)&&(this.hasRTLText=!0),(!this.hasRTLText||Kb()==="unavailable"||this.hasRTLText&&Cl.isParsed())&&(st=Bee(wt,y,it))}if(H){const vt=y.getValueAndResolveTokens("icon-image",it,d,se);_t=this.getResolvedImageFromTokens(vt)}const gt=this.layers[0];let yt=!1;if(!_t&&K){const vt=gt.getAppearances();for(const wt of vt)if(wt.getProperty("icon-image")){const Zt=gt.getAppearanceValueAndResolveTokens(wt,"icon-image",it,d,se);if(Zt){_t=this.getResolvedImageFromTokens(Zt),yt=!0;break}}}if(!st&&!_t)continue;const Qe=this.sortFeaturesByKey?q.evaluate(it,{},d):void 0,bt={id:xe,text:st,icon:_t,index:Oe,sourceLayerIndex:Be,geometry:it.geometry,properties:Te.properties,type:Cte[Te.type],sortKey:Qe};if(this.features.push(bt),this.featureToAppearanceIndex[Oe]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:xe,properties:Te.properties,usesAppearanceIconAsPlaceholder:yt,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),_t){const vt=gt._unevaluatedLayout._values,{iconPrimary:wt,iconSecondary:Zt}=jv(_t,this.iconSizeData,vt["icon-size"],d,this.zoom,bt,this.pixelRatio,F,this.worldview,se);me(wt),Zt&&(this.hasAnySecondaryIcon=!0,me(Zt))}const pt=gt.getAppearances();if(pt.length!==0&&pt.forEach(vt=>{if(!vt.getProperty("icon-image"))return;const wt=this.getCombinedIconPrimary(vt,gt,it,d,se,bt,F);wt&&me(wt)}),st){const vt=T.evaluate(it,{},d).join(","),wt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_c.vertical)>=0;for(const Zt of st.sections)if(Zt.image){const Kt=Zt.image.getPrimary().scaleSelf(this.pixelRatio),$t=Kt.id.toString(),Ut=X.get($t)||[];Ut.push(Kt),X.set($t,Ut)}else{const Kt=Hb(st.toString()),$t=Zt.fontStack||vt,Ut=te[$t]=te[$t]||{};this.calculateGlyphDependencies(Zt.text,Ut,wt,this.allowVerticalPlacement,Kt)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(Ee){const Te={},xe={},Oe=[];let Be=0;function lt(gt){Oe.push(Ee[gt]),Be++}function it(gt,yt,Qe){const bt=xe[gt];return delete xe[gt],xe[yt]=bt,Oe[bt].geometry[0].pop(),Oe[bt].geometry[0]=Oe[bt].geometry[0].concat(Qe[0]),bt}function st(gt,yt,Qe){const bt=Te[yt];return delete Te[yt],Te[gt]=bt,Oe[bt].geometry[0].shift(),Oe[bt].geometry[0]=Qe[0].concat(Oe[bt].geometry[0]),bt}function _t(gt,yt,Qe){const bt=Qe?yt[0][yt[0].length-1]:yt[0][0];return`${gt}:${bt.x}:${bt.y}`}for(let gt=0;gt<Ee.length;gt++){const yt=Ee[gt],Qe=yt.geometry,bt=yt.text?yt.text.toString():null;if(!bt){lt(gt);continue}const pt=_t(bt,Qe),vt=_t(bt,Qe,!0);if(pt in xe&&vt in Te&&xe[pt]!==Te[vt]){const wt=st(pt,vt,Qe),Zt=it(pt,vt,Oe[wt].geometry);delete Te[pt],delete xe[vt],xe[_t(bt,Oe[Zt].geometry,!0)]=Zt,Oe[wt].geometry=null}else pt in xe?it(pt,vt,Qe):vt in Te?st(pt,vt,Qe):(lt(gt),Te[pt]=Be-1,xe[vt]=Be-1)}return Oe.filter(gt=>gt.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of c.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,Te)=>Ee.sortKey-Te.sortKey)}getCombinedIconPrimary(r,c,d,p,y,_,v){let T,S;const O=r.getUnevaluatedProperties();if(O._values["icon-image"].value!==void 0){const k=c.getAppearanceValueAndResolveTokens(r,"icon-image",d,p,y);T=this.getResolvedImageFromTokens(k)}else{const k=c.getValueAndResolveTokens("icon-image",d,p,y);T=this.getResolvedImageFromTokens(k)}if(T){const k=r.hasProperty("icon-size")?O._values["icon-size"]:c._unevaluatedLayout._values["icon-size"];S=jv(T,t0(this.zoom,k,this.worldview,y),k,p,this.zoom,_,this.pixelRatio,v,this.worldview,y).iconPrimary}return S}updateSymbolInstanceIconVertices(r,c,d,p,y,_,v,T,S,O,k,N,F,$){if(r.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(c.activeAppearance===d)return{vertexOffsetDelta:r.numIconVertices,hasChanges:!1};if(d){const H=this.getCombinedIconPrimary(d,S,p,_,v,{sortKey:void 0,text:void 0,icon:null,index:r.featureIndex,sourceLayerIndex:r.featureIndex,geometry:[],properties:c.properties,type:"Point",id:c.id},O);if(!H)return{vertexOffsetDelta:0,hasChanges:!1};const K=H.toString(),q=this.iconAtlasPositions&&this.iconAtlasPositions.get(K);if(q){const{appearanceIconOffset:X,appearanceIconRotate:te}=AL(d,S,p,_,N,$,F,O);let se=d5(q,void 0,X,S.layout.get("icon-anchor").evaluate(p,k,_));const ge=q.sdf,me=S.layout.get("icon-text-fit").constantOr("none");me!=="none"&&c.textShaping&&c.iconTextFitPadding&&c.fontScale&&(se=i4(se,c.textShaping,me,c.iconTextFitPadding,X,c.fontScale));const Ee=this.calculateEffectiveAppearanceIconSize(d,T.zoom,p,_,v,O,F),Te=0,xe=1+(Math.min(n0,Math.round(Ee*of))<<1),Oe=a4(se,te,ge,me!=="none",O);c.isUsingAppearanceIconVertexData||(c.isUsingAppearanceIconVertexData=!0,c.layoutBasedIconVertexData=this.icon.getSymbolVertexData(y,r.numIconVertices));let Be=y;for(let it=0;it<Oe.length;++it){const st=Oe[it],_t=c.layoutBasedIconVertexData[0]||r.tileAnchorX,gt=c.layoutBasedIconVertexData[1]||r.tileAnchorY,yt=16*st.pixelOffsetTL.x,Qe=16*st.pixelOffsetTL.y,bt=16*st.pixelOffsetBR.x,pt=16*st.pixelOffsetBR.y,vt=16*st.minFontScaleX,wt=16*st.minFontScaleY;this.icon.updateSymbolVertexData(Be,_t,gt,Math.round(32*st.tl.x),Math.round(32*st.tl.y),st.texPrimary.x,st.texPrimary.y,Te,xe,yt,Qe,vt,wt),this.icon.updateSymbolVertexData(Be+1,_t,gt,Math.round(32*st.tr.x),Math.round(32*st.tr.y),st.texPrimary.x+st.texPrimary.w,st.texPrimary.y,Te,xe,bt,Qe,vt,wt),this.icon.updateSymbolVertexData(Be+2,_t,gt,Math.round(32*st.bl.x),Math.round(32*st.bl.y),st.texPrimary.x,st.texPrimary.y+st.texPrimary.h,Te,xe,yt,pt,vt,wt),this.icon.updateSymbolVertexData(Be+3,_t,gt,Math.round(32*st.br.x),Math.round(32*st.br.y),st.texPrimary.x+st.texPrimary.w,st.texPrimary.y+st.texPrimary.h,Te,xe,bt,pt,vt,wt),Be+=4}const lt=r.numIconVertices-4*Oe.length;for(let it=0;it<lt;++it)this.icon.updateSymbolVertexData(Be+it,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:r.numIconVertices,hasChanges:!0}}}else if(c.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(y,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:r.numIconVertices,hasChanges:!0}}else if(c.isUsingAppearanceIconVertexData){const K=c.layoutBasedIconVertexData.length/12;for(let q=0;q<K;++q){const X=q*12;this.icon.updateSymbolVertexData(y+q,c.layoutBasedIconVertexData[X+0],c.layoutBasedIconVertexData[X+1],c.layoutBasedIconVertexData[X+2],c.layoutBasedIconVertexData[X+3],c.layoutBasedIconVertexData[X+4],c.layoutBasedIconVertexData[X+5],c.layoutBasedIconVertexData[X+6],c.layoutBasedIconVertexData[X+7],c.layoutBasedIconVertexData[X+8],c.layoutBasedIconVertexData[X+9],c.layoutBasedIconVertexData[X+10],c.layoutBasedIconVertexData[X+11])}return c.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:K,hasChanges:!0}}return{vertexOffsetDelta:r.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X){const te=r.numHorizontalGlyphVertices>0||r.numVerticalGlyphVertices>0;if(!te)return{vertexOffsetDelta:te?r.numHorizontalGlyphVertices+r.numVerticalGlyphVertices:0,hasChanges:!1};if(c.activeAppearance===d)return{vertexOffsetDelta:r.numHorizontalGlyphVertices+r.numVerticalGlyphVertices,hasChanges:!1};if(d&&c.textShaping){const{appearanceTextOffset:se,appearanceTextRotate:ge,appearanceTextSize:me}=SL(d,v,p,_,k,F,N);c.fontScale=OL(me,c.textScaleFactor);const Ee=d.getUnevaluatedProperty("text-size");let Te=this.textSizeData,xe=K,Oe=q;d.hasProperty("text-size")&&(Te=t0(this.zoom,Ee,this.worldview,X),xe=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Oe=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Be=c.textShaping.bottom-k[1],lt=c.textShaping.left-k[0],it=c.textShaping.right-k[0];c.textShaping.top=se[1]+(c.textShaping.top-k[1]),c.textShaping.bottom=se[1]+Be,c.textShaping.left=se[0]+lt,c.textShaping.right=se[0]+it;const st=CL(0,c.textShaping,se,v,!1,p,S,this.allowVerticalPlacement,ge),_t=me&&Te.kind==="composite"?Ee.possiblyEvaluate(new Ui(xe,{}),_).evaluate(p,O,_):$,gt=me&&Te.kind==="composite"?Ee.possiblyEvaluate(new Ui(Oe,{}),_).evaluate(p,O,_):H,yt=d4(d.name,Te,me,T,_t,gt),Qe=Array.isArray(yt)?yt[1]:me,bt=0,pt=1+(Math.min(n0,Math.round(Qe*of))<<1);c.isUsingAppearanceTextVertexData||(c.isUsingAppearanceTextVertexData=!0,c.layoutBasedTextVertexData=this.text.getSymbolVertexData(y,r.numHorizontalGlyphVertices+r.numVerticalGlyphVertices));for(let vt=0;vt<st.length&&vt<(r.numHorizontalGlyphVertices+r.numVerticalGlyphVertices)/4;++vt){const wt=st[vt],Zt=wt.glyphOffset[1],Kt=r.tileAnchorX,$t=r.tileAnchorY,Ut=y+4*vt;this.text.updateSymbolVertexData(Ut,Kt,$t,Math.round(32*wt.tl.x),Math.round(32*(Zt+wt.tl.y)),wt.texPrimary.x,wt.texPrimary.y,bt,pt,wt.pixelOffsetTL.x,wt.pixelOffsetTL.y,wt.minFontScaleX,wt.minFontScaleY),this.text.updateSymbolVertexData(Ut+1,Kt,$t,Math.round(32*wt.tr.x),Math.round(32*(Zt+wt.tr.y)),wt.texPrimary.x+wt.texPrimary.w,wt.texPrimary.y,bt,pt,wt.pixelOffsetBR.x,wt.pixelOffsetTL.y,wt.minFontScaleX,wt.minFontScaleY),this.text.updateSymbolVertexData(Ut+2,Kt,$t,Math.round(32*wt.bl.x),Math.round(32*(Zt+wt.bl.y)),wt.texPrimary.x,wt.texPrimary.y+wt.texPrimary.h,bt,pt,wt.pixelOffsetTL.x,wt.pixelOffsetBR.y,wt.minFontScaleX,wt.minFontScaleY),this.text.updateSymbolVertexData(Ut+3,Kt,$t,Math.round(32*wt.br.x),Math.round(32*(Zt+wt.br.y)),wt.texPrimary.x+wt.texPrimary.w,wt.texPrimary.y+wt.texPrimary.h,bt,pt,wt.pixelOffsetBR.x,wt.pixelOffsetBR.y,wt.minFontScaleX,wt.minFontScaleY)}return{vertexOffsetDelta:r.numHorizontalGlyphVertices+r.numVerticalGlyphVertices,hasChanges:!0}}if(c.isUsingAppearanceTextVertexData){const ge=c.layoutBasedTextVertexData.length/12;for(let me=0;me<ge;++me){const Ee=me*12;this.text.updateSymbolVertexData(y+me,c.layoutBasedTextVertexData[Ee+0],c.layoutBasedTextVertexData[Ee+1],c.layoutBasedTextVertexData[Ee+2],c.layoutBasedTextVertexData[Ee+3],c.layoutBasedTextVertexData[Ee+4],c.layoutBasedTextVertexData[Ee+5],c.layoutBasedTextVertexData[Ee+6],c.layoutBasedTextVertexData[Ee+7],c.layoutBasedTextVertexData[Ee+8],c.layoutBasedTextVertexData[Ee+9],c.layoutBasedTextVertexData[Ee+10],c.layoutBasedTextVertexData[Ee+11])}return c.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:ge,hasChanges:!0}}return{vertexOffsetDelta:r.numHorizontalGlyphVertices+r.numVerticalGlyphVertices,hasChanges:!1}}update(r,c,d,p,y,_,v){this.text.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,c,y,d,p,_,v,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let c=!1;const d=Rt(r),p=1/d;let y=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const T=this.symbolInstances.get(v),S=le(1,0,0),O=le(0,1,0),{numHorizontalGlyphVertices:k,numVerticalGlyphVertices:N,numIconVertices:F,numVerticalIconVertices:$}=T,H=k>0||N>0,K=F>0,q=this.elevationFeatures[T.elevationFeatureIndex];if(q){const X=new Tt(T.tileAnchorX,T.tileAnchorY),te=.075+q.pointElevation(X);T.zOffset!==te&&(c=!0,T.zOffset=te),te!==0&&(this.hasAnyZOffset=!0);const se=q.computeSlopeNormal(X,p),ge=$o(ts(),le(0,0,1),se);$s(S,S,ge),$s(O,O,ge),S[2]*=d,O[2]*=d,S[0]===1&&S[1]===0&&S[2]===0&&O[0]===0&&O[1]===1&&O[2]===0||(y=y||H,_=_||K)}if(H&&(b5(this.text.orientationVertexArray,k,S,O),b5(this.text.orientationVertexArray,N,S,O)),K){const{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:te}=T;X>=0&&b5(this.icon.orientationVertexArray,F,S,O),te>=0&&b5(this.icon.orientationVertexArray,$,S,O)}}y||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),c&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(y,_,v)=>{d+=_,d>y.length&&y.resize(d);for(let T=-_;T<0;T++)y.emplace(T+d,v)},c=(y,_,v)=>{p+=_,p>y.length&&y.resize(p);for(let T=-_;T<0;T++)y.emplace(T+p,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,p=0;for(let y=0;y<this.symbolInstances.length;y++){const _=this.symbolInstances.get(y),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:T,numIconVertices:S}=_,O=_.zOffset,k=S>0;if((v>0||T>0)&&(r(this.text.zOffsetVertexArray,v,O),r(this.text.zOffsetVertexArray,T,O)),k){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:F}=_;N>=0&&c(this.icon.zOffsetVertexArray,S,O),F>=0&&c(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r,c,d,p,y){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(r,c,d,p,y){if(!(r&&c&&d&&this.appearanceFeatureData))return!1;const _=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,v=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!_&&!v)return!1;const T=this.layers[0],S=T.layout;let O=1,k=0,N=!1;if(_){const[q,X]=S.get("icon-size-scale-range");O=ve(1,q,X)}let F=1,$=0,H=!1;if(v){const[q,X]=S.get("text-size-scale-range");F=ve(1,q,X)}const K=new Map;if(y&&d)for(const q of d){const X=y.getImage(q,T.scope);if(X){const te=new ma(q.toString());K.set(te.toString(),X)}}for(let q=0;q<this.symbolInstances.length;q++){const X=this.symbolInstances.get(q),te=this.featureToAppearanceIndex[X.featureIndex],se=te!==void 0?this.appearanceFeatureData[te]:void 0;if(!se)continue;const ge=se.id,me=c&&ge!==void 0?c[String(ge)]:void 0,Ee={type:"Point",id:se.id,properties:se.properties,geometry:[]},Te=T.appearances&&T.appearances.find(xe=>xe.isActive({globals:p,feature:Ee,canonical:r,featureState:me}));if(v){const xe=S.get("text-size"),Oe=S.get("text-offset").evaluate(Ee,me,r),Be=xe.evaluate(Ee,me,r),lt=S.get("text-rotate").evaluate(Ee,me,r),it=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,st=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,_t=xe.evaluate(Ee,{zoom:it},r),gt=xe.evaluate(Ee,{zoom:st},r),yt=this.updateSymbolInstanceTextVertices(X,se,Te,Ee,$,r,T,F,K,me,Oe,Be,lt,_t,gt,it,st,d);$+=yt.vertexOffsetDelta,H=H||yt.hasChanges}if(_){const xe=S.get("icon-offset").evaluate(Ee,me,r),Oe=S.get("icon-size").evaluate(Ee,me,r,d),Be=S.get("icon-rotate").evaluate(Ee,me,r),lt=this.updateSymbolInstanceIconVertices(X,se,Te,Ee,k,r,d,p,T,O,me,xe,Oe,Be);k+=lt.vertexOffsetDelta,N=N||lt.hasChanges}se.activeAppearance=Te}return N&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),H&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),N||H}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$L(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,c){const d=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y}of c)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(r,c,d,p,y,_,v,T,S,O,k,N,F,$,H,K,q,X){const te=r.indexArray,se=r.layoutVertexArray,ge=r.globeExtVertexArray,me=r.segments.prepareSegment(4*X,se,te,this.canOverlap?_.sortKey:void 0),Ee=this.glyphOffsetArray.length,Te=me.vertexLength,xe=this.allowVerticalPlacement&&v===_c.vertical?Math.PI/2:0,Oe=_.text&&_.text.sections;for(let it=0;it<c.length;it++){const{tl:st,tr:_t,bl:gt,br:yt,texPrimary:Qe,texSecondary:bt,pixelOffsetTL:pt,pixelOffsetBR:vt,minFontScaleX:wt,minFontScaleY:Zt,glyphOffset:Kt,isSDF:$t,sectionIndex:Ut}=c[it],gn=me.vertexLength,an=Kt[1];if(Zv(se,S.x,S.y,st.x,an+st.y,Qe.x,Qe.y,d,$t,pt.x,pt.y,wt,Zt),Zv(se,S.x,S.y,_t.x,an+_t.y,Qe.x+Qe.w,Qe.y,d,$t,vt.x,pt.y,wt,Zt),Zv(se,S.x,S.y,gt.x,an+gt.y,Qe.x,Qe.y+Qe.h,d,$t,pt.x,vt.y,wt,Zt),Zv(se,S.x,S.y,yt.x,an+yt.y,Qe.x+Qe.w,Qe.y+Qe.h,d,$t,vt.x,vt.y,wt,Zt),T){const{x:Wt,y:Rn,z:Qn}=T.anchor,[Ai,Xn,ji]=T.up;Yv(ge,Wt,Rn,Qn,Ai,Xn,ji),Yv(ge,Wt,Rn,Qn,Ai,Xn,ji),Yv(ge,Wt,Rn,Qn,Ai,Xn,ji),Yv(ge,Wt,Rn,Qn,Ai,Xn,ji),Q_(r.dynamicLayoutVertexArray,Wt,Rn,Qn,xe)}else Q_(r.dynamicLayoutVertexArray,S.x,S.y,S.z,xe);if(K){const Wt=bt||Qe;Kv(r.iconTransitioningVertexArray,Wt.x,Wt.y),Kv(r.iconTransitioningVertexArray,Wt.x+Wt.w,Wt.y),Kv(r.iconTransitioningVertexArray,Wt.x,Wt.y+Wt.h),Kv(r.iconTransitioningVertexArray,Wt.x+Wt.w,Wt.y+Wt.h)}te.emplaceBack(gn,gn+1,gn+2),te.emplaceBack(gn+1,gn+2,gn+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Kt[0]),it!==c.length-1&&Ut===c[it+1].sectionIndex||r.programConfigurations.populatePaintArrays(se.length,_,_.index,{},F,$,H,Oe&&Oe[Ut],this.worldview)}const Be=X-c.length;Be!==0&&this._addNullVertices(Be,se,d,T,ge,r,K,me,te);const lt=T?T.anchor:S;r.placedSymbolArray.emplaceBack(lt.x,lt.y,lt.z,S.x,S.y,Ee,this.glyphOffsetArray.length-Ee,Te,O,k,S.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],v,0,0,0,N,0),r.symbolInstanceIndices.push(q)}_addNullVertices(r,c,d,p,y,_,v,T,S){for(let O=0;O<r;O++){for(let N=0;N<4;N++)Zv(c,0,0,0,0,0,0,d,!1,0,0,0,0),p&&Yv(y,0,0,0,0,0,0),Q_(_.dynamicLayoutVertexArray,0,0,0,0),v&&Kv(_.iconTransitioningVertexArray,0,0);const k=T.vertexLength;S.emplaceBack(k,k+1,k+2),S.emplaceBack(k+1,k+2,k+3),T.vertexLength+=4,T.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(r,c,d,p,y,_,v){r.emplaceBack(c,d,p,y,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(r,c,d,p,y,_,v){const T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),S=T.vertexLength,O=v.tileAnchorX,k=v.tileAnchorY;for(let F=0;F<4;F++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,c,r.padding,v.zOffset),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,O,k,new Tt(r.x1,r.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,O,k,new Tt(r.x2,r.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,O,k,new Tt(r.x2,r.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,O,k,new Tt(r.x1,r.y2)),T.vertexLength+=4;const N=d.indexArray;N.emplaceBack(S,S+1),N.emplaceBack(S+1,S+2),N.emplaceBack(S+2,S+3),N.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(r,c,d,p,y,_){for(let v=p;v<y;v++){const T=d.get(v),S=this.getSymbolInstanceTextSize(r,_,c,v);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,c,d,p,y,_){for(let v=p;v<y;v++){const T=d.get(v),S=this.getSymbolInstanceIconSize(r,c,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,c,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new p4(P_,eL.members,hc),this.iconCollisionBox=new p4(P_,eL.members,hc);const p=K_(this.iconSizeData,r),y=K_(this.textSizeData,r,d);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(y,r,c,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(y,r,c,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(p,r,c,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(p,r,c,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(r,c,d,p){const y=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:p),_=r4(this.textSizeData,r,y)/ks;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,c,d){const p=this.icon.placedSymbolArray.get(d),y=r4(this.iconSizeData,r,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(r,c,d,p){r.emplaceBack(c,-d,-d,p),r.emplaceBack(c,d,-d,p),r.emplaceBack(c,d,d,p),r.emplaceBack(c,-d,d,p)}_updateTextDebugCollisionBoxes(r,c,d,p,y,_,v){for(let T=p;T<y;T++){const S=d.get(T),O=this.getSymbolInstanceTextSize(r,_,c,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,S.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(r,c,d,p,y,_,v){for(let T=p;T<y;T++){const S=d.get(T),O=this.getSymbolInstanceIconSize(r,c,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,S.padding,_.zOffset)}}updateCollisionDebugBuffers(r,c,d,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=K_(this.iconSizeData,r,p),_=K_(this.textSizeData,r,d);for(let v=0;v<this.symbolInstances.length;v++){const T=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,r,c,T.textBoxStartIndex,T.textBoxEndIndex,T,d),this._updateTextDebugCollisionBoxes(_,r,c,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,d),this._updateIconDebugCollisionBoxes(y,r,c,T.iconBoxStartIndex,T.iconBoxEndIndex,T,p),this._updateIconDebugCollisionBoxes(y,r,c,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,c,d,p,y,_,v,T,S){const O={};if(c<d){const{x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se,featureIndex:ge}=r.get(c);O.textBox={x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se},O.textFeatureIndex=ge}if(p<y){const{x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se,featureIndex:ge}=r.get(p);O.verticalTextBox={x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se},O.verticalTextFeatureIndex=ge}if(_<v){const{x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se,featureIndex:ge}=r.get(_);O.iconBox={x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se},O.iconFeatureIndex=ge}if(T<S){const{x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se,featureIndex:ge}=r.get(T);O.verticalIconBox={x1:k,y1:N,x2:F,y2:$,padding:H,projectedAnchorX:K,projectedAnchorY:q,projectedAnchorZ:X,tileAnchorX:te,tileAnchorY:se},O.verticalIconFeatureIndex=ge}return O}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,c){const d=r.placedSymbolArray.get(c),p=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<p;y+=4)r.indexArray.emplaceBack(y,y+1,y+2),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(r),d=Math.cos(r),p=[],y=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const T=this.symbolInstances.get(v);p.push(0|Math.round(c*T.tileAnchorX+d*T.tileAnchorY)),y.push(T.featureIndex)}return _.sort((v,T)=>p[v]-p[T]||y[T]-y[v]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),_>=0&&_!==y&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(r){const c=this.symbolInstances.get(this.text.symbolInstanceIndices[r]).elevationFeatureIndex;let d;return this.elevationFeatures&&c<this.elevationFeatures.length&&(d=this.elevationFeatures[c]),d}}function zL(u,r){return r.replace(/{([^{}]+)}/g,(c,d)=>d in u?String(u[d]):"")}let UL,jL,m4;Qt(v5,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),v5.addDynamicAttributes=Q_;class VL{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:pa,this.defaultValue=r}evaluate(r){if(r.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(r.formattedSection))return c.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt(VL,"FormatSectionOverride",{omit:["defaultValue"]});const g4=()=>m4||(m4={layout:UL||(UL=new Tr({"symbol-placement":new kt(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new kt(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kt(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kt(Ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new kt(Ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new kt(Ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new kt(Ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kt(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new kt(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kt(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(Ke.layout_symbol["icon-size"]),"icon-size-scale-range":new kt(Ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Vt(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(Ke.layout_symbol["icon-image"]),"icon-image-use-theme":new kt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Vt(Ke.layout_symbol["icon-rotate"]),"icon-padding":new kt(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new kt(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Vt(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kt(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kt(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kt(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(Ke.layout_symbol["text-field"]),"text-font":new Vt(Ke.layout_symbol["text-font"]),"text-size":new Vt(Ke.layout_symbol["text-size"]),"text-size-scale-range":new kt(Ke.layout_symbol["text-size-scale-range"]),"text-max-width":new Vt(Ke.layout_symbol["text-max-width"]),"text-line-height":new Vt(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Vt(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kt(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Vt(Ke.layout_symbol["text-anchor"]),"text-max-angle":new kt(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new kt(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(Ke.layout_symbol["text-rotate"]),"text-padding":new kt(Ke.layout_symbol["text-padding"]),"text-keep-upright":new kt(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Vt(Ke.layout_symbol["text-transform"]),"text-offset":new Vt(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new kt(Ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kt(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new kt(Ke.layout_symbol["text-optional"]),visibility:new kt(Ke.layout_symbol.visibility)})),paint:jL||(jL=new Tr({"icon-opacity":new Vt(Ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Vt(Ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Vt(Ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Vt(Ke.paint_symbol["text-emissive-strength"]),"icon-color":new Vt(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Vt(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new kt(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new kt(Ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(Ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Vt(Ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Vt(Ke.paint_symbol["text-occlusion-opacity"]),"text-color":new Vt(Ke.paint_symbol["text-color"],{runtimeType:Vo,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Vt(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(Ke.paint_symbol["text-halo-blur"]),"text-translate":new kt(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new kt(Ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new kt(Ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new kt(Ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new kt(Ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new kt(Ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Vt(Ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},m4);class x5 extends Go{constructor(r,c,d,p){super(r,g4(),c,d,p,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=G([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,c){super.recalculate(r,c),this.appearances&&this.appearances.forEach(p=>{p.recalculate(r,c,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const p=[];for(const y of d)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,c,d,p){return this._saturation===r&&this._contrast===c&&this._brightnessMin===d&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(y,_,v,T){y=Qs(y),_=Pr(_);const S=z(),O=y/3,k=1-2*O,N=[k,O,O,0,O,k,O,0,O,O,k,0,0,0,0,1],F=.5-.5*_,$=T-v;return oe(S,[$,0,0,0,0,$,0,0,0,0,$,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,F,F,F,1]),oe(S,S,N),S}(r,c,d,p),this._saturation=r,this._contrast=c,this._brightnessMin=d,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,c,d,p){const y=this.layout.get(r).evaluate(c,{},d,p),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||Rg(_.value)||!y?y:zL(c.properties,y)}getAppearanceValueAndResolveTokens(r,c,d,p,y){const _=r.getProperty(c);if(!_)return;const v=_.evaluate(d,{},p,y),T=r.getUnevaluatedProperties()._values[c];return T.isDataDriven()||Rg(T.value)||!v||typeof v!="string"?v:zL(d.properties,v)}createBucket(r){return new v5(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of g4().paint.overridableProperties){if(!x5.hasPaintOverride(this.layout,r))continue;const c=this.paint.get(r),d=new VL(c),p=new __(d,c.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let y=null;y=c.value.kind==="constant"||c.value.kind==="source"?new Og("source",p):new Kh("composite",p,c.value.zoomStops,c.value.interpolationType),this.paint._values[r]=new Xh(c.property,y,c.parameters)}}_handleOverridablePaintPropertyUpdate(r,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&x5.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,c){const d=r.get("text-field"),p=g4().paint.properties[c];let y=!1;const _=v=>{for(const T of v)if(p.overrides&&p.overrides.hasOverride(T))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Eo)_(d.value.value.sections);else if(d.value.kind==="source"){const v=S=>{y||(S instanceof ju&&xs(S.value)===op?_(S.value.sections):S instanceof cn?_(S.sections):S.eachChild(v))},T=d.value;T._styleExpression&&v(T._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,c,d){return{config:new L(this,{zoom:c,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let WL,HL,GL,qL;var y4=ii([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function E5(u,r,c,d,p,y,_,v){const T=[u,r,1,c,d,1,p,y,1],S=[_,v,1],O=D([],T),[k,N,F]=Yr(S,S,O);return M(T,T,[k,0,0,0,N,0,0,0,F])}function ZL(u,r,c,d,p,y,_,v){const T=function(S,O,k,N,F,$,H,K){const q=E5(0,0,1,0,1,1,0,1),X=E5(S,O,k,N,F,$,H,K);return M(X,X,D([],q))}(u,r,c,d,p,y,_,v);return[T[2]/T[8]/zt,T[5]/T[8]/zt]}function C5(u){return[u[0],Math.min(Math.max(u[1],-85.051129),Me)]}class KL extends Uu{constructor(r,c,d,p){super(),this.id=r,this.dispatcher=d,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=c,this._dirty=!1}load(r,c){if(this._loaded=c||!1,this.fire(new zu("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=jy(this.map._requestManager.transformRequest(this.url,ha.Image),(d,p)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new pg(d)):p&&(this.image=p instanceof HTMLImageElement?ac.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Mv(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zu("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Mv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=r[0][1],d=r[0][1];for(const y of r)y[1]>d&&(d=y[1]),y[1]<c&&(c=y[1]);const p=(d+c)/2;if(p>Me?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=r.map(jt.fromLngLat);this.tileID=function(_){let v=1/0,T=1/0,S=-1/0,O=-1/0;for(const H of _)v=Math.min(v,H.x),T=Math.min(T,H.y),S=Math.max(S,H.x),O=Math.max(O,H.y);const k=Math.max(S-v,O-T),N=Math.max(0,Math.floor(-Math.log2(k))),F=Math.pow(2,N);let $=Math.floor((v+S)/2*F);return $>1&&($-=1),new Kg(N,$,Math.floor((T+O)/2*F))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zu("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Mv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const q in this.tiles){const X=this.tiles[q];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=Vv(new Kg(0,0,0),this.map.transform.projection),d=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(q){const X=q[1].x-q[0].x,te=q[1].y-q[0].y,se=q[2].x-q[1].x,ge=q[2].y-q[1].y,me=q[3].x-q[2].x,Ee=q[3].y-q[2].y,Te=q[0].x-q[3].x,xe=q[0].y-q[3].y,Oe=X*ge-se*te,Be=se*Ee-me*ge,lt=me*xe-Te*Ee,it=Te*te-X*xe;return Oe>0&&Be>0&&lt>0&&it>0||Oe<0&&Be<0&&lt<0&&it<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=Vv(this.tileID,this.map.transform.projection),[y,_,v,T]=this.coordinates.map(q=>{const X=p.projection.project(q[0],q[1]);return NL(p,X)._round()});this.perspectiveTransform=ZL(y.x,y.y,_.x,_.y,v.x,v.y,T.x,T.y);const S=this._boundsArray=new qu;S.emplaceBack(y.x,y.y,0,0),S.emplaceBack(_.x,_.y,zt,0),S.emplaceBack(T.x,T.y,0,zt),S.emplaceBack(v.x,v.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(S,y4.members),this.boundsSegments=hr.simpleSegment(0,0,4,2);const O=[],k=[C5((N=this.coordinates)[0]),C5(N[1]),C5(N[2]),C5(N[3])];var N;const[F,$,H,K]=function(q){let X=q[0][0],te=X,se=q[0][1],ge=se;for(let me=1;me<q.length;me++)q[me][0]<X?X=q[me][0]:q[me][0]>te&&(te=q[me][0]),q[me][1]<se?se=q[me][1]:q[me][1]>ge&&(ge=q[me][1]);return[X,se,te-X,ge-se]}(k);{const q=new qu,[X,te,se,ge]=function(yt){let Qe=yt[0].x,bt=Qe,pt=yt[0].y,vt=pt;for(let wt=1;wt<yt.length;wt++)yt[wt].x<Qe?Qe=yt[wt].x:yt[wt].x>bt&&(bt=yt[wt].x),yt[wt].y<pt?pt=yt[wt].y:yt[wt].y>vt&&(vt=yt[wt].y);return[Qe,pt,bt-Qe,vt-pt]}(d),me=yt=>[(yt.x-X)/se,(yt.y-te)/ge],[Ee,Te,xe,Oe]=d.map(me),Be=function(yt,Qe,bt,pt,vt,wt,Zt,Kt){const $t=E5(0,0,1,0,1,1,0,1);return M($t,$t,D([],E5(yt,Qe,bt,pt,vt,wt,Zt,Kt)))}(Ee[0],Ee[1],Te[0],Te[1],xe[0],xe[1],Oe[0],Oe[1]);this.elevatedGlobePerspectiveTransform=ZL(Ee[0],Ee[1],Te[0],Te[1],xe[0],xe[1],Oe[0],Oe[1]);const lt=(yt,Qe)=>{O.push(yt.lng);const bt=Math.round((yt.lng-F)/H*zt),pt=Math.round((yt.lat-$)/K*zt),vt=me(Qe),wt=Yr([],[vt[0],vt[1],1],Be),Zt=Math.round(wt[0]/wt[2]*zt),Kt=Math.round(wt[1]/wt[2]*zt);q.emplaceBack(bt,pt,Zt,Kt)},it=d[3].x-d[0].x,st=d[3].y-d[0].y,_t=d[2].x-d[1].x,gt=d[2].y-d[1].y;for(let yt=0;yt<65;yt++){const Qe=yt/64,bt=[d[0].x+Qe*it,d[0].y+Qe*st],pt=[d[1].x+Qe*_t,d[1].y+Qe*gt],vt=pt[0]-bt[0],wt=pt[1]-bt[1];for(let Zt=0;Zt<65;Zt++){const Kt=Zt/64,$t={x:bt[0]+vt*Kt,y:bt[1]+wt*Kt};lt(c.projection.unproject($t.x,$t.y),$t)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(q,y4.members)}{this.maxLongitudeTriangleSize=0;let q=[],X=new ms;const te=(se,ge,me)=>{X.emplaceBack(se,ge,me);const Ee=O[se],Te=O[ge],xe=O[me],Oe=Math.min(Math.min(Ee,Te),xe),Be=Math.max(Math.max(Ee,Te),xe)-Oe;Be>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Be),q.push(Oe+Be/2)};for(let se=0;se<64;se++)for(let ge=0;ge<64;ge++){const me=65*se+ge,Ee=me+1,Te=me+65,xe=Te+1;te(me,Te,Ee),te(Ee,Te,xe)}[q,X]=function(se,ge){const me=Array.from({length:se.length},(xe,Oe)=>Oe);me.sort((xe,Oe)=>se[xe]-se[Oe]);const Ee=[],Te=new ms;for(let xe=0;xe<me.length;xe++){const Oe=me[xe];Ee.push(se[Oe]);const Be=3*Oe,lt=Be+1;Te.emplaceBack(ge.uint16[Be],ge.uint16[lt],ge.uint16[lt+1])}return[Ee,Te]}(q,X),this.elevatedGlobeTrianglesCenterLongitudes=q,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(X)}this.elevatedGlobeSegments=hr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,H/zt,0,K/zt,0,0,$,F,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const c=this.map.painter.context,d=c.gl;!this._dirty||this.texture instanceof Mv||(this.texture?this.texture.update(this.image):(this.texture=new U6(c,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(c)}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let p=(y=r+180)+360*Math.round((d[0]-y)/360);var y;const _=new hr,v=(k,N)=>{_.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:c.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-p)<=T){const k=Hi(d,0,d.length,p+T);return k===d.length||v(k,Wi(d,k+1,d.length,p+360-T)-k),_}p<d[0]&&(p+=360);const S=Wi(d,0,d.length,p-T);if(S===d.length)return v(0,d.length),_;v(0,S-0);const O=Hi(d,S+1,d.length,p+T);return O!==d.length&&v(O,d.length-O),_}}const _4=1024,Ste=(Math.pow(_4,2)-1)/268170240;class YL extends Go{constructor(r,c,d,p){super(r,{layout:GL||(GL=new Tr({visibility:new kt(Ke.layout_raster.visibility)})),paint:qL||(qL=new Tr({"raster-opacity":new kt(Ke.paint_raster["raster-opacity"]),"raster-color":new Ep(Ke.paint_raster["raster-color"]),"raster-color-mix":new kt(Ke.paint_raster["raster-color-mix"]),"raster-color-range":new kt(Ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new kt(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kt(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kt(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new kt(Ke.paint_raster["raster-saturation"]),"raster-contrast":new kt(Ke.paint_raster["raster-contrast"]),"raster-resampling":new kt(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new kt(Ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new kt(Ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new kt(Ke.paint_raster["raster-array-band"]),"raster-elevation":new kt(Ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},c,d,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof KL&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[d,p]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(p)||d===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=_v({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:p}],resolution:_4}),this.colorRampTexture=null,this._curRampRange=[d,p])}is3D(r){return this.paint.get("raster-elevation")>0}}let XL,JL,QL,eB,tB;class nB extends Go{constructor(r,c,d,p){super(r,{layout:XL||(XL=new Tr({visibility:new kt(Ke["layout_raster-particle"].visibility)})),paint:JL||(JL=new Tr({"raster-particle-array-band":new kt(Ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new kt(Ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ep(Ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new kt(Ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new kt(Ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new kt(Ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new kt(Ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new kt(Ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},c,d,p),this._updateColorRamp(),this.lastInvalidatedAt=ac.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=_v({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ac.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ite extends Go{constructor(r,c){super(r,{},c,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function w4(u,r,c){const d=[0,0,1],p=co([]);return wl(p,p,c?-_i(u)+Math.PI:_i(u)),Fc(p,p,-_i(r)),$s(d,d,p),sn(d,d)}const iB={None:0,Model:1,Symbol:2,FillExtrusion:4};class T5{constructor(r,c,d,p){this.message=(r?`${r}: `:"")+d,p&&(this.identifier=p),c!=null&&c.__line__&&(this.line=c.__line__)}}function b4(u,r){const c=u.indexOf("://")===-1;try{return new URL(u,c&&r?"http://example.com":void 0),!0}catch{return!1}}class rB{constructor(r,c){this.feature=r,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sB{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new fv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(r){const c=16*r,d=this.instancedDataArray.float32;let p=Math.floor(d[c+2]);const y=1.05*(d[c+2]-p);return p/=100,[d[c]%1*1.05,d[c+1]%1*1.05,y,p]}tileCoordinatesForInstance(r){const c=16*r,d=this.instancedDataArray.float32;let p=d[c+0];return p=p>zt?p-zt:p,new Tt(Math.trunc(p),Math.trunc(d[c+1]))}translationForInstance(r){const c=16*r,d=this.instancedDataArray.float32;return[d[c+4],d[c+5],d[c+6]]}rotationScaleForInstance(r){const c=16*r,d=this.instancedDataArray.float32;return[d[c+7],d[c+8],d[c+9],d[c+10],d[c+11],d[c+12],d[c+13],d[c+14],d[c+15]]}transformForInstance(r){const c=16*r,d=this.instancedDataArray.float32;return[d[c+7],d[c+8],d[c+9],d[c+4],d[c+10],d[c+11],d[c+12],d[c+5],d[c+13],d[c+14],d[c+15],d[c+6],0,0,0,1]}}class v4{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaledZ=this.canonical.z+Math.log2(r.overscaling),this.layers=r.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(r,c){}updateAppearances(r,c,d,p){}populate(r,c,d,p){this.tileToMeter=Rt(d);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const _=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?c.elevationFeatures:void 0;for(const{feature:v,id:T,index:S,sourceLayerIndex:O}of r){const k=T??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),N=Vn(v,y);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),N,d))continue;const F={id:k,sourceLayerIndex:O,index:S,geometry:y?N.geometry:Cn(v,d,p),properties:v.properties,type:v.type,patterns:{}},$=this.addFeature(F,F.geometry,N,_,d);$&&c.featureIndex.insert(v,F.geometry,S,O,this.index,this.instancesPerModel[$].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const r=this.layers[0].modelManager,c=this.layers[0].scope;let d=0;for(const p of this.modelUris){const y=r.getModel(p,c);if(!y)continue;const _=this.instancesPerModel[p];if(_){const v=.5*Yt(y.aabb.max,y.aabb.min)*_.maxScale+_.maxXYTranslationDistance,T=Math.min(zt,Math.max(v/this.tileToMeter,256));d=Math.max(T,d)}}return d}update(r,c,d,p){for(const y in this.instancesPerModel){const _=this.instancesPerModel[y];for(const v in r)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],r[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const p of d.features){const y=this.layers[0],_=p.feature,v=this.canonical,T=y.paint.get("model-rotation").evaluate(_,{},v),S=y.paint.get("model-scale").evaluate(_,{},v),O=y.paint.get("model-translation").evaluate(_,{},v);la(p.rotation,T)&&la(p.scale,S)&&la(p.translation,O)||(this.evaluate(p,p.featureStates,d,!0),r=!0)}}return r}updateReplacement(r,c,d,p){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const y=c.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(KC(this.activeReplacements,y))return!1;this.activeReplacements=y;let _=!1;for(const v in this.instancesPerModel){const T=this.instancesPerModel[v],S=T.instancedDataArray;for(const O of T.features){const k=O.instancedDataOffset,N=O.instancedDataCount;for(let F=0;F<N;F++){const $=16*(F+k);let H=S.float32[$+0];const K=H>zt;H=K?H-zt:H;const q=Math.floor(H),X=Math.floor(S.float32[$+1]);let te=!1;for(const se of this.activeReplacements)if(!FM(se,d,iB.Model,p)&&!(se.min.x>q||q>se.max.x||se.min.y>X||X>se.max.y)&&(te=VM(jM(q,X,r.canonical,se.footprintTileId.canonical),se.footprint),te))break;S.float32[$]=te?H+zt:H,_=_||te!==K}}}return _}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=r.createVertexBuffer(d.instancedDataArray,YQ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(r){for(const d in this.instancesPerModel){const p=this.instancesPerModel[d];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const c=this.layers[0].modelManager;if(r&&c&&this.modelUris&&this.modelsRequested)for(const d of this.modelUris)c.removeModel(d,"",!0)}addFeature(r,c,d,p,y){const _=this.layers[0],v=_.layout.get("model-id"),T=_.layout.get("model-allow-density-reduction"),S=v.evaluate(d,{},this.canonical);if(!S)return In(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),S;(b4(S,!1)||this.styleDefinedModelURLs[S]!==void 0)&&(this.modelUris.includes(S)||this.modelUris.push(S)),this.instancesPerModel[S]||(this.instancesPerModel[S]=new sB);const O=this.instancesPerModel[S],k=O.instancedDataArray,N=new rB(d,k.length);let F;p&&(F=Zo.getElevationFeature(r,p));for(const $ of c)for(const H of $){if(H.x<0||H.x>=zt||H.y<0||H.y>=zt)continue;if(this.lookupDim!==0&&T){const q=(this.lookupDim-1)/zt,X=this.lookupDim*(H.y*q|0)+H.x*q|0;if(this.lookup){if(this.lookup[X]!==0)continue;this.lookup[X]=1}}this.instanceCount++;const K=k.length;if(k.resize(K+1),p){O.instancesRoadElevation||(O.instancesRoadElevation=[]);const q=F?F.pointElevation(new Tt(H.x,H.y)):0;O.instancesRoadElevation.push(q)}O.instancesEvaluatedElevation.push(0),k.float32[16*K]=H.x,k.float32[16*K+1]=H.y}return N.instancedDataCount=O.instancedDataArray.length-N.instancedDataOffset,N.instancedDataCount>0&&(r.id&&(O.idToFeaturesIndex[r.id]=O.features.length),O.features.push(N),this.evaluate(N,{},O,!1)),S}getModelUris(){return this.modelUris}evaluate(r,c,d,p){const y=this.layers[0],_=r.feature,v=this.canonical,T=r.rotation=y.paint.get("model-rotation").evaluate(_,c,v),S=r.scale=y.paint.get("model-scale").evaluate(_,c,v),O=r.translation=y.paint.get("model-translation").evaluate(_,c,v),k=Object.assign({},y.paint.get("model-color").evaluate(_,c,v));k.a=y.paint.get("model-color-mix-intensity").evaluate(_,c,v);const N=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]);const F=O[0]*O[0]+O[1]*O[1],$=F>0?Math.sqrt(F):0;d.maxScale=Math.max(Math.max(d.maxScale,S[0]),Math.max(S[1],S[2])),d.maxXYTranslationDistance=Math.max(d.maxXYTranslationDistance,$),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),D9(N,T,S);const H=Math.round(100*k.a)+k.b/1.05;for(let K=0;K<r.instancedDataCount;++K){const q=r.instancedDataOffset+K,X=16*q,te=d.instancedDataArray.float32;let se=0;p&&(se=te[X+6]-d.instancesEvaluatedElevation[q]);const ge=0|te[X+1];te[X]=(0|te[X])+k.r/1.05,te[X+1]=ge+k.g/1.05,te[X+2]=H,te[X+3]=1/(v.z>10?this.tileToMeter:Rt(v,ge)),te[X+4]=O[0],te[X+5]=O[1],te[X+6]=O[2]+(d.instancesRoadElevation?d.instancesRoadElevation[q]:0)+se,te[X+7]=N[0],te[X+8]=N[1],te[X+9]=N[2],te[X+10]=N[4],te[X+11]=N[5],te[X+12]=N[6],te[X+13]=N[8],te[X+14]=N[9],te[X+15]=N[10],d.instancesEvaluatedElevation[q]=O[2]}}}let oB,aB;Qt(v4,"ModelBucket",{omit:["layers"]}),Qt(sB,"PerModelAttributes"),Qt(rB,"ModelFeature");class e1{constructor(r,c,d){this._demTile=r,this._dem=this._demTile.dem,this._scale=c,this._offset=d}static create(r,c,d){const p=d||r.findDEMTileFor(c);if(!p||!p.dem)return;const y=p.dem,_=p.tileID,v=1<<c.canonical.z-_.canonical.z;return new e1(p,y.dim/zt/v,[(c.canonical.x/v-_.canonical.x)*y.dim,(c.canonical.y/v-_.canonical.y)*y.dim])}tileCoordToPixel(r,c){const d=c*this._scale+this._offset[1];return new Tt(Math.floor(r*this._scale+this._offset[0]),Math.floor(d))}getElevationAt(r,c,d,p){const y=r*this._scale+this._offset[0],_=c*this._scale+this._offset[1],v=Math.floor(y),T=Math.floor(_),S=this._dem;return p=!!p,d?xn(xn(S.get(v,T,p),S.get(v,T+1,p),_-T),xn(S.get(v+1,T,p),S.get(v+1,T+1,p),_-T),y-v):S.get(v,T,p)}getElevationAtPixel(r,c,d){return this._dem.get(r,c,!!d)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Je(1,r)*this._dem.stride}}const x4=new Float32Array(262144),i0=new Uint8Array(262144);function cB(u){let r=0;if(u.meshes)for(const c of u.meshes)r=Math.max(r,c.aabb.max[2]);if(u.children)for(const c of u.children)r=Math.max(r,cB(c));return r}function lB(u,r,c){if(u.meshes)for(const d of u.meshes){if(d.aabb.min[0]===1/0)continue;const p=Ri.applyTransform(d.aabb,u.globalMatrix);c.insert(r,p.min[0],p.min[1],p.max[0],p.max[1])}if(u.children)for(const d of u.children)lB(d,r,c)}const uB=["","wall","door","roof","window","lamp","logo"];class dB{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:cB(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const c=new Ri([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==r&&(d.transformedAabb=Ri.applyTransformFast(d.aabb,this.node.globalMatrix),c.encapsulate(d.transformedAabb)),r++;this.aabb=c}return this.aabb}}class A5{constructor(r,c,d,p,y,_,v,T){this.id=d,this.layers=r,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=G_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=G_.HasMapboxMeshFeatures),y&&(this.modelTraits|=G_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of c)this.nodesInfo.push(new dB(S)),lB(S,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(r,c){for(const d of this.getNodesInfo()){const p=d.node;p.footprint&&c.push({footprint:p.footprint,id:r})}}updateAppearances(r,c,d,p){}update(r){const c=Object.keys(r).length!==0;if(c&&!this.stateDependentLayers.length)return;const d=c?this.stateDependentLayers:this.layers;if(!bo(r,this.states))for(const p of d)this.evaluate(p,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const d of c){const p=d.node;this.uploaded?this.updatePbrBuffer(p):W6(p,r,!0)}for(const d of c)a5(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let c=!1;if(!r.meshes)return c;for(const d of r.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),c=!0);return c}needsReEvaluation(r,c,d){const p=r.transform.projectionOptions,y=r.style.getBrightness(),_=this.brightness!==y;if(!this.uploaded||this.dirty||p.name!==this.projection.name||Xv(d.paint.get("model-color").value,_)||Xv(d.paint.get("model-color-mix-intensity").value,_)||Xv(d.paint.get("model-roughness").value,_)||Xv(d.paint.get("model-emissive-strength").value,_)||Xv(d.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=p,this.brightness=y;const v=this.getNodesInfo();for(const T of v)T.state=null;return!0}return!1}evaluateTransform(r,c){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const d=this.getNodesInfo(),p=this.id.canonical;for(const y of d){const _=y.feature;y.evaluatedTranslation=c.paint.get("model-translation").evaluate(_,{},p),y.evaluatedScale=c.paint.get("model-scale").evaluate(_,{},p)}}evaluate(r,c){const d=this.getNodesInfo();for(const p of d){if(!p.node.meshes)continue;const y=p.feature,_=c&&c[y.id];if(bo(_,p.state))continue;p.state=structuredClone(_);const v=p.node.meshes&&p.node.meshes[0].featureData,T=p.evaluatedColor[2],S=p.evaluatedRMEA[2],O=this.id.canonical;if(p.hasTranslucentParts=!1,v){for(let k=0;k<uB.length;k++){const N=uB[k];N.length&&(y.properties.part=N);const F=r.paint.get("model-color").evaluate(y,_,O).toPremultipliedRenderColor(null),$=r.paint.get("model-color-mix-intensity").evaluate(y,_,O);p.evaluatedColor[k]=[F.r,F.g,F.b,$],p.evaluatedRMEA[k][0]=r.paint.get("model-roughness").evaluate(y,_,O),p.evaluatedRMEA[k][2]=r.paint.get("model-emissive-strength").evaluate(y,_,O),p.evaluatedRMEA[k][3]=F.a,p.emissionHeightBasedParams[k]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,_,O),!p.hasTranslucentParts&&F.a<1&&(p.hasTranslucentParts=!0)}delete y.properties.part,Rte(p,T!==p.evaluatedColor[2]||S!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(y,_,O);p.evaluatedTranslation=r.paint.get("model-translation").evaluate(y,_,O),p.evaluatedScale=r.paint.get("model-scale").evaluate(y,_,O),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,c,d,p){const y=r.findDEMTileFor(d);if(y&&(y.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const _=e1.create(r,d,y);if(!_)return;this.modelTraits&G_.HasMapboxMeshFeatures&&this.updateDEM(r,_,d,p);for(const v of this.getNodesInfo()){const T=v.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const S=T.footprint.vertices;let O=_.getElevationAt(S[0].x,S[0].y,!0,!0);for(let k=1;k<S.length;k++)O=Math.min(O,_.getElevationAt(S[k].x,S[k].y,!0,!0));T.elevation=O}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=c}}updateDEM(r,c,d,p){let y=c._dem._modifiedForSources[p];if(y===void 0&&(c._dem._modifiedForSources[p]=[],y=c._dem._modifiedForSources[p]),y.includes(d.canonical))return;const _=c._dem.dim;y.push(d.canonical);let v=!1;for(const T of this.getNodesInfo()){const S=T.node;if(!S.footprint||!S.footprint.grid)continue;const O=S.footprint.grid,k=c.tileCoordToPixel(O.min.x,O.min.y),N=c.tileCoordToPixel(O.max.x,O.max.y),F=Math.min(Math.min(_-N.y,k.x),Math.min(k.y,_-N.x));if(F<0)continue;const $=ve(F,2,5);let H=Math.max(0,k.x-$),K=Math.max(0,k.y-$),q=Math.min(N.x+$,_-1),X=Math.min(N.y+$,_-1);for(let me=K;me<=X;++me)for(let Ee=H;Ee<=q;++Ee)i0[me*_+Ee]=255;let te=0,se=0;for(let me=0;me<O.cellsY;++me)for(let Ee=0;Ee<O.cellsX;++Ee){if(!O.cells[me*O.cellsX+Ee])continue;const Te=c.tileCoordToPixel(O.min.x+Ee/O.xScale,O.min.y+me/O.yScale),xe=c.tileCoordToPixel(O.min.x+(Ee+1)/O.xScale,O.min.y+(me+1)/O.yScale);for(let Oe=Te.y;Oe<=Math.min(xe.y+1,_-1);++Oe)for(let Be=Te.x;Be<=Math.min(xe.x+1,_-1);++Be)i0[Oe*_+Be]===255&&(i0[Oe*_+Be]=0,te+=c.getElevationAtPixel(Be,Oe),se++)}const ge=te/se;H=Math.max(1,k.x-$),K=Math.max(1,k.y-$),q=Math.min(N.x+$,_-2),X=Math.min(N.y+$,_-2),v=!0;for(let me=K;me<=X;++me)for(let Ee=H;Ee<=q;++Ee)i0[me*_+Ee]===0&&(x4[me*_+Ee]=c._dem.set(Ee,me,ge));for(let me=1;me<$;++me){H=Math.max(1,k.x-me),K=Math.max(1,k.y-me),q=Math.min(N.x+me,_-2),X=Math.min(N.y+me,_-2);for(let Ee=K;Ee<=X;++Ee)for(let Te=H;Te<=q;++Te){const xe=Ee*_+Te;if(i0[xe]===255){let Oe=0,Be=0,lt=-1,it=-1;for(let st=-1;st<=1;++st)for(let _t=-1;_t<=1;++_t){const gt=(Ee+st)*_+Te+_t;if(i0[gt]>=me)continue;const yt=x4[gt],Qe=Math.abs(yt);Qe>Be&&(Oe=yt,Be=Qe,lt=_t,it=st)}if(Be>.1){const st=1-(me+.5*Math.abs(lt*it))/$;let _t=c._dem.get(Te,Ee)+Oe*st;const gt=c._dem.get(Te+lt,Ee+it),yt=c._dem.get(Te-lt,Ee-it,!0);(_t-gt)*(_t-yt)>0&&(_t=(gt+yt)/2),x4[xe]=c._dem.set(Te,Ee,_t),i0[xe]=me}}}}}v&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=ac.now())}setFilter(r){this.filter=r?Qb(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new Ui(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const c of r)a5(c.node),H6(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const d=c.getReplacementRegionsForTile(r.toUnwrapped());for(const p of this.getNodesInfo()){const y=p.node.footprint;p.hiddenByReplacement=!!y&&!d.find(_=>_.footprint===y)}}getHeightAtTileCoord(r,c){const d=[],p=[0,0,0],y=G([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],T=v.transformedAabb;if(r<T.min[0]||c<T.min[1]||r>T.max[0]||c>T.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};ne(y,_.node.globalMatrix),p[0]=r,p[1]=c,ui(p,p,y);const S=(p[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Qg|0,O=Math.min(63,(p[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Qg|0)*Qg+Math.min(63,S),k=v.heightmap[O];if(!(k<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:k,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Tt(r,c),new Tt(r,c),d),d.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Xv(u,r){return u instanceof Og&&!u.isLightConstant&&r}function Pte(u,r,c,d,p,y,_,v){let T=(61440&r|(61440&r)>>4)>>8,S=(3840&r|(3840&r)>>4)>>4,O=240&r|(240&r)>>4;c[3]>0&&(T=xn(T,255*c[0],c[3]),S=xn(S,255*c[1],c[3]),O=xn(O,255*c[2],c[3]));const k=T<<8|S,N=O<<8|Math.floor(255*d[3]),F=function(me){const Ee=ve(me,0,2);return Math.min(Math.round(.5*Ee*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],$=ve(p[0],0,1),H=ve(p[1],0,1),K=ve(p[2],0,1),q=ve(p[3],0,1);let X,te,se,ge;if($!==H&&_!==y&&H!==$){const me=_-y;te=1/(me*(H-$)),se=-(y+me*$)/(me*(H-$));const Ee=ve(p[4],-1,1);ge=Math.pow(10,Ee),X=255*K<<8|255*q}else X=65535,te=0,se=1,ge=1;if(u.emplaceBack(k,N,F,X,te,se,ge),v){const me=v.length;v.clear();for(let Ee=0;Ee<me;Ee++)v.emplaceBack(k,N,F,X,te,se,ge)}}function Rte(u,r,c){const d=u.node;let p=0;const y=c&G_.HasMeshoptCompression;for(const _ of d.meshes){if(d.lights&&d.lightMeshIndex===p||!_.featureData)continue;_.featureArray=new jg,_.featureArray.reserve(_.featureData.length);let v=r;for(const T of _.featureData){const S=y?65535&T:T>>16&65535,O=y?T>>16&65535:65535&T,k=(15&O)<8?15&O:0,N=u.evaluatedRMEA[k],F=u.evaluatedColor[k],$=u.emissionHeightBasedParams[k];let H;if(v&&k===2&&d.lights&&(H=new jg,H.resize(10*d.lights.length)),Pte(_.featureArray,S,F,N,$,_.aabb.min[2],_.aabb.max[2],H),H&&v){v=!1;const K=d.meshes[d.lightMeshIndex];K.featureArray=H,K.featureArray._trim()}}_.featureArray._trim(),p++}}Qt(A5,"Tiled3dModelBucket",{omit:["layers"]}),Qt(dB,"Tiled3dModelFeature");const Ote=["id","tile","layer","source","sourceLayer","state"];class r0{constructor(r,c,d,p,y){this.type="Feature",this._vectorTileFeature=r,this._z=c,this._x=d,this._y=p,this.properties=r?r.properties:{},this.id=y}clone(){const r=new r0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Ote)this[c]!==void 0&&(r[c]=this[c]);return r}}class s0 extends Uu{constructor(r,c,d,p){super(),this.id=r,this.type="model",this.models=[],this._options=c,this._modelsInfo=new Map}loadGLTFFromURI(r){return P9(this.map._requestManager.transformRequest(r,ha.Model).url)}load(){for(const r in this._options.models){const c=this._options.models[r],d=this._modelsInfo.get(r);if(d){d.modelSpec=c;const p=d.model;p&&(p.position=c.position!=null?new ye(c.position[0],c.position[1]):new ye(0,0),p.orientation=c.orientation!=null?c.orientation:[0,0,0],s0.applyModelSpecification(p,c),p.computeBoundsAndApplyParent(),this.models.push(p))}else this._modelsInfo.set(r,{modelSpec:c,model:null}),this.loadGLTFFromURI(c.uri).then(p=>{if(!p)return;const y=this._modelsInfo.get(r);if(!y)return;const _=q6(p),v=y.modelSpec,T=new N9(r,v.uri,v.position,v.orientation,_);s0.applyModelSpecification(T,v),T.computeBoundsAndApplyParent(),this.models.push(T),y.model=T,this.loaded()&&this.fire(new zu("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(p=>{this.fire(new pg(new Error(`Could not load model ${r} from ${c.uri}: ${p.message}`)))})}this.loaded()&&this.fire(new zu("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(r,c){c.nodeOverrides&&s0.convertNodeOverrides(r,c.nodeOverrides),c.materialOverrides&&s0.convertMaterialOverrides(r,c.materialOverrides),c.nodeOverrideNames&&(r.nodeOverrideNames=[...c.nodeOverrideNames]),c.materialOverrideNames&&(r.materialOverrideNames=[...c.materialOverrideNames]),c.featureProperties&&(r.featureProperties=c.featureProperties)}static convertNodeOverrides(r,c){if(Array.isArray(c)&&c.every(d=>typeof d=="string")){r.nodeOverrideNames=[];for(const d of c)r.nodeOverrideNames.push(d)}else Object.entries(c).forEach(([d,p])=>{const y={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const _=p.orientation;_&&(y.orientation=_)}r.nodeOverrides.set(d,y)})}static convertMaterialOverrides(r,c){if(Array.isArray(c)&&c.every(d=>typeof d=="string")){r.materialOverrideNames=[];for(const d of c)r.materialOverrideNames.push(d)}else Object.entries(c).forEach(([d,p])=>{const y={color:new Di(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=p["model-color"];_!==void 0&&(y.color.r=_[0],y.color.g=_[1],y.color.b=_[2]);const v=p["model-color-mix-intensity"];v!==void 0&&(y.colorMix=v);const T=p["model-emissive-strength"];T!==void 0&&(y.emissionStrength=T);const S=p["model-opacity"];S!==void 0&&(y.opacity=S),r.materialOverrides.set(d,y)})}onAdd(r){this.map=r,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const r of this._modelsInfo.values())if(r.model==null)return!1;return!0}getModels(){return this.models}loadTile(r,c){}serialize(){return this._options}setProperty(r,c){return!1}reload(){const r=Jh(this.id,this.scope);this.map.style.clearSource(r),this.models=[],this._modelsInfo.clear(),this.load()}setModels(r){this.models=[];const c=new Map;for(const d in r){const p=r[d];if(this._modelsInfo.has(d)){const y=this._modelsInfo.get(d);y&&y.modelSpec.uri===p.uri&&c.set(d,y)}}this._modelsInfo=c,this._options.models=r,this.load()}}function E4(u,r,c,d){const p=1<<u.z;r.lat=xt((d/zt+u.y)/p),r.lng=mt((c/zt+u.x)/p)}function kte(u,r,c,d){const p=u.getNodesInfo()[r];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let y=Number.MAX_VALUE;const _=p.node,v=c.tile,T=d.calculatePosMatrix(v.tileID.toUnwrapped(),d.worldSize),S=p.evaluatedScale;let O=0;d.elevation&&_.elevation&&(O=_.elevation*d.elevation.exaggeration()),Q(T,T,[(_.anchor?_.anchor[0]:0)*(S[0]-1),(_.anchor?_.anchor[1]:0)*(S[1]-1),O]),de(T,T,S);const k=c.queryGeometry,N=k.isPointQuery()?k.screenBounds:k.screenGeometry,F=function(H){const K=oe([],T,H.globalMatrix);oe(K,d.expandedFarZProjMatrix,K);for(let q=0;q<H.meshes.length;++q){const X=H.meshes[q];if(q===H.lightMeshIndex)continue;const te=V6(N,d,K,X.aabb);te!=null&&(y=Math.min(te,y))}if(H.children)for(const q of H.children)F(q)};if(F(_),y===Number.MAX_VALUE)return;const $=new ye(0,0);return E4(v.tileID.canonical,$,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:y,position:$,feature:p.feature}}const Dte={circle:class extends Go{constructor(u,r,c,d){super(u,{layout:qN||(qN=new Tr({"circle-sort-key":new Vt(Ke.layout_circle["circle-sort-key"]),"circle-elevation-reference":new kt(Ke.layout_circle["circle-elevation-reference"]),visibility:new kt(Ke.layout_circle.visibility)})),paint:ZN||(ZN=new Tr({"circle-radius":new Vt(Ke.paint_circle["circle-radius"]),"circle-color":new Vt(Ke.paint_circle["circle-color"]),"circle-blur":new Vt(Ke.paint_circle["circle-blur"]),"circle-opacity":new Vt(Ke.paint_circle["circle-opacity"]),"circle-translate":new kt(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new kt(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kt(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kt(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(Ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new kt(Ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d)}createBucket(u){return new Ko(u)}queryRadius(u){const r=u;return tf("circle-radius",this,r)+tf("circle-stroke-width",this,r)+L_(this.paint.get("circle-translate"))}queryIntersectsFeature(u,r,c,d,p,y,_,v){const T=GN(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c);return aM(u,d,y,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,r,c){const d=oM(this);return{config:new L(this,{zoom:r,lut:c}),defines:d,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Go{createBucket(u){return new lM(u)}constructor(u,r,c,d){super(u,{layout:uM||(uM=new Tr({visibility:new kt(Ke.layout_heatmap.visibility)})),paint:dM||(dM=new Tr({"heatmap-radius":new Vt(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kt(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ep(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kt(Ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_v({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return tf("heatmap-radius",this,u)}queryIntersectsFeature(u,r,c,d,p,y,_,v){const T=this.paint.get("heatmap-radius").evaluate(r,c);return aM(u,d,y,_,v,!0,!0,new Tt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,r,c){return u==="heatmap"?{config:new L(this,{zoom:r,lut:c}),overrideFog:!1}:{}}},hillshade:class extends Go{constructor(u,r,c,d){super(u,{layout:hM||(hM=new Tr({visibility:new kt(Ke.layout_hillshade.visibility)})),paint:fM||(fM=new Tr({"hillshade-illumination-direction":new kt(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kt(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kt(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kt(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kt(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kt(Ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new kt(Ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,r,c){return{overrideFog:!1}}},fill:class extends Go{constructor(u,r,c,d){super(u,{layout:DM||(DM=new Tr({"fill-sort-key":new Vt(Ke.layout_fill["fill-sort-key"]),visibility:new kt(Ke.layout_fill.visibility),"fill-elevation-reference":new kt(Ke.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Vt(Ke.layout_fill["fill-construct-bridge-guard-rail"])})),paint:NM||(NM=new Tr({"fill-antialias":new kt(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Vt(Ke.paint_fill["fill-opacity"]),"fill-color":new Vt(Ke.paint_fill["fill-color"]),"fill-outline-color":new Vt(Ke.paint_fill["fill-outline-color"]),"fill-translate":new kt(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new kt(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vt(Ke.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new kt(Ke.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new kt(Ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Vt(Ke.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Vt(Ke.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Vt(Ke.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d)}getProgramIds(){const u=this.paint.get("fill-pattern"),r=u&&u.constantOr(1),c=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,r,c){return{config:new L(this,{zoom:r,lut:c}),overrideFog:!1}}recalculate(u,r){super.recalculate(u,r);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new A6(u)}queryRadius(){return L_(this.paint.get("fill-translate"))}queryIntersectsFeature(u,r,c,d,p,y){return!u.queryGeometry.isAboveHorizon&&ir(HN(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?r&&!u:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Go{constructor(u,r,c,d){super(u,{layout:i9||(i9=new Tr({visibility:new kt(Ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new kt(Ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:r9||(r9=new Tr({"fill-extrusion-opacity":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new kt(Ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new XC(u)}queryRadius(){return L_(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,r,c,d,p,y,_,v,T){const S=GN(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(r,c),k=this.paint.get("fill-extrusion-base").evaluate(r,c),N=[0,0],F=v&&y.elevation,$=y.elevation?y.elevation.exaggeration():1,H=u.tile.getBucket(this);if(F&&H instanceof XC){const se=H.centroidVertexArray,ge=T+1;ge<se.length&&(N[0]=se.geta_centroid_pos0(ge),N[1]=se.geta_centroid_pos1(ge))}if(N[0]===0&&N[1]===1)return!1;y.projection.name==="globe"&&(d=n9([d],[new Tt(0,0),new Tt(zt,zt)],u.tileID.canonical).map(se=>se.polygon).flat());const K=F?v:null,[q,X]=d9(y,d,k,O,S,_,K,N,$,y.center.lat,u.tileID.canonical),te=u.queryGeometry;return u9(q,X,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},building:class extends Go{constructor(u,r,c,d){super(u,{layout:U9||(U9=new Tr({visibility:new kt(Ke.layout_building.visibility),"building-facade":new Vt(Ke.layout_building["building-facade"]),"building-facade-floors":new Vt(Ke.layout_building["building-facade-floors"]),"building-facade-unit-width":new Vt(Ke.layout_building["building-facade-unit-width"]),"building-facade-window":new Vt(Ke.layout_building["building-facade-window"]),"building-roof-shape":new Vt(Ke.layout_building["building-roof-shape"]),"building-height":new Vt(Ke.layout_building["building-height"]),"building-base":new Vt(Ke.layout_building["building-base"]),"building-flood-light-wall-radius":new Vt(Ke.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Vt(Ke.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Vt(Ke.layout_building["building-flip-roof-orientation"])})),paint:j9||(j9=new Tr({"building-opacity":new kt(Ke.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new kt(Ke.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new kt(Ke.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new kt(Ke.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new kt(Ke.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new kt(Ke.paint_building["building-vertical-scale"]),"building-cast-shadows":new kt(Ke.paint_building["building-cast-shadows"]),"building-color":new Vt(Ke.paint_building["building-color"]),"building-emissive-strength":new Vt(Ke.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new kt(Ke.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new kt(Ke.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new kt(Ke.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new kt(Ke.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new kt(Ke.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new z9(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,r,c,d,p,y,_,v,T,S){let O=this.layout.get("building-height").evaluate(r,c);const k=this.layout.get("building-base").evaluate(r,c),N=u.tile.getBucket(this).getFootprint(r);if(N){if(N.hiddenFlags!==0)return!1;O=N.height}const[F,$]=d9(y,d,k,O,new Tt(0,0),_,null,[0,0],1,y.center.lat,u.tileID.canonical),H=u.queryGeometry;return u9(F,$,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Go{constructor(u,r,c,d){const p=J9();super(u,p,r,c,d),p.layout&&(this.layout=new Ho(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Cg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(u,r){super.recalculate(u,r),this.paint._values["line-floorwidth"]=(()=>{if(Bv)return Bv;const c=J9();return Bv=new See(c.paint.properties["line-width"].specification),Bv.useIntegerZoom=!0,Bv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Y6(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,r,c){const d=Y9(this);return{config:new L(this,{zoom:r,lut:c}),defines:d,overrideFog:!1}}queryRadius(u){const r=u,c=Q9(tf("line-width",this,r),tf("line-gap-width",this,r)),d=tf("line-offset",this,r);return c/2+Math.abs(d)+L_(this.paint.get("line-translate"))}queryIntersectsFeature(u,r,c,d,p,y){if(u.queryGeometry.isAboveHorizon)return!1;const _=HN(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,u.pixelToTileUnitsFactor),v=u.pixelToTileUnitsFactor/2*Q9(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),T=this.paint.get("line-offset").evaluate(r,c);return T&&(d=function(S,O){const k=[],N=new Tt(0,0);for(let F=0;F<S.length;F++){const $=S[F],H=[];for(let K=0;K<$.length;K++){const q=$[K],X=$[K+1],te=K===0?N:q.sub($[K-1])._unit()._perp(),se=K===$.length-1?N:X.sub(q)._unit()._perp(),ge=te._add(se)._unit();ge._mult(1/(ge.x*se.x+ge.y*se.y)),H.push(ge._mult(O)._add(q))}k.push(H)}return k}(d,T*u.pixelToTileUnitsFactor)),function(S,O,k){for(let N=0;N<O.length;N++){const F=O[N];if(S.length>=3){for(let $=0;$<F.length;$++)if(Ba(S,F[$]))return!0}if(Jr(S,F,k))return!0}return!1}(_,d,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:x5,background:class extends Go{constructor(u,r,c,d){super(u,{layout:WL||(WL=new Tr({visibility:new kt(Ke.layout_background.visibility)})),paint:HL||(HL=new Tr({"background-pitch-alignment":new kt(Ke.paint_background["background-pitch-alignment"]),"background-color":new kt(Ke.paint_background["background-color"]),"background-pattern":new kt(Ke.paint_background["background-pattern"]),"background-opacity":new kt(Ke.paint_background["background-opacity"]),"background-emissive-strength":new kt(Ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,r,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:YL,"raster-particle":nB,sky:class extends Go{constructor(u,r,c,d){super(u,{layout:QL||(QL=new Tr({visibility:new kt(Ke.layout_sky.visibility)})),paint:eB||(eB=new Tr({"sky-type":new kt(Ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new kt(Ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new kt(Ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new kt(Ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new kt(Ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ep(Ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new kt(Ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new kt(Ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new kt(Ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_v({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(u,r){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),p=!d,y=u.style.light,_=y.properties.get("position");return p&&y.properties.get("anchor")==="viewport"&&In("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?w4(_.azimuthal,90-_.polar,r):w4(d[0],90-d[1],r)}const c=this.paint.get("sky-gradient-center");return w4(c[0],90-c[1],r)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends Go{constructor(u,r,c,d){super(u,{paint:tB||(tB=new Tr({}))},r,null)}},model:class extends Go{constructor(u,r,c,d){super(u,{layout:oB||(oB=new Tr({visibility:new kt(Ke.layout_model.visibility),"model-id":new Vt(Ke.layout_model["model-id"]),"model-allow-density-reduction":new kt(Ke.layout_model["model-allow-density-reduction"])})),paint:aB||(aB=new Tr({"model-opacity":new Vt(Ke.paint_model["model-opacity"]),"model-rotation":new Vt(Ke.paint_model["model-rotation"]),"model-scale":new Vt(Ke.paint_model["model-scale"]),"model-translation":new Vt(Ke.paint_model["model-translation"]),"model-color":new Vt(Ke.paint_model["model-color"]),"model-color-mix-intensity":new Vt(Ke.paint_model["model-color-mix-intensity"]),"model-type":new kt(Ke.paint_model["model-type"]),"model-cast-shadows":new kt(Ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new kt(Ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new kt(Ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Vt(Ke.paint_model["model-emissive-strength"]),"model-roughness":new Vt(Ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Vt(Ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new kt(Ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new kt(Ke.paint_model["model-front-cutoff"]),"model-elevation-reference":new kt(Ke.paint_model["model-elevation-reference"]),"model-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},r,c,d),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new v4(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof A5?8191:0}queryRenderedFeatures(u,r,c){const d=r.getSource();if(!(d&&d instanceof s0))return{};const p=d,y={};y[this.id]=[];const _=y[this.id];let v=0;for(const T of p.models){const S=r.getFeatureState(this.sourceLayer,T.id),O={type:"Unknown",id:T.id,properties:T.featureProperties},k=this.paint.get("model-rotation").evaluate(O,S),N=this.paint.get("model-scale").evaluate(O,S),F=this.paint.get("model-translation").evaluate(O,S),$=this.paint.get("model-elevation-reference");let H=[];o5(H,T,c,T.position,k,N,F,$==="ground",$==="ground",!1),c.projection.name==="globe"&&(H=s5(H,c));const K=oe([],c.projMatrix,H),q=V6(u.isPointQuery()?u.screenBounds:u.screenGeometry,c,K,T.aabb);if(q!=null){const X=new r0(void 0,0,0,0,T.id);X.layer=this.layer,X.properties=structuredClone(T.featureProperties),X.properties.layer=this.id,X.properties.uri=T.uri,X.properties.orientation=T.orientation,X.sourceLayer=this.sourceLayer,X.geometry={type:"Point",coordinates:[T.position.lng,T.position.lat]},X.state=S,X.source=this.source,_.push({featureIndex:v,feature:X,intersectionZ:q})}++v}return y}queryIntersectsFeature(u,r,c,d,p,y,_,v,T,S){if(!this.modelManager)return!1;const O=this.modelManager,k=u.tile.getBucket(this);if(!(k&&k instanceof v4))return!1;for(const N in k.instancesPerModel){const F=k.instancesPerModel[N],$=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(F.idToFeaturesIndex.hasOwnProperty($)){const H=F.features[F.idToFeaturesIndex[$]],K=O.getModel(N,S||this.scope);if(!K)return!1;let q=[];const X=new ye(0,0),te=k.canonical;let se=Number.MAX_VALUE;for(let ge=0;ge<H.instancedDataCount;++ge){const me=16*(H.instancedDataOffset+ge),Ee=F.instancedDataArray.float32,Te=[Ee[me+4],Ee[me+5],Ee[me+6]];E4(te,X,Math.floor(Ee[me]),Math.floor(Ee[me+1])),o5(q,K,y,X,H.rotation,H.scale,Te,!1,!1,!1),y.projection.name==="globe"&&(q=s5(q,y));const xe=oe([],y.projMatrix,q),Oe=u.queryGeometry,Be=V6(Oe.isPointQuery()?Oe.screenBounds:Oe.screenGeometry,y,xe,K.aabb);Be!=null&&(se=Math.min(Be,se))}return se!==Number.MAX_VALUE&&se}}return!1}_handleOverridablePaintPropertyUpdate(u,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const r=this._transitionablePaint._values[u];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof Kh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Go{constructor(u,r,c,d){super(u,{layout:MM||(MM=new Tr({"clip-layer-types":new kt(Ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new kt(Ke.layout_clip["clip-layer-scope"]),visibility:new kt(Ke.layout_clip.visibility)})),paint:LM||(LM=new Tr({}))},r,c,d)}recalculate(u,r){super.recalculate(u,r)}createBucket(u){return new BM(u)}is3D(u){return!0}}},C4=new Di(0,0,0);function Nte(u,r,c){u===1&&r.icons.push(function(d,p){return function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:_}=y;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=y.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&hB(_,"x"),_.stretch_y&&_.stretch_y.length&&hB(_,"y"),y}(d.readFields(Mte,{name:void 0},p))}(c,c.readVarint()+c.pos))}function hB(u,r){const c=[],d=u[`stretch_${r}`];let p=null;for(let y=0;y<d.length;y++)p===null?p=c.length===0?d[0]:c[c.length-1][1]+d[y]:(c.push([p,p+d[y]]),p=null);u[`stretch_${r}_areas`]=c}function Mte(u,r,c){u===1?r.name=c.readString():u===2?r.metadata=function(d,p){return d.readFields(Lte,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(c,c.readVarint()+c.pos):u===3&&(r.usvg_tree=function(d,p){return d.readFields($te,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(c,c.readVarint()+c.pos),r.data="usvg_tree")}function Lte(u,r,c){u===1?r.stretch_x=c.readPackedVarint():u===2?r.stretch_y=c.readPackedVarint():u===3?r.content_area=fB(c,c.readVarint()+c.pos):u===4?r.variables.push(function(d,p){return d.readFields(Fte,{name:void 0},p)}(c,c.readVarint()+c.pos)):u===5&&(r.text_placeholder=fB(c,c.readVarint()+c.pos))}function fB(u,r){return u.readFields(Bte,{},r)}function Bte(u,r,c){u===1?r.left=c.readVarint():u===2?r.width=c.readVarint():u===3?r.top=c.readVarint():u===4&&(r.height=c.readVarint())}function Fte(u,r,c){u===1?r.name=c.readString():u===2&&(r.rgb_color=P5(c.readVarint()),r.value="rgb_color")}function $te(u,r,c){u===1?r.width=r.height=c.readVarint():u===2?r.height=c.readVarint():u===3?r.children.push(S5(c,c.readVarint()+c.pos)):u===4?r.linear_gradients.push(function(d,p){return d.readFields(Gte,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(c,c.readVarint()+c.pos)):u===5?r.radial_gradients.push(function(d,p){return d.readFields(Zte,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(c,c.readVarint()+c.pos)):u===7?r.clip_paths.push(function(d,p){return d.readFields(Kte,{children:[]},p)}(c,c.readVarint()+c.pos)):u===8&&r.masks.push(function(d,p){const y=d.readFields(Yte,{left:0,width:20,mask_type:1,children:[]},p);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y}(c,c.readVarint()+c.pos))}function S5(u,r){return u.readFields(zte,{},r)}function zte(u,r,c){u===1?(r.group=function(d,p){return d.readFields(Ute,{opacity:255,children:[]},p)}(c,c.readVarint()+c.pos),r.node="group"):u===2&&(r.path=function(d,p){return d.readFields(Vte,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(c,c.readVarint()+c.pos),r.node="path")}function Ute(u,r,c){u===1?r.transform=I5(c,c.readVarint()+c.pos):u===2?r.opacity=c.readVarint():u===5?r.clip_path_idx=c.readVarint():u===6?r.mask_idx=c.readVarint():u===7&&r.children.push(S5(c,c.readVarint()+c.pos))}function I5(u,r){return u.readFields(jte,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function jte(u,r,c){u===1?r.sx=c.readFloat():u===2?r.ky=c.readFloat():u===3?r.kx=c.readFloat():u===4?r.sy=c.readFloat():u===5?r.tx=c.readFloat():u===6&&(r.ty=c.readFloat())}function Vte(u,r,c){u===1?r.fill=function(d,p){return d.readFields(Wte,{rgb_color:C4,paint:"rgb_color",opacity:255},p)}(c,c.readVarint()+c.pos):u===2?r.stroke=function(d,p){return d.readFields(Hte,{rgb_color:C4,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(c,c.readVarint()+c.pos):u===3?r.paint_order=c.readVarint():u===5?c.readPackedVarint(r.commands):u===6?r.step=c.readFloat():u===7?c.readPackedSVarint(r.diffs):u===8&&(r.rule=c.readVarint())}function Wte(u,r,c){u===1?(r.rgb_color=P5(c.readVarint()),r.paint="rgb_color"):u===2?(r.linear_gradient_idx=c.readVarint(),r.paint="linear_gradient_idx"):u===3?(r.radial_gradient_idx=c.readVarint(),r.paint="radial_gradient_idx"):u===5&&(r.opacity=c.readVarint())}function P5(u){return new Di((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function Hte(u,r,c){u===1?(r.rgb_color=P5(c.readVarint()),r.paint="rgb_color"):u===2?(r.linear_gradient_idx=c.readVarint(),r.paint="linear_gradient_idx"):u===3?(r.radial_gradient_idx=c.readVarint(),r.paint="radial_gradient_idx"):u===5?c.readPackedFloat(r.dasharray):u===6?r.dashoffset=c.readFloat():u===7?r.miterlimit=c.readFloat():u===8?r.opacity=c.readVarint():u===9?r.width=c.readFloat():u===10?r.linecap=c.readVarint():u===11&&(r.linejoin=c.readVarint())}function Gte(u,r,c){u===1?r.transform=I5(c,c.readVarint()+c.pos):u===2?r.spread_method=c.readVarint():u===3?r.stops.push(pB(c,c.readVarint()+c.pos)):u===4?r.x1=c.readFloat():u===5?r.y1=c.readFloat():u===6?r.x2=c.readFloat():u===7&&(r.y2=c.readFloat())}function pB(u,r){return u.readFields(qte,{offset:0,opacity:255,rgb_color:C4},r)}function qte(u,r,c){u===1?r.offset=c.readFloat():u===2?r.opacity=c.readVarint():u===3&&(r.rgb_color=P5(c.readVarint()))}function Zte(u,r,c){u===1?r.transform=I5(c,c.readVarint()+c.pos):u===2?r.spread_method=c.readVarint():u===3?r.stops.push(pB(c,c.readVarint()+c.pos)):u===4?r.cx=c.readFloat():u===5?r.cy=c.readFloat():u===6?r.r=c.readFloat():u===7?r.fx=c.readFloat():u===8?r.fy=c.readFloat():u===9&&(r.fr=c.readFloat())}function Kte(u,r,c){u===1?r.transform=I5(c,c.readVarint()+c.pos):u===2?r.clip_path_idx=c.readVarint():u===3&&r.children.push(S5(c,c.readVarint()+c.pos))}function Yte(u,r,c){u===1?r.left=r.top=c.readFloat():u===2?r.width=r.height=c.readFloat():u===3?r.top=c.readFloat():u===4?r.height=c.readFloat():u===5?r.mask_type=c.readVarint():u===6?r.mask_idx=c.readVarint():u===7&&r.children.push(S5(c,c.readVarint()+c.pos))}class Xte{static calculate(r={},c=[]){const d=new Map,p=new Map;if(Object.keys(r).length===0)return d;c.forEach(y=>{p.set(y.name,y.rgb_color||new Di(0,0,0))});for(const[y,_]of Object.entries(r))p.has(y)?d.set(p.get(y).toString(),_):console.warn(`Ignoring unknown image variable "${y}"`);return d}}function t1(u,r=255,c){const d=r/255,p=u.toString(),y=c.has(p)?c.get(p).clone():u.clone();return y.a*=d,y.toString()}function Jv(u,r){if(!$h()){const c=document.createElement("canvas");return c.width=u,c.height=r,c}return new OffscreenCanvas(u,r)}let T4,Qv=null;function A4(u,r,c,d,p){for(const y of d.children)mB(u,r,c,y,p)}function mB(u,r,c,d,p){d.group?(u.save(),function(y,_,v,T,S){const O=T.mask_idx!=null?v.masks[T.mask_idx]:null,k=T.clip_path_idx!=null?v.clip_paths[T.clip_path_idx]:null;if(T.transform&&(_=n1(T.transform).preMultiplySelf(_)),!function($,H,K){return $.opacity!==255||H||K}(T,k!=null,O!=null))return void A4(y,_,v,T,S);const N=Jv(y.canvas.width,y.canvas.height),F=N.getContext("2d");A4(F,_,v,T,S),k&&xB(F,_,v,k),O&&EB(F,_,v,O,S),y.globalAlpha=T.opacity/255,y.drawImage(N,0,0)}(u,r,c,d.group,p),u.restore()):d.path&&(u.save(),function(y,_,v,T,S){y.setTransform(_),T.paint_order===1?(gB(y,v,T,S),_B(y,v,T,S)):(_B(y,v,T,S),gB(y,v,T,S))}(u,r,c,d.path,p),u.restore())}function gB(u,r,c,d){const p=c.fill;if(!p)return;const y=p.opacity/255;switch(u.save(),u.beginPath(),CB(c,u),p.paint){case"rgb_color":u.fillStyle=t1(p.rgb_color,p.opacity,d);break;case"linear_gradient_idx":{const _=r.linear_gradients[p.linear_gradient_idx];_.transform&&u.setTransform(n1(_.transform).preMultiplySelf(u.getTransform())),u.fillStyle=wB(u,_,y,d);break}case"radial_gradient_idx":{const _=r.radial_gradients[p.radial_gradient_idx];_.transform&&u.setTransform(n1(_.transform).preMultiplySelf(u.getTransform())),u.fillStyle=bB(u,_,y,d)}}u.fill(yB(c)),u.restore()}function yB(u){return u.rule===1?"nonzero":u.rule===2?"evenodd":void 0}function _B(u,r,c,d){const p=c.stroke;if(!p)return;const y=TB(c);u.lineWidth=p.width,u.miterLimit=p.miterlimit,u.setLineDash(p.dasharray),u.lineDashOffset=p.dashoffset;const _=p.opacity/255;switch(p.paint){case"rgb_color":u.strokeStyle=t1(p.rgb_color,p.opacity,d);break;case"linear_gradient_idx":u.strokeStyle=wB(u,r.linear_gradients[p.linear_gradient_idx],_,d,!0);break;case"radial_gradient_idx":u.strokeStyle=bB(u,r.radial_gradients[p.radial_gradient_idx],_,d,!0)}switch(p.linejoin){case 2:case 1:u.lineJoin="miter";break;case 3:u.lineJoin="round";break;case 4:u.lineJoin="bevel"}switch(p.linecap){case 1:u.lineCap="butt";break;case 2:u.lineCap="round";break;case 3:u.lineCap="square"}u.stroke(y)}function wB(u,r,c,d,p=!1){if(r.stops.length===1){const N=r.stops[0];return t1(N.rgb_color,N.opacity*c,d)}const{x1:y,y1:_,x2:v,y2:T}=r;let S=new DOMPoint(y,_),O=new DOMPoint(v,T);if(p){const N=n1(r.transform);S=N.transformPoint(S),O=N.transformPoint(O)}const k=u.createLinearGradient(S.x,S.y,O.x,O.y);for(const N of r.stops)k.addColorStop(N.offset,t1(N.rgb_color,N.opacity*c,d));return k}function bB(u,r,c,d,p=!1){if(r.stops.length===1){const q=r.stops[0];return t1(q.rgb_color,q.opacity*c,d)}const y=n1(r.transform),{fx:_,fy:v,fr:T,cx:S,cy:O,r:k}=r;let N=new DOMPoint(_,v),F=new DOMPoint(S,O),$=T,H=k;if(p){N=y.transformPoint(N),F=y.transformPoint(F);const q=(y.a+y.d)/2;$=T*q,H=r.r*q}const K=u.createRadialGradient(N.x,N.y,$,F.x,F.y,H);for(const q of r.stops)K.addColorStop(q.offset,t1(q.rgb_color,q.opacity*c,d));return K}function vB(u,r,c,d){const p=d.transform?n1(d.transform).preMultiplySelf(r):r,y=Jv(u.canvas.width,u.canvas.height),_=y.getContext("2d");for(const T of d.children)if(T.group)vB(_,p,c,T.group);else if(T.path){const S=T.path,O=new Path2D;O.addPath(TB(S),p),_.fill(O,yB(S))}const v=d.clip_path_idx!=null?c.clip_paths[d.clip_path_idx]:null;v&&xB(_,p,c,v),u.globalCompositeOperation="source-over",u.drawImage(y,0,0)}function xB(u,r,c,d){const p=Jv(u.canvas.width,u.canvas.height);vB(p.getContext("2d"),r,c,d),u.globalCompositeOperation="destination-in",u.drawImage(p,0,0)}function EB(u,r,c,d,p){if(d.children.length===0)return;const y=d.mask_idx!=null?c.masks[d.mask_idx]:null;y&&EB(u,r,c,y,p);const _=u.canvas.width,v=u.canvas.height,T=Jv(_,v),S=T.getContext("2d"),O=d.width,k=d.height,N=d.left,F=d.top,$=new Path2D,H=new Path2D;H.rect(N,F,O,k),$.addPath(H,r),S.clip($);for(const X of d.children)mB(S,r,c,X,p);const K=S.getImageData(0,0,_,v),q=K.data;if(d.mask_type===1)for(let X=0;X<q.length;X+=4)q[X+3]=q[X+3]/255*(.2126*q[X]+.7152*q[X+1]+.0722*q[X+2]);S.putImageData(K,0,0),u.globalCompositeOperation="destination-in",u.drawImage(T,0,0)}function n1(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function CB(u,r){const c=u.step;let d=u.diffs[0]*c,p=u.diffs[1]*c;r.moveTo(d,p);for(let y=0,_=2;y<u.commands.length;y++)switch(u.commands[y]){case 1:d+=u.diffs[_++]*c,p+=u.diffs[_++]*c,r.moveTo(d,p);break;case 2:d+=u.diffs[_++]*c,p+=u.diffs[_++]*c,r.lineTo(d,p);break;case 3:{const v=d+u.diffs[_++]*c,T=p+u.diffs[_++]*c;d=v+u.diffs[_++]*c,p=T+u.diffs[_++]*c,r.quadraticCurveTo(v,T,d,p);break}case 4:{const v=d+u.diffs[_++]*c,T=p+u.diffs[_++]*c,S=v+u.diffs[_++]*c,O=T+u.diffs[_++]*c;d=S+u.diffs[_++]*c,p=O+u.diffs[_++]*c,r.bezierCurveTo(v,T,S,O,d,p);break}case 5:r.closePath();break}return r}function TB(u){return CB(u,new Path2D)}class R5{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const c=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,c),c}put(r,c){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,c)}delete(r){this.cache.delete(r)}}Qt(R5,"LRUCache");class S4{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new ho(r,r.data)}getFromCache(r,c,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new R5(150)),this.cacheMap.get(d).get(Jh(r.toString(),c))}setInCache(r,c,d,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new R5(150));const y=this.cacheDependenciesMap.get(p),_=Jh(r.id.toString(),d);y.get(_)||y.set(_,new Set);const v=this.cacheMap.get(p),T=r.toString();y.get(_).add(T),v.put(Jh(r.toString(),d),c)}removeImagesFromCacheByIds(r,c,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const p=this.cacheMap.get(d),y=this.cacheDependenciesMap.get(d);for(const _ of r){const v=Jh(_.toString(),c);if(y.has(v)){for(const T of y.get(v))p.delete(T);y.delete(v)}}}rasterize(r,c,d,p){const y=this.getFromCache(r,d,p);if(y)return y.clone();const _=function(T,S){const O=Xte.calculate(S.params,T.metadata?T.metadata.variables:[]),k=T.usvg_tree,N=k.width,F=k.height,$=Math.max(1,Math.round(N*S.sx)),H=Math.max(1,Math.round(F*S.sy)),K=new DOMMatrix([$/N,0,0,H/F,0,0]);return Qv===null&&(Qv=Jv(10,10),T4=Qv.getContext("2d",{willReadFrequently:!0})),Qv.width=$,Qv.height=H,A4(T4,K,k,k,O),T4.getImageData(0,0,$,H)}(c.icon,r),v=S4._getImage(_);return this.setInCache(r,v,d,p),v.clone()}}class AB{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,c){const d=this.toIdx(r,c);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(r,c){return this.leaves[this.toIdx(r,c)]}toIdx(r,c){return c*this.size+r}}function SB(u,r,c,d){let p=0,y=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(d[_])<1e-15){if(c[_]<u[_]||c[_]>r[_])return null}else{const v=1/d[_];let T=(u[_]-c[_])*v,S=(r[_]-c[_])*v;if(T>S){const O=T;T=S,S=O}if(T>p&&(p=T),S<y&&(y=S),p>y)return null}return p}function IB(u,r,c,d,p,y,_,v,T,S,O){const k=d-u,N=p-r,F=y-c,$=_-u,H=v-r,K=T-c,q=O[1]*K-O[2]*H,X=O[2]*$-O[0]*K,te=O[0]*H-O[1]*$,se=k*q+N*X+F*te;if(Math.abs(se)<1e-15)return null;const ge=1/se,me=S[0]-u,Ee=S[1]-r,Te=S[2]-c,xe=(me*q+Ee*X+Te*te)*ge;if(xe<0||xe>1)return null;const Oe=Ee*F-Te*N,Be=Te*k-me*F,lt=me*N-Ee*k,it=(O[0]*Oe+O[1]*Be+O[2]*lt)*ge;return it<0||xe+it>1?null:($*Oe+H*Be+K*lt)*ge}function PB(u,r,c){return(u-r)/(c-r)}function RB(u,r,c,d,p,y,_,v,T){const S=1<<c,O=y-d,k=_-p,N=(u+1)/S*O+d,F=(r+0)/S*k+p,$=(r+1)/S*k+p;v[0]=(u+0)/S*O+d,v[1]=F,T[0]=N,T[1]=$}class OB{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(y){const _=Math.ceil(Math.log2(y.dim/8)),v=[];let T=Math.ceil(Math.pow(2,_));const S=1/T,O=(F,$,H,K,q)=>{const X=K?1:0,te=(F+1)*H-X,se=$*H,ge=($+1)*H-X;q[0]=F*H,q[1]=se,q[2]=te,q[3]=ge};let k=new AB(T);const N=[];for(let F=0;F<T*T;F++){O(F%T,Math.floor(F/T),S,!1,N);const $=$p(N[0],N[1],y),H=$p(N[2],N[1],y),K=$p(N[2],N[3],y),q=$p(N[0],N[3],y);k.minimums.push(Math.min($,H,K,q)),k.maximums.push(Math.max($,H,K,q)),k.leaves.push(1)}for(v.push(k),T/=2;T>=1;T/=2){const F=v[v.length-1];k=new AB(T);for(let $=0;$<T*T;$++){O($%T,Math.floor($/T),2,!0,N);const H=F.getElevation(N[0],N[1]),K=F.getElevation(N[2],N[1]),q=F.getElevation(N[2],N[3]),X=F.getElevation(N[0],N[3]),te=F.isLeaf(N[0],N[1]),se=F.isLeaf(N[2],N[1]),ge=F.isLeaf(N[2],N[3]),me=F.isLeaf(N[0],N[3]),Ee=Math.min(H.min,K.min,q.min,X.min),Te=Math.max(H.max,K.max,q.max,X.max),xe=te&&se&&ge&&me;k.maximums.push(Te),k.minimums.push(Ee),k.leaves.push(Te-Ee<=5&&xe?1:0)}v.push(k)}return v}(this.dem),d=c.length-1,p=c[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(c,0,0,d,0)}raycastRoot(r,c,d,p,y,_,v=1){return SB([r,c,-100],[d,p,this.maximums[0]*v],y,_)}raycast(r,c,d,p,y,_,v=1){if(!this.nodeCount)return null;const T=this.raycastRoot(r,c,d,p,y,_,v);if(T==null)return null;const S=[],O=[],k=[],N=[],F=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:$,t:H,nodex:K,nodey:q,depth:X}=F.pop();if(this.leaves[$]){RB(K,q,X,r,c,d,p,k,N);const se=1<<X,ge=(K+0)/se,me=(K+1)/se,Ee=(q+0)/se,Te=(q+1)/se,xe=$p(ge,Ee,this.dem)*v,Oe=$p(me,Ee,this.dem)*v,Be=$p(me,Te,this.dem)*v,lt=$p(ge,Te,this.dem)*v,it=IB(k[0],k[1],xe,N[0],k[1],Oe,N[0],N[1],Be,y,_),st=IB(N[0],N[1],Be,k[0],N[1],lt,k[0],k[1],xe,y,_),_t=Math.min(it!==null?it:Number.MAX_VALUE,st!==null?st:Number.MAX_VALUE);if(_t!==Number.MAX_VALUE)return _t;{const gt=Bt([],y,_,H);if(kB(xe,Oe,lt,Be,PB(gt[0],k[0],N[0]),PB(gt[1],k[1],N[1]))>=gt[2])return H}continue}let te=0;for(let se=0;se<this._siblingOffset.length;se++){RB((K<<1)+this._siblingOffset[se][0],(q<<1)+this._siblingOffset[se][1],X+1,r,c,d,p,k,N),k[2]=-100,N[2]=this.maximums[this.childOffsets[$]+se]*v;const ge=SB(k,N,y,_);if(ge!=null){const me=ge;S[se]=me;let Ee=!1;for(let Te=0;Te<te&&!Ee;Te++)me>=S[O[Te]]&&(O.splice(Te,0,se),Ee=!0);Ee||(O[te]=se),te++}}for(let se=0;se<te;se++){const ge=O[se];F.push({idx:this.childOffsets[$]+ge,t:S[ge],nodex:(K<<1)+this._siblingOffset[ge][0],nodey:(q<<1)+this._siblingOffset[ge][1],depth:X+1})}}return null}_addNode(r,c,d){return this.minimums.push(r),this.maximums.push(c),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(r,c,d,p,y){if(r[p].isLeaf(c,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const _=p-1,v=r[_];let T=0,S=0;for(let O=0;O<this._siblingOffset.length;O++){const k=2*c+this._siblingOffset[O][0],N=2*d+this._siblingOffset[O][1],F=v.getElevation(k,N),$=v.isLeaf(k,N),H=this._addNode(F.min,F.max,$);$&&(T|=1<<O),S||(S=H)}for(let O=0;O<this._siblingOffset.length;O++)T&1<<O||this._construct(r,2*c+this._siblingOffset[O][0],2*d+this._siblingOffset[O][1],_,S+O)}}function kB(u,r,c,d,p,y){return xn(xn(u,c,y),xn(r,d,y),p)}function $p(u,r,c){const d=c.dim,p=ve(u*d-.5,0,d-1),y=ve(r*d-.5,0,d-1),_=Math.floor(p),v=Math.floor(y),T=Math.min(_+1,d-1),S=Math.min(v+1,d-1);return kB(c.get(_,v),c.get(T,v),c.get(_,S),c.get(T,S),p-_,y-v)}const Jte={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Qte(u,r,c){return(256*u*256+256*r+c)/10-1e4}function ene(u,r,c){return 256*u+r+c/256-32768}class O5{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,c,d,p=!1){if(this.uid=r,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void In(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const y=this.dim=c.height-2,_=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let T=0;T<y;T++)_[this._idx(-1,T)]=_[this._idx(0,T)],_[this._idx(y,T)]=_[this._idx(y-1,T)],_[this._idx(T,-1)]=_[this._idx(T,0)],_[this._idx(T,y)]=_[this._idx(T,y-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(y,-1)]=_[this._idx(y-1,0)],_[this._idx(-1,y)]=_[this._idx(0,y-1)],_[this._idx(y,y)]=_[this._idx(y-1,y-1)]}const v=d==="terrarium"?ene:Qte;for(let T=0;T<_.length;++T){const S=4*T;this.floatView[T]=v(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=ac.now()}_buildQuadTree(){this._tree=new OB(this)}get(r,c,d=!1){d&&(r=ve(r,-1,this.dim),c=ve(c,-1,this.dim));const p=this._idx(r,c);return this.floatView[p]}set(r,c,d){const p=this._idx(r,c),y=this.floatView[p];return this.floatView[p]=d,d-y}static getUnpackVector(r){return Jte[r]}_idx(r,c){if(r<-1||r>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(r+1)}static pack(r,c){const d=[0,0,0,0],p=O5.getUnpackVector(c);let y=Math.floor((r+p[3])/p[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new gM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,c,d){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=c*this.dim,y=c*this.dim+this.dim,_=d*this.dim,v=d*this.dim+this.dim;switch(c){case-1:p=y-1;break;case 1:y=p+1}switch(d){case-1:_=v-1;break;case 1:v=_+1}const T=-c*this.dim,S=-d*this.dim;for(let O=_;O<v;O++)for(let k=p;k<y;k++){const N=4*this._idx(k,O),F=4*this._idx(k+T,O+S);this.pixels[N+0]=r.pixels[F+0],this.pixels[N+1]=r.pixels[F+1],this.pixels[N+2]=r.pixels[F+2],this.pixels[N+3]=r.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function tne(u,r,c){u===1?r.headerLength=c.readFixed32():u===2?r.x=c.readVarint():u===3?r.y=c.readVarint():u===4?r.z=c.readVarint():u===5&&r.layers.push(function(d,p){return d.readFields(one,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(c,c.readVarint()+c.pos))}function nne(u,r,c){u===1?(r.delta_filter=function(d,p){return d.readFields(ine,{blockSize:0},p)}(c,c.readVarint()+c.pos),r.filter="delta_filter"):u===2?(c.readVarint(),r.filter="zigzag_filter"):u===3?(c.readVarint(),r.filter="bitshuffle_filter"):u===4&&(c.readVarint(),r.filter="byteshuffle_filter")}function ine(u,r,c){u===1&&(r.blockSize=c.readVarint())}function rne(u,r,c){u===1?(c.readVarint(),r.codec="gzip_data"):u===2?(c.readVarint(),r.codec="jpeg_image"):u===3?(c.readVarint(),r.codec="webp_image"):u===4&&(c.readVarint(),r.codec="png_image")}function sne(u,r,c){let d=0,p=0;u===1?r.firstByte=c.readFixed64():u===2?r.lastByte=c.readFixed64():u===3?r.filters.push(function(y,_){return y.readFields(nne,{},_)}(c,c.readVarint()+c.pos)):u===4?r.codec=function(y,_){return y.readFields(rne,{},_)}(c,c.readVarint()+c.pos):u===5?p=c.readFloat():u===6?d=c.readFloat():u===7?r.bands.push(c.readString()):u===8?r.offset=c.readDouble():u===9&&(r.scale=c.readDouble()),r.offset===0&&(r.offset=p),r.scale===0&&(r.scale=d)}function one(u,r,c){u===1?r.version=c.readVarint():u===2?r.name=c.readString():u===3?r.units=c.readString():u===4?r.tileSize=c.readVarint():u===5?r.buffer=c.readVarint():u===6?r.pixelFormat=c.readVarint():u===7&&r.dataIndex.push(function(d,p){return d.readFields(sne,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(c,c.readVarint()+c.pos))}function ane(u,r,c){if(u===2)(function(d,p,y){d.readFields(cne,y,p)})(c,c.readVarint()+c.pos,r);else if(u===3)throw new Error("Not implemented")}function cne(u,r,c){if(u===1){let d=0;const p=c.readVarint()+c.pos;for(;c.pos<p;)r[d++]=c.readVarint()}}function lne(u,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let c=r[3];for(let d=2;d>=1;d--){const p=d===1?1:0,y=d===2?1:0;for(let _=0;_<r[0];_++){const v=r[1]*_;for(let T=p;T<r[1];T++){const S=r[2]*(T+v);for(let O=y;O<r[2];O++){const k=r[3]*(O+S);for(let N=0;N<r[3];N++){const F=k+N;u[F]+=u[F-c]}}}}c*=r[d]}return u}function une(u){for(let r=0,c=u.length;r<c;r++)u[r]=u[r]>>>1^-(1&u[r]);return u}function dne(u,r){switch(r){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const d=u[c],p=u[c+1];u[c]=(240&d)>>4|(61440&d)>>8|(240&p)<<4|61440&p,u[c+1]=15&d|(3840&d)>>4|(15&p)<<8|(3840&p)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const d=u[c],p=u[c+1],y=u[c+2],_=u[c+3];u[c+0]=(192&d)>>6|(192&p)>>4|(192&y)>>2|192&_,u[c+1]=(48&d)>>4|(48&p)>>2|48&y|(48&_)<<2,u[c+2]=(12&d)>>2|12&p|(12&y)<<2|(12&_)<<4,u[c+3]=3&d|(3&p)<<2|(3&y)<<4|(3&_)<<6}return u;default:throw new Error(`Invalid pixel format, "${r}"`)}}Qt(O5,"DEMData"),Qt(OB,"DemMinMaxQuadTree",{omit:["dem"]});var Al=Uint8Array,ex=Uint16Array,hne=Int32Array,DB=new Al([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),NB=new Al([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fne=new Al([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MB=function(u,r){for(var c=new ex(31),d=0;d<31;++d)c[d]=r+=1<<u[d-1];var p=new hne(c[30]);for(d=1;d<30;++d)for(var y=c[d];y<c[d+1];++y)p[y]=y-c[d]<<5|d;return{b:c,r:p}},LB=MB(DB,2),BB=LB.b,pne=LB.r;BB[28]=258,pne[258]=28;for(var mne=MB(NB,0).b,FB=new ex(32768),gs=0;gs<32768;++gs){var i1=(43690&gs)>>1|(21845&gs)<<1;FB[gs]=((65280&(i1=(61680&(i1=(52428&i1)>>2|(13107&i1)<<2))>>4|(3855&i1)<<4))>>8|(255&i1)<<8)>>1}var tx=function(u,r,c){for(var d=u.length,p=0,y=new ex(r);p<d;++p)u[p]&&++y[u[p]-1];var _,v=new ex(r);for(p=1;p<r;++p)v[p]=v[p-1]+y[p-1]<<1;_=new ex(1<<r);var T=15-r;for(p=0;p<d;++p)if(u[p])for(var S=p<<4|u[p],O=r-u[p],k=v[u[p]-1]++<<O,N=k|(1<<O)-1;k<=N;++k)_[FB[k]>>T]=S;return _},nx=new Al(288);for(gs=0;gs<144;++gs)nx[gs]=8;for(gs=144;gs<256;++gs)nx[gs]=9;for(gs=256;gs<280;++gs)nx[gs]=7;for(gs=280;gs<288;++gs)nx[gs]=8;var $B=new Al(32);for(gs=0;gs<32;++gs)$B[gs]=5;var gne=tx(nx,9),yne=tx($B,5),I4=function(u){for(var r=u[0],c=1;c<u.length;++c)u[c]>r&&(r=u[c]);return r},Yu=function(u,r,c){var d=r/8|0;return(u[d]|u[d+1]<<8)>>(7&r)&c},P4=function(u,r){var c=r/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&r)},_ne=function(u){return(u+7)/8|0},wne=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Xu=function(u,r,c){var d=new Error(r||wne[u]);if(d.code=u,Error.captureStackTrace&&Error.captureStackTrace(d,Xu),!c)throw d;return d},bne=new Al(0),vne=typeof TextDecoder<"u"&&new TextDecoder;try{vne.decode(bne,{stream:!0})}catch{}const xne={gzip_data:"gzip"};class lu extends Error{constructor(r){super(r),this.name="MRTError"}}const Ene={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},zB={uint32:1,uint16:2,uint8:4},Cne={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let R4;class k5{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const c=this.layers[r];if(!c)throw new lu(`Layer '${r}' not found`);return c}getHeaderLength(r){const c=new Uint8Array(r),d=new DataView(r);if(c[0]!==13)throw new lu("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(r){const c=new Uint8Array(r),d=this.getHeaderLength(r);if(c.length<d)throw new lu(`Expected header with length >= ${d} but got buffer of length ${c.length}`);const p=new R4(c.subarray(0,d)).readFields(tne,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new lu(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const y of p.layers)this.layers[y.name]=new UB(y,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const c=[],d=this.getLayer(r.layerName);for(let p of r.blockIndices){const y=d.dataIndex[p],_=y.firstByte-r.firstByte,v=y.lastByte-r.firstByte;if(d._blocksInProgress.has(p))continue;const T={layerName:d.name,firstByte:_,lastByte:v,pixelFormat:d.pixelFormat,blockIndex:p,blockShape:[y.bands.length].concat(d.bandShape),buffer:d.buffer,codec:y.codec.codec,filters:y.filters.map(S=>S.filter)};d._blocksInProgress.add(p),c.push(T)}return new jB(c,()=>{c.forEach(p=>d._blocksInProgress.delete(p.blockIndex))},(p,y)=>{if(c.forEach(_=>d._blocksInProgress.delete(_.blockIndex)),p)throw p;y.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class UB{constructor({version:r,name:c,units:d,tileSize:p,pixelFormat:y,buffer:_,dataIndex:v},T){if(this.version=r,this.version!==1)throw new lu(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=c,this.units=d,this.tileSize=p,this.buffer=_,this.pixelFormat=Ene[y],this.dataIndex=v,this.bandShape=[p+2*_,p+2*_,zB[this.pixelFormat]],this._decodedBlocks=new R5(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return zB[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const c=r.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,r.data)}getBlockForBand(r){let c=0;switch(typeof r){case"string":for(const[d,p]of this.dataIndex.entries()){for(const[y,_]of p.bands.entries())if(_===r)return{bandIndex:c+y,blockIndex:d,blockBandIndex:y};c+=p.bands.length}break;case"number":for(const[d,p]of this.dataIndex.entries()){if(r>=c&&r<c+p.bands.length)return{bandIndex:r,blockIndex:d,blockBandIndex:r-c};c+=p.bands.length}break;default:throw new lu(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let c=1/0,d=-1/0;const p=[],y=new Set;for(const _ of r){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new lu(`Invalid band: ${JSON.stringify(_)}`);const T=this.dataIndex[v];p.includes(v)||p.push(v),y.add(v),c=Math.min(c,T.firstByte),d=Math.max(d,T.lastByte)}if(y.size>this.cacheSize)throw new lu(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:d,blockIndices:p}}hasBand(r){const{blockIndex:c}=this.getBlockForBand(r);return c>=0}hasDataForBand(r){const{blockIndex:c}=this.getBlockForBand(r);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(r){const{blockIndex:c,blockBandIndex:d}=this.getBlockForBand(r);if(c<0)throw new lu(`Band not found: ${JSON.stringify(r)}`);const p=this._decodedBlocks.get(c.toString());if(!p)throw new lu(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[c],_=this.bandShape.reduce((S,O)=>S*O,1),v=d*_,T=p.subarray(v,v+_);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}k5.setPbf=function(u){R4=u};class jB{constructor(r,c,d){this.tasks=r,this._onCancel=c,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,c){this._finalized||(this._onComplete(r,c),this._finalized=!0)}}k5.performDecoding=function(u,r){const c=new Uint8Array(u);return Promise.all(r.tasks.map(d=>{const{layerName:p,firstByte:y,lastByte:_,pixelFormat:v,blockShape:T,blockIndex:S,filters:O,codec:k}=d,N=c.subarray(y,_+1),F=new Uint32Array(T[0]*T[1]*T[2]);let $;if(k!=="gzip_data")throw new lu(`Unhandled codec: ${k}`);return $=function(H,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve((ge=function(Te){Te[0]==31&&Te[1]==139&&Te[2]==8||Xu(6,"invalid gzip data");var xe=Te[3],Oe=10;4&xe&&(Oe+=2+(Te[10]|Te[11]<<8));for(var Be=(xe>>3&1)+(xe>>4&1);Be>0;Be-=!Te[Oe++]);return Oe+(2&xe)}(q=H),ge+8>q.length&&Xu(6,"invalid gzip data"),function(Te,xe,Oe,Be){var lt=Te.length;if(!lt||xe.f&&!xe.l)return Oe||new Al(0);var it=!Oe,st=it||xe.i!=2,_t=xe.i;it&&(Oe=new Al(3*lt));var gt=function(Jo){var Jd=Oe.length;if(Jo>Jd){var Co=new Al(Math.max(2*Jd,Jo));Co.set(Oe),Oe=Co}},yt=xe.f||0,Qe=xe.p||0,bt=xe.b||0,pt=xe.l,vt=xe.d,wt=xe.m,Zt=xe.n,Kt=8*lt;do{if(!pt){yt=Yu(Te,Qe,1);var $t=Yu(Te,Qe+1,3);if(Qe+=3,!$t){var Ut=Te[(bi=_ne(Qe)+4)-4]|Te[bi-3]<<8,gn=bi+Ut;if(gn>lt){_t&&Xu(0);break}st&&gt(bt+Ut),Oe.set(Te.subarray(bi,gn),bt),xe.b=bt+=Ut,xe.p=Qe=8*gn,xe.f=yt;continue}if($t==1)pt=gne,vt=yne,wt=9,Zt=5;else if($t==2){var an=Yu(Te,Qe,31)+257,Wt=Yu(Te,Qe+10,15)+4,Rn=an+Yu(Te,Qe+5,31)+1;Qe+=14;for(var Qn=new Al(Rn),Ai=new Al(19),Xn=0;Xn<Wt;++Xn)Ai[fne[Xn]]=Yu(Te,Qe+3*Xn,7);Qe+=3*Wt;var ji=I4(Ai),pi=(1<<ji)-1,Br=tx(Ai,ji);for(Xn=0;Xn<Rn;){var bi,Bi=Br[Yu(Te,Qe,pi)];if(Qe+=15&Bi,(bi=Bi>>4)<16)Qn[Xn++]=bi;else{var ur=0,yr=0;for(bi==16?(yr=3+Yu(Te,Qe,3),Qe+=2,ur=Qn[Xn-1]):bi==17?(yr=3+Yu(Te,Qe,7),Qe+=3):bi==18&&(yr=11+Yu(Te,Qe,127),Qe+=7);yr--;)Qn[Xn++]=ur}}var _r=Qn.subarray(0,an),Fr=Qn.subarray(an);wt=I4(_r),Zt=I4(Fr),pt=tx(_r,wt),vt=tx(Fr,Zt)}else Xu(1);if(Qe>Kt){_t&&Xu(0);break}}st&&gt(bt+131072);for(var Ws=(1<<wt)-1,fo=(1<<Zt)-1,os=Qe;;os=Qe){var ys=(ur=pt[P4(Te,Qe)&Ws])>>4;if((Qe+=15&ur)>Kt){_t&&Xu(0);break}if(ur||Xu(2),ys<256)Oe[bt++]=ys;else{if(ys==256){os=Qe,pt=null;break}var Es=ys-254;ys>264&&(Es=Yu(Te,Qe,(1<<(Sr=DB[Xn=ys-257]))-1)+BB[Xn],Qe+=Sr);var qn=vt[P4(Te,Qe)&fo],wr=qn>>4;if(qn||Xu(3),Qe+=15&qn,Fr=mne[wr],wr>3){var Sr=NB[wr];Fr+=P4(Te,Qe)&(1<<Sr)-1,Qe+=Sr}if(Qe>Kt){_t&&Xu(0);break}st&&gt(bt+131072);var wc=bt+Es;if(bt<Fr){var Xo=0-Fr,Hs=Math.min(Fr,wc);for(Xo+bt<0&&Xu(3);bt<Hs;++bt)Oe[bt]=Be[Xo+bt]}for(;bt<wc;++bt)Oe[bt]=Oe[bt-Fr]}}xe.l=pt,xe.p=os,xe.b=bt,xe.f=yt,pt&&(yt=1,xe.m=wt,xe.d=vt,xe.n=Zt)}while(!yt);return bt!=Oe.length&&it?function(Jo,Jd,Co){return(Co==null||Co>Jo.length)&&(Co=Jo.length),new Al(Jo.subarray(0,Co))}(Oe,0,bt):Oe.subarray(0,bt)}(q.subarray(ge,-8),{i:2},new Al(((te=q)[(se=te.length)-4]|te[se-3]<<8|te[se-2]<<16|te[se-1]<<24)>>>0),X)));var q,X,te,se,ge;const me=xne[K];if(!me)throw new Error(`Unhandled codec: ${K}`);const Ee=new globalThis.DecompressionStream(me);return new Response(new Blob([H]).stream().pipeThrough(Ee)).arrayBuffer().then(Te=>new Uint8Array(Te))}(N,k).then(H=>(function(K,q){K.readFields(ane,q)}(new R4(H),F),new Cne[v](F.buffer))),$.then(H=>{for(let K=O.length-1;K>=0;K--)switch(O[K]){case"delta_filter":lne(H,T);break;case"zigzag_filter":une(H);break;case"bitshuffle_filter":dne(H,v);break;default:throw new lu(`Unhandled filter "${O[K]}"`)}return{layerName:p,blockIndex:S,data:H}}).catch(H=>{throw H})}))},Qt(jB,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Qt(k5,"MapboxRasterTile"),Qt(UB,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class VB{constructor(r){this._stringToNumber={},this._numberToString=[];for(let c=0;c<r.length;c++){const d=r[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class WB{constructor(r,c){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Yh(zt,16,0),this.featureIndexArray=new Wg,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,c,d,p,y,_=0,v=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,y,_);const S=this.grid;for(let O=0;O<c.length;O++){const k=c[O],N=[1/0,1/0,-1/0,-1/0];for(let F=0;F<k.length;F++){const $=k[F];N[0]=Math.min(N[0],$.x),N[1]=Math.min(N[1],$.y),N[2]=Math.max(N[2],$.x),N[3]=Math.max(N[3],$.y)}v!==0&&(N[0]-=v,N[1]-=v,N[2]+=v,N[3]+=v),N[0]<zt&&N[1]<zt&&N[2]>=0&&N[3]>=0&&S.insert(T,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ni(new l5(this.rawTileData)).layers,this.sourceLayerCoder=new VB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,c){const{tilespaceGeometry:d,transform:p,tileTransform:y,pixelPosMatrix:_,availableImages:v,worldview:T}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const S=c.queryRadius?c.queryRadius:0,O=d.bufferedTilespaceBounds,k=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,(H,K,q,X)=>au(d.bufferedTilespaceGeometry,H-S,K-S,q+S,X+S));k.sort(Tne);let N=null;p.elevation&&k.length>0&&(N=e1.create(p.elevation,this.tileID));const F={};let $;for(let H=0;H<k.length;H++){const K=k[H];if(K===$)continue;$=K;const q=this.featureIndexArray.get(K);let X=null;this.is3DTile?this.loadMatchingModelFeature(F,q,r,d,p,T):this.loadMatchingFeature(F,q,r,v,T,(te,se,ge,me=0)=>(X||(X=Cn(te,this.tileID.canonical,y)),se.queryIntersectsFeature(d,te,ge,X,this.z,p,_,N,me,c.scope)))}return F}loadMatchingFeature(r,c,d,p,y,_){const{featureIndex:v,bucketIndex:T,sourceLayerIndex:S,layoutVertexArrayOffset:O}=c,k=this.bucketLayerIDs[T],N=d.layers,F=Object.keys(N);if(F.length&&!Yn(F,k))return;const $=d.sourceCache,H=this.sourceLayerCoder.decode(S),K=this.vtLayers[H].feature(v),q=this.getId(K,H);for(let X=0;X<k.length;X++){const te=k[X];if(!N[te])continue;const{styleLayer:se,targets:ge}=N[te];let me={};q!==void 0&&(me=$.getFeatureState(se.sourceLayer,q));const Ee=!_||_(K,se,me,O);if(!Ee)continue;const Te=new r0(K,this.z,this.x,this.y,q);Te.tile=this.tileID.canonical,Te.state=me;let xe=this.serializedLayersCache.get(te);xe||(xe=se.serialize(),xe.id=te,this.serializedLayersCache.set(te,xe)),Te.source=xe.source,Te.sourceLayer=xe["source-layer"],Te.layer=Object.assign({},xe),Te.layer.paint=HB(xe.paint,se.paint,K,me,p),Te.layer.layout=HB(xe.layout,se.layout,K,me,p);let Oe=!1;for(const Be of ge){this.updateFeatureProperties(Te,Be);const{filter:lt}=Be;if(lt){if(K.properties=Te.properties,lt.needGeometry){const it=Vn(K,!0);if(!lt.filter(new Ui(this.tileID.overscaledZ,{worldview:y}),it,this.tileID.canonical))continue}else if(!lt.filter(new Ui(this.tileID.overscaledZ,{worldview:y}),K))continue}Oe=!0,Be.targetId&&this.addFeatureVariant(Te,Be)}Oe&&this.appendToResult(r,te,v,Te,Ee)}}loadMatchingModelFeature(r,c,d,p,y,_){const{featureIndex:v,bucketIndex:T}=c,S=this.bucketLayerIDs[T],O=d.layers,k=Object.keys(O);if(!k.length||Yn(k,S))for(let N=0;N<S.length;N++){const F=S[N],{styleLayer:$,targets:H}=O[F];if($.type!=="model")continue;const K=p.tile,q=K.getBucket($);if(!(q&&q instanceof A5))continue;const X=kte(q,v,p,y);if(!X)continue;const{z:te,x:se,y:ge}=K.tileID.canonical,{feature:me,intersectionZ:Ee,position:Te}=X;let xe={};me.id!==void 0&&(xe=d.sourceCache.getFeatureState($.sourceLayer,me.id));const Oe=new r0({},te,se,ge,me.id);Oe.tile=this.tileID.canonical,Oe.state=xe,Oe.properties=me.properties,Oe.geometry={type:"Point",coordinates:[Te.lng,Te.lat]};let Be=this.serializedLayersCache.get(F);Be||(Be=$.serialize(),Be.id=F,this.serializedLayersCache.set(F,Be)),Oe.source=Be.source,Oe.sourceLayer=Be["source-layer"],Oe.layer=Object.assign({},Be);let lt=!1;for(const it of H){this.updateFeatureProperties(Oe,it);const{filter:st}=it;if(st){if(me.properties=Oe.properties,st.needGeometry){if(!st.filter(new Ui(this.tileID.overscaledZ,{worldview:_}),me,this.tileID.canonical))continue}else if(!st.filter(new Ui(this.tileID.overscaledZ,{worldview:_}),me))continue}lt=!0,it.targetId&&this.addFeatureVariant(Oe,it)}lt&&this.appendToResult(r,F,v,Oe,Ee)}}updateFeatureProperties(r,c,d){if(c.properties){const p={};for(const y in c.properties){const _=c.properties[y].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,d);_!=null&&(p[y]=_)}r.properties=p}}addFeatureVariant(r,c,d){const p={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(p.properties=r.properties),r.variants=r.variants||{},r.variants[c.targetId]=r.variants[c.targetId]||[],r.variants[c.targetId].push(p)}appendToResult(r,c,d,p,y){let _=r[c];_===void 0&&(_=r[c]=[]),_.push({featureIndex:d,feature:p,intersectionZ:y})}lookupSymbolFeatures(r,c,d,p,y,_){const v={};this.loadVTLayers();for(const T of r)this.loadMatchingFeature(v,{bucketIndex:c,sourceLayerIndex:d,featureIndex:T,layoutVertexArrayOffset:0},p,y,_);return v}loadFeature(r){const{featureIndex:c,sourceLayerIndex:d}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(d),y=this.vtFeatures[p];if(y[c])return y[c];const _=this.vtLayers[p].feature(c);return y[c]=_,_}hasLayer(r){for(const c of this.bucketLayerIDs)for(const d of c)if(r===d)return!0;return!1}getId(r,c){let d=r.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const y=Ud(p);if(y.result!=="success"){const _=y.value.map(v=>`${v.key}: ${v.message}`).join(", ");return void In(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=y.value}d=this.promoteIdExpression.evaluate({zoom:0},r)}else d=r.properties[p];typeof d=="boolean"&&(d=Number(d))}return d}}function HB(u,r,c,d,p){return pn(u,(y,_)=>{const v=r instanceof Ho?r.get(_):null;return v&&v.evaluate?v.evaluate(c,d,void 0,p):v})}function Tne(u,r){return r-u}Qt(WB,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const GB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class O4{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,d]=new Uint8Array(r,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=d>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=GB[15&d];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(r,2,1),[v]=new Uint32Array(r,4,1);return new O4(v,_,y,r)}constructor(r,c=64,d=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=d,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const y=GB.indexOf(this.ArrayType),_=2*r*this.ArrayType.BYTES_PER_ELEMENT,v=r*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+v+T,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+T),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+v+T,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=r)}add(r,c){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=r,this.coords[this._pos++]=c,d}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return k4(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,c,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:v}=this,T=[0,y.length-1,0],S=[];for(;T.length;){const O=T.pop()||0,k=T.pop()||0,N=T.pop()||0;if(k-N<=v){for(let K=N;K<=k;K++){const q=_[2*K],X=_[2*K+1];q>=r&&q<=d&&X>=c&&X<=p&&S.push(y[K])}continue}const F=N+k>>1,$=_[2*F],H=_[2*F+1];$>=r&&$<=d&&H>=c&&H<=p&&S.push(y[F]),(O===0?r<=$:c<=H)&&(T.push(N),T.push(F-1),T.push(1-O)),(O===0?d>=$:p>=H)&&(T.push(F+1),T.push(k),T.push(1-O))}return S}within(r,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:_}=this,v=[0,p.length-1,0],T=[],S=d*d;for(;v.length;){const O=v.pop()||0,k=v.pop()||0,N=v.pop()||0;if(k-N<=_){for(let K=N;K<=k;K++)ZB(y[2*K],y[2*K+1],r,c)<=S&&T.push(p[K]);continue}const F=N+k>>1,$=y[2*F],H=y[2*F+1];ZB($,H,r,c)<=S&&T.push(p[F]),(O===0?r-d<=$:c-d<=H)&&(v.push(N),v.push(F-1),v.push(1-O)),(O===0?r+d>=$:c+d>=H)&&(v.push(F+1),v.push(k),v.push(1-O))}return T}}function k4(u,r,c,d,p,y){if(p-d<=c)return;const _=d+p>>1;qB(u,r,_,d,p,y),k4(u,r,c,d,_-1,1-y),k4(u,r,c,_+1,p,1-y)}function qB(u,r,c,d,p,y){for(;p>d;){if(p-d>600){const S=p-d+1,O=c-d+1,k=Math.log(S),N=.5*Math.exp(2*k/3),F=.5*Math.sqrt(k*N*(S-N)/S)*(O-S/2<0?-1:1);qB(u,r,c,Math.max(d,Math.floor(c-O*N/S+F)),Math.min(p,Math.floor(c+(S-O)*N/S+F)),y)}const _=r[2*c+y];let v=d,T=p;for(ix(u,r,d,c),r[2*p+y]>_&&ix(u,r,d,p);v<T;){for(ix(u,r,v,T),v++,T--;r[2*v+y]<_;)v++;for(;r[2*T+y]>_;)T--}r[2*d+y]===_?ix(u,r,d,T):(T++,ix(u,r,T,p)),T<=c&&(d=T+1),c<=T&&(p=T-1)}}function ix(u,r,c,d){D4(u,c,d),D4(r,2*c,2*d),D4(r,2*c+1,2*d+1)}function D4(u,r,c){const d=u[r];u[r]=u[c],u[c]=d}function ZB(u,r,c,d){const p=u-c,y=r-d;return p*p+y*y}s.$=rb,s.A=ma,s.B=Jh,s.C=2,s.D=j_,s.E=Uu,s.F=zv,s.G=yL,s.H=Ky,s.I=fa,s.J=dC,s.K=Pn,s.L=En,s.M=Nb,s.N=g_,s.O=H3,s.P=Tt,s.Q=Rg,s.R=ha,s.S=S_,s.T=U6,s.U=Ud,s.V=T5,s.W=w_,s.X=hp,s.Y=dp,s.Z=Eg,s._=ya,s.a=function(u){return fs.API_CDN_URL_REGEX.test(u)},s.a$=xt,s.a0=yg,s.a1=w3,s.a2=Jb,s.a3=class extends T5{},s.a4=y_,s.a5=Db,s.a6=Ke,s.a7=function(u){const r=u.value;return r?yg(r)?b4(r,!0)?[]:[new T5(u.key,r,`invalid url "${r}"`)]:[new T5(u.key,r,`string expected, "${Pn(r)}" found`)]:[]},s.a8=xp,s.a9=Tr,s.aA=ve,s.aB=oe,s.aC=zs,s.aD=J,s.aE=Ba,s.aF=Ze,s.aG=Mt,s.aH=function(u,r){const c={};for(let d=0;d<r.length;d++){const p=r[d];p in u&&(c[p]=u[p])}return c},s.aI=Ne,s.aJ=tt,s.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,r,c,d){const p=this.entries[u]=this.entries[u]||{callbacks:[]};if(p.result){const[y,_]=p.result;return this.scheduler?this.scheduler.add(()=>{d(y,_)},r):d(y,_),()=>{}}return p.callbacks.push(d),p.cancel||(p.cancel=c((y,_)=>{p.result=[y,_];for(const v of p.callbacks)this.scheduler?this.scheduler.add(()=>{v(y,_)},r):v(y,_);setTimeout(()=>delete this.entries[u],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==d),p.callbacks.length||(p.cancel(),delete this.entries[u]))}}},s.aL=function(u,r,c){const d=JSON.stringify(u.request);return u.data&&(this.deduped.entries[d]={result:[null,u.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},p=>{const y=dg(u.request,(_,v,T)=>{_?p(_):v&&p(null,{rawData:v,vectorTile:c?void 0:new Ni(new l5(v)),responseHeaders:new Map(T.entries())})});return()=>{y.cancel(),p()}},r)},s.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=lg,s.aO=function(u){Xl++,Xl>Yw&&(u.getActor().send("enforceCacheSizeLimit",f3),Xl=0)},s.aP=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},s.aQ=Yo,s.aR=YL,s.aS=nB,s.aT=ye,s.aU=KL,s.aV=function(u,r){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){r(null,c)};for(let d=0;d<u.length;d++){const p=document.createElement("source");RI(u[d])||(c.crossOrigin="Anonymous"),p.src=u[d],c.appendChild(p)}return{cancel:()=>{}}},s.aW=Mv,s.aX=s0,s.aY=Xt,s.aZ=Vv,s.a_=mt,s.aa=kt,s.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,r){return Nr(u.expression.evaluate(r))}interpolate(u,r,c){return{x:xn(u.x,r.x,c),y:xn(u.y,r.y,c),z:xn(u.z,r.z,c),azimuthal:xn(u.azimuthal,r.azimuthal,c),polar:xn(u.polar,r.polar,c)}}},s.ac=Ui,s.ad=Kh,s.ae=jt,s.af=ui,s.ag=re,s.ah=Ve,s.ai=Ho,s.aj=kp,s.ak=xn,s.al=zt,s.am=eb,s.an=_i,s.ao=Di,s.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,r){return function([c,d]){const p=Nr([1,c,d]);return{x:p.x,y:p.y,z:p.z}}(u.expression.evaluate(r))}interpolate(u,r,c){return{x:xn(u.x,r.x,c),y:xn(u.y,r.y,c),z:xn(u.z,r.z,c)}}},s.aq=function(u,r,c=0,d=!0){const p=new Tt(c,c),y=u.sub(p),_=r.add(p),v=[y,new Tt(_.x,y.y),_,new Tt(y.x,_.y)];return d&&v.push(y.clone()),v},s.ar=function(u,r){const c=[];for(let d=0;d<u.length;d++){const p=et(d-1,-1,u.length-1),y=et(d+1,-1,u.length-1),_=u[d],v=u[y],T=u[p].sub(_).unit(),S=v.sub(_).unit(),O=S.angleWithSep(T.x,T.y),k=T.add(S).unit().mult(-1*r/Math.sin(O/2));c.push(_.add(k))}return c},s.as=NL,s.at=au,s.au=function(u,r,c=0){return le(((r.x-c)*u.scale-u.x)*zt,(r.y*u.scale-u.y)*zt,Xe(r.z,r.y))},s.av=xr,s.aw=sn,s.ax=Ki,s.ay=G9,s.az=function(u){let r=1/0,c=1/0,d=-1/0,p=-1/0;for(const y of u)r=Math.min(r,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return{min:new Tt(r,c),max:new Tt(d,p)}},s.b=function(u){return fs.API_FONTS_REGEX.test(u)},s.b$=jM,s.b0=ms,s.b1=qu,s.b2=It,s.b3=bC,s.b4=v5,s.b5=function(){Cl.isLoading()||Cl.isLoaded()||Kb()!=="deferred"||Yb()},s.b6=Qb,s.b7=Vn,s.b8=r0,s.b9=dr,s.bA=G,s.bB=ke,s.bC=z,s.bD=function(u,r){const{x:c,y:d}=u.point,p=iM(c,d,u.worldSize/u._pixelsPerMercatorPixel,0,0);return oe(p,p,l6(Kd(r)))},s.bE=A,s.bF=Xs,s.bG=Yt,s.bH=Bt,s.bI=ai,s.bJ=_n,s.bK=K_,s.bL=_c,s.bM=r4,s.bN=function(u,r,c,d,p){const y=5*r+2;u.float32[y+0]=c,u.float32[y+1]=d,u.float32[y+2]=p},s.bO=Q_,s.bP=zo,s.bQ=vl,s.bR=Zl,s.bS=cr,s.bT=et,s.bU=function(u,r,c,d){var p=new x(4);return p[0]=u,p[1]=r,p[2]=c,p[3]=d,p},s.bV=class{isDataAvailableAtPoint(u){const r=this._source();if(this.isUsingMockSource()||!r||u.y<0||u.y>1)return!1;const c=r.getSource().maxzoom,d=1<<c,p=Math.floor(u.x),y=Math.floor((u.x-p)*d),_=Math.floor(u.y*d),v=this.findDEMTileFor(new Yo(c,p,c,y,_));return!(!v||!v.dem)}getAtPointOrZero(u,r=0){return this.getAtPoint(u,r)||0}getAtPoint(u,r,c=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const d=this._source();if(!d||u.y<0||u.y>1)return r;const p=d.getSource().maxzoom,y=1<<p,_=Math.floor(u.x),v=u.x-_,T=new Yo(p,_,p,Math.floor(v*y),Math.floor(u.y*y)),S=this.findDEMTileFor(T);if(!S||!S.dem)return r;const O=S.dem,k=1<<S.tileID.canonical.z,N=(v*k-S.tileID.canonical.x)*O.dim,F=(u.y*k-S.tileID.canonical.y)*O.dim,$=Math.floor(N),H=Math.floor(F);return(c?this.exaggeration():1)*xn(xn(O.get($,H),O.get($,H+1),F-H),xn(O.get($+1,H),O.get($+1,H+1),F-H),N-$)}static getAtTileOffset(u,r,c,d){const p=1<<u.canonical.z;return d?d.pointElevation(r):c?c.getAtPointOrZero(new jt(u.wrap+(u.canonical.x+r.x/zt)/p,(u.canonical.y+r.y/zt)/p)):0}static getAtTileOffsetFunc(u,r,c,d){return(p,y,_)=>{const v=this.getAtTileOffset(u,p,y,_),T=d.upVector(u.canonical,p.x,p.y);return Dt(T,T,v*d.upVectorScale(u.canonical,r,c).metersToTile),T}}getForTilePoints(u,r,c,d){if(this.isUsingMockSource())return!1;const p=e1.create(this,u,d);return!!p&&(r.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(u);if(!r||!r.dem)return null;const c=r.dem.tree,d=r.tileID,p=1<<u.canonical.z-d.canonical.z;let y=u.canonical.x/p-d.canonical.x,_=u.canonical.y/p-d.canonical.y,v=0;for(let T=0;T<u.canonical.z-d.canonical.z&&!c.leaves[v];T++){y*=2,_*=2;const S=2*Math.floor(_)+Math.floor(y);v=c.childOffsets[v]+S,y%=1,_%=1}return{min:this.exaggeration()*c.minimums[v],max:this.exaggeration()*c.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,r,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let r=!1,c=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const p of u){const y=this.getMinMaxForTile(p.tileID);y&&(c=Math.min(c,y.min),d=Math.max(d,y.max),r=!0)}return r?{min:c,max:d}:null}},s.bW=JC,s.bX=gr,s.bY=ks,s.bZ=FM,s.b_=iB,s.ba=Y6,s.bb=A6,s.bc=Cn,s.bd=qd,s.be=Ug,s.bf=XN,s.bg=hr,s.bh=F_,s.bi=y4,s.bj=function(u,r){const c=kp(r.zoom);if(c===0)return Kd(u);const d=FC(u),p=c6(d),y=Ze(d.getWest())*r.worldSize,_=Ze(d.getEast())*r.worldSize,v=tt(d.getNorth())*r.worldSize,T=tt(d.getSouth())*r.worldSize,S=[y,v,0],O=[_,v,0],k=[y,T,0],N=[_,T,0],F=ne([],r.globeMatrix);return ui(S,S,F),ui(O,O,F),ui(k,k,F),ui(N,N,F),p[0]=nf(p[0],k,c),p[1]=nf(p[1],N,c),p[2]=nf(p[2],O,c),p[3]=nf(p[3],S,c),Ri.fromPoints(p)},s.bk=zC,s.bl=ne,s.bm=yv,s.bn=nf,s.bo=Gu,s.bp=BJ,s.bq=Ue,s.br=Q,s.bs=k5,s.bt=l5,s.bu=dg,s.bv=function(u,r){const c=[];for(const d in u)d in r||c.push(d);return c},s.bw=Ge,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=bo,s.bz=U,s.c=vo,s.c$=function(u,r,c){let d=0;for(let p=0;p<2;++p)u[p]>0&&(d+=(u[p]-0)*(u[p]-0)),r[p]<0&&(d+=(0-r[p])*(0-r[p]));return d},s.c0=VM,s.c1=t4,s.c2=TL,s.c3=l4,s.c4=O4,s.c5=Dt,s.c6=Ra,s.c7=co,s.c8=function(u,r,c){c*=.5;var d=r[0],p=r[1],y=r[2],_=r[3],v=Math.sin(c),T=Math.cos(c);return u[0]=d*T+p*v,u[1]=p*T-d*v,u[2]=y*T+_*v,u[3]=_*T-y*v,u},s.c9=Fc,s.cA=je,s.cB=Rs,s.cC=O9,s.cD=Kg,s.cE=eM,s.cF=function(u,r,c,d,p,y,_,v,T){if(T.name==="globe")return eM(u,r,new Kg(c,d,p),!1);const S=Vv({z:c,x:d,y:p},T);return new Ri([(y+S.x/S.scale)*r,r*(S.y/S.scale),_],[(y+S.x2/S.scale)*r,r*(S.y2/S.scale),v])},s.cG=function(u,r,c){return u[0]=Math.min(r[0],c[0]),u[1]=Math.min(r[1],c[1]),u[2]=Math.min(r[2],c[2]),u[3]=Math.min(r[3],c[3]),u},s.cH=function(u,r,c){return u[0]=Math.max(r[0],c[0]),u[1]=Math.max(r[1],c[1]),u[2]=Math.max(r[2],c[2]),u[3]=Math.max(r[3],c[3]),u},s.cI=function(u){const r=Math.round((u+45+360)%360/90)%4;return ee[r]},s.cJ=Me,s.cK=oc,s.cL=6,s.cM=function(u){const r=G(new Float64Array(16));oe(r,u.pixelMatrix,u.globeMatrix);const c=[0,fe,0],d=[0,ce,0];return ui(c,c,r),ui(d,d,r),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!d6(u,new ye(u.center.lat,90)),d[0]>0&&d[0]<=u.width&&d[1]>0&&d[1]<=u.height&&!d6(u,new ye(u.center.lat,-90))]},s.cN=function(u,r){const{scale:c}=u.tileTransform,d=c*zt/(u.tileSize*Math.pow(2,r.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(p,y,_){var v=y[1],T=y[2],S=y[3],O=_[0],k=_[1];return p[0]=y[0]*O,p[1]=v*O,p[2]=T*k,p[3]=S*k,p}(new Float32Array(4),r.inverseAdjustmentMatrix,[d,d])},s.cO=i5,s.cP=ct,s.cQ=R9,s.cR=function(u){const r=R9(u,!0);return A([],[r[0],r[1],r[4],r[5]])},s.cS=de,s.cT=Ar,s.cU=he,s.cV=function(u){const{x:r,y:c}=u.point,{lng:d,lat:p}=u._center;return iM(r,c,u.worldSize,d,p)},s.cW=He,s.cX=qe,s.cY=B_,s.cZ=cu,s.c_=5,s.ca=mr,s.cb=function(u,r){return u[0]=-r[0],u[1]=-r[1],u[2]=-r[2],u[3]=r[3],u},s.cc=ft,s.cd=function(u,r,c,d,p){var y=1/Math.tan(r/2);if(u[0]=y/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=y,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,p!=null&&p!==1/0){var _=1/(d-p);u[10]=(p+d)*_,u[14]=2*p*d*_}else u[10]=-1,u[14]=-2*d;return u},s.ce=function(u,r,c,d,p,y,_){var v=1/(r-c),T=1/(d-p),S=1/(y-_);return u[0]=-2*v,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*T,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*S,u[11]=0,u[12]=(r+c)*v,u[13]=(p+d)*T,u[14]=(_+y)*S,u[15]=1,u},s.cf=Je,s.cg=function(u,r,c){u[4*r+0]=c[0],u[4*r+1]=c[1],u[4*r+2]=c[2],u[4*r+3]=c[3]},s.ch=fc,s.ci=qg,s.cj=Xr,s.ck=pc,s.cl=Pp,s.cm=$L,s.cn=function(){var u=new x(4);return x!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},s.co=function(u,r,c){var d=r[0],p=r[1],y=r[2],_=r[3],v=Math.sin(c),T=Math.cos(c);return u[0]=d*T+y*v,u[1]=p*T+_*v,u[2]=d*-v+y*T,u[3]=p*-v+_*T,u},s.cp=function(u,r){return u[0]===r[0]&&u[1]===r[1]&&u[2]===r[2]&&u[3]===r[3]},s.cq=la,s.cr=function(u){var r=u[0],c=u[1],d=u[2],p=u[3];return Math.sqrt(r*r+c*c+d*d+p*p)},s.cs=Lu,s.ct=$s,s.cu=YN,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=er,s.d=function(u){return fs.API_TILEJSON_REGEX.test(u)},s.d$=class{constructor(u,r,c,d){this.context=u,this.format=d,this.size=c,this.texture=u.gl.createTexture();const[p,y,_]=this.size,{gl:v}=u;v.bindTexture(v.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,p,y,_,0,$6(this.format),z6(this.format),r.data)}bind(u,r){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_3D,this.texture),u!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,u),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,u),this.minFilter=u),r!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},s.d0=function(u){return u*u*u*u*u},s.d1=We,s.d2=45,s.d3=M_,s.d4=function(u,r,c){const d=Math.sqrt(u*u+r*r+c*c),p=d>0?Math.acos(c/d)*Oa:0;let y=u!==0||r!==0?Math.atan2(-r,-u)*Oa+90:0;return y<0&&(y+=360),[d,y,p]},s.d5=le,s.d6=Nr,s.d7=Rt,s.d8=Le,s.d9=Ri,s.dA=function(u){return u({pluginStatus:Wo,pluginURL:Hd}),Zb.on("pluginStateChange",u),u},s.dB=MC,s.dC=class extends Tl{constructor(u){super(u),this.current=WN}set(u,r,c){if(this.fetchUniformLocation(u,r)){for(let d=0;d<9;d++)if(c[d]!==this.current[d]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},s.dD=ae,s.dE=function(u,r,c){const d=kp(c.zoom),p=u.style.map._antialias,y=u.terrain&&u.terrain.exaggeration()>0;return d===0&&!p&&!y},s.dF=function(u){const r=u.pixelsPerMeter,c=r/Je(1,u.center.lat),d=G(new Float64Array(16));return Q(d,d,[u.point.x,u.point.y,0]),de(d,d,[c,c,r]),Float32Array.from(d)},s.dG=FC,s.dH=function(u){const r=80.051129;u=ve(u,-80.051129,r)/r*90;const c=Math.pow(Math.abs(Math.sin(_i(u))),3);return Math.round(c*(pe.length-1))},s.dI=function(u,r,c,d){const p=r.getNorth(),y=r.getSouth(),_=r.getWest(),v=r.getEast(),T=1<<u.z,S=v-_,O=p-y,k=S/ie,N=-O/pe[c],F=[0,k,0,N,0,0,p,_,0];if(u.z>0){const $=180/d;M(F,F,[$/S+1,0,0,0,$/O+1,0,-.5*$/k,.5*$/N,1])}return F[2]=T,F[5]=u.x,F[8]=u.y,F},s.dJ=Kd,s.dK=function(u,r,c){const d=G(new Float64Array(16)),p=(r/(1<<u)-.5)*Math.PI*2;return Ie(d,c.globeMatrix,p),Float32Array.from(d)},s.dL=gM,s.dM=BC,s.dN=function(u,r){return[Math.pow(u[0],2.2)*r,Math.pow(u[1],2.2)*r,Math.pow(u[2],2.2)*r]},s.dO=P,s.dP=function(u,r){var c=Math.sin(r),d=Math.cos(r);return u[0]=d,u[1]=c,u[2]=0,u[3]=-c,u[4]=d,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},s.dQ=Yr,s.dR=nM,s.dS=Pr,s.dT=Qs,s.dU=_4,s.dV=function(u,r){const c=[0,0,0];return ui(c,c,zC(Kd(r.canonical))),ui(c,c,u),c},s.dW=u=>({u_matrix:new Pp(u),u_texsize:new pc(u),u_pixels_to_tile_units:new a(u),u_device_pixel_ratio:new Xr(u),u_width_scale:new Xr(u),u_floor_width_scale:new Xr(u),u_image:new fc(u),u_units_to_pixels:new pc(u),u_tile_units_to_pixels:new Xr(u),u_alpha_discard_threshold:new Xr(u),u_trim_offset:new pc(u),u_trim_fade_range:new pc(u),u_trim_gradient_mix_range:new pc(u),u_trim_color:new M_(u),u_zbias_factor:new Xr(u),u_tile_to_meter:new Xr(u),u_ground_shadow_factor:new qg(u),u_pattern_transition:new Xr(u)}),s.dX=u=>({u_matrix:new Pp(u),u_pixels_to_tile_units:new a(u),u_device_pixel_ratio:new Xr(u),u_width_scale:new Xr(u),u_floor_width_scale:new Xr(u),u_units_to_pixels:new pc(u),u_dash_image:new fc(u),u_gradient_image:new fc(u),u_image_height:new Xr(u),u_texsize:new pc(u),u_tile_units_to_pixels:new Xr(u),u_alpha_discard_threshold:new Xr(u),u_trim_offset:new pc(u),u_trim_fade_range:new pc(u),u_trim_gradient_mix_range:new pc(u),u_trim_color:new M_(u),u_zbias_factor:new Xr(u),u_tile_to_meter:new Xr(u),u_ground_shadow_factor:new qg(u)}),s.dY=u=>({u_camera_to_center_distance:new Xr(u),u_extrude_scale:new a(u),u_device_pixel_ratio:new Xr(u),u_matrix:new Pp(u),u_inv_rot_matrix:new Pp(u),u_merc_center:new pc(u),u_tile_id:new qg(u),u_zoom_transition:new Xr(u),u_up_dir:new qg(u),u_emissive_strength:new Xr(u)}),s.dZ=R_,s.d_=Lee,s.da=De,s.db=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},s.dc=P9,s.dd=q6,s.de=N9,s.df=b4,s.dg=function(u,r){return u.readFields(Nte,{icons:[]},r)},s.dh=QC,s.di=Y_,s.dj=o4,s.dk=ug,s.dl=cC,s.dm=cg,s.dn=rp,s.dp=$n,s.dq=function(u){const r=u.indexOf(Bg);return r>=0?u.slice(0,r):u},s.dr=function(u){return u.indexOf(Bg)>=0},s.ds=function(u){const r=u.lastIndexOf(Bg);return r>=0?u.slice(r+1):""},s.dt=function(u){const r=[],c=u.id;return c===void 0&&r.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&r.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&r.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),r},s.du=function(u,r,c,d){return u.type==="custom"?new Ite(u,r):new Dte[u.type](u,r,c,d)},s.dv=bn,s.dw=function(u){const r=u.indexOf(Bg);return r>=0?u.slice(r+1):""},s.dx=class extends r0{constructor(u,r){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},s.dy=Zb,s.dz=$u,s.e=fs,s.e$=Ae,s.e0=oM,s.e1=(u,r,c,d,p,y)=>{const _=u.transform,v=_.projection.name==="globe";let T;if(y.paint.get("circle-pitch-alignment")==="map")if(v){const O=nM(_.zoom,r.canonical)*_._pixelsPerMercatorPixel;T=Float32Array.from([O,0,0,O])}else T=_.calculatePixelsToTileUnitsMatrix(c);else T=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(_.projection),u_matrix:u.translatePosMatrix(r.projMatrix,c,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ac.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:jJ,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(v){S.u_inv_rot_matrix=d,S.u_merc_center=p,S.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],S.u_zoom_transition=kp(_.zoom);const O=p[0]*zt,k=p[1]*zt;S.u_up_dir=_.projection.upVector(new Kg(0,0,0),O,k)}return S},s.e2=Y9,s.e3=ga,s.e4=(u,r,c,d,p,y,_,v,T,S)=>{const O=u.transform,k=O.pitch<15?q9(.07,.7,ve((14-O.zoom)/5,0,1)):.07,N=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:K9(u,r,c,d),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:p,u_width_scale:y,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:Z9(r,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:c.lut).toArray01(),u_zbias_factor:k,u_tile_to_meter:Rt(r.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:S}},s.e5=(u,r,c,d,p,y,_,v,T,S)=>{const O=u.transform,k=O.calculatePixelsToTileUnitsMatrix(r),N=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",F=O.pitch<15?q9(.07,.7,ve((14-O.zoom)/5,0,1)):.07;return{u_matrix:K9(u,r,c,d),u_pixels_to_tile_units:k,u_device_pixel_ratio:y,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:X9(c)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Z9(r,u.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:c.lut).toArray01(),u_zbias_factor:F,u_tile_to_meter:Rt(r.tileID.canonical,0),u_ground_shadow_factor:S}},s.e6=At,s.e7=_v,s.e8=Xe,s.e9=MJ,s.eA=function(u,r){var c=2*Math.acos(r[3]),d=Math.sin(c/2);return d>w?(u[0]=r[0]/d,u[1]=r[1]/d,u[2]=r[2]/d):(u[0]=1,u[1]=0,u[2]=0),c},s.eB=E4,s.eC=o5,s.eD=s5,s.eE=[1,1,1],s.eF=e1,s.eG=Lo,s.eH=function(u,r,c,d){var p=r[0],y=r[1],_=r[2],v=r[3];return u[0]=p+d*(c[0]-p),u[1]=y+d*(c[1]-y),u[2]=_+d*(c[2]-_),u[3]=v+d*(c[3]-v),u},s.eI=G_,s.eJ=hc,s.eK=ef,s.eL=function(u,r,c,d,p,y,_,v,T,S,O,k,N,F,$,H){var K=new x(16);return K[0]=u,K[1]=r,K[2]=c,K[3]=d,K[4]=p,K[5]=y,K[6]=_,K[7]=v,K[8]=T,K[9]=S,K[10]=O,K[11]=k,K[12]=N,K[13]=F,K[14]=$,K[15]=H,K},s.eM=Se,s.eN=zg,s.eO=dv,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Tt(1/0,1/0),max:new Tt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,r=!1){const c=zM(new Tt(0,0),new Tt(zt,zt),u),d=[];if(r&&!S6(c,this._globalClipBounds))return d;for(const p of this._activeRegions){if(p.hiddenByOverlap||!S6(c,p))continue;const y=CQ(p.min,p.max,u);d.push({min:y.min,max:y.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return d}setSources(u){this._setSources(u.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const c=[];for(const d of r.cache.getVisibleCoordinates()){const p=r.cache.getTile(d).buckets[r.layer];p&&p.updateFootprints(d.toUnwrapped(),c)}return c},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(u){const r=u.getFootprints();if(r.length===0)return;const c=u.getOrder(),d=u.getClipMask(),p=u.getClipScope();for(const y of r){if(!y.footprint)continue;const _=zM(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:c,clipMask:d,clipScope:p})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,c)=>r.priority-c.priority||ZC(r.min,c.min)||ZC(r.max,c.max)||r.order-c.order||r.clipMask-c.clipMask||function(d,p){const y=(_,v)=>_+v;return d.length-p.length||d.reduce(y,"").localeCompare(p.reduce(y,""))}(r.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let r=0;for(;!u&&r!==this._activeRegions.length;){const c=this._activeRegions[r],d=this._prevRegions[r];u=c.priority!==d.priority||!$M(c,d)||c.order!==d.order||c.clipMask!==d.clipMask||!bo(c.clipScope,d.clipScope),this._activeRegions[r].hiddenByOverlap=d.hiddenByOverlap,++r}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==Av&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const r=c=>{const d=this._activeRegions;if(c>=d.length)return c;const p=d[c].priority;for(;c<d.length&&d[c].priority===p;)++c;return c};if(this._sourceIds.length>1){let c=0,d=r(c);for(;c!==d;){let p=c;const y=c;for(;p!==d;){const _=this._activeRegions[p];_.hiddenByOverlap=!1;for(let v=0;v<y;v++){const T=this._activeRegions[v];if(!T.hiddenByOverlap&&_.order===Av&&S6(_,T)&&(_.hiddenByOverlap=UM(_.footprint,_.tileId,T.footprint,T.tileId),_.hiddenByOverlap))break}++p}c=d,d=r(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=u.length-1;r>=0;r--)this._addSource(u[r]);this._computeReplacement()}},s.eQ=Av,s.eR=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,r){const c=new qd,d=new ms,p=[],y=u+1+2,_=r[0]+1,v=r[0]+1+(1+r.length),T=(S,O,k)=>{let N=S===y-1?S-2:S===0?S:S-1;return N+=k?24575:0,[N,O]};for(let S=0;S<y;++S)c.emplaceBack(...T(S,0,!0));for(let S=0;S<_;++S)for(let O=0;O<y;++O)c.emplaceBack(...T(O,S,(O===0||O===y-1)&&!0));for(let S=0;S<r.length;++S){const O=r[S];for(let k=0;k<y;++k)c.emplaceBack(...T(k,O,!0))}for(let S=0;S<r.length;++S){const O=d.length,k=r[S]+1+2,N=new ms;for(let H=0;H<k-1;H++){const K=H===k-2,q=K?y*(v-r.length+S-H):y;for(let X=0;X<y-1;X++){const te=H*y+X;H===0||K||X===0||X===y-2?(N.emplaceBack(te+1,te,te+q),N.emplaceBack(te+q,te+q+1,te+1)):(d.emplaceBack(te+1,te,te+q),d.emplaceBack(te+q,te+q+1,te+1))}}const F=hr.simpleSegment(0,O,c.length,d.length-O);for(let H=0;H<N.uint16.length;H+=3)d.emplaceBack(N.uint16[H],N.uint16[H+1],N.uint16[H+2]);const $=hr.simpleSegment(0,O,c.length,d.length-O);p.push({withoutSkirts:F,withSkirts:$})}return{vertices:c,indices:d,segments:p}}_createGrid(u){const r=this._fillGridMeshWithLods(ie,pe);this._gridSegments=r.segments,this._gridBuffer=u.createVertexBuffer(r.vertices,XN.members),this._gridIndexBuffer=u.createIndexBuffer(r.indices,!0)}_createPoles(u){const r=new ms;for(let _=0;_<=ie;_++)r.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=u.createIndexBuffer(r,!0);const c=new Qh,d=new Qh,p=new Qh,y=new Qh;this._poleSegments=[];for(let _=0,v=0;_<5;_++){const T=360/(1<<_);c.emplaceBack(0,-J,0,.5,0),d.emplaceBack(0,-J,0,.5,1),p.emplaceBack(0,-J,0,.5,.5),y.emplaceBack(0,-J,0,.5,.5);for(let S=0;S<=ie;S++){let O=S/ie,k=0;const N=xn(0,T,O),[F,$,H]=Re(zJ,UJ,N,J);c.emplaceBack(F,$,H,O,k),d.emplaceBack(F,$,H,O,1-k);const K=_i(N);O=.5+.5*Math.sin(K),k=.5+.5*Math.cos(K),p.emplaceBack(F,$,H,O,k),y.emplaceBack(F,$,H,O,1-k)}this._poleSegments.push(hr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,LC,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(d,LC,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(p,LC,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(y,LC,!1)}getGridBuffers(u,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},s.eS=EQ,s.eT=_e,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=$e,s.eW=St,s.eX=function(u,r,c){return u[0]=r[0]/c[0],u[1]=r[1]/c[1],u[2]=r[2]/c[2],u},s.eY=_l,s.eZ=Ce,s.e_=mn,s.ea=XC,s.eb=t9,s.ec=sf,s.ed=450,s.ee=7,s.ef=nt,s.eg=function(u,r){if(u===r){var c=r[1],d=r[2],p=r[3],y=r[6],_=r[7],v=r[11];u[1]=r[4],u[2]=r[8],u[3]=r[12],u[4]=c,u[6]=r[9],u[7]=r[13],u[8]=d,u[9]=y,u[11]=r[14],u[12]=p,u[13]=_,u[14]=v}else u[0]=r[0],u[1]=r[4],u[2]=r[8],u[3]=r[12],u[4]=r[1],u[5]=r[5],u[6]=r[9],u[7]=r[13],u[8]=r[2],u[9]=r[6],u[10]=r[10],u[11]=r[14],u[12]=r[3],u[13]=r[7],u[14]=r[11],u[15]=r[15];return u},s.eh=Ste,s.ei=ii,s.ej=pv,s.ek=256,s.el=l6,s.em=Wc,s.en=Ie,s.eo=function(u,r){return u[0]=r[0],u[1]=r[1],u[2]=r[2],u[3]=r[4],u[4]=r[5],u[5]=r[6],u[6]=r[8],u[7]=r[9],u[8]=r[10],u},s.ep=Qh,s.eq=U3,s.er=D_,s.es=function(u,r,c,d,p){return ve((u-r)/(c-r)*(p-d)+d,d,p)},s.et=wl,s.eu=function(u,r){var c=r[0],d=r[1],p=r[2],y=r[3],_=r[4],v=r[5],T=r[6],S=r[7],O=r[8],k=O*_-v*S,N=-O*y+v*T,F=S*y-_*T,$=c*k+d*N+p*F;return $?(u[0]=k*($=1/$),u[1]=(-O*d+p*S)*$,u[2]=(v*d-p*_)*$,u[3]=N*$,u[4]=(O*c-p*T)*$,u[5]=(-v*c+p*y)*$,u[6]=F*$,u[7]=(-S*c+d*T)*$,u[8]=(_*c-d*y)*$,u):null},s.ev=2,s.ew=oi,s.ex=ts,s.ey=ht,s.ez=function(u,r){var c=new x(3);ht(c,r);var d=1/c[0],p=1/c[1],y=1/c[2],_=r[0]*d,v=r[1]*p,T=r[2]*y,S=r[4]*d,O=r[5]*p,k=r[6]*y,N=r[8]*d,F=r[9]*p,$=r[10]*y,H=_+O+$,K=0;return H>0?(K=2*Math.sqrt(H+1),u[3]=.25*K,u[0]=(k-F)/K,u[1]=(N-T)/K,u[2]=(v-S)/K):_>O&&_>$?(K=2*Math.sqrt(1+_-O-$),u[3]=(k-F)/K,u[0]=.25*K,u[1]=(v+S)/K,u[2]=(N+T)/K):O>$?(K=2*Math.sqrt(1+O-_-$),u[3]=(N-T)/K,u[0]=(v+S)/K,u[1]=.25*K,u[2]=(k+F)/K):(K=2*Math.sqrt(1+$-_-O),u[3]=(v-S)/K,u[0]=(N+T)/K,u[1]=(k+F)/K,u[2]=.25*K),u},s.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(r,c)=>String.fromCharCode(+("0x"+c))))},s.f0=function([u,r,c]){const d=Math.hypot(u,r,c),p=Math.atan2(u,c),y=.5*Math.PI-Math.acos(-r/d);return new ye(qe(p),qe(y))},s.f1=Bo,s.f2=j6,s.f3=function(u){const r=u.navigator?u.navigator.userAgent:null;return!!function(c){if(fi==null){const d=c.navigator?c.navigator.userAgent:null;fi=!!c.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return fi}(u)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(u,r){f3=u,Yw=r},s.f5=d6,s.f6=rM,s.f7=function(u){const r=[0,0,0],c=G(new Float64Array(16));return oe(c,u.pixelMatrix,u.globeMatrix),ui(r,r,c),new Tt(r[0],r[1])},s.f8=function(){const u=kv;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(D6),kv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){QC().acquire(D6)},s.fA=O5,s.fB=ci,s.fC=function(u){let r=0;if(new Uint32Array(u,0,1)[0]!==C9){const c=new Uint32Array(u,0,7),[,,d,p,y,_]=c;r=c.byteLength+p+y+_+y,(d!==u.byteLength||r>=u.byteLength)&&In("Invalid b3dm header information.")}return I9(u,r)},s.fD=function(u,r){const c=q6(u);for(const d of c){for(const p of d.meshes)ree(p);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(see(d.lights,r)))}return c},s.fE=A5,s.fF=Mr,s.fG=f9,s.fH=Cl,s.fI=_a,s.fJ=function(u){lc(),js!=null&&js.then(r=>{r.keys().then(c=>{for(let d=0;d<c.length-u;d++)r.delete(c[d]).catch(p=>In(p.message))}).catch(c=>In(c.message))}).catch(r=>In(r.message))},s.fa=Kb,s.fb=function(u,r,c=!1){if(Wo===_a.deferred||Wo===_a.loading||Wo===_a.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Hd=ac.resolveURL(u),Wo=_a.deferred,Wd=r,qb(),c||Yb()},s.fc=function(u){V_=ac.resolveURL(u),W_||(W_=new j_(QC(),new Uu)),W_.broadcast("setMeshoptUrl",V_)},s.fd=g9,s.fe=function(u){L6=ac.resolveURL(u),W_||(W_=new j_(QC(),new Uu)),W_.broadcast("setDracoUrl",L6)},s.ff=m9,s.fg=Ov,s.fh=function(u){const r=Fu();if(!r)return;const c=r.delete(h3);u&&c.then(()=>u()).catch(u)},s.fi=Jg,s.fj=Qt,s.fk=Dp,s.fl=2,s.fm=VB,s.fn=WB,s.fo=V9,s.fp=li,s.fq="hd_road_elevation",s.fr=Zo,s.fs=pn,s.ft=rf,s.fu=s4,s.fv=1,s.fw=function(u,r,c,d,p,y,_,v=1,T,S,O,k){u.createArrays(),u.tilePixelRatio=zt/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const N=u.layers[0].layout,F=u.layers[0]._unevaluatedLayout._values,$={};$.scaleFactor=v,$.textSizeScaleRange=N.get("text-size-scale-range"),$.iconSizeScaleRange=N.get("icon-size-scale-range");const[H,K]=$.textSizeScaleRange,[q,X]=$.iconSizeScaleRange;$.textScaleFactor=ve($.scaleFactor,H,K),$.iconScaleFactor=ve($.scaleFactor,q,X);const te=F["text-size"],se=F["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:Oe,maxZoom:Be}=u.textSizeData;$.compositeTextSizes=[te.possiblyEvaluate(new Ui(Oe,{worldview:O}),y),te.possiblyEvaluate(new Ui(Be,{worldview:O}),y)]}if(u.iconSizeData.kind==="composite"){const{minZoom:Oe,maxZoom:Be}=u.iconSizeData;$.compositeIconSizes=[se.possiblyEvaluate(new Ui(Oe,{worldview:O}),y,k),se.possiblyEvaluate(new Ui(Be,{worldview:O}),y,k)]}$.layoutTextSize=te.possiblyEvaluate(new Ui(_+1,{worldview:O}),y),$.layoutIconSize=se.possiblyEvaluate(new Ui(_+1,{worldview:O}),y,k),$.textMaxSize=te.possiblyEvaluate(new Ui(18,{worldview:O}),y);const ge=N.get("symbol-placement"),me=N.get("text-rotation-alignment")==="map"&&ge!=="point",Ee=N.get("text-size");let Te=!1;const xe=[];for(const Oe of u.features){const Be=N.get("text-font").evaluate(Oe,{},y).join(","),lt=Ee.evaluate(Oe,{},y)*$.textScaleFactor,it=$.layoutTextSize.evaluate(Oe,{},y)*$.textScaleFactor,st=$.layoutIconSize.evaluate(Oe,{},y,k)*$.iconScaleFactor,_t={horizontal:{},vertical:void 0},gt=Oe.text;let yt,Qe=[0,0];if(gt){const pi=gt.toString(),Br=N.get("text-letter-spacing").evaluate(Oe,{},y)*ks,bi=N.get("text-line-height").evaluate(Oe,{},y)*ks,Bi=JI(pi)?Br:0,ur=N.get("text-anchor").evaluate(Oe,{},y),yr=N.get("text-variable-anchor");if(!yr){const os=N.get("text-radial-offset").evaluate(Oe,{},y);if(os)Qe=TL(ur,[os*ks,c4]);else{const ys=N.get("text-offset").evaluate(Oe,{},y);Qe=[ys[0]*ks,ys[1]*ks]}}let _r=me?"center":N.get("text-justify").evaluate(Oe,{},y);const Fr=ge==="point",Ws=Fr?N.get("text-max-width").evaluate(Oe,{},y)*ks:1/0,fo=os=>{u.allowVerticalPlacement&&Hb(pi)&&(_t.vertical=e4(gt,r,c,p,Be,Ws,bi,ur,os,Bi,Qe,_c.vertical,!0,it,lt,T))};if(!me&&yr){const os=_r==="auto"?yr.map(Es=>l4(Es)):[_r];let ys=!1;for(let Es=0;Es<os.length;Es++){const qn=os[Es];if(!_t.horizontal[qn])if(ys)_t.horizontal[qn]=_t.horizontal[0];else{const wr=e4(gt,r,c,p,Be,Ws,bi,"center",qn,Bi,Qe,_c.horizontal,!1,it,lt,T);wr&&(_t.horizontal[qn]=wr,ys=wr.positionedLines.length===1)}}fo("left")}else{if(_r==="auto"&&(_r=l4(ur)),Fr||N.get("text-writing-mode").indexOf("horizontal")>=0||!Hb(pi)){const os=e4(gt,r,c,p,Be,Ws,bi,ur,_r,Bi,Qe,_c.horizontal,!1,it,lt,T);os&&(_t.horizontal[_r]=os)}fo(Fr?"left":_r)}}let bt,pt,vt,wt,Zt,Kt,$t=!1;const Ut=N.get("icon-text-fit").evaluate(Oe,{},y);if(Oe.icon&&Oe.icon.hasPrimary()){const pi=jv(Oe.icon,u.iconSizeData,F["icon-size"],y,u.zoom,Oe,T,$.iconScaleFactor,O,k);bt=pi.iconPrimary,vt=pi.iconSecondary;const Br=bt.toString();if(pt=d.get(Br),pt&&(Zt=N.get("icon-offset").evaluate(Oe,{},y),Kt=N.get("icon-anchor").evaluate(Oe,{},y),yt=d5(p.get(Br),vt?p.get(vt.toString()):void 0,Zt,Kt),$t=pt.sdf,u.sdfIcons===void 0?u.sdfIcons=pt.sdf:u.sdfIcons!==pt.sdf&&In("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==u.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),vt){const bi=vt.toString();wt=d.get(bi)}}Te=Te||!(!Oe.icon||!Oe.icon.hasSecondary());const gn=g5(_t.horizontal)||_t.vertical;u.iconsInText||(u.iconsInText=!!gn&&gn.iconsInText);const an=it*$.textScaleFactor/ks,{defaultShapedIcon:Wt,verticallyShapedIcon:Rn}=fte(u,yt,N,Oe,y,_t,an,Zt,Ut);Ut!=="none"&&yt&&(lL(yt)||uL(yt))&&(m5(0,pt,bt,yt,Wt,Ut,S,d,p),m5(0,wt,vt,yt,Wt,Ut,S,d,p),Rn&&(m5(0,pt,bt,yt,Rn,Ut,S,d,p),m5(0,wt,vt,yt,Rn,Ut,S,d,p))),yt=Wt;const{iconBBox:Qn,iconVerticalBBox:Ai,textBBox:Xn,textVerticalBBox:ji}=cte(u,yt,Rn,N,Oe,y,st,Zt,$,p,Kt,_t,it,Qe,k);xe.push({feature:Oe,shapedTextOrientations:_t,shapedText:gn,shapedIcon:yt,iconPrimary:bt,iconSecondary:vt,iconOffset:Zt,iconAnchor:Kt,verticallyShapedIcon:Rn,layoutTextSize:it,layoutIconSize:st,textOffset:Qe,isSDFIcon:$t,iconTextFit:Ut,iconCollisionBounds:Qn,iconVerticalCollisionBounds:Ai,textCollisionBounds:Xn,textVerticalCollisionBounds:ji})}return{featureData:xe,sizes:$,hasAnySecondaryIcon:Te,textAlongLine:me,symbolPlacement:ge}},s.fx=_L,s.fy=function(u,r,c,d,p,y,_,v,T,S){u.iconAtlasPositions=S.iconPositions;const{featureData:O,hasAnySecondaryIcon:k,sizes:N,textAlongLine:F,symbolPlacement:$}=r;for(const H of O){const{shapedIcon:K,verticallyShapedIcon:q,feature:X,shapedTextOrientations:te,shapedText:se,layoutTextSize:ge,textOffset:me,isSDFIcon:Ee,iconPrimary:Te,iconSecondary:xe,iconTextFit:Oe,iconOffset:Be,iconCollisionBounds:lt,iconVerticalCollisionBounds:it,textCollisionBounds:st}=H;PL(K,S.iconPositions,Te,xe),PL(q,S.iconPositions,Te,xe),hte(te,S.iconPositions),dte(Te,xe,S.iconPositions),(se||K)&&pte(u,X,te,K,q,T,N,ge,0,me,Ee,d,p,_,v,k,Oe,Be,F,$,lt,it,st)}c&&u.generateCollisionDebugBuffers(y,u.collisionBoxArray,N.textScaleFactor)},s.fz=Ni,s.g=function(u,r){return $u(Object.assign(u,{method:"GET"}),r)},s.h=function(u){return u.indexOf("mapbox:")===0},s.i=function(u){return fs.API_STYLE_REGEX.test(u)&&!vo(u)},s.j=Pd,s.k=tp,s.l=function(u){return decodeURIComponent(atob(u).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(u,r){return $u(Object.assign(u,{type:"json"}),r)},s.n=jy,s.o=ac,s.p=function(u,r){return $u(Object.assign(u,{method:"POST"}),r)},s.q=ho,s.r=$h,s.s=function(u){try{const r=self[u];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return N6||(N6=new Jg("ImageRasterizer")),N6},s.u=function(){return function u(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},s.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},s.w=In,s.x=S4,s.y=pg,s.z=zu}),l(["./shared"],function(s){function w(qe){const ee=qe?qe.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function x(qe){if(typeof qe=="number"||typeof qe=="boolean"||typeof qe=="string"||qe==null)return JSON.stringify(qe);if(Array.isArray(qe)){let ae="[";for(const _e of qe)ae+=`${x(_e)},`;return`${ae}]`}let ee="{";for(const ae of Object.keys(qe).sort())ee+=`${ae}:${x(qe[ae])},`;return`${ee}}`}function A(qe){let ee="";for(const ae of s.bx)ee+=`/${x(qe[ae])}`;return ee}function P(qe,ee){return function ae(_e){return typeof _e=="string"&&_e===ee||(Array.isArray(_e)?_e.some(ae):!(!_e||typeof _e!="object")&&Object.values(_e).some(ae))}(qe)}class D{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,ae){this._layerConfigs={},this._layers={},this.update(ee,[],ae)}update(ee,ae,_e){this._options=_e;for(const ve of ee)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=s.du(ve,this.scope,null,this._options)).compileFilter(_e),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of ae)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const $e=function(ve,Ve){const et={};for(let rt=0;rt<ve.length;rt++){const It=ve[rt];let At=Ve&&Ve[It.id];At||(It.type==="symbol"?At=It.id:(At=A(It),It.type==="line"&&It.paint&&P(It.paint["line-width"],"line-progress")&&(At+=`/${x(It.paint["line-width"])}`))),Ve&&(Ve[It.id]=At);let Xt=et[At];Xt||(Xt=et[At]=[]),Xt.push(It)}const Ge=[];for(const rt in et)Ge.push(et[rt]);return Ge}(Object.values(this._layerConfigs),this.keyCache);for(const ve of $e){const Ve=ve.map(Xt=>this._layers[Xt.id]),et=Ve[0];if(et.visibility==="none")continue;const Ge=et.source||"";let rt=this.familiesBySource[Ge];rt||(rt=this.familiesBySource[Ge]={});const It=et.sourceLayer||"_geojsonTileLayer";let At=rt[It];At||(At=rt[It]=[]),At.push(Ve)}}}const M=1*s.fl;class z{constructor(ee){const ae={},_e=[];for(const et in ee){const Ge=ee[et],rt=ae[et]={};for(const It in Ge.glyphs){const At=Ge.glyphs[+It];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const Xt=At.metrics.localGlyph?M:1,pn={x:0,y:0,w:At.bitmap.width+2*Xt,h:At.bitmap.height+2*Xt};_e.push(pn),rt[It]=pn}}const{w:$e,h:ve}=s.G(_e),Ve=new s.fk({width:$e||1,height:ve||1});for(const et in ee){const Ge=ee[et];for(const rt in Ge.glyphs){const It=Ge.glyphs[+rt];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const At=ae[et][rt],Xt=It.metrics.localGlyph?M:1;s.fk.copy(It.bitmap,Ve,{x:0,y:0},{x:At.x+Xt,y:At.y+Xt},It.bitmap)}}this.image=Ve,this.positions=ae}}function U(qe,ee,ae){qe[ee]?ae&&(qe[ee].center=ae):qe[ee]={floorIds:new Set,center:ae||[0,0],floors:{}}}function G(qe,ee,ae,_e){for(const $e of ee)U(qe,$e),qe[$e].floors[ae]=_e,qe[$e].floorIds.add(ae)}function ne(qe){return{id:qe.properties.id.toString(),center:qe.properties.center.toString().split(";").map(Number)}}function oe(qe){return{id:qe.properties.id.toString(),isDefault:!!qe.properties.is_default&&qe.properties.is_default,connections:qe.properties.connected_floor_ids?new Set(qe.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:qe.properties.conflicted_floor_ids?new Set(qe.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:qe.properties.building_ids?new Set(qe.properties.building_ids.toString().split(";")):new Set,name:qe.properties.name.toString(),zIndex:qe.properties.z_index}}function Q(qe,ee){return ee.every(ae=>qe.properties&&qe.properties[ae]!=null)}function de(qe){return Q(qe,["type","id","name"])&&qe.properties.type==="building"}function he(qe){return Q(qe,["type","id","name","z_index"])&&qe.properties.type==="floor"}s.fj(z,"GlyphAtlas");class Ie{constructor(ee){this.tileID=new s.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=s.aZ(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor,this.worldview=ee.worldview,this.indoor=ee.indoor}parse(ee,ae,_e,$e,ve,Ve){this.status="parsing",this.data=ee,this.collisionBoxArray=new s.b3;const et=new s.fm(Object.keys(ee.layers).sort()),Ge=new s.fn(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const rt={},It=new s.fo(256,256),At={featureIndex:Ge,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:It,availableImages:_e,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const $n=this.indoor.indoorState.activeFloorsVisible,Yn=function(kn,In,tr){const ss=function(dr,fi){if(!dr)return s.w("No source layers defined in indoor specification"),fi;if(dr.size===0)return fi;const mr=dr.difference(fi);for(const Wi of mr)s.w(`Missing source layer required in indoor specification: ${Wi}`);return fi.intersection(fi)}(In.sourceLayers,new Set(Object.keys(kn.layers))),Nr=In.indoorState,Mr=function(dr,fi,mr,Wi){const Hi=new Set,Pr=new Set,Qs=new Set,Us=new Map,fs={},Pd=vo=>{const ka=Us.get(vo)||new Set;for(const zc of Hi)if((Us.get(zc)||new Set).has(vo)||ka.has(zc))return!0;return!1};for(const vo of fi){const ka=dr.layers[vo];if(ka)for(let zc=0;zc<ka.length;zc++){const xl=ka.feature(zc);if(de(xl)){const{id:Da,center:Uo}=ne(xl);U(fs,Da,Uo),Hi.add(Da);continue}if(he(xl)){const{id:Da,isDefault:Uo,connections:Bu,conflicts:$h,buildings:ac,name:ag,zIndex:cg}=oe(xl);G(fs,ac,Da,{name:ag,zIndex:cg}),Us.set(Da,$h),(Da===Wi||Bu.has(Wi))&&Hi.add(Da),Pr.add(Da),Uo&&Qs.add(Da)}}else s.w(`indoor source layer not found: ${vo}`)}if(mr)for(const vo of mr)Pr.has(vo)&&(Pd(vo)||Hi.add(vo));for(const vo of Qs)Hi.has(vo)||Pd(vo)||Hi.add(vo);return{buildings:fs,activeFloors:Hi}}(kn,ss,Nr.lastActiveFloors,Nr.selectedFloorId);return tr.send("setIndoorData",Mr),Mr}(ee,this.indoor,ve);At.activeFloors=$n?Yn.activeFloors:void 0}const Xt=[],pn=ae.familiesBySource[this.source];for(const $n in pn){const Yn=ee.layers[$n];if(!Yn)continue;let kn=!1,In=!1,tr=!1;for(const fi of pn[$n])fi[0].type==="symbol"?kn=!0:In=!0,fi[0].is3D()&&fi[0].type!=="model"&&(tr=!0);if(this.extraShadowCaster&&!tr||this.isSymbolTile===!0&&!kn||this.isSymbolTile===!1&&!In)continue;Yn.version===1&&s.w(`Vector tile source "${this.source}" layer "${$n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ss=et.encode($n),Nr=[],Mr=this.localizableLayerIds&&this.localizableLayerIds.has($n);let dr=!1;for(let fi=0,mr=0;fi<Yn.length;fi++){const Wi=Yn.feature(fi),Hi=Ge.getId(Wi,$n),Pr=Wi.properties?Wi.properties.worldview:null;if(Mr&&this.worldview&&typeof Pr=="string")if(Pr==="all")Wi.properties.$localized=!0;else{if(!Pr.split(",").includes(this.worldview))continue;Wi.properties.$localized=!0,Wi.properties.worldview=this.worldview}!dr&&Wi.properties&&Wi.properties.hasOwnProperty(s.fp)&&(dr=!0),Nr.push({feature:Wi,id:Hi,index:mr,sourceLayerIndex:ss}),mr++}dr&&!At.elevationFeatures&&ee.layers.hasOwnProperty(s.fq)&&(At.elevationFeatures=s.fr.parseFrom(ee.layers[s.fq],this.canonical));for(const fi of pn[$n]){const mr=fi[0];if(this.extraShadowCaster&&(!mr.is3D()||mr.type==="model")||this.isSymbolTile!==void 0&&mr.type==="symbol"!==this.isSymbolTile||mr.minzoom&&this.zoom<Math.floor(mr.minzoom)||mr.maxzoom&&this.zoom>=mr.maxzoom||mr.visibility==="none")continue;ke(fi,this.zoom,At.brightness,_e,this.worldview);const Wi=rt[mr.id]=mr.createBucket({index:Ge.bucketLayerIDs.length,layers:fi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ss,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:$e,worldview:this.worldview,localizable:Mr,availableImages:_e});Ge.bucketLayerIDs.push(fi.map(Pr=>s.B(Pr.id,Pr.scope)));let Hi=Wi.prepare?Wi.prepare():null;Hi!=null?(Hi=Hi.then(()=>Wi.populate(Nr,At,this.tileID.canonical,this.tileTransform)),Xt.push(Hi)):Wi.populate(Nr,At,this.tileID.canonical,this.tileTransform)}}const bn=()=>{let $n,Yn,kn,In,tr,ss;It.trim();const Nr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Mr=()=>{if($n)return this.status="done",Ve($n);if(this.extraShadowCaster)this.status="done",Ve(null,{buckets:Object.values(rt).filter(fi=>!fi.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:At.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yn&&kn&&In){const fi=new z(Yn),mr=new Map;for(const[Pr,Qs]of kn.entries()){const{imagePosition:Us}=s.fu(Pr,Qs,s.fv);mr.set(Pr,Us)}const Wi={};for(const Pr in rt){const Qs=rt[Pr];Qs instanceof s.b4&&(ke(Qs.layers,this.zoom,At.brightness,_e,this.worldview),Wi[Pr]=s.fw(Qs,Yn,fi.positions,kn,mr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,tr,this.worldview,_e))}const Hi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,kn,tr,()=>{Hi.iconsPending=!1,dr(Wi,fi,Hi)}),this.rasterizeIfNeeded(ve,In,ss,()=>{Hi.patternsPending=!1,dr(Wi,fi,Hi)})}},dr=(fi,mr,Wi,Hi)=>{if(Wi.iconsPending||Wi.patternsPending)return;const Pr=new s.fx(kn,In,this.lut);for(const Qs in rt){const Us=rt[Qs];if(Qs in fi)s.fy(Us,fi[Qs],this.showCollisionBoxes,_e,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,kn,Pr);else if(Us.hasPattern&&(Us instanceof s.ba||Us instanceof s.bb||Us instanceof s.ea)){ke(Us.layers,this.zoom,At.brightness,_e,this.worldview);const fs=Object.fromEntries(Pr.patternPositions);Us.addFeatures(At,this.tileID.canonical,fs,_e,this.tileTransform,this.brightness)}}this.status="done",Ve(null,{buckets:Object.values(rt).filter(Qs=>!Qs.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mr.image,lineAtlas:It,imageAtlas:Pr,brightness:At.brightness})};if(!this.extraShadowCaster){const fi=s.fs(At.glyphDependencies,Hi=>Object.keys(Hi).map(Number));Object.keys(fi).length?ve.send("getGlyphs",{uid:this.uid,stacks:fi},(Hi,Pr)=>{$n||($n=Hi,Yn=Pr,Mr())},void 0,!1,Nr):Yn={};const mr=Array.from(At.iconDependencies.keys()).map(Hi=>s.I.parse(Hi));mr.length?ve.send("getImages",{images:mr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Hi,Pr)=>{$n||($n=Hi,kn=new Map,tr=this.updateImageMapAndGetImageTaskQueue(kn,Pr,At.iconDependencies),Mr())},void 0,!1,Nr):(kn=new Map,tr=new Map);const Wi=Array.from(At.patternDependencies.keys()).map(Hi=>s.I.parse(Hi));Wi.length?ve.send("getImages",{images:Wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Hi,Pr)=>{$n||($n=Hi,In=new Map,ss=this.updateImageMapAndGetImageTaskQueue(In,Pr,At.patternDependencies),Mr())},void 0,!1,Nr):(In=new Map,ss=new Map)}if(At.elevationFeatures&&At.elevationFeatures.length>0){const fi=[];for(const Wi of Object.values(rt))if(Wi instanceof s.bb){const Hi=Wi.getUnevaluatedPortalGraph();Hi&&fi.push(Hi)}const mr=s.ft.evaluate(fi);for(const Wi of Object.values(rt))if(Wi instanceof s.bb){const Hi=ee.layers[et.decode(Wi.sourceLayerIndex)];Wi.setEvaluatedPortalGraph(mr,Hi,this.tileID.canonical,At.availableImages,At.brightness)}}Mr()};Xt.length>0?Promise.allSettled(Xt).then(bn).catch(Ve):bn()}updateParameters(ee){this.scaleFactor=ee.scaleFactor,this.showCollisionBoxes=ee.showCollisionBoxes,this.projection=ee.projection,this.brightness=ee.brightness,this.tileTransform=s.aZ(ee.tileID.canonical,ee.projection),this.extraShadowCaster=ee.extraShadowCaster,this.lut=ee.lut,this.worldview=ee.worldview,this.indoor=ee.indoor}rasterizeIfNeeded(ee,ae,_e,$e){Array.from(ae.values()).some(ve=>ve.usvg)?this.rasterize(ee,ae,_e,$e):$e()}updateImageMapAndGetImageTaskQueue(ee,ae,_e){const $e=new Map;for(const ve of ae.keys()){const Ve=_e.get(ve)||[];for(const et of Ve){const Ge=et.toString(),rt=ae.get(et.id.toString());rt.usvg?$e.has(Ge)||($e.set(Ge,et),ee.set(Ge,Object.assign({},rt))):ee.set(Ge,rt)}}return $e}rasterize(ee,ae,_e,$e){this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,tasks:_e},(ve,Ve)=>{if(!ve)for(const[et,Ge]of Ve.entries()){const rt=Object.assign(ae.get(et),{data:Ge});ae.set(et,rt)}$e()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ke(qe,ee,ae,_e,$e){const ve=new s.ac(ee,{brightness:ae,worldview:$e});for(const Ve of qe)Ve.recalculate(ve,_e)}class Ue extends s.E{constructor(ee,ae,_e,$e,ve,Ve,et){super(),this.actor=ee,this.layerIndex=ae,this.availableImages=_e,this.availableModels=$e,this.loadVectorData=Ve||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ee.scheduler),this.isSpriteLoaded=ve,this.scheduler=ee.scheduler,this.brightness=et}loadTile(ee,ae){const _e=ee.uid,$e=ee&&ee.request,ve=$e&&$e.collectResourceTiming,Ve=this.loading[_e]=new Ie(ee);Ve.abort=this.loadVectorData(ee,(et,Ge)=>{const rt=!this.loading[_e];if(delete this.loading[_e],Ve.cancelRasterize(),rt||et||!Ge)return Ve.status="done",rt||(this.loaded[_e]=Ve),ae(et);const It=Ge.rawData,At={},Xt=s.aM(Ge.responseHeaders);Xt&&Xt.expires&&(At.expires=Xt.expires),Xt&&Xt.cacheControl&&(At.cacheControl=Xt.cacheControl),Ve.vectorTile=Ge.vectorTile||new s.fz(new s.bt(It));const pn=()=>{Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(bn,$n)=>{if(bn||!$n)return ae(bn);const Yn={};if(ve){const kn=w($e);kn.length>0&&(Yn.resourceTiming=JSON.parse(JSON.stringify(kn)))}ae(null,Object.assign({rawTileData:It.slice(0),responseHeaders:Ge.responseHeaders},$n,At,Yn))})};this.isSpriteLoaded?pn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(pn,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):pn()}),this.loaded=this.loaded||{},this.loaded[_e]=Ve})}reloadTile(ee,ae){const _e=this.loaded,$e=ee.uid;if(_e&&_e[$e]){const ve=_e[$e];ve.updateParameters(ee);const Ve=(et,Ge)=>{const rt=ve.reloadCallback;rt&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,rt)),ae(et,Ge)};ve.status==="parsing"?ve.reloadCallback=Ve:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve):Ve())}else ae(null,void 0)}abortTile(ee,ae){const _e=ee.uid,$e=this.loading[_e];$e&&($e.abort&&$e.abort(),delete this.loading[_e]),ae()}removeTile(ee,ae){const _e=this.loaded,$e=ee.uid;_e&&_e[$e]&&delete _e[$e],ae()}}class ze{loadTile(ee,ae){const{uid:_e,encoding:$e,rawImageData:ve,padding:Ve}=ee,et=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Ve):ve;ae(null,new s.fA(_e,et,$e,Ve<1))}reloadTile(ee,ae){ae(null,null)}abortTile(ee,ae){ae()}removeTile(ee,ae){ae()}getImageData(ee,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const _e=this.offscreenCanvasContext.getImageData(-ae,-ae,ee.width+2*ae,ee.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}s.bs.setPbf(s.bt);class ht{constructor(ee){this._mrt=new s.bs(ee.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ee.uid,this.tileID=ee.tileID,this.source=ee.source}parse(ee,ae){const _e=this._mrt;this.status="parsing",this._entireBuffer=ee;try{_e.parseHeader(ee),this._isHeaderLoaded=!0;const $e=[];for(const ve in _e.layers){const Ve=_e.getLayer(ve),et=Ve.getDataRange(Ve.getBandList()),Ge=_e.createDecodingTask(et),rt=ee.slice(et.firstByte,et.lastByte+1),It=s.bs.performDecoding(rt,Ge).then(At=>Ge.complete(null,At)).catch(At=>Ge.complete(At,null));$e.push(It)}Promise.allSettled($e).then(()=>ae(null,_e)).catch(ve=>ae(ve))}catch($e){ae($e)}}}class ft{constructor(ee){this.actor=ee,this.loading={},this.loaded={}}loadTile(ee,ae){const _e=ee.uid,$e=ee.request,ve=this.loading[_e]=new ht(ee),{cancel:Ve}=s.bu($e,(et,Ge,rt)=>{const It=!this.loading[_e];if(delete this.loading[_e],It||et||!Ge)return ve.status="done",It||(this.loaded[_e]=ve),ae(et);ve.parse(Ge,(At,Xt)=>{if(At||!Xt)return ae(At);ae(null,Xt,rt)}),this.loaded[_e]=ve});ve.abort=Ve}reloadTile(ee,ae){ae(null,void 0)}abortTile(ee,ae){const _e=ee.uid,$e=this.loading[_e];$e&&($e.abort&&$e.abort(),delete this.loading[_e]),ae()}removeTile(ee,ae){const _e=ee.uid;this.loaded[_e]&&delete this.loaded[_e],ae()}decodeRasterArray(ee,ae){s.bs.performDecoding(ee.buffer,ee.task).then(_e=>ae(null,_e)).catch(_e=>ae(_e))}}const ct=s.fB.prototype.toGeoJSON;class je{constructor(ee){this._feature=ee,this.extent=s.al,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ae of this._feature.geometry)ee.push([new s.P(ae[0],ae[1])]);return ee}{const ee=[];for(const ae of this._feature.geometry){const _e=[];for(const $e of ae)_e.push(new s.P($e[0],$e[1]));ee.push(_e)}return ee}}toGeoJSON(ee,ae,_e){return ct.call(this,ee,ae,_e)}}class Ye{constructor(ee,ae){this.name=ee,this.extent=s.al,this.length=ae.length,this._jsonFeatures=ae}feature(ee){return new je(this._jsonFeatures[ee])}}class re{constructor(ee){this.layers={},this.extent=s.al;for(const ae of Object.keys(ee))this.layers[ae]=new Ye(ae,ee[ae])}}const le=64/4096;class Ae{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],ae){for(const _e of ee){const $e=_e.id;if($e==null)continue;let ve=this.features.get($e);ve&&this.updateCache(ve,ae),_e.geometry?(ve=De(_e),this.updateCache(ve,ae),this.features.set($e,ve)):this.features.delete($e),this.updateCache(ve,ae)}}updateCache(ee,ae){for(const{canonical:_e,uid:$e}of Object.values(ae)){const{z:ve,x:Ve,y:et}=_e;Le(ee,Math.pow(2,ve),Ve,et)&&delete ae[$e]}}getTile(ee,ae,_e){const $e=Math.pow(2,ee),ve=[];for(const Ve of this.features.values())Le(Ve,$e,ae,_e)&&ve.push(Dt(Ve,$e,ae,_e));return{features:ve}}getFeatures(){return[...this.features.values()]}}function Le({minX:qe,minY:ee,maxX:ae,maxY:_e},$e,ve,Ve){return qe<(ve+1+le)/$e&&ee<(Ve+1+le)/$e&&ae>(ve-le)/$e&&_e>(Ve-le)/$e}function De(qe){const{id:ee,geometry:ae,properties:_e}=qe;if(!ae)return;if(ae.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:$e,coordinates:ve}=ae,Ve={id:ee,type:1,geometry:[],tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=Ve.geometry;if($e==="Point")He(ve,et,Ve);else if($e==="MultiPoint")for(const Ge of ve)He(Ge,et,Ve);else if($e==="LineString")Ve.type=2,Et(ve,et,Ve);else if($e==="MultiLineString")Ve.type=2,Ct(ve,et,Ve);else if($e==="Polygon")Ve.type=3,Ct(ve,et,Ve,!0);else{if($e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ve.type=3;for(const Ge of ve)Ct(Ge,et,Ve,!0)}return Ve}function He([qe,ee],ae,_e){const $e=s.aF(qe);let ve=s.aJ(ee);ve=ve<0?0:ve>1?1:ve,ae.push($e,ve),_e.minX=Math.min(_e.minX,$e),_e.minY=Math.min(_e.minY,ve),_e.maxX=Math.max(_e.maxX,$e),_e.maxY=Math.max(_e.maxY,ve)}function Et(qe,ee,ae,_e=!1,$e=!1){const ve=[];for(const Ve of qe)He(Ve,ve,ae);ee.push(ve),_e&&function(Ve,et){let Ge=0;for(let rt=0,It=Ve.length,At=It-2;rt<It;At=rt,rt+=2)Ge+=(Ve[rt]-Ve[At])*(Ve[rt+1]+Ve[At+1]);if(Ge>0===et)for(let rt=0,It=Ve.length;rt<It/2;rt+=2){const At=Ve[rt],Xt=Ve[rt+1];Ve[rt]=Ve[It-2-rt],Ve[rt+1]=Ve[It-1-rt],Ve[It-2-rt]=At,Ve[It-1-rt]=Xt}}(ve,$e)}function Ct(qe,ee,ae,_e=!1){for(let $e=0;$e<qe.length;$e++)Et(qe[$e],ee,ae,_e,$e===0)}function Dt(qe,ee,ae,_e){const{id:$e,type:ve,geometry:Ve,tags:et}=qe,Ge=[];if(ve===1)(function(rt,It,At,Xt,pn){for(let bn=0;bn<rt.length;bn+=2){const $n=Math.round(s.al*(rt[bn+0]*It-At)),Yn=Math.round(s.al*(rt[bn+1]*It-Xt));pn.push([$n,Yn])}})(Ve,ee,ae,_e,Ge);else if(ve===2)for(const rt of Ve)Bt(rt,ee,ae,_e,Ge);else if(ve===3)for(const rt of Ve)Yt(rt,ee,ae,_e,Ge);return{id:$e,type:ve,geometry:Ge,tags:et}}function Bt(qe,ee,ae,_e,$e){const Ve=s.al+128;let et;for(let Ge=0;Ge<qe.length-2;Ge+=2){let rt=Math.round(s.al*(qe[Ge+0]*ee-ae)),It=Math.round(s.al*(qe[Ge+1]*ee-_e)),At=Math.round(s.al*(qe[Ge+2]*ee-ae)),Xt=Math.round(s.al*(qe[Ge+3]*ee-_e));const pn=At-rt,bn=Xt-It;rt<-128&&At<-128||(rt<-128?(It+=Math.round(bn*((-128-rt)/pn)),rt=-128):At<-128&&(Xt=It+Math.round(bn*((-128-rt)/pn)),At=-128),It<-128&&Xt<-128||(It<-128?(rt+=Math.round(pn*((-128-It)/bn)),It=-128):Xt<-128&&(At=rt+Math.round(pn*((-128-It)/bn)),Xt=-128),rt>=Ve&&At>=Ve||(rt>=Ve?(It+=Math.round(bn*((Ve-rt)/pn)),rt=Ve):At>=Ve&&(Xt=It+Math.round(bn*((Ve-rt)/pn)),At=Ve),It>=Ve&&Xt>=Ve||(It>=Ve?(rt+=Math.round(pn*((Ve-It)/bn)),It=Ve):Xt>=Ve&&(At=rt+Math.round(pn*((Ve-It)/bn)),Xt=Ve),et&&rt===et[et.length-1][0]&&It===et[et.length-1][1]||(et=[[rt,It]],$e.push(et)),et.push([At,Xt])))))}}function Yt(qe,ee,ae,_e,$e){const ve=(ae-le)/ee,Ve=(_e-le)/ee,et=(ae+1+le)/ee,Ge=(_e+1+le)/ee;function rt(Xt,pn){let bn=0;return Xt<ve?bn|=1:Xt>et&&(bn|=2),pn<Ve?bn|=4:pn>Ge&&(bn|=8),bn}let It=[];for(let Xt=1;Xt<=8;Xt*=2){let pn=qe[qe.length-2],bn=qe[qe.length-1],$n=!(rt(pn,bn)&Xt);for(let Yn=0;Yn<qe.length;Yn+=2){const kn=qe[Yn],In=qe[Yn+1],tr=!(rt(kn,In)&Xt);tr!==$n&&(8&Xt?It.push(pn+(kn-pn)*(Ge-bn)/(In-bn),Ge):4&Xt?It.push(pn+(kn-pn)*(Ve-bn)/(In-bn),Ve):2&Xt?It.push(et,bn+(In-bn)*(et-pn)/(kn-pn)):1&Xt&&It.push(ve,bn+(In-bn)*(ve-pn)/(kn-pn))),tr&&It.push(kn,In),pn=kn,bn=In,$n=tr}if(!(qe=It).length||Xt===8)break;It=[]}const At=[];for(let Xt=0;Xt<It.length;Xt+=2)At.push([Math.round(s.al*(It[Xt]*ee-ae)),Math.round(s.al*(It[Xt+1]*ee-_e))]);At.length&&$e.push(At)}function yn({name:qe,features:ee},ae){ae.writeStringField(1,qe),ae.writeVarintField(5,s.al);const _e=new Map,$e=new Map,ve={keys:_e,values:$e,feature:null};for(const Ve of ee)ve.feature=Ve,ae.writeMessage(2,mn,ve);for(const Ve of _e.keys())ae.writeStringField(3,Ve);for(const Ve of $e.keys())ae.writeMessage(4,er,Ve)}function mn(qe,ee){const ae=qe.feature;ae.id!==void 0&&Number.isSafeInteger(+ae.id)&&ee.writeVarintField(1,+ae.id),ae.tags&&ee.writeMessage(2,oi,qe),ee.writeVarintField(3,ae.type),ee.writeMessage(4,ai,ae)}function oi({keys:qe,values:ee,feature:ae},_e){for(const $e of Object.keys(ae.tags)){let ve=ae.tags[$e];if(ve===null)continue;let Ve=qe.get($e);Ve===void 0&&(Ve=qe.size,qe.set($e,Ve)),_e.writeVarint(Ve);const et=typeof ve;et!=="string"&&et!=="boolean"&&et!=="number"&&(ve=JSON.stringify(ve));let Ge=ee.get(ve);Ge===void 0&&(Ge=ee.size,ee.set(ve,Ge)),_e.writeVarint(Ge)}}function sn(qe,ee){return(ee<<3)+(7&qe)}function _n(qe){return qe<<1^qe>>31}function ai(qe,ee){const{geometry:ae,type:_e}=qe;let $e=0,ve=0;if(_e===1){ee.writeVarint(sn(1,ae.length));for(const Ve of ae){const et=Ve[0]-$e,Ge=Ve[1]-ve;ee.writeVarint(_n(et)),ee.writeVarint(_n(Ge)),$e+=et,ve+=Ge}}else for(const Ve of ae){if(Ve.length===0)continue;ee.writeVarint(sn(1,1));const et=Ve.length-(_e===3?1:0);for(let Ge=0;Ge<et;Ge++){Ge===1&&ee.writeVarint(sn(2,et-1));const rt=Ve[Ge][0]-$e,It=Ve[Ge][1]-ve;ee.writeVarint(_n(rt)),ee.writeVarint(_n(It)),$e+=rt,ve+=It}_e===3&&ee.writeVarint(sn(7,1))}}function er(qe,ee){const ae=typeof qe;ae==="string"?ee.writeStringField(1,qe):ae==="boolean"?ee.writeBooleanField(7,qe):ae==="number"&&(qe%1!=0?ee.writeDoubleField(3,qe):qe<0?ee.writeSVarintField(6,qe):ee.writeVarintField(5,qe))}const ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},Yr=Math.fround||($s=new Float32Array(1),qe=>($s[0]=+qe,$s[0]));var $s;class Xs{constructor(ee){this.options=Object.assign(Object.create(ui),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:ae,minZoom:_e,maxZoom:$e}=this.options;ae&&console.time("total time");const ve=`prepare ${ee.length} points`;ae&&console.time(ve),this.points=ee;const Ve=[];for(let Ge=0;Ge<ee.length;Ge++){const rt=ee[Ge];if(!rt.geometry)continue;const[It,At]=rt.geometry.coordinates,Xt=Yr(_l(It)),pn=Yr(Ra(At));Ve.push(Xt,pn,1/0,Ge,-1,1),this.options.reduce&&Ve.push(0)}let et=this.trees[$e+1]=this._createTree(Ve);ae&&console.timeEnd(ve);for(let Ge=$e;Ge>=_e;Ge--){const rt=+Date.now();et=this.trees[Ge]=this._createTree(this._cluster(et,Ge)),ae&&console.log("z%d: %d clusters in %dms",Ge,et.numItems,+Date.now()-rt)}return ae&&console.timeEnd("total time"),this}getClusters(ee,ae){let _e=((ee[0]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ee[1]));let ve=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)_e=-180,ve=180;else if(_e>ve){const At=this.getClusters([_e,$e,180,Ve],ae),Xt=this.getClusters([-180,$e,ve,Ve],ae);return At.concat(Xt)}const et=this.trees[this._limitZoom(ae)],Ge=et.range(_l(_e),Ra(Ve),_l(ve),Ra($e)),rt=et.data,It=[];for(const At of Ge){const Xt=this.stride*At;It.push(rt[Xt+5]>1?la(rt,Xt,this.clusterProps):this.points[rt[Xt+3]])}return It}getChildren(ee){const ae=this._getOriginId(ee),_e=this._getOriginZoom(ee),$e="No cluster with the specified id.",ve=this.trees[_e];if(!ve)throw new Error($e);const Ve=ve.data;if(ae*this.stride>=Ve.length)throw new Error($e);const et=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Ge=ve.within(Ve[ae*this.stride],Ve[ae*this.stride+1],et),rt=[];for(const It of Ge){const At=It*this.stride;Ve[At+4]===ee&&rt.push(Ve[At+5]>1?la(Ve,At,this.clusterProps):this.points[Ve[At+3]])}if(rt.length===0)throw new Error($e);return rt}getLeaves(ee,ae,_e){const $e=[];return this._appendLeaves($e,ee,ae=ae||10,_e=_e||0,0),$e}getTile(ee,ae,_e){const $e=this.trees[this._limitZoom(ee)],ve=Math.pow(2,ee),{extent:Ve,radius:et}=this.options,Ge=et/Ve,rt=(_e-Ge)/ve,It=(_e+1+Ge)/ve,At={features:[]};return this._addTileFeatures($e.range((ae-Ge)/ve,rt,(ae+1+Ge)/ve,It),$e.data,ae,_e,ve,At),ae===0&&this._addTileFeatures($e.range(1-Ge/ve,rt,1,It),$e.data,ve,_e,ve,At),ae===ve-1&&this._addTileFeatures($e.range(0,rt,Ge/ve,It),$e.data,-1,_e,ve,At),At.features.length?At:null}getClusterExpansionZoom(ee){let ae=this._getOriginZoom(ee)-1;for(;ae<=this.options.maxZoom;){const _e=this.getChildren(ee);if(ae++,_e.length!==1)break;ee=_e[0].properties.cluster_id}return ae}_appendLeaves(ee,ae,_e,$e,ve){const Ve=this.getChildren(ae);for(const et of Ve){const Ge=et.properties;if(Ge&&Ge.cluster?ve+Ge.point_count<=$e?ve+=Ge.point_count:ve=this._appendLeaves(ee,Ge.cluster_id,_e,$e,ve):ve<$e?ve++:ee.push(et),ee.length===_e)break}return ve}_createTree(ee){const ae=new s.c4(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<ee.length;_e+=this.stride)ae.add(ee[_e],ee[_e+1]);return ae.finish(),ae.data=ee,ae}_addTileFeatures(ee,ae,_e,$e,ve,Ve){for(const et of ee){const Ge=et*this.stride,rt=ae[Ge+5]>1;let It,At,Xt;if(rt)It=xr(ae,Ge,this.clusterProps),At=ae[Ge],Xt=ae[Ge+1];else{const $n=this.points[ae[Ge+3]];It=$n.properties;const[Yn,kn]=$n.geometry.coordinates;At=_l(Yn),Xt=Ra(kn)}const pn={type:1,geometry:[[Math.round(this.options.extent*(At*ve-_e)),Math.round(this.options.extent*(Xt*ve-$e))]],tags:It};let bn;bn=rt||this.options.generateId?ae[Ge+3]:this.points[ae[Ge+3]].id,bn!==void 0&&(pn.id=bn),Ve.features.push(pn)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,ae){const{radius:_e,extent:$e,reduce:ve,minPoints:Ve}=this.options,et=_e/($e*Math.pow(2,ae)),Ge=ee.data,rt=[],It=this.stride;for(let At=0;At<Ge.length;At+=It){if(Ge[At+2]<=ae)continue;Ge[At+2]=ae;const Xt=Ge[At],pn=Ge[At+1],bn=ee.within(Ge[At],Ge[At+1],et),$n=Ge[At+5];let Yn=$n;for(const kn of bn){const In=kn*It;Ge[In+2]>ae&&(Yn+=Ge[In+5])}if(Yn>$n&&Yn>=Ve){let kn,In=Xt*$n,tr=pn*$n,ss=-1;const Nr=(At/It<<5)+(ae+1)+this.points.length;for(const Mr of bn){const dr=Mr*It;if(Ge[dr+2]<=ae)continue;Ge[dr+2]=ae;const fi=Ge[dr+5];In+=Ge[dr]*fi,tr+=Ge[dr+1]*fi,Ge[dr+4]=Nr,ve&&(kn||(kn=this._map(Ge,At,!0),ss=this.clusterProps.length,this.clusterProps.push(kn)),ve(kn,this._map(Ge,dr)))}Ge[At+4]=Nr,rt.push(In/Yn,tr/Yn,1/0,Nr,-1,Yn),ve&&rt.push(ss)}else{for(let kn=0;kn<It;kn++)rt.push(Ge[At+kn]);if(Yn>1)for(const kn of bn){const In=kn*It;if(!(Ge[In+2]<=ae)){Ge[In+2]=ae;for(let tr=0;tr<It;tr++)rt.push(Ge[In+tr])}}}}return rt}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,ae,_e){if(ee[ae+5]>1){const Ve=this.clusterProps[ee[ae+6]];return _e?Object.assign({},Ve):Ve}const $e=this.points[ee[ae+3]].properties,ve=this.options.map($e);return _e&&ve===$e?Object.assign({},ve):ve}}function la(qe,ee,ae){return{type:"Feature",id:qe[ee+3],properties:xr(qe,ee,ae),geometry:{type:"Point",coordinates:[(_e=qe[ee],360*(_e-.5)),Lo(qe[ee+1])]}};var _e}function xr(qe,ee,ae){const _e=qe[ee+5],$e=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,ve=qe[ee+6],Ve=ve===-1?{}:Object.assign({},ae[ve]);return Object.assign(Ve,{cluster:!0,cluster_id:qe[ee+3],point_count:_e,point_count_abbreviated:$e})}function _l(qe){return qe/360+.5}function Ra(qe){const ee=Math.sin(qe*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function Lo(qe){const ee=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function oc(qe,ee,ae,_e){let $e=_e;const ve=ee+(ae-ee>>1);let Ve,et=ae-ee;const Ge=qe[ee],rt=qe[ee+1],It=qe[ae],At=qe[ae+1];for(let Xt=ee+3;Xt<ae;Xt+=3){const pn=Bo(qe[Xt],qe[Xt+1],Ge,rt,It,At);if(pn>$e)Ve=Xt,$e=pn;else if(pn===$e){const bn=Math.abs(Xt-ve);bn<et&&(Ve=Xt,et=bn)}}$e>_e&&(Ve-ee>3&&oc(qe,ee,Ve,_e),qe[Ve+2]=$e,ae-Ve>3&&oc(qe,Ve,ae,_e))}function Bo(qe,ee,ae,_e,$e,ve){let Ve=$e-ae,et=ve-_e;if(Ve!==0||et!==0){const Ge=((qe-ae)*Ve+(ee-_e)*et)/(Ve*Ve+et*et);Ge>1?(ae=$e,_e=ve):Ge>0&&(ae+=Ve*Ge,_e+=et*Ge)}return Ve=qe-ae,et=ee-_e,Ve*Ve+et*et}function Js(qe,ee,ae,_e){const $e={id:qe??null,type:ee,geometry:ae,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")zs($e,ae);else if(ee==="Polygon")zs($e,ae[0]);else if(ee==="MultiLineString")for(const ve of ae)zs($e,ve);else if(ee==="MultiPolygon")for(const ve of ae)zs($e,ve[0]);return $e}function zs(qe,ee){for(let ae=0;ae<ee.length;ae+=3)qe.minX=Math.min(qe.minX,ee[ae]),qe.minY=Math.min(qe.minY,ee[ae+1]),qe.maxX=Math.max(qe.maxX,ee[ae]),qe.maxY=Math.max(qe.maxY,ee[ae+1])}function ts(qe,ee,ae,_e){if(!ee.geometry)return;const $e=ee.geometry.coordinates;if($e&&$e.length===0)return;const ve=ee.geometry.type,Ve=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let et=[],Ge=ee.id;if(ae.promoteId?Ge=ee.properties[ae.promoteId]:ae.generateId&&(Ge=_e||0),ve==="Point")co($e,et);else if(ve==="MultiPoint")for(const rt of $e)co(rt,et);else if(ve==="LineString")Fc($e,et,Ve,!1);else if(ve==="MultiLineString"){if(ae.lineMetrics){for(const rt of $e)et=[],Fc(rt,et,Ve,!1),qe.push(Js(Ge,"LineString",et,ee.properties));return}wl($e,et,Ve,!1)}else if(ve==="Polygon")wl($e,et,Ve,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const rt of ee.geometry.geometries)ts(qe,{id:Ge,geometry:rt,properties:ee.properties},ae,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const rt of $e){const It=[];wl(rt,It,Ve,!0),et.push(It)}}qe.push(Js(Ge,ve,et,ee.properties))}function co(qe,ee){ee.push(hs(qe[0]),Id(qe[1]),0)}function Fc(qe,ee,ae,_e){let $e,ve,Ve=0;for(let Ge=0;Ge<qe.length;Ge++){const rt=hs(qe[Ge][0]),It=Id(qe[Ge][1]);ee.push(rt,It,0),Ge>0&&(Ve+=_e?($e*It-rt*ve)/2:Math.sqrt(Math.pow(rt-$e,2)+Math.pow(It-ve,2))),$e=rt,ve=It}const et=ee.length-3;ee[2]=1,oc(ee,0,et,ae),ee[et+2]=1,ee.size=Math.abs(Ve),ee.start=0,ee.end=ee.size}function wl(qe,ee,ae,_e){for(let $e=0;$e<qe.length;$e++){const ve=[];Fc(qe[$e],ve,ae,_e),ee.push(ve)}}function hs(qe){return qe/360+.5}function Id(qe){const ee=Math.sin(qe*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function Fo(qe,ee,ae,_e,$e,ve,Ve,et){if(_e/=ee,ve>=(ae/=ee)&&Ve<_e)return qe;if(Ve<ae||ve>=_e)return null;const Ge=[];for(const rt of qe){const It=rt.geometry;let At=rt.type;const Xt=$e===0?rt.minX:rt.minY,pn=$e===0?rt.maxX:rt.maxY;if(Xt>=ae&&pn<_e){Ge.push(rt);continue}if(pn<ae||Xt>=_e)continue;let bn=[];if(At==="Point"||At==="MultiPoint")Lu(It,bn,ae,_e,$e);else if(At==="LineString")$o(It,bn,ae,_e,$e,!1,et.lineMetrics);else if(At==="MultiLineString")zo(It,bn,ae,_e,$e,!1);else if(At==="Polygon")zo(It,bn,ae,_e,$e,!0);else if(At==="MultiPolygon")for(const $n of It){const Yn=[];zo($n,Yn,ae,_e,$e,!0),Yn.length&&bn.push(Yn)}if(bn.length){if(et.lineMetrics&&At==="LineString"){for(const $n of bn)Ge.push(Js(rt.id,At,$n,rt.tags));continue}At!=="LineString"&&At!=="MultiLineString"||(bn.length===1?(At="LineString",bn=bn[0]):At="MultiLineString"),At!=="Point"&&At!=="MultiPoint"||(At=bn.length===3?"Point":"MultiPoint"),Ge.push(Js(rt.id,At,bn,rt.tags))}}return Ge.length?Ge:null}function Lu(qe,ee,ae,_e,$e){for(let ve=0;ve<qe.length;ve+=3){const Ve=qe[ve+$e];Ve>=ae&&Ve<=_e&&bl(ee,qe[ve],qe[ve+1],qe[ve+2])}}function $o(qe,ee,ae,_e,$e,ve,Ve){let et=Is(qe);const Ge=$e===0?Zl:$c;let rt,It,At=qe.start;for(let Yn=0;Yn<qe.length-3;Yn+=3){const kn=qe[Yn],In=qe[Yn+1],tr=qe[Yn+2],ss=qe[Yn+3],Nr=qe[Yn+4],Mr=$e===0?kn:In,dr=$e===0?ss:Nr;let fi=!1;Ve&&(rt=Math.sqrt(Math.pow(kn-ss,2)+Math.pow(In-Nr,2))),Mr<ae?dr>ae&&(It=Ge(et,kn,In,ss,Nr,ae),Ve&&(et.start=At+rt*It)):Mr>_e?dr<_e&&(It=Ge(et,kn,In,ss,Nr,_e),Ve&&(et.start=At+rt*It)):bl(et,kn,In,tr),dr<ae&&Mr>=ae&&(It=Ge(et,kn,In,ss,Nr,ae),fi=!0),dr>_e&&Mr<=_e&&(It=Ge(et,kn,In,ss,Nr,_e),fi=!0),!ve&&fi&&(Ve&&(et.end=At+rt*It),ee.push(et),et=Is(qe)),Ve&&(At+=rt)}let Xt=qe.length-3;const pn=qe[Xt],bn=qe[Xt+1],$n=$e===0?pn:bn;$n>=ae&&$n<=_e&&bl(et,pn,bn,qe[Xt+2]),Xt=et.length-3,ve&&Xt>=3&&(et[Xt]!==et[0]||et[Xt+1]!==et[1])&&bl(et,et[0],et[1],et[2]),et.length&&ee.push(et)}function Is(qe){const ee=[];return ee.size=qe.size,ee.start=qe.start,ee.end=qe.end,ee}function zo(qe,ee,ae,_e,$e,ve){for(const Ve of qe)$o(Ve,ee,ae,_e,$e,ve,!1)}function bl(qe,ee,ae,_e){qe.push(ee,ae,_e)}function Zl(qe,ee,ae,_e,$e,ve){const Ve=(ve-ee)/(_e-ee);return bl(qe,ve,ae+($e-ae)*Ve,1),Ve}function $c(qe,ee,ae,_e,$e,ve){const Ve=(ve-ae)/($e-ae);return bl(qe,ee+(_e-ee)*Ve,ve,1),Ve}function vl(qe,ee){const ae=[];for(let _e=0;_e<qe.length;_e++){const $e=qe[_e],ve=$e.type;let Ve;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ve=Kl($e.geometry,ee);else if(ve==="MultiLineString"||ve==="Polygon"){Ve=[];for(const et of $e.geometry)Ve.push(Kl(et,ee))}else if(ve==="MultiPolygon"){Ve=[];for(const et of $e.geometry){const Ge=[];for(const rt of et)Ge.push(Kl(rt,ee));Ve.push(Ge)}}ae.push(Js($e.id,ve,Ve,$e.tags))}return ae}function Kl(qe,ee){const ae=[];ae.size=qe.size,qe.start!==void 0&&(ae.start=qe.start,ae.end=qe.end);for(let _e=0;_e<qe.length;_e+=3)ae.push(qe[_e]+ee,qe[_e+1],qe[_e+2]);return ae}function Yl(qe,ee){if(qe.transformed)return qe;const ae=1<<qe.z,_e=qe.x,$e=qe.y;for(const ve of qe.features){const Ve=ve.geometry,et=ve.type;if(ve.geometry=[],et===1)for(let Ge=0;Ge<Ve.length;Ge+=2)ve.geometry.push(zi(Ve[Ge],Ve[Ge+1],ee,ae,_e,$e));else for(let Ge=0;Ge<Ve.length;Ge++){const rt=[];for(let It=0;It<Ve[Ge].length;It+=2)rt.push(zi(Ve[Ge][It],Ve[Ge][It+1],ee,ae,_e,$e));ve.geometry.push(rt)}}return qe.transformed=!0,qe}function zi(qe,ee,ae,_e,$e,ve){return[Math.round(ae*(qe*_e-$e)),Math.round(ae*(ee*_e-ve))]}function Ps(qe,ee,ae,_e,$e){const ve=ee===$e.maxZoom?0:$e.tolerance/((1<<ee)*$e.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:qe.length,source:null,x:ae,y:_e,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of qe)Si(Ve,et,ve,$e);return Ve}function Si(qe,ee,ae,_e){const $e=ee.geometry,ve=ee.type,Ve=[];if(qe.minX=Math.min(qe.minX,ee.minX),qe.minY=Math.min(qe.minY,ee.minY),qe.maxX=Math.max(qe.maxX,ee.maxX),qe.maxY=Math.max(qe.maxY,ee.maxY),ve==="Point"||ve==="MultiPoint")for(let et=0;et<$e.length;et+=3)Ve.push($e[et],$e[et+1]),qe.numPoints++,qe.numSimplified++;else if(ve==="LineString")cr(Ve,$e,qe,ae,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let et=0;et<$e.length;et++)cr(Ve,$e[et],qe,ae,ve==="Polygon",et===0);else if(ve==="MultiPolygon")for(let et=0;et<$e.length;et++){const Ge=$e[et];for(let rt=0;rt<Ge.length;rt++)cr(Ve,Ge[rt],qe,ae,!0,rt===0)}if(Ve.length){let et=ee.tags||null;if(ve==="LineString"&&_e.lineMetrics){et={};for(const rt in ee.tags)et[rt]=ee.tags[rt];et.mapbox_clip_start=$e.start/$e.size,et.mapbox_clip_end=$e.end/$e.size}const Ge={geometry:Ve,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:et};ee.id!==null&&(Ge.id=ee.id),qe.features.push(Ge)}}function cr(qe,ee,ae,_e,$e,ve){const Ve=_e*_e;if(_e>0&&ee.size<($e?Ve:_e))return void(ae.numPoints+=ee.length/3);const et=[];for(let Ge=0;Ge<ee.length;Ge+=3)(_e===0||ee[Ge+2]>Ve)&&(ae.numSimplified++,et.push(ee[Ge],ee[Ge+1])),ae.numPoints++;$e&&function(Ge,rt){let It=0;for(let At=0,Xt=Ge.length,pn=Xt-2;At<Xt;pn=At,At+=2)It+=(Ge[At]-Ge[pn])*(Ge[At+1]+Ge[pn+1]);if(It>0===rt)for(let At=0,Xt=Ge.length;At<Xt/2;At+=2){const pn=Ge[At],bn=Ge[At+1];Ge[At]=Ge[Xt-2-At],Ge[At+1]=Ge[Xt-1-At],Ge[Xt-2-At]=pn,Ge[Xt-1-At]=bn}}(et,ve),qe.push(et)}const Zi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ua{constructor(ee,ae){const _e=(ae=this.options=function(ve,Ve){for(const et in Ve)ve[et]=Ve[et];return ve}(Object.create(Zi),ae)).debug;if(_e&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let $e=function(ve,Ve){const et=[];if(ve.type==="FeatureCollection")for(let Ge=0;Ge<ve.features.length;Ge++)ts(et,ve.features[Ge],Ve,Ge);else ts(et,ve.type==="Feature"?ve:{geometry:ve},Ve);return et}(ee,ae);this.tiles={},this.tileCoords=[],_e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$e=function(ve,Ve){const et=Ve.buffer/Ve.extent;let Ge=ve;const rt=Fo(ve,1,-1-et,et,0,-1,2,Ve),It=Fo(ve,1,1-et,2+et,0,-1,2,Ve);return(rt||It)&&(Ge=Fo(ve,1,-et,1+et,0,-1,2,Ve)||[],rt&&(Ge=vl(rt,1).concat(Ge)),It&&(Ge=Ge.concat(vl(It,-1)))),Ge}($e,ae),$e.length&&this.splitTile($e,0,0,0),_e&&($e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,ae,_e,$e,ve,Ve,et){const Ge=[ee,ae,_e,$e],rt=this.options,It=rt.debug;for(;Ge.length;){$e=Ge.pop(),_e=Ge.pop(),ae=Ge.pop(),ee=Ge.pop();const At=1<<ae,Xt=lo(ae,_e,$e);let pn=this.tiles[Xt];if(!pn&&(It>1&&console.time("creation"),pn=this.tiles[Xt]=Ps(ee,ae,_e,$e,rt),this.tileCoords.push({z:ae,x:_e,y:$e}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,_e,$e,pn.numFeatures,pn.numPoints,pn.numSimplified),console.timeEnd("creation"));const fi=`z${ae}`;this.stats[fi]=(this.stats[fi]||0)+1,this.total++}if(pn.source=ee,ve==null){if(ae===rt.indexMaxZoom||pn.numPoints<=rt.indexMaxPoints)continue}else{if(ae===rt.maxZoom||ae===ve)continue;if(ve!=null){const fi=ve-ae;if(_e!==Ve>>fi||$e!==et>>fi)continue}}if(pn.source=null,ee.length===0)continue;It>1&&console.time("clipping");const bn=.5*rt.buffer/rt.extent,$n=.5-bn,Yn=.5+bn,kn=1+bn;let In=null,tr=null,ss=null,Nr=null,Mr=Fo(ee,At,_e-bn,_e+Yn,0,pn.minX,pn.maxX,rt),dr=Fo(ee,At,_e+$n,_e+kn,0,pn.minX,pn.maxX,rt);ee=null,Mr&&(In=Fo(Mr,At,$e-bn,$e+Yn,1,pn.minY,pn.maxY,rt),tr=Fo(Mr,At,$e+$n,$e+kn,1,pn.minY,pn.maxY,rt),Mr=null),dr&&(ss=Fo(dr,At,$e-bn,$e+Yn,1,pn.minY,pn.maxY,rt),Nr=Fo(dr,At,$e+$n,$e+kn,1,pn.minY,pn.maxY,rt),dr=null),It>1&&console.timeEnd("clipping"),Ge.push(In||[],ae+1,2*_e,2*$e),Ge.push(tr||[],ae+1,2*_e,2*$e+1),Ge.push(ss||[],ae+1,2*_e+1,2*$e),Ge.push(Nr||[],ae+1,2*_e+1,2*$e+1)}}getTile(ee,ae,_e){ee=+ee,ae=+ae,_e=+_e;const $e=this.options,{extent:ve,debug:Ve}=$e;if(ee<0||ee>24)return null;const et=1<<ee,Ge=lo(ee,ae=ae+et&et-1,_e);if(this.tiles[Ge])return Yl(this.tiles[Ge],ve);Ve>1&&console.log("drilling down to z%d-%d-%d",ee,ae,_e);let rt,It=ee,At=ae,Xt=_e;for(;!rt&&It>0;)It--,At>>=1,Xt>>=1,rt=this.tiles[lo(It,At,Xt)];return rt&&rt.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",It,At,Xt),console.time("drilling down")),this.splitTile(rt.source,It,At,Xt,ee,ae,_e),Ve>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Yl(this.tiles[Ge],ve):null):null}}function lo(qe,ee,ae){return 32*((1<<qe)*ae+ee)+qe}function Tt(qe,ee){const ae=qe.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const _e=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!_e)return void ee(null,null);const $e=rt=>rt.tags&&"3d_elevation_id"in rt.tags&&"source"in rt.tags&&rt.tags.source==="elevation",ve=_e.features.filter(rt=>$e(rt));let Ve={_geojsonTileLayer:_e.features};ve.length>0&&(Ve={_geojsonTileLayer:_e.features.filter(rt=>!$e(rt)),hd_road_elevation:ve});const et=new re(Ve),Ge=function(rt){const It=new s.bt;for(const At of Object.keys(rt))It.writeMessage(3,yn,{name:At,features:rt[At]});return It.finish()}(Ve).buffer;ee(null,{vectorTile:et,rawData:Ge})}class bo extends Ue{constructor(ee,ae,_e,$e,ve,Ve,et){super(ee,ae,_e,$e,ve,Tt,et),Ve&&(this.loadGeoJSON=Ve),this._dynamicIndex=new Ae}loadData(ee,ae){const _e=ee&&ee.request,$e=_e&&_e.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ee,(ve,Ve)=>{if(ve||!Ve)return ae(ve);if(typeof Ve!="object")return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Ge=s.U(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));Ve.features=Ve.features.filter(rt=>Ge.value.evaluate({zoom:0},rt))}ee.dynamic?(Ve.type==="Feature"&&(Ve={type:"FeatureCollection",features:[Ve]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ve.features,this.loaded),ee.cluster&&(Ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new Xs(function({superclusterOptions:Ge,clusterProperties:rt}){if(!rt||!Ge)return Ge;const It={},At={},Xt={accumulated:null,zoom:0},pn={properties:null},bn=Object.keys(rt);for(const $n of bn){const[Yn,kn]=rt[$n],In=s.U(kn),tr=s.U(typeof Yn=="string"?[Yn,["accumulated"],["get",$n]]:Yn);It[$n]=In.value,At[$n]=tr.value}return Ge.map=$n=>{pn.properties=$n;const Yn={};for(const kn of bn)Yn[kn]=It[kn].evaluate(Xt,pn);return Yn},Ge.reduce=($n,Yn)=>{pn.properties=Yn;for(const kn of bn)Xt.accumulated=$n[kn],$n[kn]=At[kn].evaluate(Xt,pn)},Ge}(ee)).load(Ve.features):ee.dynamic?this._dynamicIndex:function(Ge,rt){return new ua(Ge,rt)}(Ve,ee.geojsonVtOptions)}catch(Ge){return ae(Ge)}const et={};if($e){const Ge=w(_e);Ge&&(et.resourceTiming={},et.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ge)))}ae(null,et)}})}reloadTile(ee,ae){const _e=this.loaded;return _e&&_e[ee.uid]?ee.partial?ae(null,void 0):super.reloadTile(ee,ae):this.loadTile(ee,ae)}loadGeoJSON(ee,ae){if(ee.request)s.m(ee.request,ae);else{if(typeof ee.data!="string")return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ae(null,JSON.parse(ee.data))}catch{return ae(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ee,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(_e){ae(_e)}}getClusterChildren(ee,ae){try{ae(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(_e){ae(_e)}}getClusterLeaves(ee,ae){try{ae(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(_e){ae(_e)}}}class da{constructor(ee,ae,_e){this.tileID=new s.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=ae,this.worldview=_e}parse(ee,ae,_e,$e){this.status="parsing";const ve=new s.aQ(_e.tileID.overscaledZ,_e.tileID.wrap,_e.tileID.canonical.z,_e.tileID.canonical.x,_e.tileID.canonical.y),Ve=[],et=ae.familiesBySource[_e.source],Ge=new s.fn(ve,_e.promoteId);Ge.bucketLayerIDs=[],Ge.is3DTile=!0,s.fC(ee).then(rt=>{if(!rt)return $e(new Error("Could not parse tile"));const It=rt.json.extensionsUsed&&rt.json.extensionsUsed.includes("MAPBOX_mesh_features")||rt.json.asset.extras&&rt.json.asset.extras.MAPBOX_mesh_features,At=rt.json.extensionsUsed&&rt.json.extensionsUsed.includes("EXT_meshopt_compression"),Xt=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const pn in et)for(const bn of et[pn]){const $n=bn[0];Ge.bucketLayerIDs.push(bn.map(In=>s.B(In.id,In.scope))),$n.recalculate(Xt,[]);const Yn=s.fD(rt,1/s.d7(_e.tileID.canonical)),kn=new s.fE(bn,Yn,ve,It,At,this.brightness,Ge,this.worldview);It||(kn.needsUpload=!0),Ve.push(kn),kn.evaluate($n)}this.status="done",$e(null,{buckets:Ve,featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(rt=>$e(new Error(rt.message)))}}class Oa{constructor(ee,ae,_e,$e,ve,Ve,et,Ge){this.actor=ee,this.layerIndex=ae,this.availableImages=_e,this.availableModels=$e,this.brightness=et,this.loading={},this.loaded={},this.worldview=Ge}loadTile(ee,ae){const _e=ee.uid,$e=this.loading[_e]=new da(ee,this.brightness,this.worldview);s.bu(ee.request,(ve,Ve)=>{const et=!this.loading[_e];return delete this.loading[_e],et||ve?($e.status="done",et||(this.loaded[_e]=$e),ae(ve)):Ve&&Ve.byteLength!==0?void $e.parse(Ve,this.layerIndex,ee,(Ge,rt)=>{$e.status="done",this.loaded=this.loaded||{},this.loaded[_e]=$e,Ge||!rt?ae(Ge):ae(null,rt)}):($e.status="done",this.loaded[_e]=$e,ae())})}reloadTile(ee,ae){const _e=this.loaded,$e=ee.uid;if(_e&&_e[$e]){const ve=_e[$e];ve.projection=ee.projection,ve.brightness=ee.brightness;const Ve=(et,Ge)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(ee,ae)),ae(et,Ge)};ve.status==="parsing"?ve.reloadCallback=Ve:ve.status==="done"&&this.loadTile(ee,ae)}}abortTile(ee,ae){const _e=ee.uid;this.loading[_e]&&delete this.loading[_e],ae()}removeTile(ee,ae){const _e=this.loaded,$e=ee.uid;_e&&_e[$e]&&delete _e[$e],ae()}}class _i{constructor(ee){this.self=ee,this.actor=new s.fG(ee,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:Ue,geojson:bo,"raster-dem":ze,"raster-array":ft,"batched-model":Oa},this.workerSources={},this.self.registerWorkerSource=(ae,_e)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=_e},this.self.registerRTLTextPlugin=ae=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=ae.applyArabicShaping,s.fH.processBidirectionalText=ae.processBidirectionalText,s.fH.processStyledBidirectionalText=ae.processStyledBidirectionalText;for(const _e of this.rtlPluginParsingListeners)_e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ee,ae,_e){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.availableModels[ee],delete this.workerSources[ee],_e()}checkIfReady(ee,ae,_e){_e()}setReferrer(ee,ae){this.referrer=ae}spriteLoaded(ee,ae){this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={});const{scope:_e,isLoaded:$e}=ae;if(this.isSpriteLoaded[ee][_e]=$e,this.workerSources[ee]&&this.workerSources[ee][_e])for(const ve in this.workerSources[ee][_e]){const Ve=this.workerSources[ee][_e][ve];for(const et in Ve){const Ge=Ve[et];Ge instanceof Ue&&(Ge.isSpriteLoaded=$e,Ge.fire(new s.z("isSpriteLoaded")))}}}setImages(ee,ae,_e){this.availableImages[ee]||(this.availableImages[ee]={});const{scope:$e,images:ve}=ae;if(this.availableImages[ee][$e]=ve,this.workerSources[ee]&&this.workerSources[ee][$e]){for(const Ve in this.workerSources[ee][$e]){const et=this.workerSources[ee][$e][Ve];for(const Ge in et)et[Ge].availableImages=ve}_e()}else _e()}setModels(ee,{scope:ae,models:_e},$e){if(this.availableModels[ee]||(this.availableModels[ee]={}),this.availableModels[ee][ae]=_e,this.workerSources[ee]&&this.workerSources[ee][ae]){for(const ve in this.workerSources[ee][ae]){const Ve=this.workerSources[ee][ae][ve];for(const et in Ve)Ve[et].availableModels=_e}$e()}else $e()}setProjection(ee,ae){this.projections[ee]=s.cm(ae)}setBrightness(ee,ae,_e){this.brightness=ae,_e()}setWorldview(ee,ae,_e){this.worldview=ae,_e()}setLayers(ee,ae,_e){this.getLayerIndex(ee,ae.scope).replace(ae.layers,ae.options),_e()}updateLayers(ee,ae,_e){this.getLayerIndex(ee,ae.scope).update(ae.layers,ae.removedIds,ae.options),_e()}loadTile(ee,ae,_e){ae.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ae.type,ae.source,ae.scope).loadTile(ae,_e)}decodeRasterArray(ee,ae,_e){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).decodeRasterArray(ae,_e)}reloadTile(ee,ae,_e){ae.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,ae.type,ae.source,ae.scope).reloadTile(ae,_e)}abortTile(ee,ae,_e){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).abortTile(ae,_e)}removeTile(ee,ae,_e){this.getWorkerSource(ee,ae.type,ae.source,ae.scope).removeTile(ae,_e)}removeSource(ee,ae,_e){if(!(this.workerSources[ee]&&this.workerSources[ee][ae.scope]&&this.workerSources[ee][ae.scope][ae.type]&&this.workerSources[ee][ae.scope][ae.type][ae.source]))return;const $e=this.workerSources[ee][ae.scope][ae.type][ae.source];delete this.workerSources[ee][ae.scope][ae.type][ae.source],$e.removeSource!==void 0?$e.removeSource(ae,_e):_e()}loadWorkerSource(ee,ae,_e){try{this.self.importScripts(ae.url),_e()}catch($e){_e($e)}}syncRTLPluginState(ee,ae,_e){if(s.fH.isParsed())_e(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(_e);else try{s.fH.setState(ae);const $e=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||$e==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts($e),s.fH.isParsed()?_e(null,!0):this.rtlPluginParsingListeners.push(_e))}catch($e){_e($e)}}setDracoUrl(ee,ae){this.dracoUrl=ae}getAvailableImages(ee,ae){this.availableImages[ee]||(this.availableImages[ee]={});let _e=this.availableImages[ee][ae];return _e||(_e=[]),_e}getAvailableModels(ee,ae){this.availableModels[ee]||(this.availableModels[ee]={});let _e=this.availableModels[ee][ae];return _e||(_e={}),_e}getLayerIndex(ee,ae){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let _e=this.layerIndexes[ee][ae];return _e||(_e=this.layerIndexes[ee][ae]=new D,_e.scope=ae),_e}getWorkerSource(ee,ae,_e,$e){const ve=this.workerSources;return ve[ee]||(ve[ee]={}),ve[ee][$e]||(ve[ee][$e]={}),ve[ee][$e][ae]||(ve[ee][$e][ae]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),ve[ee][$e][ae][_e]||(ve[ee][$e][ae][_e]=new this.workerSourceTypes[ae]({send:(Ve,et,Ge,rt,It,At)=>this.actor.send(Ve,et,Ge,ee,It,At),scheduler:this.actor.scheduler},this.getLayerIndex(ee,$e),this.getAvailableImages(ee,$e),this.getAvailableModels(ee,$e),this.isSpriteLoaded[ee][$e],void 0,this.brightness,this.worldview)),ve[ee][$e][ae][_e]}rasterizeImagesWorker(ee,ae,_e){const $e=new Map;for(const[ve,{image:Ve,imageVariant:et}]of ae.tasks.entries()){const Ge=this.imageRasterizer.rasterize(et,Ve,ae.scope,ee);$e.set(ve,Ge)}_e(void 0,$e)}removeRasterizedImages(ee,ae,_e){this.imageRasterizer.removeImagesFromCacheByIds(ae.imageIds,ae.scope,ee),_e()}enforceCacheSizeLimit(ee,ae){s.fJ(ae)}getWorkerPerformanceMetrics(ee,ae,_e){_e(void 0,void 0)}}return s.fF(self)&&(self.worker=new _i(self)),_i}),l(["./shared"],function(s){var w="3.18.1";const x={create:"create",load:"load",fullLoad:"fullLoad"},A={mark(m){performance.mark(m)},measure(m,a,f){performance.measure(m,a,f)}};function P(m){const a=m.name.split("?")[0];return s.a(a)&&a.includes("mapbox-gl.js")?"javascript":s.a(a)&&a.includes("mapbox-gl.css")?"css":s.b(a)?"fontRange":s.c(a)?"sprite":s.i(a)?"style":s.d(a)?"tilejson":"other"}var D,M={},z=function(){if(D)return M;function m(g){return!a(g)}function a(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,C,I=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(I);try{C=new Worker(R),E=!0}catch{E=!1}return C&&C.terminate(),URL.revokeObjectURL(R),E}()?function(){var E=document.createElement("canvas");E.width=E.height=1;var C=E.getContext("2d");if(!C)return!1;var I=C.getImageData(0,0,1,1);return I&&I.width===E.width}()?(f[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(f[b]=function(E){var C,I=function(R){var L=document.createElement("canvas"),B=Object.create(m.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=R,L.getContext("webgl2",B)}(E);if(!I)return!1;try{C=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!C||I.isContextLost())&&(I.shaderSource(C,"void main() {}"),I.compileShader(C),I.getShaderParameter(C,I.COMPILE_STATUS)===!0)}(b)),f[b]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var b}D=1,M.supported=m,M.notSupportedReason=a;var f={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},M}();function U(m,a,f){const g=document.createElement(m);return a!=null&&(g.className=a),f&&f.appendChild(g),g}function G(m,a,f){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(a))g.setAttributeNS(null,b,String(a[b]));return f&&f.appendChild(g),g}const ne=typeof document<"u"?document.documentElement&&document.documentElement.style:null,oe=ne&&ne.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Q;function de(){ne&&oe&&(Q=ne[oe],ne[oe]="none")}function he(){ne&&oe&&(ne[oe]=Q)}function Ie(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Ie,!0)}function ke(){window.addEventListener("click",Ie,!0),window.setTimeout(()=>{window.removeEventListener("click",Ie,!0)},0)}function Ue(m,a){const f=m.getBoundingClientRect();return ft(m,f,a)}function ze(m,a){const f=m.getBoundingClientRect(),g=[];for(let b=0;b<a.length;b++)g.push(ft(m,f,a[b]));return g}function ht(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function ft(m,a,f){const g=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new s.P((f.clientX-a.left)*g,(f.clientY-a.top)*g)}const ct="01",je="NO_ACCESS_TOKEN";class Ye{constructor(a,f,g){this._transformRequestFn=a,this._customAccessToken=f,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const a=function(){let f="";for(let g=0;g<10;g++)f+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ct,f].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,f){return this._transformRequestFn&&this._transformRequestFn(a,f)||{url:a}}normalizeStyleURL(a,f){if(!s.h(a))return a;const g=le(a);return g.params.push(`sdk=js-${w}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||f)}normalizeGlyphsURL(a,f){if(!s.h(a))return a;const g=le(a);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||f)}normalizeModelURL(a,f){if(!s.h(a))return a;const g=le(a);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||f)}normalizeSourceURL(a,f,g,b){if(!s.h(a))return a;const E=le(a);return E.path=`/v4/${E.authority}.json`,E.params.push("secure"),g&&E.params.push(`language=${g}`),b&&E.params.push(`worldview=${b}`),this._makeAPIURL(E,this._customAccessToken||f)}normalizeIconsetURL(a,f){const g=le(a);return s.h(a)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||f)):Ae(g)}normalizeSpriteURL(a,f,g,b){const E=le(a);return s.h(a)?(E.path=`/styles/v1${E.path}/sprite${f}${g}`,this._makeAPIURL(E,this._customAccessToken||b)):(E.path+=`${f}${g}`,Ae(E))}normalizeTileURL(a,f,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!s.h(a))return a;const b=le(a);b.path=b.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${f||g&&b.authority!=="raster"&&g===512?"@2x":""}${s.k.supported?".webp":"$1"}`),b.authority==="raster"?b.path=`/${s.e.RASTER_URL_PREFIX}${b.path}`:b.authority==="rasterarrays"?b.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${b.path}`:b.authority==="3dtiles"?b.path=`/${s.e.TILES3D_URL_PREFIX}${b.path}`:(b.path=b.path.replace(/^.+\/v4\//,"/"),b.path=`/${s.e.TILE_URL_VERSION}${b.path}`);const E=this._customAccessToken||function(C){for(const I of C){const R=I.match(/^access_token=(.*)$/);if(R)return R[1]}return null}(b.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&E&&this._skuToken&&b.params.push(`sku=${this._skuToken}`),this._makeAPIURL(b,E)}canonicalizeTileURL(a,f){const g=le(a);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return a;let b="mapbox://";g.path.match(/^\/raster\/v1\//)?b+=`raster/${g.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?b+=`rasterarrays/${g.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:b+=`tiles/${g.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let E=g.params;return f&&(E=E.filter(C=>!C.match(/^access_token=/))),E.length&&(b+=`?${E.join("&")}`),b}canonicalizeTileset(a,f){const g=!!f&&s.h(f),b=[];for(const E of a.tiles||[])s.j(E)?b.push(this.canonicalizeTileURL(E,g)):b.push(E);return b}_makeAPIURL(a,f){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",b=le(s.e.API_URL);if(a.protocol=b.protocol,a.authority=b.authority,a.protocol==="http"){const E=a.params.indexOf("secure");E>=0&&a.params.splice(E,1)}if(b.path!=="/"&&(a.path=`${b.path}${a.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Ae(a);if(f=f||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!f)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(f[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return a.params=a.params.filter(E=>E.indexOf("access_token")===-1),a.params.push(`access_token=${f||""}`),Ae(a)}}const re=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(m){const a=m.match(re);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Ae(m){const a=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${a}`}const Le="mapbox.eventData";function De(m){if(!m)return null;const a=m.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(s.l(a[1]))}catch{return null}}class He{constructor(a){this.type=a,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(a){const f=De(s.e.ACCESS_TOKEN);let g="";return g=f&&f.u?s.f(f.u):s.e.ACCESS_TOKEN||"",a?`${Le}.${a}:${g}`:`${Le}:${g}`}fetchEventData(){const a=s.s("localStorage"),f=this.getStorageKey(),g=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp");if(a)try{const E=localStorage.getItem(f);E&&(this.eventData=JSON.parse(E));const C=localStorage.getItem(g);C&&(this.anonId=C);const I=localStorage.getItem(b);I&&(this.anonIdTimestamp=Number(I));const R=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<R)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const a=s.s("localStorage"),f=this.getStorageKey(),g=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp"),E=this.anonId,C=this.anonIdTimestamp;if(a&&E)try{localStorage.setItem(g,E),Object.keys(this.eventData).length>=1&&localStorage.setItem(f,JSON.stringify(this.eventData)),C&&localStorage.setItem(b,C.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(a){}postEvent(a,f,g,b){if(!s.e.EVENTS_URL)return;const E=le(s.e.EVENTS_URL);E.params.push(`access_token=${b||s.e.ACCESS_TOKEN||""}`);const C={event:this.type,created:new Date(a).toISOString()},I=f?Object.assign(C,f):C,R={url:Ae(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(R,L=>{this.pendingRequest=null,g(L),this.saveEventData(),this.processRequests(b)})}queueRequest(a,f){this.queue.push(a),this.processRequests(f)}}class Et extends He{constructor(a){super("metrics"),a&&(this.data=a)}postMetricsEvent(a){if(!s.e.EVENTS_URL||!a&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const f=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:f},a)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:f,payload:g}=this.queue.shift();this.postEvent(f,g,()=>{},a)}}const Ct=new class extends He{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,a){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(f=>s.h(f)||s.j(f))&&this.queueRequest(Date.now(),a)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const a=De(s.e.ACCESS_TOKEN),f=a?a.u:s.e.ACCESS_TOKEN;let g=f!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),g=!0);const b=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),C=new Date(b),I=(b-this.eventData.lastSuccess)/864e5;g=g||I>=1||I<-1||E.getDate()!==C.getDate()}else g=!0;g?this.postEvent(b,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ct,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=b,this.eventData.tokenU=f)},m):this.processRequests()}},Dt=Ct.postTurnstileEvent.bind(Ct),Bt=new class extends He{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,a,f,g){this.skuToken=a,this.errorCb=g,s.e.EVENTS_URL&&(f||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},f):this.errorCb(new Error(je)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:f}=this.queue.shift();a&&this.success[a]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ct,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):a&&(this.success[a]=!0)},m))}remove(){this.errorCb=null}},Yt=Bt.postMapLoadEvent.bind(Bt),yn=new class extends He{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let a=this.mapInstanceIdMap.get(m);return a||(a=s.u(),this.mapInstanceIdMap.set(m,a)),a}getEventId(m){const a=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,a+1),a}postStyleLoadEvent(m,a){const{map:f,style:g,importedStyles:b}=a;if(!s.e.EVENTS_URL||!m&&!s.e.ACCESS_TOKEN)return;const E=this.getMapInstanceId(f),C={mapInstanceId:E,eventId:this.getEventId(E),style:g};b.length&&(C.importedStyles=b),this.queueRequest({timestamp:Date.now(),payload:C},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:f}=this.queue.shift();this.postEvent(a,f,()=>{},m)}},mn=yn.postStyleLoadEvent.bind(yn),oi=new Et({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),sn=oi.postMetricsEvent.bind(oi),_n=new Et({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),ai=_n.postMetricsEvent.bind(_n),er=new class extends He{constructor(){super("gljs.performance")}postPerformanceEvent(m,a){s.e.EVENTS_URL&&(m||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:a},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,performanceData:f}=this.queue.shift(),g=function(b){const E=performance.getEntriesByType("resource"),C=performance.getEntriesByType("mark"),I=function(W){const Y={};if(W){for(const Z in W)if(Z!=="other")for(const J of W[Z]){const ie=`${Z}ResolveRangeMin`,pe=`${Z}ResolveRangeMax`,fe=`${Z}RequestCount`,ce=`${Z}RequestCachedCount`;Y[ie]=Math.min(Y[ie]||1/0,J.startTime),Y[pe]=Math.max(Y[pe]||-1/0,J.responseEnd);const Re=Ce=>{Y[Ce]===void 0&&(Y[Ce]=0),++Y[Ce]};J.transferSize!==void 0&&J.transferSize===0&&Re(ce),Re(fe)}}return Y}(function(W,Y){const Z={};if(W)for(const J of W){const ie=Y(J);Z[ie]===void 0&&(Z[ie]=[]),Z[ie].push(J)}return Z}(E,P)),R=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=L?L.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},j=(W,Y,Z)=>{Z!=null&&W.push({name:Y,value:Z.toString()})};for(const W in I)j(V.counters,W,I[W]);if(b.interactionRange[0]!==1/0&&b.interactionRange[1]!==-1/0&&(j(V.counters,"interactionRangeMin",b.interactionRange[0]),j(V.counters,"interactionRangeMax",b.interactionRange[1])),C)for(const W of Object.values(x)){const Y=C.find(Z=>Z.name===W);Y&&j(V.counters,W,Y.startTime)}return j(V.counters,"visibilityHidden",b.visibilityHidden),j(V.attributes,"style",function(W){if(W)for(const Y of W){const Z=Y.name.split("?")[0];if(s.i(Z)){const J=Z.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(E)),j(V.attributes,"terrainEnabled",b.terrainEnabled?"true":"false"),j(V.attributes,"fogEnabled",b.fogEnabled?"true":"false"),j(V.attributes,"projection",b.projection),j(V.attributes,"zoom",b.zoom),j(V.metadata,"devicePixelRatio",R),j(V.metadata,"connectionEffectiveType",B),j(V.metadata,"navigatorUserAgent",navigator.userAgent),j(V.metadata,"screenWidth",window.screen.width),j(V.metadata,"screenHeight",window.screen.height),j(V.metadata,"windowWidth",window.innerWidth),j(V.metadata,"windowHeight",window.innerHeight),j(V.metadata,"mapWidth",b.width/R),j(V.metadata,"mapHeight",b.height/R),j(V.metadata,"webglRenderer",b.renderer),j(V.metadata,"webglVendor",b.vendor),j(V.metadata,"sdkVersion",w),j(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(f);for(const b of g.metadata);for(const b of g.counters);for(const b of g.attributes);this.postEvent(a,g,()=>{},m)}},ui=er.postPerformanceEvent.bind(er),Yr=new class extends He{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,a,f,g){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const b=le(s.e.API_URL+s.e.SESSION_PATH);b.params.push(`sku=${a||""}`),b.params.push(`access_token=${g||s.e.ACCESS_TOKEN||""}`);const E={url:Ae(b),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(E,C=>{this.pendingRequest=null,f(C),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,a,f,g){this.skuToken=a,this.errorCb=g,s.e.SESSION_PATH&&s.e.API_URL&&(f||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},f):this.errorCb(new Error(je)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:a,timestamp:f}=this.queue.shift();a&&this.success[a]||this.getSession(f,this.skuToken,g=>{g?this.errorCb(g):a&&(this.success[a]=!0)},m)}remove(){this.errorCb=null}},$s=Yr.getSessionAPI.bind(Yr),Xs=new Set;function la(m,a){a?Xs.add(m):Xs.delete(m)}class xr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,f){this._updatedSourceCaches[a]=f,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const f=a.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(a.id),this.setDirty()}removeLayer(a){const f=a.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][a.id]=a,this._updatedLayers[f].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const f in this._updatedLayers)a[f]=a[f]||{},a[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)a[f]=a[f]||{},a[f].removedIds=Object.keys(this._removedLayers[f]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(a){return this._updatedImages[a]?Array.from(this._updatedImages[a].values()):[]}updateImage(a,f){this._updatedImages[f]=this._updatedImages[f]||new Set,this._updatedImages[f].add(s.I.toString(a)),this.setDirty()}resetUpdatedImages(a){this._updatedImages[a]&&this._updatedImages[a].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function _l(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class Ra extends s.E{constructor(a){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=a,a!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(a){this.loaded.set(a,!1),this.imageProviders.set(a,new Map),this.images.set(a,new Map),this.updatedImages.set(a,new Set),this.callbackDispatchedThisFrame.set(a,new Set),this.patterns.set(a,new Map),this.atlasImage.set(a,new s.q({width:1,height:1}))}removeScope(a){this.loaded.delete(a),this.imageProviders.delete(a),this.images.delete(a),this.updatedImages.delete(a),this.callbackDispatchedThisFrame.delete(a),this.patterns.delete(a),this.atlasImage.delete(a);const f=this.atlasTexture.get(a);f&&(f.destroy(),this.atlasTexture.delete(a))}addImageProvider(a,f){this.imageProviders.has(f)||this.imageProviders.set(f,new Map),this.imageProviders.get(f).set(a.id,a)}removeImageProvider(a,f){this.imageProviders.has(f)&&this.imageProviders.get(f).delete(a)}getPendingImageProviders(){const a=[];for(const f of this.imageProviders.values())for(const g of f.values())g.hasPendingRequests()&&a.push(g);return a}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const a of this.loaded.keys())if(!this.loaded.get(a))return!1;return!0}setLoaded(a,f){if(this.loaded.get(f)!==a&&(this.loaded.set(f,a),a)){for(const{ids:g,callback:b}of this.requestors)this._notify(g,f,b);this.requestors=[]}}hasImage(a,f){return!!this.getImage(a,f)}getImage(a,f){return this.images.get(f).get(a.toString())}addImage(a,f,g){this._validate(a,g)&&this.images.get(f).set(a.toString(),g)}_validate(a,f){let g=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new s.y(new Error(`Image "${a.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new s.y(new Error(`Image "${a.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(f.content,f)||(this.fire(new s.y(new Error(`Image "${a.name}" has invalid "content" value`))),g=!1),g}_validateStretch(a,f){if(!a)return!0;let g=0;for(const b of a){if(b[0]<g||b[1]<b[0]||f<b[1])return!1;g=b[1]}return!0}_validateContent(a,f){return a?a.length!==4||!f.usvg&&(a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3])?!1:!(a[2]<a[0]||a[3]<a[1]):!0}updateImage(a,f,g){const b=this.images.get(f).get(a.toString());g.version=b.version+1,this.images.get(f).set(a.toString(),g),this.updatedImages.get(f).add(a),this.removeFromImageRasterizerCache(a,f)}clearUpdatedImages(a){this.updatedImages.get(a).clear()}removeFromImageRasterizerCache(a,f){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[a],scope:f}):this.imageRasterizer.removeImagesFromCacheByIds([a],f))}removeImage(a,f){const g=this.images.get(f),b=g.get(a.toString());g.delete(a.toString()),this.patterns.get(f).delete(a.toString()),this.removeFromImageRasterizerCache(a,f),b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(a){return Array.from(this.images.get(a).keys()).map(f=>s.I.from(f))}getImages(a,f,g){const b=[],E=[],C=this.imageProviders.get(f);for(const B of a){if(!B.iconsetId){b.push(B);continue}const V=C.get(B.iconsetId);V&&(this.getImage(B,f)?E.push(B):V.addPendingRequest(B))}if(b.length===0)return void this._notify(E,f,g);let I=!0;const R=!!this.loaded.get(f),L=this.images.get(f);if(!R)for(const B of b)L.has(B.toString())||(I=!1);R||I?this._notify(b,f,g):this.requestors.push({ids:b,scope:f,callback:g})}rasterizeImages(a,f){const g=new Map,{tasks:b,scope:E}=a;for(const[C,I]of b.entries()){const R=this.getImage(I.id,E);R&&g.set(C,{image:R,imageVariant:I})}this._rasterizeImages(E,g,f)}_rasterizeImages(a,f,g){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:f,scope:a},g);else{const b=new Map;for(const[E,{image:C,imageVariant:I}]of f.entries())b.set(E,this.imageRasterizer.rasterize(I,C,a,0));g(void 0,b)}}getUpdatedImages(a){return this.updatedImages.get(a)||new Set}_notify(a,f,g){const b=this.images.get(f),E=new Map;for(const C of a){if(!b.get(C.toString())){if(C.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:C.name}))}const I=b.get(C.toString());if(!I){s.w(`Image "${C.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(R,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),E.set(s.I.toString(C),R)}g(null,E)}getPixelSize(a){const{width:f,height:g}=this.atlasImage.get(a);return{width:f,height:g}}getPattern(a,f,g){const b=a.toString(),E=this.patterns.get(f),C=E.get(b),I=this.getImage(a,f);if(!I)return null;if(C){if(C.position.version===I.version)return C.position;C.position.version=I.version}else{if(I.usvg&&!I.data){const R=this.getPatternInFlightId(b,f);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const L=new s.A(a).scaleSelf(s.o.devicePixelRatio),B=new Map([[L.toString(),{image:I,imageVariant:L}]]);return this._rasterizeImages(f,B,(V,j)=>this.storePatternImage(L,f,I,g,j)),null}this.storePattern(a,f,I)}return this._updatePatternAtlas(f,g),E.get(b).position}getPatternInFlightId(a,f){return s.B(a,f)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(a,f,g,b,E){const C=a.toString(),I=E?E.get(C):void 0;I&&(g.data=I,this.storePattern(a.id,f,g),this._updatePatternAtlas(f,b),this.patternsInFlight.delete(this.getPatternInFlightId(a.id.toString(),f)))}storePattern(a,f,g){const b={w:g.data.width+2*s.C,h:g.data.height+2*s.C,x:0,y:0},E=new s.F(b,g,s.C);this.patterns.get(f).set(a.toString(),{bin:b,position:E})}destroyAtlasTextures(){for(const a of this.atlasTexture.values())a&&a.destroy();this.atlasTexture.clear()}bind(a,f){const g=a.gl;let b=this.atlasTexture.get(f);b?this.dirty&&(b.update(this.atlasImage.get(f)),this.dirty=!1):(b=new s.T(a,this.atlasImage.get(f),g.RGBA8),this.atlasTexture.set(f,b)),b.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(a,f){const g=this.patterns.get(a),b=Array.from(g.values()).map(({bin:L})=>L),{w:E,h:C}=s.G(b),I=this.atlasImage.get(a);I.resize({width:E||1,height:C||1});const R=this.images.get(a);for(const[L,{bin:B,position:V}]of g.entries()){let j=V.padding;const W=B.x+j,Y=B.y+j,Z=R.get(L).data,J=Z.width,ie=Z.height;j=j>1?j-1:j,s.q.copy(Z,I,{x:0,y:0},{x:W,y:Y},{width:J,height:ie},f),s.q.copy(Z,I,{x:0,y:ie-j},{x:W,y:Y-j},{width:J,height:j},f),s.q.copy(Z,I,{x:0,y:0},{x:W,y:Y+ie},{width:J,height:j},f),s.q.copy(Z,I,{x:J-j,y:0},{x:W-j,y:Y},{width:j,height:ie},f),s.q.copy(Z,I,{x:0,y:0},{x:W+J,y:Y},{width:j,height:ie},f),s.q.copy(Z,I,{x:J-j,y:ie-j},{x:W-j,y:Y-j},{width:j,height:j},f),s.q.copy(Z,I,{x:0,y:ie-j},{x:W+J,y:Y-j},{width:j,height:j},f),s.q.copy(Z,I,{x:0,y:0},{x:W+J,y:Y+ie},{width:j,height:j},f),s.q.copy(Z,I,{x:J-j,y:0},{x:W-j,y:Y+ie},{width:j,height:j},f)}this.dirty=!0}beginFrame(){for(const a of this.images.keys())this.callbackDispatchedThisFrame.set(a,new Set)}dispatchRenderCallbacks(a,f){const g=this.images.get(f);for(const b of a){if(this.callbackDispatchedThisFrame.get(f).has(b.toString()))continue;this.callbackDispatchedThisFrame.get(f).add(b.toString());const E=g.get(b.toString());_l(E)&&this.updateImage(b,f,E)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Lo(m){const a=m.value,f=m.valueSpec,g=m.style,b=m.styleSpec,E=m.key,C=m.arrayElementValidator||zi;if(!Array.isArray(a))return[new s.V(E,a,`array expected, ${s.K(a)} found`)];if(f.length&&a.length!==f.length)return[new s.V(E,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new s.V(E,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let I={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};b.$version<7&&(I.function=f.function),s.H(f.value)&&(I=f.value);let R=[];for(let L=0;L<a.length;L++)R=R.concat(C({array:a,arrayIndex:L,value:a[L],valueSpec:I,style:g,styleSpec:b,key:`${E}[${L}]`},!0));return R}function oc(m){const a=m.key,f=m.value,g=m.valueSpec;if(!s.L(f))return[new s.V(a,f,`number expected, ${s.K(f)} found`)];if(f!=f)return[new s.V(a,f,"number expected, NaN found")];if("minimum"in g){let b=g.minimum;if(Array.isArray(g.minimum)&&(b=g.minimum[m.arrayIndex]),f<b)return[new s.V(a,f,`${f} is less than the minimum value ${b}`)]}if("maximum"in g){let b=g.maximum;if(Array.isArray(g.maximum)&&(b=g.maximum[m.arrayIndex]),f>b)return[new s.V(a,f,`${f} is greater than the maximum value ${b}`)]}return[]}function Bo(m){const a=m.key,f=m.value;if(!s.H(f))return[new s.V(a,f,`object expected, ${s.K(f)} found`)];const g=m.valueSpec,b=s.J(f.type);let E,C,I,R={};const L=b!=="categorical"&&f.property===void 0,B=!L,V=function(Z){const J=Z.stops;return Array.isArray(J)&&Array.isArray(J[0])&&s.H(J[0][0])}(f),j=Ps({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(Z){if(b==="identity")return[new s.V(Z.key,Z.value,'identity function may not have a "stops" property')];let J=[];const ie=Z.value;return J=J.concat(Lo({key:Z.key,value:ie,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:W})),Array.isArray(ie)&&ie.length===0&&J.push(new s.V(Z.key,ie,"array must have at least one stop")),J},default:function(Z){return zi({key:Z.key,value:Z.value,valueSpec:g,style:Z.style,styleSpec:Z.styleSpec})}}});return b==="identity"&&L&&j.push(new s.V(m.key,m.value,'missing required property "property"')),b==="identity"||f.stops||j.push(new s.V(m.key,m.value,'missing required property "stops"')),b==="exponential"&&g.expression&&!s.M(g)&&j.push(new s.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(B&&!s.N(g)?j.push(new s.V(m.key,m.value,"property functions not supported")):L&&!s.O(g)&&j.push(new s.V(m.key,m.value,"zoom functions not supported"))),b!=="categorical"&&!V||f.property!==void 0||j.push(new s.V(m.key,m.value,'"property" property is required')),j;function W(Z){let J=[];const ie=Z.value,pe=Z.key;if(!Array.isArray(ie))return[new s.V(pe,ie,`array expected, ${s.K(ie)} found`)];if(ie.length!==2)return[new s.V(pe,ie,`array length 2 expected, length ${ie.length} found`)];if(V){if(!s.H(ie[0]))return[new s.V(pe,ie,`object expected, ${s.K(ie[0])} found`)];const fe=ie[0];if(fe.zoom===void 0)return[new s.V(pe,ie,"object stop key must have zoom")];if(fe.value===void 0)return[new s.V(pe,ie,"object stop key must have value")];const ce=s.J(fe.zoom);if(typeof ce!="number")return[new s.V(pe,fe.zoom,"stop zoom values must be numbers")];if(I&&I>ce)return[new s.V(pe,fe.zoom,"stop zoom values must appear in ascending order")];ce!==I&&(I=ce,C=void 0,R={}),J=J.concat(Ps({key:`${pe}[0]`,value:ie[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:oc,value:Y}}))}else J=J.concat(Y({key:`${pe}[0]`,value:ie[0],style:Z.style,styleSpec:Z.styleSpec},ie));return s.Q(s.S(ie[1]))?J.concat([new s.V(`${pe}[1]`,ie[1],"expressions are not allowed in function stops.")]):J.concat(zi({key:`${pe}[1]`,value:ie[1],valueSpec:g,style:Z.style,styleSpec:Z.styleSpec}))}function Y(Z,J){const ie=s.K(Z.value),pe=s.J(Z.value),fe=Z.value!==null?Z.value:J;if(E){if(ie!==E)return[new s.V(Z.key,fe,`${ie} stop domain type must match previous stop domain type ${E}`)]}else E=ie;if(ie!=="number"&&ie!=="string"&&ie!=="boolean"&&typeof pe!="number"&&typeof pe!="string"&&typeof pe!="boolean")return[new s.V(Z.key,fe,"stop domain value must be a number, string, or boolean")];if(ie!=="number"&&b!=="categorical"){let ce=`number expected, ${ie} found`;return s.N(g)&&b===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(Z.key,fe,ce)]}return b!=="categorical"||ie!=="number"||typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe?b!=="categorical"&&ie==="number"&&typeof pe=="number"&&typeof C=="number"&&C!==void 0&&pe<C?[new s.V(Z.key,fe,"stop domain values must appear in ascending order")]:(C=pe,b==="categorical"&&pe in R?[new s.V(Z.key,fe,"stop domain values must be unique")]:(R[pe]=!0,[])):[new s.V(Z.key,fe,`integer expected, found ${String(pe)}`)]}}function Js(m){const a=(m.expressionContext==="property"?s.W:s.U)(s.S(m.value),m.valueSpec);if(a.result==="error")return a.value.map(g=>new s.V(`${m.key}${g.key}`,m.value,g.message));const f=a.value.expression||a.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!f.outputDefined())return[new s.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!s.Z(f))return[new s.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return zs(f,m);if(m.expressionContext==="appearance")return ts(f,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!s.X(f,["zoom","feature-state"]))return[new s.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!s.Y(f))return[new s.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zs(m,a){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const b of a.valueSpec.expression.parameters)f.delete(b);if(f.size===0)return[];const g=[];return m instanceof s._&&f.has(m.name)?[new s.V(a.key,a.value,`["${m.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(m.eachChild(b=>{g.push(...zs(b,a))}),g)}function ts(m,a){const f=new Set;if(a.valueSpec&&a.valueSpec.expression)for(const b of a.valueSpec.expression.parameters)f.add(b);if(f.size===0)return[];const g=[];return m instanceof s._&&!f.has(m.name)?[new s.V(a.key,a.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild(b=>{g.push(...ts(b,a))}),g)}function co(m){const a=m.key,f=m.value,g=m.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(s.J(f))===-1&&b.push(new s.V(a,f,`expected one of [${g.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(g.values).indexOf(s.J(f))===-1&&b.push(new s.V(a,f,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function Fc(m){return s.a2(s.S(m.value))?Js(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):wl(m)}function wl(m){const a=m.value,f=m.key;if(!Array.isArray(a))return[new s.V(f,a,`array expected, ${s.K(a)} found`)];if(a.length<1)return[new s.V(f,a,"filter array must have at least 1 element")];const g=m.styleSpec;let b=co({key:`${f}[0]`,value:a[0],valueSpec:g.filter_operator});const E=()=>{a.length>=2&&(s.a0(a[1])||b.push(new s.V(`${f}[1]`,a[1],`string expected, ${s.K(a[1])} found`)));for(let C=2;C<a.length;C++)s.J(a[1])==="$type"?b=b.concat(co({key:`${f}[${C}]`,value:a[C],valueSpec:g.geometry_type})):s.a0(a[C])||s.L(a[C])||s.$(a[C])||b.push(new s.V(`${f}[${C}]`,a[C],`string, number, or boolean expected, ${s.K(a[C])} found.`))};switch(s.J(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&s.J(a[1])==="$type"&&b.push(new s.V(f,a,`"$type" cannot be use with operator "${a[0]}"`)),a.length!==3&&b.push(new s.V(f,a,`filter array for operator "${a[0]}" must have 3 elements`)),E();break;case"==":case"!=":a.length!==3&&b.push(new s.V(f,a,`filter array for operator "${a[0]}" must have 3 elements`)),E();break;case"in":case"!in":E();break;case"any":case"all":case"none":for(let C=1;C<a.length;C++)b=b.concat(wl({key:`${f}[${C}]`,value:a[C],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":a.length!==2?b.push(new s.V(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):s.a0(a[1])||b.push(new s.V(`${f}[1]`,a[1],`string expected, ${s.K(a[1])} found`))}return b}function hs(m,a){const f=m.key,g=m.style,b=m.layer,E=m.styleSpec,C=m.value,I=m.objectKey,R=E[`${a}_${m.layerType}`];if(!R)return[];const L=I.match(/^(.*)-use-theme$/);if(L&&R[L[1]])return s.Q(s.S(C))?[].concat(zi({key:f,value:C,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:E,expressionContext:"property",propertyType:a,propertyKey:I})):zi({key:f,value:C,valueSpec:{type:"string"},style:g,styleSpec:E});const B=I.match(/^(.*)-transition$/);if(a==="paint"&&B&&R[B[1]]&&R[B[1]].transition)return zi({key:f,value:C,valueSpec:E.transition,style:g,styleSpec:E});const V=m.valueSpec||R[I];if(!V)return[new s.a3(f,C,`unknown property "${I}"`)];let j;if(s.a0(C)&&s.N(V)&&!V.tokens&&(j=/^{([^}]+)}$/.exec(C))){const Y=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new s.V(f,C,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${Y}.`)]}const W=[];if(m.layerType==="symbol")I!=="text-field"||!g||g.glyphs||g.imports||W.push(new s.V(f,C,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(C))&&s.J(C.type)==="identity"&&W.push(new s.V(f,C,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&a==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&s.N(V)&&(s.a5(V)||s.O(V))){const Y=s.W(s.S(C),V).value,Z="expression"in Y&&Y.expression||"_styleExpression"in Y&&Y._styleExpression&&Y._styleExpression.expression;Z&&!s.X(Z,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(Z)&&s.Z(Z)||W.push(new s.V(f,C,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(zi({key:m.key,value:C,valueSpec:V,style:g,styleSpec:E,expressionContext:"property",propertyType:a,propertyKey:I}))}function Id(m){return hs(m,"paint")}function Fo(m){return hs(m,"layout")}function Lu(m){let a=[];const f=m.value,g=m.key,b=m.style,E=m.styleSpec;if(!s.H(f))return[new s.V(g,f,"object expected")];f.type||f.ref||a.push(new s.V(g,f,'either "type" or "ref" is required'));let C=s.J(f.type);const I=s.J(f.ref);if(f.id){const R=s.J(f.id);for(let L=0;L<m.arrayIndex;L++){const B=b.layers[L];s.J(B.id)===R&&a.push(new s.V(g,f.id,`duplicate layer id "${R}", previously used at line ${B.id.__line__}`))}}if("ref"in f){let R;["type","source","source-layer","filter","layout"].forEach(L=>{L in f&&a.push(new s.V(g,f[L],`"${L}" is prohibited for ref layers`))}),b.layers.forEach(L=>{s.J(L.id)===I&&(R=L)}),R?R.ref?a.push(new s.V(g,f.ref,"ref cannot reference another ref layer")):C=s.J(R.type):typeof I=="string"&&a.push(new s.V(g,f.ref,`ref layer "${I}" not found`))}else if(C!=="background"&&C!=="sky"&&C!=="slot")if(f.source)if(s.a0(f.source)){const R=b.sources&&b.sources[f.source],L=R&&s.J(R.type);R?L==="vector"&&C==="raster"?a.push(new s.V(g,f.source,`layer "${f.id}" requires a raster source`)):L==="raster"&&C!=="raster"?a.push(new s.V(g,f.source,`layer "${f.id}" requires a vector source`)):L!=="vector"||f["source-layer"]?L==="raster-dem"&&C!=="hillshade"?a.push(new s.V(g,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(C)?C==="line"&&f.paint&&(f.paint["line-gradient"]||f.paint["line-trim-offset"])&&L==="geojson"&&!R.lineMetrics?a.push(new s.V(g,f,`layer "${f.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):C==="raster-particle"&&L!=="raster-array"&&a.push(new s.V(g,f.source,`layer "${f.id}" requires a 'raster-array' source.`)):a.push(new s.V(g,f.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new s.V(g,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new s.V(g,f.source,`source "${f.source}" not found`))}else a.push(new s.V(`${g}.source`,f.source,'"source" must be a string'));else a.push(new s.V(g,f,'missing required property "source"'));return a=a.concat(Ps({key:g,value:f,valueSpec:E.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zi({key:`${g}.type`,value:f.type,valueSpec:E.layer.type,style:m.style,styleSpec:m.styleSpec,object:f,objectKey:"type"}),filter:R=>Fc(Object.assign({layerType:C},R)),layout:R=>Ps({layer:f,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Fo(Object.assign({layerType:C},L))}}),paint:R=>Ps({layer:f,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Id(Object.assign({layerType:C,layer:f},L))}}),appearances(R){const L=Lo({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:j=>function(W){const{key:Y,layer:Z,layerType:J}=W,ie=s.J(W.value),pe=s.J(ie.name),fe=s.J(ie.condition),ce=Ps({key:Y,value:ie,valueSpec:W.styleSpec.appearance,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{condition:Re=>function(Ce){const Se=[];return Se.push(...Js({key:Ce.key,value:Ce.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Se}(Object.assign({layer:Z,layerType:J},Re)),properties:Re=>function(Ce){const Se=[],{styleSpec:be,layer:ye,layerType:Ne}=Ce,We=be[`paint_${Ne}`],Ze=be[`layout_${Ne}`],tt=Ce.object[Ce.objectKey];for(const Je in tt){const mt=Je in We?"paint":Je in Ze?"layout":void 0;if(!mt){Se.push(new s.V(Ce.key,Je,`unknown property "${Je}" for layer type "${Ne}"`));continue}const xt=Object.assign({},Ce,{key:`${Ce.key}.${Je}`,object:tt,objectKey:Je,layer:ye,layerType:Ne,value:tt[Je],valueSpec:mt==="paint"?We[Je]:Ze[Je]});Se.push(...hs(xt,mt))}return Se}(Object.assign({layer:Z,layerType:J},Re))}});return pe!=="hidden"&&fe===void 0&&ce.push(new s.V(W.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:C,layer:f},j))}),B=Array.isArray(R.value)?R.value:[],V=new Set;return B.forEach((j,W)=>{const Y=s.J(j.name);if(Y)if(V.has(Y)){const Z=s.J(f.id);L.push(new s.V(R.key,Y,`Duplicated appearance name "${Y}" for layer "${Z}"`))}else V.add(Y)}),L}}})),a}function $o({key:m,value:a}){return s.a0(a)?[]:[new s.V(m,a,`string expected, ${s.K(a)} found`)]}const Is={promoteId:function m({key:a,value:f}){if(s.a0(f))return $o({key:a,value:f});if(Array.isArray(f)){const b=[],E=s.S(f),C=s.U(E);return C.result==="error"&&C.value.forEach(I=>{b.push(new s.V(`${a}${I.key}`,null,`${I.message}`))}),s.X(C.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||b.push(new s.V(`${a}`,null,"promoteId expression should be only feature dependent")),b}if(!s.H(f))return[new s.V(a,f,`string, expression or object expected, "${s.K(f)}" found`)];const g=[];for(const b in f)g.push(...m({key:`${a}.${b}`,value:f[b]}));return g}};function zo(m){const a=m.value,f=m.key,g=m.styleSpec,b=m.style;if(!s.H(a))return[new s.V(f,a,`object expected, ${s.K(a)} found`)];if(!("type"in a))return[new s.V(f,a,'"type" is required')];const E=s.J(a.type);let C=[];switch(["vector","raster","raster-dem","raster-array"].includes(E)&&("url"in a||"tiles"in a||C.push(new s.a3(f,a,'Either "url" or "tiles" is required.'))),E){case"vector":case"raster":case"raster-dem":case"raster-array":return C=C.concat(Ps({key:f,value:a,valueSpec:g[`source_${E.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Is})),C;case"geojson":if(C=Ps({key:f,value:a,valueSpec:g.source_geojson,style:b,styleSpec:g,objectElementValidators:Is}),"cluster"in a&&"clusterProperties"in a){if(!s.H(a.clusterProperties))return[new s.V(`${f}.clusterProperties`,a,`object expected, ${s.K(a)} found`)];for(const I in a.clusterProperties){const R=a.clusterProperties[I];if(!Array.isArray(R))return[new s.V(`${f}.clusterProperties.${I}`,R,"array expected")];const[L,B]=R,V=typeof L=="string"?[L,["accumulated"],["get",I]]:L;C.push(...Js({key:`${f}.${I}.map`,value:B,expressionContext:"cluster-map"})),C.push(...Js({key:`${f}.${I}.reduce`,value:V,expressionContext:"cluster-reduce"}))}}return C;case"video":return Ps({key:f,value:a,valueSpec:g.source_video,style:b,styleSpec:g});case"image":return Ps({key:f,value:a,valueSpec:g.source_image,style:b,styleSpec:g});case"canvas":return[new s.V(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return co({key:`${f}.type`,value:a.type,valueSpec:{values:bl(g)}})}}function bl(m){return m.source.reduce((a,f)=>{const g=m[f];return g.type.type==="enum"&&(a=a.concat(Object.keys(g.type.values||{}))),a},[])}function Zl(m){const a=m.value,f=m.styleSpec,g=f.light,b=m.style;if(a===void 0)return[];if(!s.H(a))return[new s.V("light",a,`object expected, ${s.K(a)} found`)];let E=[];for(const C in a){const I=C.match(/^(.*)-transition$/),R=C.match(/^(.*)-use-theme$/);E=E.concat(R&&g[R[1]]?zi({key:C,value:a[C],valueSpec:{type:"string"},style:b,styleSpec:f}):I&&g[I[1]]&&g[I[1]].transition?zi({key:C,value:a[C],valueSpec:f.transition,style:b,styleSpec:f}):g[C]?zi({key:C,value:a[C],valueSpec:g[C],style:b,styleSpec:f}):[new s.V(C,a[C],`unknown property "${C}"`)])}return E}function $c(m){const a=m.value;if(!a)return[];const f=m.key;if(!s.H(a))return[new s.V(f,a,`object expected, ${s.K(a)} found`)];let g=[];const b=m.styleSpec,E=b["light-3d"],C=m.style,I=m.style.lights;for(const B of["type","id"])if(!(B in a))return g=g.concat([new s.V(f,a,`missing property "${B}"`)]),g;if(!s.a0(a.type))return g=g.concat([new s.V(`${f}.type`,a.type,"string expected")]),g;if(I)for(let B=0;B<m.arrayIndex;B++){const V=s.J(a.type),j=I[B];s.J(j.type)===V&&g.push(new s.V(f,a.id,`duplicate light type "${a.type}", previously defined at line ${j.id.__line__}`))}const R=`properties_light_${a.type}`;if(!(R in b))return g=g.concat([new s.V(`${f}.type`,a,`Invalid light type ${a.type}`)]),g;const L=b[R];for(const B in a)if(B==="properties"){const V=a[B];if(!s.H(V))return g=g.concat([new s.V("properties",V,`object expected, ${s.K(V)} found`)]),g;for(const j in V){const W=j.match(/^(.*)-transition$/),Y=j.match(/^(.*)-use-theme$/);g=g.concat(Y&&L[Y[1]]?zi({key:B,value:V[j],valueSpec:{type:"string"},style:C,styleSpec:b}):W&&L[W[1]]&&L[W[1]].transition?zi({key:B,value:a[B],valueSpec:b.transition,style:C,styleSpec:b}):L[j]?zi({key:j,value:V[j],valueSpec:L[j],style:C,styleSpec:b}):[new s.a3(m.key,V[j],`unknown property "${j}"`)])}}else g=g.concat(E[B]?zi({key:B,value:a[B],valueSpec:E[B],style:C,styleSpec:b}):[new s.a3(B,a[B],`unknown property "${B}"`)]);return g}function vl(m){const a=m.value,f=m.key,g=m.style,b=m.styleSpec,E=b.terrain;if(a==null)return[];if(!s.H(a))return[new s.V("terrain",a,`object expected, ${s.K(a)} found`)];let C=[];for(const I in a){const R=I.match(/^(.*)-transition$/),L=I.match(/^(.*)-use-theme$/);C=C.concat(L&&E[L[1]]?zi({key:I,value:a[I],valueSpec:{type:"string"},style:g,styleSpec:b}):R&&E[R[1]]&&E[R[1]].transition?zi({key:I,value:a[I],valueSpec:b.transition,style:g,styleSpec:b}):E[I]?zi({key:I,value:a[I],valueSpec:E[I],style:g,styleSpec:b}):[new s.a3(I,a[I],`unknown property "${I}"`)])}if(a.source)if(s.a0(a.source)){const I=g.sources&&g.sources[a.source],R=I&&s.J(I.type);I?R!=="raster-dem"&&C.push(new s.V(`${f}.source`,a.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):C.push(new s.V(`${f}.source`,a.source,`source "${a.source}" not found`))}else C.push(new s.V(`${f}.source`,a.source,"source must be a string"));else C.push(new s.V(f,a,'terrain is missing required property "source"'));return C}function Kl(m){const a=m.value,f=m.style,g=m.styleSpec,b=g.fog;if(a===void 0)return[];if(!s.H(a))return[new s.V("fog",a,`object expected, ${s.K(a)} found`)];let E=[];for(const C in a){const I=C.match(/^(.*)-transition$/),R=C.match(/^(.*)-use-theme$/);E=E.concat(R&&b[R[1]]?zi({key:C,value:a[C],valueSpec:{type:"string"},style:f,styleSpec:g}):I&&b[I[1]]&&b[I[1]].transition?zi({key:C,value:a[C],valueSpec:g.transition,style:f,styleSpec:g}):b[C]?zi({key:C,value:a[C],valueSpec:b[C],style:f,styleSpec:g}):[new s.a3(C,a[C],`unknown property "${C}"`)])}return E}const Yl={"*":()=>[],array:Lo,boolean:function(m){const a=m.value,f=m.key;return s.$(a)?[]:[new s.V(f,a,`boolean expected, ${s.K(a)} found`)]},number:oc,color:function({key:m,value:a}){return s.a0(a)?s.a1.parseCSSColor(a)===null?[new s.V(m,a,`color expected, "${a}" found`)]:[]:[new s.V(m,a,`color expected, ${s.K(a)} found`)]},enum:co,filter:Fc,function:Bo,layer:Lu,object:Ps,source:zo,model:s.a7,light:Zl,"light-3d":$c,terrain:vl,fog:Kl,string:$o,formatted:function(m){return $o(m).length===0?[]:Js(m)},resolvedImage:function(m){return $o(m).length===0?[]:Js(m)},projection:function(m){const a=m.value,f=m.styleSpec,g=f.projection,b=m.style;if(s.H(a)){let E=[];for(const C in a)E=E.concat(zi({key:C,value:a[C],valueSpec:g[C],style:b,styleSpec:f}));return E}return s.a0(a)?[]:[new s.V("projection",a,`object or string expected, ${s.K(a)} found`)]},import:function(m){const a=m.key,{value:f,styleSpec:g}=m;if(!s.H(f))return[new s.V(a,f,"import must be an object")];const{data:b,...E}=f;Object.defineProperty(E,"__line__",{value:f.__line__,enumerable:!1});let C=Ps(Object.assign({},m,{value:E,valueSpec:g.import}));return s.J(E.id)===""&&C.push(new s.V(`${m.key}.id`,E,"import id can't be an empty string")),b&&(C=C.concat(cr(b,g,{key:`${m.key}.data`}))),C},iconset:function(m){const a=m.value,f=m.key,g=m.styleSpec,b=m.style;if(!s.H(a))return[new s.V(f,a,"object expected")];if(!a.type)return[new s.V(f,a,'"type" is required')];const E=s.J(a.type);let C=[];if(C=C.concat(Ps({key:f,value:a,valueSpec:g[`iconset_${E}`],style:b,styleSpec:g})),function(I,R){return!(I!=="source"||!R.source)}(E,a)){const I=b.sources&&b.sources[a.source],R=I&&s.J(I.type);I?R!=="raster-array"&&C.push(new s.V(f,a.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):C.push(new s.V(f,a.source,`source "${a.source}" not found`))}return C}};function zi(m,a=!1){const f=m.value,g=m.valueSpec,b=m.styleSpec;if(g.expression){if(s.a4(s.J(f)))return Bo(m);if(s.Q(s.S(f)))return Js(m)}if(g.type&&Yl[g.type]){const E=Yl[g.type](m);return a===!0&&E.length>0&&Array.isArray(m.value)?Js(m):E}return Ps(Object.assign({},m,{valueSpec:g.type?b[g.type]:g}))}function Ps(m){const a=m.key,f=m.value,g=m.valueSpec||{},b=m.objectElementValidators||{},E=m.style,C=m.styleSpec;if(!s.H(f))return[new s.V(a,f,`object expected, ${s.K(f)} found`)];let I=[];for(const R in f){const L=R.split(".")[0];let B;b[L]?B=b[L]:g[L]?B=zi:b["*"]?B=b["*"]:g["*"]&&(B=zi),B?I=I.concat(B({key:(a&&`${a}.`)+R,value:f[R],valueSpec:g[L]||g["*"],style:E,styleSpec:C,object:f,objectKey:R},f)):I.push(new s.a3(a,f[R],`unknown property "${R}"`))}for(const R in g){if(b[R])continue;const L=g[R];L.required&&L.default===void 0&&f[R]===void 0&&I.push(new s.V(a,f,`missing required property "${R}"`))}return I}function Si({key:m,value:a}){const f=$o({key:m,value:a});if(f.length)return f;const g=a;return g.indexOf("{fontstack}")===-1&&f.push(new s.V(m,a,'"glyphs" url must include a "{fontstack}" token')),g.indexOf("{range}")===-1&&f.push(new s.V(m,a,'"glyphs" url must include a "{range}" token')),f}function cr(m,a=s.a6,f={}){return Ps({key:f.key||"",value:m,valueSpec:Object.assign(a.$root,{"*":{type:"*"}}),styleSpec:a,style:m,objectElementValidators:{glyphs:Si}})}function Zi(m,a=s.a6){return ve(cr(m,a))}const ua=m=>ve(zo(m)),lo=m=>ve(Zl(m)),Tt=m=>ve($c(m)),bo=m=>ve(vl(m)),da=m=>ve(Kl(m)),Oa=m=>ve(function(a){const f=a.value,g=a.style,b=a.styleSpec,E=b.snow;if(f===void 0)return[];if(!s.H(f))return[new s.V("snow",f,`object expected, ${s.K(f)} found`)];let C=[];for(const I in f){const R=I.match(/^(.*)-transition$/);C=C.concat(R&&E[R[1]]&&E[R[1]].transition?zi({key:I,value:f[I],valueSpec:b.transition,style:g,styleSpec:b}):E[I]?zi({key:I,value:f[I],valueSpec:E[I],style:g,styleSpec:b}):[new s.a3(I,f[I],`unknown property "${I}"`)])}return C}(m)),_i=m=>ve(function(a){const f=a.value,g=a.style,b=a.styleSpec,E=b.rain;if(f===void 0)return[];if(!s.H(f))return[new s.V("rain",f,`object expected, ${s.K(f)} found`)];let C=[];for(const I in f){const R=I.match(/^(.*)-transition$/);C=C.concat(R&&E[R[1]]&&E[R[1]].transition?zi({key:I,value:f[I],valueSpec:b.transition,style:g,styleSpec:b}):E[I]?zi({key:I,value:f[I],valueSpec:E[I],style:g,styleSpec:b}):[new s.a3(I,f[I],`unknown property "${I}"`)])}return C}(m)),qe=m=>ve(Lu(m)),ee=m=>ve(Fc(m)),ae=m=>ve(Id(m)),_e=m=>ve(Fo(m)),$e=m=>ve(s.a7(m));function ve(m){return m.slice().sort((a,f)=>a.line&&f.line?a.line-f.line:0)}function Ve(m,a){let f=!1;if(a&&a.length)for(const g of a)g instanceof s.a3?s.w(g.message):(m.fire(new s.y(new Error(g.message))),f=!0);return f}const et=s.a6.light;let Ge;class rt extends s.E{constructor(a,f="flat"){super(),this._transitionable=new s.a8(Ge||(Ge=new s.a9({anchor:new s.aa(et.anchor),position:new s.ab(et.position),color:new s.aa(et.color),intensity:new s.aa(et.intensity)}))),this.setLight(a,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f,g={}){this._validate(lo,a,g)||(this._transitionable.setTransitionOrValue(a),this.id=f)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,g){return(!g||g.validate!==!1)&&Ve(this,a.call(Zi,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const It=s.a6.terrain;let At=class extends s.E{constructor(m,a,f,g,b){super(),this.scope=f,this._transitionable=new s.a8(new s.a9({source:new s.aa(It.source),exaggeration:new s.aa(It.exaggeration)}),f,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a,this.worldview=b}get(){return this._transitionable.serialize()}set(m,a){this._transitionable.setTransitionOrValue(m,a)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new s.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const a=m.value.expression;if(!a)return null;let f=-1,g=-1,b=1;for(const E of a.zoomStops)b=a.evaluate(new s.ac(E,{worldview:this.worldview})),b>.01?(f=E,g=-1):g=E;return b<.01&&f>0&&g>f?[f,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof s.ad}};const Xt=.05;function pn(m,a,f,g){const b=s.ah(45,65,f),[E,C]=bn(m,g);let I=1-Math.min(1,Math.exp((a-E)/(C-E)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*b*m.alpha}function bn(m,a){const f=.5/Math.tan(.5*a);return[m.range[0]+f,m.range[1]+f]}function $n(m,a,f,g,b){const E=s.af([],[a,f,g],b.mercatorFogMatrix);return pn(m,s.ag(E),b.pitch,b._fov)}function Yn(m,a,f,g,b,E,C){const I=[[f,g,0],[b,g,0],[b,E,0],[f,E,0]];let R=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const B of I){const V=s.af([],B,a),j=s.ag(V);R=Math.min(R,j),L=Math.max(L,j)}return[pn(m,R,C.pitch,C._fov),pn(m,L,C.pitch,C._fov)]}const kn=s.a6.fog;class In extends s.E{constructor(a,f,g,b){super();const E=new s.a9({range:new s.aa(kn.range),color:new s.aa(kn.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(kn["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(kn["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(kn["horizon-blend"]),"star-intensity":new s.aa(kn["star-intensity"]),"vertical-range":new s.aa(kn["vertical-range"])});this._transitionable=new s.a8(E,g,new Map(b)),this.set(a,b),this._transitioning=this._transitionable.untransitioned(),this._transform=f,this.properties=new s.ai(E),this.scope=g}get state(){const a=this._transform,f=a.projection.name==="globe",g=s.aj(a.zoom),b=this.properties.get("range"),E=[.5,3];return{range:f?[s.ak(E[0],b[0],g),s.ak(E[1],b[1],g)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f,g={}){if(this._validate(da,a,g))return;const b=Object.assign({},a);for(const E of Object.keys(kn))b[E]===void 0&&(b[E]=kn[E].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,f)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(45,65,a))*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?function(g,b,E){const C=s.ae.fromLngLat(b),I=E.elevation?E.elevation.getAtPointOrZero(C):0;return $n(g,C.x,C.y,I,E)}(this.state,a,f):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Yn(this.state,f,0,0,s.al,s.al,this._transform)}getOpacityForBounds(a,f,g,b,E){return this._transform.projection.supportsFog?Yn(this.state,a,f,g,b,E,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?bn(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const g of f){const b=a.points[g];let E;if(b[2]>=0)E=b;else{const C=a.points[g-4];E=s.am(C,b,C[2]/(C[2]-b[2]))}if($n(this.state,E[0],E[1],0,this._transform)>=Xt)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,g){return(!g||g.validate!==!1)&&Ve(this,a.call(Zi,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let tr,ss,Nr,Mr=class extends s.E{constructor(m,a,f,g){super();const b=tr||(tr=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(b,f,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(b),this.scope=f}get state(){const m=this.properties.get("opacity"),a=this.properties.get("color"),f=this.properties.get("direction"),g=s.an(f[0]),b=-Math.max(s.an(f[1]),.01),E=[Math.cos(g)*Math.cos(b),Math.sin(g)*Math.cos(b),Math.sin(b)],C=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=C,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(a.r,a.g,a.b,a.a*m),direction:E,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(m,a,f={}){if(this._validate(Oa,m,f))return;const g=Object.assign({},m),b=s.a6.snow;for(const E of Object.keys(b))g[E]===void 0&&(g[E]=b[E].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,a,f){return(!f||f.validate!==!1)&&Ve(this,m.call(Zi,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},dr=class extends s.E{constructor(m,a,f,g){super();const b=ss||(ss=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(b,f,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(b),this.scope=f}get state(){const m=this.properties.get("opacity"),a=this.properties.get("color"),f=this.properties.get("direction"),g=s.an(f[0]),b=-Math.max(s.an(f[1]),.01),E=[Math.cos(g)*Math.cos(b),Math.sin(g)*Math.cos(b),Math.sin(b)],C=this.properties.get("vignette-color");return C.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(a.r,a.g,a.b,a.a*m),direction:E,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(m,a,f={}){if(this._validate(_i,m,f))return;const g=Object.assign({},m),b=s.a6.rain;for(const E of Object.keys(b))g[E]===void 0&&(g[E]=b[E].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,a,f){return(!f||f.validate!==!1)&&Ve(this,m.call(Zi,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class fi extends s.E{constructor(a,f,g,b){super(),this.scope=g,this._options=a,this.properties=new s.ai(f),this._transitionable=new s.a8(f,g,new Map(b)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,f){this._options=a,this._transitionable.setTransitionOrValue(a.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const mr=()=>Nr||(Nr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)}));let Wi;const Hi=()=>Wi||(Wi=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new s.aa(s.a6.properties_light_directional["shadow-draw-before-layer"])}));class Pr{constructor(a,f,g){this.screenBounds=a,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(a,f){let g,b;if(a instanceof s.P||typeof a[0]=="number"){const E=s.P.convert(a);g=[E],b=f.isPointAboveHorizon(E)}else{const E=s.P.convert(a[0]),C=s.P.convert(a[1]),I=E.add(C)._div(2);g=[E,C],b=s.aq(E,C).every(R=>f.isPointAboveHorizon(R))&&f.isPointAboveHorizon(I)}return new Pr(g,b,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],b=s.aq(f,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<g.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?b[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(b[3]=this.cameraPoint)),s.ar(b,a)}bufferedCameraGeometryGlobe(a){const f=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],b=s.aq(f,g,a),E=this.cameraPoint.clone();switch(3*((E.y>f.y)+(E.y>g.y))+((E.x>f.x)+(E.x>g.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(a,f,g,b=0){const E=Math.max(a.queryPadding,a.evaluateQueryRenderedFeaturePadding())/f._pixelsPerMercatorPixel+1,C=g?this._bufferedCameraMercator(E,f):this._bufferedScreenMercator(E,f);let I=a.tileID.wrap+(C.unwrapped?b:0);const R=C.polygon.map(J=>s.as(a.tileTransform,J,I));if(!s.at(R,0,0,s.al,s.al))return;I=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const L=this.screenGeometryMercator.polygon.map(J=>s.au(a.tileTransform,J,I)),B=L.map(J=>new s.P(J[0],J[1])),V=f.getFreeCameraOptions().position||new s.ae(0,0,0),j=s.au(a.tileTransform,V,I),W=L.map(J=>{const ie=s.av(J,J,j);return s.aw(ie,ie),new s.ax(j,ie)}),Y=s.ay(a,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:W,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(Z=s.az(R),Z.min.x=s.aA(Z.min.x,0,s.al),Z.min.y=s.aA(Z.min.y,0,s.al),Z.max.x=s.aA(Z.max.x,0,s.al),Z.max.y=s.aA(Z.max.y,0,s.al),Z),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:Y};var Z}_bufferedScreenMercator(a,f){const g=fs(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let b;return b=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),f):{polygon:this.bufferedScreenGeometry(a).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[g]=b,b}}_bufferedCameraMercator(a,f){const g=fs(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let b;return b=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),f):{polygon:this.bufferedCameraGeometry(a).map(E=>f.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[g]=b,b}}_projectAndResample(a,f){const g=function(E,C){const I=s.aB([],C.pixelMatrix,C.globeMatrix),R=[0,-s.aD,0,1],L=[0,s.aD,0,1],B=[0,0,0,1];s.aC(R,R,I),s.aC(L,L,I),s.aC(B,B,I);const V=new s.P(R[0]/R[3],R[1]/R[3]),j=new s.P(L[0]/L[3],L[1]/L[3]),W=s.aE(E,V)&&R[3]<B[3],Y=s.aE(E,j)&&L[3]<B[3];if(!W&&!Y)return null;const Z=function(Se,be,ye){for(let Ne=1;Ne<Se.length;Ne++){const We=Us(be.pointCoordinate3D(Se[Ne-1]).x),Ze=Us(be.pointCoordinate3D(Se[Ne]).x);if(ye<0){if(We<Ze)return{idx:Ne,t:-We/(Ze-1-We)}}else if(Ze<We)return{idx:Ne,t:(1-We)/(Ze+1-We)}}return null}(E,C,W?-1:1);if(!Z)return null;const{idx:J,t:ie}=Z;let pe=J>1?Qs(E.slice(0,J),C):[],fe=J<E.length?Qs(E.slice(J),C):[];pe=pe.map(Se=>new s.P(Us(Se.x),Se.y)),fe=fe.map(Se=>new s.P(Us(Se.x),Se.y));const ce=[...pe];ce.length===0&&ce.push(fe[fe.length-1]);const Re=s.ak(ce[ce.length-1].y,(fe.length===0?pe[0]:fe[0]).y,ie);let Ce;return Ce=W?[new s.P(0,Re),new s.P(0,0),new s.P(1,0),new s.P(1,Re)]:[new s.P(1,Re),new s.P(1,1),new s.P(0,1),new s.P(0,Re)],ce.push(...Ce),fe.length===0?ce.push(pe[0]):ce.push(...fe),{polygon:ce.map(Se=>new s.ae(Se.x,Se.y)),unwrapped:!1}}(a,f);if(g)return g;const b=function(E,C){let I=!1,R=-1/0,L=0;for(let V=0;V<E.length-1;V++)E[V].x>R&&(R=E[V].x,L=V);for(let V=0;V<E.length-1;V++){const j=(L+V)%(E.length-1),W=E[j],Y=E[j+1];Math.abs(W.x-Y.x)>.5&&(W.x<Y.x?(W.x+=1,j===0&&(E[E.length-1].x+=1)):(Y.x+=1,j+1===E.length-1&&(E[0].x+=1)),I=!0)}const B=s.aF(C.center.lng);return I&&B<Math.abs(B-1)&&E.forEach(V=>{V.x-=1}),{polygon:E,unwrapped:I}}(Qs(a,f).map(E=>new s.P(Us(E.x),E.y)),f);return{polygon:b.polygon.map(E=>new s.ae(E.x,E.y)),unwrapped:b.unwrapped}}}function Qs(m,a){return s.aG(m,f=>{const g=a.pointCoordinate3D(f);f.x=g.x,f.y=g.y},1/256)}function Us(m){return m<0?1+m%1:m%1}function fs(m){return 100*m|0}function Pd(m,a,f,g,b){const E=function(I,R){if(I)return b(I);if(R){if(m.url&&R.tiles&&m.tiles&&delete m.tiles,R.variants){if(!Array.isArray(R.variants))return b(new Error("variants must be an array"));for(const B of R.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return b(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){R=Object.assign(R,B);break}}}const L=s.aH(Object.assign({},R,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=a.canonicalizeTileset(L,m.url),b(null,L)}},C=function(I,R,L){if(!I)return null;if(!R&&!L)return I;L=L||I.worldview_default;const B=Object.values(I.language||{});if(B.length===0)return null;const V=Object.values(I.worldview||{});if(V.length===0)return null;const j=B.every(Y=>Y===R),W=V.every(Y=>Y===L);return j&&W?I:R in(I.language_options||{})||L in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(m.data,f,g);return C?s.o.frame(()=>E(null,C)):m.url?s.m(a.transformRequest(a.normalizeSourceURL(m.url,null,f,g),s.R.Source),E):s.o.frame(()=>{const{data:I,...R}=m;E(null,R)})}function vo(m,a){const f=Math.pow(2,a.z),g=Math.floor(s.aF(m.getWest())*f),b=Math.floor(s.aJ(m.getNorth())*f),E=Math.ceil(s.aF(m.getEast())*f),C=Math.ceil(s.aJ(m.getSouth())*f);return a.x>=g&&a.x<E&&a.y>=b&&a.y<C}class ka{constructor(a,f,g){this.bounds=a?s.aI.convert(this.validateBounds(a)):null,this.minzoom=f||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}addExtraBounds(a){if(a){this.extraBounds||(this.extraBounds=[]);for(const f of a)this.extraBounds.push(s.aI.convert(this.validateBounds(f)))}}contains(a){if(a.z>this.maxzoom||a.z<this.minzoom||this.bounds&&!vo(this.bounds,a))return!1;if(!this.extraBounds)return!0;for(const f of this.extraBounds)if(vo(f,a))return!0;return!1}static fromTileJSON(a){if(!a.bounds&&!a.extra_bounds)return null;const f=new ka(a.bounds,a.minzoom,a.maxzoom);return f.addExtraBounds(a.extra_bounds),f}}class zc extends s.E{constructor(a,f,g,b){if(super(),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(f,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new s.aK}load(a){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Pd(this._options,this.map._requestManager,f,g,(b,E)=>{if(this._tileJSONRequest=null,this._loaded=!0,b)f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new s.y(b));else if(E){if(Object.assign(this,E),this.hasWorldviews=!!E.worldview_options,E.worldview_default&&(this.worldviewDefault=E.worldview_default),E.vector_layers){this.vectorLayers=E.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const C of E.vector_layers)this.vectorLayerIds.push(C.id),E.worldview&&E.worldview[C.source]&&this.localizableLayerIds.add(C.id)}this.tileBounds=ka.fromTileJSON(E),Dt(E.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}a&&a(b)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(a,f){const g=a.tileID.canonical.url(this.tiles,this.scheme),b=this.map._requestManager.normalizeTileURL(g),E=this.map._requestManager.transformRequest(b,s.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,I=C?{image:C.image.clone()}:null,R={request:E,data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&s.h(g)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=f:a.request=a.actor.send("reloadTile",R,L.bind(this));else if(a.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",R,L.bind(this),void 0,!0);else{const B=s.aL.call({deduped:this._deduped},R,(V,j)=>{if(V||!j)L.call(this,V);else{const W=s.aM(j.responseHeaders);R.data={rawData:j.rawData.slice(0),expires:W.expires,cacheControl:W.cacheControl},a.actor&&a.actor.send("loadTile",R,L.bind(this),void 0,!0)}},!0);a.request={cancel:B}}function L(B,V){return delete a.request,a.aborted?f(null):B&&B instanceof s.aN&&B.status!==404?f(B):(V&&V.resourceTiming&&(a.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&a.setExpiryData(V),a.loadVectorData(V,this.map.painter),s.aO(this.dispatcher),f(null,V),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,f){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xl extends s.E{constructor(a,f,g,b){super(),this.id=a,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},f),Object.assign(this,s.aH(f,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const f=this.map.getWorldview();this._tileJSONRequest=Pd(this._options,this.map._requestManager,null,f,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new s.y(g)):b&&(Object.assign(this,b),b.raster_layers&&(this.rasterLayers=b.raster_layers,this.rasterLayerIds=this.rasterLayers.map(E=>E.id)),this.tileBounds=ka.fromTileJSON(b),Dt(b.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),a&&a(g)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(a){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const g=s.o.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=s.n(this.map._requestManager.transformRequest(b,s.R.Tile),(E,C,I)=>{if(delete a.request,a.aborted)return a.state="unloaded",f(null);if(E)return a.state="errored",f(E);if(!C)return f(null);const R=s.aM(I);this.map._refreshExpiredTiles&&a.setExpiryData(R),a.setTexture(C,this.map.painter),a.state="loaded",s.aO(this.dispatcher),f(null)})}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f&&f()}unloadTile(a,f){a.texture&&a.texture instanceof s.T?(a.destroy(!1),a.texture&&a.texture instanceof s.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),f&&f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Da([m,a],f,g,{scaled:b=!0}={}){const{tileSize:E,buffer:C}=g,{x:I,y:R,z:L}=f;if(!isFinite(I)||!isFinite(R)||!isFinite(L))throw new Error("Invalid MRT header");const B=2**L,V=B*s.aF(m),j=B*s.aJ(a);return function([W,Y],Z,{scaled:J=!0}={}){if(!Z)throw new Error("bandView is undefined");const{data:ie,tileSize:pe,buffer:fe,offset:ce,scale:Re,dimension:Ce}=Z;if(W<-fe||W>pe+fe||Y<-fe||Y>pe+fe)throw new Error(`Point (${W}, ${Y}) out of bounds for tileSize=${pe}, buffer=${fe}`);const Se=(Y+fe)*(pe+2*fe)+(W+fe);if(new Uint32Array(ie.buffer)[Se]===4294967295)return null;let be=[];be=J?[]:new Z.data.constructor(Ce);for(let ye=0;ye<Ce;ye++)be[ye]=Math.round(1e12*(ie[Ce*Se+ye]*Re+ce))/1e12;return be}([Math.min(Math.max(-C,Math.floor((V-I)*E)),E-1+C),Math.min(Math.max(-C,Math.floor((j-R)*E)),E-1+C)],g,{scaled:b})}class Uo extends xl{constructor(a,f,g,b){super(a,f,g,b),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},f)}triggerRepaint(a){const f=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);f&&f.enabled&&g&&f._clearRenderCacheForTile(g.id,a.tileID),this.map.triggerRepaint()}loadTile(a,f){const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(g,s.R.Tile),E={request:b,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};a.source=this.id,a.scope=this.scope,a.requestParams=b,a.actor||(a.actor=this.dispatcher.getActor());const C=(I,R,L)=>{if(delete a.request,a.aborted)return a.state="unloaded",f(null);if(I)return I.name==="AbortError"?void 0:(a.state="errored",f(I));if(this.map._refreshExpiredTiles&&R){const B=s.aM(L);a.setExpiryData(B)}if(this.partial&&a.state!=="expired")a.state="empty";else if(!this.partial){if(!R)return f(null);a.state="loaded",a._isHeaderLoaded=!0,a._mrt=R}f(null)};a.request=this.partial?a.fetchHeader(void 0,C.bind(this)):a.actor.send("loadTile",E,C.bind(this),void 0,!0)}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a,f){const g=a.texturePerLayer;if(a.flushAllQueues(),g.size){a.destroy(!1);for(const b of g.values())this.map.painter.saveTileTexture(b)}else a.destroy()}prepareTile(a,f,g,b){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBandForRender(f,g,b,(E,C)=>{if(E)return a.state="errored",this.fire(new s.y(E)),void this.triggerRepaint(a);C&&(a._isHeaderLoaded=!0,a.setTexturePerLayer(g,C,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const f=this.rasterLayers.find(({id:E})=>E===a),g=f&&f.fields,b=g&&g.bands&&g.bands;return b?b[0]:0}getTextureDescriptor(a,f,g){if(!a)return;const b=f.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let E=null;f instanceof s.aR?E=f.paint.get("raster-array-band"):f instanceof s.aS&&(E=f.paint.get("raster-particle-array-band"));const C=E||this.getInitialBand(b);if(C==null)return;if(!a.textureDescriptorPerLayer.get(f.id))return void this.prepareTile(a,b,f.id,C);if(a.updateNeeded(f.id,C)&&!g)return;const I=a.textureDescriptorPerLayer.get(f.id);return Object.assign({},I,{texture:a.texturePerLayer.get(f.id)})}getImages(a,f){const g=new Map;for(const b of a)for(const E of f){const[C,I]=E.split("/"),R=b.getLayer(C);if(!R||!R.hasBand(I)||!R.hasDataForBand(I))continue;const{bytes:L,tileSize:B,buffer:V}=R.getBandView(I),j=B+2*V,W={data:new s.q({width:j,height:j},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(E,W)}return g}queryRasterArrayValueByBandId(a,f,g){const b=f._mrt;return new Promise(E=>{const C={},I=new Set;for(const[R,L]of Object.entries(b.layers)){if(g.layerName&&R!==g.layerName)continue;const B={};C[R]=B;for(const{bands:V}of L.dataIndex)for(const j of V)g.bands&&!g.bands.includes(j)||(I.add(s.B(R,j)),f.fetchBand(R,null,j,W=>{s.o.frame(()=>{B[j]=W?null:Da([a.lng,a.lat],b,L.getBandView(j)),I.delete(s.B(R,j)),I.size===0&&E(C)})},!1))}I.size===0&&E(C)})}_loadTileForQuery(a,f){if(this._loadTileLoaded[a.uid])return void f(null,a._mrt);if(this._loadTilePending[a.uid])return void this._loadTilePending[a.uid].push(f);this._loadTilePending[a.uid]=[f];const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(g,s.R.Tile);a.actor.send("loadTile",{request:b,uid:a.uid,tileID:a.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(E,C,I)=>{if(E)return this._loadTilePending[a.uid].forEach(R=>R(E,null)),void delete this._loadTilePending[a.uid];if(!C)return this._loadTilePending[a.uid].forEach(R=>R(null,null)),void delete this._loadTilePending[a.uid];if(this.map._refreshExpiredTiles&&C){const R=s.aM(I);a.setExpiryData(R)}a._mrt=C,a._isHeaderLoaded=!0,a.state="loaded",this._loadTilePending[a.uid].forEach(R=>R(null,C)),this._loadTileLoaded[a.uid]=!0,delete this._loadTilePending[a.uid]},void 0,!0)}queryRasterArrayValueByAllBands(a,f,g){return new Promise((b,E)=>{this._loadTileForQuery(f,(C,I)=>{C?E(C):b(I?this.queryRasterArrayValueByBandId(a,f,g):null)})})}queryRasterArrayValue(a,f){const g=s.aT.convert(a),b=this.findLoadedParent(g);return b&&b._mrt?f.bands||!this.partial?this.queryRasterArrayValueByBandId(g,b,f):this.queryRasterArrayValueByAllBands(g,b,f):Promise.resolve(null)}findLoadedParent(a){const f=s.ae.fromLngLat(a,this.map.transform.tileSize),g=this.maxzoom+1,b=1<<g,E=Math.floor(f.x),C=Math.floor((f.x-E)*b),I=Math.floor(f.y*b),R=this.map.style.getSourceCache(this.id),L=new s.aQ(g,E,g,C,I);return R.findLoadedParent(L,this.minzoom)}}const Bu={vector:zc,raster:xl,"raster-dem":class extends xl{constructor(m,a,f,g){super(m,a,f,g),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const f=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(b,E){b&&(m.state="errored",a(b)),E&&(m.dem=E,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=s.n(this.map._requestManager.transformRequest(f,s.R.Tile),(function(b,E,C){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(b)m.state="errored",a(b);else if(E){const I=s.aM(C);this.map._refreshExpiredTiles&&m.setExpiryData(I);const R=ImageBitmap&&E instanceof ImageBitmap&&s.r(),L=1-(E.width-s.aP(E.width))/2;L<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const B=R?E:s.o.getImageData(E,L),V={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:L};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",V,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const a=m.canonical,f=Math.pow(2,a.z),g=(a.x-1+f)%f,b=a.x===0?m.wrap-1:m.wrap,E=(a.x+1+f)%f,C=a.x+1===f?m.wrap+1:m.wrap,I={};return I[new s.aQ(m.overscaledZ,b,a.z,g,a.y).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,C,a.z,E,a.y).key]={backfilled:!1},a.y>0&&(I[new s.aQ(m.overscaledZ,b,a.z,g,a.y-1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,C,a.z,E,a.y-1).key]={backfilled:!1}),a.y+1<f&&(I[new s.aQ(m.overscaledZ,b,a.z,g,a.y+1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,C,a.z,E,a.y+1).key]={backfilled:!1}),I}},"raster-array":Uo,geojson:class extends s.E{constructor(m,a,f,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(g),this._data=a.data,this._options=Object.assign({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const b=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*b,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*b,extent:s.al,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:s.al,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*b,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const a=new Map;for(const f of this._data.features)a.set(f.id,f);for(const f of m.features)a.set(f.id,f);this._data.features=[...a.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterLeaves(m,a,f,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:a,offset:f},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const a=Object.assign({append:m},this.workerOptions);a.scope=this.scope;const f=this._data;typeof f=="string"?(a.request=this.map._requestManager.transformRequest(s.o.resolveURL(f),s.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(g,b)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new s.y(g));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(E.resourceTiming=b.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new s.z("data",E)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=s.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,a){const f=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,b=g?{image:g.image.clone()}:null,E=this._partialReload,C={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:b,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:E,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};m.request=this.actor.send(f,C,(I,R)=>E&&!R?(m.state="loaded",a(null)):(delete m.request,m.destroy(!1),m.aborted?a(null):I?a(I):(m.loadVectorData(R,this.map.painter,f==="reloadTile"),a(null))),void 0,f==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,a){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(m,a,f,g){super(m,a,f,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,s.R.Source).url);s.aV(this.urls,(a,f)=>{this._loaded=!0,a?this.fire(new s.y(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(m,this.video,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(m,a,f,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Pd(this._options,this.map._requestManager,a,f,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.y(g))):b&&(Object.assign(this,b),b.bounds&&(this.tileBounds=new ka(b.bounds,this.minzoom,this.maxzoom)),Dt(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,a){const f=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(f,s.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=a;else{if(m.buckets){const E=Object.values(m.buckets);for(const C of E)C.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,b.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,b.bind(this),void 0,!0);function b(E,C){return m.aborted?a(null):E&&E.status!==404?a(E):(this.map._refreshExpiredTiles&&C&&m.setExpiryData(C),m.loadModelData(C,this.map.painter),m.state="loaded",void a(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(m,a,f,g){super(m,a,f,g),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(E=>typeof E!="number"))||this.fire(new s.y(new s.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(a,this.canvas,a.gl.RGBA8,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.E{constructor(m,a,f,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ka(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:f,z:g}=m.canonical;return this._implementation.hasTile({x:a,y:f,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:f,y:g,z:b}=m.tileID.canonical,E=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:f,y:g,z:b},{signal:E.signal})).then((function(C){return delete m.request,m.aborted?(m.state="unloaded",a(null)):C===void 0?(m.state="errored",a(null)):C===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(C)?(this.loadTileData(m,C),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(C=>{C.name!=="AbortError"&&(m.state="errored",a(C))}),m.request.cancel=()=>E.abort()}loadTileData(m,a){m.setTexture(a,this.map.painter)}unloadTile(m,a){if(m.texture&&m.texture instanceof s.T?(m.destroy(!1),m.texture&&m.texture instanceof s.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:f,y:g,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:f,y:g,z:b})}a&&a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a&&a()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=s.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},$h=function(m,a,f,g){const b=new Bu[a.type](m,a,f,g);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return s.aY(["load","abort","unload","serialize","prepare"],b),b};function ac(m,a,f=""){return`${f}:${a.id||""}:${a.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:b,importId:E}=g;return`featureset:${b}${E?`:import:${E}`:""}`}}(m.target)}`}function ag(m,a,f,g=""){if(m.uniqueFeatureID){const b=ac(m,a,g);if(f.has(b))return!0;f.add(b)}return!1}function cg(m,a,f,g,b=!1,E=void 0){const C=a.sourceCache.transform,I=a.sourceCache.tilesIn(m,a.has3DLayers,b);I.sort(Yw);const R=[];for(const L of I){const B=L.tile.queryRenderedFeatures(a,L,f,g,C,b,E);Object.keys(B).length&&R.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:B})}for(const L in a.layers){const B=a.layers[L];if(B.styleLayer){const V=B.styleLayer.queryRenderedFeatures(m,a.sourceCache,g);Object.keys(V).length&&R.push({wrappedTileID:0,queryResults:V})}}return R.length===0?{}:function(L){const B={},V={};for(const j of L){const W=j.queryResults,Y=j.wrappedTileID,Z=V[Y]=V[Y]||{};for(const J in W){const ie=W[J],pe=Z[J]=Z[J]||{},fe=B[J]=B[J]||[];for(const ce of ie)pe[ce.featureIndex]||(pe[ce.featureIndex]=!0,fe.push(ce))}}return B}(R)}function h3(m,a,f,g,b,E){const C={},I=g.queryRenderedSymbols(m),R=[];for(const L of Object.keys(I).map(Number))R.push(b[L]);R.sort(Yw);for(const L of R){const B=L.featureIndex.lookupSymbolFeatures(I[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,a,f,E);for(const V in B){const j=C[V]=C[V]||[],W=B[V];W.sort((Y,Z)=>{const J=L.featureSortOrder;if(J){const ie=J.indexOf(Y.featureIndex);return J.indexOf(Z.featureIndex)-ie}return Z.featureIndex-Y.featureIndex});for(const Y of W)j.push(Y)}}return C}function f3(m,a){const f=m.getRenderableIds().map(E=>m.getTileByID(E)),g=[],b={};for(let E=0;E<f.length;E++){const C=f[E],I=C.tileID.canonical.key;b[I]||(b[I]=!0,C.querySourceFeatures(g,a))}return g}function Yw(m,a){const f=m.tileID,g=a.tileID;return f.overscaledZ-g.overscaledZ||f.canonical.y-g.canonical.y||f.wrap-g.wrap||f.canonical.x-g.canonical.x}function Xw(m,a){const f={};if(!a)return f;for(const g of m){const b=g.layerIds.map(E=>a.getLayer(E)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(E=>b.filter(C=>C.id===E)[0]));for(const E of b)f[E.fqid]=g}}return f}const js=32,cc=33,Fu=new Uint16Array(8184);for(let m=0;m<2046;m++){let a=m+2,f=0,g=0,b=0,E=0,C=0,I=0;for(1&a?b=E=C=js:f=g=I=js;(a>>=1)>1;){const L=f+b>>1,B=g+E>>1;1&a?(b=f,E=g,f=C,g=I):(f=b,g=E,b=C,E=I),C=L,I=B}const R=4*m;Fu[R+0]=f,Fu[R+1]=g,Fu[R+2]=b,Fu[R+3]=E}const lc=new Uint16Array(2178),Xl=new Uint8Array(1089),tp=new Uint16Array(1089);function np(m){return m===0?-.03125:m===32?.03125:0}const zh={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Rd{constructor(a,f,g,b,E,C){this.tileID=a,this.uid=s.b2(),this.uses=0,this.tileSize=f,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection),this.worldview=C,this._hasAppearances=null}registerFadeDuration(a){const f=a+this.timeAdded;f<s.o.now()||this.fadeEndTime&&f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,f,g){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=Xw(a.buckets,f.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const E=this.buckets[b];if(E instanceof s.b4){if(this.hasSymbolBuckets=!0,!g)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const E=this.buckets[b];if(E instanceof s.b4&&E.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const b in this.buckets){const E=this.buckets[b],C=f.style.getOwnLayer(b);if(!C)continue;const I=C.queryRadius(E);this.queryPadding=Math.max(this.queryPadding,I)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(a,f,g){a&&(a.resourceTiming&&(this.resourceTiming=a.resourceTiming),this.buckets=Object.assign({},this.buckets,Xw(a.buckets,f.style)),a.featureIndex&&(this.latestFeatureIndex=a.featureIndex))}getBucket(a){return this.buckets[a.fqid]}upload(a,f){for(const E in this.buckets){const C=this.buckets[E];if(C.uploadPending()){let I={},R=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(f){if(f.style){R=f.style.listImages();const B=C.layers[0],V=B.sourceLayer||"_geojsonTileLayer",j=f.style.getLayerSourceCache(B);j&&(I=j._state.getState(V,void 0))}L={zoom:f.transform.zoom||0,pitch:f.transform.pitch||0,brightness:f.style.getBrightness()||0,worldview:f.worldview||""}}C.upload(a,this.tileID.canonical,I,R,L)}}const g=a.gl,b=this.imageAtlas;b&&!b.uploaded&&(this.imageAtlasTexture=new s.T(a,b.image,g.RGBA8,{useMipmap:!!b.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(a,this.glyphAtlasImage,g.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(a,this.lineAtlas.image,g.R8),this.lineAtlas.uploaded=!0)}prepare(a,f,g){if(this.imageAtlas&&this.imageAtlasTexture&&f){const E=f.style.getLut(g);this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,g,E)}if(!f||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const b=f.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(f)),(this._lastUpdatedBrightness||b||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this.updateBuckets(f,this._lastUpdatedBrightness!==b),this._lastUpdatedBrightness=b))}evaluateQueryRenderedFeaturePadding(){let a=0;for(const f in this.buckets){const g=this.buckets[f];g.evaluateQueryRenderedFeaturePadding&&(a=Math.max(a,g.evaluateQueryRenderedFeaturePadding()))}return a}queryRenderedFeatures(a,f,g,b,E,C,I){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const R=this.evaluateQueryRenderedFeaturePadding(),L=function(B,V){const j=s.bq([],[.5*B.width,.5*-B.height,1]);return s.br(j,j,[1,-1,0]),s.aB(j,j,B.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(j)}(E,this.tileID);return this.latestFeatureIndex.query(a,{tilespaceGeometry:f,pixelPosMatrix:L,transform:b,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:R,scope:I})}querySourceFeatures(a,f){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const b=g.loadVTLayers(),E=f?f.sourceLayer:"",C=b._geojsonTileLayer||b[E];if(!C)return;const I=s.b6(f&&f.filter),{z:R,x:L,y:B}=this.tileID.canonical,V={z:R,x:L,y:B};for(let j=0;j<C.length;j++){const W=C.feature(j);if(I.needGeometry){const J=s.b7(W,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),W))continue;const Y=g.getId(W,E),Z=new s.b8(W,R,L,B,Y);Z.tile=V,a.push(Z)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(a){const f=this.expirationTime;if(a.cacheControl){const g=s.b9(a.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const g=Date.now();let b=!1;if(this.expirationTime>g)b=!1;else if(f)if(this.expirationTime<f)b=!0;else{const E=this.expirationTime-f;E?this.expirationTime=g+Math.max(E,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(a){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&a&&this.updateBuckets(a)}hasAppearances(a){for(const f in this.buckets)if(a.style.hasLayer(f)&&this.buckets[f].layers.some(g=>g.appearances&&g.appearances.length>0))return!0;return!1}updateBuckets(a,f){if(!this.latestFeatureIndex||!a.style)return;const g=a.style.listImages(),b=a.style.getBrightness();for(const E in this.buckets){if(!a.style.hasLayer(E))continue;const C=this.buckets[E],I=C.layers[0],R=I.sourceLayer||"_geojsonTileLayer",L=a.style.getLayerSourceCache(I);let B={};L&&(B=L._state.getState(R,void 0));const V=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},j=Object.keys(B).length>0&&!f;C.hasAppearances=C.layers.some(Z=>Z.appearances&&Z.appearances.length>0);const W=j?C.stateDependentLayers:C.layers;if(j&&C.stateDependentLayers.length!==0||f){const Z=this.latestFeatureIndex.loadVTLayers();C.update(B,Z[R],g,V,W,f,b)}if(j&&C.stateDependentLayers.length!==0||f||C.hasAppearances){const Z={zoom:a.transform.zoom,pitch:a.transform.pitch,brightness:a.style.getBrightness()||0,worldview:a.worldview};C.updateAppearances(this.tileID.canonical,B,g,Z,a.imageManager)}(C instanceof s.ba||C instanceof s.bb)&&a._terrain&&a._terrain.enabled&&L&&C.uploadPending()&&a._terrain._clearRenderCacheForTile(L.id,this.tileID);const Y=a&&a.style&&a.style.getOwnLayer(E);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=s.o.now()+a}setTexture(a,f){const g=f.context,b=g.gl;this.texture=this.texture||f.getTileTexture(a.width),this.texture&&this.texture instanceof s.T?this.texture.update(a):(this.texture=new s.T(g,a,b.RGBA8,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(a,f){const g={};for(const b of f)g[b]=!0;this.dependencies[a]=g}hasDependency(a,f){for(const g of a){const b=this.dependencies[g];if(b){for(const E of f)if(b[E])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,f){if(!f||f.name==="mercator"||this._tileDebugBuffer)return;const g=s.bc(zh,this.tileID.canonical,this.tileTransform)[0],b=new s.bd,E=new s.be;for(let C=0;C<g.length;C++){const{x:I,y:R}=g[C];b.emplaceBack(I,R),E.emplaceBack(C)}E.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(E),this._tileDebugBuffer=a.createVertexBuffer(b,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,b.length,E.length)}_makeTileBoundsBuffers(a,f){if(this._tileBoundsBuffer||!f||f.name==="mercator")return;const g=s.bc(zh,this.tileID.canonical,this.tileTransform)[0];let b,E;if(this.isRaster){const C=function(I,R){const L=s.aZ(I,R),B=Math.pow(2,I.z);for(let J=0;J<cc;J++)for(let ie=0;ie<cc;ie++){const pe=s.a_((I.x+(ie+np(ie))/js)/B),fe=s.a$((I.y+(J+np(J))/js)/B),ce=R.project(pe,fe),Re=J*cc+ie;lc[2*Re+0]=Math.round((ce.x*L.scale-L.x)*s.al),lc[2*Re+1]=Math.round((ce.y*L.scale-L.y)*s.al)}Xl.fill(0),tp.fill(0);for(let J=2045;J>=0;J--){const ie=4*J,pe=Fu[ie+0],fe=Fu[ie+1],ce=Fu[ie+2],Re=Fu[ie+3],Ce=pe+ce>>1,Se=fe+Re>>1,be=Ce+Se-fe,ye=Se+pe-Ce,Ne=fe*cc+pe,We=Re*cc+ce,Ze=Se*cc+Ce,tt=Math.hypot((lc[2*Ne+0]+lc[2*We+0])/2-lc[2*Ze+0],(lc[2*Ne+1]+lc[2*We+1])/2-lc[2*Ze+1])>=16;Xl[Ze]=Xl[Ze]||(tt?1:0),J<1022&&(Xl[Ze]=Xl[Ze]||Xl[(fe+ye>>1)*cc+(pe+be>>1)]||Xl[(Re+ye>>1)*cc+(ce+be>>1)])}const V=new s.b1,j=new s.b0;let W=0;function Y(J,ie){const pe=ie*cc+J;return tp[pe]===0&&(V.emplaceBack(lc[2*pe+0],lc[2*pe+1],J*s.al/js,ie*s.al/js),tp[pe]=++W),tp[pe]-1}function Z(J,ie,pe,fe,ce,Re){const Ce=J+pe>>1,Se=ie+fe>>1;if(Math.abs(J-ce)+Math.abs(ie-Re)>1&&Xl[Se*cc+Ce])Z(ce,Re,J,ie,Ce,Se),Z(pe,fe,ce,Re,Ce,Se);else{const be=Y(J,ie),ye=Y(pe,fe),Ne=Y(ce,Re);j.emplaceBack(be,ye,Ne)}}return Z(0,0,js,js,js,0),Z(js,js,0,0,0,js),{vertices:V,indices:j}}(this.tileID.canonical,f);b=C.vertices,E=C.indices}else{b=new s.b1,E=new s.b0;for(const{x:I,y:R}of g)b.emplaceBack(I,R,0,0);const C=s.bh(b.int16.subarray(0,4*b.length),void 0,4);for(let I=0;I<C.length;I+=3)E.emplaceBack(C[I],C[I+1],C[I+2])}this._tileBoundsBuffer=a.createVertexBuffer(b,s.bi.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(E),this._tileBoundsSegments=s.bg.simpleSegment(0,0,b.length,E.length)}_makeGlobeTileDebugBuffers(a,f){const g=f.projection;if(!g||g.name!=="globe"||f.freezeTileCoverage)return;const b=this.tileID.canonical,E=s.bj(b,f),C=s.bk(E),I=s.aj(f.zoom);let R;I>0&&(R=s.bl(new Float64Array(16),f.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,b,f,C,R,I),this._makeGlobeTileDebugTextBuffer(a,b,f,C,R,I)}_globePoint(a,f,g,b,E,C,I){let R=s.bm(a,f,g);if(C){const L=1<<g.z,B=s.aF(b.center.lng),V=s.aJ(b.center.lat),j=(g.x+.5)/L-B;let W=0;j>.5?W=-1:j<-.5&&(W=1);let Y=(a/s.al+g.x)/L+W,Z=(f/s.al+g.y)/L;Y=(Y-B)*b._pixelsPerMercatorPixel+B,Z=(Z-V)*b._pixelsPerMercatorPixel+V;const J=[Y*b.worldSize,Z*b.worldSize,0];s.af(J,J,C),R=s.bn(R,J,I)}return s.af(R,R,E)}_makeGlobeTileDebugBorderBuffer(a,f,g,b,E,C){const I=new s.bd,R=new s.be,L=new s.bo,B=(j,W,Y,Z,J)=>{const ie=(Y-j)/(J-1),pe=(Z-W)/(J-1),fe=I.length;for(let ce=0;ce<J;ce++){const Re=j+ce*ie,Ce=W+ce*pe;I.emplaceBack(Re,Ce);const Se=this._globePoint(Re,Ce,f,g,b,E,C);L.emplaceBack(Se[0],Se[1],Se[2]),R.emplaceBack(fe+ce)}},V=s.al;B(0,0,V,0,16),B(V,0,V,V,16),B(V,V,0,V,16),B(0,V,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(R),this._tileDebugBuffer=a.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(L,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,R.length)}_makeGlobeTileDebugTextBuffer(a,f,g,b,E,C){const I=s.al/4,R=new s.bd,L=new s.b0,B=new s.bo,V=25;L.reserve(32),R.reserve(V),B.reserve(V);const j=(W,Y)=>V*W+Y;for(let W=0;W<V;W++){const Y=W*I;for(let Z=0;Z<V;Z++){const J=Z*I;R.emplaceBack(J,Y);const ie=this._globePoint(J,Y,f,g,b,E,C);B.emplaceBack(ie[0],ie[1],ie[2])}}for(let W=0;W<4;W++)for(let Y=0;Y<4;Y++){const Z=j(W,Y),J=j(W,Y+1),ie=j(W+1,Y),pe=j(W+1,Y+1);L.emplaceBack(Z,J,ie),L.emplaceBack(ie,J,pe)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(L),this._tileDebugTextBuffer=a.createVertexBuffer(R,s.bf.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(B,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,V,32)}destroy(a=!0){for(const f in this.buckets)this.buckets[f].destroy(a);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),a&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class Uy extends Rd{constructor(a,f,g,b,E){super(a,f,g,b,E),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(a){return this._mrt&&this._mrt.getLayer(a)}setTexturePerLayer(a,f,g){const b=g.context,E=b.gl;let C=this.texturePerLayer.get(a)||g.getTileTexture(f.width);C&&C instanceof s.T?C.update(f,{premultiply:!1}):C=new s.T(b,f,E.RGBA8,{premultiply:!1}),this.texturePerLayer.has(a)||this.texturePerLayer.set(a,C)}flushQueues(a){const f=this._workQueuePerLayer.get(a)||[],g=this._fetchQueuePerLayer.get(a)||[];for(;f.length;)f.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const a of this._workQueuePerLayer.keys()){const f=this._workQueuePerLayer.get(a)||[];for(;f.length;)f.pop()()}for(const a of this._fetchQueuePerLayer.keys()){const f=this._fetchQueuePerLayer.get(a)||[];for(;f.length;)f.pop()()}}fetchHeader(a=16384,f){const g=this._mrt=new s.bs(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=s.bu(b,(E,C,I)=>{if(E)f(E);else try{const R=g.getHeaderLength(C);if(R>a)return void(this.request=this.fetchHeader(R,f));g.parseHeader(C),this._isHeaderLoaded=!0;let L=0;for(const B of Object.values(g.layers))L=Math.max(L,B.dataIndex[B.dataIndex.length-1].lastByte);C.byteLength>=L&&(this.entireBuffer=C),f(null,this.entireBuffer||C,I)}catch(R){f(R)}}),this.request}fetchBandForRender(a,f,g,b){this.fetchBand(a,f,g,E=>{if(E)return void b(E);this.updateTextureDescriptor(a,f,g);const C=this.textureDescriptorPerLayer.get(f);b(null,C?C.img:null)})}fetchBand(a,f,g,b,E=!0){const C=this._mrt;if(!this._isHeaderLoaded||!C)return void b(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void b(new Error("Can't fetch tile band without an actor"));let R;const L=s.B(String(g),s.B(this.tileID.key,a));let B=this._taskQueue.get(L);B?B.add(b):(B=new Set,B.add(b),this._taskQueue.set(L,B));const V=(Z,J)=>{R.complete(Z,J),Z?b(Z):(B.forEach(ie=>ie(null,J)),this._taskQueue.delete(L))},j=(Z,J)=>{if(Z)return b(Z);const ie=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:J,task:R},V,void 0,!0);if(f!==null){const pe=this._workQueuePerLayer.get(f)||[];pe.push(()=>{ie&&ie.cancel(),R.cancel()}),this._workQueuePerLayer.has(f)||this._workQueuePerLayer.set(f,pe)}};let W;try{W=C.getLayer(a)}catch(Z){if(this.state==="reloading")return;throw Z}if(!W)return void b(new Error(`Unknown sourceLayer "${a}"`));if(W.hasDataForBand(g))return B.forEach(Z=>Z(null,null)),void this._taskQueue.delete(L);const Y=W.getDataRange([g]);if(R=C.createDecodingTask(Y),!R||R.tasks.length)if(f!==null&&this.flushQueues(f),this.entireBuffer)j(null,this.entireBuffer.slice(Y.firstByte,Y.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Y.firstByte}-${Y.lastByte}`}}),J=s.bu(Z,j);if(f!==null){const ie=this._fetchQueuePerLayer.get(f)||[];ie.push(()=>{J.cancel(),R.cancel()}),this._fetchQueuePerLayer.has(f)||this._fetchQueuePerLayer.set(f,ie)}}}updateNeeded(a,f){return(!this.textureDescriptorPerLayer.get(a)||this.textureDescriptorPerLayer.get(a).band!==f||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(a,f,g){if(!this._mrt)return;const b=this._mrt.getLayer(a);if(!b||!b.hasBand(g)||!b.hasDataForBand(g))return;const{bytes:E,tileSize:C,buffer:I,offset:R,scale:L}=b.getBandView(g),B=C+2*I,V=new s.q({width:B,height:B},E),j=this.texturePerLayer.get(f);j&&j instanceof s.T&&j.update(V,{premultiply:!1}),this.textureDescriptorPerLayer.set(f,{layer:a,band:g,img:V,buffer:I,offset:R,tileSize:C,format:b.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(a=!1){if(super.destroy(a),delete this._mrt,!a)for(const f of this.texturePerLayer.values())f&&f instanceof s.T&&f.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class p3{constructor(a,f){this.max=a,this.onRemove=f,this.reset()}reset(){for(const a in this.data)for(const f of this.data[a])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(a,f,g){const b=a.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const E={value:f,timeout:void 0};if(g!==void 0&&(E.timeout=setTimeout(()=>{this.remove(a,E)},g)),this.data[b].push(E),this.order.push(b),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const f=this.data[a].shift();return f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),f.value}getByKey(a){const f=this.data[a];return f?f[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,f){if(!this.has(a))return this;const g=a.wrapped().key,b=f===void 0?0:this.data[g].indexOf(f),E=this.data[g][b];return this.data[g].splice(b,1),E.timeout&&clearTimeout(E.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(E.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(a){const f=[];for(const g in this.data)for(const b of this.data[g])a(b.value)||f.push(b);for(const g of f)this.remove(g.value.tileID,g)}}class m3{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,f,g){const b=String(f);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][b]=this.stateChanges[a][b]||{},Object.assign(this.stateChanges[a][b],g),this.deletedStates[a]===null){this.deletedStates[a]={};for(const E in this.state[a])E!==b&&(this.deletedStates[a][E]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][b]===null){this.deletedStates[a][b]={};for(const E in this.state[a][b])g[E]||(this.deletedStates[a][b][E]=null)}else for(const E in g)this.deletedStates[a]&&this.deletedStates[a][b]&&this.deletedStates[a][b][E]===null&&delete this.deletedStates[a][b][E]}removeFeatureState(a,f,g){if(this.deletedStates[a]===null)return;const b=String(f);if(this.deletedStates[a]=this.deletedStates[a]||{},g&&f!==void 0)this.deletedStates[a][b]!==null&&(this.deletedStates[a][b]=this.deletedStates[a][b]||{},this.deletedStates[a][b][g]=null);else if(f!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][b])for(g in this.deletedStates[a][b]={},this.stateChanges[a][b])this.deletedStates[a][b][g]=null;else this.deletedStates[a][b]=null;else this.deletedStates[a]=null}getState(a,f){const g=this.state[a]||{},b=this.stateChanges[a]||{},E=this.deletedStates[a];if(E===null)return{};if(f!==void 0){const I=String(f),R=Object.assign({},g[I],b[I]);if(E){const L=E[f];if(L===null)return{};for(const B in L)delete R[B]}return R}const C=Object.assign({},g,b);if(E)for(const I in E)delete C[I];return C}initializeTileState(a,f){a.refreshFeatureState(f)}coalesceChanges(a,f){const g={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const E={};for(const C in this.stateChanges[b])this.state[b][C]||(this.state[b][C]={}),Object.assign(this.state[b][C],this.stateChanges[b][C]),E[C]=this.state[b][C];g[b]=E}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const E={};if(this.deletedStates[b]===null)for(const C in this.state[b])E[C]={},this.state[b][C]={};else for(const C in this.deletedStates[b]){if(this.deletedStates[b][C]===null)this.state[b][C]={};else if(this.state[b][C])for(const I of Object.keys(this.deletedStates[b][C]))delete this.state[b][C][I];E[C]=this.state[b][C]}g[b]=g[b]||{},Object.assign(g[b],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const b in a)a[b].refreshFeatureState(f)}}class ha extends s.E{constructor(a,f,g){super(),this.id=a,this._onlySymbols=g,f.on("data",b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),f.on("error",()=>{this._sourceErrored=!0}),this._source=f,this._tiles={},this._cache=new p3(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new m3,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles)if(!this._tiles[a].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,f){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,f)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a)}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a)}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const g=this._tiles[f];g.upload(a,this.map?this.map.painter:void 0),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(lg).map(a=>a.key)}getRenderableIds(a,f){const g=[];for(const b in this._tiles)this._isIdRenderable(+b,a,f)&&g.push(this._tiles[b]);return a?g.sort((b,E)=>{const C=b.tileID,I=E.tileID,R=new s.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),L=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-I.overscaledZ||L.y-R.y||L.x-R.x}).map(b=>b.tileID.key):g.map(b=>b.tileID).sort(lg).map(b=>b.key)}hasRenderableParent(a){const f=this.findLoadedParent(a,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(a,f,g){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(f||!this._tiles[a].holdingForFade())&&(g||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,f){const g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=f),this._loadTile(g,this._tileLoaded.bind(this,g,a,f)))}_tileLoaded(a,f,g,b,E){if(b){if(a.state="errored",b.status!==404)this._source.fire(new s.y(b,{tile:a}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:a})),!(a.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}a.timeAdded=s.o.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(f,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null);let C=new Map;E&&E.responseHeaders&&(C=E.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id,responseHeaders:C}))}_backfillDEM(a){const f=this.getRenderableIds();for(let b=0;b<f.length;b++){const E=f[b];if(a.neighboringTiles&&a.neighboringTiles[E]){const C=this.getTileByID(E);g(a,C),g(C,a)}}function g(b,E){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let C=E.tileID.canonical.x-b.tileID.canonical.x;const I=E.tileID.canonical.y-b.tileID.canonical.y,R=Math.pow(2,b.tileID.canonical.z),L=E.tileID.key;C===0&&I===0||Math.abs(I)>1||(Math.abs(C)>1&&(Math.abs(C+R)===1?C+=R:Math.abs(C-R)===1&&(C-=R)),E.dem&&b.dem&&(b.dem.backfillBorder(E.dem,C,I),b.neighboringTiles&&b.neighboringTiles[L]&&(b.neighboringTiles[L].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,f,g,b){for(const E in this._tiles){let C=this._tiles[E];if(b[E]||!C.hasData()||C.tileID.overscaledZ<=f||C.tileID.overscaledZ>g)continue;let I=C.tileID;for(;C&&C.tileID.overscaledZ>f+1;){const L=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[L.key],C&&C.hasData()&&(I=L)}let R=I;for(;R.overscaledZ>f;)if(R=R.scaledTo(R.overscaledZ-1),a[R.key]){b[I.key]=I;break}}}findLoadedParent(a,f){if(a.key in this._loadedParentTiles){const g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=f?g:null}for(let g=a.overscaledZ-1;g>=f;g--){const b=a.scaledTo(g),E=this._getLoadedTile(b);if(E)return E}}_getLoadedTile(a){const f=this._tiles[a.key];return f&&f.hasData()?f:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,f){f=f||this._source.tileSize;const g=Math.ceil(a.width/f)+1,b=Math.ceil(a.height/f)+1,E=Math.floor(g*b*5),C=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,E):E,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(I)}handleWrapJump(a){const f=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,f){const g={};for(const b in this._tiles){const E=this._tiles[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+f),g[E.tileID.key]=E}this._tiles=g;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(a,f,g,b,E){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(a,f),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const C=this._source.type==="batched-model";let I,R=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const j=L.attenuationRange()[0],W=Math.floor(j)-Math.log2(L.getDemUpscale());R>W&&(R=W)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new s.aQ(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y));else if(this.tileCoverLift!==0){const j=a.clone();j.tileCoverLift=this.tileCoverLift,I=j.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:C}),this._source.minzoom<=1&&a.projection.name==="globe"&&(I.push(new s.aQ(1,0,1,0,0)),I.push(new s.aQ(1,0,1,1,0)),I.push(new s.aQ(1,0,1,0,1)),I.push(new s.aQ(1,0,1,1,1)))}else if(I=a.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:C}),this._source.hasTile){const j=this._source.hasTile.bind(this._source);I=I.filter(W=>j(W))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ug(this._source.type)){const j=a.coveringZoomLevel({tileSize:f||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),W=Math.min(j,this._source.maxzoom);if(C){const Y=a.extendTileCover(I,W);for(const Z of Y)I.push(Z)}else if(E){const Y=a.extendTileCoverToNearPlane(I,this.transform.getFrustum(W),W);for(const Z of Y)I.push(Z)}else if(this.castsShadows&&b){const Y=a.extendTileCover(I,W,b,16);for(const Z of Y)this._shadowCasterTiles[Z.key]=!0,I.push(Z)}}const B=this._updateRetainedTiles(I);if(ug(this._source.type)&&I.length!==0){const j={},W={},Y=Object.keys(B);for(const J of Y){const ie=B[J],pe=this._tiles[J];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=s.o.now())continue;const fe=this.findLoadedParent(ie,Math.max(ie.overscaledZ-ha.maxOverzooming,this._source.minzoom));fe&&(this._addTile(fe.tileID),j[fe.tileID.key]=fe.tileID),W[J]=ie}const Z=I[I.length-1].overscaledZ;for(const J in this._tiles){const ie=this._tiles[J];if(B[J]||!ie.hasData())continue;let pe=ie.tileID;for(;pe.overscaledZ>Z;){pe=pe.scaledTo(pe.overscaledZ-1);const fe=this._tiles[pe.key];if(fe&&fe.hasData()&&W[pe.key]){B[J]=ie.tileID;break}}}for(const J in j)B[J]||(this._coveredTiles[J]=!0,B[J]=j[J])}for(const j in B)this._tiles[j].clearFadeHold();const V=s.bv(this._tiles,B);for(const j of V){const W=this._tiles[j];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(+j)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const f={};if(a.length===0)return f;const g={},b=a.reduce((L,B)=>Math.min(L,B.overscaledZ),1/0),E=a[0].overscaledZ,C=Math.max(E-ha.maxOverzooming,this._source.minzoom),I=Math.max(E+ha.maxUnderzooming,this._source.minzoom),R={};for(const L of a){const B=this._addTile(L);f[L.key]=L,B.hasData()||b<this._source.maxzoom&&(R[L.key]=L)}this._retainLoadedChildren(R,b,I,f);for(const L of a){let B=this._tiles[L.key];if(B.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const j=L.children(this._source.maxzoom)[0],W=this.getTile(j);if(W&&W.hasData()){f[j.key]=j;continue}}else{const j=L.children(this._source.maxzoom);if(f[j[0].key]&&f[j[1].key]&&f[j[2].key]&&f[j[3].key])continue}let V=B.wasRequested();for(let j=L.overscaledZ-1;j>=C;--j){const W=L.scaledTo(j);if(g[W.key]||(g[W.key]=!0,B=this.getTile(W),!B&&V&&(B=this._addTile(W)),B&&(f[W.key]=W,V=B.wasRequested(),B.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const f=[];let g,b=this._tiles[a].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}f.push(b.key);const E=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(E),g)break;b=E}for(const E of f)this._loadedParentTiles[E]=g}}_addTile(a){let f=this._tiles[a.key];if(f)return f.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),f;f=this._cache.getAndRemove(a),f&&(this._setTileReloadTimer(a.key,f),f.tileID=a,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,f)));const g=!!f;if(!g){const b=this.map?this.map.painter:null,E=this._source.tileSize*a.overscaleFactor();f=this._source.type==="raster-array"?new Uy(a,E,this.transform.tileZoom,b,this._isRaster):new Rd(a,E,this.transform.tileZoom,b,this._isRaster,this._source.worldview),this._loadTile(f,this._tileLoaded.bind(this,f,a.key,f.state))}return f.uses++,this._tiles[a.key]=f,g||this._source.fire(new s.z("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(a,f){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const g=f.getExpiryTimeout();g&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},g))}_removeTile(a){const f=this._tiles[a];f&&(f.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),f.uses>0||(f.hasData()&&f.state!=="reloading"||f.state==="empty"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,f,g){const b=[],E=this.transform;if(!E)return b;const C=E.projection.name==="globe",I=s.aF(E.center.lng);for(const R in this._tiles){const L=this._tiles[R];if(g&&L.clearQueryDebugViz(),L.holdingForFade())continue;let B;if(C){const V=L.tileID.canonical;if(V.z===0){const j=[Math.abs(s.aA(I,...$u(V,-1))-I),Math.abs(s.aA(I,...$u(V,1))-I)];B=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(s.aA(I,...$u(V,-1))-I),Math.abs(s.aA(I,...$u(V,0))-I),Math.abs(s.aA(I,...$u(V,1))-I)];B=[j.indexOf(Math.min(...j))-1]}}else B=[0];for(const V of B){const j=a.containsTile(L,E,f,V);j&&b.push(j)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,f){const g=this.getRenderableIds(a,f).map(E=>this._tiles[E].tileID),b=this.transform.projection.name==="globe";for(const E of g)E.projMatrix=this.transform.calculateProjMatrix(E.toUnwrapped()),E.expandedProjMatrix=b?this.transform.calculateProjMatrix(E.toUnwrapped(),!1,!0):E.projMatrix;return g}sortCoordinatesByDistance(a){const f=a.slice(),g=this.transform._camera.position,b=this.transform._camera.forward(),E={};for(const C of f){const I=1/(1<<C.canonical.z);E[C.key]=((C.canonical.x+.5)*I+C.wrap-g[0])*b[0]+((C.canonical.y+.5)*I-g[1])*b[1]-g[2]*b[2]}return f.sort((C,I)=>E[C.key]-E[I.key]),f}hasTransition(){if(this._source.hasTransition())return!0;if(ug(this._source.type))for(const a in this._tiles){const f=this._tiles[a];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(a,f,g){this._state.updateState(a=a||"_geojsonTileLayer",f,g)}removeFeatureState(a,f,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",f,g)}getFeatureState(a,f){return this._state.getState(a=a||"_geojsonTileLayer",f)}setDependencies(a,f,g){const b=this._tiles[a];b&&b.setDependencies(f,g)}reloadTilesForDependencies(a,f){for(const g in this._tiles)this._tiles[g].hasDependency(a,f)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(a,f))}_preloadTiles(a,f){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(a,f))};return void this._source.on("data",R)}const g=new Map,b=Array.isArray(a)?a:[a],E=this.map.painter.terrain,C=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const R of b){const L=R.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of L)g.set(B.key,B);this.usedForTerrain&&R.updateElevation(!1)}const I=Array.from(g.values());s.bw(I,(R,L)=>{const B=new Rd(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(B,V=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),L(V,B)})},f)}}function lg(m,a){const f=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*a.wrap)-+(a.wrap<0);return m.overscaledZ-a.overscaledZ||g-f||a.canonical.y-m.canonical.y||a.canonical.x-m.canonical.x}function ug(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function $u(m,a){const f=1<<m.z;return[m.x/f+a,(m.x+1)/f+a]}ha.maxOverzooming=10,ha.maxUnderzooming=3;class dg{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,f=!1;for(const g in this.style._mergedLayers){const b=this.style._mergedLayers[g];if(b.type==="fill-extrusion"||b.type==="building")this.layers.push({layer:b,visible:a,visibilityChanged:f});else if(b.type==="model"){const E=this.style.getLayerSource(b);E&&E.type==="batched-model"&&this.layers.push({layer:b,visible:a,visibilityChanged:f})}}}onNewFrame(a){this.layersGotHidden=!1;for(const f of this.layers){const g=f.layer;let b=!1;g.type==="fill-extrusion"?b=!g.isHidden(a)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?b=!g.isHidden(a)&&g.paint.get("building-opacity")>0:g.type==="model"&&(b=!g.isHidden(a)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!b&&f.visible,f.visible=b}}updateZOffset(a,f){this.currentBuildingBuckets=[];for(const b of this.layers){const E=b.layer,C=this.style.getLayerSourceCache(E);let I=1;E.type==="fill-extrusion"?I=b.visible?E.paint.get("fill-extrusion-vertical-scale"):0:E.type==="building"&&(I=b.visible?E.paint.get("building-vertical-scale"):0);let R=C?C.getTile(f):null;if(!R&&C)for(const L in C._tiles){const B=C._tiles[L];if(f.canonical.isChildOf(B.tileID.canonical)){R=B;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(E):null,tileID:R?R.tileID:f,verticalScale:I})}a.hasAnyZOffset=!1;let g=!1;for(let b=0;b<a.symbolInstances.length;b++){const E=a.symbolInstances.get(b),C=E.zOffset,I=this._getHeightAtTileOffset(f,E.tileAnchorX,E.tileAnchorY);E.zOffset=I!==Number.NEGATIVE_INFINITY?I:C,g||C===E.zOffset||(g=!0),a.hasAnyZOffset||E.zOffset===0||(a.hasAnyZOffset=!0)}g&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,f,g,b){let E=f,C=g;if(a.canonical.z!==b.canonical.z){const I=b.canonical,R=1/(1<<a.canonical.z-I.z);E=(f+a.canonical.x*s.al)*R-I.x*s.al|0,C=(g+a.canonical.y*s.al)*R-I.y*s.al|0}return{tileX:E,tileY:C}}_getHeightAtTileOffset(a,f,g){let b,E;for(let C=0;C<this.layers.length;++C){const I=this.layers[C].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:R,tileID:L,verticalScale:B}=this.currentBuildingBuckets[C];if(!R)continue;const{tileX:V,tileY:j}=this._mapCoordToOverlappingTile(a,f,g,L),W=R.getHeightAtTileCoord(V,j);W&&W.height!==void 0&&(W.hidden?b=W.height:E=Math.max(W.height*B,E||0))}if(E!==void 0)return E;for(let C=0;C<this.layers.length;++C){const I=this.layers[C];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:R,tileID:L}=this.currentBuildingBuckets[C];if(!R)continue;const{tileX:B,tileY:V}=this._mapCoordToOverlappingTile(a,f,g,L),j=R.getHeightAtTileCoord(B,V);if(j&&!j.hidden)return j.height===void 0&&b!==void 0?Math.min(j.maxHeight,b)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function RI(m,a){const f={};for(const g in m)g!=="ref"&&(f[g]=m[g]);return s.bx.forEach(g=>{g in a&&(f[g]=a[g])}),f}function Jw(m){m=m.slice();const a=Object.create(null);for(let f=0;f<m.length;f++)a[m[f].id]=m[f];for(let f=0;f<m.length;f++)"ref"in m[f]&&(m[f]=RI(m[f],a[m[f].ref]));return m}const vi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ip(m,a,f){f.push({command:vi.addSource,args:[m,a[m]]})}function jy(m,a,f){a.push({command:vi.removeSource,args:[m]}),f[m]=!0}function g3(m,a,f,g){jy(m,f,g),ip(m,a,f)}function y3(m,a,f){let g;for(g in m[f])if(m[f].hasOwnProperty(g)&&g!=="data"&&!s.by(m[f][g],a[f][g]))return!1;for(g in a[f])if(a[f].hasOwnProperty(g)&&g!=="data"&&!s.by(m[f][g],a[f][g]))return!1;return!0}function hg(m,a,f,g,b,E){let C;for(C in a=a||{},m=m||{})m.hasOwnProperty(C)&&(s.by(m[C],a[C])||f.push({command:E,args:[g,C,a[C],b]}));for(C in a)a.hasOwnProperty(C)&&!m.hasOwnProperty(C)&&(s.by(m[C],a[C])||f.push({command:E,args:[g,C,a[C],b]}))}function Od(m){return m.id}function fg(m,a){return m[a.id]=a,m}function Vy(m,a,f){const g=a.createTileMatrix(m,m.worldSize,f.toUnwrapped());return s.aB(new Float32Array(16),m.projMatrix,g)}function OI(m,a,f){if(a.projection.name===f.projection.name)return m.projMatrix;const g=f.clone();return g.setProjection(a.projection),Vy(g,a.getProjection(),m)}function rp(m,a,f){return a.name===f.projection.name?m.projMatrix:Vy(f,a,m)}class zu{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.aA(a,0,1);let f=1,g=this._distances[f];const b=a*this.paddedLength+this.padding;for(;g<b&&f<this._distances.length;)g=this._distances[++f];const E=f-1,C=this._distances[E],I=g-C,R=I>0?(b-C)/I:0;return this.points[E].mult(1-R).add(this.points[f].mult(R))}}class pg{constructor(a,f,g){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(f/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,g,b,E){this._forEachCell(f,g,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(a,f,g,b){this._forEachCell(f-b,g-b,f+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(g),this.circles.push(b)}_insertBoxCell(a,f,g,b,E,C){this.boxCells[E].push(C)}_insertCircleCell(a,f,g,b,E,C){this.circleCells[E].push(C)}_query(a,f,g,b,E,C){if(g<0||a>this.width||b<0||f>this.height)return!E&&[];const I=[];if(a<=0&&f<=0&&this.width<=g&&this.height<=b){if(E)return!0;for(let R=0;R<this.boxKeys.length;R++)I.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const L=this.circles[3*R],B=this.circles[3*R+1],V=this.circles[3*R+2];I.push({key:this.circleKeys[R],x1:L-V,y1:B-V,x2:L+V,y2:B+V})}return C?I.filter(C):I}return this._forEachCell(a,f,g,b,this._queryCell,I,{hitTest:E,seenUids:{box:{},circle:{}}},C),E?I.length>0:I}_queryCircle(a,f,g,b,E){const C=a-g,I=a+g,R=f-g,L=f+g;if(I<0||C>this.width||L<0||R>this.height)return!b&&[];const B=[];return this._forEachCell(C,R,I,L,this._queryCellCircle,B,{hitTest:b,circle:{x:a,y:f,radius:g},seenUids:{box:{},circle:{}}},E),b?B.length>0:B}query(a,f,g,b,E){return this._query(a,f,g,b,!1,E)}hitTest(a,f,g,b,E){return this._query(a,f,g,b,!0,E)}hitTestCircle(a,f,g,b){return this._queryCircle(a,f,g,!0,b)}_queryCell(a,f,g,b,E,C,I,R){const L=I.seenUids,B=this.boxCells[E];if(B!==null){const j=this.bboxes;for(const W of B)if(!L.box[W]){L.box[W]=!0;const Y=4*W;if(a<=j[Y+2]&&f<=j[Y+3]&&g>=j[Y+0]&&b>=j[Y+1]&&(!R||R(this.boxKeys[W]))){if(I.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[W],x1:j[Y],y1:j[Y+1],x2:j[Y+2],y2:j[Y+3]})}}}const V=this.circleCells[E];if(V!==null){const j=this.circles;for(const W of V)if(!L.circle[W]){L.circle[W]=!0;const Y=3*W;if(this._circleAndRectCollide(j[Y],j[Y+1],j[Y+2],a,f,g,b)&&(!R||R(this.circleKeys[W]))){if(I.hitTest)return C.push(!0),!0;{const Z=j[Y],J=j[Y+1],ie=j[Y+2];C.push({key:this.circleKeys[W],x1:Z-ie,y1:J-ie,x2:Z+ie,y2:J+ie})}}}}}_queryCellCircle(a,f,g,b,E,C,I,R){const L=I.circle,B=I.seenUids,V=this.boxCells[E];if(V!==null){const W=this.bboxes;for(const Y of V)if(!B.box[Y]){B.box[Y]=!0;const Z=4*Y;if(this._circleAndRectCollide(L.x,L.y,L.radius,W[Z+0],W[Z+1],W[Z+2],W[Z+3])&&(!R||R(this.boxKeys[Y])))return C.push(!0),!0}}const j=this.circleCells[E];if(j!==null){const W=this.circles;for(const Y of j)if(!B.circle[Y]){B.circle[Y]=!0;const Z=3*Y;if(this._circlesCollide(W[Z],W[Z+1],W[Z+2],L.x,L.y,L.radius)&&(!R||R(this.circleKeys[Y])))return C.push(!0),!0}}}_forEachCell(a,f,g,b,E,C,I,R){const L=this._convertToXCellCoord(a),B=this._convertToYCellCoord(f),V=this._convertToXCellCoord(g),j=this._convertToYCellCoord(b);for(let W=L;W<=V;W++)for(let Y=B;Y<=j;Y++)if(E.call(this,a,f,g,b,this.xCellCount*Y+W,C,I,R))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,g,b,E,C){const I=b-a,R=E-f,L=g+C;return L*L>I*I+R*R}_circleAndRectCollide(a,f,g,b,E,C,I){const R=(C-b)/2,L=Math.abs(a-(b+R));if(L>R+g)return!1;const B=(I-E)/2,V=Math.abs(f-(E+B));if(V>B+g)return!1;if(L<=R||V<=B)return!0;const j=L-R,W=V-B;return j*j+W*W<=g*g}}const _3=Math.tan(85*Math.PI/180);function Uh(m,a,f,g,b,E,C){const I=s.bC();if(f)if(E.name==="globe"){const R=s.bD(b,a);s.aB(I,I,R)}else{const R=s.bE([],C);I[0]=R[0],I[1]=R[1],I[4]=R[2],I[5]=R[3],g||s.bB(I,I,b.angle)}else s.aB(I,b.labelPlaneMatrix,m);return I}function Uu(m,a,f,g,b,E,C){const I=Uh(m,a,f,g,b,E,C);return E.name==="globe"&&f||(I[2]=I[6]=I[10]=I[14]=0),I}function fa(m,a,f,g,b,E,C){if(f){if(E.name==="globe"){const I=Uh(m,a,f,g,b,E,C);return s.bl(I,I),s.aB(I,m,I),I}{const I=s.bz(m),R=s.bA([]);return R[0]=C[0],R[1]=C[1],R[4]=C[2],R[5]=C[3],s.aB(I,I,R),g||s.bB(I,I,-b.angle),I}}return b.glCoordMatrix}function Uc(m,a,f,g){const b=[m,a,f,1];f?s.aC(b,b,g):Hy(b,b,g);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function Wy(m,a){return Math.min(.5+m/a*.5,1.5)}function w3(m,a){const f=m[0]/m[3],g=m[1]/m[3];return f>=-a[0]&&f<=a[0]&&g>=-a[1]&&g<=a[1]}function Di(m,a,f,g,b,E,C,I,R,L,B=1){const V=f.transform,j=g?m.textSizeData:m.iconSizeData,W=s.bK(j,f.transform.zoom,B),Y=V.projection.name==="globe",Z=[256/f.width*2+1,256/f.height*2+1],J=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;J.clear();let ie=null;Y&&(ie=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const pe=m.lineVertexArray,fe=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,ce=f.transform.width/f.transform.height;let Re,Ce=!1;for(let Se=0;Se<fe.length;Se++){const be=fe.get(Se),{numGlyphs:ye,writingMode:Ne}=be;if(Ne!==s.bL.vertical||Ce||Re===s.bL.horizontal||(Ce=!0),Re=Ne,(be.hidden||Ne===s.bL.vertical)&&!Ce){jo(ye,J);continue}Ce=!1;const We=new s.P(be.tileAnchorX,be.tileAnchorY),Ze=m.elevationType==="road",tt=!!V.elevation||Ze;let{x:Je,y:mt,z:xt}=V.projection.projectTilePoint(We.x,We.y,L.canonical),Xe=null;if(tt){const en=Ze?m.getElevationFeatureForText(Se):null;Xe={getElevation:R,elevation:V.elevation,elevationFeature:en};const[hn,Cn,Vn]=R(We,V.elevation,en);Je+=hn,mt+=Cn,xt+=Vn}const Me=[Je,mt,xt,1];if(s.aC(Me,Me,a),!w3(Me,Z)){jo(ye,J);continue}const dt=Me[3],nt=Wy(f.transform.getCameraToCenterDistance(V.projection),dt),St=s.bM(j,W,be),Rt=C?St/nt:St*nt,jt=Uc(Je,mt,xt,b);if(jt[3]<=0){jo(ye,J);continue}let Ot={};const Mt=s.an(m.layers[0].layout.get("text-max-angle")),rn=Math.cos(Mt),tn=C?null:Xe,Gt=v3(be,Rt,!1,I,a,b,E,m.glyphOffsetArray,pe,J,ie,jt,We,Ot,ce,tn,V.projection,L,C,rn);Ce=Gt.useVertical,tn&&Gt.needsFlipping&&(Ot={}),(Gt.notEnoughRoom||Ce||Gt.needsFlipping&&v3(be,Rt,!0,I,a,b,E,m.glyphOffsetArray,pe,J,ie,jt,We,Ot,ce,tn,V.projection,L,C,rn).notEnoughRoom)&&jo(ye,J)}g?(m.text.dynamicLayoutVertexBuffer.updateData(J),ie&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ie)):(m.icon.dynamicLayoutVertexBuffer.updateData(J),ie&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ie))}function Qw(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J){const{lineStartIndex:ie,glyphStartIndex:pe,segment:fe}=I,ce=pe+I.numGlyphs,Re=ie+I.lineLength,Ce=a.getoffsetX(pe),Se=a.getoffsetX(ce-1),be=jh(m*Ce,f,g,b,E,C,fe,ie,Re,R,L,B,V,j,!0,W,Y,Z,J);if(!be)return null;const ye=jh(m*Se,f,g,b,E,C,fe,ie,Re,R,L,B,V,j,!0,W,Y,Z,J);return ye?{first:be,last:ye}:null}function b3(m,a,f,g){return m===s.bL.horizontal&&Math.abs(g)>Math.abs(f)?{useVertical:!0}:m===s.bL.vertical?g>0?{needsFlipping:!0}:null:a!==0&&function(b,E){return b===0||Math.abs(E/b)>_3}(f,g)?a===1?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function v3(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie,pe,fe){const ce=a/24,Re=m.lineOffsetX*ce,Ce=m.lineOffsetY*ce,{lineStartIndex:Se,glyphStartIndex:be,numGlyphs:ye,segment:Ne,writingMode:We,flipState:Ze}=m,tt=Se+m.lineLength,Je=mt=>{if(B){const[dt,nt,St]=mt.up,Rt=L.length;s.bN(B,Rt+0,dt,nt,St),s.bN(B,Rt+1,dt,nt,St),s.bN(B,Rt+2,dt,nt,St),s.bN(B,Rt+3,dt,nt,St)}const[xt,Xe,Me]=mt.point;s.bO(L,xt,Xe,Me,mt.angle)};if(ye>1){const mt=Qw(ce,I,Re,Ce,f,V,j,m,R,E,W,Z,!1,J,ie,pe,fe);if(!mt)return{notEnoughRoom:!0};if(g&&!f){let[xt,Xe,Me]=mt.first.point,[dt,nt,St]=mt.last.point;[xt,Xe]=Uc(xt,Xe,Me,C),[dt,nt]=Uc(dt,nt,St,C);const Rt=b3(We,Ze,(dt-xt)*Y,nt-Xe);if(m.flipState=Rt&&Rt.needsFlipping?1:2,Rt)return Rt}Je(mt.first);for(let xt=be+1;xt<be+ye-1;xt++){const Xe=jh(ce*I.getoffsetX(xt),Re,Ce,f,V,j,Ne,Se,tt,R,E,W,Z,!1,!1,J,ie,pe,fe);if(!Xe)return L.length-=4*(xt-be),{notEnoughRoom:!0};Je(Xe)}Je(mt.last)}else{if(g&&!f){const xt=Uc(j.x,j.y,0,b),Xe=Se+Ne+1,Me=new s.P(R.getx(Xe),R.gety(Xe)),dt=Uc(Me.x,Me.y,0,b),nt=dt[3]>0?dt:eb(j,Me,xt,1,b,void 0,J,ie.canonical),St=b3(We,Ze,(nt[0]-xt[0])*Y,nt[1]-xt[1]);if(m.flipState=St&&St.needsFlipping?1:2,St)return St}const mt=jh(ce*I.getoffsetX(be),Re,Ce,f,V,j,Ne,Se,tt,R,E,W,Z,!1,!1,J,ie,pe,fe);if(!mt)return{notEnoughRoom:!0};Je(mt)}return{}}function xn(m,a,f,g,b){const{x:E,y:C,z:I}=g.projectTilePoint(m.x,m.y,a);if(!b)return Uc(E,C,I,f);const[R,L,B]=b.getElevation(m,b.elevation,b.elevationFeature);return Uc(E+R,C+L,I+B,f)}function eb(m,a,f,g,b,E,C,I){const R=xn(m.sub(a)._unit()._add(m),I,b,C,E);return s.av(R,f,R),s.aw(R,R),s.bH(R,f,R,g)}function jh(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie,pe){const fe=g?m-a:m+a;let ce=fe>0?1:-1,Re=0;g&&(ce*=-1,Re=Math.PI),ce<0&&(Re+=Math.PI);let Ce=I+C+(ce>0?0:1)|0,Se=b,be=b,ye=0,Ne=0;const We=Math.abs(fe),Ze=[],tt=[];let Je=E,mt=Je,xt=s.bF([]);const Xe=()=>eb(mt,Je,be,We-ye+1,B,j,Z,J.canonical);for(;ye+Ne<=We;){if(Ce+=ce,Ce<I||Ce>=R)return null;if(be=Se,mt=Je,Ze.push(be),W&&tt.push(mt),Je=new s.P(L.getx(Ce),L.gety(Ce)),Se=V[Ce],!Se){const tn=xn(Je,J.canonical,B,Z,j);Se=tn[3]>0?V[Ce]=tn:Xe()}ye+=Ne;const Mt=s.av([],Se,be),rn=s.bG(be,Se);if(f&&rn>0&&Ne>0&&s.bJ(xt,Mt)/(Ne*rn)<pe)return null;Ne=rn,xt=Mt}Y&&j&&(V[Ce]&&(Se=Xe(),Ne=s.bG(be,Se),xt=s.av([],Se,be)),V[Ce]=Se);const Me=(We-ye)/Ne,dt=Je.sub(mt)._mult(Me)._add(mt),nt=s.bH([],be,xt,Me);let St=[0,0,1],Rt=xt[0],jt=xt[1];if(ie&&(St=Z.upVector(J.canonical,dt.x,dt.y),St[0]!==0||St[1]!==0||St[2]!==1)){const Mt=[St[2],0,-St[0]],rn=s.bI([],St,Mt);s.aw(Mt,Mt),s.aw(rn,rn),Rt=s.bJ(xt,Mt),jt=s.bJ(xt,rn)}if(f){const Mt=s.bI([],St,xt);s.aw(Mt,Mt),s.bH(nt,nt,Mt,f*ce)}const Ot=Re+Math.atan2(jt,Rt);return Ze.push(nt),W&&tt.push(dt),{point:nt,angle:Ot,path:Ze,tilePath:tt,up:St}}function jo(m,a){const f=a.length,g=f+4*m;a.resize(g),a.float32.fill(-1/0,4*f,4*g)}function Hy(m,a,f){const g=a[0],b=a[1];return m[0]=f[0]*g+f[4]*b+f[12],m[1]=f[1]*g+f[5]*b+f[13],m[3]=f[3]*g+f[7]*b+f[15],m}const pa=100;class un{constructor(a,f,g=new pg(a.width+200,a.height+200,25),b=new pg(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=b,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+pa,this.screenBottomBoundary=a.height+pa,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,g,b,E,C,I,R,L,B,V){let j=g.projectedAnchorX,W=g.projectedAnchorY,Y=g.projectedAnchorZ;const Z=g.tileAnchorX,J=g.tileAnchorY,ie=g.elevation,pe=g.tileID,fe=a.getProjection();if(ie&&pe){const[tt,Je,mt]=fe.upVector(pe.canonical,g.tileAnchorX,g.tileAnchorY),xt=fe.upVectorScale(pe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;j+=tt*ie*xt,W+=Je*ie*xt,Y+=mt*ie*xt}const ce=a.projection.name==="globe",Re=a.projection.name==="globe"?s.aj(this.transform.zoom):0;if(pe&&ce&&Re<1&&!C){const tt=1<<pe.canonical.z,Je=s.bP(Z,J);s.bQ(Je,Je,1/s.al),s.bR(Je,Je,s.bP(pe.canonical.x,pe.canonical.y)),s.bQ(Je,Je,1/tt),s.bS(Je,Je,s.bP(b[0],b[1])),Je[0]=s.bT(Je[0],-.5,.5),s.bQ(Je,Je,s.al);const mt=s.bU(Je[0],Je[1],s.al/(2*Math.PI),1);s.aC(mt,mt,E),j=s.ak(j,mt[0],Re),W=s.ak(W,mt[1],Re),Y=s.ak(Y,mt[2],Re)}const Ce=this.projectAndGetPerspectiveRatio(B,j,W,Y,g.tileID,fe.name==="globe"||!!ie||this.transform.pitch>0,fe),Se=L*Ce.perspectiveRatio,be=(g.x1*f+I.x-g.padding)*Se+Ce.point.x,ye=(g.y1*f+I.y-g.padding)*Se+Ce.point.y,Ne=(g.x2*f+I.x+g.padding)*Se+Ce.point.x,We=(g.y2*f+I.y+g.padding)*Se+Ce.point.y,Ze=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(be,ye,Ne,We)||!R&&this.grid.hitTest(be,ye,Ne,We,V)||Ze?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[be,ye,Ne,We],offscreen:this.isOffscreen(be,ye,Ne,We),occluded:!1}}placeCollisionCircles(a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J){const ie=[],pe=this.transform.elevation,fe=a.getProjection(),ce=a.elevationType==="road",Re=!!pe||ce,Ce=s.bV.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,fe),Se=new s.P(g.tileAnchorX,g.tileAnchorY),be=new s.P(g.tileAnchorX,g.tileAnchorY);let{x:ye,y:Ne,z:We}=fe.projectTilePoint(be.x,be.y,J.canonical),Ze=null;if(Re){const rn=ce?a.getElevationFeatureForText(b):null;Ze={getElevation:Ce,elevation:pe,elevationFeature:rn};const[tn,Gt,en]=Ce(Se,pe,rn);ye+=tn,Ne+=Gt,We+=en}const tt=fe.name==="globe",Je=this.projectAndGetPerspectiveRatio(R,ye,Ne,We,J,tt||!!pe||this.transform.pitch>0,fe),{perspectiveRatio:mt}=Je,xt=(j?I/mt:I*mt)/s.bY,Xe=Uc(ye,Ne,We,L),Me=g.lineOffsetX*xt,dt=g.lineOffsetY*xt,nt=s.an(a.layers[0].layout.get("text-max-angle")),St=Math.cos(nt),Rt=Je.signedDistanceFromCamera>0?Qw(xt,C,Me,dt,ce&&g.flipState===1,Xe,be,g,E,L,{},Re&&!j?Ze:null,j&&Re,fe,J,j,St):null;let jt=!1,Ot=!1,Mt=!0;if(Rt&&!Je.occluded){const rn=.5*Y*mt+Z,tn=new s.P(-100,-100),Gt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),en=new zu,{first:hn,last:Cn}=Rt,Vn=hn.path.length;let ci=[];for(let Ln=Vn-1;Ln>=1;Ln--)ci.push(hn.path[Ln]);for(let Ln=1;Ln<Cn.path.length;Ln++)ci.push(Cn.path[Ln]);const Dn=2.5*rn;B&&(ci=ci.map(([Ln,Li,Ni],Fi)=>(Re&&!tt&&(Ni=Ce(Fi<Vn-1?hn.tilePath[Vn-1-Fi]:Cn.tilePath[Fi-Vn+2],pe,Ze.elevationFeature)[2]),Uc(Ln,Li,Ni,B))),ci.some(Ln=>Ln[3]<=0)&&(ci=[]));let wi=[];if(ci.length>0){let Ln=1/0,Li=-1/0,Ni=1/0,Fi=-1/0;for(const li of ci)Ln=Math.min(Ln,li[0]),Ni=Math.min(Ni,li[1]),Li=Math.max(Li,li[0]),Fi=Math.max(Fi,li[1]);Li>=tn.x&&Ln<=Gt.x&&Fi>=tn.y&&Ni<=Gt.y&&(wi=[ci.map(li=>new s.P(li[0],li[1]))],(Ln<tn.x||Li>Gt.x||Ni<tn.y||Fi>Gt.y)&&(wi=s.bW(wi,tn.x,tn.y,Gt.x,Gt.y)))}for(const Ln of wi){en.reset(Ln,.25*rn);let Li=0;Li=en.length<=.5*rn?1:Math.ceil(en.paddedLength/Dn)+1;for(let Ni=0;Ni<Li;Ni++){const Fi=Ni/Math.max(Li-1,1),li=en.lerp(Fi),zn=li.x+pa,Ii=li.y+pa;ie.push(zn,Ii,rn,0);const fr=zn-rn,pr=Ii-rn,Pi=zn+rn,ni=Ii+rn;if(Mt=Mt&&this.isOffscreen(fr,pr,Pi,ni),Ot=Ot||this.isInsideGrid(fr,pr,Pi,ni),!f&&this.grid.hitTestCircle(zn,Ii,rn,W)&&(jt=!0,!V))return{circles:[],offscreen:!1,collisionDetected:jt,occluded:!1}}}}return{circles:!V&&jt||!Ot?[]:ie,offscreen:Mt,collisionDetected:jt,occluded:Je.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let g=1/0,b=1/0,E=-1/0,C=-1/0;for(const B of a){const V=new s.P(B.x+pa,B.y+pa);g=Math.min(g,V.x),b=Math.min(b,V.y),E=Math.max(E,V.x),C=Math.max(C,V.y),f.push(V)}const I=this.grid.query(g,b,E,C).concat(this.ignoredGrid.query(g,b,E,C)),R={},L={};for(const B of I){const V=B.key;if(R[V.bucketInstanceId]===void 0&&(R[V.bucketInstanceId]={}),R[V.bucketInstanceId][V.featureIndex])continue;const j=[new s.P(B.x1,B.y1),new s.P(B.x2,B.y1),new s.P(B.x2,B.y2),new s.P(B.x1,B.y2)];s.bX(f,j)&&(R[V.bucketInstanceId][V.featureIndex]=!0,L[V.bucketInstanceId]===void 0&&(L[V.bucketInstanceId]=[]),L[V.bucketInstanceId].push(V.featureIndex))}return L}insertCollisionBox(a,f,g,b,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:E},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,g,b,E){const C=f?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:b,collisionGroupID:E};for(let R=0;R<a.length;R+=4)C.insertCircle(I,a[R],a[R+1],a[R+2])}projectAndGetPerspectiveRatio(a,f,g,b,E,C,I){const R=[f,g,b,1];let L=!1;b||this.transform.pitch>0?(s.aC(R,R,a),this.fogState&&E&&I.name!=="globe"&&(L=function(j,W,Y,Z,J,ie){const pe=ie.calculateFogTileMatrix(J),fe=[W,Y,Z];return s.af(fe,fe,pe),pn(j,s.ag(fe),ie.pitch,ie._fov)}(this.fogState,f,g,b,E.toUnwrapped(),this.transform)>.9)):Hy(R,R,a);const B=R[3];return{point:new s.P((R[0]/B+1)/2*this.transform.width+pa,(-R[1]/B+1)/2*this.transform.height+pa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/B*.5,1.5),signedDistanceFromCamera:B,occluded:C&&R[2]>B||L}}isOffscreen(a,f,g,b){return g<pa||a>=this.screenRightBoundary||b<pa||f>this.screenBottomBoundary}isInsideGrid(a,f,g,b){return g>=0&&a<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=s.bA([]);return s.br(a,a,[-100,-100,0]),a}}class Oi{constructor(a,f,g,b){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):b&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Ti{constructor(a,f,g,b,E,C=!1){this.text=new Oi(a?a.text:null,f,g,E),this.icon=new Oi(a?a.icon:null,f,b,E),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Vo{constructor(a,f,g,b=!1){this.text=a,this.icon=f,this.skipFade=g,this.clipped=b}}class sp{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Mi{constructor(a,f,g,b,E){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=E}}class Gy{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:g=>g.collisionGroupID===f}}return this.collisionGroups[a]}}function op(m,a,f,g,b){const{horizontalAlign:E,verticalAlign:C}=s.c1(m),I=-(E-.5)*a,R=-(C-.5)*f,L=s.c2(m,g);return new s.P(I+L[0]*b,R+L[1]*b)}function Vh(m,a,f,g,b){const E=new s.P(m,a);return f&&E._rotate(g?b:-b),E}class xo{constructor(a,f,g,b,E,C){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new un(this.transform,E),this.buildingIndex=C,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Gy(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(a,f,g,b,E=1){const C=g.getBucket(f),I=g.latestFeatureIndex;if(!C||!I||f.fqid!==C.layerIds[0])return;const R=C.layers[0].layout,L=C.layers[0].paint,B=g.collisionBoxArray,V=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),j=g.tileSize/s.al,W=g.tileID.toUnwrapped();this.transform.setProjection(C.projection);const Y=(Z=g.tileID,J=C.getProjection(),ie=this.transform,J.name===this.projection?ie.calculateProjMatrix(Z.toUnwrapped()):Vy(ie,J,Z));var Z,J,ie;const pe=R.get("text-pitch-alignment")==="map",fe=R.get("text-rotation-alignment")==="map";f.compileFilter(f.options);const ce=f.dynamicFilter(),Re=f.dynamicFilterNeedsFeature(),Ce=this.transform.calculatePixelsToTileUnitsMatrix(g),Se=Uu(Y,g.tileID.canonical,pe,fe,this.transform,C.getProjection(),Ce);let be=null;const ye=C.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(pe){const Me=fa(Y,g.tileID.canonical,pe,fe,this.transform,C.getProjection(),Ce);be=s.aB([],this.transform.labelPlaneMatrix,Me)}let Ne=null;ce&&g.latestFeatureIndex&&(Ne={unwrappedTileID:W,dynamicFilter:ce,dynamicFilterNeedsFeature:Re}),this.retainedQueryData[C.bucketInstanceId]=new Mi(C.bucketInstanceId,I,C.sourceLayerIndex,C.index,g.tileID);const[We,Ze]=C.layers[0].layout.get("text-size-scale-range"),tt=s.aA(E,We,Ze),[Je,mt]=R.get("icon-size-scale-range"),xt=s.aA(E,Je,mt),Xe={bucket:C,layout:R,paint:L,posMatrix:Y,invMatrix:ye,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Se,labelToScreenMatrix:be,clippingData:Ne,scale:V,textPixelRatio:j,holdingForFade:g.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:s.bK(C.textSizeData,this.transform.zoom,tt),partiallyEvaluatedIconSize:s.bK(C.iconSizeData,this.transform.zoom,xt),collisionGroup:this.collisionGroups.get(C.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(b)for(const Me of C.sortKeyRanges){const{sortKey:dt,symbolInstanceStart:nt,symbolInstanceEnd:St}=Me;a.push({sortKey:dt,symbolInstanceStart:nt,symbolInstanceEnd:St,parameters:Xe})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie,pe,fe,ce,Re){const{textOffset0:Ce,textOffset1:Se,crossTileID:be}=Z,ye=[Ce,Se],Ne=op(a,C,I,ye,R),We=this.collisionIndex.placeCollisionBox(ie,R,f,g,b,E,Vh(Ne.x,Ne.y,L,B,this.transform.angle),Y,V,j,W.predicate);if(fe){const Ze=ie.getSymbolInstanceIconSize(Re,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,Ze,fe,g,b,E,Vh(Ne.x,Ne.y,L,B,this.transform.angle),Y,V,j,W.predicate).box.length===0)return}if(We.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ze=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:ye,width:C,height:I,anchor:a,textScale:R,prevAnchor:Ze},this.markUsedJustification(ie,a,Z,pe),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,pe,Z),this.placedOrientations[be]=pe),{shift:Ne,placedGlyphBoxes:We}}}placeLayerBucketPart(a,f,g,b,E=1){const{bucket:C,layout:I,paint:R,posMatrix:L,textLabelPlaneMatrix:B,labelToScreenMatrix:V,clippingData:j,textPixelRatio:W,mercatorCenter:Y,invMatrix:Z,holdingForFade:J,collisionBoxArray:ie,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:fe,collisionGroup:ce,latestFeatureIndex:Re}=a.parameters,Ce=I.get("text-optional"),Se=I.get("icon-optional"),be=I.get("text-allow-overlap"),ye=I.get("icon-allow-overlap"),Ne=I.get("text-rotation-alignment")==="map",We=I.get("icon-rotation-alignment")==="map",Ze=I.get("text-pitch-alignment")==="map",tt=R.get("symbol-z-offset"),Je=I.get("symbol-elevation-reference")==="sea",mt=I.get("symbol-placement"),[xt,Xe]=I.get("text-size-scale-range"),[Me,dt]=I.get("icon-size-scale-range"),nt=s.aA(E,xt,Xe),St=s.aA(E,Me,dt),Rt=I.get("text-variable-anchor"),jt=Ne&&mt!=="point",Ot=We&&mt!=="point",Mt=Rt&&C.hasTextData(),rn=C.hasIconTextFit()&&Mt&&C.hasIconData();this.transform.setProjection(C.projection);const tn=Mt||jt,Gt=Ot||rn;let en=be&&(ye||!C.hasIconData()||Se),hn=ye&&(be||!C.hasTextData()||Ce);const Cn=!tt.isConstant();!C.collisionArrays&&ie&&C.deserializeCollisionBoxes(ie),g&&b&&C.updateCollisionDebugBuffers(this.transform.zoom,ie,nt,St);const Vn=(Dn,wi,Ln)=>{const{crossTileID:Li,numVerticalGlyphVertices:Ni}=Dn;let Fi=null;if(j&&j.dynamicFilterNeedsFeature||Cn){const gr=this.retainedQueryData[C.bucketInstanceId];Fi=Re.loadFeature({featureIndex:Dn.featureIndex,bucketIndex:gr.bucketIndex,sourceLayerIndex:gr.sourceLayerIndex,layoutVertexArrayOffset:0});const jr=Fi.properties?Fi.properties.worldview:null;if(C.localizable&&C.worldview&&typeof jr=="string")if(jr==="all")Fi.properties.$localized=!0;else{if(!jr.split(",").includes(C.worldview))return;Fi.properties.$localized=!0,Fi.properties.worldview=C.worldview}}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:C.worldview},Fi,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new s.P(Dn.tileAnchorX,Dn.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[Li]=new Vo(!1,!1,!1,!0),void f.add(Li);const li=tt.evaluate(Fi,{});if(f.has(Li))return;if(J)return void(this.placements[Li]=new Vo(!1,!1,!1));let zn=!1,Ii=!1,fr=!0,pr=!1,Pi=!1,ni=null,jn={box:null,offscreen:null,occluded:null},Ki={box:null},Ar=null,nr=null,or=null,qo=0,wa=0,Rs=0;Ln.textFeatureIndex?qo=Ln.textFeatureIndex:Dn.useRuntimeCollisionCircles&&(qo=Dn.featureIndex),Ln.verticalTextFeatureIndex&&(wa=Ln.verticalTextFeatureIndex);const Ri=C.elevationFeatures?C.elevationFeatures[Dn.elevationFeatureIndex]:void 0,Ma=gr=>{gr.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const jr=this.transform.elevation;gr.elevation=Je?li:li+s.bV.getAtTileOffset(gr.tileID,new s.P(gr.tileAnchorX,gr.tileAnchorY),jr,Ri),gr.elevation+=Dn.zOffset},eo=Ln.textBox;if(eo){Ma(eo);const gr=ir=>{let Jr=s.bL.horizontal;if(C.allowVerticalPlacement&&!ir&&this.prevPlacement){const uo=this.prevPlacement.placedOrientations[Li];uo&&(this.placedOrientations[Li]=uo,Jr=uo,this.markUsedOrientation(C,Jr,Dn))}return Jr},jr=(ir,Jr)=>{if(C.allowVerticalPlacement&&Ni>0&&Ln.verticalTextBox){for(const uo of C.writingModes)if(uo===s.bL.vertical?(jn=Jr(),Ki=jn):jn=ir(),jn&&jn.box&&jn.box.length)break}else jn=ir()};if(Rt){let ir=Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Li]){const Lr=this.prevPlacement.variableOffsets[Li];ir.indexOf(Lr.anchor)>0&&(ir=ir.filter(La=>La!==Lr.anchor),ir.unshift(Lr.anchor))}const Jr=(Lr,La,Zg)=>{const ou=C.getSymbolInstanceTextSize(pe,Dn,this.transform.zoom,wi),Rp=(Lr.x2-Lr.x1)*ou+2*Lr.padding,Op=(Lr.y2-Lr.y1)*ou+2*Lr.padding,Ba=Dn.hasIconTextFit&&!ye?La:null;Ba&&Ma(Ba);let au={box:[],offscreen:!1,occluded:!1};const cu=be?2*ir.length:ir.length;for(let mc=0;mc<cu;++mc){const Zu=this.attemptAnchorPlacement(ir[mc%ir.length],Lr,Y,Z,tn,Rp,Op,ou,Ne,Ze,W,L,ce,mc>=ir.length,Dn,wi,C,Zg,Ba,pe,fe);if(Zu&&(au=Zu.placedGlyphBoxes,au&&au.box&&au.box.length)){zn=!0,ni=Zu.shift;break}}return au};jr(()=>Jr(eo,Ln.iconBox,s.bL.horizontal),()=>{const Lr=Ln.verticalTextBox;return Lr&&Ma(Lr),C.allowVerticalPlacement&&!(jn&&jn.box&&jn.box.length)&&Ni>0&&Lr?Jr(Lr,Ln.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),jn&&(zn=jn.box,fr=jn.offscreen,pr=jn.occluded);const uo=gr(!(!jn||!jn.box));if(!zn&&this.prevPlacement){const Lr=this.prevPlacement.variableOffsets[Li];Lr&&(this.variableOffsets[Li]=Lr,this.markUsedJustification(C,Lr.anchor,Dn,uo))}}else{const ir=(Jr,uo)=>{const Lr=C.getSymbolInstanceTextSize(pe,Dn,this.transform.zoom,wi),La=this.collisionIndex.placeCollisionBox(C,Lr,Jr,Y,Z,tn,new s.P(0,0),be,W,L,ce.predicate);return La&&La.box&&La.box.length&&(this.markUsedOrientation(C,uo,Dn),this.placedOrientations[Li]=uo),La};jr(()=>ir(eo,s.bL.horizontal),()=>{const Jr=Ln.verticalTextBox;return C.allowVerticalPlacement&&Ni>0&&Jr?(Ma(Jr),ir(Jr,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),gr(!!(jn&&jn.box&&jn.box.length))}}if(Ar=jn,zn=Ar&&Ar.box&&Ar.box.length>0,fr=Ar&&Ar.offscreen,pr=Ar&&Ar.occluded,Dn.useRuntimeCollisionCircles){const gr=Dn.centerJustifiedTextSymbolIndex>=0?Dn.centerJustifiedTextSymbolIndex:Dn.verticalPlacedTextSymbolIndex,jr=C.text.placedSymbolArray.get(gr),ir=s.bM(C.textSizeData,pe,jr),Jr=I.get("text-padding");nr=this.collisionIndex.placeCollisionCircles(C,be,jr,gr,C.lineVertexArray,C.glyphOffsetArray,ir,L,B,V,g,Ze,ce.predicate,Dn.collisionCircleDiameter*ir/s.bY,Jr,this.retainedQueryData[C.bucketInstanceId].tileID),zn=be||nr.circles.length>0&&!nr.collisionDetected,fr=fr&&nr.offscreen,pr=nr.occluded}if(Ln.iconFeatureIndex&&(Rs=Ln.iconFeatureIndex),Ln.iconBox){const gr=jr=>{Ma(jr);const ir=Dn.hasIconTextFit&&ni?Vh(ni.x,ni.y,Ne,Ze,this.transform.angle):new s.P(0,0),Jr=C.getSymbolInstanceIconSize(fe,this.transform.zoom,Dn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Jr,jr,Y,Z,Gt,ir,ye,W,L,ce.predicate)};Ki&&Ki.box&&Ki.box.length&&Ln.verticalIconBox?(or=gr(Ln.verticalIconBox),Ii=or.box.length>0):(or=gr(Ln.iconBox),Ii=or.box.length>0),fr=fr&&or.offscreen,Pi=or.occluded}const Zo=Ce||Dn.numHorizontalGlyphVertices===0&&Ni===0,Hc=Se||Dn.numIconVertices===0;if(Zo||Hc?Hc?Zo||(Ii=Ii&&zn):zn=Ii&&zn:Ii=zn=Ii&&zn,zn&&Ar&&Ar.box&&this.collisionIndex.insertCollisionBox(Ar.box,I.get("text-ignore-placement"),C.bucketInstanceId,Ki&&Ki.box&&wa?wa:qo,ce.ID),Ii&&or&&this.collisionIndex.insertCollisionBox(or.box,I.get("icon-ignore-placement"),C.bucketInstanceId,Rs,ce.ID),nr&&(zn&&this.collisionIndex.insertCollisionCircles(nr.circles,I.get("text-ignore-placement"),C.bucketInstanceId,qo,ce.ID),g)){const gr=C.bucketInstanceId;let jr=this.collisionCircleArrays[gr];jr===void 0&&(jr=this.collisionCircleArrays[gr]=new sp);for(let ir=0;ir<nr.circles.length;ir+=4)jr.circles.push(nr.circles[ir+0]),jr.circles.push(nr.circles[ir+1]),jr.circles.push(nr.circles[ir+2]),jr.circles.push(nr.collisionDetected?1:0)}const Ko=C.projection.name!=="globe";en=en&&(Ko||!pr),hn=hn&&(Ko||!Pi),this.placements[Li]=new Vo(zn||en,Ii||hn,fr||C.justReloaded),f.add(Li)},ci=this.retainedQueryData[C.bucketInstanceId].tileID;if(C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,ci),C.elevationType==="road"&&C.updateRoadElevation(ci.canonical),C.updateZOffset(),C.sortFeaturesByY){const Dn=C.getSortedSymbolIndexes(this.transform.angle);for(let wi=Dn.length-1;wi>=0;--wi){const Ln=Dn[wi];Vn(C.symbolInstances.get(Ln),Ln,C.collisionArrays[Ln])}C.hasAnyZOffset&&s.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){const Dn=C.getSortedIndexesByZOffset();for(let wi=0;wi<Dn.length;++wi){const Ln=Dn[wi];Vn(C.symbolInstances.get(Ln),Ln,C.collisionArrays[Ln])}}else for(let Dn=a.symbolInstanceStart;Dn<a.symbolInstanceEnd;Dn++)Vn(C.symbolInstances.get(Dn),Dn,C.collisionArrays[Dn]);if(g&&C.bucketInstanceId in this.collisionCircleArrays){const Dn=this.collisionCircleArrays[C.bucketInstanceId];s.bl(Dn.invProjMatrix,L),Dn.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(a,f,g,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:R,crossTileID:L}=g,B=s.c3(f),V=b===s.bL.vertical?R:B==="left"?E:B==="center"?C:B==="right"?I:-1;E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=V>=0&&E!==V?0:L),C>=0&&(a.text.placedSymbolArray.get(C).crossTileID=V>=0&&C!==V?0:L),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=V>=0&&I!==V?0:L),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=V>=0&&R!==V?0:L)}markUsedOrientation(a,f,g){const b=f===s.bL.horizontal||f===s.bL.horizontalOnly?f:0,E=f===s.bL.vertical?f:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:L}=g,B=a.text.placedSymbolArray;C>=0&&(B.get(C).placedOrientation=b),I>=0&&(B.get(I).placedOrientation=b),R>=0&&(B.get(R).placedOrientation=b),L>=0&&(B.get(L).placedOrientation=E)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let g=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(a):1,E=f?f.opacities:{},C=f?f.variableOffsets:{},I=f?f.placedOrientations:{};for(const R in this.placements){const L=this.placements[R],B=E[R];B?(this.opacities[R]=new Ti(B,b,L.text,L.icon,null,L.clipped),g=g||L.text!==B.text.placed||L.icon!==B.icon.placed):(this.opacities[R]=new Ti(null,b,L.text,L.icon,L.skipFade,L.clipped),g=g||L.text||L.icon)}for(const R in E){const L=E[R];if(!this.opacities[R]){const B=new Ti(L,b,!1,!1);B.isHidden()||(this.opacities[R]=B,g=g||L.text.placed||L.icon.placed)}}for(const R in C)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=C[R]);for(const R in I)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=I[R]);g?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f,g,b){b&&(this.lastReplacementSourceUpdateTime=b.updateTime);const E=new Set;for(const C of f){const I=C.getBucket(a);I&&C.latestFeatureIndex&&a.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,E,C,C.collisionBoxArray,g,b,C.tileID,a.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,C.tileID),I.elevationType==="road"&&I.updateRoadElevation(C.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(a,f,g,b,E,C,I,R){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const L=a.layers[0].layout,B=a.layers[0].paint,V=!!a.layers[0].dynamicFilter(),j=new Ti(null,0,!1,!1,!0),W=L.get("text-allow-overlap"),Y=L.get("icon-allow-overlap"),Z=L.get("text-variable-anchor"),J=L.get("text-rotation-alignment")==="map",ie=L.get("text-pitch-alignment")==="map",pe=B.get("symbol-z-offset"),fe=L.get("symbol-elevation-reference")==="sea",ce=!pe.isConstant(),Re=new Ti(null,0,W&&(Y||!a.hasIconData()||L.get("icon-optional")),Y&&(W||!a.hasTextData()||L.get("text-optional")),!0);!a.collisionArrays&&b&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(b);const Ce=(be,ye,Ne)=>{for(let We=0;We<ye/4;We++)be.opacityVertexArray.emplaceBack(Ne)};let Se=0;C&&a.updateReplacement(I,C);for(let be=0;be<a.symbolInstances.length;be++){const ye=a.symbolInstances.get(be),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:We,crossTileID:Ze,numIconVertices:tt,tileAnchorX:Je,tileAnchorY:mt}=ye;let xt=null;const Xe=this.retainedQueryData[a.bucketInstanceId];ce&&ye&&Xe&&(xt=g.latestFeatureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:Xe.bucketIndex,sourceLayerIndex:Xe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Me=pe.evaluate(xt,{}),dt=f.has(Ze);let nt=this.opacities[Ze];dt?nt=j:nt||(nt=Re,this.opacities[Ze]=nt),f.add(Ze);const St=Ne>0||We>0,Rt=tt>0,jt=this.placedOrientations[Ze],Ot=jt===s.bL.vertical,Mt=jt===s.bL.horizontal||jt===s.bL.horizontalOnly;!St&&!Rt||nt.isHidden()||Se++;let rn=!1;if((St||Rt)&&C)for(const tn of a.activeReplacements){if(s.bZ(tn,E,s.b_.Symbol,R)||tn.min.x>Je||Je>tn.max.x||tn.min.y>mt||mt>tn.max.y)continue;const Gt=s.b$(Je,mt,I.canonical,tn.footprintTileId.canonical);if(rn=s.c0(Gt,tn.footprint),rn)break}if(St){const tn=rn?ma:Eo(nt.text);Ce(a.text,Ne,Ot?ma:tn),Ce(a.text,We,Mt?ma:tn);const Gt=nt.text.isHidden(),{leftJustifiedTextSymbolIndex:en,centerJustifiedTextSymbolIndex:hn,rightJustifiedTextSymbolIndex:Cn,verticalPlacedTextSymbolIndex:Vn}=ye,ci=a.text.placedSymbolArray,Dn=Gt||Ot?1:0;en>=0&&(ci.get(en).hidden=Dn),hn>=0&&(ci.get(hn).hidden=Dn),Cn>=0&&(ci.get(Cn).hidden=Dn),Vn>=0&&(ci.get(Vn).hidden=Gt||Mt?1:0);const wi=this.variableOffsets[Ze];wi&&this.markUsedJustification(a,wi.anchor,ye,jt);const Ln=this.placedOrientations[Ze];Ln&&(this.markUsedJustification(a,"left",ye,Ln),this.markUsedOrientation(a,Ln,ye))}if(Rt){const tn=rn?ma:Eo(nt.icon),{placedIconSymbolIndex:Gt,verticalPlacedIconSymbolIndex:en}=ye,hn=a.icon.placedSymbolArray,Cn=nt.icon.isHidden()?1:0;Gt>=0&&(Ce(a.icon,tt,Ot?ma:tn),hn.get(Gt).hidden=Cn),en>=0&&(Ce(a.icon,ye.numVerticalIconVertices,Mt?ma:tn),hn.get(en).hidden=Cn)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const tn=a.collisionArrays[be];if(tn){let Gt=new s.P(0,0),en=!0;if(tn.textBox||tn.verticalTextBox){if(Z){const Cn=this.variableOffsets[Ze];Cn?(Gt=op(Cn.anchor,Cn.width,Cn.height,Cn.textOffset,Cn.textScale),J&&Gt._rotate(ie?this.transform.angle:-this.transform.angle)):en=!1}V&&(en=!nt.clipped),tn.textBox&&Wr(a.textCollisionBox.collisionVertexArray,nt.text.placed,!en||Ot,Me,fe,Gt.x,Gt.y),tn.verticalTextBox&&Wr(a.textCollisionBox.collisionVertexArray,nt.text.placed,!en||Mt,Me,fe,Gt.x,Gt.y)}const hn=en&&!!(!Mt&&tn.verticalIconBox);tn.iconBox&&Wr(a.iconCollisionBox.collisionVertexArray,nt.icon.placed,hn,Me,fe,ye.hasIconTextFit?Gt.x:0,ye.hasIconTextFit?Gt.y:0),tn.verticalIconBox&&Wr(a.iconCollisionBox.collisionVertexArray,nt.icon.placed,!hn,Me,fe,ye.hasIconTextFit?Gt.x:0,ye.hasIconTextFit?Gt.y:0)}}}if(a.fullyClipped=Se===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=be.invProjMatrix,a.placementViewportMatrix=be.viewportMatrix,a.collisionCircleArray=be.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const g=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*g>a}isStale(){return this.stale}setStale(){this.stale=!0}}function Wr(m,a,f,g,b,E,C){m.emplaceBack(a?1:0,f?1:0,E||0,C||0,g,b?1:0),m.emplaceBack(a?1:0,f?1:0,E||0,C||0,g,b?1:0),m.emplaceBack(a?1:0,f?1:0,E||0,C||0,g,b?1:0),m.emplaceBack(a?1:0,f?1:0,E||0,C||0,g,b?1:0)}const kI=Math.pow(2,25),mg=Math.pow(2,24),tb=Math.pow(2,17),gg=Math.pow(2,16),qy=Math.pow(2,9),nb=Math.pow(2,8),Zy=Math.pow(2,1);function Eo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const a=m.placed?1:0,f=Math.floor(127*m.opacity);return f*kI+a*mg+f*tb+a*gg+f*qy+a*nb+f*Zy+a}const ma=0;class ga{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,f,g,b,E,C){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(I,b,a[this._currentTileIndex],this._sortAcrossTiles,C),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((R,L)=>R.sortKey-L.sortKey));this._currentPartIndex<I.length;){const R=I[this._currentPartIndex];if(f.placeLayerBucketPart(R,this._seenCrossTileIDs,g,R.symbolInstanceStart===0,C),this._currentPartIndex++,E())return!0}return!1}}class ib{startNewPlacement(a,f,g,b,E,C,I,R){return this.placement=new xo(a,b,E,C,I,R),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=g,this._fadeDuration=b,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(a,f,g,b,E){const C=s.o.now(),I=()=>{const R=s.o.now()-C;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&R>2};for(;this._currentPlacementIndex>=0;){const R=f[a[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&R.visibility!=="none"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){const B=R,V=B.layout.get("symbol-z-elevate"),j=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,W=B.layout.get("symbol-z-order"),Y=W==="viewport-y"||W==="auto"&&!(W!=="viewport-y"&&j),Z=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),J=Y&&Z,ie=this._inProgressLayer=this._inProgressLayer||new ga(B),pe=s.B(R.source,R.scope);if(ie.continuePlacement(V||J?b[pe]:g[pe],this.placement,this._showCollisionBoxes,R,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const kd=512/s.al/2;class xs{constructor(a,f,g){this.tileID=a,this.bucketInstanceId=g,this.index=new s.c4(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=a.canonical.x*s.al,E=a.canonical.y*s.al;for(let C=0;C<f.length;C++){const{key:I,crossTileID:R,tileAnchorX:L,tileAnchorY:B}=f.get(C),V=Math.floor((b+L)*kd),j=Math.floor((E+B)*kd);this.index.add(V,j),this.keys.push(I),this.crossTileIDs.push(R)}this.index.finish()}findMatches(a,f,g){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=kd/Math.pow(2,f.canonical.z-this.tileID.canonical.z),C=f.canonical.x*s.al,I=f.canonical.y*s.al;for(let R=0;R<a.length;R++){const L=a.get(R);if(L.crossTileID)continue;const{key:B,tileAnchorX:V,tileAnchorY:j}=L,W=Math.floor((C+V)*E),Y=Math.floor((I+j)*E),Z=this.index.range(W-b,Y-b,W+b,Y+b).sort((J,ie)=>J-ie);for(const J of Z){const ie=this.crossTileIDs[J];if(this.keys[J]===B&&!g.has(ie)){g.add(ie),L.crossTileID=ie;break}}}}}class Jl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ju{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const g in this.indexes){const b=this.indexes[g],E={};for(const C in b){const I=b[C];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+f),E[I.tileID.key]=I}this.indexes[g]=E}this.lng=a}addBucket(a,f,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let E=0;E<f.symbolInstances.length;E++)f.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const b=this.usedCrossTileIDs[a.overscaledZ];for(const E in this.indexes){const C=this.indexes[E];if(Number(E)>a.overscaledZ)for(const I in C){const R=C[I];R.tileID.isChildOf(a)&&R.findMatches(f.symbolInstances,a,b)}else{const I=C[a.scaledTo(Number(E)).key];I&&I.findMatches(f.symbolInstances,a,b)}}for(let E=0;E<f.symbolInstances.length;E++){const C=f.symbolInstances.get(E);C.crossTileID||(C.crossTileID=g.generate(),b.add(C.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new xs(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const g of f.crossTileIDs)this.usedCrossTileIDs[a].delete(g)}removeStaleBuckets(a){let f=!1;for(const g in this.indexes){const b=this.indexes[g];for(const E in b)a[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[E]),delete b[E],f=!0)}return f}}class ps{constructor(){this.layerIndexes={},this.crossTileIDs=new Jl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,g,b){let E=this.layerIndexes[a.fqid];E===void 0&&(E=this.layerIndexes[a.fqid]=new ju);let C=!1;const I={};b.name!=="globe"&&E.handleWrapJump(g);for(const R of f){const L=R.getBucket(a);L&&a.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(R.tileID,L,this.crossTileIDs)&&(C=!0),I[L.bucketInstanceId]=!0)}return E.removeStaleBuckets(I)&&(C=!0),C}pruneUnusedLayers(a){const f={};a.forEach(g=>{f[g]=!0});for(const g in this.layerIndexes)f[g]||delete this.layerIndexes[g]}}const Dd=771;class Nn{constructor(a,f,g,b){this.blendFunction=a,this.blendColor=f.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=b}}Nn.Replace=[1,0,1,0],Nn.disabled=new Nn(Nn.Replace,s.ao.transparent,[!1,!1,!1,!1]),Nn.unblended=new Nn(Nn.Replace,s.ao.transparent,[!0,!0,!0,!0]),Nn.alphaBlended=new Nn([1,Dd,1,Dd],s.ao.transparent,[!0,!0,!0,!0]),Nn.alphaBlendedNonPremultiplied=new Nn([770,Dd,770,Dd],s.ao.transparent,[!0,!0,!0,!0]),Nn.multiply=new Nn([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),Nn.additive=new Nn([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class cn{constructor(a,f,g){this.func=a,this.mask=f,this.range=g}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);const ap=7680;class Pn{constructor(a,f,g,b,E,C){this.test=a,this.ref=f,this.mask=g,this.fail=b,this.depthFail=E,this.pass=C}}Pn.disabled=new Pn({func:519,mask:0},0,0,ap,ap,ap);const Ky=1029,yg=2305;class En{constructor(a,f,g){this.enable=a,this.mode=f,this.frontFace=g}}function rb(m,a){const f=s.ca(m,3);s.cc(m,a),s.cg(m,3,f)}function sb(m,a){const f=s.c7([]);return s.c8(f,f,-a),s.c9(f,f,-m),f}function Ql(m,a){const f=[m[0],m[1],0],g=[a[0],a[1],0];if(s.ag(f)>=1e-15){const C=s.aw([],f);s.c5(g,C,s.bJ(g,C)),a[0]=g[0],a[1]=g[1]}const b=s.bI([],a,m);if(s.c6(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return sb(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),E)}En.disabled=new En(!1,Ky,yg),En.backCCW=new En(!0,Ky,yg),En.backCW=new En(!0,Ky,2304),En.frontCW=new En(!0,1028,2304),En.frontCCW=new En(!0,1028,yg);class x3{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof s.ae?a:new s.ae(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=s.bT(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f,g){if(this.orientation=null,!this.position)return;const b=this.position,E=g||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(a)):0),C=s.ae.fromLngLat(a,E),I=[C.x-b.x,C.y-b.y,C.z-b.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=Ql(I,f)}setPitchBearing(a,f){this.orientation=sb(s.an(a),s.an(-f))}}class cp{constructor(a,f){this._transform=s.bA([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new s.ae(a[0],a[1],a[2])}get position(){const a=s.ca(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&s.cg(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||s.c7([]),a&&rb(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=sb(a,f),rb(this._transform,this._orientation)}forward(){const a=s.ca(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=s.ca(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=s.ca(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const g=new Float64Array(16);return s.bl(g,this.getWorldToCamera(a,f)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,f,g){const b=this.position;s.c5(b,b,-a);const E=new Float64Array(16);return s.bq(E,[g,g,g]),s.br(E,E,b),E[10]*=f,E}getWorldToCamera(a,f){const g=new Float64Array(16),b=new Float64Array(4),E=this.position;return s.cb(b,this._orientation),s.c5(E,E,-a),s.cc(g,b),s.br(g,g,E),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=f,g[9]*=f,g[10]*=f,g[11]*=f,g}getCameraToClipPerspective(a,f,g,b){const E=new Float64Array(16);return s.cd(E,a,f,g,b),E}getCameraToClipOrthographic(a,f,g,b,E,C){const I=new Float64Array(16);return s.ce(I,a,f,g,b,E,C),I}getDistanceToElevation(a,f=!1){const g=a===0?0:s.cf(a,f?s.a$(this.position[1]):this.position[1]),b=this.forward();return(g-this.position[2])/b[2]}clone(){return new cp([...this.position],[...this.orientation])}}const ya=(m,a)=>({u_matrix:m,u_ground_shadow_factor:a});class ob{constructor(a=0,f=0,g=0,b=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=g,this.right=b}interpolate(a,f,g){return f.top!=null&&a.top!=null&&(this.top=s.ak(a.top,f.top,g)),f.bottom!=null&&a.bottom!=null&&(this.bottom=s.ak(a.bottom,f.bottom,g)),f.left!=null&&a.left!=null&&(this.left=s.ak(a.left,f.left,g)),f.right!=null&&a.right!=null&&(this.right=s.ak(a.right,f.right,g)),this}getCenter(a,f){const g=s.aA((this.left+a-this.right)/2,0,a),b=s.aA((this.top+f-this.bottom)/2,0,f);return new s.P(g,b)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new ob(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const eu=15;class Yy{constructor(a,f,g,b,E,C,I){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=g??0,this._maxPitch=b??60,this.setProjection(C),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ob,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new cp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const a=new Yy(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a._allowWorldUnderZoom=this._allowWorldUnderZoom,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<eu}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,f=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(a||g)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const g=this.getProjection(),b=!s.by(f,g);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const f=a!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=s.aA(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=s.an(a),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const a=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(a)}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let b=0,E=0;for(let C=0;C<f.length;C++){const I=new s.P(f[C][0]*this.width,g+f[C][1]*(this.height-g)),R=a.pointCoordinate(I);if(!R)continue;const L=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);b+=R[3]*L,E+=L}return E===0?NaN:b/E}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*f,b=this._mercatorZfromZoom(a),E=this._mercatorZfromZoom(this._maxZoom),C=Math.max(b-g,E);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}equals(a){const f=this.elevation,g=a.elevation,b=f!=null!=(g!=null)||f&&g&&f.exaggeration()!==g.exaggeration();return this.width===a.width&&this.height===a.height&&this.center.lng===a.center.lng&&this.center.lat===a.center.lat&&this.zoom===a.zoom&&this.bearing===a.bearing&&this.pitch===a.pitch&&this.fov===a.fov&&this.projection.name===a.projection.name&&this._edgeInsets.equals(a.padding)&&!b}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const b=s.ag(s.av([],this._camera.position,g));return s.aA(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!s.cp(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];s.cq(g,this._camera.position)||(this._setCameraPosition(g),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new x3;return f.position=new s.ae(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!s.cr(a))return!1;s.cs(a,a);const f=s.ct([],[0,0,-1],a),g=s.ct([],[0,-1,0],a);if(g[2]<0)return!1;const b=Ql(f,g);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;a[2]=s.aA(a[2],b/g,b/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,g){this._unmodified=!1,this._edgeInsets.interpolate(a,f,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new s.cu(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new s.P(0,0)),b=this.pointCoordinate(new s.P(this.width,0)),E=this.pointCoordinate(new s.P(this.width,this.height)),C=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(g.x,b.x,E.x,C.x)),R=Math.floor(Math.max(g.x,b.x,E.x,C.x)),L=1;for(let B=I-L;B<=R+L;B++)B!==0&&f.push(new s.cu(B,a))}return f}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(a,f,g,b){let E=[];const C=g!=null,I=!C;if(I&&this.zoom<f||C&&g[0]===0&&g[1]===0)return E;const R=new Set,L=(V,j,W,Y,Z)=>{const J=s.cY(j,V,W,Y,Z);R.has(J)||(E.push(new s.aQ(V,j,W,Y,Z)),R.add(J))};for(let V=0;V<a.length;V++){const j=a[V];if(I&&j.canonical.z!==f||C&&b!==void 0&&b>j.canonical.z)continue;const W=j.canonical,Y=j.overscaledZ,Z=j.wrap,J=1<<W.z,ie=W.x+1<J,pe=W.x>0,fe=W.y+1<J,ce=W.y>0,Re=j.wrap-(pe?0:1),Ce=j.wrap+(ie?0:1),Se=pe?W.x-1:J-1,be=ie?W.x+1:0;if(C)g[0]<0?(L(Y,Ce,W.z,be,W.y),g[1]<0&&fe&&(L(Y,Z,W.z,W.x,W.y+1),L(Y,Ce,W.z,be,W.y+1)),g[1]>0&&ce&&(L(Y,Z,W.z,W.x,W.y-1),L(Y,Ce,W.z,be,W.y-1))):g[0]>0?(L(Y,Re,W.z,Se,W.y),g[1]<0&&fe&&(L(Y,Z,W.z,W.x,W.y+1),L(Y,Re,W.z,Se,W.y+1)),g[1]>0&&ce&&(L(Y,Z,W.z,W.x,W.y-1),L(Y,Re,W.z,Se,W.y-1))):g[1]<0&&fe?L(Y,Z,W.z,W.x,W.y+1):ce&&L(Y,Z,W.z,W.x,W.y-1);else{const ye=j.visibleQuadrants;1&ye&&(L(Y,Re,W.z,Se,W.y),ce&&(L(Y,Z,W.z,W.x,W.y-1),L(Y,Re,W.z,Se,W.y-1))),2&ye&&(L(Y,Ce,W.z,be,W.y),ce&&(L(Y,Z,W.z,W.x,W.y-1),L(Y,Ce,W.z,be,W.y-1))),4&ye&&(L(Y,Re,W.z,Se,W.y),fe&&(L(Y,Z,W.z,W.x,W.y+1),L(Y,Re,W.z,Se,W.y+1))),8&ye&&(L(Y,Ce,W.z,be,W.y),fe&&(L(Y,Z,W.z,W.x,W.y+1),L(Y,Ce,W.z,be,W.y+1)))}}const B=[];for(const V of E)E.some(j=>V.isChildOf(j))||B.push(V);if(E=B.filter(V=>!a.some(j=>!!(V.overscaledZ<f&&j.isChildOf(V))||V.equals(j)||V.isChildOf(j))),I){const V=1<<f,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[V*j.x,V*j.y],Y=4,Z=Y*Y;E=E.filter(J=>{const ie=J.canonical.x+.5-W[0],pe=J.canonical.y+.5-W[1];return ie*ie+pe*pe<Z})}return E}extendTileCoverToNearPlane(a,f,g){const b=[],E=new Set;for(const pe of a)E.add(pe.key);const C=(pe,fe,ce,Re,Ce)=>{const Se=s.cY(fe,pe,ce,Re,Ce);E.has(Se)||(b.push(new s.aQ(pe,fe,ce,Re,Ce)),E.add(Se))},I=a.reduce((pe,fe)=>Math.max(pe,fe.overscaledZ),g),R=1<<g,L=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],B=new s.P(0,0),V=new s.P(0,0),j=(pe,fe)=>{const ce=Math.floor(pe[0]),Re=Math.floor(pe[1]),Ce=(pe[0]-ce)*s.al,Se=(pe[1]-Re)*s.al,be=Math.floor(fe[0]),ye=Math.floor(fe[1]),Ne=(fe[0]-be)*s.al,We=(fe[1]-ye)*s.al;for(let Ze=-1;Ze<=1;Ze++){const tt=ce+Ze;if(!(tt<0||tt>=R)){B.x=Ce-Ze*s.al,V.x=Ne-(tt-be)*s.al;for(let Je=-1;Je<=1;Je++){const mt=Re+Je;B.y=Se-Je*s.al,V.y=We-(mt-ye)*s.al,s.cZ(B,V,L)&&C(I,0,g,tt,mt)}}}},W=f.points,Y=W[s.cv],Z=W[s.cw],J=this._projectToGround(Y,W[s.cx]),ie=this._projectToGround(Z,W[s.cy]);return j(Y,J),j(Z,ie),b}_projectToGround(a,f){return s.cz(s.cA(),a,f,a[2]/(a[2]-f[2]))}coveringTiles(a){let f=this.coveringZoomLevel(a);const g=f,b=this.elevation&&this.elevation.exaggeration(),E=b&&!a.isTerrainDEM,C=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const I=this.locationCoordinate(this.center),R=this.center.lat,L=1<<f,B=[L*I.x,L*I.y,0],V=this.projection.name==="globe",j=!V,W=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,j),Y=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=L*s.cf(1,this.center.lat),J=this._camera.position[2]/s.cf(1,this.center.lat),ie=[L*Y.x,L*Y.y,J*(j?1:Z)],pe=V||b,fe=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ce=this.isLODDisabled(!0)?f:0;let Re;if(this._elevation&&a.isTerrainDEM)Re=1e4*this._elevation.exaggeration();else if(this._elevation){const Me=this._elevation.getMinMaxForVisibleTiles();Re=Me?Me.max:this._centerAltitude}else Re=this._centerAltitude;const Ce=a.isTerrainDEM?-Re:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?s.cC(this):1,be=Me=>{const nt=new s.ae(Me.x+25e-6,Me.y,Me.z),St=new s.ae(Me.x,Me.y+25e-6,Me.z),Rt=Me.toLngLat(),jt=nt.toLngLat(),Ot=St.toLngLat(),Mt=this.locationCoordinate(Rt),rn=this.locationCoordinate(jt),tn=this.locationCoordinate(Ot),Gt=Math.hypot(rn.x-Mt.x,rn.y-Mt.y),en=Math.hypot(tn.x-Mt.x,tn.y-Mt.y);return Math.sqrt(Gt*en)*Se/25e-6},ye=Me=>{const dt=Re,nt=Ce;return{aabb:s.cF(this,L,0,0,0,Me,nt,dt,this.projection),zoom:0,x:0,y:0,minZ:nt,maxZ:dt,wrap:Me,fullyVisible:!1}},Ne=[];let We=[];const Ze=f,tt=a.reparseOverscaled?g:f,Je=(J-this._centerAltitude)*Z,mt=Me=>{if(!this._elevation||!Me.tileID||!C)return;const dt=this._elevation.getMinMaxForTile(Me.tileID),nt=Me.aabb;dt?(nt.min[2]=dt.min,nt.max[2]=dt.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(Me.shouldSplit=Xe(Me),Me.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},xt=(Me,dt)=>{if(.707*dt<Me)return 1;const nt=dt/Me;return nt/(1.4144271570014144+(Math.pow(1.1,nt-1.4144271570014144+1)-1)/(1.1-1)-1)},Xe=Me=>{if(Me.zoom<ce)return!0;if(Me.zoom===Ze)return!1;if(Me.shouldSplit!=null)return Me.shouldSplit;const dt=Me.aabb.distanceX(ie),nt=Me.aabb.distanceY(ie);let St=Je,Rt=1;if(V){St=Me.aabb.distanceZ(ie);const en=Math.pow(2,Me.zoom),hn=s.a$((Me.y+1)/en),Cn=s.a$(Me.y/en),Vn=Math.min(Math.max(R,hn),Cn),ci=s.d1(Vn)/s.d1(R);if(Rt=Vn===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ci/this._mercatorScaleRatio),this.zoom<=s.c_&&Me.zoom===Ze-1&&ci>=.9)return!0}else if(E&&(St=Me.aabb.distanceZ(ie)*Z),this.projection.isReprojectedInTileSpace&&g<=5){const en=Math.pow(2,Me.zoom),hn=be(new s.ae((Me.x+.5)/en,(Me.y+.5)/en));Rt=hn>.85?1:hn}if(!C&&!V){const en=Math.sqrt(dt*dt+nt*nt+St*St);let hn=(1<<Ze-Me.zoom)*fe*Rt;return hn*=xt(Math.max(St,Je),en),en<hn}let jt=Number.MAX_VALUE,Ot=0;const Mt=Me.aabb.getCorners(),rn=[];for(const en of Mt){s.av(rn,en,ie),V||(E?rn[2]*=Z:rn[2]=Je);const hn=s.bJ(rn,this._camera.forward());hn<jt&&(jt=hn,Ot=Math.abs(rn[2]))}let tn=(1<<Ze-Me.zoom)*fe*Rt;if(tn*=xt(Math.max(Ot,Je),jt),jt<tn)return!0;const Gt=Me.aabb.closestPoint(B);return Gt[0]===B[0]&&Gt[1]===B[1]};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)Ne.push(ye(-Me)),Ne.push(ye(Me));for(Ne.push(ye(0));Ne.length>0;){const Me=Ne.pop(),dt=Me.x,nt=Me.y;let St=Me.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(Me.y===0||Me.y===(1<<Me.zoom)-1);if(!St){let jt=pe?Me.aabb.intersects(W):Me.aabb.intersectsFlat(W);if(jt===0&&Rt()){const Ot=new s.cD(Me.zoom,dt,nt);jt=s.cE(this,L,Ot,!0).intersects(W)}if(jt===0)continue;St=jt===2}if(Me.zoom===Ze||!Xe(Me)){const jt=Me.zoom===Ze?tt:Me.zoom;if(a.minzoom&&a.minzoom>jt)continue;let Ot=0;if(!St){let Gt=pe?Me.aabb.intersectsPrecise(W):Me.aabb.intersectsPreciseFlat(W);if(Gt===0&&Rt()){const en=new s.cD(Me.zoom,dt,nt);Gt=s.cE(this,L,en,!0).intersectsPrecise(W)}if(Gt===0)continue;if(a.calculateQuadrantVisibility)if(W.containsPoint(Me.aabb.center))Ot=15;else for(let en=0;en<4;en++)Me.aabb.quadrant(en).intersects(W)!==0&&(Ot|=1<<en)}const Mt=B[0]-(.5+dt+(Me.wrap<<Me.zoom))*(1<<f-Me.zoom),rn=B[1]-.5-nt,tn=Me.tileID?Me.tileID:new s.aQ(jt,Me.wrap,Me.zoom,dt,nt);a.calculateQuadrantVisibility&&(tn.visibleQuadrants=Ot),We.push({tileID:tn,distanceSq:Mt*Mt+rn*rn});continue}for(let jt=0;jt<4;jt++){const Ot=(dt<<1)+jt%2,Mt=(nt<<1)+(jt>>1),rn={aabb:C?Me.aabb.quadrant(jt):s.cF(this,L,Me.zoom+1,Ot,Mt,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:Ot,y:Mt,wrap:Me.wrap,fullyVisible:St,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};E&&!V&&(rn.tileID=new s.aQ(Me.zoom+1===Ze?tt:Me.zoom+1,Me.wrap,Me.zoom+1,Ot,Mt),mt(rn)),Ne.push(rn)}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,dt=this.horizonLineFromTop();We=We.filter(nt=>{const St=[0,0,0,1],Rt=[s.al,s.al,0,1],jt=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());s.aC(St,St,jt),s.aC(Rt,Rt,jt);const Ot=s.cG([],St,Rt),Mt=s.cH([],St,Rt),rn=s.c$(Ot,Mt);if(rn===0)return!0;let tn=!1;const Gt=this._elevation;if(Gt&&rn>Me&&dt!==0){const en=this.calculateProjMatrix(nt.tileID.toUnwrapped());let hn;a.isTerrainDEM||(hn=Gt.getMinMaxForTile(nt.tileID)),hn||(hn={min:Ce,max:Re});const Cn=s.cI(this.rotation),Vn=[Cn[0]*s.al,Cn[1]*s.al,hn.max];s.af(Vn,Vn,en),tn=(1-Vn[1])*this.height*.5<dt}return rn<Me||tn})}return We.sort((Me,dt)=>Me.distanceSq-dt.distanceSq).map(Me=>Me.tileID)}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log2(a)}project(a){const f=s.aA(a.lat,-s.cJ,s.cJ),g=this.projection.project(a.lng,f);return new s.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,f){let g,b;const E=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;g=(f.x-E.x)/I,b=(f.y-E.y)/I}else{const I=this.pointCoordinate(f),R=this.pointCoordinate(E);g=I.x-R.x,b=I.y-R.y}const C=this.locationCoordinate(a);this.setLocation(new s.ae(C.x-g,C.y-b))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a,f){return this.projection.locationPoint(this,a,f)}locationPoint3D(a,f){return this.projection.locationPoint(this,a,f,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a,f){return this.coordinateLocation(this.pointCoordinate3D(a,f))}locationCoordinate(a,f){const g=f?s.cf(f,a.lat):void 0,b=this.projection.project(a.lng,a.lat);return new s.ae(b.x,b.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const g=f??this._centerAltitude,b=[a.x,a.y,0,1],E=[a.x,a.y,1,1];s.aC(b,b,this.pixelMatrixInverse),s.aC(E,E,this.pixelMatrixInverse);const C=E[3];s.cK(b,b,1/b[3]),s.cK(E,E,1/C);const I=b[2],R=E[2];return{p0:b,p1:E,t:I===R?0:(g-I)/(R-I)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return s.aC(f,f,this.pixelMatrixInverse),s.aC(g,g,this.pixelMatrixInverse),s.cK(f,f,1/f[3]),s.cK(g,g,1/g[3]),f[2]=s.cf(f[2],this._center.lat)*this.worldSize,g[2]=s.cf(g[2],this._center.lat)*this.worldSize,s.cK(f,f,1/this.worldSize),s.cK(g,g,1/this.worldSize),new s.ax([f[0],f[1],f[2]],s.aw([],s.av([],g,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:g,t:b}=a,E=s.cf(f[2],this._center.lat),C=s.cf(g[2],this._center.lat);return new s.ae(s.ak(f[0],g[0],b)/this.worldSize,s.ak(f[1],g[1],b)/this.worldSize,s.ak(E,C,b))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a,f){if(!this.elevation)return this.pointCoordinate(a,f);let g=this.projection.pointCoordinate3D(this,a.x,a.y);if(g)return new s.ae(g[0],g[1],g[2]);let b=0,E=this.horizonLineFromTop();if(a.y>E)return this.pointCoordinate(a,f);const C=.02*E,I=a.clone();for(let R=0;R<10&&E-b>C;R++){I.y=s.ak(b,E,.66);const L=this.projection.pointCoordinate3D(this,I.x,I.y);L?(E=I.y,g=L):b=I.y}return g?new s.ae(g[0],g[1],g[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(a);const f=this.pointCoordinate(a);return f.y>=0&&f.y<=1}_coordinatePoint(a,f){const g=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,b=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return s.aC(b,b,this.pixelMatrix),b[3]>0?new s.P(b[0]/b[3],b[1]/b[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:f}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new s.P(f,a)),C=this.pointLocation3D(new s.P(b,a)),I=this.pointLocation3D(new s.P(b,g)),R=this.pointLocation3D(new s.P(f,g));let L=Math.min(E.lng,C.lng,I.lng,R.lng),B=Math.max(E.lng,C.lng,I.lng,R.lng),V=Math.min(E.lat,C.lat,I.lat,R.lat),j=Math.max(E.lat,C.lat,I.lat,R.lat);const W=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,Z=(J,ie,pe,fe,ce)=>{const Re=(J+pe)/2,Ce=(ie+fe)/2,Se=new s.P(Re,Ce),{lng:be,lat:ye}=this.pointLocation3D(Se),Ne=Math.max(0,L-be,V-ye,be-B,ye-j);L=Math.min(L,be),B=Math.max(B,be),V=Math.min(V,ye),j=Math.max(j,ye),(ce<Y||Ne>W)&&(Z(J,ie,Re,Ce,ce+1),Z(Re,Ce,pe,fe,ce+1))};if(Z(f,a,b,a,1),Z(b,a,b,g,1),Z(b,g,f,g,1),Z(f,g,f,a,1),this.projection.name==="globe"){const[J,ie]=s.cM(this);J?(j=90,B=180,L=-180):ie&&(V=-90,B=180,L=-180)}return new s.aI(new s.aT(L,V),new s.aT(B,j))}_getBoundsRectangular(a,f){const{top:g,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,I=new s.P(b,g),R=new s.P(C,g),L=new s.P(C,E),B=new s.P(b,E);let V=this.pointCoordinate(I,a),j=this.pointCoordinate(R,a);const W=this.pointCoordinate(L,f),Y=this.pointCoordinate(B,f),Z=(J,ie)=>(ie.y-J.y)/(ie.x-J.x);return V.y>1&&j.y>=0?V=new s.ae((1-Y.y)/Z(Y,V)+Y.x,1):V.y<0&&j.y<=1&&(V=new s.ae(-Y.y/Z(Y,V)+Y.x,0)),j.y>1&&V.y>=0?j=new s.ae((1-W.y)/Z(W,j)+W.x,1):j.y<0&&V.y<=1&&(j=new s.ae(-W.y/Z(W,j)+W.x,0)),new s.aI().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=a.visibleDemTiles.reduce((g,b)=>{if(b.dem){const E=b.dem.tree;g.min=Math.min(g.min,E.minimums[0]),g.max=Math.max(g.max,E.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,g=this._distanceTileDataCache;if(g[f])return g[f];const b=a.canonical,E=1/this.height,C=this.cameraWorldSize,I=C/this.zoomScale(b.z),R=(b.x+Math.pow(2,b.z)*a.wrap)*I,L=b.y*I,B=this.point;B.x*=C/this.worldSize,B.y*=C/this.worldSize;const V=this.angle,j=Math.sin(-V),W=-Math.cos(-V);return g[f]={bearing:[j,W],center:[(B.x-R)*E,(B.y-L)*E],scale:I/s.al*E},g[f]}calculateFogTileMatrix(a){const f=a.key,g=this._fogTileMatrixCache;if(g[f])return g[f];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return s.aB(b,this.worldToFogMatrix,b),g[f]=new Float32Array(b),g[f]}calculateProjMatrix(a,f=!1,g=!1){const b=a.key;let E;if(E=g?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,E[b])return E[b];const C=this.calculatePosMatrix(a,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,s.aB(C,I,C),E[b]=new Float32Array(C),E[b]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[f])return g[f];const b=s.cN(a,this);return g[f]=b,g[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,f=s.bq([],[a,a,a]);return s.aB(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const f=s.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),b=this._camera.forward(),E=s.cf(1,this._center.lat);g[2]/=E,b[2]/=E,s.aw(b,b);const C=a.raycast(g,b,a.exaggeration());if(C){const I=s.bH([],g,b,C),R=new s.ae(I[0],I[1],s.cf(I[2],s.a$(I[1]))),L=(R.z+s.ag([R.x-g[0],R.y-g[1],R.z-g[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const f=this._elevation,g=s.cf(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),E=f.getAtPointOrZero(new s.ae(...b)),C=this.pixelsPerMeter/this.worldSize*E,I=this._minimumHeightOverTerrain(),R=b[2]-C;if(R<=I)if(R<0||a){const L=this.locationCoordinate(this._center,this._centerAltitude),B=[b[0],b[1],L.z-b[2]],V=s.ag(B);B[2]-=(I-R)/this._pixelsPerMercatorPixel;const j=s.ag(B);if(j===0)return;s.c5(B,B,V/j*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],L.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const j=this.center;return j.lat=s.aA(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(j.lng=s.aA(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const f=this._unmodified,{x:g,y:b}=this.point;let E=0,C=g,I=b;const R=this.width/2,L=this.height/2,B=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(b-L<B&&(I=B+L),b+L>V&&(I=V-L),V-B<this.height&&(E=Math.max(E,this.height/(V-B)),I=(V+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,Y=this.worldSize/2-(j+W)/2;C=(g+Y+this.worldSize)%this.worldSize-Y,C-R<j&&(C=j+R),C+R>W&&(C=W-R),W-j<this.width&&(E=Math.max(E,this.width/(W-j)),C=(W+j)/2)}C===g&&I===b||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(C,I))),E&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,f=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const b=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this.projection.zAxisUnit==="meters"?g:1,C=this._camera.getWorldToCamera(this.worldSize,E);let I;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-a.x/this.width,R[9]=2*a.y/this.height,this.isOrthographic){let ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ne=ye*this.aspect,We=-Ne,Ze=-ye;Ne-=a.x,We-=a.x,ye+=a.y,Ze+=a.y,I=this._camera.getCameraToClipOrthographic(We,Ne,Ze,ye,this._nearZ,this._farZ),((tt,Je,mt,xt)=>{for(let Xe=0;Xe<16;Xe++)tt[Xe]=s.ak(Je[Xe],mt[Xe],xt)})(I,I,R,s.d0(this.pitch>=eu?1:this.pitch/eu))}else I=R;const L=s.cP([],R,C);let B=s.cP([],I,C);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),Ne=s.bA([]);s.br(Ne,Ne,[ye.x*this.worldSize,ye.y*this.worldSize,0]),s.aB(Ne,Ne,s.cQ(this)),s.br(Ne,Ne,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),s.aB(B,B,Ne),s.aB(L,L,Ne),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],B,[this.worldSize,this.worldSize,this.worldSize/E,1]),this.projMatrix=B,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),f){const ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ye[8]=2*-a.x/this.width,ye[9]=2*a.y/this.height,this.expandedFarZProjMatrix=s.cP([],ye,C)}else this.expandedFarZProjMatrix=this.projMatrix;const V=s.bl([],I);this.frustumCorners=s.cT.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const j=new Float32Array(16);s.bA(j),s.cS(j,j,[1,-1,1]),s.cU(j,j,this._pitch),s.bB(j,j,this.angle);const W=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(W);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-a.x/this.width,W[9]=2*(a.y+Y)/this.height,this.skyboxMatrix=s.aB(j,W,j);const Z=this.point,J=Z.x,ie=Z.y,pe=this.width%2/2,fe=this.height%2/2,ce=Math.cos(this.angle),Re=Math.sin(this.angle),Ce=J-Math.round(J)+ce*pe+Re*fe,Se=ie-Math.round(ie)+ce*fe+Re*pe,be=new Float64Array(B);if(s.br(be,be,[Ce>.5?Ce-1:Ce,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=be,B=s.bC(),s.cS(B,B,[this.width/2,-this.height/2,1]),s.br(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.bC(),s.cS(B,B,[1,-1,1]),s.br(B,B,[-1,-1,0]),s.cS(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},B=s.bl(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(ye,ye,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,g=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[a,a,f];s.c5(E,E,b),s.c5(g,g,-1),s.cW(g,g,E);const C=s.bC();s.br(C,C,g),s.cS(C,C,E),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,b)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-g[0]*E,b.y/this.worldSize-g[1]*E,a/this.worldSize*this._centerAltitude-g[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],b=a[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((f-g)/b,1)),this._camera.position=s.bH([],this._camera.position,a,E),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:g,bearing:b}=this._camera.getPitchBearing(),E=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((a[2]-E)/Math.cos(g),C),R=this._zoomFromMercatorZ(I);s.bH(a,a,f,I),this._pitch=s.aA(g,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(b,-Math.PI,Math.PI),this._setZoom(s.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,a)*this.tileSize))}zoomFromMercatorZAdjusted(a){let f=0,g=s.cL,b=0,E=1/0;for(;g-f>1e-6&&g>f;){const C=f+.5*(g-f),I=this.tileSize*Math.pow(2,C),R=this.getCameraToCenterDistance(this.projection,C,I),L=this.scaleZoom(R/(Math.max(0,a)*this.tileSize)),B=Math.abs(C-L);B<E&&(E=B,b=C),C<L?f=C:g=C}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,f){const g=Math.min(a.x,f.x),b=Math.max(a.x,f.x),E=Math.min(a.y,f.y),C=Math.max(a.y,f.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(g,E),new s.P(b,C),new s.P(g,C),new s.P(b,E)],R=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const B of I){const V=this.pointRayIntersection(B);if(V.t<0)return!0;const j=this.rayIntersectionCoordinate(V);if(j.x<R||j.y<0||j.x>L||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(a,f){const g=s.ag(s.av([],this._camera.position,a)),b=this._zoomFromMercatorZ(g)+f;return g-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([f,g,b],E){const C=[f,g,b,1];s.aC(C,C,E);const I=C[3]=Math.max(C[3],1e-6);return C[0]/=I,C[1]/=I,C[2]/=I,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,a))}}getCameraToCenterDistance(a,f=this.zoom,g=this.worldSize){const b=s.cO(a,f,this.width,this.height,1024),E=a.pixelSpaceConversion(this.center.lat,g,b);let C=.5/Math.tan(.5*this._fov)*this.height*E;return this.isOrthographic&&(C=s.ak(1,C,s.d0(this.pitch>=eu?1:this.pitch/eu))),C}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(a,a,this.globeMatrix),a}getFrustum(a){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const jc=(m,a)=>{if(a>0&&m.terrain&&s.w("Cutoff is currently disabled on terrain"),a<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=m.transform,g=Math.max(Math.abs(f._zoom-(m.minCutoffZoom-1)),1),b=f.isLODDisabled(!1)?s.ah(60,45,f.pitch):s.ah(30,15,f.pitch),E=f._farZ-f._nearZ,C=a*f.height,I=((1-(R=b))*f.cameraToCenterDistance+R*(f._farZ+C))*g;var R;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(I-f._nearZ)/E,(I-C-f._nearZ)/E]}}},Nd=2048;class DI{constructor(a,f){this.aabb=a,this.lastCascade=f}}class _g{add(a,f){const g=this.receivers[a.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],f.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],f.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],f.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],f.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],f.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],f.max[2])):this.receivers[a.key]=new DI(f,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,f,g){const b=s.d9.fromPoints(a.points);let E=0;for(const C in this.receivers){const I=this.receivers[C];if(!I||!b.intersectsAabb(I.aabb))continue;I.aabb.min=b.closestPoint(I.aabb.min),I.aabb.max=b.closestPoint(I.aabb.max);const R=I.aabb.getCorners();for(let L=0;L<g.length;L++){let B=!0;for(const V of R){const j=[V[0]*f,V[1]*f,V[2]];if(s.af(j,j,g[L].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){B=!1;break}}if(I.lastCascade=L,E=Math.max(E,L),B)break}}return E+1}}class wg{constructor(a){this.painter=a,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new _g,this._depthMode=new cn(a.context.gl.LEQUAL,cn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,f){const g=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!f||!f.properties)return;const b=f.properties.get("shadow-intensity"),E=f.properties.get("shadow-draw-before-layer");if(!f.shadowsEnabled()||b<=0)return;let C=-1,I=0;for(const ie of g.style.order){const pe=g.style._mergedLayers[ie];pe.hasShadowPass()&&!pe.isHidden(a.zoom)&&(C=I),E&&E===ie&&(this._drawShadowAfterLayer=I>0?I-1:0),I+=1}if(this._enabled=C>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=C);const R=g.context,L=Nd,B=Nd;if(this._cascades.length===0||Nd!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ie=0;ie<2;++ie){const pe=g._shadowMapDebug,fe=R.gl,ce=R.createFramebuffer(L,B,pe?1:0,"texture"),Re=new s.T(R,{width:L,height:B,data:null},fe.DEPTH_COMPONENT16);if(ce.depthAttachment.set(Re.texture),pe){const Ce=new s.T(R,{width:L,height:B,data:null},fe.RGBA8);ce.colorAttachment0.set(Ce.texture)}this._cascades.push({framebuffer:ce,texture:Re,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=E3(f);let V=0;if(a.elevation){const ie=a.elevation,pe=[1e4,-1e4];ie.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const ce=fe.dem.tree;pe[0]=Math.min(pe[0],ce.minimums[0]),pe[1]=Math.max(pe[1],ce.maximums[0])}),pe[0]!==1e4&&(V=(pe[1]-pe[0])*ie.exaggeration())}const j=1.5*a.cameraToCenterDistance,W=3*j,Y=new Float64Array(16);for(let ie=0;ie<this._cascades.length;++ie){const pe=this._cascades[ie];let fe=a.height/50,ce=1;ie===0?ce=j:(fe=j,ce=W);const[Re,Ce]=C3(a,this.shadowDirection,fe,ce,Nd,V);pe.scale=a.scale,pe.matrix=Re,pe.boundingSphereRadius=Ce,s.bl(Y,pe.matrix),pe.frustum=s.cB.fromInvProjectionMatrix(Y,1,0,!0),pe.far=ce}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Nd,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const J=g.transform.elevation;for(const ie of this._groundShadowTiles){let pe={min:0,max:0};if(J){const fe=J.getMinMaxForTile(ie);fe&&(pe=fe)}this.addShadowReceiver(ie.toUnwrapped(),pe.min,pe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,f){if(!this.enabled)return;const g=this.painter,b=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),b.viewport.set([0,0,Nd,Nd]);for(let E=0;E<this._numCascadesToRender;++E){g.currentShadowCascade=E,b.bindFramebuffer.set(this._cascades[E].framebuffer.framebuffer),b.clear({color:s.ao.white,depth:1});for(const C of a.order){const I=a._mergedLayers[C];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;const R=a.getLayerSourceCache(I),L=R?f[R.id]:void 0;(I.type==="model"||L&&L.length)&&g.renderLayer(g,R,I,L)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,f=a.style,g=a.context,b=g.gl,E=f.directionalLight,C=f.ambientLight;if(!E||!C)return;const I=[],R=jc(a,a.longestCutoffRange);R.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const L=Vc(f,E,C),B=new cn(b.LEQUAL,cn.ReadOnly,a.depthRangeFor3D),V=new Pn({func:b.EQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.KEEP);for(const j of this._groundShadowTiles){const W=j.toUnwrapped(),Y=a.isTileAffectedByFog(j),Z=a.getOrCreateProgram("groundShadow",{defines:I,overrideFog:Y});this.setupShadows(W,Z),a.uploadCommonUniforms(g,Z,W,null,R);const J=ya(a.transform.calculateProjMatrix(W),L);Z.draw(a,b.TRIANGLES,B,V,Nn.multiply,En.disabled,J,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,null,a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Nn.unblended:Nn.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(a){const f=this.painter.transform,g=f.calculatePosMatrix(a,f.worldSize);return s.aB(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(a){const f=s.bz(a);return s.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,a),f}setupShadows(a,f,g){if(!this.enabled)return;const b=this.painter.transform,E=this.painter.context,C=E.gl,I=this._uniformValues,R=new Float64Array(16),L=b.calculatePosMatrix(a,b.worldSize);for(let B=0;B<this._cascades.length;B++)s.aB(R,this._cascades[B].matrix,L),I[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),E.activeTexture.set(C.TEXTURE0+11+B),this._cascades[B].texture.bindExtraParam(C.LINEAR,C.LINEAR,C.CLAMP_TO_EDGE,C.CLAMP_TO_EDGE,C.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const B=s.d7(a.canonical),V=2/b.tileSize*s.al/Nd,j=V*this._cascades[0].boundingSphereRadius,W=V*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=(g==="vector-tile"?1:3)*function(Z){const J=s.aA((Z-22)/-22,0,1);return .125*(1-J)+4*J}(b.zoom);I.u_shadow_normal_offset=[B,j*Y,W*Y],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(E,I)}setupShadowsFromMatrix(a,f,g=!1){if(!this.enabled)return;const b=this.painter.context,E=b.gl,C=this._uniformValues,I=new Float64Array(16);for(let R=0;R<2;R++)s.aB(I,this._cascades[R].matrix,a),C[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),b.activeTexture.set(E.TEXTURE0+11+R),this._cascades[R].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);this.useNormalOffset=g,g?(C.u_shadow_normal_offset=[1,3,3],C.u_shadow_bias=[6e-5,.0012,.012]):C.u_shadow_bias=[36e-5,.0012,.012],f.setShadowUniformValues(b,C)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,f,g,b){if(b[2]>=0)return{};const E=function(R,L,B){const V=B/(1<<R.canonical.z);return new s.d9([R.canonical.x*V+R.wrap*B,R.canonical.y*V+R.wrap*B,0],[(R.canonical.x+1)*V+R.wrap*B,(R.canonical.y+1)*V+R.wrap*B,L])}(a,f,g).getCorners(),C=f/-b[2];b[0]<0?(s.d8(E[0],E[0],[b[0]*C,0,0]),s.d8(E[3],E[3],[b[0]*C,0,0])):b[0]>0&&(s.d8(E[1],E[1],[b[0]*C,0,0]),s.d8(E[2],E[2],[b[0]*C,0,0])),b[1]<0?(s.d8(E[0],E[0],[0,b[1]*C,0]),s.d8(E[1],E[1],[0,b[1]*C,0])):b[1]>0&&(s.d8(E[2],E[2],[0,b[1]*C,0]),s.d8(E[3],E[3],[0,b[1]*C,0]));const I={};return I.vertices=E,I.planes=[Xy(E[1],E[0],E[4]),Xy(E[2],E[1],E[5]),Xy(E[3],E[2],E[6]),Xy(E[0],E[3],E[7])],I}addShadowReceiver(a,f,g){this._receivers.add(a,s.d9.fromTileIdAndHeight(a,f,g))}getMaxCascadeForTile(a){const f=this._receivers.get(a);return f&&f.lastCascade?f.lastCascade:0}}function Xy(m,a,f){const g=s.av([],f,a),b=s.av([],m,a),E=s.bI([],g,b),C=s.ag(E);return C===0?[0,0,1,0]:(s.c5(E,E,1/C),[E[0],E[1],E[2],-s.bJ(E,a)])}function E3(m){const a=m.properties.get("direction"),f=s.d4(a.x,a.y,a.z);f[2]=s.aA(f[2],0,75);const g=s.d6([f[0],f[1],f[2]]);return s.d5(g.x,g.y,g.z)}function Vc(m,a,f){const g=a.properties.get("color-use-theme")==="none",b=a.properties.get("color"),E=a.properties.get("intensity"),C=a.properties.get("direction"),I=[C.x,C.y,C.z],R=f.properties.get("color-use-theme")==="none",L=f.properties.get("color"),B=f.properties.get("intensity"),V=Math.max(s.bJ([0,0,1],I),0),j=[0,0,0];s.c5(j,L.toPremultipliedRenderColor(R?null:m.getLut(a.scope)).toArray01Linear().slice(0,3),B);const W=[0,0,0];return s.c5(W,b.toPremultipliedRenderColor(g?null:m.getLut(f.scope)).toArray01Linear().slice(0,3),V*E),s.db([j[0]>0?j[0]/(j[0]+W[0]):0,j[1]>0?j[1]/(j[1]+W[1]):0,j[2]>0?j[2]/(j[2]+W[2]):0])}function C3(m,a,f,g,b,E){const C=m.zoom,I=m.scale,R=m.worldSize,L=1/R,B=m.aspect,V=Math.sqrt(1+B*B)*Math.tan(.5*m.fovX),j=V*V,W=g-f,Y=g+f;let Z,J;j>W/Y?(Z=g,J=g*V):(Z=.5*Y*(1+j),J=.5*Math.sqrt(W*W+2*(g*g+f*f)*j+Y*Y*j*j));const ie=m.projection.pixelsPerMeter(m.center.lat,R),pe=m._camera.getCameraToWorldMercator(),fe=[0,0,-Z*L];s.af(fe,fe,pe);let ce=J*L;const Re=function(St){return St[0]/=I,St[1]/=I,St[2]=s.cf(St[2],m._center.lat),St},Ce=m._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const St=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ie:1),Rt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,f,g);Rt[8]=2*-m.centerOffset.x/m.width,Rt[9]=2*m.centerOffset.y/m.height;const jt=new Float64Array(16);s.cP(jt,Rt,St);const Ot=new Float64Array(16);s.bl(Ot,jt);const Mt=s.cB.fromInvProjectionMatrix(Ot,R,C,!0);for(const rn of Mt.points){const tn=Re(rn);ce=Math.max(ce,s.c6(s.da([],fe,tn)))}}ce*=b/(b-1);const Se=Math.acos(a[2]),be=Math.atan2(-a[0],-a[1]),ye=new cp;ye.position=fe,ye.setPitchBearing(Se,be);const Ne=ye.getWorldToCamera(R,ie),We=ce*R,Ze=Math.min(m._mercatorZfromZoom(17)*R*-2,-2*We),tt=ye.getCameraToClipOrthographic(-We,We,-We,We,Ze,(We+E*ie)/a[2]),Je=new Float64Array(16);s.aB(Je,tt,Ne);const mt=s.d5(Math.floor(1e6*fe[0])/1e6*R,Math.floor(1e6*fe[1])/1e6*R,0),xt=.5*b,Xe=[0,0,0];s.af(Xe,mt,Je),s.c5(Xe,Xe,xt);const Me=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],dt=[0,0,0];s.av(dt,Xe,Me),s.c5(dt,dt,-1/xt);const nt=new Float64Array(16);return s.bA(nt),s.br(nt,nt,dt),s.aB(Je,nt,Je),[Je,We]}class Jy extends s.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(a,f){return s.dc(this.requestManager.transformRequest(f,s.R.Model).url).then(g=>{if(!g)return;const b=s.dd(g),E=new s.de(a,f,void 0,void 0,b);return E.computeBoundsAndApplyParent(),E}).catch(g=>{if(g&&g.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${a} from ${f}: ${g.message}`)))})}load(a,f,g={forceReload:!1}){this.models[f]||(this.models[f]={});const b=Object.keys(a),E=[],C=[];for(const I of b){const R=a[I];this.hasURLBeenRequested(R)&&!g.forceReload||(this.modelByURL[R]={modelId:I,scope:f},E.push(this.loadModel(I,R)),C.push(I)),this.models[f][I]||(this.models[f][I]={model:null,numReferences:1})}this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+C.length,Promise.allSettled(E).then(I=>{for(let R=0;R<I.length;R++){const{status:L}=I[R];if(L==="rejected")continue;const{value:B}=I[R];this.models[f][C[R]]||(this.models[f][C[R]]={model:null,numReferences:1}),this.models[f][C[R]].model=B}this.numModelsLoading[f]-=C.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,f,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(a,f):this.getModelByURL(this.modelUris[f][a]))}getModel(a,f){return this.models[f]||(this.models[f]={}),this.models[f][a]?this.models[f][a].model:void 0}getModelByURL(a){if(!a)return null;const f=this.modelByURL[a];return f?this.models[f.scope][f.modelId].model:null}hasModelBeenAdded(a,f){return this.models[f]&&this.models[f][a]!==void 0}getModelURIs(a){return this.modelUris[a]||{}}addModel(a,f,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const b=this.requestManager.normalizeModelURL(f);if((this.hasModel(a,g,{exactIdMatch:!0})||this.hasModelBeenAdded(a,g))&&this.modelUris[g][a]===b)this.models[g][a].numReferences++;else if(this.hasURLBeenRequested(b)){const{scope:E,modelId:C}=this.modelByURL[b];this.models[E][C].numReferences++}else this.modelUris[g][a]=b,this.load({[a]:this.modelUris[g][a]},g)}addModelURLs(a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const g=this.modelUris[f];for(const b in a)g[b]=this.requestManager.normalizeModelURL(a[b])}reloadModels(a){this.load(this.modelUris[a],a,{forceReload:!0})}addModelsFromBucket(a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const g={};for(const b of a)this.hasModel(b,f,{exactIdMatch:!0})||this.hasURLBeenRequested(b)?this.models[f][b].numReferences++:this.modelUris[f][b]&&!this.hasURLBeenRequested(b)?g[b]=this.modelUris[f][b]:!this.hasURLBeenRequested(b)&&s.df(b,!1)&&(this.modelUris[f][b]=this.requestManager.normalizeModelURL(b),g[b]=this.modelUris[f][b]);this.load(g,f)}hasURLBeenRequested(a){return this.modelByURL[a]!==void 0}removeModel(a,f,g=!1,b=!1){if(this.models[f]&&this.models[f][a]&&(this.models[f][a].numReferences--,this.models[f][a].numReferences===0||b)){const E=this.modelUris[f][a];g||delete this.modelUris[f][a],delete this.modelByURL[E];const C=this.models[f][a].model;if(!C)return;delete this.models[f][a],C.destroy()}}destroy(){for(const a of Object.keys(this.models))for(const f of Object.keys(this.models[a])){const g=this.models[a][f].model;delete this.models[a][f],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,f){this.models[f]||(this.models[f]={});for(const g in this.models[f])this.models[f][g].model&&this.models[f][g].model.upload(a.context)}}const bg=s.a6.colorTheme,Md=new s.a9({data:new s.aa(bg.data)});function NI(m){if(!m.metadata||!m.metadata.content_area)return;const a=s.o.devicePixelRatio,{left:f,top:g,width:b,height:E}=m.metadata.content_area,C=f*a,I=g*a;return[C,I,C+b*a,I+E*a]}function T3(m){if(m)return m.map(([a,f])=>[a*s.o.devicePixelRatio,f*s.o.devicePixelRatio])}class MI{constructor(a,f,g){this.id=a,this.scope=f,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(a){this.missingRequests.has(a.name)||this.pendingRequests.has(a.name)||this.pendingRequests.add(a.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const a=new Map;if(!this.sourceCache.loaded())return a;const f=this.sourceCache.getVisibleCoordinates();if(f.length===0)return a;const g=this.sourceCache.getSource();if(!(g instanceof Uo))return a;const b=f.map(C=>this.sourceCache.getTile(C)),E=g.getImages(b,Array.from(this.pendingRequests));for(const[C,I]of E)a.set(s.I.from({name:C,iconsetId:this.id}),I),this.pendingRequests.delete(C);for(const C of this.pendingRequests)this.missingRequests.add(C);return this.pendingRequests.clear(),a}}class ab{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(a){return this._map=a,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",f=>this._onIndoorUpdate(f)),this._container}_createButton(a,f){const g=U("button",a,this._container);return g.type="button",g.addEventListener("click",f),g}_createSeparator(){return U("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(a,f){this._map&&(a.setAttribute("aria-label",f),a.textContent=f)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(a){if(!a||!a.floors)return this._model=a,void(this._container.style.display="none");const f=this._model;this._model=a,this._container.style.display="inline-block",this._container.style.borderRadius="8px",f&&Array.from(this._container.children).forEach(g=>g.remove()),a.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(a.floors,a.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const a=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const f=this._map;this._model&&f&&f._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});U("span","mapboxgl-ctrl-icon",a).setAttribute("aria-hidden","true"),a.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&a.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(a),this._createSeparator()}_updateBuildingsButtonState(){const a=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");a&&this._model&&(this._model.activeFloorsVisible?a.classList.remove("mapboxgl-ctrl-level-button-selected"):a.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(a,f){for(let g=0;g<a.length;g++){const b=a[g],E=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(b.id)}),C=(b.name||"").trim(),I=b.zIndex.toString(),R=C?Array.from(C).slice(0,3).join(""):I;this._setButtonTitle(E,R),this._model&&b.id===this._model.selectedFloorId&&f&&E.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(E),g<a.length-1&&this._createSeparator()}}}class LI extends s.E{constructor(a){super(),this._style=a,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(a){a===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=a,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(a){this._activeFloorsVisible=a,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(a){for(const[f,g]of Object.entries(a.buildings))if(this._buildings[f])for(const b of g.floorIds)this._buildings[f].floors[b]||(this._buildings[f].floors[b]=g.floors[b]);else this._buildings[f]=g;for(const f of a.activeFloors)this._activeFloors.add(f);this._updateIndoorSelector()}getIndoorTileOptions(a,f){const g=this._style.getIndoorSourceLayers(a,f);return g&&this._indoorState?{sourceLayers:g,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new ab,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const a=this._style.map.transform,f=function(g,b,E,C){let I=null,R=Number.MAX_SAFE_INTEGER;if(C<16)return null;for(const[L,B]of Object.entries(g)){const V=B.center;if(V){const j=b.distanceTo(s.aT.convert(V));j<R&&E.contains(V)&&(R=j,I=L)}}return I}(this._buildings,a.center,a.getBounds(),a.zoom);f!==this._closestBuildingId&&(this._closestBuildingId=f,this._updateIndoorSelector())}_updateIndoorSelector(){const a=this._buildings,f=this._closestBuildingId,g=f&&a?a[f]:void 0;if(!g)return this._removeIndoorControl(),void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let b=null;for(const C of g.floorIds)if(this._activeFloors&&this._activeFloors.has(C)){b=C;break}const E=Array.from(g.floorIds).map(C=>({id:C,name:g.floors[C].name,zIndex:g.floors[C].zIndex})).sort((C,I)=>I.zIndex-C.zIndex).filter((C,I,R)=>I===0||C.zIndex!==R[I-1].zIndex);this.fire(new s.z("selector-update",{selectedFloorId:b,activeFloorsVisible:this._activeFloorsVisible,floors:E}))}_updateActiveFloors(){const a=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:a,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const Vu=(m,a)=>Ve(m,a&&a.filter(f=>f.identifier!=="source.canvas")),A3=s.aH(vi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),S3=s.aH(vi,["setCenter","setZoom","setBearing","setPitch"]),Qy=new Set(["background","sky","slot","custom"]),cb={version:8,layers:[],sources:{}},Ld={duration:300,delay:0};class Na extends s.E{constructor(a,f={}){super(),this.map=a,this.scope=f.scope||"",this.globalId=null,this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=Object.assign({},Ld),this._buildingIndex=new dg(this),this.crossTileSymbolIndex=new ps,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=f.styleChanges||new xr,this._hasDataDrivenEmissive=!1,this.indoorManager=new LI(this),this.dispatcher=f.dispatcher?f.dispatcher:new s.D(s.dh(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new Ra(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new s.di(a._requestManager,f.localFontFamily?s.dj.all:f.localIdeographFontFamily?s.dj.ideographs:s.dj.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new Jy(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._indoorDependentLayers=f.indoorDependentLayers?f.indoorDependentLayers:new Set,this._config=f.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:f.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=f.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const g=this;this._rtlTextPluginCallback=Na.registerForPluginStateChange(b=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,C)=>{if(s.dl(E),C&&C.every(I=>I))for(const I in g._sourceCaches){const R=g._sourceCaches[I],L=R.getSource().type;L!=="vector"&&L!=="geojson"||R.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const E=this.getOwnSource(b.sourceId);if(E&&E.vectorLayerIds)for(const C in this._layers){const I=this._layers[C];I.source===E.id&&this._validateLayer(I)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(s.h(a))return a;const f=s.dm(a);if(!f.startsWith("http"))try{return new URL(f,location.href).toString()}catch{return f}return f}return`json://${s.dn(JSON.stringify(a))}`}_diffStyle(a,f,g){this.globalId=this._getGlobalId(a);const b=(E,C)=>{try{C(null,this.setState(E,g))}catch(I){C(I,!1)}};if(typeof a=="string"){const E=this.map._requestManager.normalizeStyleURL(a),C=this.map._requestManager.transformRequest(E,s.R.Style);s.m(C,(I,R)=>{I?this.fire(new s.y(I)):R&&b(R,f)})}else typeof a=="object"&&b(a,f)}loadURL(a,f={}){this.fire(new s.z("dataloading",{dataType:"style"}));const g=typeof f.validate=="boolean"?f.validate:!s.h(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,f.accessToken),this.resolvedImports.add(a);const b=this.importsCache.get(a);if(b)return this._load(b,g);const E=this.map._requestManager.transformRequest(a,s.R.Style);this._request=s.m(E,(C,I)=>{if(this._request=null,C)this.fire(new s.y(C));else if(I)return this.importsCache.set(a,I),this._load(I,g)})}loadJSON(a,f={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=s.o.frame(()=>{this._request=null,this._load(a,f.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(cb,!1)}_loadImports(a,f,g){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const E of a){const C=this._createFragmentStyle(E),I=new Promise(B=>{C.once("style.import.load",B),C.once("error",B)}).then(()=>this.mergeAll());if(b.push(I),this.resolvedImports.has(E.url)){C.loadEmpty();continue}const R=E.data||this.importsCache.get(E.url);R?(C.loadJSON(R,{validate:f}),this._isInternalStyle(R)&&(C.globalId=null)):E.url?C.loadURL(E.url,{validate:f}):C.loadEmpty();const L={style:C,id:E.id,config:E.config};if(g){const B=this.fragments.findIndex(({id:V})=>V===g);this.fragments=this.fragments.slice(0,B).concat(L).concat(this.fragments.slice(B))}else this.fragments.push(L)}return Promise.allSettled(b)}getImportGlobalIds(a=this,f=new Set){for(const g of a.fragments)g.style.globalId&&f.add(g.style.globalId),this.getImportGlobalIds(g.style,f);return[...f.values()]}_createFragmentStyle(a){const f=this.scope?s.B(a.id,this.scope):a.id;let g;const b=this._initialConfig&&this._initialConfig[f];(a.config||b)&&(g=Object.assign({},a.config,b));const E=new Na(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:a["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return E.setEventedParent(this.map,{style:E}),E}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,f){if(this._isInternalStyle(a)){const E=Object.assign({},cb,{imports:[{id:"basemap",data:a,url:""}]},a.center?{center:a.center}:{},a.bearing?{bearing:a.bearing}:{},a.pitch?{pitch:a.pitch}:{},a.zoom?{zoom:a.zoom}:{},a.light?{light:a.light}:{});return this._importedAsBasemap=!0,void this._load(E,f)}if(this.updateConfig(this._config,a.schema),f&&Vu(this,Zi(a)))return;this._loaded=!0,this.stylesheet=s.dp(a);const g=()=>{for(const R in a.sources)this.addSource(R,a.sources[R],{validate:!1,isInitialLoad:!0});if(a.iconsets)for(const R in a.iconsets)this.addIconset(R,a.iconsets[R]);a.sprite?this._loadIconset(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&a.glyphs&&this.glyphManager.setURL(a.glyphs);const E=Jw(this.stylesheet.layers);if(this._order=E.map(R=>R.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new rt(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new rt(this.stylesheet.light)),this._layers={};for(const R of E){const L=s.du(R,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const B=this.getOwnLayerSourceCache(L),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&L.canCastShadows()&&V&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();a.imports?this._loadImports(a.imports,f).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(R=>{this.fire(new s.y(new Error("Failed to load imports",R))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const E=this._evaluateColorThemeData(b);this._loadColorTheme(E).then(()=>{g()}).catch(C=>{s.w(`Couldn't load color theme from the stylesheet: ${C}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(a=>a.style.hasAppearances())}mergeAll(){let a,f,g,b,E,C,I,R,L,B;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(a=j.light),j.stylesheet.lights)for(const W of j.stylesheet.lights)W.type==="ambient"&&j.ambientLight!=null&&(f=j.ambientLight),W.type==="directional"&&j.directionalLight!=null&&(g=j.directionalLight);b=this._prioritizeTerrain(b,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(E=j.fog),j.stylesheet.snow&&j.snow!=null&&(C=j.snow),j.stylesheet.rain&&j.rain!=null&&(I=j.rain),j.stylesheet.camera!=null&&(B=j.stylesheet.camera),j.stylesheet.projection!=null&&(R=j.stylesheet.projection),j.stylesheet.transition!=null&&(L=j.stylesheet.transition),V[j.scope]=j._styleColorTheme}}),this.light=a,this.ambientLight=f,this.directionalLight=g,this.fog=E,this.snow=C,this.rain=I,this._styleColorThemeForScope=V,b===null?delete this.terrain:this.terrain=b,this.camera=B||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},Ld,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(a){const f=g=>{for(const b of g.fragments)f(b.style);a(g)};f(this)}_prioritizeTerrain(a,f,g){const b=a&&a.drapeRenderMode===0;return g===null?f&&f.drapeRenderMode===0?f:b?a:null:f!=null&&(!a||b||f&&f.drapeRenderMode===1)?f:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{a=this._prioritizeTerrain(a,f.terrain,f.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(a=f.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},f={},g={};this.forEachFragmentStyle(b=>{for(const E in b._sourceCaches){const C=s.B(E,b.scope);a[C]=b._sourceCaches[E]}for(const E in b._otherSourceCaches){const C=s.B(E,b.scope);f[C]=b._otherSourceCaches[E]}for(const E in b._symbolSourceCaches){const C=s.B(E,b.scope);g[C]=b._symbolSourceCaches[E]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=g}mergeIndoor(){this.forEachFragmentStyle(a=>{if(a.stylesheet&&a.stylesheet.indoor)for(const f of Object.values(a.stylesheet.indoor)){const g=f,b=s.B(g.sourceId,a.scope);this._mergedIndoor[b]=new Set(g.sourceLayers||[])}})}mergeLayers(){const a={},f=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(C=>{for(const I of C._order){const R=C._layers[I];if(R.type==="slot"){const L=s.dq(I);if(a[L])continue;a[L]=[]}R.slot&&a[R.slot]?a[R.slot].push(R):f.push(R)}}),this._mergedOrder=[];let b=-1;const E=(C=[])=>{for(const I of C)if(I.type==="slot"){const R=s.dq(I.id);a[R]&&E(a[R]),this._mergedSlots.push(R)}else{const R=s.B(I.id,I.scope);this._mergedOrder.push(R),g[R]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,b=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(E(f),this._has3DLayers){const C={};for(let I=0;I<this._mergedOrder.length;++I){const R=this._mergedOrder[I];C[R]=I===b?1:I<b?g[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,R)=>C[I]-C[R])}this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(a){return a.data?function(f,g,b){const E=Object.assign({},g);for(const I of Object.keys(bg))E[I]===void 0&&(E[I]=bg[I].default);const C=new s.a8(Md,f,new Map(b));return C.setTransitionOrValue(E,b),C.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))}(this.scope,a,this.options).get("data"):null}_loadColorTheme(a){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const f=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,b)=>{const E="data:image/png;base64,";if(!a||a.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let C=a;C.startsWith(E)||(C=E+C);const I=s.I.from("mapbox-reserved-lut"),R=new Image;R.src=C,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==f)return void g();this._styleColorTheme.lutLoading=!1;const{width:L,height:B,data:V}=s.o.getImageData(R);if(B>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==B*B)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:L,height:B},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(I,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:a},g()):b(new Error("Missing LUT image."))}})}getLut(a){const f=this._styleColorThemeForScope[a];return f?f.lut:null}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(f,g,b){let E,C,I;const R=s.o.devicePixelRatio>1?"@2x":"";let L=s.m(g.transformRequest(g.normalizeSpriteURL(f,R,".json"),s.R.SpriteJSON),(j,W)=>{L=null,I||(I=j,E=W,V())}),B=s.n(g.transformRequest(g.normalizeSpriteURL(f,R,".png"),s.R.SpriteImage),(j,W)=>{B=null,I||(I=j,C=W,V())});function V(){if(I)b(I);else if(E&&C){const j=s.o.getImageData(C),W={};for(const Y in E){const{width:Z,height:J,x:ie,y:pe,sdf:fe,pixelRatio:ce,stretchX:Re,stretchY:Ce,content:Se}=E[Y],be=new s.q({width:Z,height:J});s.q.copy(j,be,{x:ie,y:pe},{x:0,y:0},{width:Z,height:J},null),W[Y]={data:be,pixelRatio:ce!==void 0?ce:1,sdf:fe!==void 0&&fe,stretchX:Re,stretchY:Ce,content:Se,usvg:!1,version:0}}b(null,W)}}return{cancel(){L&&(L.cancel(),L=null),B&&(B.cancel(),B=null)}}}(a,this.map._requestManager,(f,g)=>{if(this._spriteRequest=null,f)this.fire(new s.y(f));else if(g){const b=new Map;for(const E in g)b.set(s.I.from(E),g[E]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(a,f){if(f.type==="sprite")return void this._loadSprite(f.url);const g=this.getOwnSourceCache(f.source);if(!g)return void this.fire(new s.y(new Error(`Source "${f.source}" as specified by iconset "${a}" does not exist and cannot be used as an iconset source`)));const b=g.getSource();if(b.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${f.source}" as specified by iconset "${a}" is not a "raster-array" source and cannot be used as an iconset source`)));b.partial=!1;const E=new MI(a,this.scope,g);this.imageManager.addImageProvider(E,this.scope)}removeIconset(a){this.imageManager.removeImageProvider(a,this.scope)}_loadIconset(a){if(!s.h(a)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(a);const f=this.map._spriteFormat==="auto";var g,b;this._spriteRequest=(b=(E,C)=>{if(this._spriteRequest=null,E)f?this._loadSprite(a):this.fire(new s.y(E));else if(C){const I=new Map;for(const R in C)I.set(s.I.from(R),C[R]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(a),s.R.Iconset),(E,C)=>{if(E)return void b(E);const I={},R=s.dg(new s.bt(C));for(const L of R.icons){const B={version:1,pixelRatio:s.o.devicePixelRatio,content:NI(L),stretchX:L.metadata?T3(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?T3(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};I[L.name]=B}b(null,I)}))}_validateLayer(a){const f=this.getOwnSource(a.source);if(!f)return;const g=a.sourceLayer;g&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(g)===-1)&&this.fire(new s.y(new Error(`Source layer "${g}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,f)=>{const g=this.fragments[f];return g&&g.style&&(a.data=g.style.serialize()),a})}_serializeSources(){const a={};for(const f in this._sourceCaches){const g=this._sourceCaches[f].getSource();a[g.id]||(a[g.id]=g.serialize())}return a}_serializeLayers(a){const f=[];for(const g of a){const b=this._layers[g];b&&b.type!=="custom"&&f.push(b.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const a in this._mergedLayers){const f=this._mergedLayers[a];if(f._transitionablePaint&&f._transitionablePaint._values){const g=f._transitionablePaint._values["line-emissive-strength"];if(g&&g.value&&g.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(a){return a?this.order:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const f=this.getOwnLayer(a);if(f)return f;this.fire(new s.y(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const f=this.getOwnSource(a);if(f)return f;this.fire(new s.y(new Error(`The source '${a}' does not exist in the map's style.`)))}precompilePrograms(a,f){const g=this.map.painter;if(g)for(let b=a.minzoom||0;b<(a.maxzoom||25.5);b++){const E=a.getProgramIds();if(E)for(const C of E){const I=a.getDefaultProgramParams(C,f.zoom,this._styleColorTheme.lut);I&&(g.style=this,this.fog&&(g._fogVisible=!0,I.overrideFog=!0,g.getOrCreateProgram(C,I)),g._fogVisible=!1,I.overrideFog=!1,g.getOrCreateProgram(C,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,g.getOrCreateProgram(C,I)))}}}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const f=this.calculateLightsBrightness();a.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f)),a.worldview!==this._worldview&&(this._worldview=a.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const R in I){const{updatedIds:L,removedIds:B}=I[R];(L||B)&&(this._updateWorkerLayers(R,L,B),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this.snow&&this.snow.updateTransitions(a),this.rain&&this.rain.updateTransitions(a),this._changes.reset()}const E={};for(const I in this._mergedSourceCaches){const R=this._mergedSourceCaches[I];E[I]=R.used,R.used=!1,R.tileCoverLift=0}for(const I of this._mergedOrder){const R=this._mergedLayers[I];if(R.visibility!=="none"&&R.recalculate(a,this._availableImages),!R.isHidden(a.zoom)){const L=this.getLayerSourceCache(R);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,a)}):this.precompilePrograms(R,a))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();const C=this.imageManager.getPendingImageProviders();for(const I of C)I.sourceCache.used=!0;for(const I in E){const R=this._mergedSourceCaches[I];E[I]!==R.used&&R.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.snow&&this.snow.recalculate(a),this.rain&&this.rain.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const a=this.imageManager.getPendingImageProviders();for(const f of a){const g=f.resolvePendingRequests(),b=this.getFragmentStyle(f.scope);b&&b.addImages(g)}}_updateTilesForChangedImages(){const a={};for(const f in this._mergedSourceCaches){const g=this._mergedSourceCaches[f].getSource().scope;a[g]=a[g]||this._changes.getUpdatedImages(g),a[g].length!==0&&this._mergedSourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a[g])}for(const f in a)this._changes.resetUpdatedImages(f)}_updateWorkerLayers(a,f,g){const b=this.getFragmentStyle(a);b&&this.dispatcher.broadcast("updateLayers",{layers:f?b._serializeLayers(f):[],scope:a,removedIds:g||[],options:b.options})}setState(a,f){if(this._checkLoaded(),Vu(this,Zi(a)))return!1;(a=s.dp(a)).layers=Jw(a.layers);const g=function(C,I){if(!C)return[{command:vi.setStyle,args:[I]}];let R=[];try{if(!s.by(C.version,I.version))return[{command:vi.setStyle,args:[I]}];if(s.by(C.center,I.center)||R.push({command:vi.setCenter,args:[I.center]}),s.by(C.zoom,I.zoom)||R.push({command:vi.setZoom,args:[I.zoom]}),s.by(C.bearing,I.bearing)||R.push({command:vi.setBearing,args:[I.bearing]}),s.by(C.pitch,I.pitch)||R.push({command:vi.setPitch,args:[I.pitch]}),s.by(C.sprite,I.sprite)||R.push({command:vi.setSprite,args:[I.sprite]}),s.by(C.glyphs,I.glyphs)||R.push({command:vi.setGlyphs,args:[I.glyphs]}),s.by(C.imports,I.imports)||function(W=[],Y=[],Z){Y=Y||[];const J=(W=W||[]).map(Od),ie=Y.map(Od),pe=W.reduce(fg,{}),fe=Y.reduce(fg,{}),ce=J.slice();let Re,Ce,Se,be;for(Re=0,Ce=0;Re<J.length;Re++)Se=J[Re],fe.hasOwnProperty(Se)?Ce++:(Z.push({command:vi.removeImport,args:[Se]}),ce.splice(ce.indexOf(Se,Ce),1));for(Re=0,Ce=0;Re<ie.length;Re++)Se=ie[ie.length-1-Re],ce[ce.length-1-Re]!==Se&&(pe.hasOwnProperty(Se)?(Z.push({command:vi.removeImport,args:[Se]}),ce.splice(ce.lastIndexOf(Se,ce.length-Ce),1)):Ce++,be=ce[ce.length-Re],Z.push({command:vi.addImport,args:[fe[Se],be]}),ce.splice(ce.length-Re,0,Se));for(const ye of Y){const Ne=pe[ye.id];Ne&&(delete Ne.data,s.by(Ne,ye)||Z.push({command:vi.updateImport,args:[ye.id,ye]}))}}(C.imports,I.imports,R),s.by(C.transition,I.transition)||R.push({command:vi.setTransition,args:[I.transition]}),s.by(C.light,I.light)||R.push({command:vi.setLight,args:[I.light]}),s.by(C.fog,I.fog)||R.push({command:vi.setFog,args:[I.fog]}),s.by(C.snow,I.snow)||R.push({command:vi.setSnow,args:[I.snow]}),s.by(C.rain,I.rain)||R.push({command:vi.setRain,args:[I.rain]}),s.by(C.projection,I.projection)||R.push({command:vi.setProjection,args:[I.projection]}),s.by(C.lights,I.lights)||R.push({command:vi.setLights,args:[I.lights]}),s.by(C.camera,I.camera)||R.push({command:vi.setCamera,args:[I.camera]}),s.by(C.iconsets,I.iconsets)||function(W,Y,Z){let J;for(J in Y=Y||{},W=W||{})W.hasOwnProperty(J)&&(Y.hasOwnProperty(J)||Z.push({command:vi.removeIconset,args:[J]}));for(J in Y){if(!Y.hasOwnProperty(J))continue;const ie=Y[J];W.hasOwnProperty(J)?s.by(W[J],ie)||(Z.push({command:vi.removeIconset,args:[J]}),Z.push({command:vi.addIconset,args:[J,ie]})):Z.push({command:vi.addIconset,args:[J,ie]})}}(C.iconsets,I.iconsets,R),!s.by(C["color-theme"],I["color-theme"]))return[{command:vi.setStyle,args:[I]}];const L={},B=[];(function(W,Y,Z,J){let ie;for(ie in Y=Y||{},W=W||{})W.hasOwnProperty(ie)&&(Y.hasOwnProperty(ie)||jy(ie,Z,J));for(ie in Y){if(!Y.hasOwnProperty(ie))continue;const pe=Y[ie];W.hasOwnProperty(ie)?s.by(W[ie],pe)||(W[ie].type==="geojson"&&pe.type==="geojson"&&y3(W,Y,ie)?Z.push({command:vi.setGeoJSONSourceData,args:[ie,pe.data]}):g3(ie,Y,Z,J)):ip(ie,Y,Z)}})(C.sources,I.sources,B,L);const V=[];C.layers&&C.layers.forEach(W=>{W.source&&L[W.source]?R.push({command:vi.removeLayer,args:[W.id]}):V.push(W)});let j=C.terrain;j&&L[j.source]&&(R.push({command:vi.setTerrain,args:[void 0]}),j=void 0),R=R.concat(B),s.by(j,I.terrain)||R.push({command:vi.setTerrain,args:[I.terrain]}),function(W,Y,Z){Y=Y||[];const J=(W=W||[]).map(Od),ie=Y.map(Od),pe=W.reduce(fg,{}),fe=Y.reduce(fg,{}),ce=J.slice(),Re=Object.create(null);let Ce,Se,be,ye,Ne,We,Ze;for(Ce=0,Se=0;Ce<J.length;Ce++)be=J[Ce],fe.hasOwnProperty(be)?Se++:(Z.push({command:vi.removeLayer,args:[be]}),ce.splice(ce.indexOf(be,Se),1));for(Ce=0,Se=0;Ce<ie.length;Ce++)be=ie[ie.length-1-Ce],ce[ce.length-1-Ce]!==be&&(pe.hasOwnProperty(be)?(Z.push({command:vi.removeLayer,args:[be]}),ce.splice(ce.lastIndexOf(be,ce.length-Se),1)):Se++,We=ce[ce.length-Ce],Z.push({command:vi.addLayer,args:[fe[be],We]}),ce.splice(ce.length-Ce,0,be),Re[be]=!0);for(Ce=0;Ce<ie.length;Ce++)if(be=ie[Ce],ye=pe[be],Ne=fe[be],!Re[be]&&!s.by(ye,Ne))if(s.by(ye.source,Ne.source)&&s.by(ye["source-layer"],Ne["source-layer"])&&s.by(ye.type,Ne.type)){for(Ze in hg(ye.layout,Ne.layout,Z,be,null,vi.setLayoutProperty),hg(ye.paint,Ne.paint,Z,be,null,vi.setPaintProperty),s.by(ye.slot,Ne.slot)||Z.push({command:vi.setSlot,args:[be,Ne.slot]}),s.by(ye.filter,Ne.filter)||Z.push({command:vi.setFilter,args:[be,Ne.filter]}),s.by(ye.minzoom,Ne.minzoom)&&s.by(ye.maxzoom,Ne.maxzoom)||Z.push({command:vi.setLayerZoomRange,args:[be,Ne.minzoom,Ne.maxzoom]}),ye)ye.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&Ze!=="slot"&&(Ze.indexOf("paint.")===0?hg(ye[Ze],Ne[Ze],Z,be,Ze.slice(6),vi.setPaintProperty):s.by(ye[Ze],Ne[Ze])||Z.push({command:vi.setLayerProperty,args:[be,Ze,Ne[Ze]]}));for(Ze in Ne)Ne.hasOwnProperty(Ze)&&!ye.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&Ze!=="slot"&&(Ze.indexOf("paint.")===0?hg(ye[Ze],Ne[Ze],Z,be,Ze.slice(6),vi.setPaintProperty):s.by(ye[Ze],Ne[Ze])||Z.push({command:vi.setLayerProperty,args:[be,Ze,Ne[Ze]]}))}else Z.push({command:vi.removeLayer,args:[be]}),We=ce[ce.lastIndexOf(be)+1],Z.push({command:vi.addLayer,args:[Ne,We]})}(V,I.layers,R)}catch(L){console.warn("Unable to compute style diff:",L),R=[{command:vi.setStyle,args:[I]}]}return R}(this.serialize(),a).filter(C=>!(C.command in S3));if(g.length===0)return!1;const b=g.filter(C=>!(C.command in A3));if(b.length>0)throw new Error(`Unimplemented: ${b.map(C=>C.command).join(", ")}.`);const E=[];return g.forEach(C=>{E.push(this[C.command](...C.args))}),f&&Promise.all(E).then(f).catch(f),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(a){if(a.size===0)return this;for(const[f,g]of a.entries()){if(this.getImage(f))return this.fire(new s.y(new Error(`An image with the name "${f.name}" already exists.`)));this.imageManager.addImage(f,this.scope,g),this._changes.updateImage(f,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(a,f){return this.getImage(a)?this.fire(new s.y(new Error(`An image with the name "${a.name}" already exists.`))):(this.imageManager.addImage(a,this.scope,f),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(a,f,g=!1){this.imageManager.updateImage(a,this.scope,f),g&&(this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._changes.updateImage(a,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(a){return this.modelManager.addModelURLs(a,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(a,f,g={}){return this._checkLoaded(),this._validate($e,`models.${a}`,f,null,g)||(this.modelManager.addModel(a,f,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(a){return this.modelManager.hasModel(a,this.getActualScope())}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(a,f,g={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(ua,`sources.${a}`,f,null,g))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=$h(a,f,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const E=C=>{const I=(C?"symbol:":"other:")+b.id,R=s.B(I,this.scope),L=this._sourceCaches[I]=new ha(R,b,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=L,L.onAdd(this.map)};E(!1),f.type!=="vector"&&f.type!=="geojson"||E(!0),b.onAdd&&b.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const f=this.getOwnSource(a);if(!f)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===a)return this.fire(new s.y(new Error(`Source "${a}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new s.y(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const b=Object.entries(this.stylesheet.iconsets).find(([E,C])=>C.type==="source"&&C.source===a);if(b)return this.fire(new s.y(new Error(`Source "${a}" cannot be removed while iconset "${b[0]}" is using it.`)))}const g=this.getOwnSourceCaches(a);for(const b of g){const E=s.dq(b.id);delete this._sourceCaches[E],this._changes.discardSourceCacheUpdate(b.id),b.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getOwnSource(a).setData(f),this._changes.setDirty()}getOwnSource(a){const f=this.getOwnSourceCache(a);return f&&f.getSource()}getOwnSources(){const a=[];for(const f in this._otherSourceCaches){const g=this.getOwnSourceCache(f);g&&a.push(g.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const f in a){const g=a[f]._tiles;for(const b in g){const E=g[b];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const E of a){if(this._validate(Tt,"lights",E))return;switch(E.type){case"ambient":if(this.ambientLight){const C=this.ambientLight;C.set(E),C.updateTransitions(f)}else this.ambientLight=new fi(E,mr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const C=this.directionalLight;C.set(E),C.updateTransitions(f)}else this.directionalLight=new fi(E,Hi(),this.scope,this.options)}}const g=Object.assign(f,{worldview:this.map.getWorldview()}),b=new s.ac(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(b),this.directionalLight&&this.directionalLight.recalculate(b),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,f=this.ambientLight;if(!a||!f)return;const g=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),b=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),E=a.properties.get("intensity"),C=a.properties.get("direction"),I=1-s.d4(C.x,C.y,C.z)[2]/90,R=g(b)*E*I,L=f.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),B=f.properties.get("intensity"),V=g(L)*B;return Number(((R+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(a==null||a===""&&this.isRootStyle())return this;if(s.dr(a)){const f=s.ds(a),g=this.fragments.find(({id:E})=>E===f);if(!g)return;const b=s.dq(a);return g.style.getFragmentStyle(b)}{const f=this.fragments.find(({id:g})=>g===a);return f?f.style:void 0}}setFeaturesetSelectors(a){if(!a)return;const f={},g=(b,E="")=>`${b}::${E}`;this._featuresetSelectors={};for(const b in a){const E=this._featuresetSelectors[b]=[];for(const C of a[b].selectors){if(C.featureNamespace){const R=this.getOwnLayer(C.layer);if(!R){s.w(`Layer is undefined for selector: ${C.layer}`);continue}const L=g(R.source,R.sourceLayer);if(L in f&&f[L]!==C.featureNamespace){s.w(`"featureNamespace ${C.featureNamespace} of featureset ${b}'s selector is not associated to the same source, skip this selector`);continue}f[L]=C.featureNamespace}let I;if(C.properties)for(const R in C.properties){const L=s.U(C.properties[R]);L.result==="success"&&(I=I||{},I[R]=L.value)}E.push({layerId:C.layer,namespace:C.featureNamespace,properties:I,uniqueFeatureID:C._uniqueFeatureID})}}}getFeaturesetDescriptors(a){const f=this.getFragmentStyle(a);if(!f||!f.stylesheet.featuresets)return[];const g=[];for(const b in f.stylesheet.featuresets)g.push({featuresetId:b,importId:f.scope?f.scope:void 0});return g}getFeaturesetLayers(a,f){const g=this.getFragmentStyle(f),b=g.stylesheet.featuresets;if(!b||!b[a])return this.fire(new s.y(new Error(`The featureset '${a}' does not exist in the map's style and cannot be queried.`))),[];const E=[];for(const C of b[a].selectors){const I=g.getOwnLayer(C.layer);I&&E.push(I)}return E}getConfigProperty(a,f){const g=this.getFragmentStyle(a);if(!g)return null;const b=s.B(f,g.scope),E=g.options.get(b),C=E?E.value||E.default:null;return C?C.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(a,f){const g=s.B(a,f);return this._mergedIndoor[g]}setIndoorData(a,f){this.indoorManager.setIndoorData(f)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(a,f,g){const b=this.getFragmentStyle(a);if(!b)return;const E=b.stylesheet.schema;if(!E||!E[f])return;const C=s.U(g);if(C.result!=="success")return void Vu(this,C.value);const I=C.value.expression,R=s.B(f,b.scope),L=b.options.get(R);if(!L)return;let B;const{minValue:V,maxValue:j,stepValue:W,type:Y,values:Z}=E[f],J=s.U(E[f].default);J.result==="success"&&(B=J.value.expression),B?(this.options.set(R,Object.assign({},L,{value:I,default:B,minValue:V,maxValue:j,stepValue:W,type:Y,values:Z})),this.updateConfigDependencies(f)):this.fire(new s.y(new Error(`No schema defined for the config option "${f}" in the "${a}" fragment.`)))}getConfig(a){const f=this.getFragmentStyle(a);if(!f)return null;const g=f.stylesheet.schema;if(!g)return null;const b={};for(const E in g){const C=s.B(E,f.scope),I=f.options.get(C),R=I?I.value||I.default:null;b[E]=R?R.serialize():null}return b}setConfig(a,f){const g=this.getFragmentStyle(a);g&&(g.updateConfig(f,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const f=this.getFragmentStyle(a);return f?f.stylesheet.schema:null}setSchema(a,f){const g=this.getFragmentStyle(a);g&&(g.stylesheet.schema=f,g.updateConfig(g._config,f),this.updateConfigDependencies())}updateConfig(a,f){if(this._config=a,a||f)if(f)for(const g in f){let b,E;const C=s.U(f[g].default);if(C.result==="success"&&(b=C.value.expression),a&&a[g]!==void 0){const j=s.U(a[g]);j.result==="success"&&(E=j.value.expression)}const{minValue:I,maxValue:R,stepValue:L,type:B,values:V}=f[g];if(b){const j=s.B(g,this.scope);this.options.set(j,{default:b,value:E,minValue:I,maxValue:R,stepValue:L,type:B,values:V})}else this.fire(new s.y(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(a,f=()=>!0){for(const g of a){const b=this.getLayer(g);b&&f(b)&&(b.possiblyEvaluateVisibility(),this._updateLayer(b),this._changes.setDirty())}}updateConfigDependencies(a){this._updateLayers(this._configDependentLayers,f=>!a||f.expressionDependencies.configDependencies.has(a)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(f=>{const g=f._styleColorTheme.colorThemeOverride?f._styleColorTheme.colorThemeOverride:f._styleColorTheme.colorTheme;if(g){const b=f._evaluateColorThemeData(g);(!f._styleColorTheme.lut&&b!==""||f._styleColorTheme.lut&&b!==f._styleColorTheme.lut.data)&&f.setColorTheme(g)}}),this._changes.setDirty()}addLayer(a,f,g={}){this._checkLoaded();const b=a.id;if(this._layers[b])return void this.fire(new s.y(new Error(`Layer with id "${b}" already exists on this map`)));let E;if(a.type==="custom"){if(Vu(this,s.dt(a)))return;E=s.du(a,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof a.source=="object"&&(this.addSource(b,a.source),a=s.dp(a),a=Object.assign(a,{source:b})),this._validate(qe,`layers.${b}`,a,{arrayIndex:-1},g))return;E=s.du(a,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}})}const C=s.B(E.source,E.scope);E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(C),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(C);let I=this._order.length;if(f){const V=this._order.indexOf(f);if(V===-1)return void this.fire(new s.y(new Error(`Layer with id "${f}" does not exist on this map.`)));E.slot&&E.slot!==this._layers[f].slot?s.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`):I=V}this._order.splice(I,0,b),this._handleLayerOrderChange(),this._layers[b]=E;const R=this.getOwnLayerSourceCache(E),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&E.canCastShadows()&&L&&(R.castsShadows=!0);const B=this._changes.getRemovedLayer(E);if(B&&E.source&&R&&E.type!=="custom"){this._changes.discardLayerRemoval(E);const V=s.B(E.source,E.scope);B.type!==E.type?this._changes.updateSourceCache(V,"clear"):(this._changes.updateSourceCache(V,"reload"),R.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),E.scope=this.scope,this.mergeLayers()}moveLayer(a,f){this._checkLoaded();const g=this._checkLayer(a);if(!g||a===f)return;const b=this._order.indexOf(a);this._order.splice(b,1);let E=this._order.length;if(f){const C=this._order.indexOf(f);if(C===-1)return void this.fire(new s.y(new Error(`Layer with id "${f}" does not exist on this map.`)));g.slot&&g.slot!==this._layers[f].slot?s.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`):E=C}this._order.splice(E,0,a),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(a){this._checkLoaded();const f=this._checkLayer(a);if(!f)return;f.setEventedParent(null);const g=this._order.indexOf(a);this._order.splice(g,1),delete this._layers[a],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(f.fqid),this._indoorDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const b=this.getOwnLayerSourceCache(f);if(b&&b.castsShadows){let E=!1;for(const C in this._layers)if(this._layers[C].source===f.source&&this._layers[C].canCastShadows()){E=!0;break}b.castsShadows=E}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,g){this._checkLoaded();const b=this._checkLayer(a);b&&(b.minzoom===f&&b.maxzoom===g||(f!=null&&(b.minzoom=f),g!=null&&(b.maxzoom=g),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(a,f){this._checkLoaded();const g=this._checkLayer(a);g&&g.slot!==f&&(g.slot=f,this._updateLayer(g))}setFilter(a,f,g={}){this._checkLoaded();const b=this._checkLayer(a);if(b&&!s.by(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(ee,`layers.${b.id}.filter`,f,{layerType:b.type},g)||(b.filter=s.dp(f),this._updateLayer(b)))}getFilter(a){const f=this._checkLayer(a);if(f)return s.dp(f.filter)}setLayoutProperty(a,f,g,b={}){this._checkLoaded();const E=this._checkLayer(a);if(E&&!s.by(E.getLayoutProperty(f),g)){if(g!=null&&(!b||b.validate!==!1)&&Vu(E,_e.call(Zi,{key:`layers.${a}.layout.${f}`,layerType:E.type,objectKey:f,value:g,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;E.setLayoutProperty(f,g),E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E.fqid),this._updateLayer(E)}}setLayerProperty(a,f,g,b={}){this._checkLoaded();const E=this._checkLayer(a);E&&(f==="appearances"?(E.setAppearances(g),this._changes.setDirty()):E.isPaintProperty(f)?this.setPaintProperty(a,f,g,b):this.setLayoutProperty(a,f,g,b))}getLayoutProperty(a,f){const g=this._checkLayer(a);if(g)return g.getLayoutProperty(f)}setPaintProperty(a,f,g,b={}){this._checkLoaded();const E=this._checkLayer(a);if(!E||s.by(E.getPaintProperty(f),g)||g!=null&&(!b||b.validate!==!1)&&Vu(E,ae.call(Zi,{key:`layers.${a}.paint.${f}`,layerType:E.type,objectKey:f,value:g,styleSpec:s.a6})))return;const C=E.setPaintProperty(f,g);E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E.fqid),C&&this._updateLayer(E),this._changes.updatePaintProperties(E)}getPaintProperty(a,f){const g=this._checkLayer(a);if(g)return g.getPaintProperty(f)}setFeatureState(a,f){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:R,importId:L}=a.target,B=this.getFragmentStyle(L),V=B.getFeaturesetLayers(R);for(const{source:j,sourceLayer:W}of V)B.setFeatureState({id:a.id,source:j,sourceLayer:W},f)}else if("layerId"in a.target){const{layerId:R}=a.target,L=this.getLayer(R);this.setFeatureState({id:a.id,source:L.source,sourceLayer:L.sourceLayer},f)}return}const g=a.source,b=a.sourceLayer,E=this._checkSource(g);if(!E)return;const C=E.type;if(C==="geojson"&&b)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!b)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(g);for(const R of I)R.setFeatureState(b,a.id,f)}removeFeatureState(a,f){if(this._checkLoaded(),"target"in a){if("featuresetId"in a.target){const{featuresetId:R,importId:L}=a.target,B=this.getFragmentStyle(L),V=B.getFeaturesetLayers(R);for(const{source:j,sourceLayer:W}of V)B.removeFeatureState({id:a.id,source:j,sourceLayer:W},f)}else if("layerId"in a.target){const{layerId:R}=a.target,L=this.getLayer(R);this.removeFeatureState({id:a.id,source:L.source,sourceLayer:L.sourceLayer},f)}return}const g=a.source,b=this._checkSource(g);if(!b)return;const E=b.type,C=E==="vector"?a.sourceLayer:void 0;if(E==="vector"&&!C)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(g);for(const R of I)R.removeFeatureState(C,a.id,f)}getFeatureState(a){if(this._checkLoaded(),"target"in a){let E;if("featuresetId"in a.target){const{featuresetId:C,importId:I}=a.target,R=this.getFragmentStyle(I),L=R.getFeaturesetLayers(C);for(const{source:B,sourceLayer:V}of L){const j=R.getFeatureState({id:a.id,source:B,sourceLayer:V});if(j&&!E)E=j;else if(!s.by(E,j))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in a.target){const{layerId:C}=a.target,I=this.getLayer(C);E=this.getFeatureState({id:a.id,source:I.source,sourceLayer:I.sourceLayer})}return E}const f=a.source,g=a.sourceLayer,b=this._checkSource(f);if(b){if(b.type!=="vector"||g)return a.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(g,a.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),f=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(a){for(const f of Object.values(this._mergedLayers))a(f)&&this._updateLayer(f)}_updateLayer(a){this._changes.updateLayer(a);const f=this.getLayerSourceCache(a),g=s.B(a.source,a.scope),b=this._changes.getUpdatedSourceCaches();a.source&&!b[g]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),f.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=I=>this._mergedLayers[I].is3D(!!this.terrain),g=this.order,b={},E=[];for(let I=g.length-1;I>=0;I--){const R=g[I];if(f(R)){b[R]=I;for(const L of a){const B=L[R];if(B)for(const V of B)E.push(V)}}}E.sort((I,R)=>R.intersectionZ-I.intersectionZ);const C=[];for(let I=g.length-1;I>=0;I--){const R=g[I];if(f(R))for(let L=E.length-1;L>=0;L--){const B=E[L].feature;if(B.layer&&b[B.layer.id]<I)break;C.push(B),E.pop()}else for(const L of a){const B=L[R];if(B)for(const V of B)C.push(V.feature)}}return C}queryRasterValue(a,f,g){const b=this.getOwnSource(a);return b?b.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):b.queryRasterArrayValue(f,g):(this.fire(new s.y(new Error(`Source with id "${a}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(a,f,g){let b;f&&!Array.isArray(f)&&f.filter&&(this._validate(ee,"queryRenderedFeatures.filter",f.filter,null,f),b=s.b6(f.filter));const E={},C=B=>{if(Qy.has(B.type))return;const V=this.getOwnLayerSourceCache(B),j=E[V.id]=E[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};B.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[B.fqid]=j.layers[B.fqid]||{styleLayer:B,targets:[]},j.layers[B.fqid].targets.push({filter:b})};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const B of f.layers){const V=this._layers[B];if(!V)return this.fire(new s.y(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];C(V)}}else for(const B in this._layers)C(this._layers[B]);const I=this._queryRenderedFeatures(a,E,g),R=this._flattenAndSortRenderedFeatures(I),L=[];for(const B of R)s.dw(B.layer.id)===this.scope&&L.push(B);return L}queryRenderedFeatureset(a,f,g){let b;f&&!Array.isArray(f)&&f.filter&&(this._validate(ee,"queryRenderedFeatures.filter",f.filter,null,f),b=s.b6(f.filter));const E="mock",C=[];if(f&&f.target)C.push(Object.assign({},f,{targetId:E,filter:b}));else{const B=this.getFeaturesetDescriptors();for(const V of B)C.push({targetId:E,filter:b,target:V});for(const{style:V}of this.fragments){const j=V.getFeaturesetDescriptors();for(const W of j)C.push({targetId:E,filter:b,target:W})}}const I=this.queryRenderedTargets(a,C,g),R=[],L=new Set;for(const B of I)for(const V of B.variants[E])ag(V,B,L)||R.push(new s.dx(B,V));return R}queryRenderedTargets(a,f,g){const b={},E=(I,R,L,B)=>{const V=b[R.id]=b[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(V.layers[I.fqid]=V.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(V.has3DLayers=!0),!B)return L.uniqueFeatureID=!1,void V.layers[I.fqid].targets.push(L);V.layers[I.fqid].targets.push(Object.assign({},L,{namespace:B.namespace,properties:B.properties,uniqueFeatureID:B.uniqueFeatureID}))};for(const I of f)if("featuresetId"in I.target){const{featuresetId:R,importId:L}=I.target,B=this.getFragmentStyle(L);if(!B||!B._featuresetSelectors)continue;const V=B._featuresetSelectors[R];if(!V){this.fire(new s.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of V){const W=B.getOwnLayer(j.layerId);W&&!Qy.has(W.type)&&E(W,B.getOwnLayerSourceCache(W),I,j)}}else if("layerId"in I.target){const{layerId:R}=I.target,L=this.getLayer(R);if(!L||Qy.has(L.type))continue;E(L,this.getLayerSourceCache(L),I)}const C=this._queryRenderedFeatures(a,b,g);return this._flattenAndSortRenderedFeatures(C)}_queryRenderedFeatures(a,f,g){const b=[],E=!!this.map._showQueryGeometry,C=Pr.createFromScreenPoints(a,g);for(const I in f){const R=cg(C,f[I],this._availableImages,g,E,this.getActualScope());Object.keys(R).length&&b.push(R)}if(this.placement)for(const I in f){if(!f[I].sourceCache._onlySymbols)continue;const R=h3(C.screenGeometry,f[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&b.push(R)}return b}querySourceFeatures(a,f){const g=f&&f.filter;g&&this._validate(ee,"querySourceFeatures.filter",g,null,f);let b=[];const E=this.getOwnSourceCaches(a);for(const C of E)b=b.concat(f3(C,f));return b}addSourceType(a,f,g){return Na.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(Na.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,f,g={}){this._checkLoaded();const b=this.light.getLight();let E=!1;for(const I in a)if(!s.by(a[I],b[I])){E=!0;break}if(!E)return;const C=this._getTransitionParameters();this.light.setLight(a,f,g),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(a,f=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),f===0&&delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=a;const b=!("source"in a)||a.source==null;if(f===1){if(this.disableElevatedTerrain)return;if("source"in g&&typeof g.source=="object"){const I="terrain-dem-src";this.addSource(I,g.source),g=s.dp(g),g=Object.assign(g,{source:I})}const E=Object.assign({},g),C={};if(this.terrain&&b){E.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(C.style=I.serialize())}if(this._validate(bo,"terrain",E,C))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&f!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,f),this.fire(new s.z("data",{dataType:"style"}))}else{const E=this.terrain,C=E.get();for(const I of Object.keys(s.a6.terrain))!g.hasOwnProperty(I)&&s.a6.terrain[I].default&&(g[I]=s.a6.terrain[I].default);for(const I in a)if(!s.by(a[I],C[I])){E.set(a,this.options),this.stylesheet.terrain=a;const R=this._getTransitionParameters({duration:0});E.updateTransitions(R),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new In(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=f.get();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_createSnow(a){const f=this.snow=new Mr(a,this.map.transform,this.scope,this.options);this.stylesheet.snow=f.get();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_createRain(a){const f=this.rain=new dr(a,this.map.transform,this.scope,this.options);this.stylesheet.rain=f.get();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!s.by(f.get(),a)){f.set(a,this.options),this.stylesheet.fog=f.get();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}}else this._createFog(a);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(a){if(this._checkLoaded(),!a)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const f=this.snow;if(!s.by(f.get(),a)){f.set(a,this.options),this.stylesheet.snow=f.get();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}}else this._createSnow(a);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(a){if(this._checkLoaded(),!a)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const f=this.rain;if(!s.by(f.get(),a)){f.set(a,this.options),this.stylesheet.rain=f.get();const g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}}else this._createRain(a);this._markersNeedUpdate=!0}_reloadColorTheme(){const a=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()},f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!f)return this._styleColorTheme.lut=null,void a();const g=this._evaluateColorThemeData(f);this._loadColorTheme(g).then(()=>{this.fire(new s.z("colorthemeset")),a()}).catch(b=>{s.w(`Couldn't set color theme: ${b}`)})}setColorTheme(a){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=a,this._reloadColorTheme()}setImportColorTheme(a,f){const g=this.getFragmentStyle(a);g&&(g._styleColorTheme.colorThemeOverride=f,g._reloadColorTheme())}_getTransitionParameters(a){return{now:s.o.now(),transition:Object.assign(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],f=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?a.push(g):f.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const g=this.terrain=new At(a,f,this.scope,this.options,this.map.getWorldview());f===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});g.updateTransitions(b)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,g,b,E={}){if(E&&E.validate===!1)return!1;const C=Object.assign({},this.serialize());return Vu(this,a.call(Zi,Object.assign({key:f,style:C,value:g,styleSpec:s.a6},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(a){const f=this.getSourceCaches(a);for(const g of f)g.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}clearLayers(){for(const a in this._mergedLayers){const f=this._mergedLayers[a];f._clear&&f._clear()}}reloadSource(a){const f=this.getSourceCaches(a);for(const g of f)g.resume(),g.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(a=>{a.modelManager.reloadModels(a.scope)})}updateSources(a){let f;this.directionalLight&&(f=E3(this.directionalLight));const g=new Set,b=new Set;for(const E in this._mergedLayers){const C=this._mergedLayers[E];C.type==="building"&&g.add(C.source),C.hasElevation()&&!b.has(C.source)&&b.add(C.source)}for(const E in this._mergedSourceCaches){const C=this._mergedSourceCaches[E],I=b.has(C._source.id);g.has(C._source.id)&&(C._source.reparseOverscaled=!1),C.update(a,void 0,void 0,f,I)}}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new s.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new ib),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(a,f,g,b,E){this.pauseablePlacement||(this.pauseablePlacement=new ib);let C=!1,I=!1;const R={},L={};for(const Z of this._mergedOrder){const J=this._mergedLayers[Z];if(J.type!=="symbol")continue;const ie=s.B(J.source,J.scope);let pe=R[ie];if(!pe){const ce=this.getLayerSourceCache(J);if(!ce)continue;const Re=ce.getRenderableIds(!0).map(Ce=>ce.getTileByID(Ce));L[ie]=Re.slice(),pe=R[ie]=Re.sort((Ce,Se)=>Se.tileID.overscaledZ-Ce.tileID.overscaledZ||(Ce.tileID.isLessThan(Se.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(J,pe,a.center.lng,a.projection);C=C||fe}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const B=!!(this.placement&&!a.equals(this.placement.transform)),V=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!E||this.placement.lastReplacementSourceUpdateTime!==E.updateTime)),j=B||V||C,W=(j||this.pauseablePlacement.isStale())&&g===0,Y=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),a.zoom)&&g!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||W||Y)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(a,this._mergedOrder,f,g,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?j&&g!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),I=!0),C&&this.pauseablePlacement.setStale()),I||C){this._buildingIndex.onNewFrame(a.zoom);for(let Z=0;Z<this._mergedOrder.length;Z++){const J=this._mergedLayers[this._mergedOrder[Z]];if(J.type!=="symbol"||J.visibility==="none")continue;const ie=this.isLayerClipped(J);this.placement.updateLayerOpacities(J,R[s.B(J.source,J.scope)],Z,ie?E:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(s.o.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,f){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:E})=>E===a.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!f)return g.push(a),this._loadImports([a],!0);const b=g.findIndex(({id:E})=>E===f);return b===-1&&this.fire(new s.y(new Error(`Import with id "${f}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,b).concat(a).concat(g.slice(b)),this._loadImports([a],!0,f)}updateImport(a,f){this._checkLoaded();const g=this.stylesheet.imports||[],b=this.getImportIndex(a);return b===-1?this:typeof f=="string"?(this.setImportUrl(a,f),this):(f.url&&f.url!==g[b].url&&this.setImportUrl(a,f.url),s.by(f.config,g[b].config)||this.setImportConfig(a,f.config,f.data.schema),s.by(f.data,g[b].data)||this.setImportData(a,f.data),this)}moveImport(a,f){this._checkLoaded();let g=this.stylesheet.imports||[];const b=this.getImportIndex(a);if(b===-1)return this;const E=this.getImportIndex(f);if(E===-1)return this;const C=g[b],I=this.fragments[b];return g=g.filter(({id:R})=>R!==a),this.fragments=this.fragments.filter(({id:R})=>R!==a),this.stylesheet.imports=g.slice(0,E).concat(C).concat(g.slice(E)),this.fragments=this.fragments.slice(0,E).concat(I).concat(this.fragments.slice(E)),this.mergeLayers(),this}setImportUrl(a,f){this._checkLoaded();const g=this.stylesheet.imports||[],b=this.getImportIndex(a);if(b===-1)return this;g[b].url=f;const E=this.fragments[b];return E.style=this._createFragmentStyle(g[b]),E.style.on("style.import.load",()=>this.mergeAll()),E.style.loadURL(f),this}setImportData(a,f){this._checkLoaded();const g=this.getImportIndex(a),b=this.stylesheet.imports||[];return g===-1?this:f?(this.fragments[g].style.setState(f),this._reloadImports(),this):(delete b[g].data,this.setImportUrl(a,b[g].url))}setImportConfig(a,f,g){this._checkLoaded();const b=this.getImportIndex(a),E=this.stylesheet.imports||[];if(b===-1)return this;f?E[b].config=f:delete E[b].config;const C=this.fragments[b];g&&C.style.stylesheet&&(C.style.stylesheet.schema=g);const I=C.style.stylesheet&&C.style.stylesheet.schema;return C.config=f,C.style.updateConfig(f,I),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const f=this.stylesheet.imports||[],g=this.getImportIndex(a);g!==-1&&(f.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(a){const f=(this.stylesheet.imports||[]).findIndex(g=>g.id===a);return f===-1&&this.fire(new s.y(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),f}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const f in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[f];g&&a.push(g.getSource())}return a}getSource(a,f){const g=this.getSourceCache(a,f);return g&&g.getSource()}getLayerSource(a){const f=this.getLayerSourceCache(a);return f&&f.getSource()}getSourceCache(a,f){const g=s.B(a,f);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(a){const f=s.B(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const f=[];return this._mergedOtherSourceCaches[a]&&f.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&f.push(this._mergedSymbolSourceCaches[a]),f}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const f in a){const g=a[f];g==="reload"?this.reloadSource(f):g==="clear"&&this.clearSource(f)}}updateLayers(a){const f=this._changes.getUpdatedPaintProperties();for(const g of f){const b=this.getLayer(g);b&&b.updateTransitions(a)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(a){this.stylesheet.glyphs=a,this.glyphManager.setURL(a)}getImages(a,f,g){this.imageManager.getImages(f.images,f.scope,g),this._updateTilesForChangedImages();const b=C=>{if(C){const I=f.images.map(R=>s.I.toString(R));C.setDependencies(f.tileID.key,f.type,I)}},E=s.B(f.source,f.scope);b(this._mergedOtherSourceCaches[E]),b(this._mergedSymbolSourceCaches[E]),f.images.some(C=>C.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(a,f,g){this.imageManager.rasterizeImages(f,g)}getGlyphs(a,f,g){this.glyphManager.getGlyphs(f.stacks,g)}getResource(a,f,g){return s.dz(f,g)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this.getOwnSourceCaches(a);return f.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${a}'`))),!1):f.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(a,f){if(!this._clipLayerPresent&&a.type!=="fill-extrusion"&&a.type!=="building")return!1;const g=a.type==="fill-extrusion"&&(a.sourceLayer==="building"||a.sourceLayer==="procedural_buildings"),b=a.type==="building";if(a.is3D(!!this.terrain)){if(g||b||f&&f.type==="batched-model"||a.type==="model")return!0}else if(a.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Na.getSourceType=function(m){return Bu[m]},Na.setSourceType=function(m,a){Bu[m]=a},Na.registerForPluginStateChange=s.dA;var lb=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ub=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,up="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",db=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,e_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,uc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,vg=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,zt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,hb=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,fb=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const xg=/#include\s+"([^"]+)"/g,tu=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,pb=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Wh=new Set(["ifdef","ifndef","elif","if","defined"]),Hh=new Set;Fd(lb,Hh),Fd(lp,Hh),Fd(ub,Hh);const Bd={"_prelude_fog.vertex.glsl":e_,"_prelude_terrain.vertex.glsl":db,"_prelude_shadow.vertex.glsl":hb,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":uc,"_prelude_shadow.fragment.glsl":fb,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":vg,"_prelude_raster_particle.glsl":zt},t_={};di("",db),di(uc,e_),di(fb,hb),di(vg,""),di(zt,"");const I3=di(ub,lp),n_=lb,BI=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",n_,I3.fragmentSource].join(`
`),P3=["precision highp float;",n_,I3.vertexSource].join(`
`);var mb={background:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:di(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:di("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:di(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:di("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:di("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:di("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:di(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:di(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:di(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:di(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:di(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:di("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:di("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:di(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:di(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:di("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:di(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,up),skyboxGradient:di(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,up),skyboxCapture:di(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:di(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:di(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:di("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:di("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:di("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:di("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Fd(m,a){const f=m.split(`
`);for(let g of f){if(g=g.trimStart(),g[0]!=="#"||!g.includes("if")||g.startsWith("#endif"))continue;const b=g.match(pb);if(b)for(const E of b)Wh.has(E)||a.add(E)}}function di(m,a){const f=new Set,g=[],b=[];m=m.replace(xg,(C,I)=>(b.push(I),"")),a=a.replace(xg,(C,I)=>(g.push(I),""));let E=new Set(Hh);Fd(m,E),Fd(a,E);for(const C of[...g,...b])t_[C]||(t_[C]=new Set,Fd(Bd[C],t_[C])),E=new Set([...E,...t_[C]]);return{fragmentSource:m=m.replace(tu,(C,I,R,L,B)=>(f.add(B),I==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${R} ${L} ${B};
#else
uniform ${R} ${L} u_${B};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${R} ${L} ${B} = u_${B};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${R} ${L} ${B};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(tu,(C,I,R,L,B)=>{const V=`MATERIAL_ATTRIBUTE_OFFSET_${B}`,j=L==="float"?"vec2":L,W=`GET_ATTRIBUTE_${j}(a_${B}, materialInfo, ${V})`,Y=B.match(/color/)?"color":j;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${R} ${L} a_${B};
#endif
`:f.has(B)?I==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${V})
        in ${R} ${j} a_${B};
    #endif
out ${R} ${L} ${B};
#else
uniform ${R} ${L} u_${B};
#endif
`:I==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${R} ${L} ${B} = u_${B};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${B})
    #ifdef ${V}
        ${B} = unpack_mix_${Y}(${W}, u_${B}_t);
    #else
        ${B} = unpack_mix_${Y}(a_${B}, u_${B}_t);
    #endif
#else
    ${R} ${L} ${B} = u_${B};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${R} ${L} a_${B};
    out ${R} ${L} ${B};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${V})
        in ${R} ${j} a_${B};
    #endif
#else
uniform ${R} ${L} u_${B};
#endif
`:I==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${R} ${L} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${R} ${j} a_${B};
#else
uniform ${R} ${L} u_${B};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${R} ${L} ${B} = a_${B};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${V}
        ${R} ${L} ${B} = ${W};
    #else
        ${R} ${L} ${B} = a_${B};
    #endif
#else
    ${R} ${L} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${V}
        ${R} ${L} ${B} = unpack_mix_${Y}(${W}, u_${B}_t);
    #else
        ${R} ${L} ${B} = unpack_mix_${Y}(a_${B}, u_${B}_t);
    #endif
#else
    ${R} ${L} ${B} = u_${B};
#endif
`}),usedDefines:E,vertexIncludes:g,fragmentIncludes:b}}class FI{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,f,g,b,E,C,I,R){this.context=a;let L=this.boundPaintVertexBuffers.length!==b.length;for(let V=0;!L&&V<b.length;V++)this.boundPaintVertexBuffers[V]!==b[V]&&(L=!0);let B=this.boundDynamicVertexBuffers.length!==I.length;for(let V=0;!B&&V<I.length;V++)this.boundDynamicVertexBuffers[V]!==I[V]&&(B=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==g||L||B||this.boundIndexBuffer!==E||this.boundVertexOffset!==C)this.freshBind(f,g,b,E,C,I,R);else{a.bindVertexArrayOES.set(this.vao);for(const V of I)V&&(V.bind(),R&&V.instanceCount&&V.setVertexAttribDivisor(a.gl,f,R));E&&E.dynamicDraw&&E.bind()}}freshBind(a,f,g,b,E,C,I){const R=this.context,L=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=C,f.enableAttributes(L,a),f.bind(),f.setVertexAttribPointers(L,a,E);for(const B of g)B.enableAttributes(L,a),B.bind(),B.setVertexAttribPointers(L,a,E);for(const B of C)B&&(B.enableAttributes(L,a),B.bind(),B.setVertexAttribPointers(L,a,E),I&&B.instanceCount&&B.setVertexAttribDivisor(L,a,I));b&&b.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $I(m,a){const f=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new s.ae(0,g/f).toLngLat().lat,new s.ae(0,(g+1)/f).toLngLat().lat]}function zI(m,a,f,g,b,E,C){const I=m.context,R=I.gl,L=f.hillshadeFBO;if(!L)return;m.prepareDrawTile();const B=m.isTileAffectedByFog(a),V=[];m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&V.push("USE_MRT1");const j=m.getOrCreateProgram("hillshade",{overrideFog:B,defines:V});I.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,L.colorAttachment0.get());const W=((ie,pe,fe,ce)=>{const Re=fe.paint.get("hillshade-shadow-color"),Ce=fe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Se=fe.paint.get("hillshade-highlight-color"),be=fe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=fe.paint.get("hillshade-accent-color"),Ne=fe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",We=fe.paint.get("hillshade-emissive-strength");let Ze=s.an(fe.paint.get("hillshade-illumination-direction"));if(fe.paint.get("hillshade-illumination-anchor")==="viewport")Ze-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const Je=ie.style.directionalLight.properties.get("direction"),mt=s.d4(Je.x,Je.y,Je.z);Ze=s.an(mt[1])}const tt=!ie.options.moving;return{u_matrix:ce||ie.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),tt),u_image:0,u_latrange:$I(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),Ze],u_shadow:Re.toPremultipliedRenderColor(Ce?null:fe.lut),u_highlight:Se.toPremultipliedRenderColor(be?null:fe.lut),u_emissive_strength:We,u_accent:ye.toPremultipliedRenderColor(Ne?null:fe.lut)}})(m,f,g,m.terrain?a.projMatrix:null);m.uploadCommonUniforms(I,j,a.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:Z,tileBoundsSegments:J}=m.getTileBoundsBuffers(f);j.draw(m,R.TRIANGLES,b,E,C,En.disabled,W,g.id,Y,Z,J)}function gb(m,a,f){if(!a.needsDEMTextureUpload)return;const g=m.context,b=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(f.stride);const E=f.getPixels();a.demTexture?a.demTexture.update(E,{premultiply:!1}):a.demTexture=new s.T(g,E,b.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function UI(m,a,f){const g=m.context,b=g.gl;if(!a.dem)return;const E=a.dem;if(g.activeTexture.set(b.TEXTURE1),gb(m,a,E),!a.demTexture)return;a.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const C=E.dim;g.activeTexture.set(b.TEXTURE0);let I=a.hillshadeFBO;if(!I){const j=new s.T(g,{width:C,height:C,data:null},b.RGBA8);j.bind(b.LINEAR,b.CLAMP_TO_EDGE),I=a.hillshadeFBO=g.createFramebuffer(C,C,1,"renderbuffer"),I.colorAttachment0.set(j.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,C,C]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:L,tileBoundsSegments:B}=m.getMercatorTileBoundsBuffers(),V=[];m.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&V.push("USE_MRT1"),m.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(m,b.TRIANGLES,cn.disabled,Pn.disabled,Nn.unblended,En.disabled,((j,W)=>{const Y=W.stride,Z=s.bC();return s.ce(Z,0,s.al,-s.al,0,0,1),s.br(Z,Z,[0,-s.al,0]),{u_matrix:Z,u_image:1,u_dimension:[Y,Y],u_zoom:j.overscaledZ}})(a.tileID,E),f.id,R,L,B),a.needsHillshadePrepare=!1}class lr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class jI extends lr{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class R3 extends lr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class yb extends lr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class i_ extends lr{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class _b extends lr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Gh extends lr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class dp extends lr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Eg extends lr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class hp extends lr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class O3 extends lr{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class wb extends lr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class k3 extends lr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class fp extends lr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class r_ extends lr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class s_ extends lr{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class bb extends lr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class o_ extends lr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Cg extends lr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class D3 extends lr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let N3=class extends lr{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class M3 extends lr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class pp extends lr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class L3 extends lr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class VI extends lr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class WI extends lr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class HI extends lr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class vb extends lr{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class xb extends lr{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class Eb extends lr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Cb extends lr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class B3 extends lr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class a_ extends lr{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class c_ extends a_{constructor(a,f,g=0){super(a,f),this.attachmentPoint=a.gl.COLOR_ATTACHMENT0+g}setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachmentPoint,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class mp extends a_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Tg extends a_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class F3 extends mp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const dc=(m,a,f,g)=>({u_matrix:m,u_image0:0,u_image1:1,u_skirt_height:a,u_ground_shadow_factor:f,u_emissive_texture_available:g}),l_=(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:f,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_image1:1,u_frustum_tl:C,u_frustum_tr:I,u_frustum_br:R,u_frustum_bl:L,u_globe_pos:B,u_globe_radius:V,u_viewport:j,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:Y,u_emissive_texture_available:Z});function Ag(m,a){return m!=null&&a!=null&&!(!m.hasData()||!a.hasData())&&m.demTexture!=null&&a.demTexture!=null&&m.tileID.key!==a.tileID.key}const Wu=new class{constructor(){this.operations={}}newMorphing(m,a,f,g,b){if(m in this.operations){const E=this.operations[m];E.to.tileID.key!==f.tileID.key&&(E.queued=f)}else this.operations[m]={startTime:g,phase:0,duration:b,from:a,to:f,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const f=this.operations[a];for(f.phase=(m-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},u_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function d_(m,a,f){if(a===0)return 0;const g=a<1&&f===514?.25/a:1;return 6*Math.pow(1.5,22-m)*Math.max(a,1)*g}function Tb(m,a){const f=1<<m.z;return!a&&(m.x===0||m.x===f-1)||m.y===0||m.y===f-1}function gp(m,a){if(!m.style||!m.style.enable3dLights())return;const f=m.context,g=f.gl;f.activeTexture.set(g.TEXTURE1),a?a.bind(g.LINEAR,g.CLAMP_TO_EDGE):m.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}const Sg=m=>({u_matrix:m});function Ig(m,a,f,g,b){if(b>0){const E=s.o.now(),C=(E-m.timeAdded)/b,I=a?(E-a.timeAdded)/b:-1,R=f.getSource(),L=g.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),B=!a||Math.abs(a.tileID.overscaledZ-L)>Math.abs(m.tileID.overscaledZ-L),V=B&&m.refreshedUponExpiration?1:s.aA(B?C:1-I,0,1);return a?{opacity:1,mix:1-V,isFading:C<1}:{opacity:V,mix:0,isFading:C<1}}return{opacity:1,mix:0,isFading:!1}}class h_ extends ha{constructor(a){const f=$h("mock-dem",{type:"raster-dem",maxzoom:a.transform.maxZoom},a.style.dispatcher,a.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class Ab extends ha{constructor(a){const f=$h("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},a.style.dispatcher,a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,g){if(a.freezeTileCoverage)return;this.transform=a;const b=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,C)=>{if(E[C.key]="",!this._tiles[C.key]){const I=new Rd(C,this._source.tileSize*C.overscaleFactor(),a.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[C.key]=I}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const g=Object.values(f);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sb extends s.aQ{constructor(a,f,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=g}}class Ib extends s.bV{constructor(a,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,b,E]=function(){const R=new s.bd,L=new s.b0,B=131;R.reserve(17161),L.reserve(33800);const V=s.al/128,j=s.al+V/2,W=j+V;for(let Z=-V;Z<W;Z+=V)for(let J=-V;J<W;J+=V){const ie=J<0||J>j||Z<0||Z>j?24575:0,pe=s.aA(Math.round(J),0,s.al),fe=s.aA(Math.round(Z),0,s.al);R.emplaceBack(pe+ie,fe)}const Y=(Z,J)=>{const ie=J*B+Z;L.emplaceBack(ie+1,ie,ie+B),L.emplaceBack(ie+B,ie+B+1,ie+1)};for(let Z=1;Z<129;Z++)for(let J=1;J<129;J++)Y(J,Z);return[0,129].forEach(Z=>{for(let J=0;J<130;J++)Y(J,Z),Y(Z,J)}),[R,L,32768]}(),C=a.context;this.gridBuffer=C.createVertexBuffer(g,s.bf.members),this.gridIndexBuffer=C.createIndexBuffer(b),this.gridSegments=s.bg.simpleSegment(0,0,g.length,b.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,g.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ab(f.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=C.gl;this._overlapStencilMode=new Pn({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new h_(f.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,f,g){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const b=a.terrain.properties,E=a.terrain.drapeRenderMode===0,C=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=a.terrain&&a.terrain.scope,R=b.get("source"),L=E?this._mockSourceCache:a.getSourceCache(R,I);if(!L)return void s.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=L,this._attenuationRange=a.terrain.getAttenuationRange(),this._exaggeration=C?this.calculateExaggeration(f):b.get("exaggeration"),!f.projection.requiresDraping&&C&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(f,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),f.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(a){if(this._attenuationRange&&a.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(a.zoom);const f=this._previousCameraAltitude,g=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=g;const b=f!=null?g-f:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const E=a.zoom,C=this._style.terrain;if(!this._previousUpdateTimestamp)return C.getExaggeration(E);let I=E-this._previousZoom;const R=this._previousUpdateTimestamp;let L=E;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(E-L)>.5&&(I=.5*(E-L+I)),I*b<0&&(L+=I)),this._evaluationZoom=L;const B=C.getExaggeration(L),V=B===C.getExaggeration(Math.max(0,L-.1));if(V&&Math.abs(B-this._exaggeration)<.01)return B;let j=Math.min(.1,.00375*(this._updateTimestamp-R));return(V||B<.1||Math.abs(I)<1e-4)&&(j=Math.min(.2,4*j)),s.ak(this._exaggeration,B,j)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.dataType==="source"&&a.coord?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=f.getIds().map(R=>{const L=f.getTileByID(R).tileID;return L.projMatrix=g.calculateProjMatrix(L.toUnwrapped()),L});(function(R,L){const B=L.transform.pointCoordinate(L.transform.getCameraPoint()),V=new s.P(B.x,B.y);R.sort((j,W)=>{if(W.overscaledZ-j.overscaledZ)return W.overscaledZ-j.overscaledZ;const Y=new s.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Z=new s.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),J=V.mult(1<<j.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Y)-J.distSqr(Z)})})(b,this.painter);const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const C=this._style._mergedSourceCaches;for(const R in C){const L=C[R];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,a[R],E),L.usedForTerrain))continue;const B=a[R];L.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[f.id]=b.map(R=>new Sb(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const L=this.terrainTileForTile[R.key];if(!L)continue;const B=L.tileID.key;B in I||(this._visibleDemTiles.push(L),I[B]=B)}}_assignTerrainTiles(a){this._initializing||a.forEach(f=>{if(this.terrainTileForTile[f.key])return;const g=this._findTileCoveringTileID(f,this.sourceCache);g&&(this.terrainTileForTile[f.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const g in this.terrainTileForTile){const b=this.terrainTileForTile[g],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),gb(this.painter,b,E))}}_prepareDemTileUniforms(a,f,g,b){if(!f||f.demTexture==null)return!1;const E=a.tileID.canonical,C=Math.pow(2,f.tileID.canonical.z-E.z),I=b||"";return g[`u_dem_tl${I}`]=[E.x*C%1,E.y*C%1],g[`u_dem_scale${I}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let a=0;const f=this._visibleDemTiles.reduce((g,b)=>{if(!b.dem)return g;const E=b.dem.tree.minimums[0];return E>0&&a++,g+E},0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const g=this._getLoadedAreaMinimum(),b=new s.dL({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new s.T(a,b,f.R32F,{premultiply:!1}),E}setupElevationDraw(a,f,g){const b=this.painter.context,E=b.gl,C={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};C.u_exaggeration=this.exaggeration();let I=null,R=null,L=1;if(g&&g.morphing&&this._useVertexMorphing){const W=g.morphing.srcDemTile,Y=g.morphing.dstDemTile;L=g.morphing.phase,W&&Y&&(this._prepareDemTileUniforms(a,W,C,"_prev")&&(R=W),this._prepareDemTileUniforms(a,Y,C)&&(I=Y))}const B=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?E.LINEAR:E.NEAREST;let V=null;var j;if(this.enabled?R&&I?(V=I.demTexture,b.activeTexture.set(E.TEXTURE4),R.demTexture.bind(B(R),E.CLAMP_TO_EDGE),C.u_dem_lerp=L):(I=this.terrainTileForTile[a.tileID.key],V=this._prepareDemTileUniforms(a,I,C)?I.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,b.activeTexture.set(E.TEXTURE2),V&&(C.u_dem_size=(j=V).size[0]===1?1:j.size[0]-2,V.bind(B(I),E.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,f,C),g&&g.useMeterToDem&&I){const W=(1<<I.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=W}if(g&&g.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),f.setTerrainUniformValues(b,C),this.painter.transform.projection.name==="globe"){const W=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);f.setGlobeUniformValues(b,W)}}globeUniformValues(a,f,g){const b=a.projection;return{u_tile_tl_up:b.upVector(f,0,0),u_tile_tr_up:b.upVector(f,s.al,0),u_tile_br_up:b.upVector(f,s.al,s.al),u_tile_bl_up:b.upVector(f,0,s.al),u_tile_up_scale:g?s.dM(1):b.upVectorScale(f,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const f=this.painter,g=this.painter.context;a.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,C,I,R){if(b.transform.projection.name==="globe")(function(L,B,V,j,W){const Y=L.context,Z=Y.gl;let J,ie;const pe=L.transform,fe=s.dE(L,Y,pe),ce=(tt,Je)=>{if(ie===Je)return;const mt=[u_[Je],"PROJECTION_GLOBE_VIEW"];fe&&mt.push("CUSTOM_ANTIALIASING");const xt=L.isTileAffectedByFog(tt);J=L.getOrCreateProgram("globeRaster",{defines:mt,overrideFog:xt}),ie=Je},Re=L.colorModeForRenderPass(),Ce=new cn(Z.LEQUAL,cn.ReadWrite,L.depthRangeFor3D);Wu.update(W);const Se=s.dF(pe),be=[s.aF(pe.center.lng),s.aJ(pe.center.lat)],ye=L.globeSharedBuffers,Ne=[pe.width*s.o.devicePixelRatio,pe.height*s.o.devicePixelRatio],We=Float32Array.from(pe.globeMatrix),Ze={useDenormalizedUpVectorScale:!0};{const tt=L.transform,Je=d_(tt.zoom,B.exaggeration(),B.sourceCache._source.tileSize);ie=-1;const mt=Z.TRIANGLES;for(const xt of j){const Xe=V.getTile(xt),Me=Pn.disabled,dt=B.prevTerrainTileForTile[xt.key],nt=B.terrainTileForTile[xt.key];Ag(dt,nt)&&Wu.newMorphing(xt.key,dt,nt,W,250),gp(L,Xe.emissiveTexture),Y.activeTexture.set(Z.TEXTURE0),Xe.texture&&Xe.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const St=Wu.getMorphValuesForProxy(xt.key),Rt=St?1:0;St&&Object.assign(Ze,{morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:s.dD(St.phase)}});const jt=s.dG(xt.canonical),Ot=s.dH(jt.getCenter().lat),Mt=s.dI(xt.canonical,jt,Ot,tt.worldSize/tt._pixelsPerMercatorPixel),rn=s.bk(s.dJ(xt.canonical)),tn=L.emissiveMode==="mrt-fallback"?1:0,Gt=l_(tt.expandedFarZProjMatrix,We,Se,rn,s.aj(tt.zoom),be,tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.globeCenterInViewSpace,tt.globeRadius,Ne,Je,tt._farZ,tn,Mt);if(ce(xt,Rt),J&&(B.setupElevationDraw(Xe,J,Ze),L.uploadCommonUniforms(Y,J,xt.toUnwrapped()),ye)){const[en,hn,Cn]=ye.getGridBuffers(Ot,Je!==0);J.draw(L,mt,Ce,Me,Re,En.backCCW,Gt,"globe_raster",en,hn,Cn)}}}if(ye&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const tt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&tt.push("CUSTOM_ANTIALIASING"),J=L.getOrCreateProgram("globeRaster",{defines:tt});for(const Je of j){const{x:mt,y:xt,z:Xe}=Je.canonical,Me=xt===0,dt=xt===(1<<Xe)-1,[nt,St,Rt,jt]=ye.getPoleBuffers(Xe,!1);if(jt&&(Me||dt)){const Ot=V.getTile(Je);gp(L,Ot.emissiveTexture),Y.activeTexture.set(Z.TEXTURE0),Ot.texture&&Ot.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Mt=s.dK(Xe,mt,pe);const rn=s.bk(s.dJ(Je.canonical)),tn=L.emissiveMode==="mrt-fallback"?1:0,Gt=(en,hn)=>en.draw(L,Z.TRIANGLES,Ce,Pn.disabled,Re,En.disabled,l_(pe.expandedFarZProjMatrix,Mt,Mt,rn,0,be,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,Ne,0,pe._farZ,tn),"globe_pole_raster",hn,Rt,jt);B.setupElevationDraw(Ot,J,Ze),L.uploadCommonUniforms(Y,J,Je.toUnwrapped()),Me&&L.renderDefaultNorthPole&&Gt(J,nt),dt&&L.renderDefaultSouthPole&&(Mt=s.cS(s.bC(),Mt,[1,-1,1]),Gt(J,St))}}}})(b,E,C,I,R);else{const L=b.context,B=L.gl;let V,j;const W=b.shadowRenderer,Y=jc(b,b.longestCutoffRange),Z=Re=>{if(j===Re)return;const Ce=[];Ce.push(u_[Re]),Y.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),W&&(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&Ce.push("NORMAL_OFFSET")),V=b.getOrCreateProgram("terrainRaster",{defines:Ce}),j=Re},J=b.colorModeForRenderPass(),ie=new cn(B.LEQUAL,cn.ReadWrite,b.depthRangeFor3D);Wu.update(R);const pe=b.transform,fe=d_(pe.zoom,E.exaggeration(),E.sourceCache._source.tileSize);let ce=[0,0,0];if(W){const Re=b.style.directionalLight,Ce=b.style.ambientLight;Re&&Ce&&(ce=Vc(b.style,Re,Ce))}{j=-1;const Re=B.TRIANGLES,[Ce,Se]=[E.gridIndexBuffer,E.gridSegments];for(const be of I){const ye=C.getTile(be),Ne=Pn.disabled,We=E.prevTerrainTileForTile[be.key],Ze=E.terrainTileForTile[be.key];Ag(We,Ze)&&Wu.newMorphing(be.key,We,Ze,R,250),gp(b,ye.emissiveTexture),L.activeTexture.set(B.TEXTURE0),ye.texture&&ye.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const tt=Wu.getMorphValuesForProxy(be.key),Je=tt?1:0;let mt;tt&&(mt={morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:s.dD(tt.phase)}});const xt=b.emissiveMode==="mrt-fallback"?1:0,Xe=dc(be.projMatrix,Tb(be.canonical,pe.renderWorldCopies)?fe/10:fe,ce,xt);if(Z(Je),!V)continue;E.setupElevationDraw(ye,V,mt);const Me=be.toUnwrapped();W&&W.setupShadows(Me,V),b.uploadCommonUniforms(L,V,Me,null,Y),V.draw(b,Re,ie,Ne,J,En.backCCW,Xe,"terrain_raster",E.gridBuffer,Ce,Se)}}}}(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,g=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],C=this._drapedRenderBatches.shift(),I=f.style.order,R=[];this._updateFBOs(f.emissiveMode==="mrt-fallback");let L=0;for(const B of E){const V=b.getTileByID(B.proxyTileKey),j=b.proxyCachedFBO[B.key]?b.proxyCachedFBO[B.key][a]:void 0,W=j!==void 0?b.renderCache[j]:this.pool[L++],Y=j!==void 0;if(V.texture=W.tex,V.emissiveTexture=W.emissiveTex,Y&&!W.dirty){R.push(V.tileID);continue}g.bindFramebuffer.set(W.fb.framebuffer);const Z=g.gl;let J;Z.drawBuffers(f.emissiveMode==="mrt-fallback"?[Z.COLOR_ATTACHMENT0,Z.COLOR_ATTACHMENT1]:[Z.COLOR_ATTACHMENT0]),this.renderedToTile=!1,W.dirty&&(g.clear({color:s.ao.transparent,stencil:0}),W.dirty=!1);for(let ie=C.start;ie<=C.end;++ie){const pe=f.style._mergedLayers[I[ie]];if(pe.isHidden(f.transform.zoom))continue;const fe=f.style.getLayerSourceCache(pe),ce=fe?this.proxyToSource[B.key][fe.id]:[B];if(!ce)continue;const Re=ce;g.viewport.set([0,0,W.fb.width,W.fb.height]),J!==(fe?fe.id:null)&&(this._setupStencil(W,ce,pe,fe),J=fe?fe.id:null),f.renderLayer(f,fe,pe,Re)}if(Z.drawBuffers([Z.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const pe=f.style._mergedLayers[I[ie]];if(pe.isHidden(f.transform.zoom))continue;const fe=f.style.getLayerSourceCache(pe),ce=fe?this.proxyToSource[B.key][fe.id]:[B];if(!ce)continue;const Re=ce;g.viewport.set([0,0,W.fb.width,W.fb.height]),J!==(fe?fe.id:null)&&(this._setupStencil(W,ce,pe,fe),J=fe?fe.id:null),f.renderLayer(f,fe,pe,Re)}this.renderedToTile?(W.dirty=!0,R.push(V.tileID)):Y||--L,L===5&&(L=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,f.width,f.height]),C.end+1}postRender(){}isLayerOrderingCorrect(a){const f=a.order.length;let g=-1,b=f;for(let E=0;E<f;++E)this._style.isLayerDraped(a._mergedLayers[a.order[E]])?g=Math.max(g,E):b=Math.min(b,E);return b>g}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{a=Math.min(a,f.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,f,g){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const C=E.tileID,I=1<<C.overscaledZ,{x:R,y:L}=C.canonical,B=R/I,V=(R+1)/I,j=L/I,W=(L+1)/I;return{minx:B,miny:j,maxx:V,maxy:W,t:E.dem.tree.raycastRoot(B,j,V,W,a,f,g),tile:E}});b.sort((E,C)=>(E.t!==null?E.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE));for(const E of b){if(E.t==null)return null;const C=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,a,f,g);if(C!=null)return C}return null}_createFBO(){const a=this.painter.context,f=a.gl,g=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const b=new s.T(a,{width:g[0],height:g[1],data:null},f.RGBA8);b.bind(f.LINEAR,f.CLAMP_TO_EDGE);const E=a.createFramebuffer(g[0],g[1],1,null);let C;return E.colorAttachment0.set(b.texture),this._emissiveTexture&&(C=new s.T(a,{width:g[0],height:g[1],data:null},f.R8),C.bind(f.LINEAR,f.CLAMP_TO_EDGE),E.createColorAttachment(a,1),E.colorAttachment1.set(C.texture)),E.depthAttachment=new F3(a,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:E,tex:b,emissiveTex:C,dirty:!1}}_updateFBOs(a){if(this._emissiveTexture!==a){for(const f of this.pool)this._updateFBO(f,a);for(const f of this.proxySourceCache.renderCache)this._updateFBO(f,a);this._emissiveTexture=a}}_updateFBO(a,f){const g=a.fb,b=this.painter.context,E=b.gl,C=this.drapeBufferSize;if(f){const I=new s.T(b,{width:C[0],height:C[1],data:null},E.R8);I.bind(E.LINEAR,E.CLAMP_TO_EDGE),a.emissiveTex=I,g.createColorAttachment(b,1),g.colorAttachment1.set(I.texture)}else a.emissiveTex=void 0,g.removeColorAttachment(b,1);a.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const f=this._style._mergedLayers[a],g=f.isHidden(this.painter.transform.zoom);return f.type==="hillshade"||f.type==="custom"?!g&&f.shouldRedrape():!g&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const g of this._style.getSources())if(g instanceof zc){a=!0;break}if(!a)return;const f={};for(let g=0;g<this._style.order.length;++g){const b=this._style._mergedLayers[this._style.order[g]],E=this._style.getLayerSourceCache(b);if(!E||f[E.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="line")continue;const C=b.widthExpression(),I=b.emissiveStrengthExpression();if(C instanceof s.ad||I instanceof s.ad){f[E.id]=!0;for(const R of this.proxyCoords){const L=this.proxyToSource[R.key][E.id];if(L)for(const B of L)this._clearRenderCacheForTile(E.id,B)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof xl){a=!0;break}if(!a)return;const f={};for(let g=0;g<this._style.order.length;++g){const b=this._style._mergedLayers[this._style.order[g]],E=this._style.getLayerSourceCache(b);if(!E||f[E.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const C=b.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const R=this.proxyToSource[I.key][E.id];if(R)for(const L of R){const B=Ig(E.getTile(L),E.findLoadedParent(L,0),E,this.painter.transform,C);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(E.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const a=this._style.order,f=a.length;if(f===0)return;const g=[];this._pendingGroundEffectLayers=[];let b,E=0,C=this._style._mergedLayers[a[E]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++E<f;)C=this._style._mergedLayers[a[E]];for(;E<f;++E){const I=this._style._mergedLayers[a[E]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?b===void 0&&(b=E):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(E),b!==void 0&&(g.push({start:b,end:E-1}),b=void 0)))}if(b!==void 0&&g.push({start:b,end:E-1}),g.length!==0){const I=g[g.length-1];this._pendingGroundEffectLayers.every(R=>R>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const C=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let I=0;I<C.length;++I){const R=Object.values(C[I]);f.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,b=this._tilesDirty;for(let C=g.length-1;C>=0;C--){const I=g[C];if(f.getTileByID(I.key),f.proxyCachedFBO[I.key]!==void 0){const R=a[I.key],L=this.proxyToSource[I.key];let B=0;for(const V in L){const j=L[V],W=R[V];if(!W||W.length!==j.length||j.some((Y,Z)=>Y!==W[Z]||b[V]&&b[V].hasOwnProperty(Y.key))){B=-1;break}++B}for(const V in f.proxyCachedFBO[I.key])f.renderCache[f.proxyCachedFBO[I.key][V]].dirty=B<0||B!==Object.values(R).length}}const E=[...this._drapedRenderBatches];E.sort((C,I)=>I.end-I.start-(C.end-C.start));for(const C of E)for(const I of g){if(f.proxyCachedFBO[I.key])continue;let R=f.renderCachePool.pop();R===void 0&&f.renderCache.length<50&&(R=f.renderCache.length,f.renderCache.push(this._createFBO())),R!==void 0&&(f.proxyCachedFBO[I.key]={},f.proxyCachedFBO[I.key][C.start]=R,f.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,g,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,C=E.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=f.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):Pn.disabled}_renderTileClippingMasks(a,f){const g=this.painter,b=this.painter.context,E=b.gl;g._tileClippingMaskIDs={},b.setColorMode(Nn.disabled),b.setDepthMode(cn.disabled);const C=g.getOrCreateProgram("clippingMask");for(const I of a){const R=g._tileClippingMaskIDs[I.key]=--f;C.draw(g,E.TRIANGLES,cn.disabled,new Pn({func:E.ALWAYS,mask:0},R,255,E.KEEP,E.KEEP,E.REPLACE),Nn.disabled,En.disabled,Sg(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const g=[a.x,a.y,1,1];s.aC(g,g,f.pixelMatrixInverse),s.cK(g,g,1/g[3]),g[0]/=f.worldSize,g[1]/=f.worldSize;const b=f._camera.position,E=s.cf(1,f.center.lat),C=[b[0],b[1],b[2]/E,0],I=s.da([],g.slice(0,3),C);s.aw(I,I);const R=this.raycast(C,I,this._exaggeration);return R!==null&&R?(s.bH(C,C,I,R),C[3]=C[2],C[2]*=E,C):null}_setupProxiedCoordsForOrtho(a,f,g){if(a.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(a,f,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords;for(let R=0;R<E.length;R++){const L=E[R],B=this._findTileCoveringTileID(L,a);if(B){const V=this._createProxiedId(L,B,g[L.key]&&g[L.key][a.id]);b.push(V),this.proxyToSource[L.key][a.id]=[V]}}let C=!1;const I=new Set;for(let R=0;R<f.length;R++){const L=a.getTile(f[R]);if(!L||!L.hasData())continue;const B=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==L.tileID.canonical.z){const V=this.proxyToSource[B.tileID.key][a.id],j=this._createProxiedId(B.tileID,L,g[B.tileID.key]&&g[B.tileID.key][a.id]);V?V.splice(V.length-1,0,j):this.proxyToSource[B.tileID.key][a.id]=[j];const W=this.proxyToSource[B.tileID.key][a.id];I.has(W)||I.add(W),b.push(j),C=!0}}if(this._sourceTilesOverlap[a.id]=C,C&&this._debugParams.sortTilesHiZFirst)for(const R of I)R.sort((L,B)=>B.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(a,f,g){if(!a.getSource().loaded())return;const b=this.proxiedCoords[a.id]=[],E=this.proxyCoords,C=a.getSource(),I=C.tileID;if(!I)return;const R=new s.P(I.x,I.y)._div(1<<I.z),L=C.coordinates.map(s.ae.fromLngLat).reduce((V,j)=>(V.min.x=Math.min(V.min.x,j.x-R.x),V.min.y=Math.min(V.min.y,j.y-R.y),V.max.x=Math.max(V.max.x,j.x-R.x),V.max.y=Math.max(V.max.y,j.y-R.y),V),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(V,j)=>{const W=V.wrap+V.canonical.x/(1<<V.canonical.z),Y=V.canonical.y/(1<<V.canonical.z),Z=s.al/(1<<V.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),ie=j.canonical.y/(1<<j.canonical.z);return W+Z<J+L.min.x||W>J+L.max.x||Y+Z<ie+L.min.y||Y>ie+L.max.y};for(let V=0;V<E.length;V++){const j=E[V];for(let W=0;W<f.length;W++){const Y=a.getTile(f[W]);if(!Y||!Y.hasData()||B(j,Y.tileID))continue;const Z=this._createProxiedId(j,Y,g[j.key]&&g[j.key][a.id]),J=this.proxyToSource[j.key][a.id];J?J.push(Z):this.proxyToSource[j.key][a.id]=[Z],b.push(Z)}}}_createProxiedId(a,f,g){let b=this.orthoMatrix;if(g){const E=g.find(C=>C.key===f.tileID.key);if(E)return E}if(f.tileID.key!==a.key){const E=a.canonical.z-f.tileID.canonical.z;let C,I,R;b=s.bC();const L=f.tileID.wrap-a.wrap<<a.overscaledZ;E>0?(C=s.al>>E,I=C*((f.tileID.canonical.x<<E)-a.canonical.x+L),R=C*((f.tileID.canonical.y<<E)-a.canonical.y)):(C=s.al<<-E,I=s.al*(f.tileID.canonical.x-(a.canonical.x+L<<-E)),R=s.al*(f.tileID.canonical.y-(a.canonical.y<<-E))),s.ce(b,0,C,0,C,0,1),s.br(b,b,[I,R,0])}return new Sb(f.tileID,a.key,b)}_findTileCoveringTileID(a,f){let g=f.getTile(a);if(g&&g.hasData())return g;const b=this._findCoveringTileCache[f.id],E=b[a.key];if(g=E?f.getTileByID(E):null,g&&g.hasData()||E===null)return g;let C=g?g.tileID:a,I=C.overscaledZ;const R=f.getSource().minzoom,L=[];if(!E){const V=f.getSource().maxzoom;if(a.canonical.z>=V){const j=a.canonical.z-V;f.getSource().reparseOverscaled?(I=Math.max(a.canonical.z+2,f.transform.tileZoom),C=new s.aQ(I,a.wrap,V,a.canonical.x>>j,a.canonical.y>>j)):j!==0&&(I=V,C=new s.aQ(I,a.wrap,V,a.canonical.x>>j,a.canonical.y>>j))}C.key!==a.key&&(L.push(C.key),g=f.getTile(C))}const B=V=>{L.forEach(j=>{b[j]=V}),L.length=0};for(I-=1;I>=R&&(!g||!g.hasData());I--){g&&B(g.tileID.key);const V=C.calculateScaledKey(I);if(g=f.getTileByID(V),g&&g.hasData())break;const j=b[V];if(j===null)break;j===void 0?L.push(V):g=f.getTileByID(j)}return B(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[f.key]=!0}}function yp(m,a,f){const g=function(I,R,L){const B=s.bJ(R,I),V=s.bJ(L,[.2126,.7152,.0722]),j=(Y,Z,J)=>(1-J)*Y+J*Z,W=j(1-.3*Math.min(V,1),1,Math.min(B+1,1));return j(.92,1,Math.asin(s.aA(R[2],-1,1))/Math.PI+.5)*W}(m,[0,0,1],a),b=[0,0,0];s.c5(b,f.slice(0,3),g);const E=[0,0,0];s.c5(E,a.slice(0,3),m[2]);const C=[0,0,0];return s.d8(C,b,E),s.db(C)}const GI=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],qI=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class $3{static cacheKey(a,f,g,b){const E=[f];b&&E.push(b.cacheKey);for(const C of g)a.usedDefines.has(C)&&E.push(C);return E.join("/")}constructor(a,f,g,b,E,C){const I=a.gl;this.program=I.createProgram(),this.configuration=b,this.name=f,this.fixedDefines=[...C];const R=`#version 300 es
${(b?b.defines():[]).concat(C.map(Z=>`#define ${Z}`)).join(`
`)}`,L=[R,BI];for(const Z of g.fragmentIncludes)L.push(Bd[Z]);L.push(g.fragmentSource);const B=L.join(`
`),V=[R,P3];for(const Z of g.vertexIncludes)V.push(Bd[Z]);this.forceManualRenderingForInstanceIDShaders=a.forceManualRenderingForInstanceIDShaders&&g.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&V.push("uniform int u_instanceID;"),V.push(g.vertexSource);let j=V.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const W=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(W,B),I.compileShader(W),I.attachShader(this.program,W);const Y=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(Y,j),I.compileShader(Y),I.attachShader(this.program,Y),this.attributes={},I.linkProgram(this.program),I.deleteShader(Y),I.deleteShader(W),this.fixedUniforms=E(a),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=b?b.getUniforms(a):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Z=>({u_instanceID:new s.ch(Z)}))(a)),(C.includes("TERRAIN")||f.includes("symbol")||f.includes("circle"))&&(this.terrainUniforms=(Z=>({u_dem:new s.ch(Z),u_dem_prev:new s.ch(Z),u_dem_tl:new s.ck(Z),u_dem_scale:new s.cj(Z),u_dem_tl_prev:new s.ck(Z),u_dem_scale_prev:new s.cj(Z),u_dem_size:new s.cj(Z),u_dem_lerp:new s.cj(Z),u_exaggeration:new s.cj(Z),u_depth:new s.ch(Z),u_depth_size_inv:new s.ck(Z),u_depth_range_unpack:new s.ck(Z),u_occluder_half_size:new s.cj(Z),u_occlusion_depth_offset:new s.cj(Z),u_meter_to_dem:new s.cj(Z),u_label_plane_matrix_inv:new s.cl(Z)}))(a)),C.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new s.ci(Z),u_tile_tr_up:new s.ci(Z),u_tile_br_up:new s.ci(Z),u_tile_bl_up:new s.ci(Z),u_tile_up_scale:new s.cj(Z)}))(a)),C.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new s.cl(Z),u_fog_range:new s.ck(Z),u_fog_color:new s.d3(Z),u_fog_horizon_blend:new s.cj(Z),u_fog_vertical_limit:new s.ck(Z),u_fog_temporal_offset:new s.cj(Z),u_frustum_tl:new s.ci(Z),u_frustum_tr:new s.ci(Z),u_frustum_br:new s.ci(Z),u_frustum_bl:new s.ci(Z),u_globe_pos:new s.ci(Z),u_globe_radius:new s.cj(Z),u_globe_transition:new s.cj(Z),u_is_globe:new s.ch(Z),u_viewport:new s.ck(Z)}))(a)),C.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new s.d3(Z)}))(a)),C.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new s.ci(Z),u_lighting_directional_dir:new s.ci(Z),u_lighting_directional_color:new s.ci(Z),u_ground_radiance:new s.ci(Z)}))(a)),C.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new s.cl(Z),u_light_matrix_1:new s.cl(Z),u_fade_range:new s.ck(Z),u_shadow_normal_offset:new s.ci(Z),u_shadow_intensity:new s.cj(Z),u_shadow_texel_size:new s.cj(Z),u_shadow_map_resolution:new s.cj(Z),u_shadow_direction:new s.ci(Z),u_shadow_bias:new s.ci(Z),u_shadowmap_0:new s.ch(Z),u_shadowmap_1:new s.ch(Z)}))(a)))}getAttributeLocation(a,f){let g=this.attributes[f];return g===void 0&&(g=this.attributes[f]=a.getAttribLocation(this.program,f)),g}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)g[b]&&g[b].set(this.program,b,f[b])}}setGlobeUniformValues(a,f){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)g[b]&&g[b].set(this.program,b,f[b])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)g[b].set(this.program,b,f[b])}}setCutoffUniformValues(a,f){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)g[b].set(this.program,b,f[b])}}setLightsUniformValues(a,f){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const b in f)g[b].set(this.program,b,f[b])}}setShadowUniformValues(a,f){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;a.program.set(this.program);for(const b in f)g[b].set(this.program,b,f[b])}_drawDebugWireframe(a,f,g,b,E,C,I,R,L,B){const V=a.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const j=a.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||a._terrain&&a._terrain.renderingToTexture||!GI.includes(this.name))||!(!V.layers3D||!qI.includes(this.name))))return;const W=j.gl,Y=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,E,j);if(!Y)return;const Z=[...this.fixedDefines,"DEBUG_WIREFRAME"],J=a.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});j.program.set(J.program);const ie=(ce,Re,Ce)=>{if(Re[ce]&&Ce[ce])for(const Se in Re[ce])Ce[ce][Se]&&Ce[ce][Se].set(Ce.program,Se,Re[ce][Se].current)};L&&L.setUniforms(J.program,j,J.binderUniforms,I,{zoom:R}),ie("fixedUniforms",this,J),ie("terrainUniforms",this,J),ie("globeUniforms",this,J),ie("fogUniforms",this,J),ie("lightsUniforms",this,J),ie("shadowUniforms",this,J),Y.bind(),j.setColorMode(new Nn([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],s.ao.transparent,[!0,!0,!0,!1])),j.setDepthMode(new cn(f.func===W.LESS?W.LEQUAL:f.func,cn.ReadOnly,f.range)),j.setStencilMode(Pn.disabled);const pe=3*C.primitiveLength*2,fe=3*C.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=B||1;for(let Re=0;Re<ce;++Re)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Re),W.drawElements(W.LINES,pe,W.UNSIGNED_SHORT,fe)}else B&&B>1?W.drawElementsInstanced(W.LINES,pe,W.UNSIGNED_SHORT,fe,B):W.drawElements(W.LINES,pe,W.UNSIGNED_SHORT,fe);E.bind(),j.program.set(this.program),j.setDepthMode(f),j.setStencilMode(g),j.setColorMode(b)}checkUniforms(a,f,g){if(this.fixedDefines.includes(f)){for(const b of Object.keys(g))if(!g[b].initialized)throw new Error(`Program '${this.name}', from draw '${a}': uniform ${b} not set but required by ${f} being defined`)}}draw(a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J){const ie=a.context,pe=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(g),ie.setStencilMode(b),ie.setColorMode(E),ie.setCullFace(C);for(const[be,ye]of this.fixedUniformsEntries)ye.set(this.program,be,I[be]);Y&&Y.setUniforms(this.program,ie,this.binderUniforms,j,{zoom:W});const fe={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[f];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const ce=Z||[],Re=Y?Y.getPaintVertexBuffers():[],Ce=f===pe.TRIANGLES&&B,Se=J&&J>0?1:void 0;for(const be of V.get()){const ye=be.vaos||(be.vaos={});if((ye[R]||(ye[R]=new FI)).bind(ie,this,L,Re,B,be.vertexOffset,ce,Se),this.forceManualRenderingForInstanceIDShaders){const Ne=J||1;for(let We=0;We<Ne;++We)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",We),B?pe.drawElements(f,be.primitiveLength*fe,pe.UNSIGNED_SHORT,be.primitiveOffset*fe*2):pe.drawArrays(f,be.vertexOffset,be.vertexLength)}else J&&J>1?pe.drawElementsInstanced(f,be.primitiveLength*fe,pe.UNSIGNED_SHORT,be.primitiveOffset*fe*2,J):B?pe.drawElements(f,be.primitiveLength*fe,pe.UNSIGNED_SHORT,be.primitiveOffset*fe*2):pe.drawArrays(f,be.vertexOffset,be.vertexLength);Ce&&this._drawDebugWireframe(a,g,b,E,B,be,j,W,Y,J)}}}function z3(m,a,f=0){const g=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,m.transform.tileZoom)/g,E=b*(a.tileID.canonical.x+a.tileID.wrap*g),C=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(a,1,m.transform.tileZoom),u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C],u_pattern_transition:f}}const f_={terrain:0,flat:1},ZI=s.bC(),p_=(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie)=>{const pe=a.style.light,fe=pe.properties.get("position"),ce=[fe.x,fe.y,fe.z],Re=s.dO();pe.properties.get("anchor")==="viewport"&&(s.dP(Re,-a.transform.angle),s.dQ(ce,ce,Re));const Ce=pe.properties.get("color").toPremultipliedRenderColor(null),Se=a.transform,be={u_matrix:m,u_lightpos:ce,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+f,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ZI,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:f_[L],u_base_type:f_[B],u_ao:b,u_edge_radius:E,u_width_scale:C,u_flood_light_color:Y,u_vertical_scale:Z,u_flood_light_intensity:J,u_ground_shadow_factor:ie};return Se.projection.name==="globe"&&(be.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],be.u_zoom_transition=V,be.u_inv_rot_matrix=W,be.u_merc_center=j,be.u_up_dir=Se.projection.upVector(new s.cD(0,0,0),j[0]*s.al,j[1]*s.al),be.u_height_lift=R),be},Pb=(m,a,f,g,b,E)=>({u_matrix:m,u_edge_radius:a,u_width_scale:f,u_vertical_scale:g,u_height_type:f_[b],u_base_type:f_[E]}),U3=(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie)=>{const pe=p_(m,a,f,g,b,E,C,I,L,B,V,j,W,Y,Z,J,1,[0,0,0]),fe={u_height_factor:-Math.pow(2,I.overscaledZ)/R.tileSize/8};return Object.assign(pe,z3(a,R,ie),fe)},qh=(m,a,f)=>({u_matrix:m,u_emissive_strength:a,u_ground_shadow_factor:f}),Rb=(m,a,f,g,b,E=0)=>Object.assign(qh(m,a,b),z3(f,g,E)),j3=(m,a,f,g)=>({u_matrix:m,u_world:f,u_emissive_strength:a,u_ground_shadow_factor:g}),V3=(m,a,f,g,b,E,C=0)=>Object.assign(Rb(m,a,f,g,E,C),{u_world:b}),Ob=(m,a)=>({u_matrix:m,u_depth_bias:a}),$d=(m,a)=>({u_matrix:m,u_ground_shadow_factor:a}),Zh=(m,a,f,g,b)=>({u_matrix:m,u_camera_pos:[a[0],a[1],a[2]],u_depth_bias:f,u_height_scale:g,u_reset_depth:b}),m_=(m,a,f,g,b,E,C,I,R)=>({u_matrix:m,u_normal_matrix:a,u_opacity:f,u_faux_facade_ao_intensity:g,u_camera_pos:b,u_tile_to_meter:E,u_facade_emissive_chance:C,u_flood_light_color:I,u_flood_light_intensity:R}),W3=m=>({u_matrix:m}),zd=m=>({u_matrix:m}),kb=(m,a,f,g,b,E,C,I)=>{const R=s.al/E.tileSize;return{u_matrix:m,u_inv_rot_matrix:a,u_camera_to_center_distance:f.getCameraToCenterDistance(I),u_extrude_scale:[f.pixelsToGLUnits[0]/R,f.pixelsToGLUnits[1]/R],u_zoom_transition:g,u_tile_id:C,u_merc_center:b}},g_=(m,a,f,g)=>({u_matrix:m,u_inv_matrix:a,u_camera_to_center_distance:f.getCameraToCenterDistance(g),u_viewport_size:[f.width,f.height]}),Db=(m,a,f=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:f}),H3=s.bC(),Nb=(m,a,f,g,b,E,C)=>{const I=m.transform,R=I.projection.name==="globe",L=R?s.dR(I.zoom,a.canonical)*I._pixelsPerMercatorPixel:s.ay(f,1,E),B={u_matrix:a.projMatrix,u_extrude_scale:L,u_intensity:C,u_inv_rot_matrix:H3,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){B.u_inv_rot_matrix=g,B.u_merc_center=b,B.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],B.u_zoom_transition=s.aj(I.zoom);const V=b[0]*s.al,j=b[1]*s.al;B.u_up_dir=I.projection.upVector(new s.cD(0,0,0),V,j)}return B};function y_(m,[a,f,g,b],[E,C]){if(E===C)return[0,0,0,0];const I=255*(m-1)/(m*(C-E));return[a*I,f*I,g*I,b*I]}function G3(m,a,[f,g]){return f===g?0:.5/m+(a-f)*(m-1)/(m*(g-f))}const Mb=(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie,pe,fe,ce)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:f,u_merc_matrix:g,u_grid_matrix:b,u_tl_parent:E,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(V.paint.get("raster-saturation")),u_contrast_factor:s.dS(V.paint.get("raster-contrast")),u_spin_weights:Pg(V.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:W,u_zoom_transition:C,u_merc_center:I,u_cutoff_params:R,u_colorization_mix:y_(s.dU,Z,ie),u_colorization_offset:G3(s.dU,J,ie),u_color_ramp:Y,u_texture_offset:[fe/(pe+2*fe),pe/(pe+2*fe)],u_texture_res:[pe+2*fe,pe+2*fe],u_emissive_strength:ce});function Pg(m){m*=Math.PI/180;const a=Math.sin(m),f=Math.cos(m);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const _p=.05,KI=(m,a,f,g,b,E,C,I,R,L,B,V)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:f,u_merc_matrix:g,u_grid_matrix:b,u_tl_parent:E,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:C,u_merc_center:I,u_cutoff_params:R}),q3=(m,a,f,g,b,E,C,I,R,L)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_tile_offset:f,u_velocity:g,u_color_ramp:E,u_velocity_res:b,u_max_speed:C,u_uv_offset:I,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[_p,_p]}),YI=(m,a,f,g,b,E,C,I,R,L)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_velocity:f,u_velocity_res:g,u_max_speed:b,u_speed_factor:E,u_reset_rate:C,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[_p,_p]}),__=s.bC(),Rg=(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie,pe,fe,ce,Re,Ce,Se)=>{const be=b.transform,ye={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(pe),u_rotate_symbol:+f,u_aspect_ratio:be.width/be.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:C,u_coord_matrix:I,u_is_text:+L,u_elevation_from_sea:R?1:0,u_pitch_with_map:+g,u_texsize:B,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:__,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:__,u_up_vector:[0,-1,0],u_color_adj_mat:Re,u_icon_transition:Ce||0,u_gamma_scale:g?b.transform.getCameraToCenterDistance(pe)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Se||1,u_ground_shadow_factor:fe,u_inv_matrix:s.bl(s.bC(),C),u_normal_scale:ce,u_lutTexture:10};return pe.name==="globe"&&(ye.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],ye.u_zoom_transition=Y,ye.u_inv_rot_matrix=J,ye.u_merc_center=Z,ye.u_camera_forward=be._camera.forward(),ye.u_ecef_origin=s.dV(be.globeMatrix,W.toUnwrapped()),ye.u_tile_matrix=Float32Array.from(be.globeMatrix),ye.u_up_vector=ie),ye},Ud=(m,a,f,g)=>({u_matrix:m,u_emissive_strength:a,u_opacity:f,u_color:g}),Og=(m,a,f,g,b,E,C,I,R)=>Object.assign(function(L,B,V,j,W,Y){const{width:Z,height:J}=j.imageManager.getPixelSize(B),ie=Math.pow(2,Y.tileID.overscaledZ),pe=Y.tileSize*Math.pow(2,j.transform.tileZoom)/ie,fe=pe*(Y.tileID.canonical.x+Y.tileID.wrap*ie),ce=pe*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[Z,J],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:W?[j.transform.width,-1*j.transform.height]:[1/s.ay(Y,1,j.transform.tileZoom),1/s.ay(Y,1,j.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,ce>>16],u_pixel_coord_lower:[65535&fe,65535&ce]}}(0,E,C,g,I,R),{u_matrix:m,u_emissive_strength:a,u_opacity:f}),Kh=new Float32Array(s.bA([])),w_=(m,a,f,g,b,E,C,I,R,L,B,V,j,W=[0,0,0],Y,Z,J)=>{const ie=b.style.light,pe=ie.properties.get("position"),fe=[-pe.x,-pe.y,pe.z],ce=s.dO();ie.properties.get("anchor")==="viewport"&&(s.dP(ce,-b.transform.angle),s.dQ(fe,fe,ce));const Re=B.alphaMode==="MASK",Ce=ie.properties.get("color").toNonPremultipliedRenderColor(null),Se=j.paint.get("model-ambient-occlusion-intensity"),be=j.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return be.a=j.paint.get("model-color-mix-intensity").constantOr(0),J&&(be.r=J[0],be.g=J[1],be.b=J[2],be.a=J[3]),Z&&(be.r=Z.color.r,be.g=Z.color.g,be.b=Z.color.b,be.a=Z.colorMix,V=Z.emissionStrength,E*=Z.opacity),{u_matrix:m,u_lighting_matrix:a,u_normal_matrix:f,u_node_matrix:g||Kh,u_lightpos:fe,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_camera_pos:W,u_opacity:E,u_baseTextureIsAlpha:0,u_alphaMask:+Re,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:L,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:be.toArray01(),u_aoIntensity:Se,u_emissive_strength:V,u_occlusionTextureTransform:Y||[0,0,0,0]}},kg=(m,a=Kh,f=Kh)=>({u_matrix:m,u_instance:a,u_node_matrix:f}),b_={fillExtrusion:m=>({u_matrix:new s.cl(m),u_lightpos:new s.ci(m),u_lightintensity:new s.cj(m),u_lightcolor:new s.ci(m),u_vertical_gradient:new s.cj(m),u_opacity:new s.cj(m),u_edge_radius:new s.cj(m),u_width_scale:new s.cj(m),u_ao:new s.ck(m),u_height_type:new s.ch(m),u_base_type:new s.ch(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_up_dir:new s.ci(m),u_height_lift:new s.cj(m),u_flood_light_color:new s.ci(m),u_vertical_scale:new s.cj(m),u_flood_light_intensity:new s.cj(m),u_ground_shadow_factor:new s.ci(m)}),fillExtrusionDepth:m=>({u_matrix:new s.cl(m),u_edge_radius:new s.cj(m),u_width_scale:new s.cj(m),u_vertical_scale:new s.cj(m),u_height_type:new s.ch(m),u_base_type:new s.ch(m)}),fillExtrusionPattern:m=>({u_matrix:new s.cl(m),u_lightpos:new s.ci(m),u_lightintensity:new s.cj(m),u_lightcolor:new s.ci(m),u_vertical_gradient:new s.cj(m),u_height_factor:new s.cj(m),u_edge_radius:new s.cj(m),u_width_scale:new s.cj(m),u_ao:new s.ck(m),u_height_type:new s.ch(m),u_base_type:new s.ch(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_up_dir:new s.ci(m),u_height_lift:new s.cj(m),u_image:new s.ch(m),u_texsize:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_tile_units_to_pixels:new s.cj(m),u_opacity:new s.cj(m),u_pattern_transition:new s.cj(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new s.cl(m),u_opacity:new s.cj(m),u_ao_pass:new s.cj(m),u_meter_to_tile:new s.cj(m),u_ao:new s.ck(m),u_flood_light_intensity:new s.cj(m),u_flood_light_color:new s.ci(m),u_attenuation:new s.cj(m),u_edge_radius:new s.cj(m),u_fb:new s.ch(m),u_fb_size:new s.cj(m),u_dynamic_offset:new s.cj(m)}),fill:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_ground_shadow_factor:new s.ci(m)}),fillPattern:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_image:new s.ch(m),u_texsize:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_tile_units_to_pixels:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_pattern_transition:new s.cj(m)}),fillOutline:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_world:new s.ck(m),u_ground_shadow_factor:new s.ci(m)}),fillOutlinePattern:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_world:new s.ck(m),u_image:new s.ch(m),u_texsize:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_tile_units_to_pixels:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_pattern_transition:new s.cj(m)}),building:m=>({u_matrix:new s.cl(m),u_normal_matrix:new s.cl(m),u_opacity:new s.cj(m),u_faux_facade_ao_intensity:new s.cj(m),u_camera_pos:new s.ci(m),u_tile_to_meter:new s.cj(m),u_facade_emissive_chance:new s.cj(m),u_flood_light_color:new s.ci(m),u_flood_light_intensity:new s.cj(m)}),buildingBloom:m=>({u_matrix:new s.cl(m)}),buildingDepth:m=>({u_matrix:new s.cl(m)}),elevatedStructuresDepth:m=>({u_matrix:new s.cl(m),u_depth_bias:new s.cj(m)}),elevatedStructures:m=>({u_matrix:new s.cl(m),u_ground_shadow_factor:new s.ci(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new s.cl(m),u_camera_pos:new s.ci(m),u_depth_bias:new s.cj(m),u_height_scale:new s.cj(m),u_reset_depth:new s.cj(m)}),circle:s.dY,collisionBox:m=>({u_matrix:new s.cl(m),u_inv_rot_matrix:new s.cl(m),u_camera_to_center_distance:new s.cj(m),u_extrude_scale:new s.ck(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_tile_id:new s.ci(m)}),collisionCircle:m=>({u_matrix:new s.cl(m),u_inv_matrix:new s.cl(m),u_camera_to_center_distance:new s.cj(m),u_viewport_size:new s.ck(m)}),debug:m=>({u_color:new s.dB(m),u_matrix:new s.cl(m),u_overlay:new s.ch(m),u_overlay_scale:new s.cj(m)}),clippingMask:m=>({u_matrix:new s.cl(m)}),heatmap:m=>({u_extrude_scale:new s.cj(m),u_intensity:new s.cj(m),u_matrix:new s.cl(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_up_dir:new s.ci(m)}),heatmapTexture:m=>({u_image:new s.ch(m),u_color_ramp:new s.ch(m),u_opacity:new s.cj(m)}),hillshade:m=>({u_matrix:new s.cl(m),u_image:new s.ch(m),u_latrange:new s.ck(m),u_light:new s.ck(m),u_shadow:new s.dB(m),u_highlight:new s.dB(m),u_emissive_strength:new s.cj(m),u_accent:new s.dB(m)}),hillshadePrepare:m=>({u_matrix:new s.cl(m),u_image:new s.ch(m),u_dimension:new s.ck(m),u_zoom:new s.cj(m)}),line:s.dX,linePattern:s.dW,raster:m=>({u_matrix:new s.cl(m),u_normalize_matrix:new s.cl(m),u_globe_matrix:new s.cl(m),u_merc_matrix:new s.cl(m),u_grid_matrix:new s.dC(m),u_tl_parent:new s.ck(m),u_scale_parent:new s.cj(m),u_fade_t:new s.cj(m),u_opacity:new s.cj(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_brightness_low:new s.cj(m),u_brightness_high:new s.cj(m),u_saturation_factor:new s.cj(m),u_contrast_factor:new s.cj(m),u_spin_weights:new s.ci(m),u_perspective_transform:new s.ck(m),u_raster_elevation:new s.cj(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_cutoff_params:new s.d3(m),u_colorization_mix:new s.d3(m),u_colorization_offset:new s.cj(m),u_color_ramp:new s.ch(m),u_texture_offset:new s.ck(m),u_texture_res:new s.ck(m),u_emissive_strength:new s.cj(m)}),rasterParticle:m=>({u_matrix:new s.cl(m),u_normalize_matrix:new s.cl(m),u_globe_matrix:new s.cl(m),u_merc_matrix:new s.cl(m),u_grid_matrix:new s.dC(m),u_tl_parent:new s.ck(m),u_scale_parent:new s.cj(m),u_fade_t:new s.cj(m),u_opacity:new s.cj(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_raster_elevation:new s.cj(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_cutoff_params:new s.d3(m)}),rasterParticleTexture:m=>({u_texture:new s.ch(m),u_opacity:new s.cj(m)}),rasterParticleDraw:m=>({u_particle_texture:new s.ch(m),u_particle_texture_side_len:new s.cj(m),u_tile_offset:new s.ck(m),u_velocity:new s.ch(m),u_color_ramp:new s.ch(m),u_velocity_res:new s.ck(m),u_max_speed:new s.cj(m),u_uv_offset:new s.ck(m),u_data_scale:new s.ck(m),u_data_offset:new s.cj(m),u_particle_pos_scale:new s.cj(m),u_particle_pos_offset:new s.ck(m)}),rasterParticleUpdate:m=>({u_particle_texture:new s.ch(m),u_particle_texture_side_len:new s.cj(m),u_velocity:new s.ch(m),u_velocity_res:new s.ck(m),u_max_speed:new s.cj(m),u_speed_factor:new s.cj(m),u_reset_rate:new s.cj(m),u_rand_seed:new s.cj(m),u_uv_offset:new s.ck(m),u_data_scale:new s.ck(m),u_data_offset:new s.cj(m),u_particle_pos_scale:new s.cj(m),u_particle_pos_offset:new s.ck(m)}),symbol:m=>({u_is_size_zoom_constant:new s.ch(m),u_is_size_feature_constant:new s.ch(m),u_size_t:new s.cj(m),u_size:new s.cj(m),u_camera_to_center_distance:new s.cj(m),u_rotate_symbol:new s.ch(m),u_aspect_ratio:new s.cj(m),u_fade_change:new s.cj(m),u_matrix:new s.cl(m),u_label_plane_matrix:new s.cl(m),u_coord_matrix:new s.cl(m),u_is_text:new s.ch(m),u_elevation_from_sea:new s.ch(m),u_pitch_with_map:new s.ch(m),u_texsize:new s.ck(m),u_texsize_icon:new s.ck(m),u_texture:new s.ch(m),u_texture_icon:new s.ch(m),u_gamma_scale:new s.cj(m),u_device_pixel_ratio:new s.cj(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_camera_forward:new s.ci(m),u_tile_matrix:new s.cl(m),u_up_vector:new s.ci(m),u_ecef_origin:new s.ci(m),u_is_halo:new s.ch(m),u_icon_transition:new s.cj(m),u_color_adj_mat:new s.cl(m),u_scale_factor:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_inv_matrix:new s.cl(m),u_normal_scale:new s.cj(m),u_lutTexture:new s.ch(m)}),background:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_opacity:new s.cj(m),u_color:new s.dB(m)}),backgroundPattern:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_opacity:new s.cj(m),u_image:new s.ch(m),u_pattern_tl:new s.ck(m),u_pattern_br:new s.ck(m),u_texsize:new s.ck(m),u_pattern_size:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_pattern_units_to_pixels:new s.ck(m)}),terrainRaster:m=>({u_matrix:new s.cl(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_skirt_height:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_emissive_texture_available:new s.cj(m)}),skybox:m=>({u_matrix:new s.cl(m),u_sun_direction:new s.ci(m),u_cubemap:new s.ch(m),u_opacity:new s.cj(m),u_temporal_offset:new s.cj(m)}),skyboxGradient:m=>({u_matrix:new s.cl(m),u_color_ramp:new s.ch(m),u_center_direction:new s.ci(m),u_radius:new s.cj(m),u_opacity:new s.cj(m),u_temporal_offset:new s.cj(m)}),skyboxCapture:m=>({u_matrix_3f:new s.dC(m),u_sun_direction:new s.ci(m),u_sun_intensity:new s.cj(m),u_color_tint_r:new s.d3(m),u_color_tint_m:new s.d3(m),u_luminance:new s.cj(m)}),globeRaster:m=>({u_proj_matrix:new s.cl(m),u_globe_matrix:new s.cl(m),u_normalize_matrix:new s.cl(m),u_merc_matrix:new s.cl(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_grid_matrix:new s.dC(m),u_skirt_height:new s.cj(m),u_far_z_cutoff:new s.cj(m),u_frustum_tl:new s.ci(m),u_frustum_tr:new s.ci(m),u_frustum_br:new s.ci(m),u_frustum_bl:new s.ci(m),u_globe_pos:new s.ci(m),u_globe_radius:new s.cj(m),u_viewport:new s.ck(m),u_emissive_texture_available:new s.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.ci(m),u_frustum_tr:new s.ci(m),u_frustum_br:new s.ci(m),u_frustum_bl:new s.ci(m),u_horizon:new s.cj(m),u_transition:new s.cj(m),u_fadeout_range:new s.cj(m),u_atmosphere_fog_color:new s.d3(m),u_high_color:new s.d3(m),u_space_color:new s.d3(m),u_temporal_offset:new s.cj(m),u_horizon_angle:new s.cj(m)}),model:m=>({u_matrix:new s.cl(m),u_lighting_matrix:new s.cl(m),u_normal_matrix:new s.cl(m),u_node_matrix:new s.cl(m),u_lightpos:new s.ci(m),u_lightintensity:new s.cj(m),u_lightcolor:new s.ci(m),u_camera_pos:new s.ci(m),u_opacity:new s.cj(m),u_baseColorFactor:new s.d3(m),u_emissiveFactor:new s.d3(m),u_metallicFactor:new s.cj(m),u_roughnessFactor:new s.cj(m),u_baseTextureIsAlpha:new s.ch(m),u_alphaMask:new s.ch(m),u_alphaCutoff:new s.cj(m),u_baseColorTexture:new s.ch(m),u_metallicRoughnessTexture:new s.ch(m),u_normalTexture:new s.ch(m),u_occlusionTexture:new s.ch(m),u_emissionTexture:new s.ch(m),u_lutTexture:new s.ch(m),u_color_mix:new s.d3(m),u_aoIntensity:new s.cj(m),u_emissive_strength:new s.cj(m),u_occlusionTextureTransform:new s.d3(m)}),modelDepth:m=>({u_matrix:new s.cl(m),u_instance:new s.cl(m),u_node_matrix:new s.cl(m)}),groundShadow:m=>({u_matrix:new s.cl(m),u_ground_shadow_factor:new s.ci(m)}),stars:m=>({u_matrix:new s.cl(m),u_up:new s.ci(m),u_right:new s.ci(m),u_intensity_multiplier:new s.cj(m)}),snowParticle:m=>({u_modelview:new s.cl(m),u_projection:new s.cl(m),u_time:new s.cj(m),u_cam_pos:new s.ci(m),u_velocityConeAperture:new s.cj(m),u_velocity:new s.cj(m),u_horizontalOscillationRadius:new s.cj(m),u_horizontalOscillationRate:new s.cj(m),u_boxSize:new s.cj(m),u_billboardSize:new s.cj(m),u_simpleShapeParameters:new s.ck(m),u_screenSize:new s.ck(m),u_thinningCenterPos:new s.ck(m),u_thinningShape:new s.ci(m),u_thinningAffectedRatio:new s.cj(m),u_thinningParticleOffset:new s.cj(m),u_particleColor:new s.d3(m),u_direction:new s.ci(m)}),rainParticle:m=>({u_modelview:new s.cl(m),u_projection:new s.cl(m),u_time:new s.cj(m),u_cam_pos:new s.ci(m),u_texScreen:new s.ch(m),u_velocityConeAperture:new s.cj(m),u_velocity:new s.cj(m),u_boxSize:new s.cj(m),u_rainDropletSize:new s.ck(m),u_distortionStrength:new s.cj(m),u_rainDirection:new s.ci(m),u_color:new s.d3(m),u_screenSize:new s.ck(m),u_thinningCenterPos:new s.ck(m),u_thinningShape:new s.ci(m),u_thinningAffectedRatio:new s.cj(m),u_thinningParticleOffset:new s.cj(m),u_shapeDirectionalPower:new s.cj(m),u_shapeNormalPower:new s.cj(m),u_mode:new s.cj(m)}),vignette:m=>({u_vignetteShape:new s.ci(m),u_vignetteColor:new s.d3(m)}),occlusion:m=>({u_matrix:new s.cl(m),u_anchorPos:new s.ci(m),u_screenSizePx:new s.ck(m),u_occluderSizePx:new s.ck(m),u_color:new s.d3(m)})};class nu{constructor(a,f,g,b){this.id=nu.uniqueIdxCounter,nu.uniqueIdxCounter++,this.context=a;const E=a.gl;this.buffer=E.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||b||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=nu.uniqueIdxCounter,nu.uniqueIdxCounter++;const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}nu.uniqueIdxCounter=0;const Z3={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class XI{constructor(a,f,g,b,E,C){this.length=f.length,this.attributes=g,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.instanceCount=C,this.context=a;const I=a.gl;this.buffer=I.createBuffer(),a.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||E||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let g=0;g<this.attributes.length;g++){const b=f.getAttributeLocation(a,this.attributes[g].name);b!==-1&&a.enableVertexAttribArray(b)}}setVertexAttribPointers(a,f,g){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],C=f.getAttributeLocation(a,E.name);C!==-1&&a.vertexAttribPointer(C,E.components,a[Z3[E.type]],!1,this.itemSize,E.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(a,f,g){for(let b=0;b<this.attributes.length;b++){const E=f.getAttributeLocation(a,this.attributes[b].name);E!==-1&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(E,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yh{constructor(a,f,g,b,E){this.context=a,this.width=f,this.height=g;const C=this.framebuffer=a.gl.createFramebuffer();b>0&&(this.colorAttachment0=new c_(a,C,0)),b>1&&(this.colorAttachment1=new c_(a,C,1)),E&&(this.depthAttachmentType=E,this.depthAttachment=E==="renderbuffer"?new mp(a,C):new Tg(a,C))}createColorAttachment(a,f){f===0?this.colorAttachment0=new c_(a,this.framebuffer,0):f===1&&(this.colorAttachment1=new c_(a,this.framebuffer,1))}removeColorAttachment(a,f){const g=this.context.gl;let b;f===0?(b=this.colorAttachment0.get(),this.colorAttachment0=void 0):f===1&&(b=this.colorAttachment1.get(),this.colorAttachment1=void 0),b&&g.deleteTexture(b)}destroy(){const a=this.context.gl;if(this.colorAttachment0){const f=this.colorAttachment0.get();f&&a.deleteTexture(f)}if(this.colorAttachment1){const f=this.colorAttachment1.get();f&&a.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&a.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&a.deleteTexture(f)}a.deleteFramebuffer(this.framebuffer)}}class v_{constructor(a,f){this.gl=a,this.clearColor=new jI(this),this.clearDepth=new R3(this),this.clearStencil=new yb(this),this.colorMask=new i_(this),this.depthMask=new _b(this),this.stencilMask=new Gh(this),this.stencilFunc=new dp(this),this.stencilOp=new Eg(this),this.stencilTest=new hp(this),this.depthRange=new O3(this),this.depthTest=new wb(this),this.depthFunc=new k3(this),this.blend=new fp(this),this.blendFunc=new r_(this),this.blendColor=new s_(this),this.blendEquation=new bb(this),this.cullFace=new o_(this),this.cullFaceSide=new Cg(this),this.frontFace=new D3(this),this.program=new N3(this),this.activeTexture=new M3(this),this.viewport=new pp(this),this.bindFramebuffer=new L3(this),this.bindRenderbuffer=new VI(this),this.bindTexture=new WI(this),this.bindVertexBuffer=new HI(this),this.bindElementBuffer=new vb(this),this.bindVertexArrayOES=new xb(this),this.pixelStoreUnpack=new Eb(this),this.pixelStoreUnpackPremultiplyAlpha=new Cb(this),this.pixelStoreUnpackFlipY=new B3(this),this.options=f?Object.assign({},f):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=f&&!!f.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=a.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f,g){return new nu(this,a,f,g)}createVertexBuffer(a,f,g,b,E){return new XI(this,a,f,g,b,E)}createRenderbuffer(a,f,g){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,a,f,g),this.bindRenderbuffer.set(null),E}createFramebuffer(a,f,g,b){return new Yh(this,a,f,g,b)}clear({color:a,depth:f,stencil:g,colorMask:b}){const E=this.gl;let C=0;a&&(C|=E.COLOR_BUFFER_BIT,this.clearColor.set(a.toNonPremultipliedRenderColor(null)),this.colorMask.set(b||[!0,!0,!0,!0])),f!==void 0&&(C|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g!==void 0&&(C|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),E.clear(C)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.by(a.blendFunction,Nn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Qt;function Lb(m,a,f,g,b,E,C){const I=m.context,R=I.gl,L=m.transform,B=[s.aF(L.center.lng),s.aJ(L.center.lat)],V=f.layout.get("symbol-placement"),j=f.layout.get("text-variable-anchor"),W=f.layout.get("icon-rotation-alignment")==="map",Y=f.layout.get("text-rotation-alignment")==="map",Z=V!=="point",J=[];let ie=0,pe=0;for(let be=0;be<g.length;be++){const ye=g[be],Ne=a.getTile(ye),We=Ne.getBucket(f);if(!We)continue;const Ze=We.getProjection().createInversionMatrix(L,ye.canonical),tt=[],Je=OI(ye,We,L),mt=!C&&W&&Z,xt=C&&Y&&Z,Xe=j&&We.hasTextData(),Me=We.hasIconTextFit()&&Xe&&We.hasIconData(),dt=mt||xt||C&&Xe||Me,nt=We.projection.name==="globe",St=nt?s.aj(L.zoom):0;nt&&(tt.push("PROJECTION_GLOBE_VIEW"),dt&&tt.push("PROJECTED_POS_ON_VIEWPORT"));const Rt=m.getOrCreateProgram("collisionBox",{defines:tt});let jt=Je;b[0]===0&&b[1]===0||(jt=m.translatePosMatrix(Je,Ne,b,E));const Ot=C?We.textCollisionBox:We.iconCollisionBox,Mt=We.collisionCircleArray;if(Mt.length>0){const tn=s.bC(),Gt=jt;s.cP(tn,We.placementInvProjMatrix,L.glCoordMatrix),s.cP(tn,tn,We.placementViewportMatrix),J.push({circleArray:Mt,circleOffset:pe,transform:Gt,invTransform:tn,projection:We.getProjection()}),ie+=Mt.length/4,pe=ie}if(!Ot)continue;m.terrain&&m.terrain.setupElevationDraw(Ne,Rt);const rn=nt?[ye.canonical.x,ye.canonical.y,1<<ye.canonical.z]:[0,0,0];Rt.draw(m,R.LINES,cn.disabled,Pn.disabled,m.colorModeForRenderPass(),En.disabled,kb(jt,Ze,L,St,B,Ne,rn,We.getProjection()),f.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,null,L.zoom,null,[Ot.collisionVertexBuffer,Ot.collisionVertexBufferExt])}if(!C||!J.length)return;const fe=m.getOrCreateProgram("collisionCircle"),ce=new s.dZ;ce.resize(4*ie),ce._trim();let Re=0;for(const be of J)for(let ye=0;ye<be.circleArray.length/4;ye++){const Ne=4*ye,We=be.circleArray[Ne+0],Ze=be.circleArray[Ne+1],tt=be.circleArray[Ne+2],Je=be.circleArray[Ne+3];ce.emplace(Re++,We,Ze,tt,Je,0),ce.emplace(Re++,We,Ze,tt,Je,1),ce.emplace(Re++,We,Ze,tt,Je,2),ce.emplace(Re++,We,Ze,tt,Je,3)}(!Qt||Qt.length<2*ie)&&(Qt=function(be){const ye=2*be,Ne=new s.b0;Ne.resize(ye),Ne._trim();for(let We=0;We<ye;We++){const Ze=6*We;Ne.uint16[Ze+0]=4*We+0,Ne.uint16[Ze+1]=4*We+1,Ne.uint16[Ze+2]=4*We+2,Ne.uint16[Ze+3]=4*We+2,Ne.uint16[Ze+4]=4*We+3,Ne.uint16[Ze+5]=4*We+0}return Ne}(ie));const Ce=I.createIndexBuffer(Qt,!0),Se=I.createVertexBuffer(ce,s.d_.members,!0);for(const be of J){const ye=g_(be.transform,be.invTransform,L,be.projection);fe.draw(m,R.TRIANGLES,cn.disabled,Pn.disabled,m.colorModeForRenderPass(),En.disabled,ye,f.id,Se,Ce,s.bg.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,L.zoom)}Se.destroy(),Ce.destroy()}const El=s.bC();function Hu(m){const a=m._camera.getWorldToCamera(m.worldSize,1),f=s.aB([],a,m.globeMatrix);s.bl(f,f);const g=[0,0,0],b=[0,1,0,0];return s.aC(b,b,f),g[0]=b[0],g[1]=b[1],g[2]=b[2],s.aw(g,g),g}function K3({width:m,height:a,anchor:f,textOffset:g,textScale:b},E){const{horizontalAlign:C,verticalAlign:I}=s.c1(f),R=-(C-.5)*m,L=-(I-.5)*a,B=s.c2(f,g);return new s.P((R/b+B[0])*E,(L/b+B[1])*E)}function Y3(m,a,f,g,b,E,C,I,R,L){const B=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,j=m.icon.dynamicLayoutVertexArray,W={},Y=m.getProjection(),Z=rp(C,Y,b),J=b.elevation,ie=Y.upVectorScale(C.canonical,b.center.lat,b.worldSize).metersToTile;V.clear();for(let pe=0;pe<B.length;pe++){const fe=B.get(pe),{tileAnchorX:ce,tileAnchorY:Re,numGlyphs:Ce}=fe,Se=fe.hidden||!fe.crossTileID||m.allowVerticalPlacement&&!fe.placedOrientation?null:g[fe.crossTileID];if(Se){let be=0,ye=0,Ne=0;const We=m.elevationType==="road";if(J||We){const nt=We?m.getElevationFeatureForText(pe):null,St=s.bV.getAtTileOffset(C,new s.P(ce,Re),J,nt),[Rt,jt,Ot]=Y.upVector(C.canonical,ce,Re);be=St*Rt*ie,ye=St*jt*ie,Ne=St*Ot*ie}let[Ze,tt,Je,mt]=Uc(fe.projectedAnchorX+be,fe.projectedAnchorY+ye,fe.projectedAnchorZ+Ne,f?Z:E);const xt=Wy(b.getCameraToCenterDistance(Y),mt);let Xe=s.bM(m.textSizeData,R,fe)*xt/s.bY;f&&(Xe*=m.tilePixelRatio/I);const Me=K3(Se,Xe);f?({x:Ze,y:tt,z:Je}=Y.projectTilePoint(ce+Me.x,Re+Me.y,C.canonical),[Ze,tt,Je]=Uc(Ze+be,tt+ye,Je+Ne,E)):(a&&Me._rotate(-b.angle),Ze+=Me.x,tt+=Me.y,Je=0);const dt=m.allowVerticalPlacement&&fe.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let nt=0;nt<Ce;nt++)s.bO(V,Ze,tt,Je,dt);L&&fe.associatedIconIndex>=0&&(W[fe.associatedIconIndex]={x:Ze,y:tt,z:Je,angle:dt})}else jo(Ce,V)}if(L){j.clear();const pe=m.icon.placedSymbolArray;for(let fe=0;fe<pe.length;fe++){const ce=pe.get(fe),{numGlyphs:Re}=ce,Ce=W[fe];if(ce.hidden||!Ce)jo(Re,j);else{const{x:Se,y:be,z:ye,angle:Ne}=Ce;for(let We=0;We<Re;We++)s.bO(j,Se,be,ye,Ne)}}m.icon.dynamicLayoutVertexBuffer.updateData(j)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function x_(m,a,f,g,b,E,C={}){const I=f.paint.get("icon-translate"),R=f.paint.get("text-translate"),L=f.paint.get("icon-translate-anchor"),B=f.paint.get("text-translate-anchor"),V=f.layout.get("icon-rotation-alignment"),j=f.layout.get("text-rotation-alignment"),W=f.layout.get("icon-pitch-alignment"),Y=f.layout.get("text-pitch-alignment"),Z=f.layout.get("icon-keep-upright"),J=f.layout.get("text-keep-upright"),ie=f.paint.get("icon-color-saturation"),pe=f.paint.get("icon-color-contrast"),fe=f.paint.get("icon-color-brightness-min"),ce=f.paint.get("icon-color-brightness-max"),Re=f.layout.get("symbol-elevation-reference")==="sea",Ce=f.layout.get("icon-image-use-theme")==="none",Se=m.context,be=Se.gl,ye=m.transform,Ne=V==="map",We=j==="map",Ze=W==="map",tt=Y==="map",Je=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let mt=!1;const xt=m.depthModeForSublayer(0,cn.ReadOnly),Xe=new cn(m.context.gl.LEQUAL,cn.ReadOnly,m.depthRangeFor3D),Me=[s.aF(ye.center.lng),s.aJ(ye.center.lat)],dt=f.layout.get("text-variable-anchor"),nt=ye.projection.name==="globe",St=[],Rt=[0,-1,0];for(const jt of g){const Ot=a.getTile(jt),Mt=Ot.getBucket(f);if(!Mt||Mt.projection.name==="mercator"&&nt||Mt.fullyClipped)continue;const rn=Mt.projection.name==="globe",tn=rn?s.aj(ye.zoom):0,Gt=rp(jt,Mt.getProjection(),ye),en=ye.calculatePixelsToTileUnitsMatrix(Ot),hn=dt&&Mt.hasTextData(),Cn=Mt.hasIconTextFit()&&hn&&Mt.hasIconData(),Vn=Mt.getProjection().createInversionMatrix(ye,jt.canonical),ci=(1<<Ot.tileID.canonical.z)*s.al/m.transform.worldSize,Dn=Pi=>{let ni=[0,0,0];if(Pi){const jn=m.style.directionalLight,Ki=m.style.ambientLight;jn&&Ki&&(ni=Vc(m.style,jn,Ki))}return ni},wi=Pi=>{ye.depthOcclusionForSymbolsAndCircles&&(f.hasOcclusionOpacityProperties||m.terrain)&&(Pi.push("DEPTH_D24"),Pi.push("DEPTH_OCCLUSION"))},Ln=Pi=>{f.lut&&!Ce&&(f.lut.texture||(f.lut.texture=new s.d$(m.context,f.lut.image,[f.lut.image.height,f.lut.image.height,f.lut.image.height],Se.gl.RGBA8)),Se.activeTexture.set(Se.gl.TEXTURE0+10),f.lut.texture&&f.lut.texture.bind(Se.gl.LINEAR,Se.gl.CLAMP_TO_EDGE),Pi.push("APPLY_LUT_ON_GPU"))},Li=()=>{const Pi=Ne&&f.layout.get("symbol-placement")!=="point",ni=[];wi(ni),Ln(ni);const jn=Pi||Cn,Ki=Mt.elevationType==="road",Ar=m.shadowRenderer,nr=Ki&&Ze&&!!Ar&&Ar.enabled,or=Dn(nr),qo=Ki&&Ze&&!m.terrain?Xe:xt,wa=f.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Ze&&ni.push("PITCH_WITH_MAP_TERRAIN"),rn&&(ni.push("PROJECTION_GLOBE_VIEW"),jn&&ni.push("PROJECTED_POS_ON_VIEWPORT")),wa>0&&Mt.hasAnySecondaryIcon&&ni.push("ICON_TRANSITION"),!Mt.icon.zOffsetVertexBuffer||Ki&&m.terrain||ni.push("Z_OFFSET"),ie===0&&pe===0&&fe===0&&ce===1||ni.push("COLOR_ADJUSTMENT"),Mt.sdfIcons&&ni.push("RENDER_SDF"),nr&&ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ki&&Ze&&!m.terrain&&Mt.icon.orientationVertexBuffer&&ni.push("ELEVATED_ROADS");const Rs=Mt.icon.programConfigurations.get(f.id),Ri=m.getOrCreateProgram("symbol",{config:Rs,defines:ni}),Ma=Ot.imageAtlasTexture?Ot.imageAtlasTexture.size:[0,0],eo=Mt.iconSizeData,Zo=s.bK(eo,ye.zoom),Hc=Ze||!ye.isOrthographic,Ko=Uh(Gt,Ot.tileID.canonical,Ze,Ne,ye,Mt.getProjection(),en),gr=fa(Gt,Ot.tileID.canonical,Ze,Ne,ye,Mt.getProjection(),en),jr=m.translatePosMatrix(gr,Ot,I,L,!0),ir=m.translatePosMatrix(Gt,Ot,I,L),Jr=jn?El:Ko,uo=Ne&&!Ze&&!Pi;let Lr=Rt;!nt&&!ye.mercatorFromTransition||Ne||(Lr=Hu(ye));const La=rn?Lr:Rt,Zg=f.getColorAdjustmentMatrix(ie,pe,fe,ce),ou=Rg(eo.kind,Zo,uo,Ze,m,ir,Jr,jr,Re,!1,Ma,[0,0],0,jt,tn,Me,Vn,La,Mt.getProjection(),or,ci,Zg,wa,null),Rp=Ot.imageAtlasTexture?Ot.imageAtlasTexture:null,Op=f.layout.get("icon-size").constantOr(0)!==1||Mt.iconsNeedLinear,Ba=Mt.sdfIcons||m.options.rotating||m.options.zooming||Op||Hc?be.LINEAR:be.NEAREST,au=Mt.sdfIcons&&f.paint.get("icon-halo-width").constantOr(1)!==0,cu=m.terrain&&Ze&&Pi?s.bl(s.bC(),Ko):El;if(Pi&&Mt.icon){const mc=s.bV.getAtTileOffsetFunc(jt,ye.center.lat,ye.worldSize,Mt.getProjection()),Zu=Uu(Gt,Ot.tileID.canonical,Ze,Ne,ye,Mt.getProjection(),en),tf=f.layout.get("icon-size-scale-range"),L_=s.aA(m.scaleFactor,tf[0],tf[1]);Di(Mt,Gt,m,!1,Zu,gr,Ze,Z,mc,jt,L_)}return{program:Ri,buffers:Mt.icon,uniformValues:ou,atlasTexture:Rp,atlasTextureIcon:null,atlasInterpolation:Ba,atlasInterpolationIcon:null,isSDF:Mt.sdfIcons,hasHalo:au,depthMode:qo,tile:Ot,renderWithShadows:nr,labelPlaneMatrixInv:cu}},Ni=()=>{const Pi=We&&f.layout.get("symbol-placement")!=="point",ni=[],jn=Pi||dt||Cn,Ki=Mt.elevationType==="road",Ar=m.shadowRenderer,nr=Ki&&tt&&!!Ar&&Ar.enabled,or=Dn(nr),qo=Ki&&tt&&!m.terrain?Xe:xt;m.terrainRenderModeElevated()&&tt&&ni.push("PITCH_WITH_MAP_TERRAIN"),rn&&(ni.push("PROJECTION_GLOBE_VIEW"),jn&&ni.push("PROJECTED_POS_ON_VIEWPORT")),!Mt.text.zOffsetVertexBuffer||Ki&&m.terrain||ni.push("Z_OFFSET"),Mt.iconsInText&&ni.push("RENDER_TEXT_AND_SYMBOL"),ni.push("RENDER_SDF"),nr&&ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ki&&tt&&!m.terrain&&Mt.text.orientationVertexBuffer&&ni.push("ELEVATED_ROADS"),wi(ni);const wa=Mt.text.programConfigurations.get(f.id),Rs=m.getOrCreateProgram("symbol",{config:wa,defines:ni});let Ri,Ma=[0,0],eo=null;const Zo=Mt.textSizeData;Mt.iconsInText&&(Ma=Ot.imageAtlasTexture?Ot.imageAtlasTexture.size:[0,0],eo=Ot.imageAtlasTexture?Ot.imageAtlasTexture:null,Ri=tt||!ye.isOrthographic||m.options.rotating||m.options.zooming||Zo.kind==="composite"||Zo.kind==="camera"?be.LINEAR:be.NEAREST);const Hc=Ot.glyphAtlasTexture?Ot.glyphAtlasTexture.size:[0,0],Ko=f.layout.get("text-size-scale-range"),gr=s.aA(m.scaleFactor,Ko[0],Ko[1]),jr=s.bK(Zo,ye.zoom,gr),ir=Uh(Gt,Ot.tileID.canonical,tt,We,ye,Mt.getProjection(),en),Jr=fa(Gt,Ot.tileID.canonical,tt,We,ye,Mt.getProjection(),en),uo=m.translatePosMatrix(Jr,Ot,R,B,!0),Lr=m.translatePosMatrix(Gt,Ot,R,B),La=jn?El:ir,Zg=We&&!tt&&!Pi;let ou=Rt;!nt&&!ye.mercatorFromTransition||We||(ou=Hu(ye));const Rp=Rg(Zo.kind,jr,Zg,tt,m,Lr,La,uo,Re,!0,Hc,Ma,0,jt,tn,Me,Vn,rn?ou:Rt,Mt.getProjection(),or,ci,null,null,gr),Op=Ot.glyphAtlasTexture?Ot.glyphAtlasTexture:null,Ba=be.LINEAR,au=f.paint.get("text-halo-width").constantOr(1)!==0,cu=m.terrain&&tt&&Pi?s.bl(s.bC(),ir):El;if(Pi&&Mt.text){const mc=s.bV.getAtTileOffsetFunc(jt,ye.center.lat,ye.worldSize,Mt.getProjection()),Zu=Uu(Gt,Ot.tileID.canonical,tt,We,ye,Mt.getProjection(),en);Di(Mt,Gt,m,!0,Zu,Jr,tt,J,mc,jt,gr)}return{program:Rs,buffers:Mt.text,uniformValues:Rp,atlasTexture:Op,atlasTextureIcon:eo,atlasInterpolation:Ba,atlasInterpolationIcon:Ri,isSDF:!0,hasHalo:au,depthMode:qo,tile:Ot,renderWithShadows:nr,labelPlaneMatrixInv:cu}},Fi=Mt.icon.segments.get().length,li=Mt.text.segments.get().length,zn=Fi&&!C.onlyText?Li():null,Ii=li&&!C.onlyIcons?Ni():null,fr=f.paint.get("icon-opacity").constantOr(1),pr=f.paint.get("text-opacity").constantOr(1);if(Je&&Mt.canOverlap){mt=!0;const Pi=fr&&!C.onlyText?Mt.icon.segments.get():[],ni=pr&&!C.onlyIcons?Mt.text.segments.get():[];for(const jn of Pi)St.push({segments:new s.bg([jn]),sortKey:jn.sortKey,state:zn});for(const jn of ni)St.push({segments:new s.bg([jn]),sortKey:jn.sortKey,state:Ii})}else C.onlyText||St.push({segments:fr?Mt.icon.segments:new s.bg([]),sortKey:0,state:zn}),C.onlyIcons||St.push({segments:pr?Mt.text.segments:new s.bg([]),sortKey:0,state:Ii})}mt&&St.sort((jt,Ot)=>jt.sortKey-Ot.sortKey);for(const jt of St){const Ot=jt.state;if(Ot)if(m.terrain?m.terrain.setupElevationDraw(Ot.tile,Ot.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ot.labelPlaneMatrixInv}):m.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,Ot.program),Se.activeTexture.set(be.TEXTURE0),Ot.atlasTexture&&Ot.atlasTexture.bind(Ot.atlasInterpolation,be.CLAMP_TO_EDGE,!0),Ot.atlasTextureIcon&&(Se.activeTexture.set(be.TEXTURE1),Ot.atlasTextureIcon&&Ot.atlasTextureIcon.bind(Ot.atlasInterpolationIcon,be.CLAMP_TO_EDGE,!0)),Ot.renderWithShadows&&m.shadowRenderer.setupShadows(Ot.tile.tileID.toUnwrapped(),Ot.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Ot.program),Ot.hasHalo){const Mt=Ot.uniformValues;Mt.u_is_halo=1,E_(Ot.buffers,jt.segments,f,m,Ot.program,Ot.depthMode,b,E,Mt,2),Mt.u_is_halo=0}else{if(Ot.isSDF){const Mt=Ot.uniformValues;Ot.hasHalo&&(Mt.u_is_halo=1,E_(Ot.buffers,jt.segments,f,m,Ot.program,Ot.depthMode,b,E,Mt,1)),Mt.u_is_halo=0}E_(Ot.buffers,jt.segments,f,m,Ot.program,Ot.depthMode,b,E,Ot.uniformValues,1)}}}function E_(m,a,f,g,b,E,C,I,R,L){const B=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];b.draw(g,g.context.gl.TRIANGLES,E,C,I,En.disabled,R,f.id,m.layoutVertexBuffer,m.indexBuffer,a,f.paint,g.transform.zoom,m.programConfigurations.get(f.id),B,L)}function Bb(m,a){const f=1<<m.canonical.z,g=(a.x*f-m.canonical.x-m.wrap*f)*s.al,b=(a.y*f-m.canonical.y)*s.al,E=s.e8(a.z,a.y);return s.d5(g,b,E)}function Fb(m,a,f,g,b){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const E=m.context.gl,C=new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D),I=new cn(m.context.gl.GREATER,cn.ReadWrite,m.depthRangeFor3D),R=function(W){let Y=.01;return W.isOrthographic&&(Y=s.ak(1e-4,Y,s.d0(W.pitch>=eu?1:W.pitch/eu))),2*Y}(m.transform),L=m.transform.getFreeCameraOptions().position,B="elevatedStructuresDepthReconstruct",V=m.getOrCreateProgram(B,{defines:["DEPTH_RECONSTRUCTION"]}),j=m.getOrCreateProgram(B);for(const W of g){const Y=a.getTile(W),Z=Y.getBucket(f);if(!Z)continue;const J=Z.elevatedStructures;if(!J)continue;const ie=Z.elevationBufferData.heightRange,pe=Bb(W.toUnwrapped(),L),fe=m.translatePosMatrix(W.projMatrix,Y,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));let ce,Re,Ce,Se;if(b==="initialize"){if(!ie||ie.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ce=Zh(fe,pe,R,1,0),Re=C,Ce=J.depthSegments,Se=V}else if(b==="reset"){if(!ie||ie.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ce=Zh(fe,pe,0,0,1),Re=I,Ce=J.maskSegments,Se=V}else if(b==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ce=Zh(fe,pe,R,1,0),Re=C,Ce=J.depthSegments,Se=j}Se.draw(m,E.TRIANGLES,Re,Pn.disabled,Nn.disabled,En.disabled,ce,f.id,J.vertexBuffer,J.indexBuffer,Ce,f.paint,m.transform.zoom)}}function wp(m,a,f,g){const{painter:b,sourceCache:E,layer:C,coords:I,colorMode:R,elevationType:L,terrainEnabled:B,pass:V}=m,j=b.context.gl,W=C.paint.get("fill-pattern"),Y=C.paint.get("fill-pattern-cross-fade"),Z=W.constantOr(null);let J=L;L!=="road"||a&&!B||(J="none");const ie=J==="road",pe=m.painter.shadowRenderer,fe=ie&&!!pe&&pe.enabled,ce=new cn(b.context.gl.LEQUAL,cn.ReadOnly,b.depthRangeFor3D);let Re=[0,0,0];if(fe){const ye=b.style.directionalLight,Ne=b.style.ambientLight;ye&&Ne&&(Re=Vc(b.style,ye,Ne))}const Ce=W&&W.constantOr(1),Se=b.terrain&&b.terrain.renderingToTexture,be=(ye,Ne)=>{let We,Ze,tt,Je,mt;Ne?(We=Ce&&!C.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",tt=j.LINES):(We=Ce?"fillPattern":"fill",tt=j.TRIANGLES);for(const xt of I){const Xe=E.getTile(xt);if(Ce&&!Xe.patternsLoaded())continue;const Me=Xe.getBucket(C);if(!Me)continue;const dt=a?Me.elevationBufferData:Me.bufferData;if(dt.isEmpty())continue;b.prepareDrawTile();const nt=dt.programConfigurations.get(C.id),St=b.isTileAffectedByFog(xt),Rt=[],jt=[];ie&&(Rt.push("ELEVATED_ROADS"),jt.push(dt.elevatedLayoutVertexBuffer)),fe&&Rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&f&&Rt.push("USE_MRT1"),Ce&&(b.context.activeTexture.set(j.TEXTURE0),Xe.imageAtlasTexture&&Xe.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),nt.updatePaintBuffers());let Ot=!1;if(Z&&Xe.imageAtlas){const en=Xe.imageAtlas,hn=s.e3.from(Z),Cn=hn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Vn=hn.getSecondary(),ci=en.patternPositions.get(Cn),Dn=Vn?en.patternPositions.get(Vn.scaleSelf(s.o.devicePixelRatio).toString()):null;Ot=!!ci&&!!Dn,ci&&nt.setConstantPatternPositions(ci,Dn)}Y>0&&(Ot||nt.getPatternTransitionVertexBuffer("fill-pattern"))&&Rt.push("FILL_PATTERN_TRANSITION");const Mt=b.getOrCreateProgram(We,{config:nt,overrideFog:St,defines:Rt}),rn=b.translatePosMatrix(xt.projMatrix,Xe,C.paint.get("fill-translate"),C.paint.get("fill-translate-anchor"));fe&&pe.setupShadows(Xe.tileID.toUnwrapped(),Mt,"vector-tile");const tn=C.paint.get("fill-emissive-strength");if(Ne){Je=dt.lineIndexBuffer,mt=dt.lineSegments;const en=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];Ze=We==="fillOutlinePattern"&&Ce?V3(rn,tn,b,Xe,en,Re,Y):j3(rn,tn,en,Re)}else Je=dt.indexBuffer,mt=dt.triangleSegments,Ze=Ce?Rb(rn,tn,b,Xe,Re,Y):qh(rn,tn,Re);b.uploadCommonUniforms(b.context,Mt,xt.toUnwrapped());let Gt=ye;(L==="road"&&!B||L==="offset")&&(Gt=ce),Mt.draw(b,tt,Gt,g||b.stencilModeForClipping(xt),R,En.disabled,Ze,C.id,dt.layoutVertexBuffer,Je,mt,C.paint,b.transform.zoom,nt,jt)}};b.renderPass===V&&be(b.depthModeForSublayer(1,b.renderPass==="opaque"?cn.ReadWrite:cn.ReadOnly),!1),J==="none"&&b.renderPass==="translucent"&&C.paint.get("fill-antialias")&&be(b.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly),!0)}function bp(m,a,f,g,b,E,C,I){f.resetLayerRenderingStats(m);const R=m.context,L=R.gl,B=m.transform,V=f.paint.get("fill-extrusion-pattern"),j=f.paint.get("fill-extrusion-pattern-cross-fade"),W=V.constantOr(null),Y=V.constantOr(1),Z=f.paint.get("fill-extrusion-opacity"),J=m.style.enable3dLights(),ie=f.paint.get(J&&!Y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie],fe=f.layout.get("fill-extrusion-edge-radius"),ce=fe>0&&!f.paint.get("fill-extrusion-rounded-roof"),Re=ce?0:fe,Ce=B.projection.name==="globe"?s.eb():0,Se=B.projection.name==="globe",be=Se?s.aj(B.zoom):0,ye=[s.aF(B.center.lng),s.aJ(B.center.lat)],Ne=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ne?null:f.lut).toArray01().slice(0,3),Ze=f.paint.get("fill-extrusion-flood-light-intensity"),tt=f.paint.get("fill-extrusion-vertical-scale"),Je=f.paint.get("fill-extrusion-line-width").constantOr(1)!==0,mt=f.paint.get("fill-extrusion-height-alignment"),xt=f.paint.get("fill-extrusion-base-alignment"),Xe=jc(m,f.paint.get("fill-extrusion-cutoff-fade-range")),Me=[];let dt;Se&&Me.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&Me.push("FAUX_AO"),ce&&Me.push("ZERO_ROOF_RADIUS"),I&&Me.push("HAS_CENTROID"),Ze>0&&Me.push("FLOOD_LIGHT"),Xe.shouldRenderCutoff&&Me.push("RENDER_CUTOFF"),Je&&Me.push("RENDER_WALL_MODE");const nt=m.renderPass==="shadow",St=m.shadowRenderer,Rt=nt&&!!St,jt=nt?En.disabled:En.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Ot=[0,0,0];if(St){const tn=m.style.directionalLight,Gt=m.style.ambientLight;tn&&Gt&&(Ot=Vc(m.style,tn,Gt)),nt||(Me.push("RENDER_SHADOWS","DEPTH_TEXTURE"),St.useNormalOffset&&Me.push("NORMAL_OFFSET")),dt=Me.concat(["SHADOWS_SINGLE_CASCADE"])}const Mt=Rt?"fillExtrusionDepth":Y?"fillExtrusionPattern":"fillExtrusion",rn=f.getLayerRenderingStats();for(const tn of g){const Gt=a.getTile(tn),en=Gt.getBucket(f);if(!en||en.projection.name!==B.projection.name)continue;let hn=!1;St&&(hn=St.getMaxCascadeForTile(tn.toUnwrapped())===0);const Cn=m.isTileAffectedByFog(tn),Vn=en.programConfigurations.get(f.id);let ci=!1;if(W&&Gt.imageAtlas){const li=Gt.imageAtlas,zn=s.e3.from(W),Ii=zn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),fr=zn.getSecondary(),pr=li.patternPositions.get(Ii),Pi=fr?li.patternPositions.get(fr.scaleSelf(s.o.devicePixelRatio).toString()):null;ci=!!pr&&!!Pi,pr&&Vn.setConstantPatternPositions(pr,Pi)}j>0&&(ci||Vn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Me.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Dn=m.getOrCreateProgram(Mt,{config:Vn,defines:hn?dt:Me,overrideFog:Cn});if(m.terrain&&m.terrain.setupElevationDraw(Gt,Dn,{useMeterToDem:!0}),!en.centroidVertexBuffer){const li=Dn.getAttributeLocation(L,"a_centroid_pos");li!==-1&&L.vertexAttrib2f(li,0,0)}!nt&&St&&St.setupShadows(Gt.tileID.toUnwrapped(),Dn,"vector-tile"),Y&&(m.context.activeTexture.set(L.TEXTURE0),Gt.imageAtlasTexture&&Gt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Vn.updatePaintBuffers());const wi=f.paint.get("fill-extrusion-vertical-gradient"),Ln=1/en.tileToMeter;let Li;if(nt&&St){if($b(Gt.tileID,en.maxHeight,m))continue;const li=St.calculateShadowPassMatrixFromTile(Gt.tileID.toUnwrapped());Li=Pb(li,Re,Ln,tt,mt,xt)}else{const li=m.translatePosMatrix(tn.expandedProjMatrix,Gt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),zn=B.projection.createInversionMatrix(B,tn.canonical);Li=Y?U3(li,m,wi,Z,pe,Re,Ln,tn,Gt,Ce,mt,xt,be,ye,zn,We,tt,j):p_(li,m,wi,Z,pe,Re,Ln,tn,Ce,mt,xt,be,ye,zn,We,tt,Ze,Ot)}m.uploadCommonUniforms(R,Dn,tn.toUnwrapped(),null,Xe);let Ni=en.segments;if(B.projection.name==="mercator"&&!nt&&(Ni=en.getVisibleSegments(Gt.tileID,m.terrain,m.transform.getFrustum(0)),!Ni.get().length))continue;if(rn)if(nt)for(const li of Ni.get())rn.numRenderedVerticesInShadowPass+=li.primitiveLength;else for(const li of Ni.get())rn.numRenderedVerticesInTransparentPass+=li.primitiveLength;const Fi=[];(m.terrain||I)&&Fi.push(en.centroidVertexBuffer),Se&&Fi.push(en.layoutVertexExtBuffer),Je&&Fi.push(en.wallVertexBuffer),Dn.draw(m,R.gl.TRIANGLES,b,E,C,jt,Li,f.id,en.layoutVertexBuffer,en.indexBuffer,Ni,f.paint,m.transform.zoom,Vn,Fi)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Dg{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function iu(m,a,f,g,b,E,C,I,R,L,B,V,j,W,Y,Z,J,ie,pe,fe){const ce=a.context,Re=ce.gl,Ce=a.transform,Se=a.transform.zoom,be=[],ye=m.translate,Ne=m.translateAnchor,We=m.edgeRadius,Ze=jc(a,m.cutoffFadeRange);B==="clear"?(be.push("CLEAR_SUBPASS"),fe&&(be.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(Re.TEXTURE0),fe.bind(Re.LINEAR,Re.CLAMP_TO_EDGE))):B==="sdf"?be.push("SDF_SUBPASS"):B==="emissive"&&(be.push("USE_MRT1"),ce.activeTexture.set(Re.TEXTURE0),fe.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)),ie&&be.push("HAS_CENTROID"),Ze.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const tt=(Je,mt,xt,Xe,Me)=>{let dt=be;mt.groundRadiusBuffer!=null&&(dt=be.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const nt=mt.programConfigurations.get(g.id),St=a.isTileAffectedByFog(Je),Rt=a.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:dt,overrideFog:St}),jt=((Mt,rn,tn,Gt,en,hn,Cn,Vn,ci,Dn,wi)=>({u_matrix:rn,u_opacity:tn,u_ao_pass:Gt?1:0,u_meter_to_tile:en,u_ao:hn,u_flood_light_intensity:Cn,u_flood_light_color:Vn,u_attenuation:ci,u_edge_radius:Dn,u_fb:0,u_fb_size:wi,u_dynamic_offset:1}))(0,Xe,V,L,Me,[j,W*Me],Y,Z,J,Se>=17?0:We*Me,fe?fe.size[0]:0),Ot=[];ie&&Ot.push(mt.hiddenByLandmarkVertexBuffer),mt.groundRadiusBuffer!=null&&Ot.push(mt.groundRadiusBuffer),a.uploadCommonUniforms(ce,Rt,Je.toUnwrapped(),null,Ze),Rt.draw(a,ce.gl.TRIANGLES,E,C,I,R,jt,g.id,mt.vertexBuffer,mt.indexBuffer,xt,g.paint,Se,nt,Ot)};for(const Je of b){const mt=f.getTile(Je),xt=mt.getBucket(g);if(!xt||xt.projection.name!==Ce.projection.name||!xt.groundEffect||xt.groundEffect&&!xt.groundEffect.hasData())continue;const Xe=xt.groundEffect,Me=1/xt.tileToMeter;{const dt=a.translatePosMatrix(Je.projMatrix,mt,ye,Ne),nt=Xe.getDefaultSegment();tt(Je,Xe,nt,dt,Me)}if(pe)for(let dt=0;dt<4;dt++){const nt=s.e9[dt](Je),St=f.getTile(nt);if(!St)continue;const Rt=St.getBucket(g);if(!Rt||Rt.projection.name!==Ce.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const jt=Rt.groundEffect;let Ot,Mt;dt===0?(Ot=[-s.al,0,0],Mt=1):dt===1?(Ot=[s.al,0,0],Mt=0):dt===2?(Ot=[0,-s.al,0],Mt=3):(Ot=[0,s.al,0],Mt=2);const rn=jt.regionSegments[Mt];if(!rn)continue;const tn=new Float32Array(16);s.br(tn,Je.projMatrix,Ot),tt(Je,jt,rn,a.translatePosMatrix(tn,mt,ye,Ne),Me)}}}function X3(m,a,f,g,b,E,C){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const I=E?E.findDEMTileFor(f):null;if(!(I&&I.dem||C))return;E&&I&&I.dem&&g.selfDEMTileTimestamp!==I.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=I.dem._timestamp);const R=(J,ie)=>{(J.flags|ie.flags)&s.ec?(J.flags|=s.ec,ie.flags|=s.ec):(J.flags&=~s.ec,ie.flags&=~s.ec)},L=J=>new s.P(Math.ceil((J+s.ed)*s.ee),0),B=J=>{const ie=a.getSource().minzoom,pe=ce=>{const Re=a.getTileByID(ce);if(Re&&Re.hasData())return Re.getBucket(b)},fe=[0,-1,1];for(const ce of fe){if(J.overscaledZ+ce<ie)continue;const Re=pe(J.calculateScaledKey(J.overscaledZ+ce));if(Re)return Re}},V=[0,0,0],j=(J,ie)=>(V[0]=Math.min(J.min.y,ie.min.y),V[1]=Math.max(J.max.y,ie.max.y),V[2]=s.al-ie.min.x>J.max.x?ie.min.x-s.al:J.max.x,V),W=(J,ie)=>(V[0]=Math.min(J.min.x,ie.min.x),V[1]=Math.max(J.max.x,ie.max.x),V[2]=s.al-ie.min.y>J.max.y?ie.min.y-s.al:J.max.y,V),Y=[(J,ie)=>j(J,ie),(J,ie)=>j(ie,J),(J,ie)=>W(J,ie),(J,ie)=>W(ie,J)],Z=(J,ie,pe,fe,ce,Re,Ce)=>{if(!E)return 0;const Se=[[Re?pe:J,Re?J:pe,0],[Re?pe:ie,Re?ie:pe,0]],be=Ce<0?s.al+Ce:Ce,ye=[Re?be:(J+ie)/2,Re?(J+ie)/2:be,0];return pe===0&&Ce<0||pe!==0&&Ce>0?E.getForTilePoints(ce,[ye],!0,fe):Se.push(ye),E.getForTilePoints(f,Se,!0,I),Math.max(Se[0][2],Se[1][2],ye[2])/E.exaggeration()};for(let J=0;J<4;J++){const ie=g.borderFeatureIndices[J];if(ie.length===0)continue;const pe=s.e9[J](f),fe=B(pe);if(!(fe&&fe instanceof s.ea))continue;const ce=E?E.findDEMTileFor(pe):null;if(!(ce&&ce.dem||C)||(E&&ce&&ce.dem&&g.borderDEMTileTimestamp[J]!==ce.dem._timestamp&&(g.borderDoneWithNeighborZ[J]=-1,g.borderDEMTileTimestamp[J]=ce.dem._timestamp),g.borderDoneWithNeighborZ[J]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const Re=(J<2?1:5)-J,Ce=fe.borderDoneWithNeighborZ[Re]!==g.canonical.z,Se=fe.borderFeatureIndices[Re];let be=0;if(g.canonical.z!==fe.canonical.z){for(const ye of ie)g.showCentroid(g.featuresOnBorder[ye]);if(Ce)for(const ye of Se)fe.showCentroid(fe.featuresOnBorder[ye]);g.borderDoneWithNeighborZ[J]=fe.canonical.z,fe.borderDoneWithNeighborZ[Re]=g.canonical.z}for(const ye of ie){const Ne=g.featuresOnBorder[ye],We=g.centroidData[Ne.centroidDataIndex],Ze=Ne.borders[J];let tt;for(;be<Se.length;){tt=fe.featuresOnBorder[Se[be]];const Je=tt.borders[Re];if(Je[1]>Ze[0]+3||Je[0]>Ze[0]-3)break;fe.showCentroid(tt),be++}if(tt&&be<Se.length){const Je=be;let mt=0;for(;!(tt.borders[Re][0]>Ze[1]-3)&&(mt++,++be!==Se.length);)tt=fe.featuresOnBorder[Se[be]];tt=fe.featuresOnBorder[Se[Je]];let xt=!1;if(mt>=1){const dt=tt.borders[Re];Math.abs(Ze[0]-dt[0])<3&&Math.abs(Ze[1]-dt[1])<3&&(mt=1,xt=!0,be=Je+1)}else if(mt===0){g.showCentroid(Ne);continue}const Xe=fe.centroidData[tt.centroidDataIndex];C&&xt&&R(We,Xe);const Me=Ne.intersectsCount()>1||tt.intersectsCount()>1;if(mt>1)be=Je,We.centroidXY=Xe.centroidXY=new s.P(0,0);else if(ce&&ce.dem&&!Me){const dt=Y[J](We,Xe),nt=J%2?s.al-1:0,St=Z(dt[0],Math.min(s.al-1,dt[1]),nt,ce,pe,J<2,dt[2]);We.centroidXY=Xe.centroidXY=L(St)}else Me?We.centroidXY=Xe.centroidXY=new s.P(0,0):(We.centroidXY=g.encodeBorderCentroid(Ne),Xe.centroidXY=fe.encodeBorderCentroid(tt));g.writeCentroidToBuffer(We),fe.writeCentroidToBuffer(Xe)}else g.showCentroid(Ne)}g.borderDoneWithNeighborZ[J]=fe.canonical.z,fe.borderDoneWithNeighborZ[Re]=g.canonical.z}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const J3=[1,0,0],Q3=[0,1,0],eC=[0,0,1];function $b(m,a,f){const g=f.transform,b=f.shadowRenderer;if(!b)return!0;const E=m.toUnwrapped(),C=g.tileSize*b._cascades[f.currentShadowCascade].scale;let I=a;if(g.elevation){const Z=g.elevation.getMinMaxForTile(m);Z&&(I+=Z.max)}const R=[...b.shadowDirection];R[2]=-R[2];const L=b.computeSimplifiedTileShadowVolume(E,I,C,R);if(!L)return!1;const B=[J3,Q3,eC,R,[R[0],0,R[2]],[0,R[1],R[2]]],V=g.projection.name==="globe",j=g.scaleZoom(C),W=s.cB.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,j,!V),Y=b.getCurrentCascadeFrustum();return W.intersectsPrecise(L.vertices,L.planes,B)===0||Y.intersectsPrecise(L.vertices,L.planes,B)===0}function vp(m){const{painter:a,source:f,layer:g,coords:b}=m;let E=m.defines;const C=a.context,I=a.renderPass==="shadow",R=a.renderPass==="light-beam",L=a.shadowRenderer,B=s.ef(a.transform.center.lat,a.transform.zoom),V=jc(a,g.paint.get("building-cutoff-fade-range"));V.shouldRenderCutoff&&(E=E.concat("RENDER_CUTOFF")),m.floodLightIntensity>0&&(E=E.concat("FLOOD_LIGHT"));for(const j of b){const W=f.getTile(j),Y=W.getBucket(g);if(!Y)continue;L&&L.getMaxCascadeForTile(j.toUnwrapped())===0&&(E=E.concat("SHADOWS_SINGLE_CASCADE"));const Z=Y.programConfigurations.get(g.id);let J,ie,pe,fe=a.translatePosMatrix(j.expandedProjMatrix,W,[0,0],"map");if(fe=s.cS(s.bC(),fe,[1,1,m.verticalScale]),I&&L){if($b(W.tileID,Y.maxHeight*B,a))continue;let Re=L.calculateShadowPassMatrixFromTile(W.tileID.toUnwrapped());Re=s.cS(s.bC(),Re,[1,1,m.verticalScale]),pe=zd(Re),J=ie=a.getOrCreateProgram("buildingDepth",{config:Z,defines:E,overrideFog:!1})}else if(R)J=ie=a.getOrCreateProgram("buildingBloom",{config:Z,defines:E,overrideFog:!1}),pe=W3(fe);else{const Re=a.transform.calculatePosMatrix(j.toUnwrapped(),a.transform.worldSize);s.cS(Re,Re,[1,1,m.verticalScale]);const Ce=s.bC();s.cS(Ce,Re,[1,-1,1/B]),s.bl(Ce,Ce),s.eg(Ce,Ce);const Se=a.transform.getFreeCameraOptions().position,be=1<<j.canonical.z;if(pe=m_(fe,Ce,m.opacity,m.facadeAOIntensity,[((Se.x-j.wrap)*be-j.canonical.x)*s.al,(Se.y*be-j.canonical.y)*s.al,Se.z*be*s.al],Y.tileToMeter,m.facadeEmissiveChance,m.floodLightColor,m.floodLightIntensity),ie=a.getOrCreateProgram("building",{config:Z,defines:E,overrideFog:!1}),m.depthOnly===!0)J=ie;else{const ye=E.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);J=a.getOrCreateProgram("building",{config:Z,defines:ye,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(Re,ie,!0),J!==ie&&L.setupShadowsFromMatrix(Re,J,!0))}const ce=(Re,Ce)=>{if(R){const Se=Re.entranceBloom;Ce.draw(a,C.gl.TRIANGLES,m.depthMode,Pn.disabled,m.blendMode,En.disabled,pe,g.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segmentsBucket,g.paint,a.transform.zoom,Z,[Se.layoutAttenuationBuffer,Se.layoutColorBuffer])}else{const Se=Re.segmentsBucket;let be=[Re.layoutNormalBuffer,Re.layoutCentroidBuffer,Re.layoutColorBuffer,Re.layoutFloodLightDataBuffer];Re.layoutFacadePaintBuffer&&(be=be.concat([Re.layoutFacadeDataBuffer,Re.layoutFacadeVerticalRangeBuffer,Re.layoutFacadePaintBuffer])),Ce.draw(a,C.gl.TRIANGLES,m.depthMode,Pn.disabled,m.blendMode,I?En.disabled:En.backCW,pe,g.id,Re.layoutVertexBuffer,Re.indexBuffer,Se,g.paint,a.transform.zoom,Z,be)}};a.uploadCommonUniforms(C,ie,j.toUnwrapped(),null,V),Y.buildingWithoutFacade&&ce(Y.buildingWithoutFacade,ie),Y.buildingWithFacade&&(J!==ie&&a.uploadCommonUniforms(C,J,j.toUnwrapped(),null,V),ce(Y.buildingWithFacade,J))}}function C_(m,a,f,g,b,E,C,I,R,L,B,V,j){const W=m.context.gl,Y=m.depthModeForSublayer(1,cn.ReadOnly,W.LEQUAL,!0),Z=.1*(1-(J=B))+3*J;var J;const ie=m._showOverdrawInspector,pe=V,fe=new Dg;ie||iu(fe,m,a,f,g,Y,new Pn({func:W.ALWAYS,mask:255},255,255,W.KEEP,W.KEEP,W.REPLACE),new Nn([W.ONE,W.ONE,W.ONE,W.ONE],s.ao.transparent,[!1,!1,!1,!0],W.MIN),En.disabled,b,"sdf",E,C,I,R,L,Z,pe,!1);{const ce=ie?Pn.disabled:new Pn({func:W.EQUAL,mask:255},255,255,W.KEEP,W.DECR,W.DECR),Re=ie?m.colorModeForRenderPass():new Nn([W.ONE_MINUS_DST_ALPHA,W.DST_ALPHA,W.ONE,W.ONE],s.ao.transparent,[!0,!0,!0,!0]);iu(fe,m,a,f,g,Y,ce,Re,En.disabled,b,"color",E,C,I,R,L,Z,pe,!1)}}function zb(m){return[m[0]*s.eh,m[1]*s.eh,m[2]*s.eh,0]}function T_(m,a,f,g,b,E,C,I,R){const L=g.getSource(),B=f.globeSharedBuffers;if(!B)return;let V,j,W;if(a&&(V=g.getTile(a)),L instanceof s.aU?(j=L.texture,W=s.dK(0,0,f.transform)):V&&a&&(j=V.texture,W=s.dK(a.canonical.z,a.canonical.x,f.transform)),!j||!W)return;m||(W=s.cS(s.bC(),W,[1,-1,1]));const Y=f.context,Z=Y.gl,J=b.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,ie=f.colorModeForDrapableLayerRenderPass(E),pe=C.defines;pe.push("GLOBE_POLES");const fe=new cn(Z.LEQUAL,cn.ReadWrite,f.depthRangeFor3D),ce=Float32Array.from(f.transform.expandedFarZProjMatrix),Re=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));f.terrain&&f.terrain.prepareDrawTile(),Y.activeTexture.set(Z.TEXTURE0),j.bind(J,Z.CLAMP_TO_EDGE),Y.activeTexture.set(Z.TEXTURE1),j.bind(J,Z.CLAMP_TO_EDGE),"useMipmap"in j&&Y.extTextureFilterAnisotropic&&f.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[Ce,Se,be,ye]=a?B.getPoleBuffers(a.canonical.z,!1):B.getPoleBuffers(0,!0),Ne=b.paint.get("raster-elevation");let We;m?(We=Ce,f.renderDefaultNorthPole=Ne!==0):(We=Se,f.renderDefaultSouthPole=Ne!==0);const Ze=zb(C.mix),tt=((mt,xt,Xe,Me,dt,nt,St,Rt,jt,Ot,Mt,rn,tn)=>Mb(mt,xt,Xe,new Float32Array(16),new Float32Array(9),[0,0],Me,[0,0],[0,0,0,0],1,{opacity:1,mix:0},nt,[0,0],Rt,2,Ot,Mt,rn,1,0,tn))(ce,Re,W,s.aj(f.transform.zoom),0,b,0,Ne,0,Ze,C.offset,C.range,E),Je=f.getOrCreateProgram("raster",{defines:pe});f.uploadCommonUniforms(Y,Je,null),Je.draw(f,Z.TRIANGLES,fe,R,ie,I,tt,b.id,We,be,ye)}function tC(m){if(m.isOrthographic)return[0,0,0,0];const a=m._nearZ,f=m.projection.farthestPixelDistance(m),g=f-a,b=.2*m.height,E=a+b;return[a,f,(E-b-a)/g,(E-a)/g]}function nC(m,a,f,g){if(m)return a instanceof Uo&&m instanceof Uy?a.getTextureDescriptor(m,f,!0):{texture:m.texture,mix:zb(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Ub=s.ei([{name:"a_index",type:"Int16",components:1}]);class iC{constructor(a,f,g,b){const E={width:g[0],height:g[1],data:null},C=a.gl;this.targetColorTexture=new s.T(a,E,C.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(a,E,C.RGBA8,{useMipmap:!1}),this.context=a,this.updateParticleTexture(f,b),this.lastInvalidatedAt=0}updateParticleTexture(a,f){if(this.particleTextureDimension===f.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,b=f.width*f.height;this.particleTexture0=new s.T(this.context,f,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,f,g.RGBA8,{premultiply:!1,useMipmap:!1});const E=new s.ej;E.reserve(b);for(let C=0;C<b;C++)E.emplaceBack(C);this.particleIndexBuffer=this.context.createVertexBuffer(E,Ub.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=f.width}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function jb(m,a,f){if(!m)return null;const g=a.getTextureDescriptor(m,f,!0);if(!g)return null;let{texture:b,mix:E,offset:C,tileSize:I,buffer:R,format:L}=g;if(!b||!L)return null;let B=!1;return L==="uint32"&&(B=!0,E[3]=0,E=y_(s.ek,E,[0,f.paint.get("raster-particle-max-speed")]),C=G3(s.ek,C,[0,f.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[R/(I+2*R),I/(I+2*R)],tileSize:I,scalarData:B,scale:E,offset:C,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function rC(m){const a=m._nearZ,f=m.projection.farthestPixelDistance(m),g=f-a,b=.2*m.height,E=a+b;return[a,f,(E-b-a)/g,(E-a)/g]}const Vb=new s.ao(1,0,0,1),Wb=new s.ao(0,1,0,1),Hb=new s.ao(0,0,1,1),JI=new s.ao(1,0,1,1),QI=new s.ao(0,1,1,1);function sC(m,a,f,g,b,E){for(let C=0;C<f.length;C++)if(b){const L=new s.ao(g.r*.8,g.g*.8,g.b*.8,1);jd(m,a,f[C],g,-1,-1,E),jd(m,a,f[C],g,-1,1,E),jd(m,a,f[C],g,1,1,E),jd(m,a,f[C],g,1,-1,E),jd(m,a,f[C],L,0,0,E)}else jd(m,a,f[C],g,0,0,E)}function jd(m,a,f,g,b,E,C){const I=m.context,R=m.transform,L=I.gl,B=R.projection.name==="globe",V=B?["PROJECTION_GLOBE_VIEW"]:[];let j=s.bz(f.projMatrix);if(B&&s.aj(R.zoom)>0){const Ze=s.bj(f.canonical,R),tt=s.el(Ze);j=s.aB(new Float32Array(16),R.globeMatrix,tt),s.aB(j,R.projMatrix,j)}const W=s.bC();W[12]+=2*b/(s.o.devicePixelRatio*R.width),W[13]+=2*E/(s.o.devicePixelRatio*R.height),s.aB(j,W,j);const Y=m.getOrCreateProgram("debug",{defines:V}),Z=a.getTileByID(f.key);m.terrain&&m.terrain.setupElevationDraw(Z,Y);const J=cn.disabled,ie=Pn.disabled,pe=m.colorModeForRenderPass(),fe="$debug";I.activeTexture.set(L.TEXTURE0),m.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),B?Z._makeGlobeTileDebugBuffers(m.context,R):Z._makeDebugTileBoundsBuffers(m.context,R.projection);const ce=Z._tileDebugBuffer||m.debugBuffer,Re=Z._tileDebugIndexBuffer||m.debugIndexBuffer,Ce=Z._tileDebugSegments||m.debugSegments;if(Y.draw(m,L.LINE_STRIP,J,ie,pe,En.disabled,Db(j,g.toPremultipliedRenderColor(null)),fe,ce,Re,Ce,null,null,null,[Z._globeTileDebugBorderBuffer]),C){const Ze=Z.latestRawTileData,tt=Math.floor((Ze&&Ze.byteLength||0)/1024);let Je=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Je+=` => ${f.overscaledZ}`),Je+=` ${Z.state}`,Je+=` ${tt}kb`,function(mt,xt){mt.initDebugOverlayCanvas();const Xe=mt.debugOverlayCanvas,Me=mt.context.gl,dt=mt.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,Xe.width,Xe.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(xt,5,5),dt.strokeText(xt,5,5),mt.debugOverlayTexture.update(Xe),mt.debugOverlayTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}(m,Je)}const Se=a.getTile(f).tileSize,be=512/Math.min(Se,512)*(f.overscaledZ/R.zoom)*.5,ye=Z._tileDebugTextBuffer||m.debugBuffer,Ne=Z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,We=Z._tileDebugTextSegments||m.debugSegments;Y.draw(m,L.TRIANGLES,J,ie,Nn.alphaBlended,En.disabled,Db(j,s.ao.transparent.toPremultipliedRenderColor(null),be),fe,ye,Ne,We,null,null,null,[Z._globeTileDebugTextBuffer])}function oC(m,a,f,g){A_(m,0,a+f/2,m.transform.width,f,g)}function Gb(m,a,f,g){A_(m,a-f/2,0,f,m.transform.height,g)}function A_(m,a,f,g,b,E){const C=m.context,I=C.gl;I.enable(I.SCISSOR_TEST),I.scissor(a*s.o.devicePixelRatio,f*s.o.devicePixelRatio,g*s.o.devicePixelRatio,b*s.o.devicePixelRatio),C.clear({color:E}),I.disable(I.SCISSOR_TEST)}const aC=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:e6}=aC;function Vd(m,a,f,g){m.emplaceBack(a,f,g)}class _a{constructor(a){this.vertexArray=new s.em,this.indices=new s.b0,Vd(this.vertexArray,-1,-1,1),Vd(this.vertexArray,1,-1,1),Vd(this.vertexArray,-1,1,1),Vd(this.vertexArray,1,1,1),Vd(this.vertexArray,-1,-1,-1),Vd(this.vertexArray,1,-1,-1),Vd(this.vertexArray,-1,1,-1),Vd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,e6),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function Wd(m,a,f,g,b,E){const C=m.context.gl,I=a.paint.get("sky-atmosphere-color"),R=a.paint.get("sky-atmosphere-halo-color"),L=a.paint.get("sky-atmosphere-sun-intensity"),B=((V,j,W,Y,Z)=>({u_matrix_3f:V,u_sun_direction:j,u_sun_intensity:W,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(s.eo(s.dO(),g),b,L,I.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+E,a.skyboxTexture,0),f.draw(m,C.TRIANGLES,cn.disabled,Pn.disabled,Nn.unblended,En.frontCW,B,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Wo=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Hd{constructor(a){const f=new s.ep;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const g=new s.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(f,Wo.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const cC=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qb{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zb{constructor(a){this.colorModeAlphaBlendedWriteRGB=new Nn([1,Dd,1,Dd],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Nn([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new qb,this.updateNeeded=!0}update(a){const f=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Hd(f);const g=this.params.sizeRange,b=this.params.intensityRange,E=function(B){const V=s.eq(30),j=[];for(let W=0;W<B;++W){const Y=2*Math.PI*V(),Z=Math.acos(1-2*V())-.5*Math.PI;j.push(s.d5(Math.cos(Z)*Math.cos(Y),Math.cos(Z)*Math.sin(Y),Math.sin(Z)))}return j}(this.params.starsCount),C=s.eq(300),I=new s.er,R=new s.b0;let L=0;for(let B=0;B<E.length;++B){const V=s.c5([],E[B],200),j=Math.max(0,1+.01*g*(1*C()-.5)),W=Math.max(0,1+.01*b*(1*C()-.5));I.emplaceBack(V[0],V[1],V[2],-1,-1,j,W),I.emplaceBack(V[0],V[1],V[2],1,-1,j,W),I.emplaceBack(V[0],V[1],V[2],1,1,j,W),I.emplaceBack(V[0],V[1],V[2],-1,1,j,W),R.emplaceBack(L+0,L+1,L+2),R.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=f.createVertexBuffer(I,cC.members),this.starsIdx=f.createIndexBuffer(R),this.starsSegments=s.bg.simpleSegment(0,0,I.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,f){const g=a.context,b=g.gl,E=a.transform,C=new cn(b.LEQUAL,cn.ReadOnly,[0,1]),I=s.aj(E.zoom),R=a.style.getLut(f.scope),L=f.properties.get("color-use-theme")==="none",B=f.properties.get("color").toNonPremultipliedRenderColor(L?null:R),V=f.properties.get("high-color-use-theme")==="none",j=f.properties.get("high-color").toNonPremultipliedRenderColor(V?null:R),W=f.properties.get("space-color-use-theme")==="none",Y=f.properties.get("space-color").toNonPremultipliedRenderColor(W?null:R),Z=5e-4,J=s.es(f.properties.get("horizon-blend"),0,1,Z,.25),ie=s.dE(a,g,E)&&J===Z?E.worldSize/(2*Math.PI*1.025)-1:E.globeRadius,pe=a.frameCounter/1e3%1,fe=s.ag(E.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(fe,2)-Math.pow(ie,2)),Re=Math.acos(ce/fe),Ce=Se=>{const be=E.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&be.push("ALPHA_PASS");const ye=a.getOrCreateProgram("globeAtmosphere",{defines:be}),Ne=((Ze,tt,Je,mt,xt,Xe,Me,dt,nt,St,Rt,jt)=>({u_frustum_tl:Ze,u_frustum_tr:tt,u_frustum_br:Je,u_frustum_bl:mt,u_horizon:xt,u_transition:Xe,u_fadeout_range:Me,u_atmosphere_fog_color:dt.toArray01(),u_high_color:nt.toArray01(),u_space_color:St.toArray01(),u_temporal_offset:Rt,u_horizon_angle:jt}))(E.frustumCorners.TL,E.frustumCorners.TR,E.frustumCorners.BR,E.frustumCorners.BL,E.frustumCorners.horizon,I,J,B,j,Y,pe,Re);a.uploadCommonUniforms(g,ye);const We=this.atmosphereBuffer;We&&ye.draw(a,b.TRIANGLES,C,Pn.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,En.backCW,Ne,Se?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};Ce(!1),Ce(!0)}drawStars(a,f){const g=s.aA(f.properties.get("star-intensity"),0,1);if(g===0)return;const b=a.context,E=b.gl,C=a.transform,I=a.getOrCreateProgram("stars"),R=s.c7([]);s.c9(R,R,-C._pitch),s.c8(R,R,-C.angle),s.c9(R,R,s.an(C._center.lat)),s.et(R,R,-s.an(C._center.lng));const L=s.cc(new Float32Array(16),R),B=s.aB([],C.starsProjMatrix,L),V=s.eo([],L),j=s.eu([],V),W=[0,1,0];s.dQ(W,W,j),s.c5(W,W,this.params.sizeMultiplier);const Y=[1,0,0];s.dQ(Y,Y,j),s.c5(Y,Y,this.params.sizeMultiplier);const Z=(J=W,ie=Y,pe=g,{u_matrix:Float32Array.from(B),u_up:J,u_right:ie,u_intensity_multiplier:pe});var J,ie,pe;a.uploadCommonUniforms(b,I),this.starsVx&&this.starsIdx&&I.draw(a,E.TRIANGLES,cn.disabled,Pn.disabled,this.colorModeAlphaBlendedWriteRGB,En.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Kb{constructor(){this.visibleTiles=[]}updateBorders(a,f){const g=[],b=[],E=a._getRenderableCoordinates(!1,!0);for(const R of E){const L=a.getTile(R);if(!L.hasData())continue;const B=L.getBucket(f);B&&(B.isEmpty()||(g.push(R.key),b.push({bucket:B,tileID:R.canonical})))}let C=g.length!==this.visibleTiles.length;if(!C){g.sort();for(let R=0;R<g.length;R++)if(g[R]!==this.visibleTiles[R]){C=!0;break}}if(!C)return;const I=new Set;this.visibleTiles=g,b.sort((R,L)=>R.tileID.z-L.tileID.z||R.tileID.x-L.tileID.x||R.tileID.y-L.tileID.y);for(const R of b){const L=new Array,B=new Array,V=R.bucket;for(const j of V.featuresOnBorder)I.has(j.featureId)?B.push(j.footprintIndex):(I.add(j.featureId),L.push(j.footprintIndex));V.updateFootprintHiddenFlags(L,s.ev,!1),V.updateFootprintHiddenFlags(B,s.ev,!0)}}}function Yb(m,a){const f=[...m],g=a.cameraWorldSizeForFog/a.worldSize,b=s.bA([]);return s.cS(b,b,[g,g,1]),s.aB(f,b,f),s.aB(f,a.worldToFogMatrix,f),f}function Cl(m,a,f,g,b){const E=f.material,C=g.context,{baseColorTexture:I,metallicRoughnessTexture:R}=E.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:B,emissionTexture:V}=E;function j(Y,Z,J){if(Y&&(m.push(Z),C.activeTexture.set(C.gl.TEXTURE0+J),Y.gfxTexture)){const{minFilter:ie,magFilter:pe,wrapS:fe,wrapT:ce}=Y.sampler;Y.gfxTexture.bindExtraParam(ie,pe,fe,ce)}}j(I,"HAS_TEXTURE_u_baseColorTexture",5),j(R,"HAS_TEXTURE_u_metallicRoughnessTexture",6),j(L,"HAS_TEXTURE_u_normalTexture",7),j(B,"HAS_TEXTURE_u_occlusionTexture",8),j(V,"HAS_TEXTURE_u_emissionTexture",9),b&&(b.texture||(b.texture=new s.d$(g.context,b.image,[b.image.height,b.image.height,b.image.height],C.gl.RGBA8)),C.activeTexture.set(C.gl.TEXTURE0+10),b.texture&&b.texture.bind(C.gl.LINEAR,C.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),f.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(f.texcoordBuffer)),f.colorBuffer&&(m.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(f.colorBuffer)),f.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(f.normalBuffer)),f.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(f.pbrBuffer)),E.alphaMode!=="OPAQUE"&&E.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),E.defined||m.push("DIFFUSE_SHADED");const W=g.shadowRenderer;W&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Ui(m,a,f,g,b,E){const C=m.modelOpacity,I=a.context,R=new cn(a.context.gl.LEQUAL,m.isLightMesh?cn.ReadOnly:cn.ReadWrite,a.depthRangeFor3D),L=a.transform,B=m.mesh,V=B.material,j=V.pbrMetallicRoughness,W=a.style.fog;let Y;Y=a.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:s.aB([],g.zScaleMatrix,m.nodeModelMatrix),s.aB(Y,g.negCameraPosMatrix,Y);const Z=s.bl([],Y);s.eg(Z,Z);const J=f.paint.get("model-color-use-theme").constantOr("default")==="none",ie=f.paint.get("model-emissive-strength").constantOr(0),pe=w_(new Float32Array(m.worldViewProjection),new Float32Array(Y),new Float32Array(Z),null,a,C,j.baseColorFactor,V.emissiveFactor,j.metallicFactor,j.roughnessFactor,V,ie,f,void 0,void 0,m.materialOverride,m.modelColor),fe={defines:[]},ce=[],Re=a.shadowRenderer;Re&&(Re.useNormalOffset=!1),Cl(fe.defines,ce,B,a,J?null:f.lut);let Ce=null;if(W){const ye=Yb(m.nodeModelMatrix,a.transform);if(Ce=new Float32Array(ye),L.projection.name!=="globe"){const Ne=B.aabb.min,We=B.aabb.max,[Ze,tt]=W.getOpacityForBounds(ye,Ne[0],Ne[1],We[0],We[1]);fe.overrideFog=Ze>=Xt||tt>=Xt}}const Se=jc(a,f.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const be=a.getOrCreateProgram("model",fe);a.uploadCommonUniforms(I,be,null,Ce,Se),a.renderPass!=="shadow"&&Re&&Re.setupShadowsFromMatrix(m.nodeModelMatrix,be),be.draw(a,I.gl.TRIANGLES,R,b,E,B.material.doubleSided?En.disabled:En.backCCW,pe,f.id,B.vertexBuffer,B.indexBuffer,B.segments,f.paint,a.transform.zoom,void 0,ce)}function Ng(m,a){return m.style._importedAsBasemap?"basemap":a.scope}function Mg(m,a,f,g,b,E,C,I,R,L){const B=m.transform,V=!!a.isGeometryBloom&&a.isGeometryBloom;if(V&&m.renderPass==="shadow")return;const j=B.projection.name==="globe"?s.eD(f,B):[...f];s.aB(j,j,a.globalMatrix);const W=s.aB([],g,j);if(a.meshes)for(const Y of a.meshes){const Z=I.get(Y.material.name);if(Z&&Z.opacity<=0)continue;if(Y.material.alphaMode!=="BLEND"){C.push({mesh:Y,depth:0,modelIndex:b,worldViewProjection:W,nodeModelMatrix:j,isLightMesh:V,materialOverride:Z,modelOpacity:R,modelColor:L});continue}const J=s.af([],Y.centroid,W);!B.isOrthographic&&J[2]<=0||E.push({mesh:Y,depth:J[2],modelIndex:b,worldViewProjection:W,nodeModelMatrix:j,isLightMesh:V,materialOverride:Z,modelOpacity:R,modelColor:L})}if(a.children)for(const Y of a.children)Mg(m,Y,f,g,b,E,C,I,R,L)}function xp(m,a,f,g){const b=f.shadowRenderer;if(!b)return;const E=b.getShadowPassDepthMode(),C=b.getShadowPassColorMode(),I=b.calculateShadowPassMatrixFromMatrix(a),R=kg(I);f.getOrCreateProgram("modelDepth",{defines:f._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,E,Pn.disabled,C,En.disabled,R,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,f.transform.zoom,void 0,void 0)}function lC(m,a,f,g,b,E){for(const C of b){const I=Object.assign({},g);I.part=C;const R={type:"Unknown",id:a,properties:I},L={orientation:m.paint.get("model-rotation").evaluate(R,f)};E.set(C,L)}}function uC(m,a,f,g,b,E){for(const C of b){const I=Object.assign({},g);I.part=C;const R={type:"Unknown",id:a,properties:I},L={color:m.paint.get("model-color").evaluate(R,f),colorMix:m.paint.get("model-color-mix-intensity").evaluate(R,f),opacity:m.paint.get("model-opacity").evaluate(R,f),emissionStrength:m.paint.get("model-emissive-strength").evaluate(R,f)};E.set(C,L)}}function Xb(m,a,f,g,b){let E=!1;for(const I of g)I.modelOpacity!==1&&(Ui(I,m,a,b[I.modelIndex],Pn.disabled,Nn.disabled),E=!0);for(const I of g)Ui(I,m,a,b[I.modelIndex],I.modelOpacity!==1?m.stencilModeFor3D():Pn.disabled,m.colorModeForRenderPass());E&&m.resetStencilClippingMasks();const C=Nn.additive;for(const I of f)Ui(I,m,a,b[I.modelIndex],Pn.disabled,I.isLightMesh?C:m.colorModeForRenderPass())}function Xh(m,a,f){const g=a.updateZoomBasedPaintProperties(),b=function(E,C,I){let R,L,B,V=E.terrain?E.terrain.exaggeration():0;if(E.terrain&&V>0){const j=E.terrain,W=j.findDEMTileFor(I);W&&W.dem?R=s.eF.create(j,I,W):V=0}if(V===0&&(C.terrainElevationMin=0,C.terrainElevationMax=0),V===C.validForExaggeration&&(V===0||R&&R._demTile&&R._demTile.tileID===C.validForDEMTile.id&&R._dem._timestamp===C.validForDEMTile.timestamp))return!1;for(const j in C.instancesPerModel){const W=C.instancesPerModel[j];for(let Y=0;Y<W.instancedDataArray.length;++Y){const Z=(R?V*R.getElevationAt(0|W.instancedDataArray.float32[16*Y],0|W.instancedDataArray.float32[16*Y+1],!0,!0):0)+W.instancesEvaluatedElevation[Y];W.instancedDataArray.float32[16*Y+6]=Z,L=L?Math.min(C.terrainElevationMin,Z):Z,B=B?Math.max(C.terrainElevationMax,Z):Z}}return C.terrainElevationMin=L||0,C.terrainElevationMax=B||0,C.validForExaggeration=V,C.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,a,f);(g||b)&&(a.uploaded=!1,a.upload(m.context))}const Ho={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function kt(m,a){const f=1<<m.canonical.z,g=a.getFreeCameraOptions().position,b=a.elevation,E=m.canonical.x/f,C=(m.canonical.x+1)/f,I=m.canonical.y/f,R=(m.canonical.y+1)/f;let L=a._centerAltitude;if(b){const W=b.getMinMaxForTile(m);W&&W.max>L&&(L=W.max)}const B=s.aA(g.x,E,C)-g.x,V=s.aA(g.y,I,R)-g.y,j=s.cf(L,a.center.lat)-g.z;return a._zoomFromMercatorZ(Math.sqrt(B*B+V*V+j*j))}function Vt(m,a,f,g,b,E,C){const I=m.context,R=m.renderPass==="shadow",L=m.shadowRenderer,B=R&&L?L.getShadowPassDepthMode():new cn(I.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D),V=m.isTileAffectedByFog(E),j=m.transform.projection.name==="globe";if(f.meshes)for(const W of f.meshes){const Y=j?[]:["MODEL_POSITION_ON_GPU"],Z=[];let J,ie,pe;const fe=!j&&g.instancedDataArray.length>20;fe&&Y.push("INSTANCED_ARRAYS");const ce=jc(m,a.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&Y.push("RENDER_CUTOFF"),R&&L)J=m.getOrCreateProgram("modelDepth",{defines:Y}),ie=kg(C.shadowTileMatrix,C.shadowTileMatrix,Float32Array.from(f.globalMatrix)),pe=L.getShadowPassColorMode();else{Cl(Y,Z,W,m,a.paint.get("model-color-use-theme").constantOr("default")==="none"?null:a.lut),J=m.getOrCreateProgram("model",{defines:Y,overrideFog:V});const Ce=W.material,Se=Ce.pbrMetallicRoughness,be=a.paint.get("model-opacity").constantOr(1),ye=a.paint.get("model-emissive-strength").constantOr(0);ie=w_(E.expandedProjMatrix,Float32Array.from(f.globalMatrix),new Float32Array(16),null,m,be,Se.baseColorFactor,Ce.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,Ce,ye,a,b),L&&(C.shadowUniformsInitialized?J.setShadowUniformValues(I,L.getShadowUniformValues()):(L.setupShadows(E.toUnwrapped(),J,"model-tile"),C.shadowUniformsInitialized=!0)),pe=ce.shouldRenderCutoff||be<1||Ce.alphaMode!=="OPAQUE"?Nn.alphaBlended:Nn.unblended}m.uploadCommonUniforms(I,J,E.toUnwrapped(),null,ce);const Re=W.material.doubleSided?En.disabled:En.backCCW;if(fe)Z.push(g.instancedDataBuffer),J.draw(m,I.gl.TRIANGLES,B,Pn.disabled,pe,Re,ie,a.id,W.vertexBuffer,W.indexBuffer,W.segments,a.paint,m.transform.zoom,void 0,Z,g.instancedDataArray.length);else{const Ce=R?"u_instance":"u_normal_matrix";for(let Se=0;Se<g.instancedDataArray.length;++Se)ie[Ce]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Se,16),J.draw(m,I.gl.TRIANGLES,B,Pn.disabled,pe,Re,ie,a.id,W.vertexBuffer,W.indexBuffer,W.segments,a.paint,m.transform.zoom,void 0,Z)}}if(f.children)for(const W of f.children)Vt(m,a,W,g,b,E,C)}const Ep=[1,-1,1];function Tr(m,a,f,g){if(!f.modelManager)return!0;const b=f.modelManager;if(!f.shadowRenderer)return!0;const E=f.shadowRenderer,C=a.aabb;let I=!0,R=m.maxHeight;if(R===0){let B=0;for(const V in m.instancesPerModel){const j=b.getModel(V,g);j?B=Math.max(B,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):I=!1}R=m.maxScale*B*1.41+m.maxVerticalOffset,I&&(m.maxHeight=R)}C.max[2]=R,C.min[2]+=m.terrainElevationMin,C.max[2]+=m.terrainElevationMax,s.af(C.min,C.min,a.tileMatrix),s.af(C.max,C.max,a.tileMatrix);const L=C.intersects(E.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=L===2),L===0}function Ke(m,a){const f=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],b=m.uniformValues.u_cutoff_params[2],E=m.uniformValues.u_cutoff_params[3];return g===f||E===b?1:s.aA(((a-f)/(g-f)-b)/(E-b),0,1)}function dC(m,a,f,g){if(a.pitch<20)return 1;const b=a.getWorldToCameraMatrix();s.aB(b,b,m);const E=s.bU(f.min[0],f.min[1],f.min[2],1);let C=s.aC(s.eG(),E,b),I=C,R=C;E[1]=f.max[1],C=s.aC(s.eG(),E,b),I=C[1]<I[1]?C:I,R=C[1]>R[1]?C:R,E[0]=f.max[0],C=s.aC(s.eG(),E,b),I=C[1]<I[1]?C:I,R=C[1]>R[1]?C:R,E[1]=f.min[1],C=s.aC(s.eG(),E,b),I=C[1]<I[1]?C:I,R=C[1]>R[1]?C:R;const L=s.aA(g[0],0,1),B=100*a.pixelsPerMeter*s.aA(g[1],0,1),V=s.aA(g[2],0,1),j=s.eH(s.eG(),I,R,L),W=Math.tan(.5*a.fovX),Y=-j[2]*W;if(B===0)return j[1]<-Math.abs(Y)?V:1;const Z=(-Math.abs(Y)-j[1])/B,J=(pe,fe,ce)=>(1-ce)*pe+ce*fe,ie=s.aA(J(1,V,Z),V,1);return J(1,ie,s.aA((a.pitch-20)/20,0,1))}class S_{}class Jb{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,f,g){{const V=this._storage.get(f.id);if(V)return V.lastUsedFrameIdx=a,V.buf}const b=g.gl,E=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),C=new ArrayBuffer(E),I=new Int16Array(C);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(C));const R=new s.eJ;for(let V=0;V<E/2;V+=3){const j=I[V],W=I[V+1],Y=I[V+2];R.emplaceBack(j,W),R.emplaceBack(W,Y),R.emplaceBack(Y,j)}const L=g.bindVertexArrayOES.current,B=new S_;return B.buf=new nu(g,R),B.lastUsedFrameIdx=a,this._storage.set(f.id,B),g.bindVertexArrayOES.set(L),B.buf}update(a){for(const[f,g]of this._storage)a-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(f))}destroy(){for(const[a,f]of this._storage)f.buf.destroy(),this._storage.delete(a)}}class Qb{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const hC=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ev{constructor(a){this.revealStart=11,this.revealRange=2}}const Cp=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class t6{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(a,f){const g=a.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const C=new s.eK,I=new s.b0;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(1,1),C.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=a.context.createVertexBuffer(C,Cp.members),this.vignetteIdx=a.context.createIndexBuffer(I)}const b=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){a.uploadCommonUniforms(a.context,g);const C={u_vignetteShape:(E={vignetteShape:[f.start,f.range,Math.pow(10,f.fadePower)],vignetteColor:[f.color.r,f.color.g,f.color.b,f.color.a*f.strength]}).vignetteShape,u_vignetteColor:E.vignetteColor};g.draw(a,a.context.gl.TRIANGLES,cn.disabled,Pn.disabled,Nn.alphaBlended,En.disabled,C,"vignette",this.vignetteVx,this.vignetteIdx,b)}var E}}class n6{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(a,f){const g=a.getFreeCameraOptions().position,b=g.toAltitude(),E=g.toLngLat(),C=s.an(E.lng),I=s.an(E.lat),R=a.pixelsPerMeter/f,L=C*s.eM,B=s.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+B,j=-this._elevationPrev+b;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*R,this._accumulatedOffsetY+=V*R,this._accumulatedElevation+=j*R,this._offsetXPrev=L,this._offsetYPrev=B,this._elevationPrev=b}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function tv(m,a){return[-(m[0]-Math.floor(m[0]/a)*a),-(m[1]-Math.floor(m[1]/a)*a),-(m[2]-Math.floor(m[2]/a)*a)]}function Lg(m){const a=s.eq(1323123451230),f=[];for(let g=0;g<m;++g){const b=2*a()-1,E=2*a()-1,C=2*a()-1;f.push(s.d5(b,E,C))}return f}function ru(m,a,f,g,b){const E=s.aA((b-f)/(g-f),0,1);return(1-E)*m+E*a}class nv{constructor(a){this._movement=new n6,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new t6,this._ppmScaleFactor=a}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(a,f){const g=a.transform;this._movement.update(g,this._ppmScaleFactor);const b=g.starsProjMatrix,E=s.c7([]);s.c9(E,E,s.an(90)-g._pitch),s.c8(E,E,-g.angle);const C=s.cc(new Float32Array(16),E),I=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=s.eg([],I),L=s.aB([],R,C),B=Date.now()/1e3;return this._accumulatedTimeFromStart+=(B-this._prevTime)*f,this._prevTime=B,{projectionMatrix:b,modelviewMatrix:L}}}class fC extends nv{constructor(a){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ev("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(a){const f=a.context;if(!this.particlesVx){const g=Lg(this.particlesCount),b=new s.eN,E=new s.b0;let C=0;const I=s.eq(1323123451230);for(let R=0;R<g.length;++R){const L=g[R],B=[2*I()-1,I(),I(),I()];b.emplaceBack(L[0],L[1],L[2],-1,-1,...B),b.emplaceBack(L[0],L[1],L[2],1,-1,...B),b.emplaceBack(L[0],L[1],L[2],1,1,...B),b.emplaceBack(L[0],L[1],L[2],-1,1,...B),E.emplaceBack(C+0,C+1,C+2),E.emplaceBack(C+0,C+2,C+3),C+=4}this.particlesVx=f.createVertexBuffer(b,hC.members),this.particlesIdx=f.createIndexBuffer(E)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.rain)return;const f=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=a.transform.zoom;if(f.revealStart>g)return;const b=ru(0,1,f.revealStart,f.revealStart+f.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const E=structuredClone(this._params);let C=[-E.direction.x,E.direction.y,-100];s.aw(C,C);const I=structuredClone(this._vignetteParams);I.strength*=b,E.overrideStyleParameters||(E.intensity=a.style.rain.state.density,E.timeFactor=a.style.rain.state.intensity,E.color=structuredClone(a.style.rain.state.color),C=structuredClone(a.style.rain.state.direction),E.screenThinning.intensity=a.style.rain.state.centerThinning,E.dropletSizeX=a.style.rain.state.dropletSize[0],E.dropletSizeYScale=a.style.rain.state.dropletSize[1]/a.style.rain.state.dropletSize[0],E.distortionStrength=100*a.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(a.style.rain.state.vignetteColor));const R=this.updateOnRender(a,E.timeFactor),L=a.context,B=L.gl,V=a.transform;this.screenTexture&&this.screenTexture.size[0]===a.width&&this.screenTexture.size[1]===a.height||(this.screenTexture=new s.T(L,{width:a.width,height:a.height,data:null},B.RGBA8)),E.distortionStrength>0&&(L.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.copyTexSubImage2D(B.TEXTURE_2D,0,0,0,0,0,a.width,a.height));const j=a.getOrCreateProgram("rainParticle");a.uploadCommonUniforms(L,j),L.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const W=[E.color.r,E.color.g,E.color.b,E.color.a],Y=(Z,J)=>{const ie=tv(this._movement.getPosition(),Z),pe=E.dropletSizeX,fe=E.dropletSizeX*E.dropletSizeYScale,ce=a.width/2,Re=a.height/2,Ce=ru(0,E.screenThinning.start,0,1,E.screenThinning.intensity),Se=ru(.001,E.screenThinning.range,0,1,E.screenThinning.intensity),be=ru(0,E.screenThinning.particleOffset,0,1,E.screenThinning.intensity),ye=(Ne={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:E.velocityConeAperture,velocity:E.velocity,boxSize:Z,rainDropletSize:[pe,fe],distortionStrength:E.distortionStrength,rainDirection:C,color:W,screenSize:[V.width,V.height],thinningCenterPos:[ce,Re],thinningShape:[Ce,Se,Math.pow(10,E.screenThinning.fadePower)],thinningAffectedRatio:E.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:E.shapeDirPower,shapeNormalPower:E.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_texScreen:0,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_boxSize:Ne.boxSize,u_rainDropletSize:Ne.rainDropletSize,u_distortionStrength:Ne.distortionStrength,u_rainDirection:Ne.rainDirection,u_color:Ne.color,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_shapeDirectionalPower:Ne.shapeDirectionalPower,u_shapeNormalPower:Ne.shapeNormalPower,u_mode:Ne.mode});var Ne;const We=Math.round(E.intensity*this.particlesCount),Ze=s.bg.simpleSegment(0,0,4*We,2*We);j.draw(a,B.TRIANGLES,cn.disabled,Pn.disabled,Nn.alphaBlended,En.disabled,ye,"rain_particles",this.particlesVx,this.particlesIdx,Ze)};E.distortionStrength>0&&Y(E.boxSize,!0),Y(E.boxSize,!1),this._vignette.draw(a,I)}}const I_=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Bg extends nv{constructor(a){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ev("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(a){const f=a.context;if(!this.particlesVx){const g=Lg(this.particlesCount),b=new s.eO,E=new s.b0;let C=0;const I=s.eq(1323123451230);for(let R=0;R<g.length;++R){const L=g[R],B=I(),V=I(),j=I(),W=[R/g.length,B,V,j],Y=[I(),I()];b.emplaceBack(L[0],L[1],L[2],-1,-1,...W,...Y),b.emplaceBack(L[0],L[1],L[2],1,-1,...W,...Y),b.emplaceBack(L[0],L[1],L[2],1,1,...W,...Y),b.emplaceBack(L[0],L[1],L[2],-1,1,...W,...Y),E.emplaceBack(C+0,C+1,C+2),E.emplaceBack(C+0,C+2,C+3),C+=4}this.particlesVx=f.createVertexBuffer(b,I_.members),this.particlesIdx=f.createIndexBuffer(E)}}draw(a){if(!this._params.overrideStyleParameters&&!a.style.snow)return;const f=structuredClone(this._params);let g=[-f.direction.x,f.direction.y,-100];s.aw(g,g);const b=structuredClone(this._vignetteParams),E=f.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},C=a.transform.zoom;if(E.revealStart>C)return;const I=ru(0,1,E.revealStart,E.revealStart+E.revealRange,C);b.strength*=I,f.overrideStyleParameters||(f.intensity=a.style.snow.state.density,f.timeFactor=a.style.snow.state.intensity,f.color=structuredClone(a.style.snow.state.color),g=structuredClone(a.style.snow.state.direction),f.screenThinning.intensity=a.style.snow.state.centerThinning,f.billboardSize=2.79*a.style.snow.state.flakeSize,b.strength=1,b.color=structuredClone(a.style.snow.state.vignetteColor));const R=this.updateOnRender(a,f.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=a.context,B=L.gl,V=a.transform,j=a.getOrCreateProgram("snowParticle");a.uploadCommonUniforms(L,j),((W,Y,Z)=>{const J=tv(this._movement.getPosition(),W),ie=V.width/2,pe=V.height/2,fe=ru(0,Z.screenThinning.start,0,1,Z.screenThinning.intensity),ce=ru(.001,Z.screenThinning.range,0,1,Z.screenThinning.intensity),Re=ru(0,Z.screenThinning.particleOffset,0,1,Z.screenThinning.intensity),Ce=(Se={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:Z.velocityConeAperture,velocity:Z.velocity,horizontalOscillationRadius:Z.horizontalOscillationRadius,horizontalOscillationRate:Z.horizontalOscillationRate,boxSize:W,billboardSize:1*Z.billboardSize,simpleShapeParameters:[Z.shapeFadeStart,Z.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[ie,pe],thinningShape:[fe,ce,Math.pow(10,Z.screenThinning.fadePower)],thinningAffectedRatio:Z.screenThinning.affectedRatio,thinningParticleOffset:Re,color:[Z.color.r,Z.color.g,Z.color.b,Z.color.a],direction:g},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_horizontalOscillationRadius:Se.horizontalOscillationRadius,u_horizontalOscillationRate:Se.horizontalOscillationRate,u_boxSize:Se.boxSize,u_billboardSize:Se.billboardSize,u_simpleShapeParameters:Se.simpleShapeParameters,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_particleColor:Se.color,u_direction:Se.direction});var Se;const be=Math.round(Z.intensity*this.particlesCount),ye=s.bg.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&j.draw(a,B.TRIANGLES,cn.disabled,Pn.disabled,Nn.alphaBlended,En.disabled,Ce,"snow_particles",this.particlesVx,this.particlesIdx,ye)})(f.boxSize,0,f),this._vignette.draw(a,b)}}const Jh={symbol:function(m,a,f,g,b){if(m.renderPass!=="translucent")return;const E=Pn.disabled,C=m.colorModeForRenderPass(),I=f.layout.get("text-variable-anchor"),R=f.layout.get("text-size-scale-range"),L=s.aA(m.scaleFactor,R[0],R[1]);I&&function(j,W,Y,Z,J,ie,pe,fe){const ce=W.transform,Re=J==="map",Ce=ie==="map";for(const Se of j){const be=Z.getTile(Se),ye=be.getBucket(Y);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const Ne=s.bK(ye.textSizeData,ce.zoom,fe),We=rp(Se,ye.getProjection(),ce),Ze=ce.calculatePixelsToTileUnitsMatrix(be),tt=Uh(We,be.tileID.canonical,Ce,Re,ce,ye.getProjection(),Ze),Je=ye.hasIconTextFit()&&ye.hasIconData();Ne&&Y3(ye,Re,Ce,pe,ce,tt,Se,Math.pow(2,ce.zoom-be.tileID.overscaledZ),Ne,Je)}}(g,m,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),b,L);const B=f.paint.get("icon-opacity").constantOr(1)!==0,V=f.paint.get("text-opacity").constantOr(1)!==0;f.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(B||V)?x_(m,a,f,g,E,C):(B&&x_(m,a,f,g,E,C,{onlyIcons:!0}),V&&x_(m,a,f,g,E,C,{onlyText:!0})),a.map.showCollisionBoxes&&(Lb(m,a,f,g,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Lb(m,a,f,g,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,f,g){if(m.renderPass!=="translucent")return;const b=f.paint.get("circle-opacity"),E=f.paint.get("circle-stroke-width"),C=f.paint.get("circle-stroke-opacity"),I=f.layout.get("circle-sort-key").constantOr(1)!==void 0,R=f.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(E.constantOr(1)===0||C.constantOr(1)===0))return;const L=m.context,B=L.gl,V=m.transform,j=!(!m.terrain||!m.terrain.enabled),W=f.layout.get("circle-elevation-reference"),Y=m.depthModeForSublayer(0,cn.ReadOnly),Z=new cn(m.context.gl.LEQUAL,cn.ReadOnly,m.depthRangeFor3D),J=W==="none"||j?Y:Z,ie=Pn.disabled,pe=m.colorModeForDrapableLayerRenderPass(R),fe=V.projection.name==="globe",ce=[s.aF(V.center.lng),s.aJ(V.center.lat)],Re=[];for(let Se=0;Se<g.length;Se++){const be=g[Se],ye=a.getTile(be),Ne=ye.getBucket(f);if(!Ne||Ne.projection.name!==V.projection.name)continue;const We=Ne.programConfigurations.get(f.id),Ze=Ne.layoutVertexBuffer,tt=Ne.globeExtVertexBuffer,Je=Ne.indexBuffer,mt=s.e0(f),xt=[tt],Xe=m.isTileAffectedByFog(be);fe&&mt.push("PROJECTION_GLOBE_VIEW"),mt.push("DEPTH_D24"),m.terrain&&V.depthOcclusionForSymbolsAndCircles&&mt.push("DEPTH_OCCLUSION"),Ne.hasElevation&&!m.terrain&&(mt.push("ELEVATED_ROADS"),xt.push(Ne.elevatedLayoutVertexBuffer));const Me=m.getOrCreateProgram("circle",{config:We,defines:mt,overrideFog:Xe}),dt=V.projection.createInversionMatrix(V,be.canonical),nt={programConfiguration:We,program:Me,layoutVertexBuffer:Ze,dynamicBuffers:xt,indexBuffer:Je,uniformValues:s.e1(m,be,ye,dt,ce,f),tile:ye};if(I){const St=Ne.segments.get();for(const Rt of St)Re.push({segments:new s.bg([Rt]),sortKey:Rt.sortKey,state:nt})}else Re.push({segments:Ne.segments,sortKey:0,state:nt})}I&&Re.sort((Se,be)=>Se.sortKey-be.sortKey);const Ce={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const Se of Re){const{programConfiguration:be,program:ye,layoutVertexBuffer:Ne,dynamicBuffers:We,indexBuffer:Ze,uniformValues:tt,tile:Je}=Se.state,mt=Se.segments;m.terrain&&m.terrain.setupElevationDraw(Je,ye,Ce),m.uploadCommonUniforms(L,ye,Je.tileID.toUnwrapped()),ye.draw(m,B.TRIANGLES,J,ie,pe,En.disabled,tt,f.id,Ne,Ze,mt,f.paint,V.zoom,be,We)}},heatmap:function(m,a,f,g){if(f.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const b=m.context,E=b.gl,C=Pn.disabled,I=new Nn([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(W,Y,Z,J){const ie=W.gl,pe=Y.width*J,fe=Y.height*J;W.activeTexture.set(ie.TEXTURE1),W.viewport.set([0,0,pe,fe]);let ce=Z.heatmapFbo;if(!ce||ce&&(ce.width!==pe||ce.height!==fe)){ce&&ce.destroy();const Re=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,Re),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),ce=Z.heatmapFbo=W.createFramebuffer(pe,fe,1,null),function(Ce,Se,be,ye,Ne,We){const Ze=Ce.gl;Ze.texImage2D(Ze.TEXTURE_2D,0,Ce.extRenderToTextureHalfFloat?Ze.RGBA16F:Ze.RGBA,Ne,We,0,Ze.RGBA,Ce.extRenderToTextureHalfFloat?Ze.HALF_FLOAT:Ze.UNSIGNED_BYTE,null),ye.colorAttachment0.set(be)}(W,0,Re,ce,pe,fe)}else ie.bindTexture(ie.TEXTURE_2D,ce.colorAttachment0.get()),W.bindFramebuffer.set(ce.framebuffer)})(b,m,f,m.transform.projection.name==="globe"?.5:.25),b.clear({color:s.ao.transparent});const R=m.transform,L=R.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[],V=L?En.frontCCW:En.disabled,j=[s.aF(R.center.lng),s.aJ(R.center.lat)];for(let W=0;W<g.length;W++){const Y=g[W];if(a.hasRenderableParent(Y))continue;const Z=a.getTile(Y),J=Z.getBucket(f);if(!J||J.projection.name!==R.projection.name)continue;const ie=m.isTileAffectedByFog(Y),pe=J.programConfigurations.get(f.id),fe=m.getOrCreateProgram("heatmap",{config:pe,defines:B,overrideFog:ie}),{zoom:ce}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Z,fe),m.uploadCommonUniforms(b,fe,Y.toUnwrapped());const Re=R.projection.createInversionMatrix(R,Y.canonical);fe.draw(m,E.TRIANGLES,cn.disabled,C,I,V,Nb(m,Y,Z,Re,j,ce,f.paint.get("heatmap-intensity")),f.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,f.paint,m.transform.zoom,pe,L?[J.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,E){const C=b.context,I=C.gl,R=E.heatmapFbo;if(!R)return;C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment0.get()),C.activeTexture.set(I.TEXTURE1);let L=E.colorRampTexture;L||(L=E.colorRampTexture=new s.T(C,E.colorRamp,I.RGBA8)),L.bind(I.LINEAR,I.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,I.TRIANGLES,cn.disabled,Pn.disabled,b.colorModeForRenderPass(),En.disabled,((B,V)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,E),E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(m,f))},line:function(m,a,f,g){if(m.renderPass!=="translucent")return;const b=f.paint.get("line-opacity"),E=f.paint.get("line-width");if(b.constantOr(1)===0||E.constantOr(1)===0)return;const C=f.paint.get("line-emissive-strength").isConstant(),I=f.paint.get("line-emissive-strength").constantOr(0),R=f.paint.get("line-occlusion-opacity"),L=f.layout.get("line-elevation-reference"),B=f.layout.get("line-width-unit")==="meters",V=L==="sea",j=!(!m.terrain||!m.terrain.enabled),W=m.context,Y=W.gl;if(f.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const Z=f.layout.get("line-cross-slope"),J=Z!==void 0,ie=Z<1,pe=m.colorModeForDrapableLayerRenderPass(C?I:null),fe=m.terrain&&m.terrain.renderingToTexture,ce=fe?1:s.o.devicePixelRatio,Re=f.paint.get("line-dasharray"),Ce=Re.constantOr(1),Se=f.layout.get("line-cap"),be=Re.constantOr(null),ye=Se.constantOr(null),Ne=f.paint.get("line-pattern"),We=Ne.constantOr(1),Ze=f.paint.get("line-pattern-cross-fade"),tt=Ne.constantOr(null),Je=f.paint.get("line-opacity").constantOr(1);let mt=!We&&Je!==1||m.depthOcclusion&&R>0&&R<1;const xt=f.paint.get("line-gradient"),Xe=We?"linePattern":"line",Me=s.e2(f);let dt;if(fe&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(mt=!1),R!==0&&m.depthOcclusion){const jt=f.paint._values["line-opacity"];jt&&jt.value&&jt.value.kind==="constant"?dt=jt.value:s.w(`Occlusion opacity for layer ${f.id} is supported only when line-opacity isn't data-driven.`)}E.value.kind!=="constant"&&E.value.isLineProgressConstant===!1&&Me.push("VARIABLE_LINE_WIDTH"),fe&&(m.emissiveMode!=="dual-source-blending"||C?m.emissiveMode==="mrt-fallback"&&Me.push("USE_MRT1"):Me.push("DUAL_SOURCE_BLENDING"));const nt=(jt,Ot,Mt,rn,tn,Gt)=>{for(const en of jt){const hn=a.getTile(en);if(We&&!hn.patternsLoaded())continue;const Cn=hn.getBucket(f);if(!Cn||Cn.elevationType!=="none"&&!tn||Cn.elevationType==="none"&&tn)continue;m.prepareDrawTile();const Vn=[...Ot],ci=m.shadowRenderer,Dn=Cn.elevationType==="road"&&!!ci&&ci.enabled;let wi=[0,0,0];if(Dn){const jn=m.style.directionalLight,Ki=m.style.ambientLight;jn&&Ki&&(wi=Vc(m.style,jn,Ki)),Vn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ln=Cn.programConfigurations.get(f.id);let Li=!1;if(tt&&hn.imageAtlas){const jn=s.e3.from(tt),Ki=jn.getPrimary().scaleSelf(ce).toString(),Ar=hn.imageAtlas.patternPositions.get(Ki),nr=jn.getSecondary(),or=nr?hn.imageAtlas.patternPositions.get(nr.scaleSelf(ce).toString()):null;Li=!!Ar&&!!or,Ar&&Ln.setConstantPatternPositions(Ar,or)}Ze>0&&(Li||Ln.getPatternTransitionVertexBuffer("line-pattern"))&&Vn.push("LINE_PATTERN_TRANSITION");const Ni=m.isTileAffectedByFog(en),Fi=m.getOrCreateProgram(Xe,{config:Ln,defines:Vn,overrideFog:Ni});if(!We&&be&&ye&&hn.lineAtlas){const jn=hn.lineAtlas.getDash(be,ye);jn&&Ln.setConstantPatternPositions(jn)}Dn&&ci.setupShadows(hn.tileID.toUnwrapped(),Fi,"vector-tile");let[li,zn]=f.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&li!==zn&&(li===0&&(li-=1),zn===1&&(zn+=1));const Ii=fe?en.projMatrix:null,fr=B?1/Cn.tileToMeter/s.ay(hn,1,m.transform.zoom):1,pr=B?1/Cn.tileToMeter/s.ay(hn,1,Math.floor(m.transform.zoom)):1,Pi=We?s.e4(m,hn,f,Ii,ce,fr,pr,[li,zn],wi,Ze):s.e5(m,hn,f,Ii,Cn.lineClipsArray.length,ce,fr,pr,[li,zn],wi);if(xt){const jn=Cn.gradients[f.id];let Ki=jn.texture;if(f.gradientVersion!==jn.version){let Ar=256;if(f.stepInterpolant){const nr=a.getSource().maxzoom,or=en.canonical.z===nr?Math.ceil(1<<m.transform.maxZoom-en.canonical.z):1;Ar=s.aA(s.e6(Cn.maxLineLength/s.al*1024*or),256,W.maxTextureSize)}jn.gradient=s.e7({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ar,image:jn.gradient||void 0,clips:Cn.lineClipsArray}),jn.texture?jn.texture.update(jn.gradient):jn.texture=new s.T(W,jn.gradient,Y.RGBA8),jn.version=f.gradientVersion,Ki=jn.texture}W.activeTexture.set(Y.TEXTURE1),Ki.bind(f.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}Ce&&(W.activeTexture.set(Y.TEXTURE0),hn.lineAtlasTexture&&hn.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),Ln.updatePaintBuffers()),We&&(W.activeTexture.set(Y.TEXTURE0),hn.imageAtlasTexture&&hn.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Ln.updatePaintBuffers()),tn&&!V&&m.terrain.setupElevationDraw(hn,Fi),m.uploadCommonUniforms(W,Fi,en.toUnwrapped());const ni=jn=>{dt!=null&&(dt.value=Je*R),Fi.draw(m,Y.TRIANGLES,Mt,jn,pe,En.disabled,Pi,f.id,Cn.layoutVertexBuffer,Cn.indexBuffer,Cn.segments,f.paint,m.transform.zoom,Ln,[Cn.layoutVertexBuffer2,Cn.patternVertexBuffer,Cn.zOffsetVertexBuffer]),dt!=null&&(dt.value=Je)};if(mt&&!tn){const jn=m.stencilModeForClipping(en).ref;jn===0&&fe&&W.clear({stencil:0});const Ki={func:Y.EQUAL,mask:255};Pi.u_alpha_discard_threshold=.8,ni(new Pn(Ki,jn,255,Y.KEEP,Y.KEEP,Y.INVERT)),Pi.u_alpha_discard_threshold=0,ni(new Pn(Ki,jn,255,Y.KEEP,Y.KEEP,Y.KEEP))}else Pi.u_alpha_discard_threshold=mt&&tn&&Gt?.8:0,ni(tn?rn:m.stencilModeForClipping(en))}};let St=m.depthModeForSublayer(0,cn.ReadOnly);const Rt=new cn(m.depthOcclusion?Y.GREATER:Y.LEQUAL,cn.ReadOnly,m.depthRangeFor3D);if(f.hasNonElevatedBuckets){const jt=!fe&&m.terrain;R!==0&&jt?s.w(`Occlusion opacity for layer ${f.id} is supported on terrain only if the layer has line-z-offset enabled.`):jt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${f.id}.`):nt(g,Me,St,Pn.disabled,!1,!0)}if(f.hasElevatedBuckets){L==="hd-road-markup"?j||(St=Rt,Me.push("ELEVATED_ROADS")):(Me.push("ELEVATED"),St=Rt,J&&Me.push(ie?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),V&&Me.push("ELEVATION_REFERENCE_SEA"));const jt=mt?m.stencilModeFor3D():Pn.disabled;m.forceTerrainMode=!0,nt(g,Me,St,jt,!0,!0),mt&&nt(g,Me,St,jt,!0,!1),m.forceTerrainMode=!1}mt&&(m.resetStencilClippingMasks(),fe&&W.clear({stencil:0})),R===0||m.depthOcclusion||fe||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,a,f,g){const b=f.paint.get("fill-color"),E=f.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const C=f.paint.get("fill-emissive-strength"),I=m.colorModeForDrapableLayerRenderPass(C),R=f.paint.get("fill-pattern"),L=m.opaquePassEnabledForLayer()&&!R.constantOr(1)&&b.constantOr(s.ao.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";let B="none";f.layout.get("fill-elevation-reference")!=="none"?B="road":f.paint.get("fill-z-offset").constantOr(1)!==0&&(B="offset");const V=!(!m.terrain||!m.terrain.enabled),j={painter:m,sourceCache:a,layer:f,coords:g,colorMode:I,elevationType:B,terrainEnabled:V,pass:L};if(m.renderPass==="shadow")return void(m.shadowRenderer&&B==="road"&&!V&&function(Y){const{painter:Z,sourceCache:J,layer:ie,coords:pe}=Y,fe=Z.context.gl,ce=Y.painter.shadowRenderer;for(const Re of pe){const Ce=J.getTile(Re),Se=Ce.getBucket(ie);if(!Se)continue;const be=Se.elevatedStructures;if(!be||!be.shadowCasterSegments||be.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const ye=Se.bufferData.programConfigurations.get(ie.id),Ne=Z.isTileAffectedByFog(Re),We=Z.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:Ne}),Ze=ce.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,We,Re.toUnwrapped());const tt=Ob(Ze,0);We.draw(Z,fe.TRIANGLES,ce.getShadowPassDepthMode(),Pn.disabled,ce.getShadowPassColorMode(),En.disabled,tt,ie.id,be.vertexBuffer,be.indexBuffer,be.shadowCasterSegments,ie.paint,Z.transform.zoom,ye)}}(j));const W=m.emissiveMode==="mrt-fallback";if(B!=="offset"){if(wp(j,!1,W),B==="road"){const Y=!V&&m.renderPass==="translucent";Y&&Fb(m,a,f,g,"geometry"),wp(j,!0,W,Pn.disabled),Y&&function(Z){const{painter:J,sourceCache:ie,layer:pe,coords:fe,colorMode:ce}=Z,Re=J.context.gl,Ce=Z.painter.shadowRenderer,Se=!!Ce&&Ce.enabled,be=new cn(J.context.gl.LEQUAL,cn.ReadOnly,J.depthRangeFor3D);let ye=[0,0,0];if(Se){const We=J.style.directionalLight,Ze=J.style.ambientLight;We&&Ze&&(ye=Vc(J.style,We,Ze))}const Ne=We=>{for(const Ze of fe){const tt=ie.getTile(Ze),Je=tt.getBucket(pe);if(!Je)continue;const mt=Je.elevatedStructures;if(!mt)continue;let xt,Xe;if(We?(xt=mt.renderableBridgeSegments,Xe=mt.bridgeProgramConfigurations.get(pe.id)):(xt=mt.renderableTunnelSegments,Xe=mt.tunnelProgramConfigurations.get(pe.id)),!xt||xt.segments[0].primitiveLength===0)continue;Xe.updatePaintBuffers(),J.prepareDrawTile();const Me=J.isTileAffectedByFog(Ze),dt=[];Se&&dt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=J.getOrCreateProgram("elevatedStructures",{config:Xe,overrideFog:Me,defines:dt}),St=J.translatePosMatrix(Ze.projMatrix,tt,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"));Se&&Ce.setupShadows(tt.tileID.toUnwrapped(),nt,"vector-tile");const Rt=$d(St,ye);J.uploadCommonUniforms(J.context,nt,Ze.toUnwrapped()),nt.draw(J,Re.TRIANGLES,be,Pn.disabled,ce,En.backCCW,Rt,pe.id,mt.vertexBuffer,mt.indexBuffer,xt,pe.paint,J.transform.zoom,Xe,[mt.vertexBufferNormal])}};Ne(!0),Ne(!1)}(j)}}else wp(j,!1,W,m.stencilModeFor3D())},"fill-extrusion":function(m,a,f,g){const b=f.paint.get("fill-extrusion-opacity"),E=m.context,C=E.gl,I=m.terrain,R=I&&I.renderingToTexture;if(b===0)return;const L=m.emissiveMode==="mrt-fallback",B=m.conflationActive&&m.style.isLayerClipped(f,a.getSource()),V=m.style.order.indexOf(f.fqid);if(B&&function(j,W,Y,Z,J){for(const ie of Z){const pe=W.getTile(ie).getBucket(Y);pe&&(pe.updateReplacement(ie,j.replacementSource,J),pe.uploadCentroid(j.context))}}(m,a,f,g,V),I||B)for(const j of g){const W=a.getTile(j).getBucket(f);W&&X3(m.context,a,j,W,f,I,B)}if(m.renderPass==="shadow"&&m.shadowRenderer){const j=m.shadowRenderer;if(I&&b<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const W=j.getShadowPassDepthMode(),Y=j.getShadowPassColorMode();bp(m,a,f,g,W,Pn.disabled,Y,B)}else if(m.renderPass==="translucent"){const j=!f.paint.get("fill-extrusion-pattern").constantOr(1),W=f.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!R&&W.a!==0){const Y=new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D);b===1&&j?bp(m,a,f,g,Y,Pn.disabled,Nn.unblended,B):(bp(m,a,f,g,Y,Pn.disabled,Nn.disabled,B),bp(m,a,f,g,Y,m.stencilModeFor3D(),m.colorModeForRenderPass(),B),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&j&&(!I&&m.transform.projection.name!=="globe"||R)){const Y=f.paint.get("fill-extrusion-opacity"),Z=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=f.paint.get("fill-extrusion-flood-light-intensity"),pe=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",fe=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(pe?null:f.lut).toArray01().slice(0,3),ce=Z>0&&J>0,Re=ie>0,Ce=(ye,Ne,We)=>(1-We)*ye+We*Ne,Se=new Dg;Se.translate=f.paint.get("fill-extrusion-translate"),Se.translateAnchor=f.paint.get("fill-extrusion-translate-anchor"),Se.edgeRadius=f.layout.get("fill-extrusion-edge-radius"),Se.cutoffFadeRange=f.paint.get("fill-extrusion-cutoff-fade-range");const be=ye=>{const Ne=m.depthModeForSublayer(1,cn.ReadOnly,C.LEQUAL,!0),We=f.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=Ce(.1,3,We),tt=m._showOverdrawInspector;if(!tt){const Je=new Pn({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),mt=new Nn([C.ONE,C.ONE,C.ONE,C.ONE],s.ao.transparent,[!1,!1,!1,!0],C.MIN);iu(Se,m,a,f,g,Ne,Je,mt,En.disabled,ye,"sdf",Y,Z,J,ie,fe,Ze,B,!1)}{const Je=tt?Pn.disabled:new Pn({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),mt=tt?m.colorModeForRenderPass():new Nn([C.ONE_MINUS_DST_ALPHA,C.DST_ALPHA,C.ONE,C.ONE],s.ao.transparent,[!0,!0,!0,!0]);iu(Se,m,a,f,g,Ne,Je,mt,En.disabled,ye,"color",Y,Z,J,ie,fe,Ze,B,!1)}};if(R){const ye=()=>{const We=I.drapeBufferSize[0],Ze=I.drapeBufferSize[1];let tt=I.framebufferCopyTexture;return tt&&(!tt||tt.size[0]===We&&tt.size[1]===Ze)||(tt&&tt.destroy(),tt=I.framebufferCopyTexture=new s.T(E,new s.q({width:We,height:Ze}),C.RGBA8)),tt.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,We,Ze),tt},Ne=(We,Ze,tt)=>{const Je=m.depthModeForSublayer(1,cn.ReadOnly,C.LEQUAL,!1),mt=f.paint.get(We?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xt=Ce(.1,3,mt);{const Xe=new Nn([C.ONE,C.ONE,C.ONE,C.ONE],s.ao.transparent,[!1,!1,!1,!0]);iu(Se,m,a,f,g,Je,Pn.disabled,Xe,En.disabled,We,"clear",Y,Z,J,ie,fe,xt,B,Ze)}{const Xe=new Pn({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),Me=new Nn([C.ONE,C.ONE,C.ONE,C.ONE],s.ao.transparent,[!1,!1,!1,!0],C.MIN);iu(Se,m,a,f,g,Je,Xe,Me,En.disabled,We,"sdf",Y,Z,J,ie,fe,xt,B,Ze)}L&&!We&&(tt=ye());{const Xe=We?C.ZERO:C.ONE_MINUS_DST_ALPHA,Me=new Pn({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),dt=new Nn([Xe,C.DST_ALPHA,C.ONE_MINUS_DST_ALPHA,C.ZERO],s.ao.transparent,[!0,!0,!0,!0]);iu(Se,m,a,f,g,Je,Me,dt,En.disabled,We,"color",Y,Z,J,ie,fe,xt,B,Ze)}if(!L||We){const Xe=new Nn([C.ONE,C.ONE,C.ONE,We?C.ZERO:C.ONE],s.ao.transparent,[!1,!1,!1,!0],We?C.FUNC_ADD:C.MAX);iu(Se,m,a,f,g,Je,Pn.disabled,Xe,En.disabled,We,"clear",Y,Z,J,ie,fe,xt,B,Ze,tt)}else{C.drawBuffers([C.NONE,C.COLOR_ATTACHMENT1]);const Xe=new Pn({func:C.EQUAL,mask:255},254,255,C.KEEP,C.DECR,C.DECR),Me=new Nn([C.ONE,C.ONE,C.ONE,C.ONE],s.ao.transparent,[!0,!1,!1,!1],C.MAX);iu(Se,m,a,f,g,Je,Xe,Me,En.disabled,We,"emissive",Y,Z,J,ie,fe,xt,B,Ze,tt),C.drawBuffers([C.COLOR_ATTACHMENT0])}};if(ce||Re){let We;m.prepareDrawTile(),L&&!ce||(We=ye()),ce&&Ne(!0,!1,We),Re&&Ne(!1,!0,We)}}else ce&&be(!0),Re&&be(!1),(ce||Re)&&m.resetStencilClippingMasks()}}},building:function(m,a,f,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const b=f.paint.get("building-ambient-occlusion-ground-intensity"),E=f.paint.get("building-ambient-occlusion-ground-radius"),C=f.paint.get("building-ambient-occlusion-ground-attenuation"),I=f.paint.get("building-opacity");if(I<=0)return;let R=b>0&&E>0,L=!0;const B=f.paint.get("building-vertical-scale");if(B<=0)return;m.shadowRenderer||(L=!1);const V=m.conflationActive&&m.style.isLayerClipped(f,a.getSource()),j=m.style.order.indexOf(f.fqid);if(function(W,Y,Z,J,ie,pe){for(const fe of pe){const ce=Y.getTile(fe).getBucket(Z);ce&&(ie&&ce.updateReplacement(fe,W.replacementSource,J),ce.uploadUpdatedIndexBuffer(W.context))}}(m,a,f,j,V,g),function(W,Y,Z,J){for(const ie of J){const pe=Y.getTile(ie).getBucket(Z);pe&&pe.needsEvaluation()&&pe.uploadUpdatedColorBuffer(W.context)}}(m,a,f,g),f.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const W=m.shadowRenderer,Y=[],Z=W.getShadowPassDepthMode();vp({painter:m,source:a,layer:f,coords:g,defines:Y,blendMode:W.getShadowPassColorMode(),depthMode:Z,opacity:I,verticalScale:B,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(m.renderPass==="translucent"){let W=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(W=W.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(W=W.concat("NORMAL_OFFSET"));const Y=f.paint.get("building-facade-emissive-chance"),Z=f.paint.get("building-ambient-occlusion-intensity"),J=f.paint.get("building-flood-light-intensity"),ie=f.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pe=f.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ie?null:f.lut).toArray01().slice(0,3),fe=f.paint.get("building-flood-light-ground-attenuation"),ce=J>0,Re=new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D);I<1&&vp({painter:m,source:a,layer:f,coords:g,defines:W,blendMode:Nn.disabled,depthMode:Re,opacity:I,verticalScale:B,facadeEmissiveChance:Y,facadeAOIntensity:Z,floodLightIntensity:J,floodLightColor:pe,depthOnly:!0});const Ce=m.colorModeForRenderPass();vp({painter:m,source:a,layer:f,coords:g,defines:W,blendMode:Ce,depthMode:Re,opacity:I,verticalScale:B,facadeEmissiveChance:Y,facadeAOIntensity:Z,floodLightIntensity:J,floodLightColor:pe}),R&&C_(m,a,f,g,!0,I,b,E,J,pe,C,V),ce&&C_(m,a,f,g,!1,I,b,E,J,pe,fe,V)}else if(m.renderPass==="light-beam"){const W=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Y=new cn(m.context.gl.LEQUAL,cn.ReadOnly,m.depthRangeFor3D);vp({painter:m,source:a,layer:f,coords:g,defines:W,blendMode:Nn.alphaBlended,depthMode:Y,opacity:I,verticalScale:B,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,a,f,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const b=m.context,E=m.terrain&&m.terrain.renderingToTexture,[C,I]=m.renderPass!=="translucent"||E?[{},g]:m.stencilConfigForOverlap(g);for(const R of I){const L=a.getTile(R);if(L.needsHillshadePrepare&&m.renderPass==="offscreen")UI(m,L,f);else if(m.renderPass==="translucent"){const B=m.depthModeForSublayer(0,cn.ReadOnly),V=f.paint.get("hillshade-emissive-strength"),j=m.colorModeForDrapableLayerRenderPass(V),W=E&&m.terrain?m.terrain.stencilModeForRTTOverlap(R):C[R.overscaledZ];zI(m,R,L,f,B,W,j)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,f,g,b,E){if(m.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const C=m.transform.projection.name==="globe",I=f.paint.get("raster-elevation")!==0,R=I&&C;if(m.renderElevatedRasterBackface&&!R)return;const L=m.context,B=L.gl,V=a.getSource(),j=function(Ce,Se,be,ye,Ne){const We=Se.paint.get("raster-color"),Ze=Ce.type==="raster-array",tt=[],Je=Se.paint.get("raster-resampling"),mt=Se.paint.get("raster-color-mix");let xt=Se.paint.get("raster-color-range");const Xe=[mt[0],mt[1],mt[2],0],Me=mt[3];let dt=Je==="nearest"?ye.NEAREST:ye.LINEAR;if(Ze&&(tt.push("RASTER_ARRAY"),We||tt.push("RASTER_COLOR"),Je==="linear"&&tt.push("RASTER_ARRAY_LINEAR"),dt=ye.NEAREST,!xt&&Ce.rasterLayers)){const nt=Ce.rasterLayers.find(({id:St})=>St===Se.sourceLayer);nt&&nt.fields&&nt.fields.range&&(xt=nt.fields.range)}if(xt=xt||[0,1],We){tt.push("RASTER_COLOR"),be.activeTexture.set(ye.TEXTURE2),Se.updateColorRamp(xt);let nt=Se.colorRampTexture;nt||(nt=Se.colorRampTexture=new s.T(be,Se.colorRamp,ye.RGBA8)),nt.bind(dt,ye.CLAMP_TO_EDGE)}return Ne&&tt.push("USE_MRT1"),{mix:Xe,range:xt,offset:Me,defines:tt,resampling:dt}}(V,f,L,B,m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback");if(V instanceof s.aU&&!g.length&&!C)return;const W=f.paint.get("raster-emissive-strength"),Y=m.colorModeForDrapableLayerRenderPass(W),Z=m.terrain&&m.terrain.renderingToTexture,J=!m.options.moving,ie=f.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(V instanceof s.aU&&!g.length&&(V.onNorthPole||V.onSouthPole)){const Ce=I?m.stencilModeFor3D():Pn.disabled;return void T_(!!V.onNorthPole,null,m,a,f,W,j,En.disabled,Ce)}if(!g.length)return;const[pe,fe]=V instanceof s.aU||Z?[{},g]:m.stencilConfigForOverlap(g),ce=fe[fe.length-1].overscaledZ;R&&j.defines.push("PROJECTION_GLOBE_VIEW"),I&&j.defines.push("RENDER_CUTOFF");const Re=(Ce,Se,be)=>{for(const ye of Ce){const Ne=ye.toUnwrapped(),We=a.getTile(ye);if(Z&&(!We||!We.hasData()))continue;L.activeTexture.set(B.TEXTURE0);const Ze=nC(We,V,f,j);if(!Ze||!Ze.texture)continue;const{texture:tt,mix:Je,offset:mt,tileSize:xt,buffer:Xe}=Ze;let Me,dt;Z?(Me=cn.disabled,dt=ye.projMatrix):I?(Me=new cn(B.LEQUAL,cn.ReadWrite,m.depthRangeFor3D),dt=C?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Ne,J)):(Me=m.depthModeForSublayer(ye.overscaledZ-ce,f.paint.get("raster-opacity")===1?cn.ReadWrite:cn.ReadOnly,B.LESS),dt=m.transform.calculateProjMatrix(Ne,J));const nt=m.terrain&&Z?m.terrain.stencilModeForRTTOverlap(ye):pe[ye.overscaledZ],St=E?0:f.paint.get("raster-fade-duration");We.registerFadeDuration(St);const Rt=a.findLoadedParent(ye,0),jt=Ig(We,Rt,a,m.transform,St);let Ot,Mt;!jt.isFading&&We.refreshedUponExpiration&&(We.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),L.activeTexture.set(B.TEXTURE0),tt.bind(ie,B.CLAMP_TO_EDGE),L.activeTexture.set(B.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(ie,B.CLAMP_TO_EDGE),Ot=Math.pow(2,Rt.tileID.overscaledZ-We.tileID.overscaledZ),Mt=[We.tileID.canonical.x*Ot%1,We.tileID.canonical.y*Ot%1]):tt.bind(ie,B.CLAMP_TO_EDGE),"useMipmap"in tt&&L.extTextureFilterAnisotropic&&m.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const rn=m.transform;let tn;const Gt=I?tC(rn):[0,0,0,0];let en,hn,Cn,Vn,ci,Dn=0;if(R&&V instanceof s.aU&&V.coordinates.length>3)en=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),hn=Float32Array.from(rn.globeMatrix),Cn=Float32Array.from(s.dF(rn)),Vn=[s.aF(rn.center.lng),s.aJ(rn.center.lat)],tn=V.elevatedGlobePerspectiveTransform,ci=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Ni=s.dG(ye.canonical);Dn=s.dH(Ni.getCenter().lat),en=Float32Array.from(s.bk(s.dJ(ye.canonical))),hn=Float32Array.from(rn.globeMatrix),Cn=Float32Array.from(s.dF(rn)),Vn=[s.aF(rn.center.lng),s.aJ(rn.center.lat)],tn=[0,0],ci=Float32Array.from(s.dI(ye.canonical,Ni,Dn,rn.worldSize/rn._pixelsPerMercatorPixel))}else tn=V instanceof s.aU?V.perspectiveTransform:[0,0],en=new Float32Array(16),hn=new Float32Array(9),Cn=new Float32Array(16),Vn=[0,0],ci=new Float32Array(9);const wi=Mb(dt,en,hn,Cn,ci,Mt||[0,0],s.aj(m.transform.zoom),Vn,Gt,Ot||1,jt,f,tn,I?f.paint.get("raster-elevation"):0,2,Je,mt,j.range,xt,Xe,W),Ln=m.isTileAffectedByFog(ye),Li=m.getOrCreateProgram("raster",{defines:j.defines,overrideFog:Ln});if(m.uploadCommonUniforms(L,Li,Ne),V instanceof s.aU){const Ni=V.elevatedGlobeVertexBuffer,Fi=V.elevatedGlobeIndexBuffer;if(Z||!C)V.boundsBuffer&&V.boundsSegments&&Li.draw(m,B.TRIANGLES,Me,Pn.disabled,Y,En.disabled,wi,f.id,V.boundsBuffer,m.quadTriangleIndexBuffer,V.boundsSegments);else if(Ni&&Fi){const li=rn.zoom<=s.c_?V.elevatedGlobeSegments:V.getSegmentsForLongitude(rn.center.lng);li&&Li.draw(m,B.TRIANGLES,Me,Pn.disabled,Y,Se,wi,f.id,Ni,Fi,li)}}else if(R){Me=new cn(B.LEQUAL,cn.ReadOnly,m.depthRangeFor3D);const Ni=m.globeSharedBuffers;if(Ni){const[Fi,li,zn]=Ni.getGridBuffers(Dn,!1);Li.draw(m,B.TRIANGLES,Me,be||nt,m.colorModeForRenderPass(),Se,wi,f.id,Fi,li,zn)}}else{const{tileBoundsBuffer:Ni,tileBoundsIndexBuffer:Fi,tileBoundsSegments:li}=m.getTileBoundsBuffers(We);Li.draw(m,B.TRIANGLES,Me,nt,Y,En.disabled,wi,f.id,Ni,Fi,li)}}if(!(V instanceof s.aU)&&R)for(const ye of Ce){const Ne=ye.canonical.y===(1<<ye.canonical.z)-1;ye.canonical.y===0&&T_(!0,ye,m,a,f,W,j,Se,be||Pn.disabled),Ne&&T_(!1,ye,m,a,f,W,j,Se===En.frontCW?En.backCW:En.frontCW,be||Pn.disabled)}};R?Re(fe,m.renderElevatedRasterBackface?En.backCW:En.frontCW,m.stencilModeFor3D()):Re(fe,En.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,a,f,g,b,E){m.renderPass==="offscreen"&&function(C,I,R,L){if(!L.length)return;const B=C.context,V=B.gl,j=I.getSource();if(!(j instanceof Uo))return;const W=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let Y=R.particlePositionRGBAImage;if(!Y||Y.width!==W){const fe=function(ce){const Re=ce*ce,Ce=new Uint8Array(4*Re),Se=function(ye){return ye|=0,ye=Math.imul(2747636419^ye,2654435769),ye=Math.imul(ye^ye>>>16,2654435769),((ye=Math.imul(ye^ye>>>16,2654435769))>>>0)/4294967296},be=.9090909090909091;for(let ye=0;ye<Re;ye++){const Ne=be*(Se(2*ye+0)+_p),We=be*(Se(2*ye+1)+_p),Ze=255*Ne%1,tt=255*We%1,Je=Ze,mt=We-tt/255,xt=tt;Ce[4*ye+0]=255*(Ne-Ze/255),Ce[4*ye+1]=255*Je,Ce[4*ye+2]=255*mt,Ce[4*ye+3]=255*xt}return Ce}(W);Y=R.particlePositionRGBAImage=new s.q({width:W,height:W},fe)}let Z=R.particleFramebuffer;Z?Z.width!==W&&(Z.destroy(),Z=R.particleFramebuffer=B.createFramebuffer(W,W,1,null)):Z=R.particleFramebuffer=B.createFramebuffer(W,W,1,null);const J=[];for(const fe of L){const ce=I.getTile(fe);if(!(ce instanceof Uy))continue;const Re=jb(ce,j,R);if(!Re)continue;const Ce=[ce.tileSize,ce.tileSize];let Se=R.tileFramebuffer;Se||(Se=R.tileFramebuffer=B.createFramebuffer(Ce[0],Ce[1],1,null));let be=ce.rasterParticleState;be||(be=ce.rasterParticleState=new iC(B,fe,Ce,Y));const ye=be.update(R.lastInvalidatedAt);be.particleTextureDimension!==W&&be.updateParticleTexture(fe,Y);const Ne=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Ne;const We=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=We,J.push([fe,Re,be,ye])}if(J.length===0)return;const ie=s.o.now(),pe=R.previousDrawTimestamp?.001*(ie-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=ie,R.hasColorMap()){B.activeTexture.set(V.TEXTURE0+2);let fe=R.colorRampTexture;fe||(fe=R.colorRampTexture=new s.T(B,R.colorRamp,V.RGBA8)),fe.bind(V.LINEAR,V.CLAMP_TO_EDGE)}B.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(fe,ce,Re){const Ce=fe.context,Se=Ce.gl,be=ce.tileFramebuffer;Ce.activeTexture.set(Se.TEXTURE0);const ye={u_texture:0,u_opacity:1.05*(We=ce.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Ne=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const Ze of Re){const[,,tt,Je]=Ze;be.colorAttachment0.set(tt.targetColorTexture.texture),Ce.viewport.set([0,0,be.width,be.height]),Ce.clear({color:s.ao.transparent}),Je&&(tt.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),Ne.draw(fe,Se.TRIANGLES,cn.disabled,Pn.disabled,Nn.alphaBlended,En.disabled,ye,ce.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}}(C,R,J),function(fe,ce,Re,Ce){const Se=fe.context,be=Se.gl,ye=Re.tileFramebuffer,Ne=fe.transform.projection.name==="globe",We=Re.paint.get("raster-particle-max-speed");for(const Ze of Ce){const[tt,Je,mt]=Ze;Se.activeTexture.set(be.TEXTURE0+0),Je.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),ye.colorAttachment0.set(mt.targetColorTexture.texture);const xt=fe.getOrCreateProgram("rasterParticleDraw",{defines:Je.defines,overrideFog:!1});Se.activeTexture.set(be.TEXTURE0+1);const Xe=Je.scalarData?[]:[0,1,2,3].map(nt=>s.e9[nt](tt));Xe.push(tt);const Me=tt.canonical.x,dt=tt.canonical.y;for(const nt of Xe){const St=ce.getTile(Ne?nt.wrapped():nt);if(!St)continue;const Rt=St.rasterParticleState;if(!Rt)continue;const jt=nt.canonical.x+(1<<nt.canonical.z)*(nt.wrap-tt.wrap),Ot=nt.canonical.y;Rt.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Mt=q3(1,Rt.particleTexture0.size[0],[jt-Me,Ot-dt],0,Je.texture.size,2,We,Je.textureOffset,Je.scale,Je.offset);xt.draw(fe,be.POINTS,cn.disabled,Pn.disabled,Nn.alphaBlended,En.disabled,Mt,Re.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}}(C,I,R,J),B.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(fe,ce,Re,Ce){const Se=fe.context,be=Se.gl,ye=ce.paint.get("raster-particle-max-speed"),Ne=Ce*ce.paint.get("raster-particle-speed-factor")*.15,We=function(tt){return Math.pow(tt,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Ze=ce.particleFramebuffer;Se.viewport.set([0,0,Ze.width,Ze.height]);for(const tt of Re){const[,Je,mt]=tt;Se.activeTexture.set(be.TEXTURE0+0),Je.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Se.activeTexture.set(be.TEXTURE0+1);const xt=mt.particleTexture0;xt.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Xe=YI(1,xt.size[0],0,Je.texture.size,ye,Ne,We,Je.textureOffset,Je.scale,Je.offset);Ze.colorAttachment0.set(mt.particleTexture1.texture),Se.clear({color:s.ao.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:Je.defines}).draw(fe,be.TRIANGLES,cn.disabled,Pn.disabled,Nn.unblended,En.disabled,Xe,ce.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}}(C,R,J,pe)}(m,a,f,g),m.renderPass==="translucent"&&(function(C,I,R,L){const B=C.context,V=B.gl,j=I.getSource().tileSize,W=5*(1-s.ah(s.cL,s.cL+1,C.transform.zoom))*j+R.paint.get("raster-particle-elevation"),Y=!C.options.moving,Z=C.transform.projection.name==="globe";if(!L.length)return;const[J,ie]=C.stencilConfigForOverlap(L),pe=[];Z&&pe.push("PROJECTION_GLOBE_VIEW");const fe=C.stencilModeFor3D();for(const ce of ie){const Re=ce.toUnwrapped(),Ce=I.getTile(ce);if(!Ce.rasterParticleState)continue;const Se=Ce.rasterParticleState,be=100;Ce.registerFadeDuration(be);const ye=I.findLoadedParent(ce,0),Ne=Ig(Ce,ye,I,C.transform,be);let We,Ze;C.terrain&&C.terrain.prepareDrawTile(),B.activeTexture.set(V.TEXTURE0),Se.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),B.activeTexture.set(V.TEXTURE1),ye&&ye.rasterParticleState?(ye.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),We=Math.pow(2,ye.tileID.overscaledZ-Ce.tileID.overscaledZ),Ze=[Ce.tileID.canonical.x*We%1,Ce.tileID.canonical.y*We%1]):Se.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const tt=Z?Float32Array.from(C.transform.expandedFarZProjMatrix):C.transform.calculateProjMatrix(Re,Y),Je=C.transform,mt=rC(Je),xt=s.dG(ce.canonical),Xe=s.dH(xt.getCenter().lat);let Me,dt,nt,St,Rt;Z?(Me=Float32Array.from(s.bk(s.dJ(ce.canonical))),dt=Float32Array.from(Je.globeMatrix),nt=Float32Array.from(s.dF(Je)),St=[s.aF(Je.center.lng),s.aJ(Je.center.lat)],Rt=Float32Array.from(s.dI(ce.canonical,xt,Xe,Je.worldSize/Je._pixelsPerMercatorPixel))):(Me=new Float32Array(16),dt=new Float32Array(9),nt=new Float32Array(16),St=[0,0],Rt=new Float32Array(9));const jt=KI(tt,Me,dt,nt,Rt,Ze||[0,0],s.aj(C.transform.zoom),St,mt,We||1,Ne,W),Ot=C.isTileAffectedByFog(ce),Mt=C.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:Ot});if(C.uploadCommonUniforms(B,Mt,Re),Z){const rn=new cn(V.LEQUAL,cn.ReadOnly,C.depthRangeFor3D),tn=0,Gt=C.globeSharedBuffers;if(Gt){const[en,hn,Cn]=Gt.getGridBuffers(Xe,tn!==0);Mt.draw(C,V.TRIANGLES,rn,fe,Nn.alphaBlended,C.renderElevatedRasterBackface?En.frontCCW:En.backCCW,jt,R.id,en,hn,Cn)}}else{const rn=C.depthModeForSublayer(0,cn.ReadOnly),tn=J[ce.overscaledZ],{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:en,tileBoundsSegments:hn}=C.getTileBoundsBuffers(Ce);Mt.draw(C,V.TRIANGLES,rn,tn,Nn.alphaBlended,En.disabled,jt,R.id,Gt,en,hn)}}C.resetStencilClippingMasks()}(m,a,f,g),m.style.map.triggerRepaint())},background:function(m,a,f,g){const b=f.paint.get("background-color"),E=f.paint.get("background-color-use-theme").constantOr("default")==="none",C=f.paint.get("background-opacity"),I=f.paint.get("background-emissive-strength"),R=f.paint.get("background-pitch-alignment")==="viewport";if(C===0)return;const L=m.context,B=L.gl,V=m.transform,j=V.tileSize,W=f.paint.get("background-pattern");let Y;if(W!==void 0&&(W===null||(Y=m.imageManager.getPattern(s.I.from(W.toString()),f.scope,m.style.getLut(f.scope)),!Y)))return;const Z=!W&&b.a===1&&C===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Z)return;const J=Pn.disabled,ie=m.depthModeForSublayer(0,Z==="opaque"?cn.ReadWrite:cn.ReadOnly),pe=m.colorModeForDrapableLayerRenderPass(I),fe=W?"backgroundPattern":"background";let ce,Re=g;Re||(ce=m.getBackgroundTiles(),Re=Object.values(ce).map(Se=>Se.tileID)),W&&(L.activeTexture.set(B.TEXTURE0),m.imageManager.bind(m.context,f.scope));const Ce=[];if(m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Ce.push("USE_MRT1"),R){const Se=m.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0,defines:Ce}),be=new Float32Array(s.bA([])),ye=new s.aQ(0,0,0,0,0),Ne=W?Og(be,I,C,m,0,f.scope,Y,R,{tileID:ye,tileSize:j}):Ud(be,I,C,b.toPremultipliedRenderColor(E?null:f.lut));return void Se.draw(m,B.TRIANGLES,ie,J,pe,En.disabled,Ne,f.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}for(const Se of Re){const be=m.isTileAffectedByFog(Se),ye=m.getOrCreateProgram(fe,{overrideFog:be,defines:Ce}),Ne=Se.toUnwrapped(),We=g?Se.projMatrix:m.transform.calculateProjMatrix(Ne);m.prepareDrawTile();const Ze=a?a.getTile(Se):ce?ce[Se.key]:new Rd(Se,j,V.zoom,m),tt=W?Og(We,I,C,m,0,f.scope,Y,R,{tileID:Se,tileSize:j}):Ud(We,I,C,b.toPremultipliedRenderColor(E?null:f.lut));m.uploadCommonUniforms(L,ye,Ne);const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:mt,tileBoundsSegments:xt}=m.getTileBoundsBuffers(Ze);ye.draw(m,B.TRIANGLES,ie,J,pe,En.disabled,tt,f.id,Je,mt,xt)}},sky:function(m,a,f){const g=m._atmosphere?s.aj(m.transform.zoom):1,b=f.paint.get("sky-opacity")*g;if(b===0)return;const E=m.context,C=f.paint.get("sky-type"),I=new cn(E.gl.LEQUAL,cn.ReadOnly,[0,1]),R=m.frameCounter/1e3%1;C==="atmosphere"?m.renderPass==="offscreen"?f.needsSkyboxCapture(m)&&(function(L,B){const V=L.context,j=V.gl;let W=B.skyboxFbo;if(!W){W=B.skyboxFbo=V.createFramebuffer(32,32,1,null),B.skyboxGeometry=new _a(V),B.skyboxTexture=V.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,B.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ie=0;ie<6;++ie)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(W.framebuffer),V.viewport.set([0,0,32,32]);const Y=B.getCenter(L,!0),Z=L.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);s.bA(J),s.en(J,J,.5*-Math.PI),Wd(L,B,Z,J,Y,0),s.bA(J),s.en(J,J,.5*Math.PI),Wd(L,B,Z,J,Y,1),s.bA(J),s.cU(J,J,.5*-Math.PI),Wd(L,B,Z,J,Y,2),s.bA(J),s.cU(J,J,.5*Math.PI),Wd(L,B,Z,J,Y,3),s.bA(J),Wd(L,B,Z,J,Y,4),s.bA(J),s.en(J,J,Math.PI),Wd(L,B,Z,J,Y,5),V.viewport.set([0,0,L.width,L.height])}(m,f),f.markSkyboxValid(m)):m.renderPass==="sky"&&function(L,B,V,j,W){const Y=L.context,Z=Y.gl,J=L.transform,ie=L.getOrCreateProgram("skybox");Y.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,B.skyboxTexture);const pe=((fe,ce,Re,Ce,Se)=>({u_matrix:fe,u_sun_direction:ce,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Se}))(J.skyboxMatrix,B.getCenter(L,!1),0,j,W);L.uploadCommonUniforms(Y,ie),ie.draw(L,Z.TRIANGLES,V,Pn.disabled,L.colorModeForRenderPass(),En.backCW,pe,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,f,I,b,R):C==="gradient"&&m.renderPass==="sky"&&function(L,B,V,j,W){const Y=L.context,Z=Y.gl,J=L.transform,ie=L.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new _a(Y)),Y.activeTexture.set(Z.TEXTURE0);let pe=B.colorRampTexture;pe||(pe=B.colorRampTexture=new s.T(Y,B.colorRamp,Z.RGBA8)),pe.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const fe=((ce,Re,Ce,Se,be)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:Re,u_radius:s.an(Ce),u_opacity:Se,u_temporal_offset:be}))(J.skyboxMatrix,B.getCenter(L,!1),B.paint.get("sky-gradient-radius"),j,W);L.uploadCommonUniforms(Y,ie),ie.draw(L,Z.TRIANGLES,V,Pn.disabled,L.colorModeForRenderPass(),En.backCW,fe,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,f,I,b,R)},custom:function(m,a,f,g){const b=m.context,E=f.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&f.isDraped(a)){if(m.renderPass==="offscreen"){const C=E.prerender;if(C){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;C.call(E,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else C.call(E,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const I=E.renderToTile;if(I){const R=g[0].canonical,L={x:R.x+g[0].wrap*(E.wrapTileId?0:1<<R.z),y:R.y,z:R.z};b.setDepthMode(cn.disabled),b.setStencilMode(Pn.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(E,b.gl,L),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(Pn.disabled);const C=E.renderingMode==="3d"?new cn(m.context.gl.LEQUAL,cn.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,cn.ReadOnly);if(b.setDepthMode(C),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;E.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else E.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,a,f,g){if(m.renderPass==="opaque")return;const b=f.paint.get("model-opacity").constantOr(1),E=f.paint.get("model-elevation-reference"),C=E==="ground",I=E==="ground";if(b===0)return;const R=f.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!R||m.terrain&&b<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const L=m.shadowRenderer,B=f.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,B||(L.enabled=!1));const V=()=>{L&&(L.useNormalOffset=!0,B||(L.enabled=!0))},j=a.getSource();if(m.renderPass==="light-beam"&&j.type!=="batched-model")return;if(j.type==="vector"||j.type==="geojson")return function(ce,Re,Ce,Se,be){const ye=ce.transform,Ne=ye.projection.name==="globe",We=ye.getFreeCameraOptions().position;if(!ce.modelManager)return;const Ze=ce.modelManager;Ce.modelManager=Ze;const tt=ce.shadowRenderer;if(!Ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Je=Ce._unevaluatedLayout._values["model-id"],mt=Object.assign({},Ce.layout.get("model-id").parameters),xt=ce.style.order.indexOf(Ce.fqid),Xe=Ce.paint.get("model-opacity").constantOr(1);for(const Me of Se){const dt=Re.getTile(Me).getBucket(Ce);if(!dt||dt.projection.name!==ye.projection.name)continue;const nt=dt.getModelUris();if(nt&&!dt.modelsRequested&&(Ze.addModelsFromBucket(nt,be),dt.modelsRequested=!0),Ne)mt.zoom=Me.overscaledZ;else{const Gt=kt(Me,ye);mt.zoom=Gt}const St=Je.possiblyEvaluate(mt);if(Xh(ce,dt,Me),Ho.shadowUniformsInitialized=!1,Ho.useSingleShadowCascade=!!tt&&tt.getMaxCascadeForTile(Me.toUnwrapped())===0,ce.renderPass==="shadow"&&tt){if(ce.currentShadowCascade===1&&dt.isInsideFirstShadowMapFrustum)continue;const Gt=ye.calculatePosMatrix(Me.toUnwrapped(),ye.worldSize);if(Ho.tileMatrix.set(Gt),Ho.shadowTileMatrix=Float32Array.from(tt.calculateShadowPassMatrixFromMatrix(Gt)),Ho.aabb.min=[0,0,0],Ho.aabb.max[0]=Ho.aabb.max[1]=s.al,Ho.aabb.max[2]=0,Tr(dt,Ho,ce,Ce.scope))continue}const Rt=1<<Me.canonical.z,jt=[((We.x-Me.wrap)*Rt-Me.canonical.x)*s.al,(We.y*Rt-Me.canonical.y)*s.al,We.z*Rt*s.al];ce.conflationActive&&Object.keys(dt.instancesPerModel).length>0&&ce.style.isLayerClipped(Ce,Re.getSource())&&dt.updateReplacement(Me,ce.replacementSource,xt,Ce.scope)&&(dt.uploaded=!1,dt.upload(ce.context));let Ot=0;const Mt=new Array,rn=new Array,tn=new Array;for(let Gt in dt.instancesPerModel){const en=dt.instancesPerModel[Gt];en.features.length>0&&!Ne&&(Gt=St.evaluate(en.features[0].feature,{}));const hn=Ze.getModel(Gt,be);if(hn||Ze.hasURLBeenRequested(Gt)||dt.modelUris.includes(Gt)||(dt.modelUris.push(Gt),dt.modelsRequested=!1),hn&&hn.uploaded)if(Ne){const Cn=s.c5([],[We.x,We.y,We.z],ce.transform.worldSize);s.ew(Cn,Cn);for(let Vn=0;Vn<en.instancedDataArray.length;++Vn){const ci=[0,0,0],Dn=[1,1,1],wi=s.ex(),Ln=en.tileCoordinatesForInstance(Vn),Li=en.transformForInstance(Vn);s.ey(Dn,Li),s.ez(wi,Li),s.eA(ci,wi);const Ni=en.translationForInstance(Vn),Fi=new s.aT(0,0);s.eB(dt.canonical,Fi,Ln.x,Ln.y);const li=s.bC();s.eC(li,hn,ce.transform,Fi,ci,Dn,Ni,!0,!1,!1);const zn=en.colorForInstance(Vn),Ii=s.bA([]),fr=s.ef(Fi.lat,ce.transform.zoom),pr=s.bq([],[1,1,1/fr]);s.br(Ii,Ii,Cn),tn.push({zScaleMatrix:pr,negCameraPosMatrix:Ii});for(const Pi of hn.nodes)Mg(ce,Pi,li,ce.transform.expandedFarZProjMatrix,Ot,Mt,rn,hn.materialOverrides,Xe,zn);++Ot}}else for(const Cn of hn.nodes)Vt(ce,Ce,Cn,en,jt,Me,Ho)}if(Ne)if(ce.renderPass==="shadow"){for(const Gt of rn)xp(Gt.mesh,Gt.nodeModelMatrix,ce,Ce);for(const Gt of Mt)xp(Gt.mesh,Gt.nodeModelMatrix,ce,Ce)}else Xb(ce,Ce,Mt,rn,tn)}}(m,a,f,g,Ng(m,f)),void V();if(!j.loaded())return;if(j.type==="batched-model")return function(ce,Re,Ce,Se){Ce.resetLayerRenderingStats(ce);const be=ce.context,ye=ce.transform,Ne=ce.style.fog,We=ce.shadowRenderer;if(ye.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ye.projection.name} projection is not yet implemented`);const Ze=ce.transform.getFreeCameraOptions().position,tt=s.c5([],[Ze.x,Ze.y,Ze.z],ce.transform.worldSize),Je=s.ew([],tt),mt=s.bA([]),xt=s.ef(ye.center.lat,ye.zoom),Xe=s.bq([],[1,1,1/xt]);s.br(mt,mt,Je);const Me=Ce.paint.get("model-opacity").constantOr(1),dt=new cn(be.gl.LEQUAL,cn.ReadWrite,ce.depthRangeFor3D),nt=new cn(be.gl.LEQUAL,cn.ReadOnly,ce.depthRangeFor3D),St=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Rt=ce.renderPass==="shadow",jt=Rt&&We?We.getCurrentCascadeFrustum():ye.getFrustum(ye.scaleZoom(ye.worldSize)),Ot=Ce.paint.get("model-front-cutoff"),Mt=Ot[2]<1,rn=jc(ce,Ce.paint.get("model-cutoff-fade-range")),tn=Ce.getLayerRenderingStats();(function(Gt,en,hn,Cn){const Vn=Gt.terrain?Gt.terrain.exaggeration():0,ci=Gt.transform.zoom;for(const Dn of Cn){const wi=en.getTile(Dn).getBucket(hn);wi&&(wi.setFilter(hn.filter),Gt.conflationActive&&wi.updateReplacement(Dn,Gt.replacementSource),wi.evaluateTransform(Gt,hn),Gt.terrain&&Vn>0&&wi.elevationUpdate(Gt.terrain,Vn,Dn,hn.source),wi.needsReEvaluation(Gt,ci,hn)&&wi.evaluate(hn))}})(ce,Re,Ce,Se),function(){let Gt,en,hn;Mt?(Gt=Se.length-1,en=-1,hn=-1):(Gt=0,en=Se.length,hn=1);const Cn=new Float64Array(16),Vn=s.cA(),ci=new s.P(0,0);for(let Dn=Gt;Dn!==en;Dn+=hn){const wi=Se[Dn],Ln=Re.getTile(wi).getBucket(Ce);if(!Ln||!Ln.uploaded)continue;let Li=!1;We&&(Li=We.getMaxCascadeForTile(wi.toUnwrapped())===0);const Ni=ye.calculatePosMatrix(wi.toUnwrapped(),ye.worldSize),Fi=Ln.modelTraits;!Rt&&Mt&&(s.bl(Cn,Ni),s.af(Vn,tt,Cn),ci.x=Vn[0],ci.y=Vn[1]);const li=[];Ln.setFilter(Ce.filter);for(const zn of Ln.getNodesInfo()){if(zn.hiddenByReplacement||!zn.node.meshes)continue;const Ii=zn.node;let fr=0;ce.terrain&&Ii.elevation&&(fr=Ii.elevation*ce.terrain.exaggeration());const pr=(()=>{const Ri=zn.aabb;return St.min=[...Ri.min],St.max=[...Ri.max],St.min[2]+=fr,St.max[2]+=fr,s.af(St.min,St.min,Ni),s.af(St.max,St.max,Ni),St})(),Pi=zn.evaluatedScale;if(Pi[0]<=1&&Pi[1]<=1&&Pi[2]<=1&&pr.intersects(jt)===0)continue;if(!Rt&&Mt){const Ri=.16666666666666666;zn.cameraCollisionOpacity=tt[0]>pr.min[0]&&tt[0]<pr.max[0]&&tt[1]>pr.min[1]&&tt[1]<pr.max[1]&&tt[2]*xt<pr.max[2]&&Ii.footprint&&s.c0(ci,Ii.footprint)?Math.max(zn.cameraCollisionOpacity-Ri,0):Math.min(1,zn.cameraCollisionOpacity+Ri)}const ni=[...Ni],jn=1/s.d7(wi.canonical),Ki=Ii.anchor?Ii.anchor[0]:0,Ar=Ii.anchor?Ii.anchor[1]:0;s.br(ni,ni,[Ki*(Pi[0]-1)+zn.evaluatedTranslation[0]*jn,Ar*(Pi[1]-1)+zn.evaluatedTranslation[1]*jn,fr+zn.evaluatedTranslation[2]]),s.cq(Pi,s.eE)||s.cS(ni,ni,Pi);const nr=s.aB([],ni,Ii.globalMatrix),or=s.aB([],ye.expandedFarZProjMatrix,nr),qo=s.aB([],ye.expandedFarZProjMatrix,ni),wa=s.aC([],[Ki,Ar,fr,1],or)[2];Ii.hidden=!1;let Rs=Me;Rt||(Mt&&(Rs*=zn.cameraCollisionOpacity,Rs*=dC(ni,ye,zn.aabb,Ot)),Rs*=Ke(rn,wa)),Rs!==0?li.push({nodeInfo:zn,depth:wa,opacity:Rs,wvpForNode:or,wvpForTile:qo,nodeModelMatrix:nr,tileModelMatrix:ni}):Ii.hidden=!0}Rt||li.sort((zn,Ii)=>!Mt||zn.opacity===1&&Ii.opacity===1?zn.depth<Ii.depth?-1:1:zn.opacity===1?-1:Ii.opacity===1?1:zn.depth>Ii.depth?-1:1);for(const zn of li){const Ii=zn.nodeInfo,fr=Ii.node;let pr=s.aB([],Xe,zn.tileModelMatrix);s.aB(pr,mt,pr);const Pi=s.bl([],pr);s.eg(Pi,Pi),s.cS(Pi,Pi,Ep),pr=s.aB(pr,pr,fr.globalMatrix);const ni=ce.renderPass==="light-beam",jn=Ce.paint.get("model-color-use-theme").constantOr("default")==="none",Ki=Fi&s.eI.HasMapboxMeshFeatures,Ar=Ki?0:Ii.evaluatedRMEA[0][2];for(let nr=0;nr<fr.meshes.length;++nr){const or=fr.meshes[nr],qo=nr===fr.lightMeshIndex;let wa=zn.wvpForNode;if(qo){if(!ni&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}wa=zn.wvpForTile}else if(ni)continue;const Rs={defines:[]},Ri=[];if(!Rt&&We&&(We.useNormalOffset=!!or.normalBuffer),Cl(Rs.defines,Ri,or,ce,jn?null:Ce.lut),Ki||Rs.defines.push("DIFFUSE_SHADED"),Li&&Rs.defines.push("SHADOWS_SINGLE_CASCADE"),tn&&(Rt?tn.numRenderedVerticesInShadowPass+=or.vertexArray.length:tn.numRenderedVerticesInTransparentPass+=or.vertexArray.length),Rt){xp(or,zn.nodeModelMatrix,ce,Ce);continue}let Ma=null;if(Ne){const jr=Yb(zn.nodeModelMatrix,ce.transform);if(Ma=new Float32Array(jr),ye.projection.name!=="globe"){const ir=or.aabb.min,Jr=or.aabb.max,[uo,Lr]=Ne.getOpacityForBounds(jr,ir[0],ir[1],Jr[0],Jr[1]);Rs.overrideFog=uo>=Xt||Lr>=Xt}}const eo=or.material;let Zo;eo.occlusionTexture&&eo.occlusionTexture.offsetScale&&(Zo=eo.occlusionTexture.offsetScale,Rs.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Hc=ce.getOrCreateProgram("model",Rs);!Rt&&We&&We.setupShadowsFromMatrix(zn.tileModelMatrix,Hc,We.useNormalOffset),ce.uploadCommonUniforms(be,Hc,null,Ma);const Ko=eo.pbrMetallicRoughness;Ko.metallicFactor=.9,Ko.roughnessFactor=.5;const gr=w_(new Float32Array(wa),new Float32Array(pr),new Float32Array(Pi),new Float32Array(fr.globalMatrix),ce,zn.opacity,Ko.baseColorFactor,eo.emissiveFactor,Ko.metallicFactor,Ko.roughnessFactor,eo,Ar,Ce,[0,0,0],Zo);!qo&&(Ii.hasTranslucentParts||zn.opacity<1)&&Hc.draw(ce,be.gl.TRIANGLES,dt,Pn.disabled,Nn.disabled,En.backCCW,gr,Ce.id,or.vertexBuffer,or.indexBuffer,or.segments,Ce.paint,ce.transform.zoom,void 0,Ri),Hc.draw(ce,be.gl.TRIANGLES,qo?nt:dt,Pn.disabled,qo||zn.opacity<1||Ii.hasTranslucentParts?Nn.alphaBlended:Nn.unblended,En.backCCW,gr,Ce.id,or.vertexBuffer,or.indexBuffer,or.segments,Ce.paint,ce.transform.zoom,void 0,Ri)}}}}()}(m,a,f,g),void V();if(j.type!=="model")return;const W=j.getModels(),Y=[],Z=m.transform.getFreeCameraOptions().position,J=s.c5([],[Z.x,Z.y,Z.z],m.transform.worldSize);s.ew(J,J);const ie=[],pe=[];let fe=0;for(const ce of W){const Re=a.getFeatureState("",ce.id),Ce={type:"Unknown",id:ce.id,properties:ce.featureProperties},Se=f.paint.get("model-rotation").evaluate(Ce,Re),be=f.paint.get("model-scale").evaluate(Ce,Re),ye=f.paint.get("model-translation").evaluate(Ce,Re),Ne=f.paint.get("model-opacity").evaluate(Ce,Re);lC(f,ce.id,Re,ce.featureProperties,ce.nodeOverrideNames,ce.nodeOverrides),uC(f,ce.id,Re,ce.featureProperties,ce.materialOverrideNames,ce.materialOverrides),ce.nodeOverrides.size>0&&ce.computeBoundsAndApplyParent(),ce.computeModelMatrix(m,Se,be,ye,I,C,!1);const We=s.bA([]),Ze=s.ef(ce.position.lat,m.transform.zoom),tt=s.bq([],[1,1,1/Ze]);s.br(We,We,J),Y.push({zScaleMatrix:tt,negCameraPosMatrix:We});for(const Je of ce.nodes)Mg(m,Je,ce.matrix,m.transform.expandedFarZProjMatrix,fe,ie,pe,ce.materialOverrides,Ne);fe++}if(ie.sort((ce,Re)=>Re.depth-ce.depth),m.renderPass!=="shadow")Xb(m,f,ie,pe,Y),V();else{for(const ce of pe)xp(ce.mesh,ce.nodeModelMatrix,m,f);for(const ce of ie)xp(ce.mesh,ce.nodeModelMatrix,m,f);V()}}},iv={line:function(m,a,f){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(a){const g=a.getVisibleCoordinates();for(const b of g){const E=a.getTile(b).getBucket(m);if(E&&(E.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,a,f){const g=a.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(f.modelManager&&f.modelManager.upload(f,Ng(f,m)));if(g.type==="batched-model"||g.type!=="model")return;const b=g.getModels();for(const E of b)E.upload(f.context)},raster:function(m,a,f){const g=a.getSource();if(!(g instanceof Uo&&g.loaded()))return;const b=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!b)return;const E=m.paint.get("raster-array-band")||g.getInitialBand(b);if(E==null)return;const C=a.getIds().map(I=>a.getTileByID(I));for(const I of C)I.updateNeeded(m.id,E)&&g.prepareTile(I,b,m.id,E)},"raster-particle":function(m,a,f){const g=a.getSource();if(!(g instanceof Uo&&g.loaded()))return;const b=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!b)return;const E=m.paint.get("raster-particle-array-band")||g.getInitialBand(b);if(E==null)return;const C=a.getIds().map(I=>a.getTileByID(I));for(const I of C)I.updateNeeded(m.id,E)&&g.prepareTile(I,b,m.id,E)}},rv={fill:Fb},pC={fill:function(m,a,f,g){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const b=m.context.gl,E=new cn(b.LEQUAL,cn.ReadOnly,m.depthRangeFor3D),C=new Pn({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),I=m.transform.getFreeCameraOptions().position,R=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of g){const B=a.getTile(L),V=B.getBucket(f);if(!V)continue;const j=V.elevatedStructures;if(!j||j.depthSegments.segments[0].primitiveLength===0)continue;const W=Bb(L.toUnwrapped(),I),Y=m.translatePosMatrix(L.projMatrix,B,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),Z=Zh(Y,W,0,1,0);R.draw(m,b.TRIANGLES,E,C,Nn.disabled,En.disabled,Z,f.id,j.vertexBuffer,j.indexBuffer,j.depthSegments,f.paint,m.transform.zoom)}}};class mC{constructor(a,f,g,b,E){this.context=new v_(a,f),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of C)this._debugParams.enabledLayers[R]=!0;for(const R of C);this.occlusionParams=new Qb,this.setup(),this.numSublayers=ha.maxUnderzooming+ha.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wg(this),this._wireframeDebugCache=new Jb,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,I,a.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=b,this.worldview=E,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(a,f){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ib(this,a));const b=this._terrain;this.transform.elevation=g?b:null,b.update(a,this.transform,f),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(a){const f=a.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,b]=f.getFovAdjustedRange(this.transform._fov);if(g>b)return void(this.transform.fogCullDistSq=null);const E=g+.78*(b-g);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(a){a&&!this._terrain&&(this._terrain=new Ib(this,this.style)),this._forceTerrainMode=a}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,f){if(this.width=a*s.o.devicePixelRatio,this.height=f*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const a=this.context,f=new s.bd;f.emplaceBack(0,0),f.emplaceBack(s.al,0),f.emplaceBack(0,s.al),f.emplaceBack(s.al,s.al),this.tileExtentBuffer=a.createVertexBuffer(f,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const g=new s.bd;g.emplaceBack(0,0),g.emplaceBack(s.al,0),g.emplaceBack(0,s.al),g.emplaceBack(s.al,s.al),this.debugBuffer=a.createVertexBuffer(g,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const b=new s.bd;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(b,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const E=new s.b1;E.emplaceBack(0,0,0,0),E.emplaceBack(s.al,0,s.al,0),E.emplaceBack(0,s.al,0,s.al),E.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=a.createVertexBuffer(E,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const C=new s.b0;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(C);const I=new s.be;for(const L of[0,1,3,2,0])I.emplaceBack(L);this.debugIndexBuffer=a.createIndexBuffer(I),this.emptyTexture=new s.T(a,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA8),this.identityMat=s.bC();const R=this.context.gl;this.stencilClearMode=new Pn({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,cn.disabled,this.stencilClearMode,Nn.disabled,En.disabled,Sg(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,f,g){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const R of g)if(this._tileClippingMaskIDs[R.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=f.id;const b=this.context,E=b.gl;this.nextStencilID+g.length>256&&this.clearStencil(),b.setColorMode(Nn.disabled),b.setDepthMode(cn.disabled);const C=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of g){const R=f.getTile(I),L=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:V,tileBoundsSegments:j}=this.getTileBoundsBuffers(R);C.draw(this,E.TRIANGLES,cn.disabled,new Pn({func:E.ALWAYS,mask:0},L,255,E.KEEP,E.KEEP,E.REPLACE),Nn.disabled,En.disabled,Sg(I.projMatrix),"$clipping",B,V,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new Pn({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new Pn({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,g=a.sort((C,I)=>I.overscaledZ-C.overscaledZ),b=g[g.length-1].overscaledZ,E=g[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const C={};for(let I=0;I<E;I++)C[I+b]=new Pn({func:f.GEQUAL,mask:255},I+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=E,[C,g]}return[{[b]:Pn.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Nn([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Nn.unblended:Nn.alphaBlended}colorModeForDrapableLayerRenderPass(a){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?a!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Nn([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,a??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Nn([f.ONE,f.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,f.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(a,f,g,b=!1){if(this.depthOcclusion)return new cn(this.context.gl.GREATER,cn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return cn.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new cn(g||this.context.gl.LEQUAL,f,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const a=this.context.gl,f=Math.ceil(this.width),g=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),E=a.getParameter(a.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===f&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),f!==0&&g!==0&&(this.depthFBO=new Yh(this.context,f,g,0,"texture"),this.depthTexture=new s.T(this.context,{width:f,height:g,data:null},a.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),a.bindTexture(a.TEXTURE_2D,E),this.depthFBO&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),a.blitFramebuffer(0,0,f,g,0,0,f,g,a.DEPTH_BUFFER_BIT,a.NEAREST),a.bindFramebuffer(a.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((a,f)=>a+f/this._fpsHistory.length,0))}render(a,f){const g=s.o.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=f;const b=this.style._mergedLayers,E=!(!this.terrain||!this.terrain.enabled),C=()=>this.style._getOrder(E).filter(Xe=>{const Me=b[Xe];return!(Me.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Me.type]});let I=C(),R=!1,L=!1,B=null,V=0,j=!1;for(const Xe of I){const Me=b[Xe];Me.visibility!=="none"&&(Me.type==="circle"?R=!0:Me.type==="building"?(B=Me,++V):Me.type==="symbol"&&(Me.hasOcclusionOpacityProperties?L=!0:R=!0))}this.updateEmissiveMode();let W=I.map(Xe=>b[Xe]);const Y=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const Xe in Y){const Me=Y[Xe];Me.used&&(Me.prepare(this.context),Me.getSource().usedInConflation&&++V)}let Z=!1;for(const Xe of W)Xe.isHidden(this.transform.zoom)||(Xe.type==="clip"&&(Z=!0),this.prepareLayer(Xe));const J={},ie={},pe={},fe={},ce={};for(const Xe in Y){const Me=Y[Xe];J[Xe]=Me.getVisibleCoordinates(),ie[Xe]=J[Xe].slice().reverse(),pe[Xe]=Me.getVisibleCoordinates(!0).reverse(),fe[Xe]=Me.getShadowCasterCoordinates(),ce[Xe]=Me.sortCoordinatesByDistance(J[Xe])}const Re=Xe=>{const Me=this.style.getLayerSourceCache(Xe);return Me&&Me.used?Me.getSource():null};if(V||Z||this._clippingActiveLastFrame){const Xe=[],Me=[];let dt=0;for(const nt of W)this.isSourceForClippingOrConflation(nt,Re(nt))&&(Xe.push(nt),Me.push(dt)),dt++;if(Xe&&(Z||Xe.length>1)||this._clippingActiveLastFrame){Z=!1;const nt=[];for(let St=0;St<Xe.length;St++){const Rt=Xe[St],jt=Me[St],Ot=this.style.getLayerSourceCache(Rt);if(!Ot||!Ot.used||!Ot.getSource().usedInConflation&&Rt.type!=="clip"&&Rt.type!=="building")continue;let Mt=s.eQ,rn=s.b_.None;const tn=[];let Gt=!0;if(Rt.type==="building")Mt=s.eS;else if(Rt.type==="clip")if(Mt=jt,Rt.isHidden(this.transform.zoom))Gt=!1;else{if(!Rt.layout){Gt=!1;continue}for(const en of Rt.layout.get("clip-layer-types"))rn|=en==="model"?s.b_.Model:en==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const en of Rt.layout.get("clip-layer-scope"))tn.push(en);Z=!0}Gt&&nt.push({layer:Rt.fqid,cache:Ot,order:Mt,clipMask:rn,clipScope:tn})}this.replacementSource.setSources(nt),j=!0}}this._clippingActiveLastFrame=Z,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Xe=0;Xe<W.length;Xe++){const Me=W[Xe];if(Me.visibility==="none")continue;const dt=Me.cutoffRange();if(this.longestCutoffRange=Math.max(dt,this.longestCutoffRange),dt>0){const nt=Re(Me);nt&&(this.minCutoffZoom=Math.max(nt.minzoom,this.minCutoffZoom)),Me.minzoom&&(this.minCutoffZoom=Math.max(Me.minzoom,this.minCutoffZoom))}Me.is3D(E)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Xe),this._lastOcclusionLayer=Xe)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,I=C(),W=I.map(Xe=>b[Xe]));const Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(const Xe in Y)for(const Me of J[Xe]){let dt={min:0,max:0};this.terrain&&(dt=this.terrain.getMinMaxForTile(Me)||dt),Se.addShadowReceiver(Me.toUnwrapped(),dt.min,dt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zb(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(be&&!this._snow&&(this._snow=new Bg(this)),!be&&this._snow&&(this._snow.destroy(),delete this._snow),ye&&!this._rain&&(this._rain=new fC(this)),!ye&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),B){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Kb);const Xe=this.style.getLayerSourceCache(B);this.buildingTileBorderManager.updateBorders(Xe,B)}if(!Xs.has(this.context.gl))return;this.renderPass="offscreen";for(const Xe of W){const Me=a.getLayerSourceCache(Xe);if(!Xe.hasOffscreenPass()||Xe.isHidden(this.transform.zoom))continue;const dt=Me?ie[Me.id]:void 0;(Xe.type==="custom"||Xe.type==="raster"||Xe.type==="raster-particle"||Xe.isSky()||dt&&dt.length)&&this.renderLayer(this,Me,Xe,dt)}this.depthRangeFor3D=[0,1-(W.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,fe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ne=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(f.showOverdrawInspector)return s.ao.black;const Xe=this.style.fog;if(Xe&&this.transform.projection.supportsFog){const Me=this.style.getLut(Xe.scope);if(!Ne){const dt=Xe.properties.get("color-use-theme")==="none",nt=Xe.properties.get("color").toNonPremultipliedRenderColor(dt?null:Me).toArray01();return new s.ao(...nt)}if(Ne){const dt=Xe.properties.get("space-color-use-theme")==="none",nt=Xe.properties.get("space-color").toNonPremultipliedRenderColor(dt?null:Me).toArray01();return new s.ao(...nt)}}return s.ao.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ne&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Xe=W[this.currentLayer],Me=a.getLayerSourceCache(Xe);if(Xe.isSky())continue;const dt=Me?(Xe.is3D(E)?ce:ie)[Me.id]:void 0;this._renderTileClippingMasks(Xe,Me,dt),this.renderLayer(this,Me,Xe,dt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ne&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Xe=W[this.currentLayer],Me=a.getLayerSourceCache(Xe);Xe.isSky()&&this.renderLayer(this,Me,Xe,Me?ie[Me.id]:void 0)}function Ze(Xe,Me){let dt;return Me&&(dt=(Xe.type==="symbol"?pe:Xe.is3D(E)?ce:ie)[Me.id]),dt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Xe=W[this.currentLayer];if(Xe.type==="raster"||Xe.type==="raster-particle"){const Me=a.getLayerSourceCache(Xe);this.renderLayer(this,Me,Xe,Ze(Xe,Me))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const tt=Se?Se.getGroundShadowLayerIndex():-1;let Je=!1,mt=-1;for(let Xe=0;Xe<I.length;++Xe){const Me=W[Xe];Me.isHidden(this.transform.zoom)||Me.is3D(E)&&(mt=Xe)}L&&mt===-1&&(R=!0);let xt=!1;for(;this.currentLayer<I.length;){const Xe=W[this.currentLayer],Me=a.getLayerSourceCache(Xe);if(Xe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Xe)){if(Xe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!xt&&Xe.is3D(E)&&!E){const dt=this.currentLayer,nt=St=>{for(this.currentLayer=0;this.currentLayer<W.length;this.currentLayer++){const Rt=W[this.currentLayer];if(rv[Rt.type]){const jt=this.style.getLayerSourceCache(Rt);rv[Rt.type](this,jt,Rt,Ze(Rt,jt),St)}}};nt("initialize"),nt("reset"),this.currentLayer=dt,xt=!0}if(R&&!Je&&this.terrain&&!this.transform.isOrthographic&&(Je=!0,this.blitDepth()),L&&mt!==-1&&this.currentLayer===mt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Xe,Me,Me?J[Me.id]:void 0),this.renderLayer(this,Me,Xe,Ze(Xe,Me)),!this.terrain&&Se&&this.currentLayer===tt){{this.clearStencil(),this.resetStencilClippingMasks();const dt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<W.length;this.currentLayer++){const nt=W[this.currentLayer];if(pC[nt.type]){const St=this.style.getLayerSourceCache(nt);pC[nt.type](this,St,nt,Ze(nt,St))}}this.currentLayer=dt}if(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const dt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=dt;this.currentLayer++){const nt=W[this.currentLayer];if(!nt.hasLightBeamPass())continue;const St=a.getLayerSourceCache(nt);this.renderLayer(this,St,nt,St?ie[St.id]:void 0)}this.currentLayer=dt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const dt=this.currentLayer;this.depthOcclusion=!0;for(const nt of this.layersWithOcclusionOpacity){this.currentLayer=nt;const St=W[this.currentLayer],Rt=a.getLayerSourceCache(St),jt=Rt?ie[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(St,Rt,Rt?J[Rt.id]:void 0),this.renderLayer(this,Rt,St,jt)}this.depthOcclusion=!1,this.currentLayer=dt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Xe=null;W.forEach(Me=>{const dt=a.getLayerSourceCache(Me);dt&&!Me.isHidden(this.transform.zoom)&&dt.getVisibleCoordinates().length&&(!Xe||Xe.getSource().maxzoom<dt.getSource().maxzoom)&&(Xe=dt)}),Xe&&this.options.showTileBoundaries&&sC(this,Xe,Xe.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&sC(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Xe){const Me=Xe.transform.padding;oC(Xe,Xe.transform.height-(Me.top||0),3,Vb),oC(Xe,Me.bottom||0,3,Wb),Gb(Xe,Me.left||0,3,Hb),Gb(Xe,Xe.transform.width-(Me.right||0),3,JI);const dt=Xe.transform.centerPoint;(function(nt,St,Rt,jt){A_(nt,St-1,Rt-10,2,20,jt),A_(nt,St-10,Rt-1,20,2,jt)})(Xe,dt.x,Xe.transform.height-dt.y,QI)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:f}=this.transform.projection,g=!f||!f.includes(a.type);if(iv[a.type]&&(g||this.terrain&&a.type==="custom")){const b=this.style.getLayerSourceCache(a);iv[a.type](a,b,this)}this.gpuTimingEnd()}renderLayer(a,f,g,b){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||b&&b.length)&&(this.id=g.id,this.gpuTimingStart(g),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(g.type)&&(!a.terrain||g.type!=="custom")||g.type==="clip"||Jh[g.type](a,f,g,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,g=this.context.gl;let b=this.gpuTimers[a.id];b||(b=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:g.createQuery()}),b.calls++,g.beginQuery(f.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,f=this.context.gl,g=f.createQuery();this.deferredRenderGpuTimeQueries.push(g),f.beginQuery(a.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const f={};for(const g in a){const b=a[g],E=this.context.extTimerQuery,C=E.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;E.deleteQueryEXT(b.query),f[g]=C}return f}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.gl;let g=0;for(const b of a)g+=f.getQueryParameter(b,f.QUERY_RESULT)/1e6,f.deleteQuery(b);return g}translatePosMatrix(a,f,g,b,E){if(!g[0]&&!g[1])return a;const C=E?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(C){const L=Math.sin(C),B=Math.cos(C);g=[g[0]*B-g[1]*L,g[0]*L+g[1]*B]}const I=[E?g[0]:s.ay(f,g[0],this.transform.zoom),E?g[1]:s.ay(f,g[1],this.transform.zoom),0],R=new Float32Array(16);return s.br(R,a,I),R}saveTileTexture(a){if(a.context!==this.context)return;const f=a.size[0],g=this._tileTextures[f];g?g.push(a):this._tileTextures[f]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,f,g){const b=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,E=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(E.push("LIGHTING_3D_MODE"),E.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||E.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||E.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(E.push("TERRAIN"),this.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&E.push("GLOBE"),!this._fogVisible||b||f!==void 0&&!f||E.push("FOG"),b&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}getOrCreateProgram(a,f){this.cache=this.cache||{};const g=f&&f.defines||[],b=f&&f.config,E=this.currentGlobalDefines(a,f&&f.overrideFog,f&&f.overrideRtt).concat(g),C=$3.cacheKey(mb[a],a,E,b);return this.cache[C]||(this.cache[C]=new $3(this.context,a,mb[a],b,b_[a],E)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,f){if(this.style.enable3dLights()){const g=this.style.directionalLight,b=this.style.ambientLight;if(g&&b){const E=((C,I,R)=>{const L=C.properties.get("direction"),B=C.properties.get("color-use-theme")==="none",V=C.properties.get("color").toNonPremultipliedRenderColor(B?null:R.getLut(C.scope)).toArray01(),j=C.properties.get("intensity"),W=I.properties.get("color-use-theme")==="none",Y=I.properties.get("color").toNonPremultipliedRenderColor(W?null:R.getLut(I.scope)).toArray01(),Z=I.properties.get("intensity"),J=[L.x,L.y,L.z],ie=s.dN(Y,Z),pe=s.dN(V,j);return{u_lighting_ambient_color:ie,u_lighting_directional_dir:J,u_lighting_directional_color:pe,u_ground_radiance:yp(J,pe,ie)}})(g,b,this.style);f.setLightsUniformValues(a,E)}}}uploadCommonUniforms(a,f,g,b,E){if(this.uploadCommonLightUniforms(a,f),this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const I=C.getOpacity(this.transform.pitch),R=((L,B,V,j,W,Y,Z,J,ie,pe,fe,ce)=>{const Re=L.transform,Ce=B.properties.get("color-use-theme")==="none",Se=B.properties.get("color").toNonPremultipliedRenderColor(Ce?null:L.style.getLut(B.scope)).toArray01();Se[3]=j;const be=L.frameCounter/1e3%1,[ye,Ne]=B.properties.get("vertical-range");return{u_fog_matrix:V?Re.calculateFogTileMatrix(V):ce||L.identityMat,u_fog_range:B.getFovAdjustedRange(Re._fov),u_fog_color:Se,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ye,Ne),Ne],u_fog_temporal_offset:be,u_frustum_tl:W,u_frustum_tr:Y,u_frustum_br:Z,u_frustum_bl:J,u_globe_pos:ie,u_globe_radius:pe,u_viewport:fe,u_globe_transition:s.aj(Re.zoom),u_is_globe:+(Re.projection.name==="globe")}})(this,C,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],b);f.setFogUniformValues(a,R)}E&&f.setCutoffUniformValues(a,E.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const b of g)f[b.key]=a[b.key]||new Rd(b,512,this.transform.tileZoom,this,void 0,this.worldview);return f}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(a,f){return!(!a.is3D(!(!this.terrain||!this.terrain.enabled))||a.type!=="clip"&&a.type!=="building"&&(a.minzoom&&a.minzoom>this.transform.zoom||(this.style._clipLayerPresent||a.sourceLayer!=="building"&&a.sourceLayer!=="procedural_buildings")&&(!f||f.type!=="batched-model")))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[a.key];return f||(this._cachedTileFogOpacities[a.key]=f=this.style.fog.getOpacityForTile(a)),f[0]>=Xt||f[1]>=Xt}setupDepthForOcclusion(a,f,g){const b=this.context,E=b.gl,C=!!g;var I;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(E.TEXTURE3),a&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),b.activeTexture.set(E.TEXTURE0),C||f.setTerrainUniformValues(b,g)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const a=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=a?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function gC(m,a){let f=!1,g=null;const b=()=>{g=null,f&&(m(),g=setTimeout(b,a),f=!1)};return()=>(f=!0,g||b(),g)}class Go{constructor(a){this._hashName=a&&encodeURIComponent(a),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=gC(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const f=yC(a);if(this._hashName){const g=this._hashName;let b=!1;const E=location.hash.slice(1).split("&").map(C=>{const I=C.split("=")[0];return I===g?(b=!0,`${I}=${f}`):C}).filter(C=>C);return b||E.push(`${g}=${f}`),`#${E.join("&")}`}return`#${f}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(g=>isNaN(Number(g)))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:g,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function yC(m,a){const f=m.getCenter(),g=Math.round(100*m.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),C=Math.round(f.lng*E)/E,I=Math.round(f.lat*E)/E,R=m.getBearing(),L=m.getPitch();let B=a?`/${C}/${I}/${g}`:`${g}/${I}/${C}`;return(R||L)&&(B+="/"+Math.round(10*R)/10),L&&(B+=`/${Math.round(L)}`),B}const Gd={linearity:.3,easing:s.eT(0,0,.3,1)},i6=Object.assign({deceleration:2500,maxSpeed:1400},Gd),sr=Object.assign({deceleration:20,maxSpeed:1400},Gd),ii=Object.assign({deceleration:1e3,maxSpeed:360},Gd),_C=Object.assign({deceleration:1e3,maxSpeed:90},Gd);class qd{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=s.o.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const E=qu(f.pan.mag(),g,Object.assign({},i6,a||{}));b.offset=f.pan.mult(E.amount/f.pan.mag()),b.center=this._map.transform.center,Gu(b,E)}if(f.zoom){const E=qu(f.zoom,g,sr);b.zoom=this._map.transform.zoom+E.amount,Gu(b,E)}if(f.bearing){const E=qu(f.bearing,g,ii);b.bearing=this._map.transform.bearing+s.aA(E.amount,-179,179),Gu(b,E)}if(f.pitch){const E=qu(f.pitch,g,_C);b.pitch=this._map.transform.pitch+E.amount,Gu(b,E)}if(b.zoom||b.bearing){const E=f.pinchAround===void 0?f.around:f.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Gu(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function qu(m,a,f){const{maxSpeed:g,linearity:b,deceleration:E}=f,C=s.aA(m*b/(a/1e3),-g,g),I=Math.abs(C)/(E*b);return{easing:f.easing,duration:1e3*I,amount:C*(I/2)}}class Vs extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,g,b={}){const E=Ue(f.getCanvasContainer(),g),C=f.unproject(E);super(a,Object.assign({point:E,lngLat:C,originalEvent:g},b)),this._defaultPrevented=!1,this.target=f}}class Tp extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,g){const b=a==="touchend"?g.changedTouches:g.touches,E=ze(f.getCanvasContainer(),b),C=E.map(R=>f.unproject(R)),I=E.reduce((R,L,B,V)=>R.add(L.div(V.length)),new s.P(0,0));super(a,{points:E,point:I,lngLats:C,lngLat:f.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class sv extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f){super("wheel",{originalEvent:f}),this._defaultPrevented=!1}}class ov{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new sv(this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new Vs(a.type,this._map,a))}mouseup(a){this._map.fire(new Vs(a.type,this._map,a))}preclick(a){const f=new MouseEvent("preclick",a);this._map.fire(new Vs(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Vs(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Vs(a.type,this._map,a))}mouseover(a){this._map.fire(new Vs(a.type,this._map,a))}mouseout(a){this._map.fire(new Vs(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Tp(a.type,this._map,a))}touchmove(a){this._map.fire(new Tp(a.type,this._map,a))}touchend(a){this._map.fire(new Tp(a.type,this._map,a))}touchcancel(a){this._map.fire(new Tp(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class av{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Vs(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Vs(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wc{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(de(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const g=f,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(g)||!this._box&&g.dist(b)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const C=Math.min(b.x,g.x),I=Math.max(b.x,g.x),R=Math.min(b.y,g.y),L=Math.max(b.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${R}px)`,this._box.style.width=I-C+"px",this._box.style.height=L-R+"px")})}mouseupWindow(a,f){if(!this._active)return;const g=this._startPos,b=f;if(g&&a.button===0){if(this.reset(),ke(),g.x!==b.x||g.y!==b.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:a})),{cameraAnimation:E=>E.fitScreenCoordinates(g,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new s.z(a,{originalEvent:f}))}}function su(m,a){const f={};for(let g=0;g<m.length;g++)f[m[g].identifier]=a[g];return f}class Ap{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(b){const E=new s.P(0,0);for(const C of b)E._add(C);return E.div(b.length)}(f),this.touches=su(g,f)))}touchmove(a,f,g){if(this.aborted||!this.centroid)return;const b=su(g,f);for(const E in this.touches){const C=b[E];(!C||C.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(a,f,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Sp{constructor(a){this.singleTap=new Ap(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,g){this.singleTap.touchstart(a,f,g)}touchmove(a,f,g){this.singleTap.touchmove(a,f,g)}touchend(a,f,g){const b=this.singleTap.touchend(a,f,g);if(b){const E=a.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(b)<30;if(E&&C||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class cv{constructor(){this._zoomIn=new Sp({numTouches:1,numTaps:2}),this._zoomOut=new Sp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,g){this._zoomIn.touchstart(a,f,g),this._zoomOut.touchstart(a,f,g)}touchmove(a,f,g){this._zoomIn.touchmove(a,f,g),this._zoomOut.touchmove(a,f,g)}touchend(a,f,g){const b=this._zoomIn.touchend(a,f,g),E=this._zoomOut.touchend(a,f,g);return b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(b)},{originalEvent:a})}):E?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(E)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const lv=0,Zd=2,uv={[lv]:1,[Zd]:2},hc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Fg{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const g=ht(a);this._correctButton(a,g)&&(this._lastPoint=f,this._eventButton=g)}mousemoveWindow(a,f){const g=this._lastPoint;if(g){if(a.preventDefault(),this._eventButton!=null&&function(b,E){const C=uv[E];return b.buttons===void 0||(b.buttons&C)!==C}(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(g,f)}}mouseupWindow(a){this._lastPoint&&ht(a)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class P_ extends Fg{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class R_ extends Fg{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?hc[a.pitchRotateKey]:void 0}_correctButton(a,f){return this._pitchRotateKey?f===0&&a[this._pitchRotateKey]:f===0&&a.ctrlKey||f===2}_move(a,f){const g=.8*(f.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class O_ extends Fg{constructor(a){super(a),this._pitchRotateKey=a.pitchRotateKey?hc[a.pitchRotateKey]:void 0}_correctButton(a,f){return this._pitchRotateKey?f===0&&a[this._pitchRotateKey]:f===0&&a.ctrlKey||f===2}_move(a,f){const g=-.5*(f.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){this._pitchRotateKey||a.preventDefault()}}class ms{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(a,f,g){return this._calculateTransform(a,f,g)}touchmove(a,f,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,f,g)}}touchend(a,f,g){this._calculateTransform(a,f,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,g){g.length>0&&(this._active=!0);const b=su(g,f),E=new s.P(0,0),C=new s.P(0,0);let I=0;for(const L in b){const B=b[L],V=this._touches[L];V&&(E._add(B),C._add(B.sub(V)),I++,b[L]=B)}if(this._touches=b,I<this._minTouches||!C.mag())return;const R=C.div(I);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(I),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class $g{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,g){return{}}touchstart(a,f,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,g){const b=this._firstTwoTouches;if(!b)return;a.preventDefault();const[E,C]=b,I=Ip(g,f,E),R=Ip(g,f,C);if(!I||!R)return;const L=this._aroundCenter?null:I.add(R).div(2);return this._move([I,R],L,a)}touchend(a,f,g){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,C=Ip(g,f,b),I=Ip(g,f,E);C&&I||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ip(m,a,f){for(let g=0;g<m.length;g++)if(m[g].identifier===f)return a[g]}function k_(m,a){return Math.log2(m/a)}class Qh extends $g{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(k_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:k_(this._distance,g),pinchAround:f}}}function D_(m,a){return 180*m.angleWith(a)/Math.PI}class dv extends $g{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:D_(this._vector,g),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const b=D_(a,g);return Math.abs(b)<f}}function zg(m){return Math.abs(m.y)>Math.abs(m.x)}class ef extends $g{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,zg(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,g){const b=this._lastPoints;if(!b)return;const E=a[0].sub(b[0]),C=a[1].sub(b[1]);return this._map._cooperativeGestures&&!s.eU()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(E,C,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(E.y+C.y)/2*-.5})}gestureBeginsVertically(a,f,g){if(this._valid!==void 0)return this._valid;const b=a.mag()>=2,E=f.mag()>=2;if(!b&&!E)return;if(!b||!E)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=a.y>0==f.y>0;return zg(a)&&zg(f)&&C}}const hv={panStep:100,bearingStep:15,pitchStep:10};class Ug{constructor(){const a=hv;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,g=0,b=0,E=0,C=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),E=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),E=1);break;case 38:a.shiftKey?b=1:(a.preventDefault(),C=-1);break;case 40:a.shiftKey?b=-1:(a.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,b=0),{cameraAnimation:I=>{const R=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:fv,zoom:f?Math.round(R)+f*(a.shiftKey?2:1):R,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-C*this._panStep],center:I.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fv(m){return m*(2-m)}const jg=4.000244140625,pv=1/450;class N_{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=pv,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=s.o.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,f!==0&&f%jg===0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=window.setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=Ue(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>jg?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&B!==0&&(B=1/B);const V=f(),j=Math.pow(2,V),W=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(W*B))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:f(),b=this._startZoom,E=this._easing;let C,I=!1;if(this._type==="wheel"&&b&&E){const L=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),B=E(L);C=s.ak(b,g,B),L<1?this._frameId||(this._frameId=!0):I=!0}else C=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=C-f();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=s.eV;if(this._prevEase){const g=this._prevEase,b=(s.o.now()-g.start)/g.duration,E=g.easing(b+.01)-g.easing(b),C=.27/Math.sqrt(E*E+1e-4)*.01,I=Math.sqrt(.0729-C*C);f=s.eT(C,I,.25,1)}return this._prevEase={start:s.o.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wC{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bC{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vC{constructor(){this._tap=new Sp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=f[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,f,g))}touchmove(a,f,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const b=f[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,a.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(a,f,g)}touchend(a,f,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(a,f,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xC{constructor(a,f,g){this._el=a,this._mousePan=f,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class EC{constructor(a,f,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class CC{constructor(a,f,g,b){this._el=a,this._touchZoom=f,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vg=m=>m.zoom||m.drag||m.pitch||m.rotate;class TC extends s.z{}class AC{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const g=s.av([],f,a);this.radius=s.ag(g[2]<0?s.eX([],g,this.constants):[g[0],g[1],0])}projectRay(a){s.eX(a,a,this.constants),s.aw(a,a),s.eY(a,a,this.constants);const f=s.c5([],a,this.radius);if(f[2]>0){const g=s.c5([],[0,0,1],s.bJ(f,[0,0,1])),b=s.c5([],s.aw([],[f[0],f[1],0]),this.radius),E=s.d8([],f,s.c5([],s.av([],s.d8([],b,g),f),2));f[0]=E[0],f[1]=E[1]}return f}}function Wg(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class SC{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qd(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new AC,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),s.aY(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,E,C]of this._listeners){const I=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(E,I,C)}}destroy(){for(const[a,f,g]of this._listeners){const b=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(f,b,g)}}_addDefaultHandlers(a){const f=this._map,g=f.getCanvasContainer();this._add("mapEvent",new ov(f,a));const b=f.boxZoom=new Wc(f,a);this._add("boxZoom",b);const E=new cv,C=new bC;f.doubleClickZoom=new wC(C,E),this._add("tapZoom",E),this._add("clickZoom",C);const I=new vC;this._add("tapDragZoom",I);const R=f.touchPitch=new ef(f);this._add("touchPitch",R);const L=new R_(a),B=new O_(a);f.dragRotate=new EC(a,L,B),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const V=new P_(a),j=new ms(f,a);f.dragPan=new xC(g,V,j),this._add("mousePan",V),this._add("touchPan",j,["touchZoom","touchRotate"]);const W=new dv,Y=new Qh;f.touchZoomRotate=new CC(g,Y,W,I),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new av(f));const Z=f.scrollZoom=new N_(f,this);this._add("scrollZoom",Z,["mousePan"]);const J=f.keyboard=new Ug;this._add("keyboard",J);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[ie]&&f[ie].enable(a[ie])}_add(a,f,g){this._handlers.push({handlerName:a,handler:f,allowed:g}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,f,g){for(const b in a)if(b!==g&&(!f||f.indexOf(b)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const g of a)this._el.contains(g.target)&&f.push(g);return f}handleEvent(a,f){this._updatingCamera=!0;const g=a.type==="renderFrame",b=g?void 0:a,E={needsRenderFrame:!1},C={},I={},R=a.touches?this._getMapTouches(a.touches):void 0,L=R?ze(this._el,R):g?void 0:Ue(this._el,a);for(const{handlerName:j,handler:W,allowed:Y}of this._handlers){if(!W.isEnabled())continue;let Z;this._blockedByActive(I,Y,j)?W.reset():W[f||a.type]&&(Z=W[f||a.type](a,L,R),this.mergeHandlerResult(E,C,Z,j,b),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||W.isActive())&&(I[j]=W)}const B={};for(const j in this._previousActiveHandlers)I[j]||(B[j]=b);this._previousActiveHandlers=I,(Object.keys(B).length||Wg(E))&&(this._changes.push([E,C,B]),this._triggerRenderFrame()),(Object.keys(I).length||Wg(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=E;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(a,f,g,b,E){if(!g)return;Object.assign(a,g);const C={handlerName:b,originalEvent:g.originalEvent||E};g.zoomDelta!==void 0&&(f.zoom=C),g.panDelta!==void 0&&(f.drag=C),g.pitchDelta!==void 0&&(f.pitch=C),g.bearingDelta!==void 0&&(f.rotate=C)}_applyChanges(){const a={},f={},g={};for(const[b,E,C]of this._changes)b.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(b.panDelta)),b.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(a.around=b.around),b.aroundCoord!==void 0&&(a.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(a.pinchAround=b.pinchAround),b.noInertia&&(a.noInertia=b.noInertia),Object.assign(f,E),Object.assign(g,C);this._updateMapTransform(a,f,g),this._changes=[]}_updateMapTransform(a,f,g){const b=this._map,E=b.transform,C=pe=>[pe.x,pe.y,pe.z];if((()=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!Wg(a)){const pe=E.zoom;E.cameraElevationReference="sea",this._originalZoom!=null&&E._orthographicProjectionAtLowPitch&&E.projection.name!=="globe"&&E.pitch===0?(E.cameraElevationReference="ground",E.zoom=this._originalZoom):(E.recenterOnTerrain(),E.cameraElevationReference="ground"),pe!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!Wg(a))return void this._fireEvents(f,g,!0);let{panDelta:I,zoomDelta:R,bearingDelta:L,pitchDelta:B,around:V,aroundCoord:j,pinchAround:W}=a;E._isCameraConstrained&&(R>0&&(R=0),E._isCameraConstrained=!1),W!==void 0&&(V=W),(R||(pe=>f[pe]&&!this._eventsInProgress[pe])("drag"))&&V&&(this._dragOrigin=C(E.pointCoordinate3D(V)),this._originalZoom=E.zoom,this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),V=V||b.transform.centerPoint,L&&(E.bearing+=L),B&&(E.pitch+=B),E._updateCameraState();const Y=[0,0,0];if(I)if(E.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(V).dir),fe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(V.sub(I)).dir);Y[0]=fe[0]-pe[0],Y[1]=fe[1]-pe[1]}else{const pe=E.pointCoordinate(V);if(E.projection.name==="globe"){I=I.rotate(-E.angle);const fe=E._pixelsPerMercatorPixel/E.worldSize;Y[0]=-I.x*s.eW(s.a$(pe.y))*fe,Y[1]=-I.y*s.eW(E.center.lat)*fe}else{const fe=E.pointCoordinate(V.sub(I));pe&&fe&&(Y[0]=fe.x-pe.x,Y[1]=fe.y-pe.y)}}const Z=E.zoom,J=[0,0,0];if(R){const pe=C(j||E.pointCoordinate3D(V)),fe={dir:s.aw([],s.av([],pe,E._camera.position))};if(fe.dir[2]<0){const ce=E.zoomDeltaToMovement(pe,R);s.c5(J,fe.dir,ce)}}const ie=s.d8(Y,Y,J);E._translateCameraConstrained(ie),R&&Math.abs(E.zoom-Z)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,g,!0)}_fireEvents(a,f,g){const b=Vg(this._eventsInProgress),E=Vg(a),C={};for(const B in a){const{originalEvent:V}=a[B];this._eventsInProgress[B]||(C[`${B}start`]=V),this._eventsInProgress[B]=a[B]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const B in C)this._fireEvent(B,C[B]);E&&this._fireEvent("move",E.originalEvent);for(const B in a){const{originalEvent:V}=a[B];this._fireEvent(B,V)}const I={};let R;for(const B in this._eventsInProgress){const{handlerName:V,originalEvent:j}=this._eventsInProgress[B];this._handlersById[V].isActive()||(delete this._eventsInProgress[B],R=f[V]||j,I[`${B}end`]=R)}for(const B in I)this._fireEvent(B,I[B]);const L=Vg(this._eventsInProgress);if(g&&(b||E)&&!L){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;B?(V(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:R})):(this._map.fire(new s.z("moveend",{originalEvent:R})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new s.z(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new TC("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const mv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class IC extends s.E{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,g){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,Object.assign({offset:a},f),g)}panTo(a,f,g){return this.easeTo(Object.assign({center:a},f),g)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,g){return this.easeTo(Object.assign({zoom:a},f),g)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,g){return this.easeTo(Object.assign({bearing:a},f),g)}resetNorth(a,f){return this.rotateTo(0,Object.assign({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=s.aI.convert(a);const g=f&&f.bearing||0,b=f&&f.pitch||0,E=a.getNorthWest(),C=a.getSouthEast();return this._cameraForBounds(this.transform,E,C,g,b,f)}_extendPadding(a){const f={top:0,right:0,bottom:0,left:0};return a==null?Object.assign({},f,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:Object.assign({},f,a)}_extendCameraOptions(a){return(a=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,f){const g=f.max[0]-f.min[0],b=f.max[1]-f.min[1];return g/b>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):b/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,f,g,b,E,C){const I=a.clone(),R=this._extendCameraOptions(C);I.bearing=b,I.pitch=E;const L=s.aT.convert(f),B=s.aT.convert(g),V=.5*(L.lat+B.lat),j=.5*(L.lng+B.lng),W=s.eZ(V,j),Y=s.aw([],W),Z=s.aw([],s.bI([],Y,[0,1,0])),J=s.bI([],Z,Y),ie=[Z[0],Z[1],Z[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],pe=[W,s.eZ(L.lat,L.lng),s.eZ(B.lat,L.lng),s.eZ(B.lat,B.lng),s.eZ(L.lat,B.lng),s.eZ(V,L.lng),s.eZ(V,B.lng),s.eZ(L.lat,j),s.eZ(B.lat,j)];let fe=s.d9.fromPoints(pe.map(nt=>[s.bJ(Z,nt),s.bJ(J,nt),s.bJ(Y,nt)]));const ce=s.af([],fe.center,ie);s.e_(ce)===0&&s.e$(ce,0,0,1),s.aw(ce,ce),s.c5(ce,ce,s.aD),I.center=s.f0(ce);const Re=I.getWorldToCameraMatrix(),Ce=s.bl(new Float64Array(16),Re);fe=s.d9.applyTransform(fe,s.aB([],Re,ie));const Se=this._extendAABB(fe,I,R,b);if(!Se)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Se,s.af(ce,ce,Re);const be=.5*(fe.max[2]-fe.min[2]),ye=this._minimumAABBFrustumDistance(I,fe),Ne=s.c5([],[0,0,1],be),We=s.d8(Ne,ce,Ne),Ze=ye+(I.pitch===0?0:s.bG(ce,We)),tt=I.globeCenterInViewSpace,Je=s.av([],ce,[tt[0],tt[1],tt[2]]);s.aw(Je,Je),s.c5(Je,Je,Ze);const mt=s.d8([],ce,Je);s.af(mt,mt,Ce);const xt=s.eM/s.aD,Xe=s.ag(mt),Me=s.cf(Math.max(Xe*xt-s.eM,Number.EPSILON),0),dt=Math.min(I.zoomFromMercatorZAdjusted(Me),R.maxZoom);return dt>.5*(s.c_+s.cL)?(I.setProjection({name:"mercator"}),I.zoom=dt,this._cameraForBounds(I,f,g,b,E,C)):{center:I.center,zoom:dt,bearing:b,pitch:E}}_extendAABB(a,f,g,b){const E=.5*((g.padding.left||0)+(g.padding.right||0)),C=.5*((g.padding.top||0)+(g.padding.bottom||0)),I=C,R=E,L=E,B=C,V=f.width-(R+L),j=f.height-(I+B),W=s.av([],a.max,a.min),Y=Math.min(V/W[0],j/W[1]),Z=Math.min(f.scaleZoom(f.scale*Y),g.maxZoom);if(isNaN(Z))return null;const J=f.scale/f.zoomScale(Z),ie=new s.d9([a.min[0]-R*J,a.min[1]-B*J,a.min[2]],[a.max[0]+L*J,a.max[1]+I*J,a.max[2]]),pe=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.P(g.offset.x,g.offset.y):s.P.convert(g.offset)).rotate(-s.an(b));return ie.center[0]-=pe.x*J,ie.center[1]+=pe.y*J,ie}queryTerrainElevation(a,f){const g=this.transform.elevation;return g?(f=Object.assign({},{exaggerated:!0},f),g.getAtPoint(s.ae.fromLngLat(a),null,f.exaggerated)):null}_cameraForBounds(a,f,g,b,E,C){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,f,g,b,E,C);const I=a.clone(),R=this._extendCameraOptions(C);I.bearing=b,I.pitch=E;const L=s.aT.convert(f),B=s.aT.convert(g),V=new s.aT(L.lng,B.lat),j=new s.aT(B.lng,L.lat),W=I.project(L),Y=I.project(B),Z=this.queryTerrainElevation(L),J=this.queryTerrainElevation(B),ie=this.queryTerrainElevation(V),pe=this.queryTerrainElevation(j),fe=[[W.x,W.y,Math.min(Z||0,J||0,ie||0,pe||0)],[Y.x,Y.y,Math.max(Z||0,J||0,ie||0,pe||0)]];let ce=s.d9.fromPoints(fe);const Re=I.getWorldToCameraMatrix(),Ce=s.bl(new Float64Array(16),Re);ce=s.d9.applyTransform(ce,Re);const Se=this._extendAABB(ce,I,R,b);if(!Se)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Se;const be=.5*s.av([],ce.max,ce.min)[2],ye=this._minimumAABBFrustumDistance(I,ce),Ne=[0,0,1,0];s.aC(Ne,Ne,Re),s.f1(Ne,Ne);const We=s.c5([],Ne,ye+be),Ze=s.d8([],ce.center,We);s.af(ce.center,ce.center,Ce),s.af(Ze,Ze,Ce);const tt=I.unproject(new s.P(ce.center[0],ce.center[1])),Je=s.f2(I.projection,tt),mt=Math.pow(2,Je),xt=Math.min(I._zoomFromMercatorZ(Ze[2]*I.pixelsPerMeter*mt/I.worldSize),R.maxZoom);return I.mercatorFromTransition&&xt<.5*(s.c_+s.cL)?(I.setProjection({name:"globe"}),I.zoom=xt,this._cameraForBounds(I,f,g,b,E,C)):{center:tt,zoom:xt,bearing:b,pitch:E}}fitBounds(a,f,g){const b=this.cameraForBounds(a,f);return this._fitInternal(b,f,g)}fitScreenCoordinates(a,f,g,b,E){const C=s.P.convert(a),I=s.P.convert(f),R=new s.P(Math.min(C.x,I.x),Math.min(C.y,I.y)),L=new s.P(Math.max(C.x,I.x),Math.max(C.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,I))return this;const B=this.transform.pointLocation3D(R),V=this.transform.pointLocation3D(L),j=this.transform.pointLocation3D(new s.P(R.x,L.y)),W=this.transform.pointLocation3D(new s.P(L.x,R.y)),Y=[Math.min(B.lng,V.lng,j.lng,W.lng),Math.min(B.lat,V.lat,j.lat,W.lat)],Z=[Math.max(B.lng,V.lng,j.lng,W.lng),Math.max(B.lat,V.lat,j.lat,W.lat)],J=b&&b.pitch?b.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,Y,Z,g,J,b);return this._fitInternal(ie,b,E)}_fitInternal(a,f,g){return a?(f=Object.assign(a,f)).linear?this.easeTo(f,g):this.flyTo(f,g):this}jumpTo(a,f){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,C=!1;"zoom"in a&&g.zoom!==+a.zoom&&(b=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=s.aT.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(E=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(C=!0,g.pitch=+a.pitch);const I=typeof a.padding=="number"?this._extendPadding(a.padding):a.padding;if(a.padding!=null&&!g.isPaddingEqual(I))if(a.retainPadding===!1){const R=g.clone();R.padding=I,g.setLocationAtPoint(g.center,R.centerPoint)}else g.padding=I;return a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),b&&this.fire(new s.z("zoomstart",f)).fire(new s.z("zoom",f)).fire(new s.z("zoomend",f)),E&&this.fire(new s.z("rotatestart",f)).fire(new s.z("rotate",f)).fire(new s.z("rotateend",f)),C&&this.fire(new s.z("pitchstart",f)).fire(new s.z("pitch",f)).fire(new s.z("pitchend",f)),this.fire(new s.z("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(mv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const g=this.transform;if(!g.projection.supportsFreeCamera)return s.w(mv),this;this.stop();const b=g.zoom,E=g.pitch,C=g.bearing;g.setFreeCameraOptions(a);const I=b!==g.zoom,R=E!==g.pitch,L=C!==g.bearing;return this.fire(new s.z("movestart",f)).fire(new s.z("move",f)),I&&this.fire(new s.z("zoomstart",f)).fire(new s.z("zoom",f)).fire(new s.z("zoomend",f)),L&&this.fire(new s.z("rotatestart",f)).fire(new s.z("rotate",f)).fire(new s.z("rotateend",f)),R&&this.fire(new s.z("pitchstart",f)).fire(new s.z("pitch",f)).fire(new s.z("pitchend",f)),this.fire(new s.z("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=Object.assign({offset:[0,0],duration:500,easing:s.eV},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const g=this.transform,b=this.getZoom(),E=this.getBearing(),C=this.getPitch(),I=this.getPadding(),R="zoom"in a?+a.zoom:b,L="bearing"in a?this._normalizeBearing(a.bearing,E):E,B="pitch"in a?+a.pitch:C,V=this._extendPadding(a.padding),j=s.P.convert(a.offset);let W,Y,Z;if(g.projection.name==="globe"){const Ne=s.ae.fromLngLat(g.center),We=j.rotate(-g.angle);Ne.x+=We.x/g.worldSize,Ne.y+=We.y/g.worldSize;const Ze=Ne.toLngLat(),tt=s.aT.convert(a.center||Ze);this._normalizeCenter(tt),W=g.centerPoint.add(We),Y=new s.P(Ne.x,Ne.y).mult(g.worldSize),Z=new s.P(s.aF(tt.lng),s.aJ(tt.lat)).mult(g.worldSize).sub(Y)}else{W=g.centerPoint.add(j);const Ne=g.pointLocation(W),We=s.aT.convert(a.center||Ne);this._normalizeCenter(We),Y=g.project(Ne),Z=g.project(We).sub(Y)}const J=g.zoomScale(R-b);let ie,pe;a.around&&(ie=s.aT.convert(a.around),pe=g.locationPoint(ie));const fe=this._zooming||R!==b,ce=this._rotating||E!==L,Re=this._pitching||B!==C,Ce=!g.isPaddingEqual(V),Se=a.retainPadding===!1?g.clone():g,be=Ne=>We=>{if(fe&&(Ne.zoom=s.ak(b,R,We)),ce&&(Ne.bearing=s.ak(E,L,We)),Re&&(Ne.pitch=s.ak(C,B,We)),Ce&&(Se.interpolatePadding(I,V,We),W=Se.centerPoint.add(j)),ie)Ne.setLocationAtPoint(ie,pe);else{const Ze=Ne.zoomScale(Ne.zoom-b),tt=R>b?Math.min(2,J):Math.max(.5,J),Je=Math.pow(tt,1-We),mt=Ne.unproject(Y.add(Z.mult(We*Je)).mult(Ze));Ne.setLocationAtPoint(Ne.renderWorldCopies?mt.wrap():mt,W)}return a.preloadOnly||this._fireMoveEvents(f),Ne};if(a.preloadOnly){const Ne=this._emulate(be,a.duration,g);return this._preloadTiles(Ne),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ce,this._pitching=Re,this._padding=Ce,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,ye),this._ease(be(g),Ne=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(f,Ne)},a),this}_prepareEase(a,f,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||g.moving||this.fire(new s.z("movestart",a)),this._zooming&&!g.zooming&&this.fire(new s.z("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new s.z("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new s.z("pitchstart",a))}_fireMoveEvents(a){this.fire(new s.z("move",a)),this._zooming&&this.fire(new s.z("zoom",a)),this._rotating&&this.fire(new s.z("rotate",a)),this._pitching&&this.fire(new s.z("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new s.z("zoomend",a)),b&&this.fire(new s.z("rotateend",a)),E&&this.fire(new s.z("pitchend",a)),this.fire(new s.z("moveend",a))}flyTo(a,f){if(this._prefersReducedMotion(a)){const nt=s.aH(a,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(nt,f)}this.stop(),a=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},a);const g=this.transform,b=this.getZoom(),E=this.getBearing(),C=this.getPitch(),I=this.getPadding(),R="zoom"in a?s.aA(+a.zoom,g.minZoom,g.maxZoom):b,L="bearing"in a?this._normalizeBearing(a.bearing,E):E,B="pitch"in a?+a.pitch:C,V=this._extendPadding(a.padding),j=g.zoomScale(R-b),W=s.P.convert(a.offset);let Y=g.centerPoint.add(W);const Z=g.pointLocation(Y),J=s.aT.convert(a.center||Z);this._normalizeCenter(J);const ie=g.project(Z),pe=g.project(J).sub(ie);let fe=a.curve;const ce=Math.max(g.width,g.height),Re=ce/j,Ce=pe.mag();if("minZoom"in a){const nt=s.aA(Math.min(a.minZoom,b,R),g.minZoom,g.maxZoom),St=ce/g.zoomScale(nt-b);fe=Math.sqrt(St/Ce*2)}const Se=fe*fe;function be(nt){const St=(Re*Re-ce*ce+(nt?-1:1)*Se*Se*Ce*Ce)/(2*(nt?Re:ce)*Se*Ce);return Math.log(Math.sqrt(St*St+1)-St)}function ye(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function Ne(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const We=be(0);let Ze=function(nt){return Ne(We)/Ne(We+fe*nt)},tt=function(nt){return ce*((Ne(We)*(ye(St=We+fe*nt)/Ne(St))-ye(We))/Se)/Ce;var St},Je=(be(1)-We)/fe;if(Math.abs(Ce)<1e-6||!isFinite(Je)){if(Math.abs(ce-Re)<1e-6)return this.easeTo(a,f);const nt=Re<ce?-1:1;Je=Math.abs(Math.log(Re/ce))/fe,tt=function(){return 0},Ze=function(St){return Math.exp(nt*fe*St)}}a.duration="duration"in a?+a.duration:1e3*Je/("screenSpeed"in a?+a.screenSpeed/fe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const mt=E!==L,xt=B!==C,Xe=!g.isPaddingEqual(V),Me=a.retainPadding===!1?g.clone():g,dt=nt=>St=>{const Rt=St*Je,jt=1/Ze(Rt);nt.zoom=St===1?R:b+nt.scaleZoom(jt),mt&&(nt.bearing=s.ak(E,L,St)),xt&&(nt.pitch=s.ak(C,B,St)),Xe&&(Me.interpolatePadding(I,V,St),Y=Me.centerPoint.add(W));const Ot=St===1?J:nt.unproject(ie.add(pe.mult(tt(Rt))).mult(jt));return nt.setLocationAtPoint(nt.renderWorldCopies?Ot.wrap():Ot,Y),nt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),nt};if(a.preloadOnly){const nt=this._emulate(dt,a.duration,g);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=mt,this._pitching=xt,this._padding=Xe,this._prepareEase(f,!1),this._ease(dt(g),()=>this._afterEase(f),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,f)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,f,g){g.animate===!1||g.duration===0?(a(1),f()):(this._easeStart=s.o.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=s.bT(a,-180,180);const g=Math.abs(a-f);return Math.abs(a-360-f)<g&&(a-=360),Math.abs(a+360-f)<g&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const g=a.lng-f.center.lng;a.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,f,g){const b=Math.ceil(15*f/1e3),E=[],C=a(g.clone());for(let I=0;I<=b;I++){const R=C(I/b);E.push(R.clone())}return E}_preloadTiles(a,f){}}class PC{constructor(a={}){this.options=a,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact,g=a._getUIString("AttributionControl.ToggleAttribution");this._map=a,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const b=U("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",g),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(a){const g=f.reduce((b,E,C)=>(E.value&&(b+=`${E.key}=${E.value}${C<f.length-1?"&":""}`),b),"?");a.href=`${s.e.FEEDBACK_URL}/${g}#${yC(this._map,!0)}`,a.rel="noopener nofollow"}}_updateData(a){!a||(a.dataType!=="source"||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility")&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style._mergedSourceCaches;for(const b in f){const E=f[b];if(E.used){const C=E.getSource();C.attribution&&a.indexOf(C.attribution)<0&&a.push(C.attribution)}}a.sort((b,E)=>b.length-E.length),a=a.filter((b,E)=>{for(let C=E+1;C<a.length;C++)if(a[C].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.map(b=>function(E){const C=new DOMParser().parseFromString(E,"text/html");return Array.from(C.body.querySelectorAll("*")).reverse().forEach(I=>{const R=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(...I.childNodes);const L=I.getAttribute("href");if(!L||!/^(https?:|mailto:)/i.test(L))return void I.replaceWith(C.createTextNode(R));const B=C.createElement("a");B.href=L,B.textContent=R,B.rel="noopener nofollow";const V=I.getAttribute("class");V&&(B.className=V),I.replaceWith(B)}),C.body.innerHTML}(b)).join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class RC{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=U("div","mapboxgl-ctrl");const f=U("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const g=a[f].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class OC{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,g=f?this._queue.concat(f):this._queue;for(const b of g)if(b.id===a)return void(b.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const g of f)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class hr{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=s.dD((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,g){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+g}}const kC={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class DC extends s.z{constructor(a,f,g,b){const{point:E,lngLat:C,originalEvent:I,target:R}=a;super(a.type,{point:E,lngLat:C,originalEvent:I,target:R}),this.preventDefault=()=>{a.preventDefault()},this.id=f,this.interaction=g,this.feature=b}}class r6{constructor(a){this.map=a,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(a,f){if(this.typeById.has(a))throw new Error(`Interaction id "${a}" already exists.`);const g=f.filter;let b=f.type;g&&this.filters.set(a,s.b6(g)),b==="mouseover"&&(b="mouseenter"),b==="mouseout"&&(b="mouseleave");const E=this.interactionsByType.get(b)||new Map;b==="mouseenter"||b==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(a,f)):E.size===0&&this.map.on(b,this.handleType),E.size===0&&this.interactionsByType.set(b,E),E.set(a,f),this.typeById.set(a,b)}get(a){const f=this.typeById.get(a);if(!f)return;const g=this.interactionsByType.get(f);return g?g.get(a):void 0}remove(a){const f=this.typeById.get(a);if(!f)return;this.typeById.delete(a),this.filters.delete(a);const g=this.interactionsByType.get(f);g&&(g.delete(a),f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.delete(a),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(f,this.handleType))}queryTargets(a,f){const g=[];for(const[b,E]of f)E.target&&g.push({targetId:b,target:E.target,filter:this.filters.get(b)});return this.map.style.queryRenderedTargets(a,g,this.map.transform)}handleMove(a){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const f=this.queryTargets(a.point,Array.from(this.delegatedInteractions).reverse());f.length&&(a.type="mouseenter",this.handleType(a,f));const g=new Map;for(const[b,{feature:E}]of this.prevHoveredFeatures)this.hoveredFeatures.has(b)||g.set(E.id,E);g.size&&(a.type="mouseleave",this.handleType(a,Array.from(g.values())))}handleOut(a){const f=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);f.length&&(a.type="mouseleave",this.handleType(a,f)),this.hoveredFeatures.clear()}handleType(a,f){const g=a.type==="mouseenter";if(g&&!this.interactionsByType.has(a.type))return void s.w("mouseenter interaction required for mouseleave to work.");const b=Array.from(this.interactionsByType.get(a.type)).reverse(),E=!!f;f=f||this.queryTargets(a.point,b);let C=!1;const I=new Set;for(const R of f){for(const[L,B]of b){if(!B.target)continue;const V=R.variants?R.variants[L]:null;if(V){for(const j of V){if(ag(j,R,I,L))continue;const W=new s.dx(R,j),Y=ac(j,R,L);E&&W.id!==void 0&&(W.state=this.map.getFeatureState(W));const Z=g?this.prevHoveredFeatures.get(Y):null,J=new DC(a,L,B,W),ie=Z?Z.stop:B.handler(J);if(g&&this.hoveredFeatures.set(Y,{feature:R,stop:ie}),ie!==!1){C=!0;break}}if(C)break}}if(C)break}if(!C)for(const[R,L]of b){const{handler:B,target:V}=L;if(!V&&B(new DC(a,R,L,null))!==!1)break}}}function s6(m,a){if(Array.isArray(m)&&Array.isArray(a)){const f=new Set(m),g=new Set(a);return f.size===g.size&&m.every(b=>g.has(b))}return s.by(m,a)}const Hg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},NC={showCompass:!0,showZoom:!0,visualizePitch:!1};class gv{constructor(a,f,g=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new R_({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new O_({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),de()}move(a,f){const g=this.map,b=this.mouseRotate.mousemoveWindow(a,f),E=b&&b.bearingDelta;if(E&&g.setBearing(g.getBearing()+E),this.mousePitch){const C=this.mousePitch.mousemoveWindow(a,f),I=C&&C.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(Object.assign({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Ue(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Ue(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ze(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=ze(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Gg(m,a,f){if(m=new s.aT(m.lng,m.lat),a){const g=new s.aT(m.lng-360,m.lat),b=new s.aT(m.lng+360,m.lat),E=360*Math.ceil(Math.abs(m.lng-f.center.lng)/360),C=f.locationPoint3D(m).distSqr(a),I=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint3D(g).distSqr(a)<C&&(I||Math.abs(g.lng-f.center.lng)<E)?m=g:f.locationPoint3D(b).distSqr(a)<C&&(I||Math.abs(b.lng-f.center.lng)<E)&&(m=b)}for(;Math.abs(m.lng-f.center.lng)>180;){const g=f.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=f.width&&g.y<=f.height)break;m.lng>f.center.lng?m.lng-=360:m.lng+=360}return m}const Tl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},fc={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Xr extends s.E{constructor(a,f){super(),(a instanceof HTMLElement||f)&&(a=Object.assign({element:a},f)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:b="#3FB1CE",scale:E=1,draggable:C=!1,clickTolerance:I=0,rotation:R=fc.rotation,rotationAlignment:L=fc.rotationAlignment,pitchAlignment:B=fc.pitchAlignment,occludedOpacity:V=fc.occludedOpacity,altitude:j=fc.altitude}=a||{};this._anchor=g,this._color=b,this._scale=E,this._draggable=C,this._clickTolerance=I,this._rotation=R,this._rotationAlignment=L,this._pitchAlignment=B,this._occludedOpacity=V,this._altitude=j,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),a&&a.element?(this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(a&&a.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Z=>{Z.preventDefault()}),this._element.addEventListener("mousedown",Z=>{Z.preventDefault()});const W=this._element.classList;for(const Z in Tl)W.remove(`mapboxgl-marker-anchor-${Z}`);W.add(`mapboxgl-marker-anchor-${this._anchor}`);const Y=a&&a.className?a.className.trim().split(/\s+/):[];W.add(...Y),this._popup=null}_createDefaultMarker(){const a=U("div"),f=G("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},a);if(this._altitude===0){const g=G("radialGradient",{id:"shadowGradient"},G("defs",{},f));G("stop",{offset:"10%","stop-opacity":.4},g),G("stop",{offset:"100%","stop-opacity":.05},g),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f)}return G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),a}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.aT.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(a){return a===this._altitude||(this._defaultMarker&&(this._altitude===0&&a!==0||this._altitude!==0&&a===0)&&(this._element=this._createDefaultMarker()),this._altitude=a||fc.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,a._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,g=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,f=this._pos;if(!a||!f)return!1;const g=a.unproject(f,this._altitude),b=a.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(g)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(f,this._altitude);let b;a._showingGlobe()&&s.f5(a.transform,this._lngLat)?b=0:(b=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Tl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const a=this._pos,f=this._map,g=this.getPitchAlignment();if(!f||!a||g!=="map")return"";if(!f._showingGlobe()){const R=f.getPitch();return R?`rotateX(${R}deg)`:""}const b=s.cX(s.f6(f.transform,this._lngLat)),E=a.sub(s.f7(f.transform)),C=Math.abs(E.x)+Math.abs(E.y);if(C===0)return"";const I=b/C;return`rotateX(${-E.y*I}deg) rotateY(${E.x*I}deg)`}_calculateZTransform(){const a=this._pos,f=this._map;if(!f||!a)return"";let g=0;const b=this.getRotationAlignment();if(b==="map")if(f._showingGlobe()){const E=f.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),C=f.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(E);g=s.cX(Math.atan2(C.y,C.x))-90}else g=-f.getBearing();else if(b==="horizon"){const E=s.ah(4,6,f.getZoom()),C=s.f7(f.transform);C.y+=E*f.transform.height;const I=a.sub(C),R=s.cX(Math.atan2(I.y,I.x));g=(R>90?R-270:R+90)*(1-E)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=Gg(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat,this._altitude),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const f=this._map;if(!f)return;const g=this._pointerdownPos,b=this._positionDelta;if(g&&b){if(!this._isDragging){const E=this._clickTolerance||f._clickTolerance;if(a.point.dist(g)<E)return;this._isDragging=!0}this._pos=a.point.sub(b),this._lngLat=f.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map,g=this._pos;f&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||fc.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||fc.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||fc.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||fc.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const pc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},qg={maxWidth:100,unit:"metric"},M_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},MC={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},o6=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pp(m=new s.P(0,0),a="bottom"){if(typeof m=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new s.P(0,m);case"top-left":return new s.P(f,f);case"top-right":return new s.P(-f,f);case"bottom":return new s.P(0,-m);case"bottom-left":return new s.P(f,-f);case"bottom-right":return new s.P(-f,-f);case"left":return new s.P(m,0);case"right":return new s.P(-m,0)}return new s.P(0,0)}return m instanceof s.P||Array.isArray(m)?s.P.convert(m):s.P.convert(m[a]||[0,0])}return{version:w,supported:z.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends IC{constructor(m){A.mark(x.create);const a=m;if((m=Object.assign({},Hg,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.f3(window)&&(m.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yy(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new OC,this._domRenderTaskQueue=new OC,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},kC,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new hr(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Ye(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const f=document.getElementById(m.container);if(!f)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=f}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new SC(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||s.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new Go(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const f=m.bounds;f&&(this.resize(),this.fitBounds(f,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new PC({customAttribution:m.customAttribution})),this._logoControl=new RC,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new s.z(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new s.z(`${f.dataType}dataloading`,f))}),this._interactions=new r6(this)}_getMapId(){return this._mapId}addControl(m,a){if(a===void 0&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[a];return a.indexOf("bottom")!==-1?g.insertBefore(f,g.firstChild):g.appendChild(f),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new s.z("movestart",m)).fire(new s.z("move",m)),this.fire(new s.z("resize",m)),a&&this.fire(new s.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(a=>a.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(a=>a==="auto"?navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,a=m.projection.name;let f;a==="globe"&&m.zoom>=s.cL?(m.setMercatorFromTransition(),f=!0):a==="mercator"&&m.zoom<s.cL&&(m.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;const f=this.transform.mercatorFromTransition;a=m.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate();const g=this.transform.getProjection().name==="mercator"&&f!==this.transform.mercatorFromTransition;return(a||g)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,a){return this.transform.locationPoint3D(s.aT.convert(m),a)}unproject(m,a){return this.transform.pointLocation3D(s.P.convert(m),a)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,f){const g=b=>{let E=[];if(Array.isArray(a)){const C=a.filter(I=>this.getLayer(I));E=C.length?this.queryRenderedFeatures(b,{layers:C}):[]}else E=this.queryRenderedFeatures(b,{target:a});return E};if(m==="mouseenter"||m==="mouseover"){let b=!1;return{listener:f,targets:a,delegates:{mousemove:C=>{const I=g(C.point);I.length?b||(b=!0,f.call(this,new Vs(m,this,C.originalEvent,{features:I}))):b=!1},mouseout:()=>{b=!1}}}}if(m==="mouseleave"||m==="mouseout"){let b=!1;return{listener:f,targets:a,delegates:{mousemove:I=>{g(I.point).length?b=!0:b&&(b=!1,f.call(this,new Vs(m,this,I.originalEvent)))},mouseout:I=>{b&&(b=!1,f.call(this,new Vs(m,this,I.originalEvent)))}}}}{const b=E=>{const C=g(E.point);C.length&&(E.features=C,f.call(this,E),delete E.features)};return{listener:f,targets:a,delegates:{[m]:b}}}}on(m,a,f){if(typeof a=="function"||f===void 0)return super.on(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._createDelegatedListener(m,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const b in g.delegates)this.on(b,g.delegates[b]);return this}once(m,a,f){if(typeof a=="function"||f===void 0)return super.once(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._createDelegatedListener(m,a,f);for(const b in g.delegates)this.once(b,g.delegates[b]);return this}off(m,a,f){if(typeof a=="function"||f===void 0)return super.off(m,a);if(typeof a=="string"&&(a=[a]),!this._areTargetsValid(a))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(b=>{for(let E=0;E<b.length;E++){const C=b[E];if(C.listener===f&&s6(C.targets,a)){for(const I in C.delegates)this.off(I,C.delegates[I]);return b.splice(E,1),this}}})(g),this}queryRenderedFeatures(m,a){if(!this.style)return[];if(m===void 0||m instanceof s.P||Array.isArray(m)||a!==void 0||(a=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!a){const E=this.style.queryRenderedFeatures(m,void 0,this.transform),C=this.style.queryRenderedFeatureset(m,void 0,this.transform);return E.concat(C)}let f=!0;if(a.target&&(f=this._isTargetValid(a.target),f&&!a.layers))return this.style.queryRenderedFeatureset(m,a,this.transform);let g=!0;if(a.layers&&Array.isArray(a.layers)){for(const E of a.layers)if(!this._isValidId(E)){g=!1;break}if(g&&!a.target)return this.style.queryRenderedFeatures(m,a,this.transform)}let b=[];return g&&(b=b.concat(this.style.queryRenderedFeatures(m,a,this.transform))),f&&(b=b.concat(this.style.queryRenderedFeatureset(m,a,this.transform))),b}querySourceFeatures(m,a){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,a)}queryRasterValue(m,a,f){return this._isValidId(m)?this.style.queryRasterValue(m,a,f):Promise.resolve(null)}isPointOnSurface(m){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&s.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(m))}addInteraction(m,a){return this._interactions.add(m,a),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,a){return a=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&m&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(m,(f,g)=>{if(f){const b=typeof f=="string"?f:f instanceof Error?f.message:f.error;s.w(`Unable to perform style diff: ${b}. Rebuilding the style from scratch.`),this._updateStyle(m,a)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(a==null)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const f=Object.assign({},a);a&&a.config&&(f.initialConfig=a.config,delete f.config),this.style=new Na(this,f).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(m)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const a of m)if(!this._isValidId(a))return!1;return!0}return this._isTargetValid(m)}addSource(m,a){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,f)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,a,{pixelRatio:f=1,sdf:g=!1,stretchX:b,stretchY:E,content:C}={}){this._lazyInitEmptyStyle();const I=s.I.from(m);if(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:R,height:L,data:B}=s.o.getImageData(a);this.style.addImage(I,{data:new s.q({width:R,height:L},B),pixelRatio:f,stretchX:b,stretchY:E,content:C,sdf:g,version:0,usvg:!1})}else if(a.width===void 0||a.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:L}=a,B=a;this.style.addImage(I,{data:new s.q({width:R,height:L},new Uint8Array(B.data)),pixelRatio:f,stretchX:b,stretchY:E,content:C,sdf:g,usvg:!1,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,a){this._lazyInitEmptyStyle();const f=s.I.from(m),g=this.style.getImage(f);if(!g)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?s.o.getImageData(a):a,{width:E,height:C,data:I}=b;if(E===void 0||C===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(E!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||C!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${E}, ${C})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const R=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);let L=!1;g.usvg?(g.data=new s.q({width:E,height:C},new Uint8Array(I)),g.usvg=!1,g.icon=void 0,L=!0):g.data.replace(I,R),this.style.updateImage(f,g,L)}hasImage(m){return m?!!this.style&&!!this.style.getImage(s.I.from(m)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(s.I.from(m))}loadImage(m,a){s.n(this._requestManager.transformRequest(m,s.R.Image),(f,g)=>{a(f,g instanceof HTMLImageElement?s.o.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,a){this._lazyInitEmptyStyle(),this.style.addModel(m,a)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,a){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)):this}getSlot(m){const a=this.getLayer(m);return a&&a.slot||null}setSlot(m,a){return this.style.setSlot(m,a),this.style.mergeLayers(),this._update(!0)}addImport(m,a){return this.style.addImport(m,a).catch(f=>this.fire(new s.y(new Error("Failed to add import",f)))),this}updateImport(m,a){return typeof a!="string"&&a.id!==m?(this.removeImport(m),this.addImport(a)):(this.style.updateImport(m,a),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,a){return this.style.moveImport(m,a),this._update(!0)}moveLayer(m,a){return this._isValidId(m)?(this.style.moveLayer(m,a),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const a=this.style.getOwnLayer(m);return a?a.type==="custom"?a.implementation:a.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,a,f){return this._isValidId(m)?(this.style.setLayerZoomRange(m,a,f),this._update(!0)):this}setFilter(m,a,f={}){return this._isValidId(m)?(this.style.setFilter(m,a,f),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,a,f,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,a,f,g),this._update(!0)):this}getPaintProperty(m,a){return this._isValidId(m)?this.style.getPaintProperty(m,a):null}setLayoutProperty(m,a,f,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,a,f,g),this._update(!0)):this}getLayoutProperty(m,a){return this._isValidId(m)?this.style.getLayoutProperty(m,a):null}setLayerProperty(m,a,f,g={}){return this._isValidId(m)?(a==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(m,a,f,g),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,a){return this.style.setSchema(m,a),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,a){return this.style.setConfig(m,a),this._update(!0)}getConfigProperty(m,a){return this.style.getConfigProperty(m,a)}setConfigProperty(m,a,f){return this.style.setConfigProperty(m,a,f),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const a=m[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,a){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,a),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(m),this.transform):0}setFeatureState(m,a){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,a),this._update())}removeFeatureState(m,a){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,a),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.style.indoorManager.selectFloor(m)}_setIndoorActiveFloorsVisibility(m){this.style.indoorManager.setActiveFloorsVisibility(m)}getIndoorTileOptions(m,a){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(m,a):null}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,g,b,E=this._container;for(;E&&(!g||!b);){const C=window.getComputedStyle(E).transform;C&&C!=="none"&&(f=C.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(g=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(b=f[3])),E=E.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=b?Math.abs(a/b):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=U("div","mapboxgl-canvas-container",m);this._canvas=U("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=U("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(b=>{g[b]=U("div",`mapboxgl-ctrl-${b}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const f=s.o.devicePixelRatio||1;this._canvas.width=f*Math.ceil(m),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);a!==-1&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const m=Object.assign({},z.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",m);a?(la(a,!0),this.painter=new mC(a,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",f=>{if(f.dataType==="source"){const g=this.transform.elevation?this.transform.elevation._source():null;g&&f.sourceCacheId===g.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),s.k.testSupport(a)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;this.fire(new s.z("renderstart")),++this._frameId;const f=this.painter.context.extTimerQuery,g=s.o.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=b.createQuery(),b.beginQuery(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,L=this.transform.pitch,B=s.o.now(),V=new s.ac(R,{now:B,fadeDuration:E,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(g),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,A.mark(x.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const R=s.o.now()-g;b.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const L=b.getQueryParameter(a,b.QUERY_RESULT)/1e6;b.deleteQuery(a),this.fire(new s.z("gpu-timing-frame",{cpuTime:R,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(R);this.fire(new s.z("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(R);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:L}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(I||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(C=this._updateAverageElevation(g,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,A.mark(x.fullLoad),this._performanceMetricsCollection&&ui(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const f=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const b=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=m;const C=Math.abs(b-E);if(C>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(E),f(E);this._averageElevation.easeTo(E,m,300)}else if(C>1e-4)return this._averageElevation.jumpTo(E),f(E)}return!!this._averageElevation.isEasing(m)&&f(this._averageElevation.getValue(m))}_authenticate(){$s(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===je||m.status===401)){const a=this.painter.context.gl;la(a,!1),this._logoControl instanceof RC&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Yt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&mn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&sn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){ai(this._requestManager._customAccessToken)}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,g=f.createFramebuffer();function b(E){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,E,0);const C=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,C),C}return f.bindFramebuffer(f.FRAMEBUFFER,g),this._canvasPixelComparison(b(m),a.canvasCopies.map(b),a.timeStamps)}_canvasPixelComparison(m,a,f){let g=f[1]-f[0];const b=m.length/4;for(let E=0;E<a.length;E++){const C=a[E];let I=0;for(let R=0;R<C.length;R+=4)C[R]===m[R]&&C[R+1]===m[R+1]&&C[R+2]===m[R+2]&&C[R+3]===m[R+3]&&(I+=1);g+=(f[E+2]-f[E+1])*(1-I/b)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Xs.delete(this.painter.context.gl),Yr.remove(),Bt.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.o.frame(a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)}))}_preloadTiles(m){const a=this.style?this.style.getSourceCaches():[];return s.bw(a,(f,g)=>f._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this.style&&m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,a){s.f4(m,a)}get version(){return w}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},NC,m),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),f=a===m.getMaxZoom(),g=a===m.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gv(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const f=U("button",m,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(m,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",f),m.firstElementChild&&m.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends s.E{constructor(m={}){super();const a=navigator.geolocation;this.options=Object.assign({geolocation:a},pc,m),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=gC(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,m(f)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>a(f.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),f=m.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:m.coords,timestamp:m.timestamp},m.toJSON?{toJSON:m.toJSON.bind(m)}:{}))),this._finish()}}_updateCamera(m){const a=new s.aT(m.coords.longitude,m.coords.latitude),f=m.coords.accuracy,g=this._map.getBearing(),b=Object.assign({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),b,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new s.aT(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=s.cf(1,m._center.lat)*m.worldSize,f=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",{code:m.code,message:m.message,PERMISSION_DENIED:m.PERMISSION_DENIED,POSITION_UNAVAILABLE:m.POSITION_UNAVAILABLE,TIMEOUT:m.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const m=this.options.positionOptions.timeout;m&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},m))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(m){return this.options.followUserLocation=m??pc.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new s.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const m=()=>{const a="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(a,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:PC,ScaleControl:class{constructor(m={}){this.options=Object.assign({},qg,m),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,f=a._containerHeight/2,g=a._containerWidth/2-m/2,b=a.unproject([g,f]),E=a.unproject([g+m,f]),C=b.distanceTo(E);if(this.options.unit==="imperial"){const I=3.2808*C;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,C/1852,"nautical-mile"):C>=1e3?this._setScale(m,C/1e3,"kilometer"):this._setScale(m,C,"meter")}_setScale(m,a,f){this._map._requestDomTask(()=>{const g=function(E){const C=Math.pow(10,`${Math.floor(E)}`.length-1);let I=E/C;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(R){const L=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*L)/L}(I),C*I}(a),b=g/a;this._container.innerHTML=f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(g):`${g}&nbsp;${M_[f]}`,this._container.style.width=m*b+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:ab,Popup:class extends s.E{constructor(m){super(),this.options=Object.assign(Object.create(MC),m),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.aT.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const a=document.createDocumentFragment(),f=document.createElement("body");let g;for(f.innerHTML=m;g=f.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const f=this._closeButton=U("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.innerHTML='<span aria-hidden="true">&#215;</span>',f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,g=this._pos;if(!a||!f||!g)return"bottom";const b=f.offsetWidth,E=f.offsetHeight,C=g.x<b/2,I=g.x>a.transform.width-b/2;if(g.y+m<E)return C?"top-left":I?"top-right":"top";if(g.y>a.transform.height-E){if(C)return"bottom-left";if(I)return"bottom-right"}return C?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let g=this._container;if(g||(g=this._container=U("div","mapboxgl-popup",a.getContainer()),this._tip=U("div","mapboxgl-popup-tip",g),g.appendChild(f)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Gg(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m instanceof s.P?m:a.project(this._lngLat,this._altitude),E=Pp(this.options.offset),C=this._anchor=this._getAnchor(E.y),I=Pp(this.options.offset,C),R=b.add(I).round();a._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${Tl[C]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&a._showingGlobe()){const b=s.f5(a.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(o6);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Xr,Style:Na,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:x3,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(m){s.e.ACCESS_TOKEN=m},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(m){s.e.API_URL=m},get workerCount(){return s.fi.workerCount},set workerCount(m){s.fi.workerCount=m},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.fh(m)},get workerUrl(){return s.fg.workerUrl},set workerUrl(m){s.fg.workerUrl=m},get workerClass(){return s.fg.workerClass},set workerClass(m){s.fg.workerClass=m},get workerParams(){return s.fg.workerParams},set workerParams(m){s.fg.workerParams=m},get dracoUrl(){return s.ff()},set dracoUrl(m){s.fe(m)},get meshoptUrl(){return s.fd()},set meshoptUrl(m){s.fc(m)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var h=o;return h})})(zV);var xre=zV.exports;const fF=Zm(xre),Ere=({onTileSelect:t,selectedTiles:e})=>{const n=qt.useRef(null),i=qt.useRef(null),[o]=qt.useState(18),l=qt.useRef(e);qt.useEffect(()=>{l.current=e},[e]);const h="pk.eyJ1Ijoid2lubGV5MTMiLCJhIjoiY2t5OG8wZ2wwMTR3bTJvbm9yc2IwZ292OSJ9.pvfAWhyqGSbJM5jYoQAXfw";qt.useEffect(()=>{i.current||(fF.accessToken=h,i.current=new fF.Map({container:n.current,style:"mapbox://styles/mapbox/satellite-v9",center:[139.7671,35.6804],zoom:o,pitch:45}),i.current.on("load",()=>{i.current&&(i.current.addSource("grid",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i.current.addLayer({id:"grid-layer",type:"fill",source:"grid",paint:{"fill-color":["case",["boolean",["feature-state","selected"],!1],"#B6FE05","rgba(182, 254, 5, 0.05)"],"fill-opacity":["case",["boolean",["feature-state","selected"],!1],.8,.15],"fill-outline-color":"#B6FE05"}}),s())}),i.current.on("moveend",s),i.current.on("click","grid-layer",w=>{var z,U;if(!w.features||w.features.length===0)return;const x=w.features[0],A=(z=x.properties)==null?void 0:z.id,P=x.id;if(!A||P===void 0)return;const D=l.current.includes(A),M=D?l.current.filter(G=>G!==A):[...l.current,A];t(M),(U=i.current)==null||U.setFeatureState({source:"grid",id:P},{selected:!D})}),i.current.on("mouseenter","grid-layer",()=>{i.current&&(i.current.getCanvas().style.cursor="pointer")}),i.current.on("mouseleave","grid-layer",()=>{i.current&&(i.current.getCanvas().style.cursor="")}))},[]),qt.useEffect(()=>{if(!i.current)return;const w=i.current.getSource("grid");if(!w)return;const x=w._data;x!=null&&x.features&&x.features.forEach(A=>{var P;(P=i.current)==null||P.setFeatureState({source:"grid",id:A.id},{selected:e.includes(A.properties.id)})})},[e]);const s=()=>{if(!i.current)return;const w=i.current.getBounds();if(i.current.getZoom()<16){i.current.getSource("grid").setData({type:"FeatureCollection",features:[]});return}const A=1e-4,P=[];for(let D=Math.floor(w.getWest()/A)*A;D<=w.getEast();D+=A)for(let M=Math.floor(w.getSouth()/A)*A;M<=w.getNorth();M+=A){const z=Math.round(D/A),U=Math.round(M/A),G=`${z}_${U}`,ne=Math.abs((z*31+U)%1e6);P.push({type:"Feature",id:ne,properties:{id:G},geometry:{type:"Polygon",coordinates:[[[D,M],[D+A,M],[D+A,M+A],[D,M+A],[D,M]]]}})}i.current.getSource("grid").setData({type:"FeatureCollection",features:P}),P.forEach(D=>{var M;(M=i.current)==null||M.setFeatureState({source:"grid",id:D.id},{selected:e.includes(D.properties.id)})})};return ot.jsxs("div",{className:"relative w-full h-full",children:[ot.jsx("div",{ref:n,className:"absolute inset-0"}),ot.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex items-center gap-2 px-4 py-2 bg-black/60 backdrop-blur-md rounded-full border border-white/10 text-xs text-white/60 pointer-events-none",children:[ot.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),"Interactive Grid Active"]})]})},Cre=Symbol(),_k=Symbol(),Rx="a",jV="f",pF="p",VV="c",WV="t",wk="h",Bx="w",bk="o",vk="k";let Tre=(t,e)=>new Proxy(t,e);const VR=Object.getPrototypeOf,WR=new WeakMap,HV=t=>t&&(WR.has(t)?WR.get(t):VR(t)===Object.prototype||VR(t)===Array.prototype),iA=t=>typeof t=="object"&&t!==null,Are=t=>Object.values(Object.getOwnPropertyDescriptors(t)).some(e=>!e.configurable&&!e.writable),Sre=t=>{if(Array.isArray(t))return Array.from(t);const e=Object.getOwnPropertyDescriptors(t);return Object.values(e).forEach(n=>{n.configurable=!0}),Object.create(VR(t),e)},Ire=(t,e)=>{const n={[jV]:e};let i=!1;const o=(s,w)=>{if(!i){let x=n[Rx].get(t);if(x||(x={},n[Rx].set(t,x)),s===Bx)x[Bx]=!0;else{let A=x[s];A||(A=new Set,x[s]=A),A.add(w)}}},l=()=>{i=!0,n[Rx].delete(t)},h={get(s,w){return w===_k?t:(o(vk,w),GV(Reflect.get(s,w),n[Rx],n[VV],n[WV]))},has(s,w){return w===Cre?(l(),!0):(o(wk,w),Reflect.has(s,w))},getOwnPropertyDescriptor(s,w){return o(bk,w),Reflect.getOwnPropertyDescriptor(s,w)},ownKeys(s){return o(Bx),Reflect.ownKeys(s)}};return e&&(h.set=h.deleteProperty=()=>!1),[h,n]},xk=t=>t[_k]||t,GV=(t,e,n,i)=>{if(!HV(t))return t;let o=i&&i.get(t);if(!o){const w=xk(t);Are(w)?o=[w,Sre(w)]:o=[w],i==null||i.set(t,o)}const[l,h]=o;let s=n&&n.get(l);return(!s||s[1][jV]!==!!h)&&(s=Ire(l,!!h),s[1][pF]=Tre(h||l,s[0]),n&&n.set(l,s)),s[1][Rx]=e,s[1][VV]=n,s[1][WV]=i,s[1][pF]},Pre=(t,e)=>{const n=Reflect.ownKeys(t),i=Reflect.ownKeys(e);return n.length!==i.length||n.some((o,l)=>o!==i[l])},qV=(t,e,n,i,o=Object.is)=>{if(o(t,e))return!1;if(!iA(t)||!iA(e))return!0;const l=n.get(xk(t));if(!l)return!0;if(i){if(i.get(t)===e)return!1;i.set(t,e)}let h=null;for(const s of l[wk]||[])if(h=Reflect.has(t,s)!==Reflect.has(e,s),h)return h;if(l[Bx]===!0){if(h=Pre(t,e),h)return h}else for(const s of l[bk]||[]){const w=!!Reflect.getOwnPropertyDescriptor(t,s),x=!!Reflect.getOwnPropertyDescriptor(e,s);if(h=w!==x,h)return h}for(const s of l[vk]||[])if(h=qV(t[s],e[s],n,i,o),h)return h;if(h===null)throw new Error("invalid used");return h},Rre=t=>HV(t)&&t[_k]||null,mF=(t,e=!0)=>{WR.set(t,e)},Ore=(t,e,n)=>{const i=[],o=new WeakSet,l=(h,s)=>{var w,x,A;if(o.has(h))return;iA(h)&&o.add(h);const P=iA(h)&&e.get(xk(h));if(P){if((w=P[wk])===null||w===void 0||w.forEach(D=>{const M=`:has(${String(D)})`;i.push(s?[...s,M]:[M])}),P[Bx]===!0){const D=":ownKeys";i.push(s?[...s,D]:[D])}else(x=P[bk])===null||x===void 0||x.forEach(D=>{const M=`:hasOwn(${String(D)})`;i.push(s?[...s,M]:[M])});(A=P[vk])===null||A===void 0||A.forEach(D=>{"value"in(Object.getOwnPropertyDescriptor(h,D)||{})&&l(h[D],s?[...s,D]:[D])})}else s&&i.push(s)};return l(t),i},rA={},Ek=t=>typeof t=="object"&&t!==null,kre=t=>Ek(t)&&!mE.has(t)&&(Array.isArray(t)||!(Symbol.iterator in t))&&!(t instanceof WeakMap)&&!(t instanceof WeakSet)&&!(t instanceof Error)&&!(t instanceof Number)&&!(t instanceof Date)&&!(t instanceof String)&&!(t instanceof RegExp)&&!(t instanceof ArrayBuffer)&&!(t instanceof Promise),ZV=(t,e)=>{const n=HR.get(t);if((n==null?void 0:n[0])===e)return n[1];const i=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));return mF(i,!0),HR.set(t,[e,i]),Reflect.ownKeys(t).forEach(o=>{if(Object.getOwnPropertyDescriptor(i,o))return;const l=Reflect.get(t,o),{enumerable:h}=Reflect.getOwnPropertyDescriptor(t,o),s={value:l,enumerable:h,configurable:!0};if(mE.has(l))mF(l,!1);else if(Im.has(l)){const[w,x]=Im.get(l);s.value=ZV(w,x())}Object.defineProperty(i,o,s)}),Object.preventExtensions(i)},Dre=(t,e,n,i)=>({deleteProperty(o,l){const h=Reflect.get(o,l);n(l);const s=Reflect.deleteProperty(o,l);return s&&i(["delete",[l],h]),s},set(o,l,h,s){const w=!t()&&Reflect.has(o,l),x=Reflect.get(o,l,s);if(w&&(gF(x,h)||n2.has(h)&&gF(x,n2.get(h))))return!0;n(l),Ek(h)&&(h=Rre(h)||h);const A=!Im.has(h)&&Mre(h)?Zr(h):h;return e(l,A),Reflect.set(o,l,A,s),i(["set",[l],h,x]),!0}}),Im=new WeakMap,mE=new WeakSet,HR=new WeakMap,MT=[1],n2=new WeakMap;let gF=Object.is,Nre=(t,e)=>new Proxy(t,e),Mre=kre,Lre=ZV,Bre=Dre;function Zr(t={}){if(!Ek(t))throw new Error("object required");const e=n2.get(t);if(e)return e;let n=MT[0];const i=new Set,o=(G,ne=++MT[0])=>{n!==ne&&(l=n=ne,i.forEach(oe=>oe(G,ne)))};let l=n;const h=(G=MT[0])=>(l!==G&&(l=G,w.forEach(([ne])=>{const oe=ne[1](G);oe>n&&(n=oe)})),n),s=G=>(ne,oe)=>{const Q=[...ne];Q[1]=[G,...Q[1]],o(Q,oe)},w=new Map,x=(G,ne)=>{const oe=!mE.has(ne)&&Im.get(ne);if(oe){if((rA?"production":void 0)!=="production"&&w.has(G))throw new Error("prop listener already exists");if(i.size){const Q=oe[2](s(G));w.set(G,[oe,Q])}else w.set(G,[oe])}},A=G=>{var ne;const oe=w.get(G);oe&&(w.delete(G),(ne=oe[1])==null||ne.call(oe))},P=G=>(i.add(G),i.size===1&&w.forEach(([oe,Q],de)=>{if((rA?"production":void 0)!=="production"&&Q)throw new Error("remove already exists");const he=oe[2](s(de));w.set(de,[oe,he])}),()=>{i.delete(G),i.size===0&&w.forEach(([oe,Q],de)=>{Q&&(Q(),w.set(de,[oe]))})});let D=!0;const M=Bre(()=>D,x,A,o),z=Nre(t,M);n2.set(t,z);const U=[t,h,P];return Im.set(z,U),Reflect.ownKeys(t).forEach(G=>{const ne=Object.getOwnPropertyDescriptor(t,G);"value"in ne&&ne.writable&&(z[G]=t[G])}),D=!1,z}function so(t,e,n){const i=Im.get(t);(rA?"production":void 0)!=="production"&&!i&&console.warn("Please use proxy object");let o;const l=[],h=i[2];let s=!1;const x=h(A=>{l.push(A),o||(o=Promise.resolve().then(()=>{o=void 0,s&&e(l.splice(0))}))});return s=!0,()=>{s=!1,x()}}function j0(t){const e=Im.get(t);(rA?"production":void 0)!=="production"&&!e&&console.warn("Please use proxy object");const[n,i]=e;return Lre(n,i())}function J1(t){return mE.add(t),t}function Fre(){return{proxyStateMap:Im,refSet:mE,snapCache:HR,versionHolder:MT,proxyCache:n2}}function oo(t,e,n,i){let o=t[e];return so(t,()=>{const l=t[e];Object.is(o,l)||n(o=l)})}const{proxyStateMap:$re,snapCache:zre}=Fre(),B5=t=>$re.has(t);function Ure(t){const e=[];let n=0;const i=new Map,o=new WeakMap,l=()=>{const x=zre.get(s),A=x==null?void 0:x[1];if(A&&!o.has(A)){const P=new Map(i);o.set(A,P)}},h=x=>o.get(x)||i,s={data:e,index:n,epoch:0,get size(){return B5(this)||l(),h(this).size},get(x){const P=h(this).get(x);if(P===void 0){this.epoch;return}return this.data[P]},has(x){const A=h(this);return this.epoch,A.has(x)},set(x,A){if(!B5(this))throw new Error("Cannot perform mutations on a snapshot");const P=i.get(x);return P===void 0?(i.set(x,this.index),this.data[this.index++]=A):this.data[P]=A,this.epoch++,this},delete(x){if(!B5(this))throw new Error("Cannot perform mutations on a snapshot");const A=i.get(x);return A===void 0?!1:(delete this.data[A],i.delete(x),this.epoch++,!0)},clear(){if(!B5(this))throw new Error("Cannot perform mutations on a snapshot");this.data.length=0,this.index=0,this.epoch++,i.clear()},forEach(x){this.epoch,h(this).forEach((P,D)=>{x(this.data[P],D,this)})},*entries(){this.epoch;const x=h(this);for(const[A,P]of x)yield[A,this.data[P]]},*keys(){this.epoch;const x=h(this);for(const A of x.keys())yield A},*values(){this.epoch;const x=h(this);for(const A of x.values())yield this.data[A]},[Symbol.iterator](){return this.entries()},get[Symbol.toStringTag](){return"Map"},toJSON(){return new Map(this.entries())}},w=Zr(s);return Object.defineProperties(w,{size:{enumerable:!1},index:{enumerable:!1},epoch:{enumerable:!1},data:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(w),w}const KV={isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())}};var YV={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Tc,function(){var n=1e3,i=6e4,o=36e5,l="millisecond",h="second",s="minute",w="hour",x="day",A="week",P="month",D="quarter",M="year",z="date",U="Invalid Date",G=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ne=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,oe={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(Ye){var re=["th","st","nd","rd"],le=Ye%100;return"["+Ye+(re[(le-20)%10]||re[le]||re[0])+"]"}},Q=function(Ye,re,le){var Ae=String(Ye);return!Ae||Ae.length>=re?Ye:""+Array(re+1-Ae.length).join(le)+Ye},de={s:Q,z:function(Ye){var re=-Ye.utcOffset(),le=Math.abs(re),Ae=Math.floor(le/60),Le=le%60;return(re<=0?"+":"-")+Q(Ae,2,"0")+":"+Q(Le,2,"0")},m:function Ye(re,le){if(re.date()<le.date())return-Ye(le,re);var Ae=12*(le.year()-re.year())+(le.month()-re.month()),Le=re.clone().add(Ae,P),De=le-Le<0,He=re.clone().add(Ae+(De?-1:1),P);return+(-(Ae+(le-Le)/(De?Le-He:He-Le))||0)},a:function(Ye){return Ye<0?Math.ceil(Ye)||0:Math.floor(Ye)},p:function(Ye){return{M:P,y:M,w:A,d:x,D:z,h:w,m:s,s:h,ms:l,Q:D}[Ye]||String(Ye||"").toLowerCase().replace(/s$/,"")},u:function(Ye){return Ye===void 0}},he="en",Ie={};Ie[he]=oe;var ke="$isDayjsObject",Ue=function(Ye){return Ye instanceof ct||!(!Ye||!Ye[ke])},ze=function Ye(re,le,Ae){var Le;if(!re)return he;if(typeof re=="string"){var De=re.toLowerCase();Ie[De]&&(Le=De),le&&(Ie[De]=le,Le=De);var He=re.split("-");if(!Le&&He.length>1)return Ye(He[0])}else{var Et=re.name;Ie[Et]=re,Le=Et}return!Ae&&Le&&(he=Le),Le||!Ae&&he},ht=function(Ye,re){if(Ue(Ye))return Ye.clone();var le=typeof re=="object"?re:{};return le.date=Ye,le.args=arguments,new ct(le)},ft=de;ft.l=ze,ft.i=Ue,ft.w=function(Ye,re){return ht(Ye,{locale:re.$L,utc:re.$u,x:re.$x,$offset:re.$offset})};var ct=function(){function Ye(le){this.$L=ze(le.locale,null,!0),this.parse(le),this.$x=this.$x||le.x||{},this[ke]=!0}var re=Ye.prototype;return re.parse=function(le){this.$d=function(Ae){var Le=Ae.date,De=Ae.utc;if(Le===null)return new Date(NaN);if(ft.u(Le))return new Date;if(Le instanceof Date)return new Date(Le);if(typeof Le=="string"&&!/Z$/i.test(Le)){var He=Le.match(G);if(He){var Et=He[2]-1||0,Ct=(He[7]||"0").substring(0,3);return De?new Date(Date.UTC(He[1],Et,He[3]||1,He[4]||0,He[5]||0,He[6]||0,Ct)):new Date(He[1],Et,He[3]||1,He[4]||0,He[5]||0,He[6]||0,Ct)}}return new Date(Le)}(le),this.init()},re.init=function(){var le=this.$d;this.$y=le.getFullYear(),this.$M=le.getMonth(),this.$D=le.getDate(),this.$W=le.getDay(),this.$H=le.getHours(),this.$m=le.getMinutes(),this.$s=le.getSeconds(),this.$ms=le.getMilliseconds()},re.$utils=function(){return ft},re.isValid=function(){return this.$d.toString()!==U},re.isSame=function(le,Ae){var Le=ht(le);return this.startOf(Ae)<=Le&&Le<=this.endOf(Ae)},re.isAfter=function(le,Ae){return ht(le)<this.startOf(Ae)},re.isBefore=function(le,Ae){return this.endOf(Ae)<ht(le)},re.$g=function(le,Ae,Le){return ft.u(le)?this[Ae]:this.set(Le,le)},re.unix=function(){return Math.floor(this.valueOf()/1e3)},re.valueOf=function(){return this.$d.getTime()},re.startOf=function(le,Ae){var Le=this,De=!!ft.u(Ae)||Ae,He=ft.p(le),Et=function(sn,_n){var ai=ft.w(Le.$u?Date.UTC(Le.$y,_n,sn):new Date(Le.$y,_n,sn),Le);return De?ai:ai.endOf(x)},Ct=function(sn,_n){return ft.w(Le.toDate()[sn].apply(Le.toDate("s"),(De?[0,0,0,0]:[23,59,59,999]).slice(_n)),Le)},Dt=this.$W,Bt=this.$M,Yt=this.$D,yn="set"+(this.$u?"UTC":"");switch(He){case M:return De?Et(1,0):Et(31,11);case P:return De?Et(1,Bt):Et(0,Bt+1);case A:var mn=this.$locale().weekStart||0,oi=(Dt<mn?Dt+7:Dt)-mn;return Et(De?Yt-oi:Yt+(6-oi),Bt);case x:case z:return Ct(yn+"Hours",0);case w:return Ct(yn+"Minutes",1);case s:return Ct(yn+"Seconds",2);case h:return Ct(yn+"Milliseconds",3);default:return this.clone()}},re.endOf=function(le){return this.startOf(le,!1)},re.$set=function(le,Ae){var Le,De=ft.p(le),He="set"+(this.$u?"UTC":""),Et=(Le={},Le[x]=He+"Date",Le[z]=He+"Date",Le[P]=He+"Month",Le[M]=He+"FullYear",Le[w]=He+"Hours",Le[s]=He+"Minutes",Le[h]=He+"Seconds",Le[l]=He+"Milliseconds",Le)[De],Ct=De===x?this.$D+(Ae-this.$W):Ae;if(De===P||De===M){var Dt=this.clone().set(z,1);Dt.$d[Et](Ct),Dt.init(),this.$d=Dt.set(z,Math.min(this.$D,Dt.daysInMonth())).$d}else Et&&this.$d[Et](Ct);return this.init(),this},re.set=function(le,Ae){return this.clone().$set(le,Ae)},re.get=function(le){return this[ft.p(le)]()},re.add=function(le,Ae){var Le,De=this;le=Number(le);var He=ft.p(Ae),Et=function(Bt){var Yt=ht(De);return ft.w(Yt.date(Yt.date()+Math.round(Bt*le)),De)};if(He===P)return this.set(P,this.$M+le);if(He===M)return this.set(M,this.$y+le);if(He===x)return Et(1);if(He===A)return Et(7);var Ct=(Le={},Le[s]=i,Le[w]=o,Le[h]=n,Le)[He]||1,Dt=this.$d.getTime()+le*Ct;return ft.w(Dt,this)},re.subtract=function(le,Ae){return this.add(-1*le,Ae)},re.format=function(le){var Ae=this,Le=this.$locale();if(!this.isValid())return Le.invalidDate||U;var De=le||"YYYY-MM-DDTHH:mm:ssZ",He=ft.z(this),Et=this.$H,Ct=this.$m,Dt=this.$M,Bt=Le.weekdays,Yt=Le.months,yn=Le.meridiem,mn=function(_n,ai,er,ui){return _n&&(_n[ai]||_n(Ae,De))||er[ai].slice(0,ui)},oi=function(_n){return ft.s(Et%12||12,_n,"0")},sn=yn||function(_n,ai,er){var ui=_n<12?"AM":"PM";return er?ui.toLowerCase():ui};return De.replace(ne,function(_n,ai){return ai||function(er){switch(er){case"YY":return String(Ae.$y).slice(-2);case"YYYY":return ft.s(Ae.$y,4,"0");case"M":return Dt+1;case"MM":return ft.s(Dt+1,2,"0");case"MMM":return mn(Le.monthsShort,Dt,Yt,3);case"MMMM":return mn(Yt,Dt);case"D":return Ae.$D;case"DD":return ft.s(Ae.$D,2,"0");case"d":return String(Ae.$W);case"dd":return mn(Le.weekdaysMin,Ae.$W,Bt,2);case"ddd":return mn(Le.weekdaysShort,Ae.$W,Bt,3);case"dddd":return Bt[Ae.$W];case"H":return String(Et);case"HH":return ft.s(Et,2,"0");case"h":return oi(1);case"hh":return oi(2);case"a":return sn(Et,Ct,!0);case"A":return sn(Et,Ct,!1);case"m":return String(Ct);case"mm":return ft.s(Ct,2,"0");case"s":return String(Ae.$s);case"ss":return ft.s(Ae.$s,2,"0");case"SSS":return ft.s(Ae.$ms,3,"0");case"Z":return He}return null}(_n)||He.replace(":","")})},re.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},re.diff=function(le,Ae,Le){var De,He=this,Et=ft.p(Ae),Ct=ht(le),Dt=(Ct.utcOffset()-this.utcOffset())*i,Bt=this-Ct,Yt=function(){return ft.m(He,Ct)};switch(Et){case M:De=Yt()/12;break;case P:De=Yt();break;case D:De=Yt()/3;break;case A:De=(Bt-Dt)/6048e5;break;case x:De=(Bt-Dt)/864e5;break;case w:De=Bt/o;break;case s:De=Bt/i;break;case h:De=Bt/n;break;default:De=Bt}return Le?De:ft.a(De)},re.daysInMonth=function(){return this.endOf(P).$D},re.$locale=function(){return Ie[this.$L]},re.locale=function(le,Ae){if(!le)return this.$L;var Le=this.clone(),De=ze(le,Ae,!0);return De&&(Le.$L=De),Le},re.clone=function(){return ft.w(this.$d,this)},re.toDate=function(){return new Date(this.valueOf())},re.toJSON=function(){return this.isValid()?this.toISOString():null},re.toISOString=function(){return this.$d.toISOString()},re.toString=function(){return this.$d.toUTCString()},Ye}(),je=ct.prototype;return ht.prototype=je,[["$ms",l],["$s",h],["$m",s],["$H",w],["$W",x],["$M",P],["$y",M],["$D",z]].forEach(function(Ye){je[Ye[1]]=function(re){return this.$g(re,Ye[0],Ye[1])}}),ht.extend=function(Ye,re){return Ye.$i||(Ye(re,ct,ht),Ye.$i=!0),ht},ht.locale=ze,ht.isDayjs=Ue,ht.unix=function(Ye){return ht(1e3*Ye)},ht.en=Ie[he],ht.Ls=Ie,ht.p={},ht})})(YV);var jre=YV.exports;const B1=Zm(jre);var XV={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Tc,function(){return{name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(n){var i=["th","st","nd","rd"],o=n%100;return"["+n+(i[(o-20)%10]||i[o]||i[0])+"]"}}})})(XV);var Vre=XV.exports;const Wre=Zm(Vre);var JV={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Tc,function(){return function(n,i,o){n=n||{};var l=i.prototype,h={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function s(x,A,P,D){return l.fromToBase(x,A,P,D)}o.en.relativeTime=h,l.fromToBase=function(x,A,P,D,M){for(var z,U,G,ne=P.$locale().relativeTime||h,oe=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],Q=oe.length,de=0;de<Q;de+=1){var he=oe[de];he.d&&(z=D?o(x).diff(P,he.d,!0):P.diff(x,he.d,!0));var Ie=(n.rounding||Math.round)(Math.abs(z));if(G=z>0,Ie<=he.r||!he.r){Ie<=1&&de>0&&(he=oe[de-1]);var ke=ne[he.l];M&&(Ie=M(""+Ie)),U=typeof ke=="string"?ke.replace("%d",Ie):ke(Ie,A,he.l,G);break}}if(A)return U;var Ue=G?ne.future:ne.past;return typeof Ue=="function"?Ue(U):Ue.replace("%s",U)},l.to=function(x,A){return s(x,A,this,!0)},l.from=function(x,A){return s(x,A,this)};var w=function(x){return x.$u?o.utc():o()};l.toNow=function(x){return this.to(w(this),x)},l.fromNow=function(x){return this.from(w(this),x)}}})})(JV);var Hre=JV.exports;const Gre=Zm(Hre);var QV={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Tc,function(){return function(n,i,o){o.updateLocale=function(l,h){var s=o.Ls[l];if(s)return(h?Object.keys(h):[]).forEach(function(w){s[w]=h[w]}),s}}})})(QV);var qre=QV.exports;const Zre=Zm(qre);B1.extend(Gre);B1.extend(Zre);const Kre={...Wre,name:"en-web3-modal",relativeTime:{future:"in %s",past:"%s ago",s:"%d sec",m:"1 min",mm:"%d min",h:"1 hr",hh:"%d hrs",d:"1 d",dd:"%d d",M:"1 mo",MM:"%d mo",y:"1 yr",yy:"%d yr"}},Yre=["January","February","March","April","May","June","July","August","September","October","November","December"];B1.locale("en-web3-modal",Kre);const GR={getMonthNameByIndex(t){return Yre[t]},getYear(t=new Date().toISOString()){return B1(t).year()},getRelativeDateFromNow(t){return B1(t).locale("en-web3-modal").fromNow(!0)},formatDate(t,e="DD MMM"){return B1(t).format(e)}};var yF={};const at={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",BASE_ACCOUNT:"baseAccount",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122",TON:"ton"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos",sui:"Sui",stacks:"Stacks",ton:"TON"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",TON:"ton"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],SOLANA_SPL_TOKEN_ADDRESSES:{SOL:"So11111111111111111111111111111111111111112"},NATIVE_IMAGE_IDS_BY_NAMESPACE:{eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"3e8119e5-2a6f-4818-c50c-1937011d5900",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00"},TOKEN_SYMBOLS_BY_ADDRESS:{"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48":"USDC","0x833589fcd6edb6e08f4c7c32d4f71b54bda02913":"USDC","0x0b2c639c533813f4aa9d7837caf62653d097ff85":"USDC","0xaf88d065e77c8cc2239327c5edb3a432268e5831":"USDC","0x3c499c542cef5e3811e1192ce70d8cc03d5c3359":"USDC","0x2791bca1f2de4661ed88a30c99a7a9449aa84174":"USDC",EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v:"USDC","0xdac17f958d2ee523a2206206994597c13d831ec7":"USDT","0x94b008aa00579c1307b0ef2c499ad98a8ce58e58":"USDT","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9":"USDT","0xc2132d05d31c914a87c6611c10748aeb04b58e8f":"USDT",Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB:"USDT"},HTTP_STATUS_CODES:{SERVER_ERROR:500,TOO_MANY_REQUESTS:429,SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof process<"u"&&typeof yF<"u"?yF.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",REMOTE_FEATURES_ALERTS:{MULTI_WALLET_NOT_ENABLED:{DEFAULT:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com."},CONNECTIONS_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnections hook."},CONNECTION_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnection hook."}},HEADLESS_NOT_ENABLED:{DEFAULT:{displayMessage:"",debugMessage:"Headless support is not enabled. Please enable it with the features.headless option in the AppKit configuration and make sure your current plan supports it."}}},IS_DEVELOPMENT:typeof process<"u"&&!1,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://localhost:*","http://127.0.0.1:*","https://127.0.0.1:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"],METMASK_CONNECTOR_NAME:"MetaMask",TRUST_CONNECTOR_NAME:"Trust Wallet",SOLFLARE_CONNECTOR_NAME:"Solflare",PHANTOM_CONNECTOR_NAME:"Phantom",COIN98_CONNECTOR_NAME:"Coin98",MAGIC_EDEN_CONNECTOR_NAME:"Magic Eden",BACKPACK_CONNECTOR_NAME:"Backpack",BITGET_CONNECTOR_NAME:"Bitget Wallet",FRONTIER_CONNECTOR_NAME:"Frontier",XVERSE_CONNECTOR_NAME:"Xverse Wallet",LEATHER_CONNECTOR_NAME:"Leather",OKX_CONNECTOR_NAME:"OKX Wallet",BINANCE_CONNECTOR_NAME:"Binance Wallet",EIP155:"eip155",ADD_CHAIN_METHOD:"wallet_addEthereumChain",EIP6963_ANNOUNCE_EVENT:"eip6963:announceProvider",EIP6963_REQUEST_EVENT:"eip6963:requestProvider",CONNECTOR_RDNS_MAP:{coinbaseWallet:"com.coinbase.wallet",coinbaseWalletSDK:"com.coinbase.wallet"},CONNECTOR_TYPE_EXTERNAL:"EXTERNAL",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH",CONNECTOR_TYPE_MULTI_CHAIN:"MULTI_CHAIN",CONNECTOR_TYPE_W3M_AUTH:"AUTH"},i2={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return(t==null?void 0:t.filter(n=>n.chainNamespace===e))||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){var o;if(!e)return;const n=t.find(l=>l.caipNetworkId===e);if(n)return n.name;const[i]=e.split(":");return((o=at.CHAIN_NAME_MAP)==null?void 0:o[i])||void 0}},eW=["eip155","solana","polkadot","bip122","cosmos","sui","stacks"];var Xre=20,Jre=1,V0=1e6,_F=1e6,Qre=-7,ese=21,tse=!1,gE="[big.js] ",Cy=gE+"Invalid ",AS=Cy+"decimal places",nse=Cy+"rounding mode",tW=gE+"Division by zero",qr={},yh=void 0,ise=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function nW(){function t(e){var n=this;if(!(n instanceof t))return e===yh?nW():new t(e);if(e instanceof t)n.s=e.s,n.e=e.e,n.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(Cy+"value");e=e===0&&1/e<0?"-0":String(e)}rse(n,e)}n.constructor=t}return t.prototype=qr,t.DP=Xre,t.RM=Jre,t.NE=Qre,t.PE=ese,t.strict=tse,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function rse(t,e){var n,i,o;if(!ise.test(e))throw Error(Cy+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(n=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(n<0&&(n=i),n+=+e.slice(i+1),e=e.substring(0,i)):n<0&&(n=e.length),o=e.length,i=0;i<o&&e.charAt(i)=="0";)++i;if(i==o)t.c=[t.e=0];else{for(;o>0&&e.charAt(--o)=="0";);for(t.e=n-i-1,t.c=[],n=0;i<=o;)t.c[n++]=+e.charAt(i++)}return t}function Ty(t,e,n,i){var o=t.c;if(n===yh&&(n=t.constructor.RM),n!==0&&n!==1&&n!==2&&n!==3)throw Error(nse);if(e<1)i=n===3&&(i||!!o[0])||e===0&&(n===1&&o[0]>=5||n===2&&(o[0]>5||o[0]===5&&(i||o[1]!==yh))),o.length=1,i?(t.e=t.e-e+1,o[0]=1):o[0]=t.e=0;else if(e<o.length){if(i=n===1&&o[e]>=5||n===2&&(o[e]>5||o[e]===5&&(i||o[e+1]!==yh||o[e-1]&1))||n===3&&(i||!!o[0]),o.length=e,i){for(;++o[--e]>9;)if(o[e]=0,e===0){++t.e,o.unshift(1);break}}for(e=o.length;!o[--e];)o.pop()}return t}function Ay(t,e,n){var i=t.e,o=t.c.join(""),l=o.length;if(e)o=o.charAt(0)+(l>1?"."+o.slice(1):"")+(i<0?"e":"e+")+i;else if(i<0){for(;++i;)o="0"+o;o="0."+o}else if(i>0)if(++i>l)for(i-=l;i--;)o+="0";else i<l&&(o=o.slice(0,i)+"."+o.slice(i));else l>1&&(o=o.charAt(0)+"."+o.slice(1));return t.s<0&&n?"-"+o:o}qr.abs=function(){var t=new this.constructor(this);return t.s=1,t};qr.cmp=function(t){var e,n=this,i=n.c,o=(t=new n.constructor(t)).c,l=n.s,h=t.s,s=n.e,w=t.e;if(!i[0]||!o[0])return i[0]?l:o[0]?-h:0;if(l!=h)return l;if(e=l<0,s!=w)return s>w^e?1:-1;for(h=(s=i.length)<(w=o.length)?s:w,l=-1;++l<h;)if(i[l]!=o[l])return i[l]>o[l]^e?1:-1;return s==w?0:s>w^e?1:-1};qr.div=function(t){var e=this,n=e.constructor,i=e.c,o=(t=new n(t)).c,l=e.s==t.s?1:-1,h=n.DP;if(h!==~~h||h<0||h>V0)throw Error(AS);if(!o[0])throw Error(tW);if(!i[0])return t.s=l,t.c=[t.e=0],t;var s,w,x,A,P,D=o.slice(),M=s=o.length,z=i.length,U=i.slice(0,s),G=U.length,ne=t,oe=ne.c=[],Q=0,de=h+(ne.e=e.e-t.e)+1;for(ne.s=l,l=de<0?0:de,D.unshift(0);G++<s;)U.push(0);do{for(x=0;x<10;x++){if(s!=(G=U.length))A=s>G?1:-1;else for(P=-1,A=0;++P<s;)if(o[P]!=U[P]){A=o[P]>U[P]?1:-1;break}if(A<0){for(w=G==s?o:D;G;){if(U[--G]<w[G]){for(P=G;P&&!U[--P];)U[P]=9;--U[P],U[G]+=10}U[G]-=w[G]}for(;!U[0];)U.shift()}else break}oe[Q++]=A?x:++x,U[0]&&A?U[G]=i[M]||0:U=[i[M]]}while((M++<z||U[0]!==yh)&&l--);return!oe[0]&&Q!=1&&(oe.shift(),ne.e--,de--),Q>de&&Ty(ne,de,n.RM,U[0]!==yh),ne};qr.eq=function(t){return this.cmp(t)===0};qr.gt=function(t){return this.cmp(t)>0};qr.gte=function(t){return this.cmp(t)>-1};qr.lt=function(t){return this.cmp(t)<0};qr.lte=function(t){return this.cmp(t)<1};qr.minus=qr.sub=function(t){var e,n,i,o,l=this,h=l.constructor,s=l.s,w=(t=new h(t)).s;if(s!=w)return t.s=-w,l.plus(t);var x=l.c.slice(),A=l.e,P=t.c,D=t.e;if(!x[0]||!P[0])return P[0]?t.s=-w:x[0]?t=new h(l):t.s=1,t;if(s=A-D){for((o=s<0)?(s=-s,i=x):(D=A,i=P),i.reverse(),w=s;w--;)i.push(0);i.reverse()}else for(n=((o=x.length<P.length)?x:P).length,s=w=0;w<n;w++)if(x[w]!=P[w]){o=x[w]<P[w];break}if(o&&(i=x,x=P,P=i,t.s=-t.s),(w=(n=P.length)-(e=x.length))>0)for(;w--;)x[e++]=0;for(w=e;n>s;){if(x[--n]<P[n]){for(e=n;e&&!x[--e];)x[e]=9;--x[e],x[n]+=10}x[n]-=P[n]}for(;x[--w]===0;)x.pop();for(;x[0]===0;)x.shift(),--D;return x[0]||(t.s=1,x=[D=0]),t.c=x,t.e=D,t};qr.mod=function(t){var e,n=this,i=n.constructor,o=n.s,l=(t=new i(t)).s;if(!t.c[0])throw Error(tW);return n.s=t.s=1,e=t.cmp(n)==1,n.s=o,t.s=l,e?new i(n):(o=i.DP,l=i.RM,i.DP=i.RM=0,n=n.div(t),i.DP=o,i.RM=l,this.minus(n.times(t)))};qr.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};qr.plus=qr.add=function(t){var e,n,i,o=this,l=o.constructor;if(t=new l(t),o.s!=t.s)return t.s=-t.s,o.minus(t);var h=o.e,s=o.c,w=t.e,x=t.c;if(!s[0]||!x[0])return x[0]||(s[0]?t=new l(o):t.s=o.s),t;if(s=s.slice(),e=h-w){for(e>0?(w=h,i=x):(e=-e,i=s),i.reverse();e--;)i.push(0);i.reverse()}for(s.length-x.length<0&&(i=x,x=s,s=i),e=x.length,n=0;e;s[e]%=10)n=(s[--e]=s[e]+x[e]+n)/10|0;for(n&&(s.unshift(n),++w),e=s.length;s[--e]===0;)s.pop();return t.c=s,t.e=w,t};qr.pow=function(t){var e=this,n=new e.constructor("1"),i=n,o=t<0;if(t!==~~t||t<-_F||t>_F)throw Error(Cy+"exponent");for(o&&(t=-t);t&1&&(i=i.times(e)),t>>=1,!!t;)e=e.times(e);return o?n.div(i):i};qr.prec=function(t,e){if(t!==~~t||t<1||t>V0)throw Error(Cy+"precision");return Ty(new this.constructor(this),t,e)};qr.round=function(t,e){if(t===yh)t=0;else if(t!==~~t||t<-V0||t>V0)throw Error(AS);return Ty(new this.constructor(this),t+this.e+1,e)};qr.sqrt=function(){var t,e,n,i=this,o=i.constructor,l=i.s,h=i.e,s=new o("0.5");if(!i.c[0])return new o(i);if(l<0)throw Error(gE+"No square root");l=Math.sqrt(+Ay(i,!0,!0)),l===0||l===1/0?(e=i.c.join(""),e.length+h&1||(e+="0"),l=Math.sqrt(e),h=((h+1)/2|0)-(h<0||h&1),t=new o((l==1/0?"5e":(l=l.toExponential()).slice(0,l.indexOf("e")+1))+h)):t=new o(l+""),h=t.e+(o.DP+=4);do n=t,t=s.times(n.plus(i.div(n)));while(n.c.slice(0,h).join("")!==t.c.slice(0,h).join(""));return Ty(t,(o.DP-=4)+t.e+1,o.RM)};qr.times=qr.mul=function(t){var e,n=this,i=n.constructor,o=n.c,l=(t=new i(t)).c,h=o.length,s=l.length,w=n.e,x=t.e;if(t.s=n.s==t.s?1:-1,!o[0]||!l[0])return t.c=[t.e=0],t;for(t.e=w+x,h<s&&(e=o,o=l,l=e,x=h,h=s,s=x),e=new Array(x=h+s);x--;)e[x]=0;for(w=s;w--;){for(s=0,x=h+w;x>w;)s=e[x]+l[w]*o[x-w-1]+s,e[x--]=s%10,s=s/10|0;e[x]=s}for(s?++t.e:e.shift(),w=e.length;!e[--w];)e.pop();return t.c=e,t};qr.toExponential=function(t,e){var n=this,i=n.c[0];if(t!==yh){if(t!==~~t||t<0||t>V0)throw Error(AS);for(n=Ty(new n.constructor(n),++t,e);n.c.length<t;)n.c.push(0)}return Ay(n,!0,!!i)};qr.toFixed=function(t,e){var n=this,i=n.c[0];if(t!==yh){if(t!==~~t||t<0||t>V0)throw Error(AS);for(n=Ty(new n.constructor(n),t+n.e+1,e),t=t+n.e+1;n.c.length<t;)n.c.push(0)}return Ay(n,!1,!!i)};qr[Symbol.for("nodejs.util.inspect.custom")]=qr.toJSON=qr.toString=function(){var t=this,e=t.constructor;return Ay(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};qr.toNumber=function(){var t=+Ay(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(gE+"Imprecise conversion");return t};qr.toPrecision=function(t,e){var n=this,i=n.constructor,o=n.c[0];if(t!==yh){if(t!==~~t||t<1||t>V0)throw Error(Cy+"precision");for(n=Ty(new i(n),t,e);n.c.length<t;)n.c.push(0)}return Ay(n,t<=n.e||n.e<=i.NE||n.e>=i.PE,!!o)};qr.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(gE+"valueOf disallowed");return Ay(t,t.e<=e.NE||t.e>=e.PE,!0)};var nh=nW();const Q1={bigNumber(t,e={safe:!1}){try{return t?new nh(t):new nh(0)}catch(n){if(e.safe)return new nh(0);throw n}},formatNumber(t,e){const{decimals:n,round:i=8,safe:o=!0}=e;return Q1.bigNumber(t,{safe:o}).div(new nh(10).pow(n)).round(i)},multiply(t,e){if(t===void 0||e===void 0)return new nh(0);const n=new nh(t),i=new nh(e);return n.times(i)},toFixed(t,e=2){return t===void 0||t===""?new nh(0).toFixed(e):new nh(t).toFixed(e)},formatNumberToLocalString(t,e=2){return t===void 0||t===""?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"})},parseLocalStringToNumber(t){if(t===void 0||t==="")return 0;const e=t.replace(/,/gu,"");return new nh(e).toNumber()}},sse=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],ose=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],ase=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],cse={getERC20Abi:t=>at.USDT_CONTRACT_ADDRESSES.includes(t)?ase:sse,getSwapAbi:()=>ose},lse={URLS:{FAQ:"https://walletconnect.com/faq"}},Cc={ConnectorExplorerIds:{[at.CONNECTOR_ID.COINBASE]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[at.CONNECTOR_ID.COINBASE_SDK]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[at.CONNECTOR_ID.BASE_ACCOUNT]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[at.CONNECTOR_ID.SAFE]:"225affb176778569276e484e1b92637ad061b01e13a048b35a9d280c3b58970f",[at.CONNECTOR_ID.LEDGER]:"19177a98252e07ddfc9af2083ba8e07ef627cb6103467ffebb3f8f4205fd7927",[at.CONNECTOR_ID.OKX]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[at.METMASK_CONNECTOR_NAME]:"c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96",[at.TRUST_CONNECTOR_NAME]:"4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0",[at.SOLFLARE_CONNECTOR_NAME]:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",[at.PHANTOM_CONNECTOR_NAME]:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",[at.COIN98_CONNECTOR_NAME]:"2a3c89040ac3b723a1972a33a125b1db11e258a6975d3a61252cd64e6ea5ea01",[at.MAGIC_EDEN_CONNECTOR_NAME]:"8b830a2b724a9c3fbab63af6f55ed29c9dfa8a55e732dc88c80a196a2ba136c6",[at.BACKPACK_CONNECTOR_NAME]:"2bd8c14e035c2d48f184aaa168559e86b0e3433228d3c4075900a221785019b0",[at.BITGET_CONNECTOR_NAME]:"38f5d18bd8522c244bdd70cb4a68e0e718865155811c043f052fb9f1c51de662",[at.FRONTIER_CONNECTOR_NAME]:"85db431492aa2e8672e93f4ea7acf10c88b97b867b0d373107af63dc4880f041",[at.XVERSE_CONNECTOR_NAME]:"2a87d74ae02e10bdd1f51f7ce6c4e1cc53cd5f2c0b6b5ad0d7b3007d2b13de7b",[at.LEATHER_CONNECTOR_NAME]:"483afe1df1df63daf313109971ff3ef8356ddf1cc4e45877d205eee0b7893a13",[at.OKX_CONNECTOR_NAME]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[at.BINANCE_CONNECTOR_NAME]:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25"},ConnectorImageIds:{[at.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[at.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[at.CONNECTOR_ID.BASE_ACCOUNT]:"bba2c8be-7fd1-463e-42b1-796ecb0ad200",[at.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[at.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[at.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[at.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[at.CONNECTOR_ID.INJECTED]:"Browser Wallet",[at.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[at.CONNECTOR_ID.COINBASE]:"Coinbase",[at.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[at.CONNECTOR_ID.BASE_ACCOUNT]:"Base Account",[at.CONNECTOR_ID.LEDGER]:"Ledger",[at.CONNECTOR_ID.SAFE]:"Safe"},ConnectorTypesMap:{[at.CONNECTOR_ID.INJECTED]:"INJECTED",[at.CONNECTOR_ID.WALLET_CONNECT]:"WALLET_CONNECT",[at.CONNECTOR_ID.EIP6963]:"ANNOUNCED",[at.CONNECTOR_ID.AUTH]:"AUTH"}},No={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[n,i,o]=e;if(!n||!i||!o)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:n,chainId:i,address:o}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[n,i]=e;if(!n||!i)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:n,chainId:i}}},nl={RPC_ERROR_CODE:{USER_REJECTED_REQUEST:4001,USER_REJECTED_METHODS:5002,USER_REJECTED:5e3,SEND_TRANSACTION_ERROR:5001},PROVIDER_RPC_ERROR_NAME:{PROVIDER_RPC:"ProviderRpcError",USER_REJECTED_REQUEST:"UserRejectedRequestError",SEND_TRANSACTION_ERROR:"SendTransactionError"},isRpcProviderError(t){try{if(typeof t=="object"&&t!==null){const e=t,n=typeof e.message=="string",i=typeof e.code=="number";return n&&i}return!1}catch{return!1}},isUserRejectedMessage(t){return t.toLowerCase().includes("user rejected")||t.toLowerCase().includes("user cancelled")||t.toLowerCase().includes("user canceled")},isUserRejectedRequestError(t){if(nl.isRpcProviderError(t)){const e=t.code===nl.RPC_ERROR_CODE.USER_REJECTED_REQUEST,n=t.code===nl.RPC_ERROR_CODE.USER_REJECTED_METHODS;return e||n||nl.isUserRejectedMessage(t.message)}return t instanceof Error?nl.isUserRejectedMessage(t.message):!1}};let use=class extends Error{constructor(e,n){super(n.message,{cause:e}),this.name=nl.PROVIDER_RPC_ERROR_NAME.PROVIDER_RPC,this.code=n.code}},T1=class extends use{constructor(e){super(e,{code:nl.RPC_ERROR_CODE.USER_REJECTED_REQUEST,message:"User rejected the request"}),this.name=nl.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST}};const ri={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",RECENT_WALLET:"@appkit/recent_wallet",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections",DISCONNECTED_CONNECTOR_IDS:"@appkit/disconnected_connector_ids",HISTORY_TRANSACTIONS_CACHE:"@appkit/history_transactions_cache",TOKEN_PRICE_CACHE:"@appkit/token_price_cache",RECENT_EMAILS:"@appkit/recent_emails",LATEST_APPKIT_VERSION:"@appkit/latest_version",TON_WALLETS_CACHE:"@appkit/ton_wallets_cache"};function $4(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const ei={setItem(t,e){Ox()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(Ox())return localStorage.getItem(t)||void 0},removeItem(t){Ox()&&localStorage.removeItem(t)},clear(){Ox()&&localStorage.clear()}};function Ox(){return typeof window<"u"&&typeof localStorage<"u"}function r2(t,e){const n=(t==null?void 0:t["--apkt-accent"])??(t==null?void 0:t["--w3m-accent"]);return e==="light"?{"--w3m-accent":n||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":n||"hsla(230, 100%, 67%, 1)","--w3m-background":"#202020"}}var wF={};const z4=(typeof process<"u"&&typeof wF<"u"?wF.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",iW=[{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],dse="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",hi={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:z4,SECURE_SITE_DASHBOARD:`${z4}/dashboard`,SECURE_SITE_FAVICON:`${z4}/images/favicon.png`,SOLANA_NATIVE_TOKEN_ADDRESS:"So11111111111111111111111111111111111111111",RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],SUGGESTED_TOKENS_BY_CHAIN:{"eip155:42161":["USD0"]},BALANCE_SUPPORTED_CHAINS:[at.CHAIN.EVM,at.CHAIN.SOLANA],SEND_PARAMS_SUPPORTED_CHAINS:[at.CHAIN.EVM],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:[at.CHAIN.EVM],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:[at.CHAIN.EVM,at.CHAIN.SOLANA],PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES:[at.CHAIN.EVM,at.CHAIN.SOLANA],ACTIVITY_ENABLED_CHAIN_NAMESPACES:[at.CHAIN.EVM,at.CHAIN.TON],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x",sui:"0x",stacks:"0x",ton:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app",WEB:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:[at.CHAIN.EVM,at.CHAIN.SOLANA],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0,multiWallet:!1,emailCapture:!1,payWithExchange:!1,payments:!1,reownAuthentication:!1,headless:!1},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1,emailCapture:!1,reownAuthentication:!1,headless:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1,reownAuthentication:!1,headless:!1},DEFAULT_SOCIALS:["google","x","farcaster","discord","apple","github","facebook"],DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa",ton:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"},SIWX_DEFAULTS:{signOutOnDisconnect:!0},MANDATORY_WALLET_IDS_ON_MOBILE:[Cc.ConnectorExplorerIds[at.CONNECTOR_ID.COINBASE],Cc.ConnectorExplorerIds[at.CONNECTOR_ID.COINBASE_SDK],Cc.ConnectorExplorerIds[at.CONNECTOR_ID.BASE_ACCOUNT],Cc.ConnectorExplorerIds[at.SOLFLARE_CONNECTOR_NAME],Cc.ConnectorExplorerIds[at.PHANTOM_CONNECTOR_NAME],Cc.ConnectorExplorerIds[at.BINANCE_CONNECTOR_NAME]],DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"]},Jt={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5,transactionsHistory:15e3,tokenPrice:15e3,latestAppKitVersion:6048e5,tonWallets:864e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=Jt.getActiveNamespace(),e=Jt.getActiveCaipNetworkId(),n=e?e.split(":")[1]:void 0,i=n?isNaN(Number(n))?n:Number(n):void 0;return{namespace:t,caipNetworkId:e,chainId:i}},setWalletConnectDeepLink({name:t,href:e}){try{ei.setItem(ri.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=ei.getItem(ri.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{ei.removeItem(ri.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{ei.setItem(ri.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{ei.setItem(ri.ACTIVE_CAIP_NETWORK_ID,t),Jt.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return ei.getItem(ri.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{ei.removeItem(ri.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=$4(t);ei.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=Jt.getRecentWallets();e.find(i=>i.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),ei.setItem(ri.RECENT_WALLETS,JSON.stringify(e)),ei.setItem(ri.RECENT_WALLET,JSON.stringify(t)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=ei.getItem(ri.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},getRecentWallet(){try{const t=ei.getItem(ri.RECENT_WALLET);return t?JSON.parse(t):null}catch{console.info("Unable to get AppKit recent")}return null},deleteRecentWallet(){try{ei.removeItem(ri.RECENT_WALLET)}catch{console.info("Unable to delete AppKit recent")}},setConnectedConnectorId(t,e){try{const n=$4(t);ei.setItem(n,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return ei.getItem(ri.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=$4(t);return ei.getItem(e)}catch{console.info("Unable to get connected connector id in namespace",t)}},setConnectedSocialProvider(t){try{ei.setItem(ri.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return ei.getItem(ri.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{ei.removeItem(ri.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return ei.getItem(ri.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var n;const t=ei.getItem(ri.ACTIVE_CAIP_NETWORK_ID);return(n=t==null?void 0:t.split(":"))==null?void 0:n[1]},setConnectionStatus(t){try{ei.setItem(ri.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return ei.getItem(ri.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=ei.getItem(ri.CONNECTED_NAMESPACES);return t!=null&&t.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));ei.setItem(ri.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=Jt.getConnectedNamespaces();e.includes(t)||(e.push(t),Jt.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=Jt.getConnectedNamespaces(),n=e.indexOf(t);n>-1&&(e.splice(n,1),Jt.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return ei.getItem(ri.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{ei.setItem(ri.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{ei.removeItem(ri.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=ei.getItem(ri.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=Jt.getBalanceCache();ei.setItem(ri.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const n=Jt.getBalanceCache()[t];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.portfolio))return n.balance;Jt.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=Jt.getBalanceCache();e[t.caipAddress]=t,ei.setItem(ri.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=ei.getItem(ri.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=Jt.getBalanceCache();ei.setItem(ri.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const n=Jt.getNativeBalanceCache()[t];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.nativeBalance))return n;console.info("Discarding cache for address",t),Jt.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=Jt.getNativeBalanceCache();e[t.caipAddress]=t,ei.setItem(ri.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=ei.getItem(ri.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const n=Jt.getEnsCache()[t];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.ens))return n.ens;Jt.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=Jt.getEnsCache();e[t.address]=t,ei.setItem(ri.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=Jt.getEnsCache();ei.setItem(ri.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=ei.getItem(ri.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const n=Jt.getIdentityCache()[t];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.identity))return n.identity;Jt.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=Jt.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},ei.setItem(ri.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=Jt.getIdentityCache();ei.setItem(ri.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},getTonWalletsCache(){try{const t=ei.getItem(ri.TON_WALLETS_CACHE),e=t?JSON.parse(t):void 0;if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.tonWallets))return e;Jt.removeTonWalletsCache()}catch{console.info("Unable to get ton wallets cache")}},updateTonWalletsCache(t){try{const e=Jt.getTonWalletsCache()||{timestamp:0,wallets:[]};e.timestamp=new Date().getTime(),e.wallets=t,ei.setItem(ri.TON_WALLETS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ton wallets cache",t)}},removeTonWalletsCache(){try{ei.removeItem(ri.TON_WALLETS_CACHE)}catch{console.info("Unable to remove ton wallets cache")}},clearAddressCache(){try{ei.removeItem(ri.PORTFOLIO_CACHE),ei.removeItem(ri.NATIVE_BALANCE_CACHE),ei.removeItem(ri.ENS_CACHE),ei.removeItem(ri.IDENTITY_CACHE),ei.removeItem(ri.HISTORY_TRANSACTIONS_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{ei.setItem(ri.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=ei.getItem(ri.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){try{const n=Jt.getConnections(),i=n[e]??[],o=new Map;for(const h of i)o.set(h.connectorId,{...h});for(const h of t){const s=o.get(h.connectorId),w=h.connectorId===at.CONNECTOR_ID.AUTH;if(s&&!w){const x=new Set(s.accounts.map(P=>P.address.toLowerCase())),A=h.accounts.filter(P=>!x.has(P.address.toLowerCase()));s.accounts.push(...A)}else o.set(h.connectorId,{...h})}const l={...n,[e]:Array.from(o.values())};ei.setItem(ri.CONNECTIONS,JSON.stringify(l))}catch(n){console.error("Unable to sync connections to storage",n)}},getConnections(){try{const t=ei.getItem(ri.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}},deleteAddressFromConnection({connectorId:t,address:e,namespace:n}){try{const i=Jt.getConnections(),o=i[n]??[],l=new Map(o.map(s=>[s.connectorId,s])),h=l.get(t);h&&(h.accounts.filter(w=>w.address.toLowerCase()!==e.toLowerCase()).length===0?l.delete(t):l.set(t,{...h,accounts:h.accounts.filter(w=>w.address.toLowerCase()!==e.toLowerCase())})),ei.setItem(ri.CONNECTIONS,JSON.stringify({...i,[n]:Array.from(l.values())}))}catch{console.error(`Unable to remove address "${e}" from connector "${t}" in namespace "${n}"`)}},getDisconnectedConnectorIds(){try{const t=ei.getItem(ri.DISCONNECTED_CONNECTOR_IDS);return t?JSON.parse(t):{}}catch{console.info("Unable to get disconnected connector ids")}return{}},addDisconnectedConnectorId(t,e){try{const n=Jt.getDisconnectedConnectorIds(),i=n[e]??[];i.push(t),ei.setItem(ri.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...n,[e]:Array.from(new Set(i))}))}catch{console.error(`Unable to set disconnected connector id "${t}" for namespace "${e}"`)}},removeDisconnectedConnectorId(t,e){try{const n=Jt.getDisconnectedConnectorIds();let i=n[e]??[];i=i.filter(o=>o.toLowerCase()!==t.toLowerCase()),ei.setItem(ri.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...n,[e]:Array.from(new Set(i))}))}catch{console.error(`Unable to remove disconnected connector id "${t}" for namespace "${e}"`)}},isConnectorDisconnected(t,e){try{return(Jt.getDisconnectedConnectorIds()[e]??[]).some(o=>o.toLowerCase()===t.toLowerCase())}catch{console.info(`Unable to get disconnected connector id "${t}" for namespace "${e}"`)}return!1},getTransactionsCache(){try{const t=ei.getItem(ri.HISTORY_TRANSACTIONS_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get transactions cache")}return{}},getTransactionsCacheForAddress({address:t,chainId:e=""}){var n;try{const o=(n=Jt.getTransactionsCache()[t])==null?void 0:n[e];if(o&&!this.isCacheExpired(o.timestamp,this.cacheExpiry.transactionsHistory))return o.transactions;Jt.removeTransactionsCache({address:t,chainId:e})}catch{console.info("Unable to get transactions cache")}},updateTransactionsCache({address:t,chainId:e="",timestamp:n,transactions:i}){try{const o=Jt.getTransactionsCache();o[t]={...o[t],[e]:{timestamp:n,transactions:i}},ei.setItem(ri.HISTORY_TRANSACTIONS_CACHE,JSON.stringify(o))}catch{console.info("Unable to update transactions cache",{address:t,chainId:e,timestamp:n,transactions:i})}},removeTransactionsCache({address:t,chainId:e}){try{const n=Jt.getTransactionsCache(),i=(n==null?void 0:n[t])||{},{[e]:o,...l}=i;ei.setItem(ri.HISTORY_TRANSACTIONS_CACHE,JSON.stringify({...n,[t]:l}))}catch{console.info("Unable to remove transactions cache",{address:t,chainId:e})}},getTokenPriceCache(){try{const t=ei.getItem(ri.TOKEN_PRICE_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get token price cache")}return{}},getTokenPriceCacheForAddresses(t){try{const n=Jt.getTokenPriceCache()[t.join(",")];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.tokenPrice))return n.tokenPrice;Jt.removeTokenPriceCache(t)}catch{console.info("Unable to get token price cache for addresses",t)}},updateTokenPriceCache(t){try{const e=Jt.getTokenPriceCache();e[t.addresses.join(",")]={timestamp:t.timestamp,tokenPrice:t.tokenPrice},ei.setItem(ri.TOKEN_PRICE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update token price cache",t)}},removeTokenPriceCache(t){try{const e=Jt.getTokenPriceCache();ei.setItem(ri.TOKEN_PRICE_CACHE,JSON.stringify({...e,[t.join(",")]:void 0}))}catch{console.info("Unable to remove token price cache",t)}},getLatestAppKitVersion(){try{const t=this.getLatestAppKitVersionCache(),e=t==null?void 0:t.version;return e&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.latestAppKitVersion)?e:void 0}catch{console.info("Unable to get latest AppKit version")}},getLatestAppKitVersionCache(){try{const t=ei.getItem(ri.LATEST_APPKIT_VERSION);return t?JSON.parse(t):{}}catch{console.info("Unable to get latest AppKit version cache")}return{}},updateLatestAppKitVersion(t){try{const e=Jt.getLatestAppKitVersionCache();e.timestamp=t.timestamp,e.version=t.version,ei.setItem(ri.LATEST_APPKIT_VERSION,JSON.stringify(e))}catch{console.info("Unable to update latest AppKit version on local storage",t)}}},Ft={getWindow(){if(!(typeof window>"u"))return window},isMobile(){var t;return this.isClient()?!!(window!=null&&window.matchMedia&&typeof window.matchMedia=="function"&&((t=window.matchMedia("(pointer:coarse)"))!=null&&t.matches)||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t==null?void 0:t.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return Ft.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=hi.TEN_SEC_MS:!0},isAllowedRetry(t,e=hi.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},isSafeApp(){var t,e;if(Ft.isClient()&&window.self!==window.top)try{const n=(e=(t=window==null?void 0:window.location)==null?void 0:t.ancestorOrigins)==null?void 0:e[0],i="https://app.safe.global";if(n){const o=new URL(n),l=new URL(i);return o.hostname===l.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+hi.FOUR_MINUTES_MS},getNetworkId(t){return t==null?void 0:t.split(":")[1]},getPlainAddress(t){return t==null?void 0:t.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let n;return(...i)=>{function o(){t(...i)}n&&clearTimeout(n),n=setTimeout(o,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,n=null){if(Ft.isHttpUrl(t))return this.formatUniversalUrl(t,e);let i=t,o=n;i.includes("://")||(i=t.replaceAll("/","").replaceAll(":",""),i=`${i}://`),i.endsWith("/")||(i=`${i}/`),o&&!(o!=null&&o.endsWith("/"))&&(o=`${o}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const l=encodeURIComponent(e);return{redirect:`${i}wc?uri=${l}`,redirectUniversalLink:o?`${o}wc?uri=${l}`:void 0,href:i}},formatUniversalUrl(t,e){if(!Ft.isHttpUrl(t))return this.formatNativeUrl(t,e);let n=t;n.endsWith("/")||(n=`${n}/`);const i=encodeURIComponent(e);return{redirect:`${n}wc?uri=${i}`,href:n}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?Jt.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,n){window==null||window.open(t,this.getOpenTargetForPlatform(e),n||"noreferrer noopener")},returnOpenHref(t,e,n){return window==null?void 0:window.open(t,this.getOpenTargetForPlatform(e),n||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){var n,i;if(typeof window>"u")return!1;const t=window!=null&&window.matchMedia&&typeof window.matchMedia=="function"?(n=window.matchMedia("(display-mode: standalone)"))==null?void 0:n.matches:!1,e=(i=window==null?void 0:window.navigator)==null?void 0:i.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((n,i)=>{const o=new Image;o.onload=n,o.onerror=i,o.crossOrigin="anonymous",o.src=t});return Promise.race([e,Ft.wait(2e3)])},parseBalance(t,e){let n="0.000";if(typeof t=="string"){const w=Number(t);if(!isNaN(w)){const x=(Math.floor(w*1e3)/1e3).toFixed(3);x&&(n=x)}}const[i,o]=n.split("."),l=i||"0",h=o||"000";return{formattedText:`${l}.${h}${e?` ${e}`:""}`,value:l,decimals:h,symbol:e}},getApiUrl(){return at.W3M_API_URL},getBlockchainApiUrl(){return at.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return at.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){var e,n;return typeof t=="string"?t:typeof((n=(e=t==null?void 0:t.issues)==null?void 0:e[0])==null?void 0:n.message)=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const n={};return e&&t&&(t.forEach((i,o)=>{n[i]=o}),e.sort((i,o)=>{const l=n[i.id],h=n[o.id];return l!==void 0&&h!==void 0?l-h:l!==void 0?-1:h!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const n of t)e+=n.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[n,i]=e.split(".");return{dollars:n,pennies:i}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);case"bip122":{const n=/^[1][a-km-zA-HJ-NP-Z1-9]{25,34}$/u.test(t),i=/^[3][a-km-zA-HJ-NP-Z1-9]{25,34}$/u.test(t),o=/^bc1[a-z0-9]{39,87}$/u.test(t),l=/^bc1p[a-z0-9]{58}$/u.test(t);return n||i||o||l}default:return!1}},uniqueBy(t,e){const n=new Set;return t.filter(i=>{const o=i[e];return n.has(o)?!1:(n.add(o),!0)})},generateSdkVersion(t,e,n){const o=t.length===0?hi.ADAPTER_TYPES.UNIVERSAL:t.map(l=>l.adapterType).join(",");return`${e}-${o}-${n}`},createAccount(t,e,n,i,o){return{namespace:t,address:e,type:n,publicKey:i,path:o}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),n=e[0];return e.filter(Boolean).length===3&&n in at.CHAIN_NAME_MAP},getAccount(t){return t?typeof t=="string"?{address:t,chainId:void 0}:{address:t.address,chainId:t.chainId}:{address:void 0,chainId:void 0}},isMac(){const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,n="state=";if(new URL(t).host==="auth.magic.link"){const o="provider_authorization_url=",l=t.substring(t.indexOf(o)+o.length),h=this.injectIntoUrl(decodeURIComponent(l),n,e);return t.replace(l,encodeURIComponent(h))}return this.injectIntoUrl(t,n,e)},injectIntoUrl(t,e,n){const i=t.indexOf(e);if(i===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const o=t.indexOf("&",i),l=e.length,h=o!==-1?o:t.length,s=t.substring(0,i+l),w=t.substring(i+l,h),x=t.substring(o),A=w+n;return s+A+x},isNumber(t){return typeof t!="number"&&typeof t!="string"?!1:!isNaN(Number(t))},appendPayToUri(t,e){return e?`${t}&pay=${encodeURIComponent(e)}`:t}},rW={BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org"},hse={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[n,i,o]=e;if(!n||!i||!o)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:n,chainId:i,address:o}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[n,i]=e;if(!n||!i)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:n,chainId:i}}};var ew={};const fse="https://secure.walletconnect.org/sdk",pse=(typeof process<"u"&&typeof ew<"u"?ew.NEXT_PUBLIC_SECURE_SITE_SDK_URL:void 0)||fse,mse=(typeof process<"u"&&typeof ew<"u"?ew.NEXT_PUBLIC_DEFAULT_LOG_LEVEL:void 0)||"error",gse=(typeof process<"u"&&typeof ew<"u"?ew.NEXT_PUBLIC_SECURE_SITE_SDK_VERSION:void 0)||"4",Kn={APP_EVENT_KEY:"@w3m-app/",FRAME_EVENT_KEY:"@w3m-frame/",RPC_METHOD_KEY:"RPC_",STORAGE_KEY:"@appkit-wallet/",SESSION_TOKEN_KEY:"SESSION_TOKEN_KEY",EMAIL_LOGIN_USED_KEY:"EMAIL_LOGIN_USED_KEY",LAST_USED_CHAIN_KEY:"LAST_USED_CHAIN_KEY",LAST_EMAIL_LOGIN_TIME:"LAST_EMAIL_LOGIN_TIME",EMAIL:"EMAIL",PREFERRED_ACCOUNT_TYPE:"PREFERRED_ACCOUNT_TYPE",SMART_ACCOUNT_ENABLED:"SMART_ACCOUNT_ENABLED",SMART_ACCOUNT_ENABLED_NETWORKS:"SMART_ACCOUNT_ENABLED_NETWORKS",SOCIAL_USERNAME:"SOCIAL_USERNAME",APP_SWITCH_NETWORK:"@w3m-app/SWITCH_NETWORK",APP_CONNECT_EMAIL:"@w3m-app/CONNECT_EMAIL",APP_CONNECT_DEVICE:"@w3m-app/CONNECT_DEVICE",APP_CONNECT_OTP:"@w3m-app/CONNECT_OTP",APP_CONNECT_SOCIAL:"@w3m-app/CONNECT_SOCIAL",APP_GET_SOCIAL_REDIRECT_URI:"@w3m-app/GET_SOCIAL_REDIRECT_URI",APP_GET_USER:"@w3m-app/GET_USER",APP_SIGN_OUT:"@w3m-app/SIGN_OUT",APP_IS_CONNECTED:"@w3m-app/IS_CONNECTED",APP_GET_CHAIN_ID:"@w3m-app/GET_CHAIN_ID",APP_RPC_REQUEST:"@w3m-app/RPC_REQUEST",APP_UPDATE_EMAIL:"@w3m-app/UPDATE_EMAIL",APP_UPDATE_EMAIL_PRIMARY_OTP:"@w3m-app/UPDATE_EMAIL_PRIMARY_OTP",APP_UPDATE_EMAIL_SECONDARY_OTP:"@w3m-app/UPDATE_EMAIL_SECONDARY_OTP",APP_AWAIT_UPDATE_EMAIL:"@w3m-app/AWAIT_UPDATE_EMAIL",APP_SYNC_THEME:"@w3m-app/SYNC_THEME",APP_SYNC_DAPP_DATA:"@w3m-app/SYNC_DAPP_DATA",APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS:"@w3m-app/GET_SMART_ACCOUNT_ENABLED_NETWORKS",APP_INIT_SMART_ACCOUNT:"@w3m-app/INIT_SMART_ACCOUNT",APP_SET_PREFERRED_ACCOUNT:"@w3m-app/SET_PREFERRED_ACCOUNT",APP_CONNECT_FARCASTER:"@w3m-app/CONNECT_FARCASTER",APP_GET_FARCASTER_URI:"@w3m-app/GET_FARCASTER_URI",APP_RELOAD:"@w3m-app/RELOAD",APP_RPC_ABORT:"@w3m-app/RPC_ABORT",FRAME_SWITCH_NETWORK_ERROR:"@w3m-frame/SWITCH_NETWORK_ERROR",FRAME_SWITCH_NETWORK_SUCCESS:"@w3m-frame/SWITCH_NETWORK_SUCCESS",FRAME_CONNECT_EMAIL_ERROR:"@w3m-frame/CONNECT_EMAIL_ERROR",FRAME_CONNECT_EMAIL_SUCCESS:"@w3m-frame/CONNECT_EMAIL_SUCCESS",FRAME_CONNECT_DEVICE_ERROR:"@w3m-frame/CONNECT_DEVICE_ERROR",FRAME_CONNECT_DEVICE_SUCCESS:"@w3m-frame/CONNECT_DEVICE_SUCCESS",FRAME_CONNECT_OTP_SUCCESS:"@w3m-frame/CONNECT_OTP_SUCCESS",FRAME_CONNECT_OTP_ERROR:"@w3m-frame/CONNECT_OTP_ERROR",FRAME_CONNECT_SOCIAL_SUCCESS:"@w3m-frame/CONNECT_SOCIAL_SUCCESS",FRAME_CONNECT_SOCIAL_ERROR:"@w3m-frame/CONNECT_SOCIAL_ERROR",FRAME_CONNECT_FARCASTER_SUCCESS:"@w3m-frame/CONNECT_FARCASTER_SUCCESS",FRAME_CONNECT_FARCASTER_ERROR:"@w3m-frame/CONNECT_FARCASTER_ERROR",FRAME_GET_FARCASTER_URI_SUCCESS:"@w3m-frame/GET_FARCASTER_URI_SUCCESS",FRAME_GET_FARCASTER_URI_ERROR:"@w3m-frame/GET_FARCASTER_URI_ERROR",FRAME_GET_SOCIAL_REDIRECT_URI_SUCCESS:"@w3m-frame/GET_SOCIAL_REDIRECT_URI_SUCCESS",FRAME_GET_SOCIAL_REDIRECT_URI_ERROR:"@w3m-frame/GET_SOCIAL_REDIRECT_URI_ERROR",FRAME_GET_USER_SUCCESS:"@w3m-frame/GET_USER_SUCCESS",FRAME_GET_USER_ERROR:"@w3m-frame/GET_USER_ERROR",FRAME_SIGN_OUT_SUCCESS:"@w3m-frame/SIGN_OUT_SUCCESS",FRAME_SIGN_OUT_ERROR:"@w3m-frame/SIGN_OUT_ERROR",FRAME_IS_CONNECTED_SUCCESS:"@w3m-frame/IS_CONNECTED_SUCCESS",FRAME_IS_CONNECTED_ERROR:"@w3m-frame/IS_CONNECTED_ERROR",FRAME_GET_CHAIN_ID_SUCCESS:"@w3m-frame/GET_CHAIN_ID_SUCCESS",FRAME_GET_CHAIN_ID_ERROR:"@w3m-frame/GET_CHAIN_ID_ERROR",FRAME_RPC_REQUEST_SUCCESS:"@w3m-frame/RPC_REQUEST_SUCCESS",FRAME_RPC_REQUEST_ERROR:"@w3m-frame/RPC_REQUEST_ERROR",FRAME_SESSION_UPDATE:"@w3m-frame/SESSION_UPDATE",FRAME_UPDATE_EMAIL_SUCCESS:"@w3m-frame/UPDATE_EMAIL_SUCCESS",FRAME_UPDATE_EMAIL_ERROR:"@w3m-frame/UPDATE_EMAIL_ERROR",FRAME_UPDATE_EMAIL_PRIMARY_OTP_SUCCESS:"@w3m-frame/UPDATE_EMAIL_PRIMARY_OTP_SUCCESS",FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR:"@w3m-frame/UPDATE_EMAIL_PRIMARY_OTP_ERROR",FRAME_UPDATE_EMAIL_SECONDARY_OTP_SUCCESS:"@w3m-frame/UPDATE_EMAIL_SECONDARY_OTP_SUCCESS",FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR:"@w3m-frame/UPDATE_EMAIL_SECONDARY_OTP_ERROR",FRAME_SYNC_THEME_SUCCESS:"@w3m-frame/SYNC_THEME_SUCCESS",FRAME_SYNC_THEME_ERROR:"@w3m-frame/SYNC_THEME_ERROR",FRAME_SYNC_DAPP_DATA_SUCCESS:"@w3m-frame/SYNC_DAPP_DATA_SUCCESS",FRAME_SYNC_DAPP_DATA_ERROR:"@w3m-frame/SYNC_DAPP_DATA_ERROR",FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS:"@w3m-frame/GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS",FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR:"@w3m-frame/GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR",FRAME_INIT_SMART_ACCOUNT_SUCCESS:"@w3m-frame/INIT_SMART_ACCOUNT_SUCCESS",FRAME_INIT_SMART_ACCOUNT_ERROR:"@w3m-frame/INIT_SMART_ACCOUNT_ERROR",FRAME_SET_PREFERRED_ACCOUNT_SUCCESS:"@w3m-frame/SET_PREFERRED_ACCOUNT_SUCCESS",FRAME_SET_PREFERRED_ACCOUNT_ERROR:"@w3m-frame/SET_PREFERRED_ACCOUNT_ERROR",FRAME_READY:"@w3m-frame/READY",FRAME_RELOAD_SUCCESS:"@w3m-frame/RELOAD_SUCCESS",FRAME_RELOAD_ERROR:"@w3m-frame/RELOAD_ERROR",FRAME_RPC_ABORT_SUCCESS:"@w3m-frame/RPC_ABORT_SUCCESS",FRAME_RPC_ABORT_ERROR:"@w3m-frame/RPC_ABORT_ERROR",RPC_RESPONSE_TYPE_ERROR:"RPC_RESPONSE_ERROR",RPC_RESPONSE_TYPE_TX:"RPC_RESPONSE_TRANSACTION_HASH",RPC_RESPONSE_TYPE_OBJECT:"RPC_RESPONSE_OBJECT"},Gr={SAFE_RPC_METHODS:["eth_accounts","eth_blockNumber","eth_call","eth_chainId","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getAccount","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockReceipts","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_maxPriorityFeePerGas","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_sendRawTransaction","eth_syncing","eth_uninstallFilter","wallet_getCapabilities","wallet_getCallsStatus","eth_getUserOperationReceipt","eth_estimateUserOperationGas","eth_getUserOperationByHash","eth_supportedEntryPoints","wallet_getAssets"],NOT_SAFE_RPC_METHODS:["personal_sign","eth_signTypedData_v4","eth_sendTransaction","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction","wallet_sendCalls","wallet_grantPermissions","wallet_revokePermissions","eth_sendUserOperation"],GET_CHAIN_ID:"eth_chainId",RPC_METHOD_NOT_ALLOWED_MESSAGE:"Requested RPC call is not allowed",RPC_METHOD_NOT_ALLOWED_UI_MESSAGE:"Action not allowed",ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},bF={transactionHash:/^0x(?:[A-Fa-f0-9]{64})$/u,signedMessage:/^0x(?:[a-fA-F0-9]{62,})$/u},Ro={set(t,e){Ll.isClient&&localStorage.setItem(`${Kn.STORAGE_KEY}${t}`,e)},get(t){return Ll.isClient?localStorage.getItem(`${Kn.STORAGE_KEY}${t}`):null},delete(t,e){Ll.isClient&&(e?localStorage.removeItem(t):localStorage.removeItem(`${Kn.STORAGE_KEY}${t}`))}},F5=30*1e3,Ll={checkIfAllowedToTriggerEmail(){const t=Ro.get(Kn.LAST_EMAIL_LOGIN_TIME);if(t){const e=Date.now()-Number(t);if(e<F5){const n=Math.ceil((F5-e)/1e3);throw new Error(`Please try again after ${n} seconds`)}}},getTimeToNextEmailLogin(){const t=Ro.get(Kn.LAST_EMAIL_LOGIN_TIME);if(t){const e=Date.now()-Number(t);if(e<F5)return Math.ceil((F5-e)/1e3)}return 0},checkIfRequestExists(t){return Gr.NOT_SAFE_RPC_METHODS.includes(t.method)||Gr.SAFE_RPC_METHODS.includes(t.method)},getResponseType(t){return typeof t=="string"&&((t==null?void 0:t.match(bF.transactionHash))||(t==null?void 0:t.match(bF.signedMessage)))?Kn.RPC_RESPONSE_TYPE_TX:Kn.RPC_RESPONSE_TYPE_OBJECT},checkIfRequestIsSafe(t){return Gr.SAFE_RPC_METHODS.includes(t.method)},isClient:typeof window<"u"};var Dr;(function(t){t.assertEqual=o=>o;function e(o){}t.assertIs=e;function n(o){throw new Error}t.assertNever=n,t.arrayToEnum=o=>{const l={};for(const h of o)l[h]=h;return l},t.getValidEnumValues=o=>{const l=t.objectKeys(o).filter(s=>typeof o[o[s]]!="number"),h={};for(const s of l)h[s]=o[s];return t.objectValues(h)},t.objectValues=o=>t.objectKeys(o).map(function(l){return o[l]}),t.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const l=[];for(const h in o)Object.prototype.hasOwnProperty.call(o,h)&&l.push(h);return l},t.find=(o,l)=>{for(const h of o)if(l(h))return h},t.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&isFinite(o)&&Math.floor(o)===o;function i(o,l=" | "){return o.map(h=>typeof h=="string"?`'${h}'`:h).join(l)}t.joinValues=i,t.jsonStringifyReplacer=(o,l)=>typeof l=="bigint"?l.toString():l})(Dr||(Dr={}));var qR;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(qR||(qR={}));const Wn=Dr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),hm=t=>{switch(typeof t){case"undefined":return Wn.undefined;case"string":return Wn.string;case"number":return isNaN(t)?Wn.nan:Wn.number;case"boolean":return Wn.boolean;case"function":return Wn.function;case"bigint":return Wn.bigint;case"symbol":return Wn.symbol;case"object":return Array.isArray(t)?Wn.array:t===null?Wn.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?Wn.promise:typeof Map<"u"&&t instanceof Map?Wn.map:typeof Set<"u"&&t instanceof Set?Wn.set:typeof Date<"u"&&t instanceof Date?Wn.date:Wn.object;default:return Wn.unknown}},wn=Dr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),yse=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class pd extends Error{constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const n=e||function(l){return l.message},i={_errors:[]},o=l=>{for(const h of l.issues)if(h.code==="invalid_union")h.unionErrors.map(o);else if(h.code==="invalid_return_type")o(h.returnTypeError);else if(h.code==="invalid_arguments")o(h.argumentsError);else if(h.path.length===0)i._errors.push(n(h));else{let s=i,w=0;for(;w<h.path.length;){const x=h.path[w];w===h.path.length-1?(s[x]=s[x]||{_errors:[]},s[x]._errors.push(n(h))):s[x]=s[x]||{_errors:[]},s=s[x],w++}}};return o(this),i}toString(){return this.message}get message(){return JSON.stringify(this.issues,Dr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},i=[];for(const o of this.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(e(o))):i.push(e(o));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}}pd.create=t=>new pd(t);const s2=(t,e)=>{let n;switch(t.code){case wn.invalid_type:t.received===Wn.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case wn.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Dr.jsonStringifyReplacer)}`;break;case wn.unrecognized_keys:n=`Unrecognized key(s) in object: ${Dr.joinValues(t.keys,", ")}`;break;case wn.invalid_union:n="Invalid input";break;case wn.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Dr.joinValues(t.options)}`;break;case wn.invalid_enum_value:n=`Invalid enum value. Expected ${Dr.joinValues(t.options)}, received '${t.received}'`;break;case wn.invalid_arguments:n="Invalid function arguments";break;case wn.invalid_return_type:n="Invalid function return type";break;case wn.invalid_date:n="Invalid date";break;case wn.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Dr.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case wn.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case wn.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case wn.custom:n="Invalid input";break;case wn.invalid_intersection_types:n="Intersection results could not be merged";break;case wn.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case wn.not_finite:n="Number must be finite";break;default:n=e.defaultError,Dr.assertNever(t)}return{message:n}};let sW=s2;function _se(t){sW=t}function sA(){return sW}const oA=t=>{const{data:e,path:n,errorMaps:i,issueData:o}=t,l=[...n,...o.path||[]],h={...o,path:l};let s="";const w=i.filter(x=>!!x).slice().reverse();for(const x of w)s=x(h,{data:e,defaultError:s}).message;return{...o,path:l,message:o.message||s}},wse=[];function Zn(t,e){const n=oA({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,sA(),s2].filter(i=>!!i)});t.common.issues.push(n)}class Qa{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const i=[];for(const o of n){if(o.status==="aborted")return Vi;o.status==="dirty"&&e.dirty(),i.push(o.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,n){const i=[];for(const o of n)i.push({key:await o.key,value:await o.value});return Qa.mergeObjectSync(e,i)}static mergeObjectSync(e,n){const i={};for(const o of n){const{key:l,value:h}=o;if(l.status==="aborted"||h.status==="aborted")return Vi;l.status==="dirty"&&e.dirty(),h.status==="dirty"&&e.dirty(),l.value!=="__proto__"&&(typeof h.value<"u"||o.alwaysSet)&&(i[l.value]=h.value)}return{status:e.value,value:i}}}const Vi=Object.freeze({status:"aborted"}),oW=t=>({status:"dirty",value:t}),Oc=t=>({status:"valid",value:t}),ZR=t=>t.status==="aborted",KR=t=>t.status==="dirty",o2=t=>t.status==="valid",aA=t=>typeof Promise<"u"&&t instanceof Promise;var xi;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(xi||(xi={}));class Eh{constructor(e,n,i,o){this._cachedPath=[],this.parent=e,this.data=n,this._path=i,this._key=o}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const vF=(t,e)=>{if(o2(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new pd(t.common.issues);return this._error=n,this._error}}};function qi(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:i,description:o}=t;if(e&&(n||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:o}:{errorMap:(h,s)=>h.code!=="invalid_type"?{message:s.defaultError}:typeof s.data>"u"?{message:i??s.defaultError}:{message:n??s.defaultError},description:o}}class Qi{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return hm(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:hm(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Qa,ctx:{common:e.parent.common,data:e.data,parsedType:hm(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(aA(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const i=this.safeParse(e,n);if(i.success)return i.data;throw i.error}safeParse(e,n){var i;const o={common:{issues:[],async:(i=n==null?void 0:n.async)!==null&&i!==void 0?i:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:hm(e)},l=this._parseSync({data:e,path:o.path,parent:o});return vF(o,l)}async parseAsync(e,n){const i=await this.safeParseAsync(e,n);if(i.success)return i.data;throw i.error}async safeParseAsync(e,n){const i={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:hm(e)},o=this._parse({data:e,path:i.path,parent:i}),l=await(aA(o)?o:Promise.resolve(o));return vF(i,l)}refine(e,n){const i=o=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(o):n;return this._refinement((o,l)=>{const h=e(o),s=()=>l.addIssue({code:wn.custom,...i(o)});return typeof Promise<"u"&&h instanceof Promise?h.then(w=>w?!0:(s(),!1)):h?!0:(s(),!1)})}refinement(e,n){return this._refinement((i,o)=>e(i)?!0:(o.addIssue(typeof n=="function"?n(i,o):n),!1))}_refinement(e){return new wd({schema:this,typeName:ki.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Lf.create(this,this._def)}nullable(){return G0.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return md.create(this,this._def)}promise(){return nw.create(this,this._def)}or(e){return u2.create([this,e],this._def)}and(e){return d2.create(this,e,this._def)}transform(e){return new wd({...qi(this._def),schema:this,typeName:ki.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new g2({...qi(this._def),innerType:this,defaultValue:n,typeName:ki.ZodDefault})}brand(){return new cW({typeName:ki.ZodBranded,type:this,...qi(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new dA({...qi(this._def),innerType:this,catchValue:n,typeName:ki.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return yE.create(this,e)}readonly(){return fA.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const bse=/^c[^\s-]{8,}$/i,vse=/^[a-z][a-z0-9]*$/,xse=/^[0-9A-HJKMNP-TV-Z]{26}$/,Ese=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Cse=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Tse="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let U4;const Ase=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Sse=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ise=t=>t.precision?t.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${t.precision}}Z$`):t.precision===0?t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):t.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Pse(t,e){return!!((e==="v4"||!e)&&Ase.test(t)||(e==="v6"||!e)&&Sse.test(t))}class fd extends Qi{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Wn.string){const l=this._getOrReturnCtx(e);return Zn(l,{code:wn.invalid_type,expected:Wn.string,received:l.parsedType}),Vi}const i=new Qa;let o;for(const l of this._def.checks)if(l.kind==="min")e.data.length<l.value&&(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if(l.kind==="max")e.data.length>l.value&&(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),i.dirty());else if(l.kind==="length"){const h=e.data.length>l.value,s=e.data.length<l.value;(h||s)&&(o=this._getOrReturnCtx(e,o),h?Zn(o,{code:wn.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):s&&Zn(o,{code:wn.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),i.dirty())}else if(l.kind==="email")Cse.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"email",code:wn.invalid_string,message:l.message}),i.dirty());else if(l.kind==="emoji")U4||(U4=new RegExp(Tse,"u")),U4.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"emoji",code:wn.invalid_string,message:l.message}),i.dirty());else if(l.kind==="uuid")Ese.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"uuid",code:wn.invalid_string,message:l.message}),i.dirty());else if(l.kind==="cuid")bse.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"cuid",code:wn.invalid_string,message:l.message}),i.dirty());else if(l.kind==="cuid2")vse.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"cuid2",code:wn.invalid_string,message:l.message}),i.dirty());else if(l.kind==="ulid")xse.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"ulid",code:wn.invalid_string,message:l.message}),i.dirty());else if(l.kind==="url")try{new URL(e.data)}catch{o=this._getOrReturnCtx(e,o),Zn(o,{validation:"url",code:wn.invalid_string,message:l.message}),i.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"regex",code:wn.invalid_string,message:l.message}),i.dirty())):l.kind==="trim"?e.data=e.data.trim():l.kind==="includes"?e.data.includes(l.value,l.position)||(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),i.dirty()):l.kind==="toLowerCase"?e.data=e.data.toLowerCase():l.kind==="toUpperCase"?e.data=e.data.toUpperCase():l.kind==="startsWith"?e.data.startsWith(l.value)||(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.invalid_string,validation:{startsWith:l.value},message:l.message}),i.dirty()):l.kind==="endsWith"?e.data.endsWith(l.value)||(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.invalid_string,validation:{endsWith:l.value},message:l.message}),i.dirty()):l.kind==="datetime"?Ise(l).test(e.data)||(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.invalid_string,validation:"datetime",message:l.message}),i.dirty()):l.kind==="ip"?Pse(e.data,l.version)||(o=this._getOrReturnCtx(e,o),Zn(o,{validation:"ip",code:wn.invalid_string,message:l.message}),i.dirty()):Dr.assertNever(l);return{status:i.value,value:e.data}}_regex(e,n,i){return this.refinement(o=>e.test(o),{validation:n,code:wn.invalid_string,...xi.errToObj(i)})}_addCheck(e){return new fd({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...xi.errToObj(e)})}url(e){return this._addCheck({kind:"url",...xi.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...xi.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...xi.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...xi.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...xi.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...xi.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...xi.errToObj(e)})}datetime(e){var n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,...xi.errToObj(e==null?void 0:e.message)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...xi.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...xi.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...xi.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...xi.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...xi.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...xi.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...xi.errToObj(n)})}nonempty(e){return this.min(1,xi.errToObj(e))}trim(){return new fd({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new fd({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new fd({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}fd.create=t=>{var e;return new fd({checks:[],typeName:ki.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...qi(t)})};function Rse(t,e){const n=(t.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,o=n>i?n:i,l=parseInt(t.toFixed(o).replace(".","")),h=parseInt(e.toFixed(o).replace(".",""));return l%h/Math.pow(10,o)}class Pm extends Qi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Wn.number){const l=this._getOrReturnCtx(e);return Zn(l,{code:wn.invalid_type,expected:Wn.number,received:l.parsedType}),Vi}let i;const o=new Qa;for(const l of this._def.checks)l.kind==="int"?Dr.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.invalid_type,expected:"integer",received:"float",message:l.message}),o.dirty()):l.kind==="min"?(l.inclusive?e.data<l.value:e.data<=l.value)&&(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),o.dirty()):l.kind==="max"?(l.inclusive?e.data>l.value:e.data>=l.value)&&(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),o.dirty()):l.kind==="multipleOf"?Rse(e.data,l.value)!==0&&(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.not_multiple_of,multipleOf:l.value,message:l.message}),o.dirty()):l.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.not_finite,message:l.message}),o.dirty()):Dr.assertNever(l);return{status:o.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,xi.toString(n))}gt(e,n){return this.setLimit("min",e,!1,xi.toString(n))}lte(e,n){return this.setLimit("max",e,!0,xi.toString(n))}lt(e,n){return this.setLimit("max",e,!1,xi.toString(n))}setLimit(e,n,i,o){return new Pm({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:xi.toString(o)}]})}_addCheck(e){return new Pm({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:xi.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:xi.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:xi.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:xi.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:xi.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:xi.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:xi.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:xi.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:xi.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Dr.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Pm.create=t=>new Pm({checks:[],typeName:ki.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...qi(t)});class Rm extends Qi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==Wn.bigint){const l=this._getOrReturnCtx(e);return Zn(l,{code:wn.invalid_type,expected:Wn.bigint,received:l.parsedType}),Vi}let i;const o=new Qa;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?e.data<l.value:e.data<=l.value)&&(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),o.dirty()):l.kind==="max"?(l.inclusive?e.data>l.value:e.data>=l.value)&&(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),o.dirty()):l.kind==="multipleOf"?e.data%l.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),Zn(i,{code:wn.not_multiple_of,multipleOf:l.value,message:l.message}),o.dirty()):Dr.assertNever(l);return{status:o.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,xi.toString(n))}gt(e,n){return this.setLimit("min",e,!1,xi.toString(n))}lte(e,n){return this.setLimit("max",e,!0,xi.toString(n))}lt(e,n){return this.setLimit("max",e,!1,xi.toString(n))}setLimit(e,n,i,o){return new Rm({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:xi.toString(o)}]})}_addCheck(e){return new Rm({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:xi.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:xi.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:xi.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:xi.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:xi.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Rm.create=t=>{var e;return new Rm({checks:[],typeName:ki.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...qi(t)})};class a2 extends Qi{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Wn.boolean){const i=this._getOrReturnCtx(e);return Zn(i,{code:wn.invalid_type,expected:Wn.boolean,received:i.parsedType}),Vi}return Oc(e.data)}}a2.create=t=>new a2({typeName:ki.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...qi(t)});class W0 extends Qi{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Wn.date){const l=this._getOrReturnCtx(e);return Zn(l,{code:wn.invalid_type,expected:Wn.date,received:l.parsedType}),Vi}if(isNaN(e.data.getTime())){const l=this._getOrReturnCtx(e);return Zn(l,{code:wn.invalid_date}),Vi}const i=new Qa;let o;for(const l of this._def.checks)l.kind==="min"?e.data.getTime()<l.value&&(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),i.dirty()):l.kind==="max"?e.data.getTime()>l.value&&(o=this._getOrReturnCtx(e,o),Zn(o,{code:wn.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),i.dirty()):Dr.assertNever(l);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new W0({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:xi.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:xi.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}W0.create=t=>new W0({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:ki.ZodDate,...qi(t)});class cA extends Qi{_parse(e){if(this._getType(e)!==Wn.symbol){const i=this._getOrReturnCtx(e);return Zn(i,{code:wn.invalid_type,expected:Wn.symbol,received:i.parsedType}),Vi}return Oc(e.data)}}cA.create=t=>new cA({typeName:ki.ZodSymbol,...qi(t)});class c2 extends Qi{_parse(e){if(this._getType(e)!==Wn.undefined){const i=this._getOrReturnCtx(e);return Zn(i,{code:wn.invalid_type,expected:Wn.undefined,received:i.parsedType}),Vi}return Oc(e.data)}}c2.create=t=>new c2({typeName:ki.ZodUndefined,...qi(t)});class l2 extends Qi{_parse(e){if(this._getType(e)!==Wn.null){const i=this._getOrReturnCtx(e);return Zn(i,{code:wn.invalid_type,expected:Wn.null,received:i.parsedType}),Vi}return Oc(e.data)}}l2.create=t=>new l2({typeName:ki.ZodNull,...qi(t)});class tw extends Qi{constructor(){super(...arguments),this._any=!0}_parse(e){return Oc(e.data)}}tw.create=t=>new tw({typeName:ki.ZodAny,...qi(t)});class M0 extends Qi{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Oc(e.data)}}M0.create=t=>new M0({typeName:ki.ZodUnknown,...qi(t)});class Vf extends Qi{_parse(e){const n=this._getOrReturnCtx(e);return Zn(n,{code:wn.invalid_type,expected:Wn.never,received:n.parsedType}),Vi}}Vf.create=t=>new Vf({typeName:ki.ZodNever,...qi(t)});class lA extends Qi{_parse(e){if(this._getType(e)!==Wn.undefined){const i=this._getOrReturnCtx(e);return Zn(i,{code:wn.invalid_type,expected:Wn.void,received:i.parsedType}),Vi}return Oc(e.data)}}lA.create=t=>new lA({typeName:ki.ZodVoid,...qi(t)});class md extends Qi{_parse(e){const{ctx:n,status:i}=this._processInputParams(e),o=this._def;if(n.parsedType!==Wn.array)return Zn(n,{code:wn.invalid_type,expected:Wn.array,received:n.parsedType}),Vi;if(o.exactLength!==null){const h=n.data.length>o.exactLength.value,s=n.data.length<o.exactLength.value;(h||s)&&(Zn(n,{code:h?wn.too_big:wn.too_small,minimum:s?o.exactLength.value:void 0,maximum:h?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),i.dirty())}if(o.minLength!==null&&n.data.length<o.minLength.value&&(Zn(n,{code:wn.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),i.dirty()),o.maxLength!==null&&n.data.length>o.maxLength.value&&(Zn(n,{code:wn.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((h,s)=>o.type._parseAsync(new Eh(n,h,n.path,s)))).then(h=>Qa.mergeArray(i,h));const l=[...n.data].map((h,s)=>o.type._parseSync(new Eh(n,h,n.path,s)));return Qa.mergeArray(i,l)}get element(){return this._def.type}min(e,n){return new md({...this._def,minLength:{value:e,message:xi.toString(n)}})}max(e,n){return new md({...this._def,maxLength:{value:e,message:xi.toString(n)}})}length(e,n){return new md({...this._def,exactLength:{value:e,message:xi.toString(n)}})}nonempty(e){return this.min(1,e)}}md.create=(t,e)=>new md({type:t,minLength:null,maxLength:null,exactLength:null,typeName:ki.ZodArray,...qi(e)});function v1(t){if(t instanceof Ms){const e={};for(const n in t.shape){const i=t.shape[n];e[n]=Lf.create(v1(i))}return new Ms({...t._def,shape:()=>e})}else return t instanceof md?new md({...t._def,type:v1(t.element)}):t instanceof Lf?Lf.create(v1(t.unwrap())):t instanceof G0?G0.create(v1(t.unwrap())):t instanceof Ch?Ch.create(t.items.map(e=>v1(e))):t}class Ms extends Qi{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Dr.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==Wn.object){const x=this._getOrReturnCtx(e);return Zn(x,{code:wn.invalid_type,expected:Wn.object,received:x.parsedType}),Vi}const{status:i,ctx:o}=this._processInputParams(e),{shape:l,keys:h}=this._getCached(),s=[];if(!(this._def.catchall instanceof Vf&&this._def.unknownKeys==="strip"))for(const x in o.data)h.includes(x)||s.push(x);const w=[];for(const x of h){const A=l[x],P=o.data[x];w.push({key:{status:"valid",value:x},value:A._parse(new Eh(o,P,o.path,x)),alwaysSet:x in o.data})}if(this._def.catchall instanceof Vf){const x=this._def.unknownKeys;if(x==="passthrough")for(const A of s)w.push({key:{status:"valid",value:A},value:{status:"valid",value:o.data[A]}});else if(x==="strict")s.length>0&&(Zn(o,{code:wn.unrecognized_keys,keys:s}),i.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const A of s){const P=o.data[A];w.push({key:{status:"valid",value:A},value:x._parse(new Eh(o,P,o.path,A)),alwaysSet:A in o.data})}}return o.common.async?Promise.resolve().then(async()=>{const x=[];for(const A of w){const P=await A.key;x.push({key:P,value:await A.value,alwaysSet:A.alwaysSet})}return x}).then(x=>Qa.mergeObjectSync(i,x)):Qa.mergeObjectSync(i,w)}get shape(){return this._def.shape()}strict(e){return xi.errToObj,new Ms({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,i)=>{var o,l,h,s;const w=(h=(l=(o=this._def).errorMap)===null||l===void 0?void 0:l.call(o,n,i).message)!==null&&h!==void 0?h:i.defaultError;return n.code==="unrecognized_keys"?{message:(s=xi.errToObj(e).message)!==null&&s!==void 0?s:w}:{message:w}}}:{}})}strip(){return new Ms({...this._def,unknownKeys:"strip"})}passthrough(){return new Ms({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ms({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ms({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ki.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new Ms({...this._def,catchall:e})}pick(e){const n={};return Dr.objectKeys(e).forEach(i=>{e[i]&&this.shape[i]&&(n[i]=this.shape[i])}),new Ms({...this._def,shape:()=>n})}omit(e){const n={};return Dr.objectKeys(this.shape).forEach(i=>{e[i]||(n[i]=this.shape[i])}),new Ms({...this._def,shape:()=>n})}deepPartial(){return v1(this)}partial(e){const n={};return Dr.objectKeys(this.shape).forEach(i=>{const o=this.shape[i];e&&!e[i]?n[i]=o:n[i]=o.optional()}),new Ms({...this._def,shape:()=>n})}required(e){const n={};return Dr.objectKeys(this.shape).forEach(i=>{if(e&&!e[i])n[i]=this.shape[i];else{let l=this.shape[i];for(;l instanceof Lf;)l=l._def.innerType;n[i]=l}}),new Ms({...this._def,shape:()=>n})}keyof(){return aW(Dr.objectKeys(this.shape))}}Ms.create=(t,e)=>new Ms({shape:()=>t,unknownKeys:"strip",catchall:Vf.create(),typeName:ki.ZodObject,...qi(e)});Ms.strictCreate=(t,e)=>new Ms({shape:()=>t,unknownKeys:"strict",catchall:Vf.create(),typeName:ki.ZodObject,...qi(e)});Ms.lazycreate=(t,e)=>new Ms({shape:t,unknownKeys:"strip",catchall:Vf.create(),typeName:ki.ZodObject,...qi(e)});class u2 extends Qi{_parse(e){const{ctx:n}=this._processInputParams(e),i=this._def.options;function o(l){for(const s of l)if(s.result.status==="valid")return s.result;for(const s of l)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;const h=l.map(s=>new pd(s.ctx.common.issues));return Zn(n,{code:wn.invalid_union,unionErrors:h}),Vi}if(n.common.async)return Promise.all(i.map(async l=>{const h={...n,common:{...n.common,issues:[]},parent:null};return{result:await l._parseAsync({data:n.data,path:n.path,parent:h}),ctx:h}})).then(o);{let l;const h=[];for(const w of i){const x={...n,common:{...n.common,issues:[]},parent:null},A=w._parseSync({data:n.data,path:n.path,parent:x});if(A.status==="valid")return A;A.status==="dirty"&&!l&&(l={result:A,ctx:x}),x.common.issues.length&&h.push(x.common.issues)}if(l)return n.common.issues.push(...l.ctx.common.issues),l.result;const s=h.map(w=>new pd(w));return Zn(n,{code:wn.invalid_union,unionErrors:s}),Vi}}get options(){return this._def.options}}u2.create=(t,e)=>new u2({options:t,typeName:ki.ZodUnion,...qi(e)});const LT=t=>t instanceof f2?LT(t.schema):t instanceof wd?LT(t.innerType()):t instanceof p2?[t.value]:t instanceof Om?t.options:t instanceof m2?Object.keys(t.enum):t instanceof g2?LT(t._def.innerType):t instanceof c2?[void 0]:t instanceof l2?[null]:null;class SS extends Qi{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==Wn.object)return Zn(n,{code:wn.invalid_type,expected:Wn.object,received:n.parsedType}),Vi;const i=this.discriminator,o=n.data[i],l=this.optionsMap.get(o);return l?n.common.async?l._parseAsync({data:n.data,path:n.path,parent:n}):l._parseSync({data:n.data,path:n.path,parent:n}):(Zn(n,{code:wn.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),Vi)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,i){const o=new Map;for(const l of n){const h=LT(l.shape[e]);if(!h)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of h){if(o.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);o.set(s,l)}}return new SS({typeName:ki.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:o,...qi(i)})}}function YR(t,e){const n=hm(t),i=hm(e);if(t===e)return{valid:!0,data:t};if(n===Wn.object&&i===Wn.object){const o=Dr.objectKeys(e),l=Dr.objectKeys(t).filter(s=>o.indexOf(s)!==-1),h={...t,...e};for(const s of l){const w=YR(t[s],e[s]);if(!w.valid)return{valid:!1};h[s]=w.data}return{valid:!0,data:h}}else if(n===Wn.array&&i===Wn.array){if(t.length!==e.length)return{valid:!1};const o=[];for(let l=0;l<t.length;l++){const h=t[l],s=e[l],w=YR(h,s);if(!w.valid)return{valid:!1};o.push(w.data)}return{valid:!0,data:o}}else return n===Wn.date&&i===Wn.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class d2 extends Qi{_parse(e){const{status:n,ctx:i}=this._processInputParams(e),o=(l,h)=>{if(ZR(l)||ZR(h))return Vi;const s=YR(l.value,h.value);return s.valid?((KR(l)||KR(h))&&n.dirty(),{status:n.value,value:s.data}):(Zn(i,{code:wn.invalid_intersection_types}),Vi)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([l,h])=>o(l,h)):o(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}d2.create=(t,e,n)=>new d2({left:t,right:e,typeName:ki.ZodIntersection,...qi(n)});class Ch extends Qi{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==Wn.array)return Zn(i,{code:wn.invalid_type,expected:Wn.array,received:i.parsedType}),Vi;if(i.data.length<this._def.items.length)return Zn(i,{code:wn.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Vi;!this._def.rest&&i.data.length>this._def.items.length&&(Zn(i,{code:wn.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const l=[...i.data].map((h,s)=>{const w=this._def.items[s]||this._def.rest;return w?w._parse(new Eh(i,h,i.path,s)):null}).filter(h=>!!h);return i.common.async?Promise.all(l).then(h=>Qa.mergeArray(n,h)):Qa.mergeArray(n,l)}get items(){return this._def.items}rest(e){return new Ch({...this._def,rest:e})}}Ch.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ch({items:t,typeName:ki.ZodTuple,rest:null,...qi(e)})};class h2 extends Qi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==Wn.object)return Zn(i,{code:wn.invalid_type,expected:Wn.object,received:i.parsedType}),Vi;const o=[],l=this._def.keyType,h=this._def.valueType;for(const s in i.data)o.push({key:l._parse(new Eh(i,s,i.path,s)),value:h._parse(new Eh(i,i.data[s],i.path,s))});return i.common.async?Qa.mergeObjectAsync(n,o):Qa.mergeObjectSync(n,o)}get element(){return this._def.valueType}static create(e,n,i){return n instanceof Qi?new h2({keyType:e,valueType:n,typeName:ki.ZodRecord,...qi(i)}):new h2({keyType:fd.create(),valueType:e,typeName:ki.ZodRecord,...qi(n)})}}class uA extends Qi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==Wn.map)return Zn(i,{code:wn.invalid_type,expected:Wn.map,received:i.parsedType}),Vi;const o=this._def.keyType,l=this._def.valueType,h=[...i.data.entries()].map(([s,w],x)=>({key:o._parse(new Eh(i,s,i.path,[x,"key"])),value:l._parse(new Eh(i,w,i.path,[x,"value"]))}));if(i.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const w of h){const x=await w.key,A=await w.value;if(x.status==="aborted"||A.status==="aborted")return Vi;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}})}else{const s=new Map;for(const w of h){const x=w.key,A=w.value;if(x.status==="aborted"||A.status==="aborted")return Vi;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}}}}uA.create=(t,e,n)=>new uA({valueType:e,keyType:t,typeName:ki.ZodMap,...qi(n)});class H0 extends Qi{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==Wn.set)return Zn(i,{code:wn.invalid_type,expected:Wn.set,received:i.parsedType}),Vi;const o=this._def;o.minSize!==null&&i.data.size<o.minSize.value&&(Zn(i,{code:wn.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),n.dirty()),o.maxSize!==null&&i.data.size>o.maxSize.value&&(Zn(i,{code:wn.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),n.dirty());const l=this._def.valueType;function h(w){const x=new Set;for(const A of w){if(A.status==="aborted")return Vi;A.status==="dirty"&&n.dirty(),x.add(A.value)}return{status:n.value,value:x}}const s=[...i.data.values()].map((w,x)=>l._parse(new Eh(i,w,i.path,x)));return i.common.async?Promise.all(s).then(w=>h(w)):h(s)}min(e,n){return new H0({...this._def,minSize:{value:e,message:xi.toString(n)}})}max(e,n){return new H0({...this._def,maxSize:{value:e,message:xi.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}H0.create=(t,e)=>new H0({valueType:t,minSize:null,maxSize:null,typeName:ki.ZodSet,...qi(e)});class F1 extends Qi{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==Wn.function)return Zn(n,{code:wn.invalid_type,expected:Wn.function,received:n.parsedType}),Vi;function i(s,w){return oA({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,sA(),s2].filter(x=>!!x),issueData:{code:wn.invalid_arguments,argumentsError:w}})}function o(s,w){return oA({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,sA(),s2].filter(x=>!!x),issueData:{code:wn.invalid_return_type,returnTypeError:w}})}const l={errorMap:n.common.contextualErrorMap},h=n.data;if(this._def.returns instanceof nw){const s=this;return Oc(async function(...w){const x=new pd([]),A=await s._def.args.parseAsync(w,l).catch(M=>{throw x.addIssue(i(w,M)),x}),P=await Reflect.apply(h,this,A);return await s._def.returns._def.type.parseAsync(P,l).catch(M=>{throw x.addIssue(o(P,M)),x})})}else{const s=this;return Oc(function(...w){const x=s._def.args.safeParse(w,l);if(!x.success)throw new pd([i(w,x.error)]);const A=Reflect.apply(h,this,x.data),P=s._def.returns.safeParse(A,l);if(!P.success)throw new pd([o(A,P.error)]);return P.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new F1({...this._def,args:Ch.create(e).rest(M0.create())})}returns(e){return new F1({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,i){return new F1({args:e||Ch.create([]).rest(M0.create()),returns:n||M0.create(),typeName:ki.ZodFunction,...qi(i)})}}class f2 extends Qi{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}f2.create=(t,e)=>new f2({getter:t,typeName:ki.ZodLazy,...qi(e)});class p2 extends Qi{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return Zn(n,{received:n.data,code:wn.invalid_literal,expected:this._def.value}),Vi}return{status:"valid",value:e.data}}get value(){return this._def.value}}p2.create=(t,e)=>new p2({value:t,typeName:ki.ZodLiteral,...qi(e)});function aW(t,e){return new Om({values:t,typeName:ki.ZodEnum,...qi(e)})}class Om extends Qi{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),i=this._def.values;return Zn(n,{expected:Dr.joinValues(i),received:n.parsedType,code:wn.invalid_type}),Vi}if(this._def.values.indexOf(e.data)===-1){const n=this._getOrReturnCtx(e),i=this._def.values;return Zn(n,{received:n.data,code:wn.invalid_enum_value,options:i}),Vi}return Oc(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e){return Om.create(e)}exclude(e){return Om.create(this.options.filter(n=>!e.includes(n)))}}Om.create=aW;class m2 extends Qi{_parse(e){const n=Dr.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==Wn.string&&i.parsedType!==Wn.number){const o=Dr.objectValues(n);return Zn(i,{expected:Dr.joinValues(o),received:i.parsedType,code:wn.invalid_type}),Vi}if(n.indexOf(e.data)===-1){const o=Dr.objectValues(n);return Zn(i,{received:i.data,code:wn.invalid_enum_value,options:o}),Vi}return Oc(e.data)}get enum(){return this._def.values}}m2.create=(t,e)=>new m2({values:t,typeName:ki.ZodNativeEnum,...qi(e)});class nw extends Qi{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==Wn.promise&&n.common.async===!1)return Zn(n,{code:wn.invalid_type,expected:Wn.promise,received:n.parsedType}),Vi;const i=n.parsedType===Wn.promise?n.data:Promise.resolve(n.data);return Oc(i.then(o=>this._def.type.parseAsync(o,{path:n.path,errorMap:n.common.contextualErrorMap})))}}nw.create=(t,e)=>new nw({type:t,typeName:ki.ZodPromise,...qi(e)});class wd extends Qi{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ki.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:i}=this._processInputParams(e),o=this._def.effect||null,l={addIssue:h=>{Zn(i,h),h.fatal?n.abort():n.dirty()},get path(){return i.path}};if(l.addIssue=l.addIssue.bind(l),o.type==="preprocess"){const h=o.transform(i.data,l);return i.common.issues.length?{status:"dirty",value:i.data}:i.common.async?Promise.resolve(h).then(s=>this._def.schema._parseAsync({data:s,path:i.path,parent:i})):this._def.schema._parseSync({data:h,path:i.path,parent:i})}if(o.type==="refinement"){const h=s=>{const w=o.refinement(s,l);if(i.common.async)return Promise.resolve(w);if(w instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(i.common.async===!1){const s=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?Vi:(s.status==="dirty"&&n.dirty(),h(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(s=>s.status==="aborted"?Vi:(s.status==="dirty"&&n.dirty(),h(s.value).then(()=>({status:n.value,value:s.value}))))}if(o.type==="transform")if(i.common.async===!1){const h=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!o2(h))return h;const s=o.transform(h.value,l);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(h=>o2(h)?Promise.resolve(o.transform(h.value,l)).then(s=>({status:n.value,value:s})):h);Dr.assertNever(o)}}wd.create=(t,e,n)=>new wd({schema:t,typeName:ki.ZodEffects,effect:e,...qi(n)});wd.createWithPreprocess=(t,e,n)=>new wd({schema:e,effect:{type:"preprocess",transform:t},typeName:ki.ZodEffects,...qi(n)});class Lf extends Qi{_parse(e){return this._getType(e)===Wn.undefined?Oc(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Lf.create=(t,e)=>new Lf({innerType:t,typeName:ki.ZodOptional,...qi(e)});class G0 extends Qi{_parse(e){return this._getType(e)===Wn.null?Oc(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}G0.create=(t,e)=>new G0({innerType:t,typeName:ki.ZodNullable,...qi(e)});class g2 extends Qi{_parse(e){const{ctx:n}=this._processInputParams(e);let i=n.data;return n.parsedType===Wn.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}g2.create=(t,e)=>new g2({innerType:t,typeName:ki.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...qi(e)});class dA extends Qi{_parse(e){const{ctx:n}=this._processInputParams(e),i={...n,common:{...n.common,issues:[]}},o=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return aA(o)?o.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new pd(i.common.issues)},input:i.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new pd(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}dA.create=(t,e)=>new dA({innerType:t,typeName:ki.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...qi(e)});class hA extends Qi{_parse(e){if(this._getType(e)!==Wn.nan){const i=this._getOrReturnCtx(e);return Zn(i,{code:wn.invalid_type,expected:Wn.nan,received:i.parsedType}),Vi}return{status:"valid",value:e.data}}}hA.create=t=>new hA({typeName:ki.ZodNaN,...qi(t)});const Ose=Symbol("zod_brand");class cW extends Qi{_parse(e){const{ctx:n}=this._processInputParams(e),i=n.data;return this._def.type._parse({data:i,path:n.path,parent:n})}unwrap(){return this._def.type}}class yE extends Qi{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return l.status==="aborted"?Vi:l.status==="dirty"?(n.dirty(),oW(l.value)):this._def.out._parseAsync({data:l.value,path:i.path,parent:i})})();{const o=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?Vi:o.status==="dirty"?(n.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:i.path,parent:i})}}static create(e,n){return new yE({in:e,out:n,typeName:ki.ZodPipeline})}}class fA extends Qi{_parse(e){const n=this._def.innerType._parse(e);return o2(n)&&(n.value=Object.freeze(n.value)),n}}fA.create=(t,e)=>new fA({innerType:t,typeName:ki.ZodReadonly,...qi(e)});const lW=(t,e={},n)=>t?tw.create().superRefine((i,o)=>{var l,h;if(!t(i)){const s=typeof e=="function"?e(i):typeof e=="string"?{message:e}:e,w=(h=(l=s.fatal)!==null&&l!==void 0?l:n)!==null&&h!==void 0?h:!0,x=typeof s=="string"?{message:s}:s;o.addIssue({code:"custom",...x,fatal:w})}}):tw.create(),kse={object:Ms.lazycreate};var ki;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(ki||(ki={}));const Dse=(t,e={message:`Input not instance of ${t.name}`})=>lW(n=>n instanceof t,e),uW=fd.create,dW=Pm.create,Nse=hA.create,Mse=Rm.create,hW=a2.create,Lse=W0.create,Bse=cA.create,Fse=c2.create,$se=l2.create,zse=tw.create,Use=M0.create,jse=Vf.create,Vse=lA.create,Wse=md.create,Hse=Ms.create,Gse=Ms.strictCreate,qse=u2.create,Zse=SS.create,Kse=d2.create,Yse=Ch.create,Xse=h2.create,Jse=uA.create,Qse=H0.create,eoe=F1.create,toe=f2.create,noe=p2.create,ioe=Om.create,roe=m2.create,soe=nw.create,xF=wd.create,ooe=Lf.create,aoe=G0.create,coe=wd.createWithPreprocess,loe=yE.create,uoe=()=>uW().optional(),doe=()=>dW().optional(),hoe=()=>hW().optional(),foe={string:t=>fd.create({...t,coerce:!0}),number:t=>Pm.create({...t,coerce:!0}),boolean:t=>a2.create({...t,coerce:!0}),bigint:t=>Rm.create({...t,coerce:!0}),date:t=>W0.create({...t,coerce:!0})},poe=Vi;var Pe=Object.freeze({__proto__:null,defaultErrorMap:s2,setErrorMap:_se,getErrorMap:sA,makeIssue:oA,EMPTY_PATH:wse,addIssueToContext:Zn,ParseStatus:Qa,INVALID:Vi,DIRTY:oW,OK:Oc,isAborted:ZR,isDirty:KR,isValid:o2,isAsync:aA,get util(){return Dr},get objectUtil(){return qR},ZodParsedType:Wn,getParsedType:hm,ZodType:Qi,ZodString:fd,ZodNumber:Pm,ZodBigInt:Rm,ZodBoolean:a2,ZodDate:W0,ZodSymbol:cA,ZodUndefined:c2,ZodNull:l2,ZodAny:tw,ZodUnknown:M0,ZodNever:Vf,ZodVoid:lA,ZodArray:md,ZodObject:Ms,ZodUnion:u2,ZodDiscriminatedUnion:SS,ZodIntersection:d2,ZodTuple:Ch,ZodRecord:h2,ZodMap:uA,ZodSet:H0,ZodFunction:F1,ZodLazy:f2,ZodLiteral:p2,ZodEnum:Om,ZodNativeEnum:m2,ZodPromise:nw,ZodEffects:wd,ZodTransformer:wd,ZodOptional:Lf,ZodNullable:G0,ZodDefault:g2,ZodCatch:dA,ZodNaN:hA,BRAND:Ose,ZodBranded:cW,ZodPipeline:yE,ZodReadonly:fA,custom:lW,Schema:Qi,ZodSchema:Qi,late:kse,get ZodFirstPartyTypeKind(){return ki},coerce:foe,any:zse,array:Wse,bigint:Mse,boolean:hW,date:Lse,discriminatedUnion:Zse,effect:xF,enum:ioe,function:eoe,instanceof:Dse,intersection:Kse,lazy:toe,literal:noe,map:Jse,nan:Nse,nativeEnum:roe,never:jse,null:$se,nullable:aoe,number:dW,object:Hse,oboolean:hoe,onumber:doe,optional:ooe,ostring:uoe,pipeline:loe,preprocess:coe,promise:soe,record:Xse,set:Qse,strictObject:Gse,string:uW,symbol:Bse,transformer:xF,tuple:Yse,undefined:Fse,union:qse,unknown:Use,void:Vse,NEVER:poe,ZodIssueCode:wn,quotelessJson:yse,ZodError:pd});const Zs=Pe.object({message:Pe.string()});function Hn(t){return Pe.literal(Kn[t])}const IS=Pe.object({serializedMessage:Pe.string().optional(),accountAddress:Pe.string(),chainId:Pe.string(),notBefore:Pe.string().optional(),domain:Pe.string(),uri:Pe.string(),version:Pe.string(),nonce:Pe.string(),statement:Pe.string().optional(),resources:Pe.array(Pe.string()).optional(),requestId:Pe.string().optional(),issuedAt:Pe.string().optional(),expirationTime:Pe.string().optional()});Pe.object({accessList:Pe.array(Pe.string()),blockHash:Pe.string().nullable(),blockNumber:Pe.string().nullable(),chainId:Pe.string().or(Pe.number()),from:Pe.string(),gas:Pe.string(),hash:Pe.string(),input:Pe.string().nullable(),maxFeePerGas:Pe.string(),maxPriorityFeePerGas:Pe.string(),nonce:Pe.string(),r:Pe.string(),s:Pe.string(),to:Pe.string(),transactionIndex:Pe.string().nullable(),type:Pe.string(),v:Pe.string(),value:Pe.string()});const moe=Pe.object({chainId:Pe.string().or(Pe.number()),rpcUrl:Pe.optional(Pe.string())}),goe=Pe.object({email:Pe.string().email()}),yoe=Pe.object({otp:Pe.string()}),_oe=Pe.object({uri:Pe.string(),preferredAccountType:Pe.optional(Pe.string()),chainId:Pe.optional(Pe.string().or(Pe.number())),siwxMessage:Pe.optional(IS),rpcUrl:Pe.optional(Pe.string())}),woe=Pe.object({chainId:Pe.optional(Pe.string().or(Pe.number())),preferredAccountType:Pe.optional(Pe.string()),socialUri:Pe.optional(Pe.string()),siwxMessage:Pe.optional(IS),rpcUrl:Pe.optional(Pe.string())}),boe=Pe.object({provider:Pe.enum(["google","github","apple","facebook","x","discord"])}),voe=Pe.object({email:Pe.string().email()}),xoe=Pe.object({otp:Pe.string()}),Eoe=Pe.object({otp:Pe.string()}),Coe=Pe.object({themeMode:Pe.optional(Pe.enum(["light","dark"])),themeVariables:Pe.optional(Pe.record(Pe.string(),Pe.string().or(Pe.number()))),w3mThemeVariables:Pe.optional(Pe.record(Pe.string(),Pe.string()))}),Toe=Pe.object({metadata:Pe.object({name:Pe.string(),description:Pe.string(),url:Pe.string(),icons:Pe.array(Pe.string())}).optional(),sdkVersion:Pe.string().optional(),sdkType:Pe.string().optional(),projectId:Pe.string()}),Aoe=Pe.object({type:Pe.string()}),Soe=Pe.object({action:Pe.enum(["VERIFY_DEVICE","VERIFY_OTP","CONNECT"])}),Ioe=Pe.object({url:Pe.string()}),Poe=Pe.object({userName:Pe.string()}),Roe=Pe.object({email:Pe.string().optional().nullable(),address:Pe.string(),chainId:Pe.string().or(Pe.number()),accounts:Pe.array(Pe.object({address:Pe.string(),type:Pe.enum([Gr.ACCOUNT_TYPES.EOA,Gr.ACCOUNT_TYPES.SMART_ACCOUNT])})).optional(),userName:Pe.string().optional().nullable(),preferredAccountType:Pe.optional(Pe.string()),signature:Pe.string().optional(),message:Pe.string().optional(),siwxMessage:Pe.optional(IS)}),Ooe=Pe.object({action:Pe.enum(["VERIFY_PRIMARY_OTP","VERIFY_SECONDARY_OTP"])}),koe=Pe.object({email:Pe.string().email().optional().nullable(),address:Pe.string(),chainId:Pe.string().or(Pe.number()),smartAccountDeployed:Pe.optional(Pe.boolean()),accounts:Pe.array(Pe.object({address:Pe.string(),type:Pe.enum([Gr.ACCOUNT_TYPES.EOA,Gr.ACCOUNT_TYPES.SMART_ACCOUNT])})).optional(),preferredAccountType:Pe.optional(Pe.string()),signature:Pe.string().optional(),message:Pe.string().optional(),siwxMessage:Pe.optional(IS)}),Doe=Pe.object({uri:Pe.string()}),Noe=Pe.object({isConnected:Pe.boolean()}),Moe=Pe.object({chainId:Pe.string().or(Pe.number())}),Loe=Pe.object({chainId:Pe.string().or(Pe.number())}),Boe=Pe.object({newEmail:Pe.string().email()}),Foe=Pe.object({smartAccountEnabledNetworks:Pe.array(Pe.number())});Pe.object({address:Pe.string(),isDeployed:Pe.boolean()});const $oe=Pe.object({version:Pe.string().optional()}),zoe=Pe.object({type:Pe.string(),address:Pe.string()}),Uoe=Pe.any(),joe=Pe.object({method:Pe.literal("eth_accounts")}),Voe=Pe.object({method:Pe.literal("eth_blockNumber")}),Woe=Pe.object({method:Pe.literal("eth_call"),params:Pe.array(Pe.any())}),Hoe=Pe.object({method:Pe.literal("eth_chainId")}),Goe=Pe.object({method:Pe.literal("eth_estimateGas"),params:Pe.array(Pe.any())}),qoe=Pe.object({method:Pe.literal("eth_feeHistory"),params:Pe.array(Pe.any())}),Zoe=Pe.object({method:Pe.literal("eth_gasPrice")}),Koe=Pe.object({method:Pe.literal("eth_getAccount"),params:Pe.array(Pe.any())}),Yoe=Pe.object({method:Pe.literal("eth_getBalance"),params:Pe.array(Pe.any())}),Xoe=Pe.object({method:Pe.literal("eth_getBlockByHash"),params:Pe.array(Pe.any())}),Joe=Pe.object({method:Pe.literal("eth_getBlockByNumber"),params:Pe.array(Pe.any())}),Qoe=Pe.object({method:Pe.literal("eth_getBlockReceipts"),params:Pe.array(Pe.any())}),eae=Pe.object({method:Pe.literal("eth_getBlockTransactionCountByHash"),params:Pe.array(Pe.any())}),tae=Pe.object({method:Pe.literal("eth_getBlockTransactionCountByNumber"),params:Pe.array(Pe.any())}),nae=Pe.object({method:Pe.literal("eth_getCode"),params:Pe.array(Pe.any())}),iae=Pe.object({method:Pe.literal("eth_getFilterChanges"),params:Pe.array(Pe.any())}),rae=Pe.object({method:Pe.literal("eth_getFilterLogs"),params:Pe.array(Pe.any())}),sae=Pe.object({method:Pe.literal("eth_getLogs"),params:Pe.array(Pe.any())}),oae=Pe.object({method:Pe.literal("eth_getProof"),params:Pe.array(Pe.any())}),aae=Pe.object({method:Pe.literal("eth_getStorageAt"),params:Pe.array(Pe.any())}),cae=Pe.object({method:Pe.literal("eth_getTransactionByBlockHashAndIndex"),params:Pe.array(Pe.any())}),lae=Pe.object({method:Pe.literal("eth_getTransactionByBlockNumberAndIndex"),params:Pe.array(Pe.any())}),uae=Pe.object({method:Pe.literal("eth_getTransactionByHash"),params:Pe.array(Pe.any())}),dae=Pe.object({method:Pe.literal("eth_getTransactionCount"),params:Pe.array(Pe.any())}),hae=Pe.object({method:Pe.literal("eth_getTransactionReceipt"),params:Pe.array(Pe.any())}),fae=Pe.object({method:Pe.literal("eth_getUncleCountByBlockHash"),params:Pe.array(Pe.any())}),pae=Pe.object({method:Pe.literal("eth_getUncleCountByBlockNumber"),params:Pe.array(Pe.any())}),mae=Pe.object({method:Pe.literal("eth_maxPriorityFeePerGas")}),gae=Pe.object({method:Pe.literal("eth_newBlockFilter")}),yae=Pe.object({method:Pe.literal("eth_newFilter"),params:Pe.array(Pe.any())}),_ae=Pe.object({method:Pe.literal("eth_newPendingTransactionFilter")}),wae=Pe.object({method:Pe.literal("eth_sendRawTransaction"),params:Pe.array(Pe.any())}),bae=Pe.object({method:Pe.literal("eth_syncing"),params:Pe.array(Pe.any())}),vae=Pe.object({method:Pe.literal("eth_uninstallFilter"),params:Pe.array(Pe.any())}),EF=Pe.object({method:Pe.literal("personal_sign"),params:Pe.array(Pe.any())}),xae=Pe.object({method:Pe.literal("eth_signTypedData_v4"),params:Pe.array(Pe.any())}),Eae=Pe.object({method:Pe.literal("eth_sendTransaction"),params:Pe.array(Pe.any())}),Cae=Pe.object({method:Pe.literal("solana_signMessage"),params:Pe.object({message:Pe.string(),pubkey:Pe.string()})}),Tae=Pe.object({method:Pe.literal("solana_signTransaction"),params:Pe.object({transaction:Pe.string()})}),Aae=Pe.object({method:Pe.literal("solana_signAllTransactions"),params:Pe.object({transactions:Pe.array(Pe.string())})}),Sae=Pe.object({method:Pe.literal("solana_signAndSendTransaction"),params:Pe.object({transaction:Pe.string(),options:Pe.object({skipPreflight:Pe.boolean().optional(),preflightCommitment:Pe.enum(["processed","confirmed","finalized","recent","single","singleGossip","root","max"]).optional(),maxRetries:Pe.number().optional(),minContextSlot:Pe.number().optional()}).optional()})}),Iae=Pe.object({method:Pe.literal("wallet_sendCalls"),params:Pe.array(Pe.object({chainId:Pe.string().or(Pe.number()).optional(),from:Pe.string().optional(),version:Pe.string().optional(),capabilities:Pe.any().optional(),calls:Pe.array(Pe.object({to:Pe.string().startsWith("0x"),data:Pe.string().startsWith("0x").optional(),value:Pe.string().optional()}))}))}),Pae=Pe.object({method:Pe.literal("wallet_getCallsStatus"),params:Pe.array(Pe.string())}),Rae=Pe.object({method:Pe.literal("wallet_getCapabilities"),params:Pe.array(Pe.string().or(Pe.number()).optional()).optional()}),Oae=Pe.object({method:Pe.literal("wallet_grantPermissions"),params:Pe.array(Pe.any())}),kae=Pe.object({method:Pe.literal("wallet_revokePermissions"),params:Pe.any()}),Dae=Pe.object({method:Pe.literal("wallet_getAssets"),params:Pe.any()}),CF=Pe.object({token:Pe.string()}),Gn=Pe.object({id:Pe.string().optional()}),j4={appEvent:Gn.extend({type:Hn("APP_SWITCH_NETWORK"),payload:moe}).or(Gn.extend({type:Hn("APP_CONNECT_EMAIL"),payload:goe})).or(Gn.extend({type:Hn("APP_CONNECT_DEVICE")})).or(Gn.extend({type:Hn("APP_CONNECT_OTP"),payload:yoe})).or(Gn.extend({type:Hn("APP_CONNECT_SOCIAL"),payload:_oe})).or(Gn.extend({type:Hn("APP_GET_FARCASTER_URI")})).or(Gn.extend({type:Hn("APP_CONNECT_FARCASTER")})).or(Gn.extend({type:Hn("APP_GET_USER"),payload:Pe.optional(woe)})).or(Gn.extend({type:Hn("APP_GET_SOCIAL_REDIRECT_URI"),payload:boe})).or(Gn.extend({type:Hn("APP_SIGN_OUT")})).or(Gn.extend({type:Hn("APP_IS_CONNECTED"),payload:Pe.optional(CF)})).or(Gn.extend({type:Hn("APP_GET_CHAIN_ID")})).or(Gn.extend({type:Hn("APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS")})).or(Gn.extend({type:Hn("APP_INIT_SMART_ACCOUNT")})).or(Gn.extend({type:Hn("APP_SET_PREFERRED_ACCOUNT"),payload:Aoe})).or(Gn.extend({type:Hn("APP_RPC_REQUEST"),payload:EF.or(Dae).or(joe).or(Voe).or(Woe).or(Hoe).or(Goe).or(qoe).or(Zoe).or(Koe).or(Yoe).or(Xoe).or(Joe).or(Qoe).or(eae).or(tae).or(nae).or(iae).or(rae).or(sae).or(oae).or(aae).or(cae).or(lae).or(uae).or(dae).or(hae).or(fae).or(pae).or(mae).or(gae).or(yae).or(_ae).or(wae).or(bae).or(vae).or(EF).or(xae).or(Eae).or(Cae).or(Tae).or(Aae).or(Sae).or(Pae).or(Iae).or(Rae).or(Oae).or(kae).and(Pe.object({chainId:Pe.string().or(Pe.number()).optional(),chainNamespace:Pe.enum(["eip155","solana","polkadot","bip122","cosmos"]).optional(),rpcUrl:Pe.string().optional()}))})).or(Gn.extend({type:Hn("APP_UPDATE_EMAIL"),payload:voe})).or(Gn.extend({type:Hn("APP_UPDATE_EMAIL_PRIMARY_OTP"),payload:xoe})).or(Gn.extend({type:Hn("APP_UPDATE_EMAIL_SECONDARY_OTP"),payload:Eoe})).or(Gn.extend({type:Hn("APP_SYNC_THEME"),payload:Coe})).or(Gn.extend({type:Hn("APP_SYNC_DAPP_DATA"),payload:Toe})).or(Gn.extend({type:Hn("APP_RELOAD")})).or(Gn.extend({type:Hn("APP_RPC_ABORT")})),frameEvent:Gn.extend({type:Hn("FRAME_SWITCH_NETWORK_ERROR"),payload:Zs}).or(Gn.extend({type:Hn("FRAME_SWITCH_NETWORK_SUCCESS"),payload:Loe})).or(Gn.extend({type:Hn("FRAME_CONNECT_EMAIL_SUCCESS"),payload:Soe})).or(Gn.extend({type:Hn("FRAME_CONNECT_EMAIL_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_GET_FARCASTER_URI_SUCCESS"),payload:Ioe})).or(Gn.extend({type:Hn("FRAME_GET_FARCASTER_URI_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_CONNECT_FARCASTER_SUCCESS"),payload:Poe})).or(Gn.extend({type:Hn("FRAME_CONNECT_FARCASTER_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_CONNECT_OTP_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_CONNECT_OTP_SUCCESS")})).or(Gn.extend({type:Hn("FRAME_CONNECT_DEVICE_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_CONNECT_DEVICE_SUCCESS")})).or(Gn.extend({type:Hn("FRAME_CONNECT_SOCIAL_SUCCESS"),payload:Roe})).or(Gn.extend({type:Hn("FRAME_CONNECT_SOCIAL_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_GET_USER_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_GET_USER_SUCCESS"),payload:koe})).or(Gn.extend({type:Hn("FRAME_GET_SOCIAL_REDIRECT_URI_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_GET_SOCIAL_REDIRECT_URI_SUCCESS"),payload:Doe})).or(Gn.extend({type:Hn("FRAME_SIGN_OUT_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_SIGN_OUT_SUCCESS")})).or(Gn.extend({type:Hn("FRAME_IS_CONNECTED_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_IS_CONNECTED_SUCCESS"),payload:Noe})).or(Gn.extend({type:Hn("FRAME_GET_CHAIN_ID_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_GET_CHAIN_ID_SUCCESS"),payload:Moe})).or(Gn.extend({type:Hn("FRAME_RPC_REQUEST_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_RPC_REQUEST_SUCCESS"),payload:Uoe})).or(Gn.extend({type:Hn("FRAME_SESSION_UPDATE"),payload:CF})).or(Gn.extend({type:Hn("FRAME_UPDATE_EMAIL_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_UPDATE_EMAIL_SUCCESS"),payload:Ooe})).or(Gn.extend({type:Hn("FRAME_UPDATE_EMAIL_PRIMARY_OTP_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_UPDATE_EMAIL_PRIMARY_OTP_SUCCESS")})).or(Gn.extend({type:Hn("FRAME_UPDATE_EMAIL_SECONDARY_OTP_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_UPDATE_EMAIL_SECONDARY_OTP_SUCCESS"),payload:Boe})).or(Gn.extend({type:Hn("FRAME_SYNC_THEME_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_SYNC_THEME_SUCCESS")})).or(Gn.extend({type:Hn("FRAME_SYNC_DAPP_DATA_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_SYNC_DAPP_DATA_SUCCESS")})).or(Gn.extend({type:Hn("FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_SUCCESS"),payload:Foe})).or(Gn.extend({type:Hn("FRAME_GET_SMART_ACCOUNT_ENABLED_NETWORKS_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_INIT_SMART_ACCOUNT_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_SET_PREFERRED_ACCOUNT_SUCCESS"),payload:zoe})).or(Gn.extend({type:Hn("FRAME_SET_PREFERRED_ACCOUNT_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_READY"),payload:$oe})).or(Gn.extend({type:Hn("FRAME_RELOAD_ERROR"),payload:Zs})).or(Gn.extend({type:Hn("FRAME_RELOAD_SUCCESS")}))};function V4(t,e={}){var n;return typeof(e==null?void 0:e.type)=="string"&&((n=e==null?void 0:e.type)==null?void 0:n.includes(t))}function Nae({projectId:t,chainId:e,enableLogger:n,rpcUrl:i=rW.BLOCKCHAIN_API_RPC_URL,enableCloudAuthAccount:o=!1}){const l=new URL(pse);l.searchParams.set("projectId",t),l.searchParams.set("chainId",String(e)),l.searchParams.set("version",gse),l.searchParams.set("enableLogger",String(n)),l.searchParams.set("rpcUrl",i);const h=Ro.get("dapp_smart_account_version");return h&&(h==="v6"||h==="v7")&&(console.warn(">> AppKit - Forcing smart account version",h),l.searchParams.set("smartAccountVersion",h)),o&&l.searchParams.set("enableCloudAuthAccount","true"),l.toString()}class Mae{constructor({projectId:e,isAppClient:n=!1,chainId:i="eip155:1",enableLogger:o=!0,enableCloudAuthAccount:l=!1,rpcUrl:h=rW.BLOCKCHAIN_API_RPC_URL}){if(this.iframe=null,this.iframeIsReady=!1,this.initFrame=()=>{const s=document.getElementById("w3m-iframe");this.iframe&&!s&&document.body.appendChild(this.iframe)},this.events={registerFrameEventHandler:(s,w,x)=>{function A({data:P}){var M;if(!V4(Kn.FRAME_EVENT_KEY,P))return;const D=j4.frameEvent.safeParse(P);if(!D.success){console.warn("W3mFrame: invalid frame event",D.error.message);return}((M=D.data)==null?void 0:M.id)===s&&(w(D.data),window.removeEventListener("message",A))}Ll.isClient&&(window.addEventListener("message",A),x.addEventListener("abort",()=>{window.removeEventListener("message",A)}))},onFrameEvent:s=>{Ll.isClient&&window.addEventListener("message",({data:w})=>{if(!V4(Kn.FRAME_EVENT_KEY,w))return;const x=j4.frameEvent.safeParse(w);x.success?s(x.data):console.warn("W3mFrame: invalid frame event",x.error.message)})},onAppEvent:s=>{Ll.isClient&&window.addEventListener("message",({data:w})=>{if(!V4(Kn.APP_EVENT_KEY,w))return;const x=j4.appEvent.safeParse(w);x.success||console.warn("W3mFrame: invalid app event",x.error.message),s(w)})},postAppEvent:s=>{var w;if(Ll.isClient){if(!((w=this.iframe)!=null&&w.contentWindow))throw new Error("W3mFrame: iframe is not set");this.iframe.contentWindow.postMessage(s,"*")}},postFrameEvent:s=>{if(Ll.isClient){if(!parent)throw new Error("W3mFrame: parent is not set");parent.postMessage(s,"*")}}},this.projectId=e,this.frameLoadPromise=new Promise((s,w)=>{this.frameLoadPromiseResolver={resolve:s,reject:w}}),this.rpcUrl=h,n&&(this.frameLoadPromise=new Promise((s,w)=>{this.frameLoadPromiseResolver={resolve:s,reject:w}}),Ll.isClient)){const s=document.createElement("iframe");s.id="w3m-iframe",s.src=Nae({projectId:e,chainId:i,enableLogger:o,rpcUrl:this.rpcUrl,enableCloudAuthAccount:l}),s.name="w3m-secure-iframe",s.style.position="fixed",s.style.zIndex="999999",s.style.display="none",s.style.border="none",s.style.animationDelay="0s, 50ms",s.style.borderBottomLeftRadius="clamp(0px, var(--apkt-borderRadius-8), 44px)",s.style.borderBottomRightRadius="clamp(0px, var(--apkt-borderRadius-8), 44px)",this.iframe=s,this.iframe.onerror=()=>{var w;(w=this.frameLoadPromiseResolver)==null||w.reject("Unable to load email login dependency")},this.events.onFrameEvent(w=>{var x;w.type==="@w3m-frame/READY"&&(this.iframeIsReady=!0,(x=this.frameLoadPromiseResolver)==null||x.resolve(void 0))})}}get networks(){const e=["eip155:1","eip155:5","eip155:11155111","eip155:10","eip155:420","eip155:42161","eip155:421613","eip155:137","eip155:80001","eip155:42220","eip155:1313161554","eip155:1313161555","eip155:56","eip155:97","eip155:43114","eip155:43113","eip155:324","eip155:280","eip155:100","eip155:8453","eip155:84531","eip155:84532","eip155:7777777","eip155:999","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1"].map(n=>({[n]:{rpcUrl:`${this.rpcUrl}/v1/?chainId=${n}&projectId=${this.projectId}`,chainId:n}}));return Object.assign({},...e)}}var fh={exports:{}};function Lae(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Bae=Fae;function Fae(t,e,n){var i=n&&n.stringify||Lae,o=1;if(typeof t=="object"&&t!==null){var l=e.length+o;if(l===1)return t;var h=new Array(l);h[0]=i(t);for(var s=1;s<l;s++)h[s]=i(e[s]);return h.join(" ")}if(typeof t!="string")return t;var w=e.length;if(w===0)return t;for(var x="",A=1-o,P=-1,D=t&&t.length||0,M=0;M<D;){if(t.charCodeAt(M)===37&&M+1<D){switch(P=P>-1?P:0,t.charCodeAt(M+1)){case 100:case 102:if(A>=w||e[A]==null)break;P<M&&(x+=t.slice(P,M)),x+=Number(e[A]),P=M+2,M++;break;case 105:if(A>=w||e[A]==null)break;P<M&&(x+=t.slice(P,M)),x+=Math.floor(Number(e[A])),P=M+2,M++;break;case 79:case 111:case 106:if(A>=w||e[A]===void 0)break;P<M&&(x+=t.slice(P,M));var z=typeof e[A];if(z==="string"){x+="'"+e[A]+"'",P=M+2,M++;break}if(z==="function"){x+=e[A].name||"<anonymous>",P=M+2,M++;break}x+=i(e[A]),P=M+2,M++;break;case 115:if(A>=w)break;P<M&&(x+=t.slice(P,M)),x+=String(e[A]),P=M+2,M++;break;case 37:P<M&&(x+=t.slice(P,M)),x+="%",P=M+2,M++,A--;break}++A}++M}return P===-1?t:(P<D&&(x+=t.slice(P)),x)}const TF=Bae;fh.exports=Bf;const y2=Qae().console||{},$ae={mapHttpRequest:$5,mapHttpResponse:$5,wrapRequestSerializer:W4,wrapResponseSerializer:W4,wrapErrorSerializer:W4,req:$5,res:$5,err:SF,errWithCause:SF};function _m(t,e){return t==="silent"?1/0:e.levels.values[t]}const Ck=Symbol("pino.logFuncs"),XR=Symbol("pino.hierarchy"),zae={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function AF(t,e){const n={logger:e,parent:t[XR]};e[XR]=n}function Uae(t,e,n){const i={};e.forEach(o=>{i[o]=n[o]?n[o]:y2[o]||y2[zae[o]||"log"]||$1}),t[Ck]=i}function jae(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Bf(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const n=t.browser.write||y2;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},o=jae(t.browser.serialize,i);let l=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(l=!1);const h=Object.keys(t.customLevels||{}),s=["error","fatal","warn","info","debug","trace"].concat(h);typeof n=="function"&&s.forEach(function(U){n[U]=n}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const w=t.level||"info",x=Object.create(n);x.log||(x.log=$1),Uae(x,s,n),AF({},x),Object.defineProperty(x,"levelVal",{get:P}),Object.defineProperty(x,"level",{get:D,set:M});const A={transmit:e,serialize:o,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:s,timestamp:Yae(t),messageKey:t.messageKey||"msg",onChild:t.onChild||$1};x.levels=Vae(t),x.level=w,x.isLevelEnabled=function(U){return this.levels.values[U]?this.levels.values[U]>=this.levels.values[this.level]:!1},x.setMaxListeners=x.getMaxListeners=x.emit=x.addListener=x.on=x.prependListener=x.once=x.prependOnceListener=x.removeListener=x.removeAllListeners=x.listeners=x.listenerCount=x.eventNames=x.write=x.flush=$1,x.serializers=i,x._serialize=o,x._stdErrSerialize=l,x.child=function(...U){return z.call(this,A,...U)},e&&(x._logEvent=JR());function P(){return _m(this.level,this)}function D(){return this._level}function M(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,o0(this,A,x,"error"),o0(this,A,x,"fatal"),o0(this,A,x,"warn"),o0(this,A,x,"info"),o0(this,A,x,"debug"),o0(this,A,x,"trace"),h.forEach(G=>{o0(this,A,x,G)})}function z(U,G,ne){if(!G)throw new Error("missing bindings for child Pino");ne=ne||{},o&&G.serializers&&(ne.serializers=G.serializers);const oe=ne.serializers;if(o&&oe){var Q=Object.assign({},i,oe),de=t.browser.serialize===!0?Object.keys(Q):o;delete G.serializers,Tk([G],de,Q,this._stdErrSerialize)}function he(ke){this._childLevel=(ke._childLevel|0)+1,this.bindings=G,Q&&(this.serializers=Q,this._serialize=de),e&&(this._logEvent=JR([].concat(ke._logEvent.bindings,G)))}he.prototype=this;const Ie=new he(this);return AF(this,Ie),Ie.child=function(...ke){return z.call(this,U,...ke)},Ie.level=ne.level||this.level,U.onChild(Ie),Ie}return x}function Vae(t){const e=t.customLevels||{},n=Object.assign({},Bf.levels.values,e),i=Object.assign({},Bf.levels.labels,Wae(e));return{values:n,labels:i}}function Wae(t){const e={};return Object.keys(t).forEach(function(n){e[t[n]]=n}),e}Bf.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Bf.stdSerializers=$ae,Bf.stdTimeFunctions=Object.assign({},{nullTime:fW,epochTime:pW,unixTime:Xae,isoTime:Jae});function Hae(t){const e=[];t.bindings&&e.push(t.bindings);let n=t[XR];for(;n.parent;)n=n.parent,n.logger.bindings&&e.push(n.logger.bindings);return e.reverse()}function o0(t,e,n,i){if(Object.defineProperty(t,i,{value:_m(t.level,n)>_m(i,n)?$1:n[Ck][i],writable:!0,enumerable:!0,configurable:!0}),t[i]===$1){if(!e.transmit)return;const l=e.transmit.level||t.level,h=_m(l,n);if(_m(i,n)<h)return}t[i]=qae(t,e,n,i);const o=Hae(t);o.length!==0&&(t[i]=Gae(o,t[i]))}function Gae(t,e){return function(){return e.apply(this,[...t,...arguments])}}function qae(t,e,n,i){return function(o){return function(){const l=e.timestamp(),h=new Array(arguments.length),s=Object.getPrototypeOf&&Object.getPrototypeOf(this)===y2?y2:this;for(var w=0;w<h.length;w++)h[w]=arguments[w];var x=!1;if(e.serialize&&(Tk(h,this._serialize,this.serializers,this._stdErrSerialize),x=!0),e.asObject||e.formatters?o.call(s,...Zae(this,i,h,l,e)):o.apply(s,h),e.transmit){const A=e.transmit.level||t._level,P=_m(A,n),D=_m(i,n);if(D<P)return;Kae(this,{ts:l,methodLevel:i,methodValue:D,transmitValue:n.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:_m(t._level,n)},h,x)}}}(t[Ck][i])}function Zae(t,e,n,i,o){const{level:l,log:h=P=>P}=o.formatters||{},s=n.slice();let w=s[0];const x={};let A=(t._childLevel|0)+1;if(A<1&&(A=1),i&&(x.time=i),l){const P=l(e,t.levels.values[e]);Object.assign(x,P)}else x.level=t.levels.values[e];if(o.asObjectBindingsOnly){if(w!==null&&typeof w=="object")for(;A--&&typeof s[0]=="object";)Object.assign(x,s.shift());return[h(x),...s]}else{if(w!==null&&typeof w=="object"){for(;A--&&typeof s[0]=="object";)Object.assign(x,s.shift());w=s.length?TF(s.shift(),s):void 0}else typeof w=="string"&&(w=TF(s.shift(),s));return w!==void 0&&(x[o.messageKey]=w),[h(x)]}}function Tk(t,e,n,i){for(const o in t)if(i&&t[o]instanceof Error)t[o]=Bf.stdSerializers.err(t[o]);else if(typeof t[o]=="object"&&!Array.isArray(t[o])&&e)for(const l in t[o])e.indexOf(l)>-1&&l in n&&(t[o][l]=n[l](t[o][l]))}function Kae(t,e,n,i=!1){const o=e.send,l=e.ts,h=e.methodLevel,s=e.methodValue,w=e.val,x=t._logEvent.bindings;i||Tk(n,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=l,t._logEvent.messages=n.filter(function(A){return x.indexOf(A)===-1}),t._logEvent.level.label=h,t._logEvent.level.value=s,o(h,t._logEvent,w),t._logEvent=JR(x)}function JR(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function SF(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const n in t)e[n]===void 0&&(e[n]=t[n]);return e}function Yae(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?fW:pW}function $5(){return{}}function W4(t){return t}function $1(){}function fW(){return!1}function pW(){return Date.now()}function Xae(){return Math.round(Date.now()/1e3)}function Jae(){return new Date(Date.now()).toISOString()}function Qae(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}fh.exports.default=Bf;fh.exports.pino=Bf;const ece={level:"info"},PS="custom_context",Ak=1e3*1024;var tce=Object.defineProperty,nce=(t,e,n)=>e in t?tce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fm=(t,e,n)=>nce(t,typeof e!="symbol"?e+"":e,n);let ice=class{constructor(e){fm(this,"nodeValue"),fm(this,"sizeInBytes"),fm(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},IF=class{constructor(e){fm(this,"lengthInNodes"),fm(this,"sizeInBytes"),fm(this,"head"),fm(this,"tail"),fm(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const n=new ice(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const n=e.value;return e=e.next,{done:!1,value:n}}}}};const rce=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n);function PF(t){return typeof t=="string"?t:rce(t)||""}var sce=Object.defineProperty,oce=(t,e,n)=>e in t?sce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,z5=(t,e,n)=>oce(t,typeof e!="symbol"?e+"":e,n);let mW=class{constructor(e,n=Ak){z5(this,"logs"),z5(this,"level"),z5(this,"levelValue"),z5(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=fh.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new IF(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===fh.exports.levels.values.error?console.error(e):n===fh.exports.levels.values.warn?console.warn(e):n===fh.exports.levels.values.debug?console.debug(e):n===fh.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(PF({timestamp:new Date().toISOString(),log:e}));const n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new IF(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const n=this.getLogArray();return n.push(PF({extraMetadata:e})),new Blob(n,{type:"application/json"})}};var ace=Object.defineProperty,cce=(t,e,n)=>e in t?ace(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lce=(t,e,n)=>cce(t,e+"",n);let uce=class{constructor(e,n=Ak){lce(this,"baseChunkLogger"),this.baseChunkLogger=new mW(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const n=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=n,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}};var dce=Object.defineProperty,hce=(t,e,n)=>e in t?dce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fce=(t,e,n)=>hce(t,e+"",n);let pce=class{constructor(e,n=Ak){fce(this,"baseChunkLogger"),this.baseChunkLogger=new mW(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var mce=Object.defineProperty,gce=Object.defineProperties,yce=Object.getOwnPropertyDescriptors,RF=Object.getOwnPropertySymbols,_ce=Object.prototype.hasOwnProperty,wce=Object.prototype.propertyIsEnumerable,OF=(t,e,n)=>e in t?mce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xm=(t,e)=>{for(var n in e||(e={}))_ce.call(e,n)&&OF(t,n,e[n]);if(RF)for(var n of RF(e))wce.call(e,n)&&OF(t,n,e[n]);return t},Em=(t,e)=>gce(t,yce(e));function Sk(t){return Em(xm({},t),{level:(t==null?void 0:t.level)||ece.level})}function bce(t,e,n=PS){return t[n]=e,t}function ul(t,e=PS){return t[e]||""}function vce(t,e,n=PS){const i=ul(t,n);return i.trim()?`${i}/${e}`:e}function dl(t,e,n=PS){const i=vce(t,e,n),o=t.child({context:i});return bce(o,i,n)}function xce(t){var e,n;const i=new uce((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:fh.exports(Em(xm({},t.opts),{level:"trace",browser:Em(xm({},(n=t.opts)==null?void 0:n.browser),{write:o=>i.write(o)})})),chunkLoggerController:i}}function Ece(t){var e,n;const i=new pce((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:fh.exports(Em(xm({},t.opts),{level:"trace",browser:Em(xm({},(n=t.opts)==null?void 0:n.browser),{write:o=>i.write(o)})}),i),chunkLoggerController:i}}function RS(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const n=Em(xm({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?xce(Em(xm({},t),{opts:n})):Ece(Em(xm({},t),{opts:n}))}class Cce{constructor(e){var l;const n=Sk({level:mse}),{logger:i,chunkLoggerController:o}=RS({opts:n});this.logger=dl(i,this.constructor.name),this.chunkLoggerController=o,typeof window<"u"&&((l=this.chunkLoggerController)!=null&&l.downloadLogsBlobInBrowser)&&(window.downloadAppKitLogsBlob||(window.downloadAppKitLogsBlob={}),window.downloadAppKitLogsBlob.sdk=()=>{var h;(h=this.chunkLoggerController)!=null&&h.downloadLogsBlobInBrowser&&this.chunkLoggerController.downloadLogsBlobInBrowser({projectId:e})})}}class gW{constructor({projectId:e,chainId:n,enableLogger:i=!0,onTimeout:o,abortController:l,getActiveCaipNetwork:h,getCaipNetworks:s,enableCloudAuthAccount:w,metadata:x,sdkVersion:A,sdkType:P}){this.openRpcRequests=new Map,this.isInitialized=!1,i&&(this.w3mLogger=new Cce(e)),this.abortController=l,this.getActiveCaipNetwork=h,this.getCaipNetworks=s;const D=this.getRpcUrl(n);this.projectId=e,this.sdkVersion=A,this.sdkType=P,this.metadata=x,this.w3mFrame=new Mae({projectId:e,isAppClient:!0,chainId:n,enableLogger:i,rpcUrl:D,enableCloudAuthAccount:w}),this.onTimeout=o,this.getLoginEmailUsed()&&this.createFrame()}async createFrame(){this.w3mFrame.initFrame(),this.initPromise=new Promise(e=>{this.w3mFrame.events.onFrameEvent(n=>{n.type===Kn.FRAME_READY&&setTimeout(()=>{e()},500)})}),await this.initPromise,await this.syncDappData({metadata:this.metadata,projectId:this.projectId,sdkVersion:this.sdkVersion,sdkType:this.sdkType}),await this.getSmartAccountEnabledNetworks(),this.isInitialized=!0,this.initPromise=void 0}async init(){if(!this.isInitialized){if(this.initPromise){await this.initPromise;return}await this.createFrame()}}getLoginEmailUsed(){return!!Ro.get(Kn.EMAIL_LOGIN_USED_KEY)}getEmail(){return Ro.get(Kn.EMAIL)}getUsername(){return Ro.get(Kn.SOCIAL_USERNAME)}async reload(){var e;try{await this.appEvent({type:Kn.APP_RELOAD})}catch(n){throw(e=this.w3mLogger)==null||e.logger.error({error:n},"Error reloading iframe"),n}}async connectEmail(e){var n;try{Ll.checkIfAllowedToTriggerEmail(),await this.init();const i=await this.appEvent({type:Kn.APP_CONNECT_EMAIL,payload:e});return this.setNewLastEmailLoginTime(),i}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error connecting email"),i}}async connectDevice(){var e;try{return this.appEvent({type:Kn.APP_CONNECT_DEVICE})}catch(n){throw(e=this.w3mLogger)==null||e.logger.error({error:n},"Error connecting device"),n}}async connectOtp(e){var n;try{return this.appEvent({type:Kn.APP_CONNECT_OTP,payload:e})}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error connecting otp"),i}}async isConnected(){var e;try{if(!this.getLoginEmailUsed())return{isConnected:!1};const n=await this.appEvent({type:Kn.APP_IS_CONNECTED});return n!=null&&n.isConnected||this.deleteAuthLoginCache(),n}catch(n){throw this.deleteAuthLoginCache(),(e=this.w3mLogger)==null||e.logger.error({error:n},"Error checking connection"),n}}async getChainId(){var e;try{const n=await this.appEvent({type:Kn.APP_GET_CHAIN_ID});return this.setLastUsedChainId(n.chainId),n}catch(n){throw(e=this.w3mLogger)==null||e.logger.error({error:n},"Error getting chain id"),n}}async getSocialRedirectUri(e){var n;try{return await this.init(),this.appEvent({type:Kn.APP_GET_SOCIAL_REDIRECT_URI,payload:e})}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error getting social redirect uri"),i}}async updateEmail(e){var n;try{const i=await this.appEvent({type:Kn.APP_UPDATE_EMAIL,payload:e});return this.setNewLastEmailLoginTime(),i}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error updating email"),i}}async updateEmailPrimaryOtp(e){var n;try{return this.appEvent({type:Kn.APP_UPDATE_EMAIL_PRIMARY_OTP,payload:e})}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error updating email primary otp"),i}}async updateEmailSecondaryOtp(e){var n;try{const i=await this.appEvent({type:Kn.APP_UPDATE_EMAIL_SECONDARY_OTP,payload:e});return this.setLoginSuccess(i.newEmail),i}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error updating email secondary otp"),i}}async syncTheme(e){var n;try{return this.appEvent({type:Kn.APP_SYNC_THEME,payload:e})}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error syncing theme"),i}}async syncDappData(e){var n;try{return this.appEvent({type:Kn.APP_SYNC_DAPP_DATA,payload:e})}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error syncing dapp data"),i}}async getSmartAccountEnabledNetworks(){var e;try{const n=await this.appEvent({type:Kn.APP_GET_SMART_ACCOUNT_ENABLED_NETWORKS});return this.persistSmartAccountEnabledNetworks(n.smartAccountEnabledNetworks),n}catch(n){throw this.persistSmartAccountEnabledNetworks([]),(e=this.w3mLogger)==null||e.logger.error({error:n},"Error getting smart account enabled networks"),n}}async setPreferredAccount(e){var n;try{return this.appEvent({type:Kn.APP_SET_PREFERRED_ACCOUNT,payload:{type:e}})}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error setting preferred account"),i}}async connect(e){var n,i;if(e!=null&&e.socialUri)try{await this.init();const o=this.getRpcUrl(e.chainId),l=await this.appEvent({type:Kn.APP_CONNECT_SOCIAL,payload:{uri:e.socialUri,preferredAccountType:e.preferredAccountType,chainId:e.chainId,siwxMessage:e.siwxMessage,rpcUrl:o}});return l.userName&&this.setSocialLoginSuccess(l.userName),this.setLoginSuccess(l.email),this.setLastUsedChainId(l.chainId),this.user=l,l}catch(o){throw(n=this.w3mLogger)==null||n.logger.error({error:o},"Error connecting social"),o}else try{const o=(e==null?void 0:e.chainId)||this.getLastUsedChainId()||1,l=await this.getUser({chainId:o,preferredAccountType:e==null?void 0:e.preferredAccountType,siwxMessage:e==null?void 0:e.siwxMessage,rpcUrl:this.getRpcUrl(o)});return this.setLoginSuccess(l.email),this.setLastUsedChainId(l.chainId),this.user=l,l}catch(o){throw(i=this.w3mLogger)==null||i.logger.error({error:o},"Error connecting"),o}}async getUser(e){var n;try{await this.init();const i=(e==null?void 0:e.chainId)||this.getLastUsedChainId()||1,o=await this.appEvent({type:Kn.APP_GET_USER,payload:{...e,chainId:i,rpcUrl:this.getRpcUrl(i)}});return this.user=o,o}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error connecting"),i}}async connectSocial({uri:e,chainId:n,preferredAccountType:i}){var o;try{await this.init();const l=this.getRpcUrl(n),h=await this.appEvent({type:Kn.APP_CONNECT_SOCIAL,payload:{uri:e,chainId:n,rpcUrl:l,preferredAccountType:i}});return h.userName&&this.setSocialLoginSuccess(h.userName),h}catch(l){throw(o=this.w3mLogger)==null||o.logger.error({error:l},"Error connecting social"),l}}async getFarcasterUri(){var e;try{return await this.init(),await this.appEvent({type:Kn.APP_GET_FARCASTER_URI})}catch(n){throw(e=this.w3mLogger)==null||e.logger.error({error:n},"Error getting farcaster uri"),n}}async connectFarcaster(){var e;try{const n=await this.appEvent({type:Kn.APP_CONNECT_FARCASTER});return n.userName&&this.setSocialLoginSuccess(n.userName),n}catch(n){throw(e=this.w3mLogger)==null||e.logger.error({error:n},"Error connecting farcaster"),n}}async switchNetwork({chainId:e}){var n;try{const i=this.getRpcUrl(e),o=await this.appEvent({type:Kn.APP_SWITCH_NETWORK,payload:{chainId:e,rpcUrl:i}});return this.setLastUsedChainId(o.chainId),o}catch(i){throw(n=this.w3mLogger)==null||n.logger.error({error:i},"Error switching network"),i}}async disconnect(){var e;try{return this.deleteAuthLoginCache(),await new Promise(async i=>{const o=setTimeout(()=>{i()},3e3);await this.appEvent({type:Kn.APP_SIGN_OUT}),clearTimeout(o),i()})}catch(n){throw(e=this.w3mLogger)==null||e.logger.error({error:n},"Error disconnecting"),n}}async request(e){var i,o,l,h,s;const n=e;try{if(Gr.GET_CHAIN_ID===e.method)return this.getLastUsedChainId();const w=e.chainNamespace||"eip155",x=(i=this.getActiveCaipNetwork(w))==null?void 0:i.id;n.chainNamespace=w,n.chainId=x,n.rpcUrl=this.getRpcUrl(x),(o=this.rpcRequestHandler)==null||o.call(this,e);const A=await this.appEvent({type:Kn.APP_RPC_REQUEST,payload:n});return(l=this.rpcSuccessHandler)==null||l.call(this,A,n),A}catch(w){throw(h=this.rpcErrorHandler)==null||h.call(this,w,n),(s=this.w3mLogger)==null||s.logger.error({error:w},"Error requesting"),w}}onRpcRequest(e){this.rpcRequestHandler=e}onRpcSuccess(e){this.rpcSuccessHandler=e}onRpcError(e){this.rpcErrorHandler=e}onIsConnected(e){this.w3mFrame.events.onFrameEvent(n=>{n.type===Kn.FRAME_IS_CONNECTED_SUCCESS&&n.payload.isConnected&&e()})}onNotConnected(e){this.w3mFrame.events.onFrameEvent(n=>{n.type===Kn.FRAME_IS_CONNECTED_ERROR&&e(),n.type===Kn.FRAME_IS_CONNECTED_SUCCESS&&!n.payload.isConnected&&e()})}onConnect(e){this.w3mFrame.events.onFrameEvent(n=>{n.type===Kn.FRAME_GET_USER_SUCCESS&&e(n.payload)})}onSocialConnected(e){this.w3mFrame.events.onFrameEvent(n=>{n.type===Kn.FRAME_CONNECT_SOCIAL_SUCCESS&&e(n.payload)})}async getCapabilities(){try{return await this.request({method:"wallet_getCapabilities"})||{}}catch{return{}}}onSetPreferredAccount(e){this.w3mFrame.events.onFrameEvent(n=>{n.type===Kn.FRAME_SET_PREFERRED_ACCOUNT_SUCCESS?e(n.payload):n.type===Kn.FRAME_SET_PREFERRED_ACCOUNT_ERROR&&e({type:Gr.ACCOUNT_TYPES.EOA})})}getAvailableChainIds(){return Object.keys(this.w3mFrame.networks)}async rejectRpcRequests(){var e;try{await Promise.all(Array.from(this.openRpcRequests.values()).map(async({abortController:n,method:i})=>{Gr.SAFE_RPC_METHODS.includes(i)||n.abort(),await this.appEvent({type:Kn.APP_RPC_ABORT})})),this.openRpcRequests.clear()}catch(n){(e=this.w3mLogger)==null||e.logger.error({error:n},"Error aborting RPC request")}}async appEvent(e){let n,i;function o(w){return w.replace("@w3m-app/","")}const l=[Kn.APP_SYNC_DAPP_DATA,Kn.APP_SYNC_THEME,Kn.APP_SET_PREFERRED_ACCOUNT],h=o(e.type);return!this.w3mFrame.iframeIsReady&&!l.includes(e.type)&&(i=setTimeout(()=>{var w;(w=this.onTimeout)==null||w.call(this,"iframe_load_failed"),this.abortController.abort()},2e4)),await this.w3mFrame.frameLoadPromise,clearTimeout(i),[Kn.APP_CONNECT_EMAIL,Kn.APP_CONNECT_DEVICE,Kn.APP_CONNECT_OTP,Kn.APP_CONNECT_SOCIAL,Kn.APP_GET_SOCIAL_REDIRECT_URI].map(o).includes(h)&&(n=setTimeout(()=>{var w;(w=this.onTimeout)==null||w.call(this,"iframe_request_timeout"),this.abortController.abort()},12e4)),new Promise((w,x)=>{var M,z,U;const A=Math.random().toString(36).substring(7);(U=(M=this.w3mLogger)==null?void 0:(z=M.logger).info)==null||U.call(z,{event:e,id:A},"Sending app event"),this.w3mFrame.events.postAppEvent({...e,id:A});const P=new AbortController;if(h==="RPC_REQUEST"){const G=e;this.openRpcRequests.set(A,{...G.payload,abortController:P})}P.signal.addEventListener("abort",()=>{h==="RPC_REQUEST"?x(new Error("Request was aborted")):h!=="GET_FARCASTER_URI"&&x(new Error("Something went wrong"))});const D=(G,ne)=>{var oe,Q,de;G.id===A&&((Q=ne==null?void 0:(oe=ne.logger).info)==null||Q.call(oe,{framEvent:G,id:A},"Received frame response"),this.openRpcRequests.delete(G.id),G.type===`@w3m-frame/${h}_SUCCESS`?(n&&clearTimeout(n),i&&clearTimeout(i),"payload"in G&&w(G.payload),w(void 0)):G.type===`@w3m-frame/${h}_ERROR`&&(n&&clearTimeout(n),i&&clearTimeout(i),"payload"in G&&x(new Error(((de=G.payload)==null?void 0:de.message)||"An error occurred")),x(new Error("An error occurred"))))};this.w3mFrame.events.registerFrameEventHandler(A,G=>D(G,this.w3mLogger),this.abortController.signal)})}setNewLastEmailLoginTime(){Ro.set(Kn.LAST_EMAIL_LOGIN_TIME,Date.now().toString())}setSocialLoginSuccess(e){Ro.set(Kn.SOCIAL_USERNAME,e)}setLoginSuccess(e){e&&Ro.set(Kn.EMAIL,e),Ro.set(Kn.EMAIL_LOGIN_USED_KEY,"true"),Ro.delete(Kn.LAST_EMAIL_LOGIN_TIME)}deleteAuthLoginCache(){Ro.delete(Kn.EMAIL_LOGIN_USED_KEY),Ro.delete(Kn.EMAIL),Ro.delete(Kn.LAST_USED_CHAIN_KEY),Ro.delete(Kn.SOCIAL_USERNAME)}setLastUsedChainId(e){e&&Ro.set(Kn.LAST_USED_CHAIN_KEY,String(e))}getLastUsedChainId(){const e=Ro.get(Kn.LAST_USED_CHAIN_KEY)??void 0,n=Number(e);return isNaN(n)?e:n}persistSmartAccountEnabledNetworks(e){Ro.set(Kn.SMART_ACCOUNT_ENABLED_NETWORKS,e.join(","))}getRpcUrl(e){var l,h;let n=e===void 0?void 0:"eip155";typeof e=="string"&&(e.includes(":")?n=(l=hse.parseCaipNetworkId(e))==null?void 0:l.chainNamespace:Number.isInteger(Number(e))?n="eip155":n="solana");const i=this.getCaipNetworks(n),o=e?i.find(s=>String(s.id)===String(e)||s.caipNetworkId===e):i[0];return(h=o==null?void 0:o.rpcUrls.default.http)==null?void 0:h[0]}}const Tce="1.2.3";let Mc=class QR extends Error{constructor(e,n={}){var h;const i=n.cause instanceof QR?n.cause.details:(h=n.cause)!=null&&h.message?n.cause.message:n.details,o=n.cause instanceof QR&&n.cause.docsPath||n.docsPath,l=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...o?[`Docs: https://abitype.dev${o}`]:[],...i?[`Details: ${i}`]:[],`Version: abitype@${Tce}`].join(`
`);super(l),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiTypeError"}),n.cause&&(this.cause=n.cause),this.details=i,this.docsPath=o,this.metaMessages=n.metaMessages,this.shortMessage=e}};function Qf(t,e){const n=t.exec(e);return n==null?void 0:n.groups}const yW=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,_W=/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,wW=/^\(.+?\).*?$/,kF=/^tuple(?<array>(\[(\d*)\])*)$/;function e8(t){let e=t.type;if(kF.test(t.type)&&"components"in t){e="(";const n=t.components.length;for(let o=0;o<n;o++){const l=t.components[o];e+=e8(l),o<n-1&&(e+=", ")}const i=Qf(kF,t.type);return e+=`)${(i==null?void 0:i.array)||""}`,e8({...t,type:e})}return"indexed"in t&&t.indexed&&(e=`${e} indexed`),t.name?`${e} ${t.name}`:e}function ax(t){let e="";const n=t.length;for(let i=0;i<n;i++){const o=t[i];e+=e8(o),i!==n-1&&(e+=", ")}return e}function Ace(t){var e;return t.type==="function"?`function ${t.name}(${ax(t.inputs)})${t.stateMutability&&t.stateMutability!=="nonpayable"?` ${t.stateMutability}`:""}${(e=t.outputs)!=null&&e.length?` returns (${ax(t.outputs)})`:""}`:t.type==="event"?`event ${t.name}(${ax(t.inputs)})`:t.type==="error"?`error ${t.name}(${ax(t.inputs)})`:t.type==="constructor"?`constructor(${ax(t.inputs)})${t.stateMutability==="payable"?" payable":""}`:t.type==="fallback"?`fallback() external${t.stateMutability==="payable"?" payable":""}`:"receive() external payable"}const bW=/^error (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;function Sce(t){return bW.test(t)}function Ice(t){return Qf(bW,t)}const vW=/^event (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)$/;function Pce(t){return vW.test(t)}function Rce(t){return Qf(vW,t)}const xW=/^function (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*)\((?<parameters>.*?)\)(?: (?<scope>external|public{1}))?(?: (?<stateMutability>pure|view|nonpayable|payable{1}))?(?: returns\s?\((?<returns>.*?)\))?$/;function Oce(t){return xW.test(t)}function kce(t){return Qf(xW,t)}const EW=/^struct (?<name>[a-zA-Z$_][a-zA-Z0-9$_]*) \{(?<properties>.*?)\}$/;function CW(t){return EW.test(t)}function Dce(t){return Qf(EW,t)}const TW=/^constructor\((?<parameters>.*?)\)(?:\s(?<stateMutability>payable{1}))?$/;function Nce(t){return TW.test(t)}function Mce(t){return Qf(TW,t)}const AW=/^fallback\(\) external(?:\s(?<stateMutability>payable{1}))?$/;function Lce(t){return AW.test(t)}function Bce(t){return Qf(AW,t)}const Fce=/^receive\(\) external payable$/;function $ce(t){return Fce.test(t)}const J9e=new Set(["memory","indexed","storage","calldata"]),zce=new Set(["indexed"]),t8=new Set(["calldata","memory","storage"]);class Q9e extends Mc{constructor({signature:e}){super("Failed to parse ABI item.",{details:`parseAbiItem(${JSON.stringify(e,null,2)})`,docsPath:"/api/human#parseabiitem-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiItemError"})}}class Uce extends Mc{constructor({type:e}){super("Unknown type.",{metaMessages:[`Type "${e}" is not a valid ABI type. Perhaps you forgot to include a struct signature?`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownTypeError"})}}class jce extends Mc{constructor({type:e}){super("Unknown type.",{metaMessages:[`Type "${e}" is not a valid ABI type.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSolidityTypeError"})}}class eLe extends Mc{constructor({param:e}){super("Failed to parse ABI parameter.",{details:`parseAbiParameter(${JSON.stringify(e,null,2)})`,docsPath:"/api/human#parseabiparameter-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiParameterError"})}}class tLe extends Mc{constructor({params:e}){super("Failed to parse ABI parameters.",{details:`parseAbiParameters(${JSON.stringify(e,null,2)})`,docsPath:"/api/human#parseabiparameters-1"}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiParametersError"})}}class Vce extends Mc{constructor({param:e}){super("Invalid ABI parameter.",{details:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParameterError"})}}class Wce extends Mc{constructor({param:e,name:n}){super("Invalid ABI parameter.",{details:e,metaMessages:[`"${n}" is a protected Solidity keyword. More info: https://docs.soliditylang.org/en/latest/cheatsheet.html`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SolidityProtectedKeywordError"})}}class Hce extends Mc{constructor({param:e,type:n,modifier:i}){super("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${i}" not allowed${n?` in "${n}" type`:""}.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidModifierError"})}}class Gce extends Mc{constructor({param:e,type:n,modifier:i}){super("Invalid ABI parameter.",{details:e,metaMessages:[`Modifier "${i}" not allowed${n?` in "${n}" type`:""}.`,`Data location can only be specified for array, struct, or mapping types, but "${i}" was given.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidFunctionModifierError"})}}class qce extends Mc{constructor({abiParameter:e}){super("Invalid ABI parameter.",{details:JSON.stringify(e,null,2),metaMessages:["ABI parameter type is invalid."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidAbiTypeParameterError"})}}class Ow extends Mc{constructor({signature:e,type:n}){super(`Invalid ${n} signature.`,{details:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidSignatureError"})}}class Zce extends Mc{constructor({signature:e}){super("Unknown signature.",{details:e}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UnknownSignatureError"})}}class Kce extends Mc{constructor({signature:e}){super("Invalid struct signature.",{details:e,metaMessages:["No properties exist."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidStructSignatureError"})}}class Yce extends Mc{constructor({type:e}){super("Circular reference detected.",{metaMessages:[`Struct "${e}" is a circular reference.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"CircularReferenceError"})}}class Xce extends Mc{constructor({current:e,depth:n}){super("Unbalanced parentheses.",{metaMessages:[`"${e.trim()}" has too many ${n>0?"opening":"closing"} parentheses.`],details:`Depth "${n}"`}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InvalidParenthesisError"})}}function Jce(t,e,n){let i="";if(n)for(const o of Object.entries(n)){if(!o)continue;let l="";for(const h of o[1])l+=`[${h.type}${h.name?`:${h.name}`:""}]`;i+=`(${o[0]}{${l}})`}return e?`${e}:${t}${i}`:`${t}${i}`}const H4=new Map([["address",{type:"address"}],["bool",{type:"bool"}],["bytes",{type:"bytes"}],["bytes32",{type:"bytes32"}],["int",{type:"int256"}],["int256",{type:"int256"}],["string",{type:"string"}],["uint",{type:"uint256"}],["uint8",{type:"uint8"}],["uint16",{type:"uint16"}],["uint24",{type:"uint24"}],["uint32",{type:"uint32"}],["uint64",{type:"uint64"}],["uint96",{type:"uint96"}],["uint112",{type:"uint112"}],["uint160",{type:"uint160"}],["uint192",{type:"uint192"}],["uint256",{type:"uint256"}],["address owner",{type:"address",name:"owner"}],["address to",{type:"address",name:"to"}],["bool approved",{type:"bool",name:"approved"}],["bytes _data",{type:"bytes",name:"_data"}],["bytes data",{type:"bytes",name:"data"}],["bytes signature",{type:"bytes",name:"signature"}],["bytes32 hash",{type:"bytes32",name:"hash"}],["bytes32 r",{type:"bytes32",name:"r"}],["bytes32 root",{type:"bytes32",name:"root"}],["bytes32 s",{type:"bytes32",name:"s"}],["string name",{type:"string",name:"name"}],["string symbol",{type:"string",name:"symbol"}],["string tokenURI",{type:"string",name:"tokenURI"}],["uint tokenId",{type:"uint256",name:"tokenId"}],["uint8 v",{type:"uint8",name:"v"}],["uint256 balance",{type:"uint256",name:"balance"}],["uint256 tokenId",{type:"uint256",name:"tokenId"}],["uint256 value",{type:"uint256",name:"value"}],["event:address indexed from",{type:"address",name:"from",indexed:!0}],["event:address indexed to",{type:"address",name:"to",indexed:!0}],["event:uint indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}],["event:uint256 indexed tokenId",{type:"uint256",name:"tokenId",indexed:!0}]]);function Qce(t,e={}){if(Oce(t))return ele(t,e);if(Pce(t))return tle(t,e);if(Sce(t))return nle(t,e);if(Nce(t))return ile(t,e);if(Lce(t))return rle(t);if($ce(t))return{type:"receive",stateMutability:"payable"};throw new Zce({signature:t})}function ele(t,e={}){const n=kce(t);if(!n)throw new Ow({signature:t,type:"function"});const i=dd(n.parameters),o=[],l=i.length;for(let s=0;s<l;s++)o.push(q0(i[s],{modifiers:t8,structs:e,type:"function"}));const h=[];if(n.returns){const s=dd(n.returns),w=s.length;for(let x=0;x<w;x++)h.push(q0(s[x],{modifiers:t8,structs:e,type:"function"}))}return{name:n.name,type:"function",stateMutability:n.stateMutability??"nonpayable",inputs:o,outputs:h}}function tle(t,e={}){const n=Rce(t);if(!n)throw new Ow({signature:t,type:"event"});const i=dd(n.parameters),o=[],l=i.length;for(let h=0;h<l;h++)o.push(q0(i[h],{modifiers:zce,structs:e,type:"event"}));return{name:n.name,type:"event",inputs:o}}function nle(t,e={}){const n=Ice(t);if(!n)throw new Ow({signature:t,type:"error"});const i=dd(n.parameters),o=[],l=i.length;for(let h=0;h<l;h++)o.push(q0(i[h],{structs:e,type:"error"}));return{name:n.name,type:"error",inputs:o}}function ile(t,e={}){const n=Mce(t);if(!n)throw new Ow({signature:t,type:"constructor"});const i=dd(n.parameters),o=[],l=i.length;for(let h=0;h<l;h++)o.push(q0(i[h],{structs:e,type:"constructor"}));return{type:"constructor",stateMutability:n.stateMutability??"nonpayable",inputs:o}}function rle(t){const e=Bce(t);if(!e)throw new Ow({signature:t,type:"fallback"});return{type:"fallback",stateMutability:e.stateMutability??"nonpayable"}}const sle=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*(?:\spayable)?)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,ole=/^\((?<type>.+?)\)(?<array>(?:\[\d*?\])+?)?(?:\s(?<modifier>calldata|indexed|memory|storage{1}))?(?:\s(?<name>[a-zA-Z$_][a-zA-Z0-9$_]*))?$/,ale=/^u?int$/;function q0(t,e){var P,D;const n=Jce(t,e==null?void 0:e.type,e==null?void 0:e.structs);if(H4.has(n))return H4.get(n);const i=wW.test(t),o=Qf(i?ole:sle,t);if(!o)throw new Vce({param:t});if(o.name&&lle(o.name))throw new Wce({param:t,name:o.name});const l=o.name?{name:o.name}:{},h=o.modifier==="indexed"?{indexed:!0}:{},s=(e==null?void 0:e.structs)??{};let w,x={};if(i){w="tuple";const M=dd(o.type),z=[],U=M.length;for(let G=0;G<U;G++)z.push(q0(M[G],{structs:s}));x={components:z}}else if(o.type in s)w="tuple",x={components:s[o.type]};else if(ale.test(o.type))w=`${o.type}256`;else if(o.type==="address payable")w="address";else if(w=o.type,(e==null?void 0:e.type)!=="struct"&&!SW(w))throw new jce({type:w});if(o.modifier){if(!((D=(P=e==null?void 0:e.modifiers)==null?void 0:P.has)!=null&&D.call(P,o.modifier)))throw new Hce({param:t,type:e==null?void 0:e.type,modifier:o.modifier});if(t8.has(o.modifier)&&!ule(w,!!o.array))throw new Gce({param:t,type:e==null?void 0:e.type,modifier:o.modifier})}const A={type:`${w}${o.array??""}`,...l,...h,...x};return H4.set(n,A),A}function dd(t,e=[],n="",i=0){const o=t.trim().length;for(let l=0;l<o;l++){const h=t[l],s=t.slice(l+1);switch(h){case",":return i===0?dd(s,[...e,n.trim()]):dd(s,e,`${n}${h}`,i);case"(":return dd(s,e,`${n}${h}`,i+1);case")":return dd(s,e,`${n}${h}`,i-1);default:return dd(s,e,`${n}${h}`,i)}}if(n==="")return e;if(i!==0)throw new Xce({current:n,depth:i});return e.push(n.trim()),e}function SW(t){return t==="address"||t==="bool"||t==="function"||t==="string"||yW.test(t)||_W.test(t)}const cle=/^(?:after|alias|anonymous|apply|auto|byte|calldata|case|catch|constant|copyof|default|defined|error|event|external|false|final|function|immutable|implements|in|indexed|inline|internal|let|mapping|match|memory|mutable|null|of|override|partial|private|promise|public|pure|reference|relocatable|return|returns|sizeof|static|storage|struct|super|supports|switch|this|true|try|typedef|typeof|var|view|virtual)$/;function lle(t){return t==="address"||t==="bool"||t==="function"||t==="string"||t==="tuple"||yW.test(t)||_W.test(t)||cle.test(t)}function ule(t,e){return e||t==="bytes"||t==="string"||t==="tuple"}function dle(t){const e={},n=t.length;for(let h=0;h<n;h++){const s=t[h];if(!CW(s))continue;const w=Dce(s);if(!w)throw new Ow({signature:s,type:"struct"});const x=w.properties.split(";"),A=[],P=x.length;for(let D=0;D<P;D++){const z=x[D].trim();if(!z)continue;const U=q0(z,{type:"struct"});A.push(U)}if(!A.length)throw new Kce({signature:s});e[w.name]=A}const i={},o=Object.entries(e),l=o.length;for(let h=0;h<l;h++){const[s,w]=o[h];i[s]=IW(w,e)}return i}const hle=/^(?<type>[a-zA-Z$_][a-zA-Z0-9$_]*)(?<array>(?:\[\d*?\])+?)?$/;function IW(t=[],e={},n=new Set){const i=[],o=t.length;for(let l=0;l<o;l++){const h=t[l];if(wW.test(h.type))i.push(h);else{const w=Qf(hle,h.type);if(!(w!=null&&w.type))throw new qce({abiParameter:h});const{array:x,type:A}=w;if(A in e){if(n.has(A))throw new Yce({type:A});i.push({...h,type:`tuple${x??""}`,components:IW(e[A],e,new Set([...n,A]))})}else if(SW(A))i.push(h);else throw new Uce({type:A})}}return i}function PW(t){const e=dle(t),n=[],i=t.length;for(let o=0;o<i;o++){const l=t[o];CW(l)||n.push(Qce(l,e))}return n}function is(t,e,n){const i=t[e.name];if(typeof i=="function")return i;const o=t[n];return typeof o=="function"?o:l=>e(t,l)}function km(t,{includeName:e=!1}={}){if(t.type!=="function"&&t.type!=="event"&&t.type!=="error")throw new Ale(t.type);return`${t.name}(${OS(t.inputs,{includeName:e})})`}function OS(t,{includeName:e=!1}={}){return t?t.map(n=>fle(n,{includeName:e})).join(e?", ":","):""}function fle(t,{includeName:e}){return t.type.startsWith("tuple")?`(${OS(t.components,{includeName:e})})${t.type.slice(5)}`:t.type+(e&&t.name?` ${t.name}`:"")}function Dm(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Mo(t){return Dm(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const RW="2.46.2";let x1={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${RW}`};function nLe(t){x1=t}let ln=class n8 extends Error{constructor(e,n={}){var s;const i=(()=>{var w;return n.cause instanceof n8?n.cause.details:(w=n.cause)!=null&&w.message?n.cause.message:n.details})(),o=n.cause instanceof n8&&n.cause.docsPath||n.docsPath,l=(s=x1.getDocsUrl)==null?void 0:s.call(x1,{...n,docsPath:o}),h=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...l?[`Docs: ${l}`]:[],...i?[`Details: ${i}`]:[],...x1.version?[`Version: ${x1.version}`]:[]].join(`
`);super(h,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=o,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=RW}walk(e){return OW(this,e)}};function OW(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?OW(t.cause,e):e?null:t}class ple extends ln{constructor({docsPath:e}){super(["A constructor was not found on the ABI.","Make sure you are using the correct ABI and that the constructor exists on it."].join(`
`),{docsPath:e,name:"AbiConstructorNotFoundError"})}}class DF extends ln{constructor({docsPath:e}){super(["Constructor arguments were provided (`args`), but a constructor parameters (`inputs`) were not found on the ABI.","Make sure you are using the correct ABI, and that the `inputs` attribute on the constructor exists."].join(`
`),{docsPath:e,name:"AbiConstructorParamsNotFoundError"})}}class iLe extends ln{constructor({data:e,size:n}){super([`Data size of ${n} bytes is invalid.`,"Size must be in increments of 32 bytes (size % 32 === 0)."].join(`
`),{metaMessages:[`Data: ${e} (${n} bytes)`],name:"AbiDecodingDataSizeInvalidError"})}}class kW extends ln{constructor({data:e,params:n,size:i}){super([`Data size of ${i} bytes is too small for given parameters.`].join(`
`),{metaMessages:[`Params: (${OS(n,{includeName:!0})})`,`Data:   ${e} (${i} bytes)`],name:"AbiDecodingDataSizeTooSmallError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=e,this.params=n,this.size=i}}class Ik extends ln{constructor(){super('Cannot decode zero data ("0x") with ABI parameters.',{name:"AbiDecodingZeroDataError"})}}class mle extends ln{constructor({expectedLength:e,givenLength:n,type:i}){super([`ABI encoding array length mismatch for type ${i}.`,`Expected length: ${e}`,`Given length: ${n}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class gle extends ln{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${Mo(n)}) does not match expected size (bytes${e}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class yle extends ln{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${e}`,`Given length (values): ${n}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class rLe extends ln{constructor(e,{docsPath:n}){super([`Arguments (\`args\`) were provided to "${e}", but "${e}" on the ABI does not contain any parameters (\`inputs\`).`,"Cannot encode error result without knowing what the parameter types are.","Make sure you are using the correct ABI and that the inputs exist on it."].join(`
`),{docsPath:n,name:"AbiErrorInputsNotFoundError"})}}class sLe extends ln{constructor(e,{docsPath:n}={}){super([`Error ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the error exists on it."].join(`
`),{docsPath:n,name:"AbiErrorNotFoundError"})}}class DW extends ln{constructor(e,{docsPath:n}){super([`Encoded error signature "${e}" not found on ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://4byte.sourcify.dev/?q=${e}.`].join(`
`),{docsPath:n,name:"AbiErrorSignatureNotFoundError"}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.signature=e}}class _le extends ln{constructor({docsPath:e}){super("Cannot extract event signature from empty topics.",{docsPath:e,name:"AbiEventSignatureEmptyTopicsError"})}}class wle extends ln{constructor(e,{docsPath:n}){super([`Encoded event signature "${e}" not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it.",`You can look up the signature here: https://4byte.sourcify.dev/?q=${e}.`].join(`
`),{docsPath:n,name:"AbiEventSignatureNotFoundError"})}}class oLe extends ln{constructor(e,{docsPath:n}={}){super([`Event ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the event exists on it."].join(`
`),{docsPath:n,name:"AbiEventNotFoundError"})}}class pA extends ln{constructor(e,{docsPath:n}={}){super([`Function ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionNotFoundError"})}}class ble extends ln{constructor(e,{docsPath:n}){super([`Function "${e}" does not contain any \`outputs\` on ABI.`,"Cannot decode function result without knowing what the parameter types are.","Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionOutputsNotFoundError"})}}class aLe extends ln{constructor(e,{docsPath:n}){super([`Encoded function signature "${e}" not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it.",`You can look up the signature here: https://4byte.sourcify.dev/?q=${e}.`].join(`
`),{docsPath:n,name:"AbiFunctionSignatureNotFoundError"})}}class vle extends ln{constructor(e,n){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${e.type}\` in \`${km(e.abiItem)}\`, and`,`\`${n.type}\` in \`${km(n.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class cLe extends ln{constructor({expectedSize:e,givenSize:n}){super(`Expected bytes${e}, got bytes${n}.`,{name:"BytesSizeMismatchError"})}}class NF extends ln{constructor({abiItem:e,data:n,params:i,size:o}){super([`Data size of ${o} bytes is too small for non-indexed event parameters.`].join(`
`),{metaMessages:[`Params: (${OS(i,{includeName:!0})})`,`Data:   ${n} (${o} bytes)`],name:"DecodeLogDataMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"params",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=e,this.data=n,this.params=i,this.size=o}}class xle extends ln{constructor({abiItem:e,param:n}){super([`Expected a topic for indexed event parameter${n.name?` "${n.name}"`:""} on event "${km(e,{includeName:!0})}".`].join(`
`),{name:"DecodeLogTopicsMismatch"}),Object.defineProperty(this,"abiItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abiItem=e}}class Ele extends ln{constructor(e,{docsPath:n}){super([`Type "${e}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiEncodingType"})}}class Cle extends ln{constructor(e,{docsPath:n}){super([`Type "${e}" is not a valid decoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiDecodingType"})}}class Tle extends ln{constructor(e){super([`Value "${e}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}}class Ale extends ln{constructor(e){super([`"${e}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}class lLe extends ln{constructor(e){super(`Type "${e}" is not supported for packed encoding.`,{name:"UnsupportedPackedAbiType"})}}let NW=class extends ln{constructor({offset:e,position:n,size:i}){super(`Slice ${n==="start"?"starting":"ending"} at offset "${e}" is out-of-bounds (size: ${i}).`,{name:"SliceOffsetOutOfBoundsError"})}},MW=class extends ln{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}};class MF extends ln{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} is expected to be ${n} ${i} long, but is ${e} ${i} long.`,{name:"InvalidBytesLengthError"})}}function kw(t,{dir:e,size:n=32}={}){return typeof t=="string"?Cm(t,{dir:e,size:n}):Sle(t,{dir:e,size:n})}function Cm(t,{dir:e,size:n=32}={}){if(n===null)return t;const i=t.replace("0x","");if(i.length>n*2)throw new MW({size:Math.ceil(i.length/2),targetSize:n,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function Sle(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new MW({size:t.length,targetSize:n,type:"bytes"});const i=new Uint8Array(n);for(let o=0;o<n;o++){const l=e==="right";i[l?o:n-o-1]=t[l?o:t.length-o-1]}return i}let Pk=class extends ln{constructor({max:e,min:n,signed:i,size:o,value:l}){super(`Number "${l}" is not in safe ${o?`${o*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}},Ile=class extends ln{constructor(e){super(`Bytes value "${e}" is not a valid boolean. The bytes array must contain a single byte of either a 0 or 1 value.`,{name:"InvalidBytesBooleanError"})}};class Ple extends ln{constructor(e){super(`Hex value "${e}" is not a valid boolean. The hex value must be "0x0" (false) or "0x1" (true).`,{name:"InvalidHexBooleanError"})}}let pLe=class extends ln{constructor(e){super(`Hex value "${e}" is an odd length (${e.length}). It must be an even length.`,{name:"InvalidHexValueError"})}},Rle=class extends ln{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}};function L0(t,{dir:e="left"}={}){let n=typeof t=="string"?t.replace("0x",""):t,i=0;for(let o=0;o<n.length-1&&n[e==="left"?o:n.length-o-1].toString()==="0";o++)i++;return n=e==="left"?n.slice(i):n.slice(0,n.length-i),typeof t=="string"?(n.length===1&&e==="right"&&(n=`${n}0`),`0x${n.length%2===1?`0${n}`:n}`):n}function Pu(t,{size:e}){if(Mo(t)>e)throw new Rle({givenSize:Mo(t),maxSize:e})}function yLe(t,e){const n=typeof e=="string"?{to:e}:e,i=n.to;return i==="number"?Nm(t,n):i==="bigint"?Z0(t,n):i==="string"?LW(t,n):i==="boolean"?Ole(t,n):bd(t,n)}function Z0(t,e={}){const{signed:n}=e;e.size&&Pu(t,{size:e.size});const i=BigInt(t);if(!n)return i;const o=(t.length-2)/2,l=(1n<<BigInt(o)*8n-1n)-1n;return i<=l?i:i-BigInt(`0x${"f".padStart(o*2,"f")}`)-1n}function Ole(t,e={}){let n=t;if(e.size&&(Pu(n,{size:e.size}),n=L0(n)),L0(n)==="0x00")return!1;if(L0(n)==="0x01")return!0;throw new Ple(n)}function Nm(t,e={}){const n=Z0(t,e),i=Number(n);if(!Number.isSafeInteger(i))throw new Pk({max:`${Number.MAX_SAFE_INTEGER}`,min:`${Number.MIN_SAFE_INTEGER}`,signed:e.signed,size:e.size,value:`${n}n`});return i}function LW(t,e={}){let n=bd(t);return e.size&&(Pu(n,{size:e.size}),n=L0(n,{dir:"right"})),new TextDecoder().decode(n)}const kle=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function K0(t,e={}){return typeof t=="number"||typeof t=="bigint"?ar(t,e):typeof t=="string"?kS(t,e):typeof t=="boolean"?BW(t,e):kc(t,e)}function BW(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(Pu(n,{size:e.size}),kw(n,{size:e.size})):n}function kc(t,e={}){let n="";for(let o=0;o<t.length;o++)n+=kle[t[o]];const i=`0x${n}`;return typeof e.size=="number"?(Pu(i,{size:e.size}),kw(i,{dir:"right",size:e.size})):i}function ar(t,e={}){const{signed:n,size:i}=e,o=BigInt(t);let l;i?n?l=(1n<<BigInt(i)*8n-1n)-1n:l=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(l=BigInt(Number.MAX_SAFE_INTEGER));const h=typeof l=="bigint"&&n?-l-1n:0;if(l&&o>l||o<h){const w=typeof t=="bigint"?"n":"";throw new Pk({max:l?`${l}${w}`:void 0,min:`${h}${w}`,signed:n,size:i,value:`${t}${w}`})}const s=`0x${(n&&o<0?(1n<<BigInt(i*8))+BigInt(o):o).toString(16)}`;return i?kw(s,{size:i}):s}const Dle=new TextEncoder;function kS(t,e={}){const n=Dle.encode(t);return kc(n,e)}const Nle=new TextEncoder;function DS(t,e={}){return typeof t=="number"||typeof t=="bigint"?Lle(t,e):typeof t=="boolean"?Mle(t,e):Dm(t)?bd(t,e):FW(t,e)}function Mle(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(Pu(n,{size:e.size}),kw(n,{size:e.size})):n}const uf={zero:48,nine:57,A:65,F:70,a:97,f:102};function LF(t){if(t>=uf.zero&&t<=uf.nine)return t-uf.zero;if(t>=uf.A&&t<=uf.F)return t-(uf.A-10);if(t>=uf.a&&t<=uf.f)return t-(uf.a-10)}function bd(t,e={}){let n=t;e.size&&(Pu(n,{size:e.size}),n=kw(n,{dir:"right",size:e.size}));let i=n.slice(2);i.length%2&&(i=`0${i}`);const o=i.length/2,l=new Uint8Array(o);for(let h=0,s=0;h<o;h++){const w=LF(i.charCodeAt(s++)),x=LF(i.charCodeAt(s++));if(w===void 0||x===void 0)throw new ln(`Invalid byte sequence ("${i[s-2]}${i[s-1]}" in "${i}").`);l[h]=w*16+x}return l}function Lle(t,e){const n=ar(t,e);return bd(n)}function FW(t,e={}){const n=Nle.encode(t);return typeof e.size=="number"?(Pu(n,{size:e.size}),kw(n,{dir:"right",size:e.size})):n}const U5=BigInt(2**32-1),BF=BigInt(32);function Ble(t,e=!1){return e?{h:Number(t&U5),l:Number(t>>BF&U5)}:{h:Number(t>>BF&U5)|0,l:Number(t&U5)|0}}function $W(t,e=!1){const n=t.length;let i=new Uint32Array(n),o=new Uint32Array(n);for(let l=0;l<n;l++){const{h,l:s}=Ble(t[l],e);[i[l],o[l]]=[h,s]}return[i,o]}const FF=(t,e,n)=>t>>>n,$F=(t,e,n)=>t<<32-n|e>>>n,c1=(t,e,n)=>t>>>n|e<<32-n,l1=(t,e,n)=>t<<32-n|e>>>n,j5=(t,e,n)=>t<<64-n|e>>>n-32,V5=(t,e,n)=>t>>>n-32|e<<64-n,Fle=(t,e,n)=>t<<n|e>>>32-n,$le=(t,e,n)=>e<<n|t>>>32-n,zle=(t,e,n)=>e<<n-32|t>>>64-n,Ule=(t,e,n)=>t<<n-32|e>>>64-n;function df(t,e,n,i){const o=(e>>>0)+(i>>>0);return{h:t+n+(o/2**32|0)|0,l:o|0}}const jle=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Vle=(t,e,n,i)=>e+n+i+(t/2**32|0)|0,Wle=(t,e,n,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0),Hle=(t,e,n,i,o)=>e+n+i+o+(t/2**32|0)|0,Gle=(t,e,n,i,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0)+(o>>>0),qle=(t,e,n,i,o,l)=>e+n+i+o+l+(t/2**32|0)|0,u1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Zle(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function _2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Mm(t,...e){if(!Zle(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Kle(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");_2(t.outputLen),_2(t.blockLen)}function iw(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zW(t,e){Mm(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Yle(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Lm(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function G4(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ih(t,e){return t<<32-e|t>>>e}function _Le(t,e){return t<<e|t>>>32-e>>>0}const Xle=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Jle(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Qle(t){for(let e=0;e<t.length;e++)t[e]=Jle(t[e]);return t}const zF=Xle?t=>t:Qle,UW=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",eue=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function wLe(t){if(Mm(t),UW)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=eue[t[n]];return e}const hf={_0:48,_9:57,A:65,F:70,a:97,f:102};function UF(t){if(t>=hf._0&&t<=hf._9)return t-hf._0;if(t>=hf.A&&t<=hf.F)return t-(hf.A-10);if(t>=hf.a&&t<=hf.f)return t-(hf.a-10)}function bLe(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(UW)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let o=0,l=0;o<n;o++,l+=2){const h=UF(t.charCodeAt(l)),s=UF(t.charCodeAt(l+1));if(h===void 0||s===void 0){const w=t[l]+t[l+1];throw new Error('hex string expected, got non-hex character "'+w+'" at index '+l)}i[o]=h*16+s}return i}function tue(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function NS(t){return typeof t=="string"&&(t=tue(t)),Mm(t),t}function nue(...t){let e=0;for(let i=0;i<t.length;i++){const o=t[i];Mm(o),e+=o.length}const n=new Uint8Array(e);for(let i=0,o=0;i<t.length;i++){const l=t[i];n.set(l,o),o+=l.length}return n}class Rk{}function MS(t){const e=i=>t().update(NS(i)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function iue(t=32){if(u1&&typeof u1.getRandomValues=="function")return u1.getRandomValues(new Uint8Array(t));if(u1&&typeof u1.randomBytes=="function")return Uint8Array.from(u1.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const rue=BigInt(0),cx=BigInt(1),sue=BigInt(2),oue=BigInt(7),aue=BigInt(256),cue=BigInt(113),jW=[],VW=[],WW=[];for(let t=0,e=cx,n=1,i=0;t<24;t++){[n,i]=[i,(2*n+3*i)%5],jW.push(2*(5*i+n)),VW.push((t+1)*(t+2)/2%64);let o=rue;for(let l=0;l<7;l++)e=(e<<cx^(e>>oue)*cue)%aue,e&sue&&(o^=cx<<(cx<<BigInt(l))-cx);WW.push(o)}const HW=$W(WW,!0),lue=HW[0],uue=HW[1],jF=(t,e,n)=>n>32?zle(t,e,n):Fle(t,e,n),VF=(t,e,n)=>n>32?Ule(t,e,n):$le(t,e,n);function due(t,e=24){const n=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let h=0;h<10;h++)n[h]=t[h]^t[h+10]^t[h+20]^t[h+30]^t[h+40];for(let h=0;h<10;h+=2){const s=(h+8)%10,w=(h+2)%10,x=n[w],A=n[w+1],P=jF(x,A,1)^n[s],D=VF(x,A,1)^n[s+1];for(let M=0;M<50;M+=10)t[h+M]^=P,t[h+M+1]^=D}let o=t[2],l=t[3];for(let h=0;h<24;h++){const s=VW[h],w=jF(o,l,s),x=VF(o,l,s),A=jW[h];o=t[A],l=t[A+1],t[A]=w,t[A+1]=x}for(let h=0;h<50;h+=10){for(let s=0;s<10;s++)n[s]=t[h+s];for(let s=0;s<10;s++)t[h+s]^=~n[(s+2)%10]&n[(s+4)%10]}t[0]^=lue[i],t[1]^=uue[i]}Lm(n)}class Ok extends Rk{constructor(e,n,i,o=!1,l=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=i,this.enableXOF=o,this.rounds=l,_2(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Yle(this.state)}clone(){return this._cloneInto()}keccak(){zF(this.state32),due(this.state32,this.rounds),zF(this.state32),this.posOut=0,this.pos=0}update(e){iw(this),e=NS(e),Mm(e);const{blockLen:n,state:i}=this,o=e.length;for(let l=0;l<o;){const h=Math.min(n-this.pos,o-l);for(let s=0;s<h;s++)i[this.pos++]^=e[l++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:i,blockLen:o}=this;e[i]^=n,n&128&&i===o-1&&this.keccak(),e[o-1]^=128,this.keccak()}writeInto(e){iw(this,!1),Mm(e),this.finish();const n=this.state,{blockLen:i}=this;for(let o=0,l=e.length;o<l;){this.posOut>=i&&this.keccak();const h=Math.min(i-this.posOut,l-o);e.set(n.subarray(this.posOut,this.posOut+h),o),this.posOut+=h,o+=h}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return _2(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(zW(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Lm(this.state)}_cloneInto(e){const{blockLen:n,suffix:i,outputLen:o,rounds:l,enableXOF:h}=this;return e||(e=new Ok(n,i,o,h,l)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=l,e.suffix=i,e.outputLen=o,e.enableXOF=h,e.destroyed=this.destroyed,e}}const hue=(t,e,n)=>MS(()=>new Ok(e,t,n)),GW=hue(1,136,256/8);function _E(t,e){const n=e||"hex",i=GW(Dm(t,{strict:!1})?DS(t):t);return n==="bytes"?i:K0(i)}const fue=t=>_E(DS(t));function pue(t){return fue(t)}function mue(t){let e=!0,n="",i=0,o="",l=!1;for(let h=0;h<t.length;h++){const s=t[h];if(["(",")",","].includes(s)&&(e=!0),s==="("&&i++,s===")"&&i--,!!e){if(i===0){if(s===" "&&["event","function",""].includes(o))o="";else if(o+=s,s===")"){l=!0;break}continue}if(s===" "){t[h-1]!==","&&n!==","&&n!==",("&&(n="",e=!1);continue}o+=s,n+=s}}if(!l)throw new ln("Unable to normalize signature.");return o}const gue=t=>{const e=typeof t=="string"?t:Ace(t);return mue(e)};function qW(t){return pue(gue(t))}const kk=qW;let Y0=class extends ln{constructor({address:e}){super(`Address "${e}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}},wE=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}};const q4=new wE(8192);function bE(t,e){if(q4.has(`${t}.${e}`))return q4.get(`${t}.${e}`);const n=e?`${e}${t.toLowerCase()}`:t.substring(2).toLowerCase(),i=_E(FW(n),"bytes"),o=(e?n.substring(`${e}0x`.length):n).split("");for(let h=0;h<40;h+=2)i[h>>1]>>4>=8&&o[h]&&(o[h]=o[h].toUpperCase()),(i[h>>1]&15)>=8&&o[h+1]&&(o[h+1]=o[h+1].toUpperCase());const l=`0x${o.join("")}`;return q4.set(`${t}.${e}`,l),l}function E0(t,e){if(!Th(t,{strict:!1}))throw new Y0({address:t});return bE(t,e)}const yue=/^0x[a-fA-F0-9]{40}$/,Z4=new wE(8192);function Th(t,e){const{strict:n=!0}=e??{},i=`${t}.${n}`;if(Z4.has(i))return Z4.get(i);const o=yue.test(t)?t.toLowerCase()===t?!0:n?bE(t)===t:!0:!1;return Z4.set(i,o),o}function Bm(t){return typeof t[0]=="string"?LS(t):_ue(t)}function _ue(t){let e=0;for(const o of t)e+=o.length;const n=new Uint8Array(e);let i=0;for(const o of t)n.set(o,i),i+=o.length;return n}function LS(t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function mA(t,e,n,{strict:i}={}){return Dm(t,{strict:!1})?wue(t,e,n,{strict:i}):YW(t,e,n,{strict:i})}function ZW(t,e){if(typeof e=="number"&&e>0&&e>Mo(t)-1)throw new NW({offset:e,position:"start",size:Mo(t)})}function KW(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Mo(t)!==n-e)throw new NW({offset:n,position:"end",size:Mo(t)})}function YW(t,e,n,{strict:i}={}){ZW(t,e);const o=t.slice(e,n);return i&&KW(o,e,n),o}function wue(t,e,n,{strict:i}={}){ZW(t,e);const o=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return i&&KW(o,e,n),o}const ELe=/^(.*)\[([0-9]*)\]$/,CLe=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,bue=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function XW(t,e){if(t.length!==e.length)throw new yle({expectedLength:t.length,givenLength:e.length});const n=vue({params:t,values:e}),i=Nk(n);return i.length===0?"0x":i}function vue({params:t,values:e}){const n=[];for(let i=0;i<t.length;i++)n.push(Dk({param:t[i],value:e[i]}));return n}function Dk({param:t,value:e}){const n=Mk(t.type);if(n){const[i,o]=n;return Eue(e,{length:i,param:{...t,type:o}})}if(t.type==="tuple")return Iue(e,{param:t});if(t.type==="address")return xue(e);if(t.type==="bool")return Tue(e);if(t.type.startsWith("uint")||t.type.startsWith("int")){const i=t.type.startsWith("int"),[,,o="256"]=bue.exec(t.type)??[];return Aue(e,{signed:i,size:Number(o)})}if(t.type.startsWith("bytes"))return Cue(e,{param:t});if(t.type==="string")return Sue(e);throw new Ele(t.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function Nk(t){let e=0;for(let l=0;l<t.length;l++){const{dynamic:h,encoded:s}=t[l];h?e+=32:e+=Mo(s)}const n=[],i=[];let o=0;for(let l=0;l<t.length;l++){const{dynamic:h,encoded:s}=t[l];h?(n.push(ar(e+o,{size:32})),i.push(s),o+=Mo(s)):n.push(s)}return Bm([...n,...i])}function xue(t){if(!Th(t))throw new Y0({address:t});return{dynamic:!1,encoded:Cm(t.toLowerCase())}}function Eue(t,{length:e,param:n}){const i=e===null;if(!Array.isArray(t))throw new Tle(t);if(!i&&t.length!==e)throw new mle({expectedLength:e,givenLength:t.length,type:`${n.type}[${e}]`});let o=!1;const l=[];for(let h=0;h<t.length;h++){const s=Dk({param:n,value:t[h]});s.dynamic&&(o=!0),l.push(s)}if(i||o){const h=Nk(l);if(i){const s=ar(l.length,{size:32});return{dynamic:!0,encoded:l.length>0?Bm([s,h]):s}}if(o)return{dynamic:!0,encoded:h}}return{dynamic:!1,encoded:Bm(l.map(({encoded:h})=>h))}}function Cue(t,{param:e}){const[,n]=e.type.split("bytes"),i=Mo(t);if(!n){let o=t;return i%32!==0&&(o=Cm(o,{dir:"right",size:Math.ceil((t.length-2)/2/32)*32})),{dynamic:!0,encoded:Bm([Cm(ar(i,{size:32})),o])}}if(i!==Number.parseInt(n,10))throw new gle({expectedSize:Number.parseInt(n,10),value:t});return{dynamic:!1,encoded:Cm(t,{dir:"right"})}}function Tue(t){if(typeof t!="boolean")throw new ln(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:Cm(BW(t))}}function Aue(t,{signed:e,size:n=256}){if(typeof n=="number"){const i=2n**(BigInt(n)-(e?1n:0n))-1n,o=e?-i-1n:0n;if(t>i||t<o)throw new Pk({max:i.toString(),min:o.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:ar(t,{size:32,signed:e})}}function Sue(t){const e=kS(t),n=Math.ceil(Mo(e)/32),i=[];for(let o=0;o<n;o++)i.push(Cm(mA(e,o*32,(o+1)*32),{dir:"right"}));return{dynamic:!0,encoded:Bm([Cm(ar(Mo(e),{size:32})),...i])}}function Iue(t,{param:e}){let n=!1;const i=[];for(let o=0;o<e.components.length;o++){const l=e.components[o],h=Array.isArray(t)?o:l.name,s=Dk({param:l,value:t[h]});i.push(s),s.dynamic&&(n=!0)}return{dynamic:n,encoded:n?Nk(i):Bm(i.map(({encoded:o})=>o))}}function Mk(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}const Lk=t=>mA(qW(t),0,4);function Bk(t){const{abi:e,args:n=[],name:i}=t,o=Dm(i,{strict:!1}),l=e.filter(s=>o?s.type==="function"?Lk(s)===i:s.type==="event"?kk(s)===i:!1:"name"in s&&s.name===i);if(l.length===0)return;if(l.length===1)return l[0];let h;for(const s of l){if(!("inputs"in s))continue;if(!n||n.length===0){if(!s.inputs||s.inputs.length===0)return s;continue}if(!s.inputs||s.inputs.length===0||s.inputs.length!==n.length)continue;if(n.every((x,A)=>{const P="inputs"in s&&s.inputs[A];return P?i8(x,P):!1})){if(h&&"inputs"in h&&h.inputs){const x=JW(s.inputs,h.inputs,n);if(x)throw new vle({abiItem:s,type:x[0]},{abiItem:h,type:x[1]})}h=s}}return h||l[0]}function i8(t,e){const n=typeof t,i=e.type;switch(i){case"address":return Th(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return i==="tuple"&&"components"in e?Object.values(e.components).every((o,l)=>n==="object"&&i8(Object.values(t)[l],o)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(i)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(i)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(i)?Array.isArray(t)&&t.every(o=>i8(o,{...e,type:i.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function JW(t,e,n){for(const i in t){const o=t[i],l=e[i];if(o.type==="tuple"&&l.type==="tuple"&&"components"in o&&"components"in l)return JW(o.components,l.components,n[i]);const h=[o.type,l.type];if(h.includes("address")&&h.includes("bytes20")?!0:h.includes("address")&&h.includes("string")?Th(n[i],{strict:!1}):h.includes("address")&&h.includes("bytes")?Th(n[i],{strict:!1}):!1)return h}}function Pue(t,{method:e}){var i,o;const n={};return t.transport.type==="fallback"&&((o=(i=t.transport).onResponse)==null||o.call(i,({method:l,response:h,status:s,transport:w})=>{s==="success"&&e===l&&(n[h]=w.request)})),l=>n[l]||t.request}function Tu(t){return typeof t=="string"?{address:t,type:"json-rpc"}:t}const WF="/docs/contract/encodeFunctionData";function Rue(t){const{abi:e,args:n,functionName:i}=t;let o=e[0];if(i){const l=Bk({abi:e,args:n,name:i});if(!l)throw new pA(i,{docsPath:WF});o=l}if(o.type!=="function")throw new pA(void 0,{docsPath:WF});return{abi:[o],functionName:Lk(km(o))}}function Fk(t){const{args:e}=t,{abi:n,functionName:i}=(()=>{var s;return t.abi.length===1&&((s=t.functionName)!=null&&s.startsWith("0x"))?t:Rue(t)})(),o=n[0],l=i,h="inputs"in o&&o.inputs?XW(o.inputs,e??[]):void 0;return LS([l,h??"0x"])}const Oue={1:"An `assert` condition failed.",17:"Arithmetic operation resulted in underflow or overflow.",18:"Division or modulo by zero (e.g. `5 / 0` or `23 % 0`).",33:"Attempted to convert to an invalid type.",34:"Attempted to access a storage byte array that is incorrectly encoded.",49:"Performed `.pop()` on an empty array",50:"Array index is out of bounds.",65:"Allocated too much memory or created an array which is too large.",81:"Attempted to call a zero-initialized variable of internal function type."},kue={inputs:[{name:"message",type:"string"}],name:"Error",type:"error"},Due={inputs:[{name:"reason",type:"uint256"}],name:"Panic",type:"error"};class HF extends ln{constructor({offset:e}){super(`Offset \`${e}\` cannot be negative.`,{name:"NegativeOffsetError"})}}class QW extends ln{constructor({length:e,position:n}){super(`Position \`${n}\` is out of bounds (\`0 < position < ${e}\`).`,{name:"PositionOutOfBoundsError"})}}class Nue extends ln{constructor({count:e,limit:n}){super(`Recursive read limit of \`${n}\` exceeded (recursive read count: \`${e}\`).`,{name:"RecursiveReadLimitExceededError"})}}const Mue={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new Nue({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(t){if(t<0||t>this.bytes.length-1)throw new QW({length:this.bytes.length,position:t})},decrementPosition(t){if(t<0)throw new HF({offset:t});const e=this.position-t;this.assertPosition(e),this.position=e},getReadCount(t){return this.positionReadCount.get(t||this.position)||0},incrementPosition(t){if(t<0)throw new HF({offset:t});const e=this.position+t;this.assertPosition(e),this.position=e},inspectByte(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectBytes(t,e){const n=e??this.position;return this.assertPosition(n+t-1),this.bytes.subarray(n,n+t)},inspectUint8(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectUint16(t){const e=t??this.position;return this.assertPosition(e+1),this.dataView.getUint16(e)},inspectUint24(t){const e=t??this.position;return this.assertPosition(e+2),(this.dataView.getUint16(e)<<8)+this.dataView.getUint8(e+2)},inspectUint32(t){const e=t??this.position;return this.assertPosition(e+3),this.dataView.getUint32(e)},pushByte(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushBytes(t){this.assertPosition(this.position+t.length-1),this.bytes.set(t,this.position),this.position+=t.length},pushUint8(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushUint16(t){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,t),this.position+=2},pushUint24(t){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,t>>8),this.dataView.setUint8(this.position+2,t&255),this.position+=3},pushUint32(t){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,t),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const t=this.inspectByte();return this.position++,t},readBytes(t,e){this.assertReadLimit(),this._touch();const n=this.inspectBytes(t);return this.position+=e??t,n},readUint8(){this.assertReadLimit(),this._touch();const t=this.inspectUint8();return this.position+=1,t},readUint16(){this.assertReadLimit(),this._touch();const t=this.inspectUint16();return this.position+=2,t},readUint24(){this.assertReadLimit(),this._touch();const t=this.inspectUint24();return this.position+=3,t},readUint32(){this.assertReadLimit(),this._touch();const t=this.inspectUint32();return this.position+=4,t},get remaining(){return this.bytes.length-this.position},setPosition(t){const e=this.position;return this.assertPosition(t),this.position=t,()=>this.position=e},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const t=this.getReadCount();this.positionReadCount.set(this.position,t+1),t>0&&this.recursiveReadCount++}};function $k(t,{recursiveReadLimit:e=8192}={}){const n=Object.create(Mue);return n.bytes=t,n.dataView=new DataView(t.buffer??t,t.byteOffset,t.byteLength),n.positionReadCount=new Map,n.recursiveReadLimit=e,n}function TLe(t,e){const n=typeof e=="string"?{to:e}:e,i=n.to;return i==="number"?_h(t,n):i==="bigint"?eH(t,n):i==="boolean"?tH(t,n):i==="string"?nH(t,n):kc(t,n)}function eH(t,e={}){typeof e.size<"u"&&Pu(t,{size:e.size});const n=kc(t,e);return Z0(n,e)}function tH(t,e={}){let n=t;if(typeof e.size<"u"&&(Pu(n,{size:e.size}),n=L0(n)),n.length>1||n[0]>1)throw new Ile(n);return!!n[0]}function _h(t,e={}){typeof e.size<"u"&&Pu(t,{size:e.size});const n=kc(t,e);return Nm(n,e)}function nH(t,e={}){let n=t;return typeof e.size<"u"&&(Pu(n,{size:e.size}),n=L0(n,{dir:"right"})),new TextDecoder().decode(n)}function BS(t,e){const n=typeof e=="string"?bd(e):e,i=$k(n);if(Mo(n)===0&&t.length>0)throw new Ik;if(Mo(e)&&Mo(e)<32)throw new kW({data:typeof e=="string"?e:kc(e),params:t,size:Mo(e)});let o=0;const l=[];for(let h=0;h<t.length;++h){const s=t[h];i.setPosition(o);const[w,x]=z1(i,s,{staticPosition:0});o+=x,l.push(w)}return l}function z1(t,e,{staticPosition:n}){const i=Mk(e.type);if(i){const[o,l]=i;return Bue(t,{...e,type:l},{length:o,staticPosition:n})}if(e.type==="tuple")return Uue(t,e,{staticPosition:n});if(e.type==="address")return Lue(t);if(e.type==="bool")return Fue(t);if(e.type.startsWith("bytes"))return $ue(t,e,{staticPosition:n});if(e.type.startsWith("uint")||e.type.startsWith("int"))return zue(t,e);if(e.type==="string")return jue(t,{staticPosition:n});throw new Cle(e.type,{docsPath:"/docs/contract/decodeAbiParameters"})}const GF=32,r8=32;function Lue(t){const e=t.readBytes(32);return[bE(kc(YW(e,-20))),32]}function Bue(t,e,{length:n,staticPosition:i}){if(!n){const h=_h(t.readBytes(r8)),s=i+h,w=s+GF;t.setPosition(s);const x=_h(t.readBytes(GF)),A=w2(e);let P=0;const D=[];for(let M=0;M<x;++M){t.setPosition(w+(A?M*32:P));const[z,U]=z1(t,e,{staticPosition:w});P+=U,D.push(z)}return t.setPosition(i+32),[D,32]}if(w2(e)){const h=_h(t.readBytes(r8)),s=i+h,w=[];for(let x=0;x<n;++x){t.setPosition(s+x*32);const[A]=z1(t,e,{staticPosition:s});w.push(A)}return t.setPosition(i+32),[w,32]}let o=0;const l=[];for(let h=0;h<n;++h){const[s,w]=z1(t,e,{staticPosition:i+o});o+=w,l.push(s)}return[l,o]}function Fue(t){return[tH(t.readBytes(32),{size:32}),32]}function $ue(t,e,{staticPosition:n}){const[i,o]=e.type.split("bytes");if(!o){const h=_h(t.readBytes(32));t.setPosition(n+h);const s=_h(t.readBytes(32));if(s===0)return t.setPosition(n+32),["0x",32];const w=t.readBytes(s);return t.setPosition(n+32),[kc(w),32]}return[kc(t.readBytes(Number.parseInt(o,10),32)),32]}function zue(t,e){const n=e.type.startsWith("int"),i=Number.parseInt(e.type.split("int")[1]||"256",10),o=t.readBytes(32);return[i>48?eH(o,{signed:n}):_h(o,{signed:n}),32]}function Uue(t,e,{staticPosition:n}){const i=e.components.length===0||e.components.some(({name:h})=>!h),o=i?[]:{};let l=0;if(w2(e)){const h=_h(t.readBytes(r8)),s=n+h;for(let w=0;w<e.components.length;++w){const x=e.components[w];t.setPosition(s+l);const[A,P]=z1(t,x,{staticPosition:s});l+=P,o[i?w:x==null?void 0:x.name]=A}return t.setPosition(n+32),[o,32]}for(let h=0;h<e.components.length;++h){const s=e.components[h],[w,x]=z1(t,s,{staticPosition:n});o[i?h:s==null?void 0:s.name]=w,l+=x}return[o,l]}function jue(t,{staticPosition:e}){const n=_h(t.readBytes(32)),i=e+n;t.setPosition(i);const o=_h(t.readBytes(32));if(o===0)return t.setPosition(e+32),["",32];const l=t.readBytes(o,32),h=nH(L0(l));return t.setPosition(e+32),[h,32]}function w2(t){var i;const{type:e}=t;if(e==="string"||e==="bytes"||e.endsWith("[]"))return!0;if(e==="tuple")return(i=t.components)==null?void 0:i.some(w2);const n=Mk(t.type);return!!(n&&w2({...t,type:n[1]}))}function Vue(t){const{abi:e,data:n}=t,i=mA(n,0,4);if(i==="0x")throw new Ik;const l=[...e||[],kue,Due].find(h=>h.type==="error"&&i===Lk(km(h)));if(!l)throw new DW(i,{docsPath:"/docs/contract/decodeErrorResult"});return{abiItem:l,args:"inputs"in l&&l.inputs&&l.inputs.length>0?BS(l.inputs,mA(n,4)):void 0,errorName:l.name}}const Ul=(t,e,n)=>JSON.stringify(t,(i,o)=>{const l=typeof o=="bigint"?o.toString():o;return typeof e=="function"?e(i,l):l},n);function iH({abiItem:t,args:e,includeFunctionName:n=!0,includeName:i=!1}){if("name"in t&&"inputs"in t&&t.inputs)return`${n?t.name:""}(${t.inputs.map((o,l)=>`${i&&o.name?`${o.name}: `:""}${typeof e[l]=="object"?Ul(e[l]):e[l]}`).join(", ")})`}const Wue={gwei:9,wei:18},Hue={ether:-9,wei:9},ALe={ether:-18,gwei:-9};function vE(t,e){let n=t.toString();const i=n.startsWith("-");i&&(n=n.slice(1)),n=n.padStart(e,"0");let[o,l]=[n.slice(0,n.length-e),n.slice(n.length-e)];return l=l.replace(/(0+)$/,""),`${i?"-":""}${o||"0"}${l?`.${l}`:""}`}function zk(t,e="wei"){return vE(t,Wue[e])}function sl(t,e="wei"){return vE(t,Hue[e])}class Gue extends ln{constructor({address:e}){super(`State for account "${e}" is set multiple times.`,{name:"AccountStateConflictError"})}}class que extends ln{constructor(){super("state and stateDiff are set on the same account.",{name:"StateAssignmentConflictError"})}}function qF(t){return t.reduce((e,{slot:n,value:i})=>`${e}        ${n}: ${i}
`,"")}function Zue(t){return t.reduce((e,{address:n,...i})=>{let o=`${e}    ${n}:
`;return i.nonce&&(o+=`      nonce: ${i.nonce}
`),i.balance&&(o+=`      balance: ${i.balance}
`),i.code&&(o+=`      code: ${i.code}
`),i.state&&(o+=`      state:
`,o+=qF(i.state)),i.stateDiff&&(o+=`      stateDiff:
`,o+=qF(i.stateDiff)),o},`  State Override:
`).slice(0,-1)}function xE(t){const e=Object.entries(t).map(([i,o])=>o===void 0||o===!1?null:[i,o]).filter(Boolean),n=e.reduce((i,[o])=>Math.max(i,o.length),0);return e.map(([i,o])=>`  ${`${i}:`.padEnd(n+1)}  ${o}`).join(`
`)}class SLe extends ln{constructor(){super(["Cannot specify both a `gasPrice` and a `maxFeePerGas`/`maxPriorityFeePerGas`.","Use `maxFeePerGas`/`maxPriorityFeePerGas` for EIP-1559 compatible networks, and `gasPrice` for others."].join(`
`),{name:"FeeConflictError"})}}class ILe extends ln{constructor({v:e}){super(`Invalid \`v\` value "${e}". Expected 27 or 28.`,{name:"InvalidLegacyVError"})}}class Kue extends ln{constructor({transaction:e}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",xE(e),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}}class PLe extends ln{constructor({serializedType:e}){super(`Serialized transaction type "${e}" is invalid.`,{name:"InvalidSerializedTransactionType"}),Object.defineProperty(this,"serializedType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.serializedType=e}}class RLe extends ln{constructor({attributes:e,serializedTransaction:n,type:i}){const o=Object.entries(e).map(([l,h])=>typeof h>"u"?l:void 0).filter(Boolean);super(`Invalid serialized transaction of type "${i}" was provided.`,{metaMessages:[`Serialized Transaction: "${n}"`,o.length>0?`Missing Attributes: ${o.join(", ")}`:""].filter(Boolean),name:"InvalidSerializedTransactionError"}),Object.defineProperty(this,"serializedTransaction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.serializedTransaction=n,this.type=i}}class OLe extends ln{constructor({storageKey:e}){super(`Size for storage key "${e}" is invalid. Expected 32 bytes. Got ${Math.floor((e.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}}class Yue extends ln{constructor(e,{account:n,docsPath:i,chain:o,data:l,gas:h,gasPrice:s,maxFeePerGas:w,maxPriorityFeePerGas:x,nonce:A,to:P,value:D}){var z;const M=xE({chain:o&&`${o==null?void 0:o.name} (id: ${o==null?void 0:o.id})`,from:n==null?void 0:n.address,to:P,value:typeof D<"u"&&`${zk(D)} ${((z=o==null?void 0:o.nativeCurrency)==null?void 0:z.symbol)||"ETH"}`,data:l,gas:h,gasPrice:typeof s<"u"&&`${sl(s)} gwei`,maxFeePerGas:typeof w<"u"&&`${sl(w)} gwei`,maxPriorityFeePerGas:typeof x<"u"&&`${sl(x)} gwei`,nonce:A});super(e.shortMessage,{cause:e,docsPath:i,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Request Arguments:",M].filter(Boolean),name:"TransactionExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}}class rH extends ln{constructor({blockHash:e,blockNumber:n,blockTag:i,hash:o,index:l}){let h="Transaction";i&&l!==void 0&&(h=`Transaction at block time "${i}" at index "${l}"`),e&&l!==void 0&&(h=`Transaction at block hash "${e}" at index "${l}"`),n&&l!==void 0&&(h=`Transaction at block number "${n}" at index "${l}"`),o&&(h=`Transaction with hash "${o}"`),super(`${h} could not be found.`,{name:"TransactionNotFoundError"})}}class sH extends ln{constructor({hash:e}){super(`Transaction receipt with hash "${e}" could not be found. The Transaction may not be processed on a block yet.`,{name:"TransactionReceiptNotFoundError"})}}class kLe extends ln{constructor({receipt:e}){super(`Transaction with hash "${e.transactionHash}" reverted.`,{metaMessages:['The receipt marked the transaction as "reverted". This could mean that the function on the contract you are trying to call threw an error.'," ","You can attempt to extract the revert reason by:","- calling the `simulateContract` or `simulateCalls` Action with the `abi` and `functionName` of the contract","- using the `call` Action with raw `data`"],name:"TransactionReceiptRevertedError"}),Object.defineProperty(this,"receipt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.receipt=e}}class Xue extends ln{constructor({hash:e}){super(`Timed out while waiting for transaction with hash "${e}" to be confirmed.`,{name:"WaitForTransactionReceiptTimeoutError"})}}const Jue=t=>t,EE=t=>t;class Que extends ln{constructor(e,{account:n,docsPath:i,chain:o,data:l,gas:h,gasPrice:s,maxFeePerGas:w,maxPriorityFeePerGas:x,nonce:A,to:P,value:D,stateOverride:M}){var G;const z=n?Tu(n):void 0;let U=xE({from:z==null?void 0:z.address,to:P,value:typeof D<"u"&&`${zk(D)} ${((G=o==null?void 0:o.nativeCurrency)==null?void 0:G.symbol)||"ETH"}`,data:l,gas:h,gasPrice:typeof s<"u"&&`${sl(s)} gwei`,maxFeePerGas:typeof w<"u"&&`${sl(w)} gwei`,maxPriorityFeePerGas:typeof x<"u"&&`${sl(x)} gwei`,nonce:A});M&&(U+=`
${Zue(M)}`),super(e.shortMessage,{cause:e,docsPath:i,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Raw Call Arguments:",U].filter(Boolean),name:"CallExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}}class ede extends ln{constructor(e,{abi:n,args:i,contractAddress:o,docsPath:l,functionName:h,sender:s}){const w=Bk({abi:n,args:i,name:h}),x=w?iH({abiItem:w,args:i,includeFunctionName:!1,includeName:!1}):void 0,A=w?km(w,{includeName:!0}):void 0,P=xE({address:o&&Jue(o),function:A,args:x&&x!=="()"&&`${[...Array((h==null?void 0:h.length)??0).keys()].map(()=>" ").join("")}${x}`,sender:s});super(e.shortMessage||`An unknown error occurred while executing the contract function "${h}".`,{cause:e,docsPath:l,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],P&&"Contract Call:",P].filter(Boolean),name:"ContractFunctionExecutionError"}),Object.defineProperty(this,"abi",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"contractAddress",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formattedArgs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"functionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.abi=n,this.args=i,this.cause=e,this.contractAddress=o,this.functionName=h,this.sender=s}}class tde extends ln{constructor({abi:e,data:n,functionName:i,message:o}){let l,h,s,w;if(n&&n!=="0x")try{h=Vue({abi:e,data:n});const{abiItem:A,errorName:P,args:D}=h;if(P==="Error")w=D[0];else if(P==="Panic"){const[M]=D;w=Oue[M]}else{const M=A?km(A,{includeName:!0}):void 0,z=A&&D?iH({abiItem:A,args:D,includeFunctionName:!1,includeName:!1}):void 0;s=[M?`Error: ${M}`:"",z&&z!=="()"?`       ${[...Array((P==null?void 0:P.length)??0).keys()].map(()=>" ").join("")}${z}`:""]}}catch(A){l=A}else o&&(w=o);let x;l instanceof DW&&(x=l.signature,s=[`Unable to decode signature "${x}" as it was not found on the provided ABI.`,"Make sure you are using the correct ABI and that the error exists on it.",`You can look up the decoded signature here: https://4byte.sourcify.dev/?q=${x}.`]),super(w&&w!=="execution reverted"||x?[`The contract function "${i}" reverted with the following ${x?"signature":"reason"}:`,w||x].join(`
`):`The contract function "${i}" reverted.`,{cause:l,metaMessages:s,name:"ContractFunctionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"raw",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reason",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=h,this.raw=n,this.reason=w,this.signature=x}}class nde extends ln{constructor({functionName:e}){super(`The contract function "${e}" returned no data ("0x").`,{metaMessages:["This could be due to any of the following:",`  - The contract does not have the function "${e}",`,"  - The parameters passed to the contract function may be invalid, or","  - The address is not a contract."],name:"ContractFunctionZeroDataError"})}}class ide extends ln{constructor({factory:e}){super(`Deployment for counterfactual contract call failed${e?` for factory "${e}".`:""}`,{metaMessages:["Please ensure:","- The `factory` is a valid contract deployment factory (ie. Create2 Factory, ERC-4337 Factory, etc).","- The `factoryData` is a valid encoded function call for contract deployment function on the factory."],name:"CounterfactualDeploymentFailedError"})}}class oH extends ln{constructor({data:e,message:n}){super(n||"",{name:"RawContractError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=e}}class Fx extends ln{constructor({body:e,cause:n,details:i,headers:o,status:l,url:h}){super("HTTP request failed.",{cause:n,details:i,metaMessages:[l&&`Status: ${l}`,`URL: ${EE(h)}`,e&&`Request body: ${Ul(e)}`].filter(Boolean),name:"HttpRequestError"}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.body=e,this.headers=o,this.status=l,this.url=h}}class DLe extends ln{constructor({body:e,cause:n,details:i,url:o}){super("WebSocket request failed.",{cause:n,details:i,metaMessages:[`URL: ${EE(o)}`,e&&`Request body: ${Ul(e)}`].filter(Boolean),name:"WebSocketRequestError"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=o}}class Uk extends ln{constructor({body:e,error:n,url:i}){super("RPC Request failed.",{cause:n,details:n.message,metaMessages:[`URL: ${EE(i)}`,`Request body: ${Ul(e)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=n.code,this.data=n.data,this.url=i}}class NLe extends ln{constructor({url:e}={}){super("The socket has been closed.",{metaMessages:[e&&`URL: ${EE(e)}`].filter(Boolean),name:"SocketClosedError"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=e}}class ZF extends ln{constructor({body:e,url:n}){super("The request took too long to respond.",{details:"The request timed out.",metaMessages:[`URL: ${EE(n)}`,`Request body: ${Ul(e)}`],name:"TimeoutError"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=n}}const rde=-1;class hl extends ln{constructor(e,{code:n,docsPath:i,metaMessages:o,name:l,shortMessage:h}){super(h,{cause:e,docsPath:i,metaMessages:o||(e==null?void 0:e.metaMessages),name:l||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=l||e.name,this.code=e instanceof Uk?e.code:n??rde}}class fl extends hl{constructor(e,n){super(e,n),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=n.data}}class b2 extends hl{constructor(e){super(e,{code:b2.code,name:"ParseRpcError",shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."})}}Object.defineProperty(b2,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class v2 extends hl{constructor(e){super(e,{code:v2.code,name:"InvalidRequestRpcError",shortMessage:"JSON is not a valid request object."})}}Object.defineProperty(v2,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class x2 extends hl{constructor(e,{method:n}={}){super(e,{code:x2.code,name:"MethodNotFoundRpcError",shortMessage:`The method${n?` "${n}"`:""} does not exist / is not available.`})}}Object.defineProperty(x2,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class E2 extends hl{constructor(e){super(e,{code:E2.code,name:"InvalidParamsRpcError",shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(E2,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class X0 extends hl{constructor(e){super(e,{code:X0.code,name:"InternalRpcError",shortMessage:"An internal error was received."})}}Object.defineProperty(X0,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class rw extends hl{constructor(e){super(e,{code:rw.code,name:"InvalidInputRpcError",shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(rw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class C2 extends hl{constructor(e){super(e,{code:C2.code,name:"ResourceNotFoundRpcError",shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}}Object.defineProperty(C2,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class Tm extends hl{constructor(e){super(e,{code:Tm.code,name:"ResourceUnavailableRpcError",shortMessage:"Requested resource not available."})}}Object.defineProperty(Tm,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class sw extends hl{constructor(e){super(e,{code:sw.code,name:"TransactionRejectedRpcError",shortMessage:"Transaction creation failed."})}}Object.defineProperty(sw,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class C0 extends hl{constructor(e,{method:n}={}){super(e,{code:C0.code,name:"MethodNotSupportedRpcError",shortMessage:`Method${n?` "${n}"`:""} is not supported.`})}}Object.defineProperty(C0,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class ow extends hl{constructor(e){super(e,{code:ow.code,name:"LimitExceededRpcError",shortMessage:"Request exceeds defined limit."})}}Object.defineProperty(ow,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class T2 extends hl{constructor(e){super(e,{code:T2.code,name:"JsonRpcVersionUnsupportedError",shortMessage:"Version of JSON-RPC protocol is not supported."})}}Object.defineProperty(T2,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class to extends fl{constructor(e){super(e,{code:to.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(to,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class A2 extends fl{constructor(e){super(e,{code:A2.code,name:"UnauthorizedProviderError",shortMessage:"The requested method and/or account has not been authorized by the user."})}}Object.defineProperty(A2,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class S2 extends fl{constructor(e,{method:n}={}){super(e,{code:S2.code,name:"UnsupportedProviderMethodError",shortMessage:`The Provider does not support the requested method${n?` " ${n}"`:""}.`})}}Object.defineProperty(S2,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class I2 extends fl{constructor(e){super(e,{code:I2.code,name:"ProviderDisconnectedError",shortMessage:"The Provider is disconnected from all chains."})}}Object.defineProperty(I2,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class P2 extends fl{constructor(e){super(e,{code:P2.code,name:"ChainDisconnectedError",shortMessage:"The Provider is not connected to the requested chain."})}}Object.defineProperty(P2,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class Ah extends fl{constructor(e){super(e,{code:Ah.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(Ah,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});class R2 extends fl{constructor(e){super(e,{code:R2.code,name:"UnsupportedNonOptionalCapabilityError",shortMessage:"This Wallet does not support a capability that was not marked as optional."})}}Object.defineProperty(R2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});class O2 extends fl{constructor(e){super(e,{code:O2.code,name:"UnsupportedChainIdError",shortMessage:"This Wallet does not support the requested chain ID."})}}Object.defineProperty(O2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});class k2 extends fl{constructor(e){super(e,{code:k2.code,name:"DuplicateIdError",shortMessage:"There is already a bundle submitted with this ID."})}}Object.defineProperty(k2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});class D2 extends fl{constructor(e){super(e,{code:D2.code,name:"UnknownBundleIdError",shortMessage:"This bundle id is unknown / has not been submitted"})}}Object.defineProperty(D2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});class N2 extends fl{constructor(e){super(e,{code:N2.code,name:"BundleTooLargeError",shortMessage:"The call bundle is too large for the Wallet to process."})}}Object.defineProperty(N2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});class M2 extends fl{constructor(e){super(e,{code:M2.code,name:"AtomicReadyWalletRejectedUpgradeError",shortMessage:"The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."})}}Object.defineProperty(M2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});class L2 extends fl{constructor(e){super(e,{code:L2.code,name:"AtomicityNotSupportedError",shortMessage:"The wallet does not support atomic execution but the request requires it."})}}Object.defineProperty(L2,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});class aw extends fl{constructor(e){super(e,{code:aw.code,name:"WalletConnectSessionSettlementError",shortMessage:"WalletConnect session settlement failed."})}}Object.defineProperty(aw,"code",{enumerable:!0,configurable:!0,writable:!0,value:7e3});class sde extends hl{constructor(e){super(e,{name:"UnknownRpcError",shortMessage:"An unknown RPC error occurred."})}}const ode=3;function ade(t,{abi:e,address:n,args:i,docsPath:o,functionName:l,sender:h}){const s=t instanceof oH?t:t instanceof ln?t.walk(z=>"data"in z)||t.walk():{},{code:w,data:x,details:A,message:P,shortMessage:D}=s,M=t instanceof Ik?new nde({functionName:l}):[ode,X0.code].includes(w)&&(x||A||P||D)||w===rw.code&&A==="execution reverted"&&x?new tde({abi:e,data:typeof x=="object"?x.data:x,functionName:l,message:s instanceof Uk?A:D??P}):t;return new ede(M,{abi:e,args:i,contractAddress:n,docsPath:o,functionName:l,sender:h})}function cde(t){const e=_E(`0x${t.substring(4)}`).substring(26);return bE(`0x${e}`)}const lde="modulepreload",ude=function(t){return"/"+t},KF={},Un=function(e,n,i){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),s=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));o=Promise.allSettled(n.map(w=>{if(w=ude(w),w in KF)return;KF[w]=!0;const x=w.endsWith(".css"),A=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${A}`))return;const P=document.createElement("link");if(P.rel=x?"stylesheet":lde,x||(P.as="script"),P.crossOrigin="",P.href=w,s&&P.setAttribute("nonce",s),document.head.appendChild(P),x)return new Promise((D,M)=>{P.addEventListener("load",D),P.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${w}`)))})}))}function l(h){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=h,window.dispatchEvent(s),!s.defaultPrevented)throw h}return o.then(h=>{for(const s of h||[])s.status==="rejected"&&l(s.reason);return e().catch(l)})};async function dde({hash:t,signature:e}){const n=Dm(t)?t:K0(t),{secp256k1:i}=await Un(async()=>{const{secp256k1:h}=await Promise.resolve().then(()=>Tfe);return{secp256k1:h}},void 0);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:x,s:A,v:P,yParity:D}=e,M=Number(D??P),z=YF(M);return new i.Signature(Z0(x),Z0(A)).addRecoveryBit(z)}const h=Dm(e)?e:K0(e);if(Mo(h)!==65)throw new Error("invalid signature length");const s=Nm(`0x${h.slice(130)}`),w=YF(s);return i.Signature.fromCompact(h.substring(2,130)).addRecoveryBit(w)})().recoverPublicKey(n.substring(2)).toHex(!1)}`}function YF(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function hde({hash:t,signature:e}){return cde(await dde({hash:t,signature:e}))}function jk(t,e="hex"){const n=aH(t),i=$k(new Uint8Array(n.length));return n.encode(i),e==="hex"?kc(i.bytes):i.bytes}function MLe(t,e="bytes"){return jk(t,e)}function LLe(t,e="hex"){return jk(t,e)}function aH(t){return Array.isArray(t)?fde(t.map(e=>aH(e))):pde(t)}function fde(t){const e=t.reduce((o,l)=>o+l.length,0),n=cH(e);return{length:e<=55?1+e:1+n+e,encode(o){e<=55?o.pushByte(192+e):(o.pushByte(247+n),n===1?o.pushUint8(e):n===2?o.pushUint16(e):n===3?o.pushUint24(e):o.pushUint32(e));for(const{encode:l}of t)l(o)}}}function pde(t){const e=typeof t=="string"?bd(t):t,n=cH(e.length);return{length:e.length===1&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length,encode(o){e.length===1&&e[0]<128?o.pushBytes(e):e.length<=55?(o.pushByte(128+e.length),o.pushBytes(e)):(o.pushByte(183+n),n===1?o.pushUint8(e.length):n===2?o.pushUint16(e.length):n===3?o.pushUint24(e.length):o.pushUint32(e.length),o.pushBytes(e))}}}function cH(t){if(t<2**8)return 1;if(t<2**16)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new ln("Length is too large.")}function mde(t){const{chainId:e,nonce:n,to:i}=t,o=t.contractAddress??t.address,l=_E(LS(["0x05",jk([e?ar(e):"0x",o,n?ar(n):"0x"])]));return i==="bytes"?bd(l):l}async function lH(t){const{authorization:e,signature:n}=t;return hde({hash:mde(e),signature:n??e})}class gde extends ln{constructor(e,{account:n,docsPath:i,chain:o,data:l,gas:h,gasPrice:s,maxFeePerGas:w,maxPriorityFeePerGas:x,nonce:A,to:P,value:D}){var z;const M=xE({from:n==null?void 0:n.address,to:P,value:typeof D<"u"&&`${zk(D)} ${((z=o==null?void 0:o.nativeCurrency)==null?void 0:z.symbol)||"ETH"}`,data:l,gas:h,gasPrice:typeof s<"u"&&`${sl(s)} gwei`,maxFeePerGas:typeof w<"u"&&`${sl(w)} gwei`,maxPriorityFeePerGas:typeof x<"u"&&`${sl(x)} gwei`,nonce:A});super(e.shortMessage,{cause:e,docsPath:i,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Estimate Gas Arguments:",M].filter(Boolean),name:"EstimateGasExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}}class T0 extends ln{constructor({cause:e,message:n}={}){var o;const i=(o=n==null?void 0:n.replace("execution reverted: ",""))==null?void 0:o.replace("execution reverted","");super(`Execution reverted ${i?`with reason: ${i}`:"for an unknown reason"}.`,{cause:e,name:"ExecutionRevertedError"})}}Object.defineProperty(T0,"code",{enumerable:!0,configurable:!0,writable:!0,value:3});Object.defineProperty(T0,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted|gas required exceeds allowance/});class gA extends ln{constructor({cause:e,maxFeePerGas:n}={}){super(`The fee cap (\`maxFeePerGas\`${n?` = ${sl(n)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:e,name:"FeeCapTooHighError"})}}Object.defineProperty(gA,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class s8 extends ln{constructor({cause:e,maxFeePerGas:n}={}){super(`The fee cap (\`maxFeePerGas\`${n?` = ${sl(n)}`:""} gwei) cannot be lower than the block base fee.`,{cause:e,name:"FeeCapTooLowError"})}}Object.defineProperty(s8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas less than block base fee|fee cap less than block base fee|transaction is outdated/});class o8 extends ln{constructor({cause:e,nonce:n}={}){super(`Nonce provided for the transaction ${n?`(${n}) `:""}is higher than the next one expected.`,{cause:e,name:"NonceTooHighError"})}}Object.defineProperty(o8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too high/});class a8 extends ln{constructor({cause:e,nonce:n}={}){super([`Nonce provided for the transaction ${n?`(${n}) `:""}is lower than the current nonce of the account.`,"Try increasing the nonce or find the latest nonce with `getTransactionCount`."].join(`
`),{cause:e,name:"NonceTooLowError"})}}Object.defineProperty(a8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce too low|transaction already imported|already known/});class c8 extends ln{constructor({cause:e,nonce:n}={}){super(`Nonce provided for the transaction ${n?`(${n}) `:""}exceeds the maximum allowed nonce.`,{cause:e,name:"NonceMaxValueError"})}}Object.defineProperty(c8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/nonce has max value/});class l8 extends ln{constructor({cause:e}={}){super(["The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account."].join(`
`),{cause:e,metaMessages:["This error could arise when the account does not have enough funds to:"," - pay for the total gas fee,"," - pay for the value to send."," ","The cost of the transaction is calculated as `gas * gas fee + value`, where:"," - `gas` is the amount of gas needed for transaction to execute,"," - `gas fee` is the gas fee,"," - `value` is the amount of ether to send to the recipient."],name:"InsufficientFundsError"})}}Object.defineProperty(l8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/insufficient funds|exceeds transaction sender account balance/});class u8 extends ln{constructor({cause:e,gas:n}={}){super(`The amount of gas ${n?`(${n}) `:""}provided for the transaction exceeds the limit allowed for the block.`,{cause:e,name:"IntrinsicGasTooHighError"})}}Object.defineProperty(u8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too high|gas limit reached/});class d8 extends ln{constructor({cause:e,gas:n}={}){super(`The amount of gas ${n?`(${n}) `:""}provided for the transaction is too low.`,{cause:e,name:"IntrinsicGasTooLowError"})}}Object.defineProperty(d8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/intrinsic gas too low/});class h8 extends ln{constructor({cause:e}){super("The transaction type is not supported for this chain.",{cause:e,name:"TransactionTypeNotSupportedError"})}}Object.defineProperty(h8,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/transaction type not valid/});class yA extends ln{constructor({cause:e,maxPriorityFeePerGas:n,maxFeePerGas:i}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${n?` = ${sl(n)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${i?` = ${sl(i)} gwei`:""}).`].join(`
`),{cause:e,name:"TipAboveFeeCapError"})}}Object.defineProperty(yA,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});class FS extends ln{constructor({cause:e}){super(`An error occurred while executing: ${e==null?void 0:e.shortMessage}`,{cause:e,name:"UnknownNodeError"})}}function Vk(t,e){const n=(t.details||"").toLowerCase(),i=t instanceof ln?t.walk(o=>(o==null?void 0:o.code)===T0.code):t;return i instanceof ln?new T0({cause:t,message:i.details}):T0.nodeMessage.test(n)?new T0({cause:t,message:t.details}):gA.nodeMessage.test(n)?new gA({cause:t,maxFeePerGas:e==null?void 0:e.maxFeePerGas}):s8.nodeMessage.test(n)?new s8({cause:t,maxFeePerGas:e==null?void 0:e.maxFeePerGas}):o8.nodeMessage.test(n)?new o8({cause:t,nonce:e==null?void 0:e.nonce}):a8.nodeMessage.test(n)?new a8({cause:t,nonce:e==null?void 0:e.nonce}):c8.nodeMessage.test(n)?new c8({cause:t,nonce:e==null?void 0:e.nonce}):l8.nodeMessage.test(n)?new l8({cause:t}):u8.nodeMessage.test(n)?new u8({cause:t,gas:e==null?void 0:e.gas}):d8.nodeMessage.test(n)?new d8({cause:t,gas:e==null?void 0:e.gas}):h8.nodeMessage.test(n)?new h8({cause:t}):yA.nodeMessage.test(n)?new yA({cause:t,maxFeePerGas:e==null?void 0:e.maxFeePerGas,maxPriorityFeePerGas:e==null?void 0:e.maxPriorityFeePerGas}):new FS({cause:t})}function yde(t,{docsPath:e,...n}){const i=(()=>{const o=Vk(t,n);return o instanceof FS?t:o})();return new gde(i,{docsPath:e,...n})}function $S(t,{format:e}){if(!e)return{};const n={};function i(l){const h=Object.keys(l);for(const s of h)s in t&&(n[s]=t[s]),l[s]&&typeof l[s]=="object"&&!Array.isArray(l[s])&&i(l[s])}const o=e(t||{});return i(o),n}function zS(t,e){return({exclude:n,format:i})=>({exclude:n,format:(o,l)=>{const h=e(o,l);if(n)for(const s of n)delete h[s];return{...h,...i(o,l)}},type:t})}const _de={legacy:"0x0",eip2930:"0x1",eip1559:"0x2",eip4844:"0x3",eip7702:"0x4"};function CE(t,e){const n={};return typeof t.authorizationList<"u"&&(n.authorizationList=wde(t.authorizationList)),typeof t.accessList<"u"&&(n.accessList=t.accessList),typeof t.blobVersionedHashes<"u"&&(n.blobVersionedHashes=t.blobVersionedHashes),typeof t.blobs<"u"&&(typeof t.blobs[0]!="string"?n.blobs=t.blobs.map(i=>kc(i)):n.blobs=t.blobs),typeof t.data<"u"&&(n.data=t.data),t.account&&(n.from=t.account.address),typeof t.from<"u"&&(n.from=t.from),typeof t.gas<"u"&&(n.gas=ar(t.gas)),typeof t.gasPrice<"u"&&(n.gasPrice=ar(t.gasPrice)),typeof t.maxFeePerBlobGas<"u"&&(n.maxFeePerBlobGas=ar(t.maxFeePerBlobGas)),typeof t.maxFeePerGas<"u"&&(n.maxFeePerGas=ar(t.maxFeePerGas)),typeof t.maxPriorityFeePerGas<"u"&&(n.maxPriorityFeePerGas=ar(t.maxPriorityFeePerGas)),typeof t.nonce<"u"&&(n.nonce=ar(t.nonce)),typeof t.to<"u"&&(n.to=t.to),typeof t.type<"u"&&(n.type=_de[t.type]),typeof t.value<"u"&&(n.value=ar(t.value)),n}const BLe=zS("transactionRequest",CE);function wde(t){return t.map(e=>({address:e.address,r:e.r?ar(BigInt(e.r)):e.r,s:e.s?ar(BigInt(e.s)):e.s,chainId:ar(e.chainId),nonce:ar(e.nonce),...typeof e.yParity<"u"?{yParity:ar(e.yParity)}:{},...typeof e.v<"u"&&typeof e.yParity>"u"?{v:ar(e.v)}:{}}))}function XF(t){if(!(!t||t.length===0))return t.reduce((e,{slot:n,value:i})=>{if(n.length!==66)throw new MF({size:n.length,targetSize:66,type:"hex"});if(i.length!==66)throw new MF({size:i.length,targetSize:66,type:"hex"});return e[n]=i,e},{})}function bde(t){const{balance:e,nonce:n,state:i,stateDiff:o,code:l}=t,h={};if(l!==void 0&&(h.code=l),e!==void 0&&(h.balance=ar(e)),n!==void 0&&(h.nonce=ar(n)),i!==void 0&&(h.state=XF(i)),o!==void 0){if(h.state)throw new que;h.stateDiff=XF(o)}return h}function uH(t){if(!t)return;const e={};for(const{address:n,...i}of t){if(!Th(n,{strict:!1}))throw new Y0({address:n});if(e[n])throw new Gue({address:n});e[n]=bde(i)}return e}const FLe=2n**(8n-1n)-1n,$Le=2n**(16n-1n)-1n,zLe=2n**(24n-1n)-1n,ULe=2n**(32n-1n)-1n,jLe=2n**(40n-1n)-1n,VLe=2n**(48n-1n)-1n,WLe=2n**(56n-1n)-1n,HLe=2n**(64n-1n)-1n,GLe=2n**(72n-1n)-1n,qLe=2n**(80n-1n)-1n,ZLe=2n**(88n-1n)-1n,KLe=2n**(96n-1n)-1n,YLe=2n**(104n-1n)-1n,XLe=2n**(112n-1n)-1n,JLe=2n**(120n-1n)-1n,QLe=2n**(128n-1n)-1n,eBe=2n**(136n-1n)-1n,tBe=2n**(144n-1n)-1n,nBe=2n**(152n-1n)-1n,iBe=2n**(160n-1n)-1n,rBe=2n**(168n-1n)-1n,sBe=2n**(176n-1n)-1n,oBe=2n**(184n-1n)-1n,aBe=2n**(192n-1n)-1n,cBe=2n**(200n-1n)-1n,lBe=2n**(208n-1n)-1n,uBe=2n**(216n-1n)-1n,dBe=2n**(224n-1n)-1n,hBe=2n**(232n-1n)-1n,fBe=2n**(240n-1n)-1n,pBe=2n**(248n-1n)-1n,mBe=2n**(256n-1n)-1n,gBe=-(2n**(8n-1n)),yBe=-(2n**(16n-1n)),_Be=-(2n**(24n-1n)),wBe=-(2n**(32n-1n)),bBe=-(2n**(40n-1n)),vBe=-(2n**(48n-1n)),xBe=-(2n**(56n-1n)),EBe=-(2n**(64n-1n)),CBe=-(2n**(72n-1n)),TBe=-(2n**(80n-1n)),ABe=-(2n**(88n-1n)),SBe=-(2n**(96n-1n)),IBe=-(2n**(104n-1n)),PBe=-(2n**(112n-1n)),RBe=-(2n**(120n-1n)),OBe=-(2n**(128n-1n)),kBe=-(2n**(136n-1n)),DBe=-(2n**(144n-1n)),NBe=-(2n**(152n-1n)),MBe=-(2n**(160n-1n)),LBe=-(2n**(168n-1n)),BBe=-(2n**(176n-1n)),FBe=-(2n**(184n-1n)),$Be=-(2n**(192n-1n)),zBe=-(2n**(200n-1n)),UBe=-(2n**(208n-1n)),jBe=-(2n**(216n-1n)),VBe=-(2n**(224n-1n)),WBe=-(2n**(232n-1n)),HBe=-(2n**(240n-1n)),GBe=-(2n**(248n-1n)),qBe=-(2n**(256n-1n)),ZBe=2n**8n-1n,KBe=2n**16n-1n,YBe=2n**24n-1n,XBe=2n**32n-1n,JBe=2n**40n-1n,QBe=2n**48n-1n,eFe=2n**56n-1n,tFe=2n**64n-1n,nFe=2n**72n-1n,iFe=2n**80n-1n,rFe=2n**88n-1n,sFe=2n**96n-1n,oFe=2n**104n-1n,aFe=2n**112n-1n,cFe=2n**120n-1n,lFe=2n**128n-1n,uFe=2n**136n-1n,dFe=2n**144n-1n,hFe=2n**152n-1n,fFe=2n**160n-1n,pFe=2n**168n-1n,mFe=2n**176n-1n,gFe=2n**184n-1n,yFe=2n**192n-1n,_Fe=2n**200n-1n,wFe=2n**208n-1n,bFe=2n**216n-1n,vFe=2n**224n-1n,xFe=2n**232n-1n,EFe=2n**240n-1n,CFe=2n**248n-1n,vde=2n**256n-1n;function TE(t){const{account:e,maxFeePerGas:n,maxPriorityFeePerGas:i,to:o}=t,l=e?Tu(e):void 0;if(l&&!Th(l.address))throw new Y0({address:l.address});if(o&&!Th(o))throw new Y0({address:o});if(n&&n>vde)throw new gA({maxFeePerGas:n});if(i&&n&&i>n)throw new yA({maxFeePerGas:n,maxPriorityFeePerGas:i})}class dH extends ln{constructor(){super("`baseFeeMultiplier` must be greater than 1.",{name:"BaseFeeScalarError"})}}class Wk extends ln{constructor(){super("Chain does not support EIP-1559 fees.",{name:"Eip1559FeesNotSupportedError"})}}class xde extends ln{constructor({maxPriorityFeePerGas:e}){super(`\`maxFeePerGas\` cannot be less than the \`maxPriorityFeePerGas\` (${sl(e)} gwei).`,{name:"MaxFeePerGasTooLowError"})}}class hH extends ln{constructor({blockHash:e,blockNumber:n}){let i="Block";e&&(i=`Block at hash "${e}"`),n&&(i=`Block at number "${n}"`),super(`${i} could not be found.`,{name:"BlockNotFoundError"})}}const fH={"0x0":"legacy","0x1":"eip2930","0x2":"eip1559","0x3":"eip4844","0x4":"eip7702"};function US(t,e){const n={...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,chainId:t.chainId?Nm(t.chainId):void 0,gas:t.gas?BigInt(t.gas):void 0,gasPrice:t.gasPrice?BigInt(t.gasPrice):void 0,maxFeePerBlobGas:t.maxFeePerBlobGas?BigInt(t.maxFeePerBlobGas):void 0,maxFeePerGas:t.maxFeePerGas?BigInt(t.maxFeePerGas):void 0,maxPriorityFeePerGas:t.maxPriorityFeePerGas?BigInt(t.maxPriorityFeePerGas):void 0,nonce:t.nonce?Nm(t.nonce):void 0,to:t.to?t.to:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,type:t.type?fH[t.type]:void 0,typeHex:t.type?t.type:void 0,value:t.value?BigInt(t.value):void 0,v:t.v?BigInt(t.v):void 0};return t.authorizationList&&(n.authorizationList=Ede(t.authorizationList)),n.yParity=(()=>{if(t.yParity)return Number(t.yParity);if(typeof n.v=="bigint"){if(n.v===0n||n.v===27n)return 0;if(n.v===1n||n.v===28n)return 1;if(n.v>=35n)return n.v%2n===0n?1:0}})(),n.type==="legacy"&&(delete n.accessList,delete n.maxFeePerBlobGas,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.yParity),n.type==="eip2930"&&(delete n.maxFeePerBlobGas,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas),n.type==="eip1559"&&delete n.maxFeePerBlobGas,n}const TFe=zS("transaction",US);function Ede(t){return t.map(e=>({address:e.address,chainId:Number(e.chainId),nonce:Number(e.nonce),r:e.r,s:e.s,yParity:Number(e.yParity)}))}function pH(t,e){const n=(t.transactions??[]).map(i=>typeof i=="string"?i:US(i));return{...t,baseFeePerGas:t.baseFeePerGas?BigInt(t.baseFeePerGas):null,blobGasUsed:t.blobGasUsed?BigInt(t.blobGasUsed):void 0,difficulty:t.difficulty?BigInt(t.difficulty):void 0,excessBlobGas:t.excessBlobGas?BigInt(t.excessBlobGas):void 0,gasLimit:t.gasLimit?BigInt(t.gasLimit):void 0,gasUsed:t.gasUsed?BigInt(t.gasUsed):void 0,hash:t.hash?t.hash:null,logsBloom:t.logsBloom?t.logsBloom:null,nonce:t.nonce?t.nonce:null,number:t.number?BigInt(t.number):null,size:t.size?BigInt(t.size):void 0,timestamp:t.timestamp?BigInt(t.timestamp):void 0,transactions:n,totalDifficulty:t.totalDifficulty?BigInt(t.totalDifficulty):null}}const AFe=zS("block",pH);async function cw(t,{blockHash:e,blockNumber:n,blockTag:i=t.experimental_blockTag??"latest",includeTransactions:o}={}){var x,A,P;const l=o??!1,h=n!==void 0?ar(n):void 0;let s=null;if(e?s=await t.request({method:"eth_getBlockByHash",params:[e,l]},{dedupe:!0}):s=await t.request({method:"eth_getBlockByNumber",params:[h||i,l]},{dedupe:!!h}),!s)throw new hH({blockHash:e,blockNumber:n});return(((P=(A=(x=t.chain)==null?void 0:x.formatters)==null?void 0:A.block)==null?void 0:P.format)||pH)(s,"getBlock")}async function mH(t){const e=await t.request({method:"eth_gasPrice"});return BigInt(e)}async function SFe(t,e){return gH(t,e)}async function gH(t,e){var l,h;const{block:n,chain:i=t.chain,request:o}=e||{};try{const s=((l=i==null?void 0:i.fees)==null?void 0:l.maxPriorityFeePerGas)??((h=i==null?void 0:i.fees)==null?void 0:h.defaultPriorityFee);if(typeof s=="function"){const x=n||await is(t,cw,"getBlock")({}),A=await s({block:x,client:t,request:o});if(A===null)throw new Error;return A}if(typeof s<"u")return s;const w=await t.request({method:"eth_maxPriorityFeePerGas"});return Z0(w)}catch{const[s,w]=await Promise.all([n?Promise.resolve(n):is(t,cw,"getBlock")({}),is(t,mH,"getGasPrice")({})]);if(typeof s.baseFeePerGas!="bigint")throw new Wk;const x=w-s.baseFeePerGas;return x<0n?0n:x}}async function IFe(t,e){return f8(t,e)}async function f8(t,e){var D,M;const{block:n,chain:i=t.chain,request:o,type:l="eip1559"}=e||{},h=await(async()=>{var z,U;return typeof((z=i==null?void 0:i.fees)==null?void 0:z.baseFeeMultiplier)=="function"?i.fees.baseFeeMultiplier({block:n,client:t,request:o}):((U=i==null?void 0:i.fees)==null?void 0:U.baseFeeMultiplier)??1.2})();if(h<1)throw new dH;const w=10**(((D=h.toString().split(".")[1])==null?void 0:D.length)??0),x=z=>z*BigInt(Math.ceil(h*w))/BigInt(w),A=n||await is(t,cw,"getBlock")({});if(typeof((M=i==null?void 0:i.fees)==null?void 0:M.estimateFeesPerGas)=="function"){const z=await i.fees.estimateFeesPerGas({block:n,client:t,multiply:x,request:o,type:l});if(z!==null)return z}if(l==="eip1559"){if(typeof A.baseFeePerGas!="bigint")throw new Wk;const z=typeof(o==null?void 0:o.maxPriorityFeePerGas)=="bigint"?o.maxPriorityFeePerGas:await gH(t,{block:A,chain:i,request:o}),U=x(A.baseFeePerGas);return{maxFeePerGas:(o==null?void 0:o.maxFeePerGas)??U+z,maxPriorityFeePerGas:z}}return{gasPrice:(o==null?void 0:o.gasPrice)??x(await is(t,mH,"getGasPrice")({}))}}async function Cde(t,{address:e,blockTag:n="latest",blockNumber:i}){const o=await t.request({method:"eth_getTransactionCount",params:[e,typeof i=="bigint"?ar(i):n]},{dedupe:!!i});return Nm(o)}function yH(t){const{kzg:e}=t,n=t.to??(typeof t.blobs[0]=="string"?"hex":"bytes"),i=typeof t.blobs[0]=="string"?t.blobs.map(l=>bd(l)):t.blobs,o=[];for(const l of i)o.push(Uint8Array.from(e.blobToKzgCommitment(l)));return n==="bytes"?o:o.map(l=>kc(l))}function _H(t){const{kzg:e}=t,n=t.to??(typeof t.blobs[0]=="string"?"hex":"bytes"),i=typeof t.blobs[0]=="string"?t.blobs.map(h=>bd(h)):t.blobs,o=typeof t.commitments[0]=="string"?t.commitments.map(h=>bd(h)):t.commitments,l=[];for(let h=0;h<i.length;h++){const s=i[h],w=o[h];l.push(Uint8Array.from(e.computeBlobKzgProof(s,w)))}return n==="bytes"?l:l.map(h=>kc(h))}function Tde(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const o=BigInt(32),l=BigInt(4294967295),h=Number(n>>o&l),s=Number(n&l),w=i?4:0,x=i?0:4;t.setUint32(e+w,h,i),t.setUint32(e+x,s,i)}function Ade(t,e,n){return t&e^~t&n}function Sde(t,e,n){return t&e^t&n^e&n}class wH extends Rk{constructor(e,n,i,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=o,this.buffer=new Uint8Array(e),this.view=G4(this.buffer)}update(e){iw(this),e=NS(e),Mm(e);const{view:n,buffer:i,blockLen:o}=this,l=e.length;for(let h=0;h<l;){const s=Math.min(o-this.pos,l-h);if(s===o){const w=G4(e);for(;o<=l-h;h+=o)this.process(w,h);continue}i.set(e.subarray(h,h+s),this.pos),this.pos+=s,h+=s,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){iw(this),zW(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:o,isLE:l}=this;let{pos:h}=this;n[h++]=128,Lm(this.buffer.subarray(h)),this.padOffset>o-h&&(this.process(i,0),h=0);for(let P=h;P<o;P++)n[P]=0;Tde(i,o-8,BigInt(this.length*8),l),this.process(i,0);const s=G4(e),w=this.outputLen;if(w%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const x=w/4,A=this.get();if(x>A.length)throw new Error("_sha2: outputLen bigger than state");for(let P=0;P<x;P++)s.setUint32(4*P,A[P],l)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:o,finished:l,destroyed:h,pos:s}=this;return e.destroyed=h,e.finished=l,e.length=o,e.pos=s,o%n&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const jp=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ua=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),ja=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Ide=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vp=new Uint32Array(64);class Pde extends wH{constructor(e=32){super(64,e,8,!1),this.A=jp[0]|0,this.B=jp[1]|0,this.C=jp[2]|0,this.D=jp[3]|0,this.E=jp[4]|0,this.F=jp[5]|0,this.G=jp[6]|0,this.H=jp[7]|0}get(){const{A:e,B:n,C:i,D:o,E:l,F:h,G:s,H:w}=this;return[e,n,i,o,l,h,s,w]}set(e,n,i,o,l,h,s,w){this.A=e|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=l|0,this.F=h|0,this.G=s|0,this.H=w|0}process(e,n){for(let P=0;P<16;P++,n+=4)Vp[P]=e.getUint32(n,!1);for(let P=16;P<64;P++){const D=Vp[P-15],M=Vp[P-2],z=ih(D,7)^ih(D,18)^D>>>3,U=ih(M,17)^ih(M,19)^M>>>10;Vp[P]=U+Vp[P-7]+z+Vp[P-16]|0}let{A:i,B:o,C:l,D:h,E:s,F:w,G:x,H:A}=this;for(let P=0;P<64;P++){const D=ih(s,6)^ih(s,11)^ih(s,25),M=A+D+Ade(s,w,x)+Ide[P]+Vp[P]|0,U=(ih(i,2)^ih(i,13)^ih(i,22))+Sde(i,o,l)|0;A=x,x=w,w=s,s=h+M|0,h=l,l=o,o=i,i=M+U|0}i=i+this.A|0,o=o+this.B|0,l=l+this.C|0,h=h+this.D|0,s=s+this.E|0,w=w+this.F|0,x=x+this.G|0,A=A+this.H|0,this.set(i,o,l,h,s,w,x,A)}roundClean(){Lm(Vp)}destroy(){this.set(0,0,0,0,0,0,0,0),Lm(this.buffer)}}const bH=$W(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Rde=bH[0],Ode=bH[1],Wp=new Uint32Array(80),Hp=new Uint32Array(80);class vH extends wH{constructor(e=64){super(128,e,16,!1),this.Ah=ja[0]|0,this.Al=ja[1]|0,this.Bh=ja[2]|0,this.Bl=ja[3]|0,this.Ch=ja[4]|0,this.Cl=ja[5]|0,this.Dh=ja[6]|0,this.Dl=ja[7]|0,this.Eh=ja[8]|0,this.El=ja[9]|0,this.Fh=ja[10]|0,this.Fl=ja[11]|0,this.Gh=ja[12]|0,this.Gl=ja[13]|0,this.Hh=ja[14]|0,this.Hl=ja[15]|0}get(){const{Ah:e,Al:n,Bh:i,Bl:o,Ch:l,Cl:h,Dh:s,Dl:w,Eh:x,El:A,Fh:P,Fl:D,Gh:M,Gl:z,Hh:U,Hl:G}=this;return[e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G]}set(e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G){this.Ah=e|0,this.Al=n|0,this.Bh=i|0,this.Bl=o|0,this.Ch=l|0,this.Cl=h|0,this.Dh=s|0,this.Dl=w|0,this.Eh=x|0,this.El=A|0,this.Fh=P|0,this.Fl=D|0,this.Gh=M|0,this.Gl=z|0,this.Hh=U|0,this.Hl=G|0}process(e,n){for(let Q=0;Q<16;Q++,n+=4)Wp[Q]=e.getUint32(n),Hp[Q]=e.getUint32(n+=4);for(let Q=16;Q<80;Q++){const de=Wp[Q-15]|0,he=Hp[Q-15]|0,Ie=c1(de,he,1)^c1(de,he,8)^FF(de,he,7),ke=l1(de,he,1)^l1(de,he,8)^$F(de,he,7),Ue=Wp[Q-2]|0,ze=Hp[Q-2]|0,ht=c1(Ue,ze,19)^j5(Ue,ze,61)^FF(Ue,ze,6),ft=l1(Ue,ze,19)^V5(Ue,ze,61)^$F(Ue,ze,6),ct=Wle(ke,ft,Hp[Q-7],Hp[Q-16]),je=Hle(ct,Ie,ht,Wp[Q-7],Wp[Q-16]);Wp[Q]=je|0,Hp[Q]=ct|0}let{Ah:i,Al:o,Bh:l,Bl:h,Ch:s,Cl:w,Dh:x,Dl:A,Eh:P,El:D,Fh:M,Fl:z,Gh:U,Gl:G,Hh:ne,Hl:oe}=this;for(let Q=0;Q<80;Q++){const de=c1(P,D,14)^c1(P,D,18)^j5(P,D,41),he=l1(P,D,14)^l1(P,D,18)^V5(P,D,41),Ie=P&M^~P&U,ke=D&z^~D&G,Ue=Gle(oe,he,ke,Ode[Q],Hp[Q]),ze=qle(Ue,ne,de,Ie,Rde[Q],Wp[Q]),ht=Ue|0,ft=c1(i,o,28)^j5(i,o,34)^j5(i,o,39),ct=l1(i,o,28)^V5(i,o,34)^V5(i,o,39),je=i&l^i&s^l&s,Ye=o&h^o&w^h&w;ne=U|0,oe=G|0,U=M|0,G=z|0,M=P|0,z=D|0,{h:P,l:D}=df(x|0,A|0,ze|0,ht|0),x=s|0,A=w|0,s=l|0,w=h|0,l=i|0,h=o|0;const re=jle(ht,ct,Ye);i=Vle(re,ze,ft,je),o=re|0}({h:i,l:o}=df(this.Ah|0,this.Al|0,i|0,o|0)),{h:l,l:h}=df(this.Bh|0,this.Bl|0,l|0,h|0),{h:s,l:w}=df(this.Ch|0,this.Cl|0,s|0,w|0),{h:x,l:A}=df(this.Dh|0,this.Dl|0,x|0,A|0),{h:P,l:D}=df(this.Eh|0,this.El|0,P|0,D|0),{h:M,l:z}=df(this.Fh|0,this.Fl|0,M|0,z|0),{h:U,l:G}=df(this.Gh|0,this.Gl|0,U|0,G|0),{h:ne,l:oe}=df(this.Hh|0,this.Hl|0,ne|0,oe|0),this.set(i,o,l,h,s,w,x,A,P,D,M,z,U,G,ne,oe)}roundClean(){Lm(Wp,Hp)}destroy(){Lm(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class kde extends vH{constructor(){super(48),this.Ah=Ua[0]|0,this.Al=Ua[1]|0,this.Bh=Ua[2]|0,this.Bl=Ua[3]|0,this.Ch=Ua[4]|0,this.Cl=Ua[5]|0,this.Dh=Ua[6]|0,this.Dl=Ua[7]|0,this.Eh=Ua[8]|0,this.El=Ua[9]|0,this.Fh=Ua[10]|0,this.Fl=Ua[11]|0,this.Gh=Ua[12]|0,this.Gl=Ua[13]|0,this.Hh=Ua[14]|0,this.Hl=Ua[15]|0}}const xH=MS(()=>new Pde),PFe=MS(()=>new vH),RFe=MS(()=>new kde),Dde=xH;function Nde(t,e){const n=e||"hex",i=Dde(Dm(t,{strict:!1})?DS(t):t);return n==="bytes"?i:K0(i)}function Mde(t){const{commitment:e,version:n=1}=t,i=t.to??(typeof e=="string"?"hex":"bytes"),o=Nde(e,"bytes");return o.set([n],0),i==="bytes"?o:kc(o)}function Lde(t){const{commitments:e,version:n}=t,i=t.to??(typeof e[0]=="string"?"hex":"bytes"),o=[];for(const l of e)o.push(Mde({commitment:l,to:i,version:n}));return o}const JF=6,EH=32,Hk=4096,CH=EH*Hk,QF=CH*JF-1-1*Hk*JF,Bde=1;class Fde extends ln{constructor({maxSize:e,size:n}){super("Blob size is too large.",{metaMessages:[`Max: ${e} bytes`,`Given: ${n} bytes`],name:"BlobSizeTooLargeError"})}}class $de extends ln{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}class OFe extends ln{constructor({hash:e,size:n}){super(`Versioned hash "${e}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${n}`],name:"InvalidVersionedHashSizeError"})}}class kFe extends ln{constructor({hash:e,version:n}){super(`Versioned hash "${e}" version is invalid.`,{metaMessages:[`Expected: ${Bde}`,`Received: ${n}`],name:"InvalidVersionedHashVersionError"})}}function zde(t){const e=t.to??(typeof t.data=="string"?"hex":"bytes"),n=typeof t.data=="string"?bd(t.data):t.data,i=Mo(n);if(!i)throw new $de;if(i>QF)throw new Fde({maxSize:QF,size:i});const o=[];let l=!0,h=0;for(;l;){const s=$k(new Uint8Array(CH));let w=0;for(;w<Hk;){const x=n.slice(h,h+(EH-1));if(s.pushByte(0),s.pushBytes(x),x.length<31){s.pushByte(128),l=!1;break}w++,h+=31}o.push(s)}return e==="bytes"?o.map(s=>s.bytes):o.map(s=>kc(s.bytes))}function Ude(t){const{data:e,kzg:n,to:i}=t,o=t.blobs??zde({data:e,to:i}),l=t.commitments??yH({blobs:o,kzg:n,to:i}),h=t.proofs??_H({blobs:o,commitments:l,kzg:n,to:i}),s=[];for(let w=0;w<o.length;w++)s.push({blob:o[w],commitment:l[w],proof:h[w]});return s}function jde(t){if(t.type)return t.type;if(typeof t.authorizationList<"u")return"eip7702";if(typeof t.blobs<"u"||typeof t.blobVersionedHashes<"u"||typeof t.maxFeePerBlobGas<"u"||typeof t.sidecars<"u")return"eip4844";if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")return"eip1559";if(typeof t.gasPrice<"u")return typeof t.accessList<"u"?"eip2930":"legacy";throw new Kue({transaction:t})}function TH(t,{docsPath:e,...n}){const i=(()=>{const o=Vk(t,n);return o instanceof FS?t:o})();return new Yue(i,{docsPath:e,...n})}async function Gk(t){const e=await t.request({method:"eth_chainId"},{dedupe:!0});return Nm(e)}async function Vde(t,e){var Ue,ze,ht,ft,ct;const{account:n=t.account,accessList:i,authorizationList:o,chain:l=t.chain,blobVersionedHashes:h,blobs:s,data:w,gas:x,gasPrice:A,maxFeePerBlobGas:P,maxFeePerGas:D,maxPriorityFeePerGas:M,nonce:z,nonceManager:U,to:G,type:ne,value:oe,...Q}=e,de=await(async()=>{if(!n||!U||typeof z<"u")return z;const je=Tu(n),Ye=l?l.id:await is(t,Gk,"getChainId")({});return await U.consume({address:je.address,chainId:Ye,client:t})})();TE(e);const he=(ze=(Ue=l==null?void 0:l.formatters)==null?void 0:Ue.transactionRequest)==null?void 0:ze.format,ke=(he||CE)({...$S(Q,{format:he}),account:n?Tu(n):void 0,accessList:i,authorizationList:o,blobs:s,blobVersionedHashes:h,data:w,gas:x,gasPrice:A,maxFeePerBlobGas:P,maxFeePerGas:D,maxPriorityFeePerGas:M,nonce:de,to:G,type:ne,value:oe},"fillTransaction");try{const je=await t.request({method:"eth_fillTransaction",params:[ke]}),re=(((ft=(ht=l==null?void 0:l.formatters)==null?void 0:ht.transaction)==null?void 0:ft.format)||US)(je.tx);delete re.blockHash,delete re.blockNumber,delete re.r,delete re.s,delete re.transactionIndex,delete re.v,delete re.yParity,re.data=re.input,re.gas&&(re.gas=e.gas??re.gas),re.gasPrice&&(re.gasPrice=e.gasPrice??re.gasPrice),re.maxFeePerBlobGas&&(re.maxFeePerBlobGas=e.maxFeePerBlobGas??re.maxFeePerBlobGas),re.maxFeePerGas&&(re.maxFeePerGas=e.maxFeePerGas??re.maxFeePerGas),re.maxPriorityFeePerGas&&(re.maxPriorityFeePerGas=e.maxPriorityFeePerGas??re.maxPriorityFeePerGas),re.nonce&&(re.nonce=e.nonce??re.nonce);const le=await(async()=>{var He,Et;if(typeof((He=l==null?void 0:l.fees)==null?void 0:He.baseFeeMultiplier)=="function"){const Ct=await is(t,cw,"getBlock")({});return l.fees.baseFeeMultiplier({block:Ct,client:t,request:e})}return((Et=l==null?void 0:l.fees)==null?void 0:Et.baseFeeMultiplier)??1.2})();if(le<1)throw new dH;const Le=10**(((ct=le.toString().split(".")[1])==null?void 0:ct.length)??0),De=He=>He*BigInt(Math.ceil(le*Le))/BigInt(Le);return re.maxFeePerGas&&!e.maxFeePerGas&&(re.maxFeePerGas=De(re.maxFeePerGas)),re.gasPrice&&!e.gasPrice&&(re.gasPrice=De(re.gasPrice)),{raw:je.raw,transaction:{from:ke.from,...re}}}catch(je){throw TH(je,{...e,chain:t.chain})}}const AH=["blobVersionedHashes","chainId","fees","gas","nonce","type"],e$=new Map,K4=new wE(128);async function qk(t,e){var de,he,Ie;let n=e;n.account??(n.account=t.account),n.parameters??(n.parameters=AH);const{account:i,chain:o=t.chain,nonceManager:l,parameters:h}=n,s=(()=>{if(typeof(o==null?void 0:o.prepareTransactionRequest)=="function")return{fn:o.prepareTransactionRequest,runAt:["beforeFillTransaction"]};if(Array.isArray(o==null?void 0:o.prepareTransactionRequest))return{fn:o.prepareTransactionRequest[0],runAt:o.prepareTransactionRequest[1].runAt}})();let w;async function x(){return w||(typeof n.chainId<"u"?n.chainId:o?o.id:(w=await is(t,Gk,"getChainId")({}),w))}const A=i&&Tu(i);let P=n.nonce;if(h.includes("nonce")&&typeof P>"u"&&A&&l){const ke=await x();P=await l.consume({address:A.address,chainId:ke,client:t})}s!=null&&s.fn&&((de=s.runAt)!=null&&de.includes("beforeFillTransaction"))&&(n=await s.fn({...n,chain:o},{phase:"beforeFillTransaction"}),P??(P=n.nonce));const M=((h.includes("blobVersionedHashes")||h.includes("sidecars"))&&n.kzg&&n.blobs||K4.get(t.uid)===!1||!["fees","gas"].some(Ue=>h.includes(Ue))?!1:!!(h.includes("chainId")&&typeof n.chainId!="number"||h.includes("nonce")&&typeof P!="number"||h.includes("fees")&&typeof n.gasPrice!="bigint"&&(typeof n.maxFeePerGas!="bigint"||typeof n.maxPriorityFeePerGas!="bigint")||h.includes("gas")&&typeof n.gas!="bigint"))?await is(t,Vde,"fillTransaction")({...n,nonce:P}).then(ke=>{const{chainId:Ue,from:ze,gas:ht,gasPrice:ft,nonce:ct,maxFeePerBlobGas:je,maxFeePerGas:Ye,maxPriorityFeePerGas:re,type:le,...Ae}=ke.transaction;return K4.set(t.uid,!0),{...n,...ze?{from:ze}:{},...le?{type:le}:{},...typeof Ue<"u"?{chainId:Ue}:{},...typeof ht<"u"?{gas:ht}:{},...typeof ft<"u"?{gasPrice:ft}:{},...typeof ct<"u"?{nonce:ct}:{},...typeof je<"u"?{maxFeePerBlobGas:je}:{},...typeof Ye<"u"?{maxFeePerGas:Ye}:{},...typeof re<"u"?{maxPriorityFeePerGas:re}:{},..."nonceKey"in Ae&&typeof Ae.nonceKey<"u"?{nonceKey:Ae.nonceKey}:{}}}).catch(ke=>{var ht;const Ue=ke;return Ue.name!=="TransactionExecutionError"||((ht=Ue.walk)==null?void 0:ht.call(Ue,ft=>{const ct=ft;return ct.name==="MethodNotFoundRpcError"||ct.name==="MethodNotSupportedRpcError"}))&&K4.set(t.uid,!1),n}):n;P??(P=M.nonce),n={...M,...A?{from:A==null?void 0:A.address}:{},...P?{nonce:P}:{}};const{blobs:z,gas:U,kzg:G,type:ne}=n;s!=null&&s.fn&&((he=s.runAt)!=null&&he.includes("beforeFillParameters"))&&(n=await s.fn({...n,chain:o},{phase:"beforeFillParameters"}));let oe;async function Q(){return oe||(oe=await is(t,cw,"getBlock")({blockTag:"latest"}),oe)}if(h.includes("nonce")&&typeof P>"u"&&A&&!l&&(n.nonce=await is(t,Cde,"getTransactionCount")({address:A.address,blockTag:"pending"})),(h.includes("blobVersionedHashes")||h.includes("sidecars"))&&z&&G){const ke=yH({blobs:z,kzg:G});if(h.includes("blobVersionedHashes")){const Ue=Lde({commitments:ke,to:"hex"});n.blobVersionedHashes=Ue}if(h.includes("sidecars")){const Ue=_H({blobs:z,commitments:ke,kzg:G}),ze=Ude({blobs:z,commitments:ke,proofs:Ue,to:"hex"});n.sidecars=ze}}if(h.includes("chainId")&&(n.chainId=await x()),(h.includes("fees")||h.includes("type"))&&typeof ne>"u")try{n.type=jde(n)}catch{let ke=e$.get(t.uid);if(typeof ke>"u"){const Ue=await Q();ke=typeof(Ue==null?void 0:Ue.baseFeePerGas)=="bigint",e$.set(t.uid,ke)}n.type=ke?"eip1559":"legacy"}if(h.includes("fees"))if(n.type!=="legacy"&&n.type!=="eip2930"){if(typeof n.maxFeePerGas>"u"||typeof n.maxPriorityFeePerGas>"u"){const ke=await Q(),{maxFeePerGas:Ue,maxPriorityFeePerGas:ze}=await f8(t,{block:ke,chain:o,request:n});if(typeof n.maxPriorityFeePerGas>"u"&&n.maxFeePerGas&&n.maxFeePerGas<ze)throw new xde({maxPriorityFeePerGas:ze});n.maxPriorityFeePerGas=ze,n.maxFeePerGas=Ue}}else{if(typeof n.maxFeePerGas<"u"||typeof n.maxPriorityFeePerGas<"u")throw new Wk;if(typeof n.gasPrice>"u"){const ke=await Q(),{gasPrice:Ue}=await f8(t,{block:ke,chain:o,request:n,type:"legacy"});n.gasPrice=Ue}}return h.includes("gas")&&typeof U>"u"&&(n.gas=await is(t,SH,"estimateGas")({...n,account:A,prepare:(A==null?void 0:A.type)==="local"?[]:["blobVersionedHashes"]})),s!=null&&s.fn&&((Ie=s.runAt)!=null&&Ie.includes("afterFillParameters"))&&(n=await s.fn({...n,chain:o},{phase:"afterFillParameters"})),TE(n),delete n.parameters,n}async function SH(t,e){var h,s,w;const{account:n=t.account,prepare:i=!0}=e,o=n?Tu(n):void 0,l=(()=>{if(Array.isArray(i))return i;if((o==null?void 0:o.type)!=="local")return["blobVersionedHashes"]})();try{const x=await(async()=>{if(e.to)return e.to;if(e.authorizationList&&e.authorizationList.length>0)return await lH({authorization:e.authorizationList[0]}).catch(()=>{throw new ln("`to` is required. Could not infer from `authorizationList`")})})(),{accessList:A,authorizationList:P,blobs:D,blobVersionedHashes:M,blockNumber:z,blockTag:U,data:G,gas:ne,gasPrice:oe,maxFeePerBlobGas:Q,maxFeePerGas:de,maxPriorityFeePerGas:he,nonce:Ie,value:ke,stateOverride:Ue,...ze}=i?await qk(t,{...e,parameters:l,to:x}):e;if(ne&&e.gas!==ne)return ne;const ft=(typeof z=="bigint"?ar(z):void 0)||U,ct=uH(Ue);TE(e);const je=(w=(s=(h=t.chain)==null?void 0:h.formatters)==null?void 0:s.transactionRequest)==null?void 0:w.format,re=(je||CE)({...$S(ze,{format:je}),account:o,accessList:A,authorizationList:P,blobs:D,blobVersionedHashes:M,data:G,gasPrice:oe,maxFeePerBlobGas:Q,maxFeePerGas:de,maxPriorityFeePerGas:he,nonce:Ie,to:x,value:ke},"estimateGas");return BigInt(await t.request({method:"eth_estimateGas",params:ct?[re,ft??t.experimental_blockTag??"latest",ct]:ft?[re,ft]:[re]}))}catch(x){throw yde(x,{...e,account:o,chain:t.chain})}}function Wde(t,e){if(!Th(t,{strict:!1}))throw new Y0({address:t});if(!Th(e,{strict:!1}))throw new Y0({address:e});return t.toLowerCase()===e.toLowerCase()}const t$="/docs/contract/decodeEventLog";function n$(t){const{abi:e,data:n,strict:i,topics:o}=t,l=i??!0,[h,...s]=o;if(!h)throw new _le({docsPath:t$});const w=e.find(ne=>ne.type==="event"&&h===kk(km(ne)));if(!(w&&"name"in w)||w.type!=="event")throw new wle(h,{docsPath:t$});const{name:x,inputs:A}=w,P=A==null?void 0:A.some(ne=>!("name"in ne&&ne.name)),D=P?[]:{},M=A.map((ne,oe)=>[ne,oe]).filter(([ne])=>"indexed"in ne&&ne.indexed),z=[];for(let ne=0;ne<M.length;ne++){const[oe,Q]=M[ne],de=s[ne];if(!de){if(l)throw new xle({abiItem:w,param:oe});z.push([oe,Q]);continue}D[P?Q:oe.name||Q]=Hde({param:oe,value:de})}const U=A.filter(ne=>!("indexed"in ne&&ne.indexed)),G=l?U:[...z.map(([ne])=>ne),...U];if(G.length>0){if(n&&n!=="0x")try{const ne=BS(G,n);if(ne){let oe=0;if(!l)for(const[Q,de]of z)D[P?de:Q.name||de]=ne[oe++];if(P)for(let Q=0;Q<A.length;Q++)D[Q]===void 0&&oe<ne.length&&(D[Q]=ne[oe++]);else for(let Q=0;Q<U.length;Q++)D[U[Q].name]=ne[oe++]}}catch(ne){if(l)throw ne instanceof kW||ne instanceof QW?new NF({abiItem:w,data:n,params:G,size:Mo(n)}):ne}else if(l)throw new NF({abiItem:w,data:"0x",params:G,size:0})}return{eventName:x,args:Object.values(D).length>0?D:void 0}}function Hde({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(BS([t],e)||[])[0]}function Gde(t){const{abi:e,args:n,logs:i,strict:o=!0}=t,l=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})(),h=e.filter(s=>s.type==="event").map(s=>({abi:s,selector:kk(s)}));return i.map(s=>{var P;const w=h.filter(D=>s.topics[0]===D.selector);if(w.length===0)return null;let x,A;for(const D of w)try{x=n$({...s,abi:[D.abi],strict:!0}),A=D;break}catch{}if(!x&&!o){A=w[0];try{x=n$({data:s.data,topics:s.topics,abi:[A.abi],strict:!1})}catch{const D=(P=A.abi.inputs)==null?void 0:P.some(M=>!("name"in M&&M.name));return{...s,args:D?[]:{},eventName:A.abi.name}}}return!x||!A||l&&!l.includes(x.eventName)||!qde({args:x.args,inputs:A.abi.inputs,matchArgs:n})?null:{...x,...s}}).filter(Boolean)}function qde(t){const{args:e,inputs:n,matchArgs:i}=t;if(!i)return!0;if(!e)return!1;function o(l,h,s){try{return l.type==="address"?Wde(h,s):l.type==="string"||l.type==="bytes"?_E(DS(h))===s:h===s}catch{return!1}}return Array.isArray(e)&&Array.isArray(i)?i.every((l,h)=>{if(l==null)return!0;const s=n[h];return s?(Array.isArray(l)?l:[l]).some(x=>o(s,x,e[h])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof i=="object"&&!Array.isArray(i)?Object.entries(i).every(([l,h])=>{if(h==null)return!0;const s=n.find(x=>x.name===l);return s?(Array.isArray(h)?h:[h]).some(x=>o(s,x,e[l])):!1}):!1}function IH(t,{args:e,eventName:n}={}){return{...t,blockHash:t.blockHash?t.blockHash:null,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,blockTimestamp:t.blockTimestamp?BigInt(t.blockTimestamp):t.blockTimestamp===null?null:void 0,logIndex:t.logIndex?Number(t.logIndex):null,transactionHash:t.transactionHash?t.transactionHash:null,transactionIndex:t.transactionIndex?Number(t.transactionIndex):null,...n?{args:e,eventName:n}:{}}}const Y4="/docs/contract/decodeFunctionResult";function PH(t){const{abi:e,args:n,functionName:i,data:o}=t;let l=e[0];if(i){const s=Bk({abi:e,args:n,name:i});if(!s)throw new pA(i,{docsPath:Y4});l=s}if(l.type!=="function")throw new pA(void 0,{docsPath:Y4});if(!l.outputs)throw new ble(l.name,{docsPath:Y4});const h=BS(l.outputs,o);if(h&&h.length>1)return h;if(h&&h.length===1)return h[0]}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Zk=BigInt(0),p8=BigInt(1);function AE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Kk(t){if(!AE(t))throw new Error("Uint8Array expected")}function B2(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function W5(t){const e=t.toString(16);return e.length&1?"0"+e:e}function RH(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Zk:BigInt("0x"+t)}const OH=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Zde=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function F2(t){if(Kk(t),OH)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Zde[t[n]];return e}const ff={_0:48,_9:57,A:65,F:70,a:97,f:102};function i$(t){if(t>=ff._0&&t<=ff._9)return t-ff._0;if(t>=ff.A&&t<=ff.F)return t-(ff.A-10);if(t>=ff.a&&t<=ff.f)return t-(ff.a-10)}function _A(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(OH)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let o=0,l=0;o<n;o++,l+=2){const h=i$(t.charCodeAt(l)),s=i$(t.charCodeAt(l+1));if(h===void 0||s===void 0){const w=t[l]+t[l+1];throw new Error('hex string expected, got non-hex character "'+w+'" at index '+l)}i[o]=h*16+s}return i}function B0(t){return RH(F2(t))}function kH(t){return Kk(t),RH(F2(Uint8Array.from(t).reverse()))}function SE(t,e){return _A(t.toString(16).padStart(e*2,"0"))}function DH(t,e){return SE(t,e).reverse()}function _u(t,e,n){let i;if(typeof e=="string")try{i=_A(e)}catch(l){throw new Error(t+" must be hex string or Uint8Array, cause: "+l)}else if(AE(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const o=i.length;if(typeof n=="number"&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return i}function wA(...t){let e=0;for(let i=0;i<t.length;i++){const o=t[i];Kk(o),e+=o.length}const n=new Uint8Array(e);for(let i=0,o=0;i<t.length;i++){const l=t[i];n.set(l,o),o+=l.length}return n}const X4=t=>typeof t=="bigint"&&Zk<=t;function Yk(t,e,n){return X4(t)&&X4(e)&&X4(n)&&e<=t&&t<n}function U1(t,e,n,i){if(!Yk(e,n,i))throw new Error("expected valid "+t+": "+n+" <= n < "+i+", got "+e)}function Kde(t){let e;for(e=0;t>Zk;t>>=p8,e+=1);return e}const jS=t=>(p8<<BigInt(t))-p8,J4=t=>new Uint8Array(t),r$=t=>Uint8Array.from(t);function Yde(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let i=J4(t),o=J4(t),l=0;const h=()=>{i.fill(1),o.fill(0),l=0},s=(...P)=>n(o,i,...P),w=(P=J4(0))=>{o=s(r$([0]),P),i=s(),P.length!==0&&(o=s(r$([1]),P),i=s())},x=()=>{if(l++>=1e3)throw new Error("drbg: tried 1000 values");let P=0;const D=[];for(;P<e;){i=s();const M=i.slice();D.push(M),P+=i.length}return wA(...D)};return(P,D)=>{h(),w(P);let M;for(;!(M=D(x()));)w();return h(),M}}const Xde={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||AE(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function VS(t,e,n={}){const i=(o,l,h)=>{const s=Xde[l];if(typeof s!="function")throw new Error("invalid validator function");const w=t[o];if(!(h&&w===void 0)&&!s(w,t))throw new Error("param "+String(o)+" is invalid. Expected "+l+", got "+w)};for(const[o,l]of Object.entries(e))i(o,l,!1);for(const[o,l]of Object.entries(n))i(o,l,!0);return t}function s$(t){const e=new WeakMap;return(n,...i)=>{const o=e.get(n);if(o!==void 0)return o;const l=t(n,...i);return e.set(n,l),l}}const Jde="0.1.1";function Qde(){return Jde}let Dc=class Ef extends Error{static setStaticOptions(e){Ef.prototype.docsOrigin=e.docsOrigin,Ef.prototype.showVersion=e.showVersion,Ef.prototype.version=e.version}constructor(e,n={}){const i=(()=>{var A;if(n.cause instanceof Ef){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:(A=n.cause)!=null&&A.message?n.cause.message:n.details})(),o=n.cause instanceof Ef&&n.cause.docsPath||n.docsPath,l=n.docsOrigin??Ef.prototype.docsOrigin,h=`${l}${o??""}`,s=!!(n.version??Ef.prototype.showVersion),w=n.version??Ef.prototype.version,x=[e||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...i||o||s?["",i?`Details: ${i}`:void 0,o?`See: ${h}`:void 0,s?`Version: ${w}`:void 0]:[]].filter(A=>typeof A=="string").join(`
`);super(x,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsOrigin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.cause=n.cause,this.details=i,this.docs=h,this.docsOrigin=l,this.docsPath=o,this.shortMessage=e,this.showVersion=s,this.version=w}walk(e){return NH(this,e)}};Object.defineProperty(Dc,"defaultStaticOptions",{enumerable:!0,configurable:!0,writable:!0,value:{docsOrigin:"https://oxlib.sh",showVersion:!1,version:`ox@${Qde()}`}});Dc.setStaticOptions(Dc.defaultStaticOptions);function NH(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?NH(t.cause,e):e?null:t}function Dw(t,e){if(a$(t)>e)throw new fhe({givenSize:a$(t),maxSize:e})}const pf={zero:48,nine:57,A:65,F:70,a:97,f:102};function o$(t){if(t>=pf.zero&&t<=pf.nine)return t-pf.zero;if(t>=pf.A&&t<=pf.F)return t-(pf.A-10);if(t>=pf.a&&t<=pf.f)return t-(pf.a-10)}function ehe(t,e={}){const{dir:n,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new phe({size:t.length,targetSize:i,type:"Bytes"});const o=new Uint8Array(i);for(let l=0;l<i;l++){const h=n==="right";o[h?l:i-l-1]=t[h?l:t.length-l-1]}return o}function MH(t,e={}){const{dir:n="left"}=e;let i=t,o=0;for(let l=0;l<i.length-1&&i[n==="left"?l:i.length-l-1].toString()==="0";l++)o++;return i=n==="left"?i.slice(o):i.slice(0,i.length-o),i}function WS(t,e){if(uw(t)>e)throw new bhe({givenSize:uw(t),maxSize:e})}function the(t,e){if(typeof e=="number"&&e>0&&e>uw(t)-1)throw new VH({offset:e,position:"start",size:uw(t)})}function nhe(t,e,n){if(typeof e=="number"&&typeof n=="number"&&uw(t)!==n-e)throw new VH({offset:n,position:"end",size:uw(t)})}function LH(t,e={}){const{dir:n,size:i=32}=e;if(i===0)return t;const o=t.replace("0x","");if(o.length>i*2)throw new vhe({size:Math.ceil(o.length/2),targetSize:i,type:"Hex"});return`0x${o[n==="right"?"padEnd":"padStart"](i*2,"0")}`}function ihe(t,e={}){const{dir:n="left"}=e;let i=t.replace("0x",""),o=0;for(let l=0;l<i.length-1&&i[n==="left"?l:i.length-l-1].toString()==="0";l++)o++;return i=n==="left"?i.slice(o):i.slice(0,i.length-o),i==="0"?"0x":n==="right"&&i.length%2===1?`0x${i}0`:`0x${i}`}const rhe="#__bigint";function BH(t,e,n){return JSON.stringify(t,(i,o)=>typeof o=="bigint"?o.toString()+rhe:o,n)}const she=new TextDecoder,ohe=new TextEncoder;function ahe(t){if(!(t instanceof Uint8Array)){if(!t)throw new H5(t);if(typeof t!="object")throw new H5(t);if(!("BYTES_PER_ELEMENT"in t))throw new H5(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new H5(t)}}function DFe(...t){let e=0;for(const i of t)e+=i.length;const n=new Uint8Array(e);for(let i=0,o=0;i<t.length;i++){const l=t[i];n.set(l,o),o+=l.length}return n}function NFe(t){return t instanceof Uint8Array?t:typeof t=="string"?FH(t):che(t)}function che(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function FH(t,e={}){const{size:n}=e;let i=t;n&&(WS(t,n),i=UH(t,n));let o=i.slice(2);o.length%2&&(o=`0${o}`);const l=o.length/2,h=new Uint8Array(l);for(let s=0,w=0;s<l;s++){const x=o$(o.charCodeAt(w++)),A=o$(o.charCodeAt(w++));if(x===void 0||A===void 0)throw new Dc(`Invalid byte sequence ("${o[w-2]}${o[w-1]}" in "${o}").`);h[s]=x<<4|A}return h}function MFe(t,e={}){const{size:n}=e,i=ohe.encode(t);return typeof n=="number"?(Dw(i,n),lhe(i,n)):i}function lhe(t,e){return ehe(t,{dir:"right",size:e})}function uhe(t){return crypto.getRandomValues(new Uint8Array(t))}function a$(t){return t.length}function LFe(t,e,n,i={}){const{strict:o}=i;return t.slice(e,n)}function BFe(t,e={}){const{size:n}=e;typeof n<"u"&&Dw(t,n);const i=lw(t,e);return jH(i,e)}function FFe(t,e={}){const{size:n}=e;let i=t;if(typeof n<"u"&&(Dw(i,n),i=dhe(i)),i.length>1||i[0]>1)throw new hhe(i);return!!i[0]}function $Fe(t,e={}){const{size:n}=e;typeof n<"u"&&Dw(t,n);const i=lw(t,e);return _he(i,e)}function zFe(t,e={}){const{size:n}=e;let i=t;return typeof n<"u"&&(Dw(i,n),i=$H(i)),she.decode(i)}function dhe(t){return MH(t,{dir:"left"})}function $H(t){return MH(t,{dir:"right"})}function UFe(t){try{return ahe(t),!0}catch{return!1}}class hhe extends Dc{constructor(e){super(`Bytes value \`${e}\` is not a valid boolean.`,{metaMessages:["The bytes array must contain a single byte of either a `0` or `1` value."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesBooleanError"})}}let H5=class extends Dc{constructor(e){super(`Value \`${typeof e=="object"?BH(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}},fhe=class extends Dc{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}},phe=class extends Dc{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}};const mhe=new TextEncoder,ghe=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function yhe(t,e={}){const{strict:n=!1}=e;if(!t)throw new c$(t);if(typeof t!="string")throw new c$(t);if(n&&!/^0x[0-9a-fA-F]*$/.test(t))throw new l$(t);if(!t.startsWith("0x"))throw new l$(t)}function HFe(...t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function GFe(t){return t instanceof Uint8Array?lw(t):Array.isArray(t)?lw(new Uint8Array(t)):t}function qFe(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(WS(n,e.size),zH(n,e.size)):n}function lw(t,e={}){let n="";for(let o=0;o<t.length;o++)n+=ghe[t[o]];const i=`0x${n}`;return typeof e.size=="number"?(WS(i,e.size),UH(i,e.size)):i}function Rf(t,e={}){const{signed:n,size:i}=e,o=BigInt(t);let l;i?n?l=(1n<<BigInt(i)*8n-1n)-1n:l=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(l=BigInt(Number.MAX_SAFE_INTEGER));const h=typeof l=="bigint"&&n?-l-1n:0;if(l&&o>l||o<h){const x=typeof t=="bigint"?"n":"";throw new whe({max:l?`${l}${x}`:void 0,min:`${h}${x}`,signed:n,size:i,value:`${t}${x}`})}const w=`0x${(n&&o<0?BigInt.asUintN(i*8,BigInt(o)):o).toString(16)}`;return i?zH(w,i):w}function ZFe(t,e={}){return lw(mhe.encode(t),e)}function zH(t,e){return LH(t,{dir:"left",size:e})}function UH(t,e){return LH(t,{dir:"right",size:e})}function KFe(t){return lw(uhe(t))}function YFe(t,e,n,i={}){const{strict:o}=i;the(t,e);const l=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return o&&nhe(l,e,n),l}function uw(t){return Math.ceil((t.length-2)/2)}function XFe(t){return ihe(t,{dir:"left"})}function jH(t,e={}){const{signed:n}=e;e.size&&WS(t,e.size);const i=BigInt(t);if(!n)return i;const o=(t.length-2)/2,l=(1n<<BigInt(o)*8n)-1n,h=l>>1n;return i<=h?i:i-l-1n}function _he(t,e={}){const{signed:n,size:i}=e;return Number(!n&&!i?t:jH(t,e))}function JFe(t,e={}){const{size:n}=e;let i=FH(t);return n&&(Dw(i,n),i=$H(i)),new TextDecoder().decode(i)}function QFe(t,e={}){const{strict:n=!1}=e;try{return yhe(t,{strict:n}),!0}catch{return!1}}let whe=class extends Dc{constructor({max:e,min:n,signed:i,size:o,value:l}){super(`Number \`${l}\` is not in safe${o?` ${o*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${n}\` to \`${e}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}},c$=class extends Dc{constructor(e){super(`Value \`${typeof e=="object"?BH(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}},l$=class extends Dc{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}};class i$e extends Dc{constructor(e){super(`Hex value \`"${e}"\` is an odd length (${e.length-2} nibbles).`,{metaMessages:["It must be an even length."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidLengthError"})}}let bhe=class extends Dc{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}},VH=class extends Dc{constructor({offset:e,position:n,size:i}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}},vhe=class extends Dc{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};function xhe(t){return{address:t.address,amount:Rf(t.amount),index:Rf(t.index),validatorIndex:Rf(t.validatorIndex)}}function Ehe(t){return{...typeof t.baseFeePerGas=="bigint"&&{baseFeePerGas:Rf(t.baseFeePerGas)},...typeof t.blobBaseFee=="bigint"&&{blobBaseFee:Rf(t.blobBaseFee)},...typeof t.feeRecipient=="string"&&{feeRecipient:t.feeRecipient},...typeof t.gasLimit=="bigint"&&{gasLimit:Rf(t.gasLimit)},...typeof t.number=="bigint"&&{number:Rf(t.number)},...typeof t.prevRandao=="bigint"&&{prevRandao:Rf(t.prevRandao)},...typeof t.time=="bigint"&&{time:Rf(t.time)},...t.withdrawals&&{withdrawals:t.withdrawals.map(xhe)}}}const bA=[{inputs:[{components:[{name:"target",type:"address"},{name:"allowFailure",type:"bool"},{name:"callData",type:"bytes"}],name:"calls",type:"tuple[]"}],name:"aggregate3",outputs:[{components:[{name:"success",type:"bool"},{name:"returnData",type:"bytes"}],name:"returnData",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{name:"addr",type:"address"}],name:"getEthBalance",outputs:[{name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],a$e=[{name:"query",type:"function",stateMutability:"view",inputs:[{type:"tuple[]",name:"queries",components:[{type:"address",name:"sender"},{type:"string[]",name:"urls"},{type:"bytes",name:"data"}]}],outputs:[{type:"bool[]",name:"failures"},{type:"bytes[]",name:"responses"}]},{name:"HttpError",type:"error",inputs:[{type:"uint16",name:"status"},{type:"string",name:"message"}]}],WH=[{inputs:[{name:"dns",type:"bytes"}],name:"DNSDecodingFailed",type:"error"},{inputs:[{name:"ens",type:"string"}],name:"DNSEncodingFailed",type:"error"},{inputs:[],name:"EmptyAddress",type:"error"},{inputs:[{name:"status",type:"uint16"},{name:"message",type:"string"}],name:"HttpError",type:"error"},{inputs:[],name:"InvalidBatchGatewayResponse",type:"error"},{inputs:[{name:"errorData",type:"bytes"}],name:"ResolverError",type:"error"},{inputs:[{name:"name",type:"bytes"},{name:"resolver",type:"address"}],name:"ResolverNotContract",type:"error"},{inputs:[{name:"name",type:"bytes"}],name:"ResolverNotFound",type:"error"},{inputs:[{name:"primary",type:"string"},{name:"primaryAddress",type:"bytes"}],name:"ReverseAddressMismatch",type:"error"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"}],name:"UnsupportedResolverProfile",type:"error"}],c$e=[...WH,{name:"resolveWithGateways",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes"},{name:"data",type:"bytes"},{name:"gateways",type:"string[]"}],outputs:[{name:"",type:"bytes"},{name:"address",type:"address"}]}],l$e=[...WH,{name:"reverseWithGateways",type:"function",stateMutability:"view",inputs:[{type:"bytes",name:"reverseName"},{type:"uint256",name:"coinType"},{type:"string[]",name:"gateways"}],outputs:[{type:"string",name:"resolvedName"},{type:"address",name:"resolver"},{type:"address",name:"reverseResolver"}]}],u$e=[{name:"text",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"key",type:"string"}],outputs:[{name:"",type:"string"}]}],d$e=[{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"}],outputs:[{name:"",type:"address"}]},{name:"addr",type:"function",stateMutability:"view",inputs:[{name:"name",type:"bytes32"},{name:"coinType",type:"uint256"}],outputs:[{name:"",type:"bytes"}]}],h$e=[{name:"isValidSignature",type:"function",stateMutability:"view",inputs:[{name:"hash",type:"bytes32"},{name:"signature",type:"bytes"}],outputs:[{name:"",type:"bytes4"}]}],f$e=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}],G5=[{type:"event",name:"Approval",inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"event",name:"Transfer",inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"name",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"totalSupply",stateMutability:"view",inputs:[],outputs:[{type:"uint256"}]},{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],p$e=[{type:"event",name:"Approval",inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"event",name:"Transfer",inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"name",stateMutability:"view",inputs:[],outputs:[{type:"bytes32"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:"bytes32"}]},{type:"function",name:"totalSupply",stateMutability:"view",inputs:[],outputs:[{type:"uint256"}]},{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],m$e=[{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"uint256",name:"balance",type:"uint256"},{internalType:"uint256",name:"needed",type:"uint256"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ERC1155InsufficientBalance",type:"error"},{inputs:[{internalType:"address",name:"approver",type:"address"}],name:"ERC1155InvalidApprover",type:"error"},{inputs:[{internalType:"uint256",name:"idsLength",type:"uint256"},{internalType:"uint256",name:"valuesLength",type:"uint256"}],name:"ERC1155InvalidArrayLength",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"}],name:"ERC1155InvalidOperator",type:"error"},{inputs:[{internalType:"address",name:"receiver",type:"address"}],name:"ERC1155InvalidReceiver",type:"error"},{inputs:[{internalType:"address",name:"sender",type:"address"}],name:"ERC1155InvalidSender",type:"error"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"address",name:"owner",type:"address"}],name:"ERC1155MissingApprovalForAll",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256[]",name:"ids",type:"uint256[]"},{indexed:!1,internalType:"uint256[]",name:"values",type:"uint256[]"}],name:"TransferBatch",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"id",type:"uint256"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"TransferSingle",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"value",type:"string"},{indexed:!0,internalType:"uint256",name:"id",type:"uint256"}],name:"URI",type:"event"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"id",type:"uint256"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"accounts",type:"address[]"},{internalType:"uint256[]",name:"ids",type:"uint256[]"}],name:"balanceOfBatch",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256[]",name:"ids",type:"uint256[]"},{internalType:"uint256[]",name:"values",type:"uint256[]"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeBatchTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"id",type:"uint256"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"uri",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}],g$e=[{type:"event",name:"Approval",inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!0,name:"tokenId",type:"uint256"}]},{type:"event",name:"ApprovalForAll",inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"operator",type:"address"},{indexed:!1,name:"approved",type:"bool"}]},{type:"event",name:"Transfer",inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!0,name:"tokenId",type:"uint256"}]},{type:"function",name:"approve",stateMutability:"payable",inputs:[{name:"spender",type:"address"},{name:"tokenId",type:"uint256"}],outputs:[]},{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"getApproved",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{type:"address"}]},{type:"function",name:"isApprovedForAll",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"operator",type:"address"}],outputs:[{type:"bool"}]},{type:"function",name:"name",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"ownerOf",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{name:"owner",type:"address"}]},{type:"function",name:"safeTransferFrom",stateMutability:"payable",inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"tokenId",type:"uint256"}],outputs:[]},{type:"function",name:"safeTransferFrom",stateMutability:"nonpayable",inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"id",type:"uint256"},{name:"data",type:"bytes"}],outputs:[]},{type:"function",name:"setApprovalForAll",stateMutability:"nonpayable",inputs:[{name:"operator",type:"address"},{name:"approved",type:"bool"}],outputs:[]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"tokenByIndex",stateMutability:"view",inputs:[{name:"index",type:"uint256"}],outputs:[{type:"uint256"}]},{type:"function",name:"tokenByIndex",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"index",type:"uint256"}],outputs:[{name:"tokenId",type:"uint256"}]},{type:"function",name:"tokenURI",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{type:"string"}]},{type:"function",name:"totalSupply",stateMutability:"view",inputs:[],outputs:[{type:"uint256"}]},{type:"function",name:"transferFrom",stateMutability:"payable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"tokenId",type:"uint256"}],outputs:[]}],y$e=[{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sender",type:"address"},{indexed:!0,name:"receiver",type:"address"},{indexed:!1,name:"assets",type:"uint256"},{indexed:!1,name:"shares",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"sender",type:"address"},{indexed:!0,name:"receiver",type:"address"},{indexed:!0,name:"owner",type:"address"},{indexed:!1,name:"assets",type:"uint256"},{indexed:!1,name:"shares",type:"uint256"}],name:"Withdraw",type:"event"},{inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],name:"allowance",outputs:[{type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],name:"approve",outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"asset",outputs:[{name:"assetTokenAddress",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{name:"account",type:"address"}],name:"balanceOf",outputs:[{type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"shares",type:"uint256"}],name:"convertToAssets",outputs:[{name:"assets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"assets",type:"uint256"}],name:"convertToShares",outputs:[{name:"shares",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"assets",type:"uint256"},{name:"receiver",type:"address"}],name:"deposit",outputs:[{name:"shares",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"caller",type:"address"}],name:"maxDeposit",outputs:[{name:"maxAssets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"caller",type:"address"}],name:"maxMint",outputs:[{name:"maxShares",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"owner",type:"address"}],name:"maxRedeem",outputs:[{name:"maxShares",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"owner",type:"address"}],name:"maxWithdraw",outputs:[{name:"maxAssets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"shares",type:"uint256"},{name:"receiver",type:"address"}],name:"mint",outputs:[{name:"assets",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"assets",type:"uint256"}],name:"previewDeposit",outputs:[{name:"shares",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"shares",type:"uint256"}],name:"previewMint",outputs:[{name:"assets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"shares",type:"uint256"}],name:"previewRedeem",outputs:[{name:"assets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"assets",type:"uint256"}],name:"previewWithdraw",outputs:[{name:"shares",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"shares",type:"uint256"},{name:"receiver",type:"address"},{name:"owner",type:"address"}],name:"redeem",outputs:[{name:"assets",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"totalAssets",outputs:[{name:"totalManagedAssets",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"to",type:"address"},{name:"amount",type:"uint256"}],name:"transfer",outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"assets",type:"uint256"},{name:"receiver",type:"address"},{name:"owner",type:"address"}],name:"withdraw",outputs:[{name:"shares",type:"uint256"}],stateMutability:"nonpayable",type:"function"}],Che="0x82ad56cb",The="0x608060405234801561001057600080fd5b5060405161018e38038061018e83398101604081905261002f91610124565b6000808351602085016000f59050803b61004857600080fd5b6000808351602085016000855af16040513d6000823e81610067573d81fd5b3d81f35b634e487b7160e01b600052604160045260246000fd5b600082601f83011261009257600080fd5b81516001600160401b038111156100ab576100ab61006b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156100d9576100d961006b565b6040528181528382016020018510156100f157600080fd5b60005b82811015610110576020818601810151838301820152016100f4565b506000918101602001919091529392505050565b6000806040838503121561013757600080fd5b82516001600160401b0381111561014d57600080fd5b61015985828601610081565b602085015190935090506001600160401b0381111561017757600080fd5b61018385828601610081565b915050925092905056fe",Ahe="0x608060405234801561001057600080fd5b506040516102c03803806102c083398101604081905261002f916101e6565b836001600160a01b03163b6000036100e457600080836001600160a01b03168360405161005c9190610270565b6000604051808303816000865af19150503d8060008114610099576040519150601f19603f3d011682016040523d82523d6000602084013e61009e565b606091505b50915091508115806100b857506001600160a01b0386163b155b156100e1578060405163101bb98d60e01b81526004016100d8919061028c565b60405180910390fd5b50505b6000808451602086016000885af16040513d6000823e81610103573d81fd5b3d81f35b80516001600160a01b038116811461011e57600080fd5b919050565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561015457818101518382015260200161013c565b50506000910152565b600082601f83011261016e57600080fd5b81516001600160401b0381111561018757610187610123565b604051601f8201601f19908116603f011681016001600160401b03811182821017156101b5576101b5610123565b6040528181528382016020018510156101cd57600080fd5b6101de826020830160208701610139565b949350505050565b600080600080608085870312156101fc57600080fd5b61020585610107565b60208601519094506001600160401b0381111561022157600080fd5b61022d8782880161015d565b93505061023c60408601610107565b60608601519092506001600160401b0381111561025857600080fd5b6102648782880161015d565b91505092959194509250565b60008251610282818460208701610139565b9190910192915050565b60208152600082518060208401526102ab816040850160208701610139565b601f01601f1916919091016040019291505056fe",_$e="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",She="0x608060405234801561001057600080fd5b506115b9806100206000396000f3fe6080604052600436106100f35760003560e01c80634d2301cc1161008a578063a8b0574e11610059578063a8b0574e14610325578063bce38bd714610350578063c3077fa914610380578063ee82ac5e146103b2576100f3565b80634d2301cc1461026257806372425d9d1461029f57806382ad56cb146102ca57806386d516e8146102fa576100f3565b80633408e470116100c65780633408e470146101af578063399542e9146101da5780633e64a6961461020c57806342cbb15c14610237576100f3565b80630f28c97d146100f8578063174dea7114610123578063252dba421461015357806327e86d6e14610184575b600080fd5b34801561010457600080fd5b5061010d6103ef565b60405161011a9190610c0a565b60405180910390f35b61013d60048036038101906101389190610c94565b6103f7565b60405161014a9190610e94565b60405180910390f35b61016d60048036038101906101689190610f0c565b610615565b60405161017b92919061101b565b60405180910390f35b34801561019057600080fd5b506101996107ab565b6040516101a69190611064565b60405180910390f35b3480156101bb57600080fd5b506101c46107b7565b6040516101d19190610c0a565b60405180910390f35b6101f460048036038101906101ef91906110ab565b6107bf565b6040516102039392919061110b565b60405180910390f35b34801561021857600080fd5b506102216107e1565b60405161022e9190610c0a565b60405180910390f35b34801561024357600080fd5b5061024c6107e9565b6040516102599190610c0a565b60405180910390f35b34801561026e57600080fd5b50610289600480360381019061028491906111a7565b6107f1565b6040516102969190610c0a565b60405180910390f35b3480156102ab57600080fd5b506102b4610812565b6040516102c19190610c0a565b60405180910390f35b6102e460048036038101906102df919061122a565b61081a565b6040516102f19190610e94565b60405180910390f35b34801561030657600080fd5b5061030f6109e4565b60405161031c9190610c0a565b60405180910390f35b34801561033157600080fd5b5061033a6109ec565b6040516103479190611286565b60405180910390f35b61036a600480360381019061036591906110ab565b6109f4565b6040516103779190610e94565b60405180910390f35b61039a60048036038101906103959190610f0c565b610ba6565b6040516103a99392919061110b565b60405180910390f35b3480156103be57600080fd5b506103d960048036038101906103d491906112cd565b610bca565b6040516103e69190611064565b60405180910390f35b600042905090565b60606000808484905090508067ffffffffffffffff81111561041c5761041b6112fa565b5b60405190808252806020026020018201604052801561045557816020015b610442610bd5565b81526020019060019003908161043a5790505b5092503660005b828110156105c957600085828151811061047957610478611329565b5b6020026020010151905087878381811061049657610495611329565b5b90506020028101906104a89190611367565b925060008360400135905080860195508360000160208101906104cb91906111a7565b73ffffffffffffffffffffffffffffffffffffffff16818580606001906104f2919061138f565b604051610500929190611431565b60006040518083038185875af1925050503d806000811461053d576040519150601f19603f3d011682016040523d82523d6000602084013e610542565b606091505b5083600001846020018290528215151515815250505081516020850135176105bc577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260846000fd5b826001019250505061045c565b5082341461060c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610603906114a7565b60405180910390fd5b50505092915050565b6000606043915060008484905090508067ffffffffffffffff81111561063e5761063d6112fa565b5b60405190808252806020026020018201604052801561067157816020015b606081526020019060019003908161065c5790505b5091503660005b828110156107a157600087878381811061069557610694611329565b5b90506020028101906106a791906114c7565b92508260000160208101906106bc91906111a7565b73ffffffffffffffffffffffffffffffffffffffff168380602001906106e2919061138f565b6040516106f0929190611431565b6000604051808303816000865af19150503d806000811461072d576040519150601f19603f3d011682016040523d82523d6000602084013e610732565b606091505b5086848151811061074657610745611329565b5b60200260200101819052819250505080610795576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161078c9061153b565b60405180910390fd5b81600101915050610678565b5050509250929050565b60006001430340905090565b600046905090565b6000806060439250434091506107d68686866109f4565b905093509350939050565b600048905090565b600043905090565b60008173ffffffffffffffffffffffffffffffffffffffff16319050919050565b600044905090565b606060008383905090508067ffffffffffffffff81111561083e5761083d6112fa565b5b60405190808252806020026020018201604052801561087757816020015b610864610bd5565b81526020019060019003908161085c5790505b5091503660005b828110156109db57600084828151811061089b5761089a611329565b5b602002602001015190508686838181106108b8576108b7611329565b5b90506020028101906108ca919061155b565b92508260000160208101906108df91906111a7565b73ffffffffffffffffffffffffffffffffffffffff16838060400190610905919061138f565b604051610913929190611431565b6000604051808303816000865af19150503d8060008114610950576040519150601f19603f3d011682016040523d82523d6000602084013e610955565b606091505b5082600001836020018290528215151515815250505080516020840135176109cf577f08c379a000000000000000000000000000000000000000000000000000000000600052602060045260176024527f4d756c746963616c6c333a2063616c6c206661696c656400000000000000000060445260646000fd5b8160010191505061087e565b50505092915050565b600045905090565b600041905090565b606060008383905090508067ffffffffffffffff811115610a1857610a176112fa565b5b604051908082528060200260200182016040528015610a5157816020015b610a3e610bd5565b815260200190600190039081610a365790505b5091503660005b82811015610b9c576000848281518110610a7557610a74611329565b5b60200260200101519050868683818110610a9257610a91611329565b5b9050602002810190610aa491906114c7565b9250826000016020810190610ab991906111a7565b73ffffffffffffffffffffffffffffffffffffffff16838060200190610adf919061138f565b604051610aed929190611431565b6000604051808303816000865af19150503d8060008114610b2a576040519150601f19603f3d011682016040523d82523d6000602084013e610b2f565b606091505b508260000183602001829052821515151581525050508715610b90578060000151610b8f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b869061153b565b60405180910390fd5b5b81600101915050610a58565b5050509392505050565b6000806060610bb7600186866107bf565b8093508194508295505050509250925092565b600081409050919050565b6040518060400160405280600015158152602001606081525090565b6000819050919050565b610c0481610bf1565b82525050565b6000602082019050610c1f6000830184610bfb565b92915050565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b60008083601f840112610c5457610c53610c2f565b5b8235905067ffffffffffffffff811115610c7157610c70610c34565b5b602083019150836020820283011115610c8d57610c8c610c39565b5b9250929050565b60008060208385031215610cab57610caa610c25565b5b600083013567ffffffffffffffff811115610cc957610cc8610c2a565b5b610cd585828601610c3e565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b60008115159050919050565b610d2281610d0d565b82525050565b600081519050919050565b600082825260208201905092915050565b60005b83811015610d62578082015181840152602081019050610d47565b83811115610d71576000848401525b50505050565b6000601f19601f8301169050919050565b6000610d9382610d28565b610d9d8185610d33565b9350610dad818560208601610d44565b610db681610d77565b840191505092915050565b6000604083016000830151610dd96000860182610d19565b5060208301518482036020860152610df18282610d88565b9150508091505092915050565b6000610e0a8383610dc1565b905092915050565b6000602082019050919050565b6000610e2a82610ce1565b610e348185610cec565b935083602082028501610e4685610cfd565b8060005b85811015610e825784840389528151610e638582610dfe565b9450610e6e83610e12565b925060208a01995050600181019050610e4a565b50829750879550505050505092915050565b60006020820190508181036000830152610eae8184610e1f565b905092915050565b60008083601f840112610ecc57610ecb610c2f565b5b8235905067ffffffffffffffff811115610ee957610ee8610c34565b5b602083019150836020820283011115610f0557610f04610c39565b5b9250929050565b60008060208385031215610f2357610f22610c25565b5b600083013567ffffffffffffffff811115610f4157610f40610c2a565b5b610f4d85828601610eb6565b92509250509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b6000610f918383610d88565b905092915050565b6000602082019050919050565b6000610fb182610f59565b610fbb8185610f64565b935083602082028501610fcd85610f75565b8060005b858110156110095784840389528151610fea8582610f85565b9450610ff583610f99565b925060208a01995050600181019050610fd1565b50829750879550505050505092915050565b60006040820190506110306000830185610bfb565b81810360208301526110428184610fa6565b90509392505050565b6000819050919050565b61105e8161104b565b82525050565b60006020820190506110796000830184611055565b92915050565b61108881610d0d565b811461109357600080fd5b50565b6000813590506110a58161107f565b92915050565b6000806000604084860312156110c4576110c3610c25565b5b60006110d286828701611096565b935050602084013567ffffffffffffffff8111156110f3576110f2610c2a565b5b6110ff86828701610eb6565b92509250509250925092565b60006060820190506111206000830186610bfb565b61112d6020830185611055565b818103604083015261113f8184610e1f565b9050949350505050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061117482611149565b9050919050565b61118481611169565b811461118f57600080fd5b50565b6000813590506111a18161117b565b92915050565b6000602082840312156111bd576111bc610c25565b5b60006111cb84828501611192565b91505092915050565b60008083601f8401126111ea576111e9610c2f565b5b8235905067ffffffffffffffff81111561120757611206610c34565b5b60208301915083602082028301111561122357611222610c39565b5b9250929050565b6000806020838503121561124157611240610c25565b5b600083013567ffffffffffffffff81111561125f5761125e610c2a565b5b61126b858286016111d4565b92509250509250929050565b61128081611169565b82525050565b600060208201905061129b6000830184611277565b92915050565b6112aa81610bf1565b81146112b557600080fd5b50565b6000813590506112c7816112a1565b92915050565b6000602082840312156112e3576112e2610c25565b5b60006112f1848285016112b8565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600080fd5b600080fd5b600080fd5b60008235600160800383360303811261138357611382611358565b5b80830191505092915050565b600080833560016020038436030381126113ac576113ab611358565b5b80840192508235915067ffffffffffffffff8211156113ce576113cd61135d565b5b6020830192506001820236038313156113ea576113e9611362565b5b509250929050565b600081905092915050565b82818337600083830152505050565b600061141883856113f2565b93506114258385846113fd565b82840190509392505050565b600061143e82848661140c565b91508190509392505050565b600082825260208201905092915050565b7f4d756c746963616c6c333a2076616c7565206d69736d61746368000000000000600082015250565b6000611491601a8361144a565b915061149c8261145b565b602082019050919050565b600060208201905081810360008301526114c081611484565b9050919050565b6000823560016040038336030381126114e3576114e2611358565b5b80830191505092915050565b7f4d756c746963616c6c333a2063616c6c206661696c6564000000000000000000600082015250565b600061152560178361144a565b9150611530826114ef565b602082019050919050565b6000602082019050818103600083015261155481611518565b9050919050565b60008235600160600383360303811261157757611576611358565b5b8083019150509291505056fea264697066735822122020c1bc9aacf8e4a6507193432a895a8e77094f45a1395583f07b24e860ef06cd64736f6c634300080c0033";class m8 extends ln{constructor({blockNumber:e,chain:n,contract:i}){super(`Chain "${n.name}" does not support contract "${i.name}".`,{metaMessages:["This could be due to any of the following:",...e&&i.blockCreated&&i.blockCreated>e?[`- The contract "${i.name}" was not deployed until block ${i.blockCreated} (current block ${e}).`]:[`- The chain does not have the contract "${i.name}" configured.`]],name:"ChainDoesNotSupportContract"})}}class Ihe extends ln{constructor({chain:e,currentChainId:n}){super(`The current chain of the wallet (id: ${n}) does not match the target chain for the transaction (id: ${e.id}  ${e.name}).`,{metaMessages:[`Current Chain ID:  ${n}`,`Expected Chain ID: ${e.id}  ${e.name}`],name:"ChainMismatchError"})}}class Phe extends ln{constructor(){super(["No chain was provided to the request.","Please provide a chain with the `chain` argument on the Action, or by supplying a `chain` to WalletClient."].join(`
`),{name:"ChainNotFoundError"})}}class HH extends ln{constructor(){super("No chain was provided to the Client.",{name:"ClientChainNotConfiguredError"})}}class w$e extends ln{constructor({chainId:e}){super(typeof e=="number"?`Chain ID "${e}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}const Q4="/docs/contract/encodeDeployData";function GH(t){const{abi:e,args:n,bytecode:i}=t;if(!n||n.length===0)return i;const o=e.find(h=>"type"in h&&h.type==="constructor");if(!o)throw new ple({docsPath:Q4});if(!("inputs"in o))throw new DF({docsPath:Q4});if(!o.inputs||o.inputs.length===0)throw new DF({docsPath:Q4});const l=XW(o.inputs,n);return LS([i,l])}function Rhe({blockNumber:t,chain:e,contract:n}){var o;const i=(o=e==null?void 0:e.contracts)==null?void 0:o[n];if(!i)throw new m8({chain:e,contract:{name:n}});if(t&&i.blockCreated&&i.blockCreated>t)throw new m8({blockNumber:t,chain:e,contract:{name:n,blockCreated:i.blockCreated}});return i.address}function Ohe(t,{docsPath:e,...n}){const i=(()=>{const o=Vk(t,n);return o instanceof FS?t:o})();return new Que(i,{docsPath:e,...n})}function qH(){let t=()=>{},e=()=>{};return{promise:new Promise((i,o)=>{t=i,e=o}),resolve:t,reject:e}}const eP=new Map;function ZH({fn:t,id:e,shouldSplitBatch:n,wait:i=0,sort:o}){const l=async()=>{const A=w();h();const P=A.map(({args:D})=>D);P.length!==0&&t(P).then(D=>{o&&Array.isArray(D)&&D.sort(o);for(let M=0;M<A.length;M++){const{resolve:z}=A[M];z==null||z([D[M],D])}}).catch(D=>{for(let M=0;M<A.length;M++){const{reject:z}=A[M];z==null||z(D)}})},h=()=>eP.delete(e),s=()=>w().map(({args:A})=>A),w=()=>eP.get(e)||[],x=A=>eP.set(e,[...w(),A]);return{flush:h,async schedule(A){const{promise:P,resolve:D,reject:M}=qH();return(n==null?void 0:n([...s(),A]))&&l(),w().length>0?(x({args:A,resolve:D,reject:M}),P):(x({args:A,resolve:D,reject:M}),setTimeout(l,i),P)}}}async function KH(t,e){var je,Ye,re,le;const{account:n=t.account,authorizationList:i,batch:o=!!((je=t.batch)!=null&&je.multicall),blockNumber:l,blockTag:h=t.experimental_blockTag??"latest",accessList:s,blobs:w,blockOverrides:x,code:A,data:P,factory:D,factoryData:M,gas:z,gasPrice:U,maxFeePerBlobGas:G,maxFeePerGas:ne,maxPriorityFeePerGas:oe,nonce:Q,to:de,value:he,stateOverride:Ie,...ke}=e,Ue=n?Tu(n):void 0;if(A&&(D||M))throw new ln("Cannot provide both `code` & `factory`/`factoryData` as parameters.");if(A&&de)throw new ln("Cannot provide both `code` & `to` as parameters.");const ze=A&&P,ht=D&&M&&de&&P,ft=ze||ht,ct=ze?YH({code:A,data:P}):ht?Nhe({data:P,factory:D,factoryData:M,to:de}):P;try{TE(e);const Le=(typeof l=="bigint"?ar(l):void 0)||h,De=x?Ehe(x):void 0,He=uH(Ie),Et=(le=(re=(Ye=t.chain)==null?void 0:Ye.formatters)==null?void 0:re.transactionRequest)==null?void 0:le.format,Dt=(Et||CE)({...$S(ke,{format:Et}),accessList:s,account:Ue,authorizationList:i,blobs:w,data:ct,gas:z,gasPrice:U,maxFeePerBlobGas:G,maxFeePerGas:ne,maxPriorityFeePerGas:oe,nonce:Q,to:ft?void 0:de,value:he},"call");if(o&&khe({request:Dt})&&!He&&!De)try{return await Dhe(t,{...Dt,blockNumber:l,blockTag:h})}catch(yn){if(!(yn instanceof HH)&&!(yn instanceof m8))throw yn}const Bt=(()=>{const yn=[Dt,Le];return He&&De?[...yn,He,De]:He?[...yn,He]:De?[...yn,{},De]:yn})(),Yt=await t.request({method:"eth_call",params:Bt});return Yt==="0x"?{data:void 0}:{data:Yt}}catch(Ae){const Le=Mhe(Ae),{offchainLookup:De,offchainLookupSignature:He}=await Un(async()=>{const{offchainLookup:Et,offchainLookupSignature:Ct}=await import("./ccip-DhugKRZf.js");return{offchainLookup:Et,offchainLookupSignature:Ct}},__vite__mapDeps([0,1,2,3,4,5]));if(t.ccipRead!==!1&&(Le==null?void 0:Le.slice(0,10))===He&&de)return{data:await De(t,{data:Le,to:de})};throw ft&&(Le==null?void 0:Le.slice(0,10))==="0x101bb98d"?new ide({factory:D}):Ohe(Ae,{...e,account:Ue,chain:t.chain})}}function khe({request:t}){const{data:e,to:n,...i}=t;return!(!e||e.startsWith(Che)||!n||Object.values(i).filter(o=>typeof o<"u").length>0)}async function Dhe(t,e){var U;const{batchSize:n=1024,deployless:i=!1,wait:o=0}=typeof((U=t.batch)==null?void 0:U.multicall)=="object"?t.batch.multicall:{},{blockNumber:l,blockTag:h=t.experimental_blockTag??"latest",data:s,to:w}=e,x=(()=>{if(i)return null;if(e.multicallAddress)return e.multicallAddress;if(t.chain)return Rhe({blockNumber:l,chain:t.chain,contract:"multicall3"});throw new HH})(),P=(typeof l=="bigint"?ar(l):void 0)||h,{schedule:D}=ZH({id:`${t.uid}.${P}`,wait:o,shouldSplitBatch(G){return G.reduce((oe,{data:Q})=>oe+(Q.length-2),0)>n*2},fn:async G=>{const ne=G.map(de=>({allowFailure:!0,callData:de.data,target:de.to})),oe=Fk({abi:bA,args:[ne],functionName:"aggregate3"}),Q=await t.request({method:"eth_call",params:[{...x===null?{data:YH({code:She,data:oe})}:{to:x,data:oe}},P]});return PH({abi:bA,args:[ne],functionName:"aggregate3",data:Q||"0x"})}}),[{returnData:M,success:z}]=await D({data:s,to:w});if(!z)throw new oH({data:M});return M==="0x"?{data:void 0}:{data:M}}function YH(t){const{code:e,data:n}=t;return GH({abi:PW(["constructor(bytes, bytes)"]),bytecode:The,args:[e,n]})}function Nhe(t){const{data:e,factory:n,factoryData:i,to:o}=t;return GH({abi:PW(["constructor(address, bytes, address, bytes)"]),bytecode:Ahe,args:[o,e,n,i]})}function Mhe(t){var n;if(!(t instanceof ln))return;const e=t.walk();return typeof(e==null?void 0:e.data)=="object"?(n=e.data)==null?void 0:n.data:e.data}const tP=new Map,u$=new Map;let Lhe=0;function vA(t,e,n){const i=++Lhe,o=()=>tP.get(t)||[],l=()=>{const A=o();tP.set(t,A.filter(P=>P.id!==i))},h=()=>{const A=o();if(!A.some(D=>D.id===i))return;const P=u$.get(t);if(A.length===1&&P){const D=P();D instanceof Promise&&D.catch(()=>{})}l()},s=o();if(tP.set(t,[...s,{id:i,fns:e}]),s&&s.length>0)return h;const w={};for(const A in e)w[A]=(...P)=>{var M,z;const D=o();if(D.length!==0)for(const U of D)(z=(M=U.fns)[A])==null||z.call(M,...P)};const x=n(w);return typeof x=="function"&&u$.set(t,x),h}async function xA(t){return new Promise(e=>setTimeout(e,t))}function XH(t,{emitOnBegin:e,initialWaitTime:n,interval:i}){let o=!0;const l=()=>o=!1;return(async()=>{let s;e&&(s=await t({unpoll:l}));const w=await(n==null?void 0:n(s))??i;await xA(w);const x=async()=>{o&&(await t({unpoll:l}),await xA(i),x())};x()})(),l}const Bhe=new Map,Fhe=new Map;function $he(t){const e=(o,l)=>({clear:()=>l.delete(o),get:()=>l.get(o),set:h=>l.set(o,h)}),n=e(t,Bhe),i=e(t,Fhe);return{clear:()=>{n.clear(),i.clear()},promise:n,response:i}}async function zhe(t,{cacheKey:e,cacheTime:n=Number.POSITIVE_INFINITY}){const i=$he(e),o=i.response.get();if(o&&n>0&&Date.now()-o.created.getTime()<n)return o.data;let l=i.promise.get();l||(l=t(),i.promise.set(l));try{const h=await l;return i.response.set({created:new Date,data:h}),h}finally{i.promise.clear()}}const Uhe=t=>`blockNumber.${t}`;async function jhe(t,{cacheTime:e=t.cacheTime}={}){const n=await zhe(()=>t.request({method:"eth_blockNumber"}),{cacheKey:Uhe(t.uid),cacheTime:e});return BigInt(n)}async function Vhe(t,{filter:e}){const n="strict"in e&&e.strict,i=await e.request({method:"eth_getFilterChanges",params:[e.id]});if(typeof i[0]=="string")return i;const o=i.map(l=>IH(l));return!("abi"in e)||!e.abi?o:Gde({abi:e.abi,logs:o,strict:n})}async function Whe(t,{filter:e}){return e.request({method:"eth_uninstallFilter",params:[e.id]})}class Xk extends ln{constructor({docsPath:e}={}){super(["Could not find an Account to execute with this Action.","Please provide an Account with the `account` argument on the Action, or by supplying an `account` to the Client."].join(`
`),{docsPath:e,docsSlug:"account",name:"AccountNotFoundError"})}}class nP extends ln{constructor({docsPath:e,metaMessages:n,type:i}){super(`Account type "${i}" is not supported.`,{docsPath:e,metaMessages:n,name:"AccountTypeNotSupportedError"})}}function Hhe({chain:t,currentChainId:e}){if(!t)throw new Phe;if(e!==t.id)throw new Ihe({chain:t,currentChainId:e})}async function Ghe(t,{serializedTransaction:e}){return t.request({method:"eth_sendRawTransaction",params:[e]},{retryCount:0})}const iP=new wE(128);async function JH(t,e){var de,he,Ie,ke,Ue;const{account:n=t.account,assertChainId:i=!0,chain:o=t.chain,accessList:l,authorizationList:h,blobs:s,data:w,dataSuffix:x=typeof t.dataSuffix=="string"?t.dataSuffix:(de=t.dataSuffix)==null?void 0:de.value,gas:A,gasPrice:P,maxFeePerBlobGas:D,maxFeePerGas:M,maxPriorityFeePerGas:z,nonce:U,type:G,value:ne,...oe}=e;if(typeof n>"u")throw new Xk({docsPath:"/docs/actions/wallet/sendTransaction"});const Q=n?Tu(n):null;try{TE(e);const ze=await(async()=>{if(e.to)return e.to;if(e.to!==null&&h&&h.length>0)return await lH({authorization:h[0]}).catch(()=>{throw new ln("`to` is required. Could not infer from `authorizationList`.")})})();if((Q==null?void 0:Q.type)==="json-rpc"||Q===null){let ht;o!==null&&(ht=await is(t,Gk,"getChainId")({}),i&&Hhe({currentChainId:ht,chain:o}));const ft=(ke=(Ie=(he=t.chain)==null?void 0:he.formatters)==null?void 0:Ie.transactionRequest)==null?void 0:ke.format,je=(ft||CE)({...$S(oe,{format:ft}),accessList:l,account:Q,authorizationList:h,blobs:s,chainId:ht,data:w&&Bm([w,x??"0x"]),gas:A,gasPrice:P,maxFeePerBlobGas:D,maxFeePerGas:M,maxPriorityFeePerGas:z,nonce:U,to:ze,type:G,value:ne},"sendTransaction"),Ye=iP.get(t.uid),re=Ye?"wallet_sendTransaction":"eth_sendTransaction";try{return await t.request({method:re,params:[je]},{retryCount:0})}catch(le){if(Ye===!1)throw le;const Ae=le;if(Ae.name==="InvalidInputRpcError"||Ae.name==="InvalidParamsRpcError"||Ae.name==="MethodNotFoundRpcError"||Ae.name==="MethodNotSupportedRpcError")return await t.request({method:"wallet_sendTransaction",params:[je]},{retryCount:0}).then(Le=>(iP.set(t.uid,!0),Le)).catch(Le=>{const De=Le;throw De.name==="MethodNotFoundRpcError"||De.name==="MethodNotSupportedRpcError"?(iP.set(t.uid,!1),Ae):De});throw Ae}}if((Q==null?void 0:Q.type)==="local"){const ht=await is(t,qk,"prepareTransactionRequest")({account:Q,accessList:l,authorizationList:h,blobs:s,chain:o,data:w&&Bm([w,x??"0x"]),gas:A,gasPrice:P,maxFeePerBlobGas:D,maxFeePerGas:M,maxPriorityFeePerGas:z,nonce:U,nonceManager:Q.nonceManager,parameters:[...AH,"sidecars"],type:G,value:ne,...oe,to:ze}),ft=(Ue=o==null?void 0:o.serializers)==null?void 0:Ue.transaction,ct=await Q.signTransaction(ht,{serializer:ft});return await is(t,Ghe,"sendRawTransaction")({serializedTransaction:ct})}throw(Q==null?void 0:Q.type)==="smart"?new nP({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new nP({docsPath:"/docs/actions/wallet/sendTransaction",type:Q==null?void 0:Q.type})}catch(ze){throw ze instanceof nP?ze:TH(ze,{...e,account:Q,chain:e.chain||void 0})}}async function EA(t,e){return EA.internal(t,JH,"sendTransaction",e)}(function(t){async function e(n,i,o,l){const{abi:h,account:s=n.account,address:w,args:x,functionName:A,...P}=l;if(typeof s>"u")throw new Xk({docsPath:"/docs/contract/writeContract"});const D=s?Tu(s):null,M=Fk({abi:h,args:x,functionName:A});try{return await is(n,i,o)({data:M,to:w,account:D,...P})}catch(z){throw ade(z,{abi:h,address:w,args:x,docsPath:"/docs/contract/writeContract",functionName:A,sender:D==null?void 0:D.address})}}t.internal=e})(EA||(EA={}));function CA(t,{delay:e=100,retryCount:n=2,shouldRetry:i=()=>!0}={}){return new Promise((o,l)=>{const h=async({count:s=0}={})=>{const w=async({error:x})=>{const A=typeof e=="function"?e({count:s,error:x}):e;A&&await xA(A),h({count:s+1})};try{const x=await t();o(x)}catch(x){if(s<n&&await i({count:s,error:x}))return w({error:x});l(x)}};h()})}const qhe={"0x0":"reverted","0x1":"success"};function QH(t,e){const n={...t,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs?t.logs.map(i=>IH(i)):null,to:t.to?t.to:null,transactionIndex:t.transactionIndex?Nm(t.transactionIndex):null,status:t.status?qhe[t.status]:null,type:t.type?fH[t.type]||t.type:null};return t.blobGasPrice&&(n.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(n.blobGasUsed=BigInt(t.blobGasUsed)),n}const b$e=zS("transactionReceipt",QH),g8=256;let q5=g8,Z5;function eG(t=11){if(!Z5||q5+t>g8*2){Z5="",q5=0;for(let e=0;e<g8;e++)Z5+=(256+Math.random()*256|0).toString(16).substring(1)}return Z5.substring(q5,q5+++t)}function tG(t){const{batch:e,chain:n,ccipRead:i,dataSuffix:o,key:l="base",name:h="Base Client",type:s="base"}=t,w=t.experimental_blockTag??(typeof(n==null?void 0:n.experimental_preconfirmationTime)=="number"?"pending":void 0),x=(n==null?void 0:n.blockTime)??12e3,A=Math.min(Math.max(Math.floor(x/2),500),4e3),P=t.pollingInterval??A,D=t.cacheTime??P,M=t.account?Tu(t.account):void 0,{config:z,request:U,value:G}=t.transport({account:M,chain:n,pollingInterval:P}),ne={...z,...G},oe={account:M,batch:e,cacheTime:D,ccipRead:i,chain:n,dataSuffix:o,key:l,name:h,pollingInterval:P,request:U,transport:ne,type:s,uid:eG(),...w?{experimental_blockTag:w}:{}};function Q(de){return he=>{const Ie=he(de);for(const Ue in oe)delete Ie[Ue];const ke={...de,...Ie};return Object.assign(ke,{extend:Q(ke)})}}return Object.assign(oe,{extend:Q(oe)})}function v$e(){return null}async function Zhe(t){const e=Pue(t,{method:"eth_newPendingTransactionFilter"}),n=await t.request({method:"eth_newPendingTransactionFilter"});return{id:n,request:e(n),type:"transaction"}}async function Khe(t,{address:e,blockNumber:n,blockTag:i=t.experimental_blockTag??"latest"}){var h,s,w;if((h=t.batch)!=null&&h.multicall&&((w=(s=t.chain)==null?void 0:s.contracts)!=null&&w.multicall3)){const x=t.chain.contracts.multicall3.address,A=Fk({abi:bA,functionName:"getEthBalance",args:[e]}),{data:P}=await is(t,KH,"call")({to:x,data:A,blockNumber:n,blockTag:i});return PH({abi:bA,functionName:"getEthBalance",args:[e],data:P||"0x"})}const o=typeof n=="bigint"?ar(n):void 0,l=await t.request({method:"eth_getBalance",params:[e,o||i]});return BigInt(l)}const K5=new wE(8192);function Yhe(t,{enabled:e=!0,id:n}){if(!e||!n)return t();if(K5.get(n))return K5.get(n);const i=t().finally(()=>K5.delete(n));return K5.set(n,i),i}function Xhe(t,e={}){return async(n,i={})=>{var P;const{dedupe:o=!1,methods:l,retryDelay:h=150,retryCount:s=3,uid:w}={...e,...i},{method:x}=n;if((P=l==null?void 0:l.exclude)!=null&&P.includes(x))throw new C0(new Error("method not supported"),{method:x});if(l!=null&&l.include&&!l.include.includes(x))throw new C0(new Error("method not supported"),{method:x});const A=o?kS(`${w}.${Ul(n)}`):void 0;return Yhe(()=>CA(async()=>{try{return await t(n)}catch(D){const M=D;switch(M.code){case b2.code:throw new b2(M);case v2.code:throw new v2(M);case x2.code:throw new x2(M,{method:n.method});case E2.code:throw new E2(M);case X0.code:throw new X0(M);case rw.code:throw new rw(M);case C2.code:throw new C2(M);case Tm.code:throw new Tm(M);case sw.code:throw new sw(M);case C0.code:throw new C0(M,{method:n.method});case ow.code:throw new ow(M);case T2.code:throw new T2(M);case to.code:throw new to(M);case A2.code:throw new A2(M);case S2.code:throw new S2(M);case I2.code:throw new I2(M);case P2.code:throw new P2(M);case Ah.code:throw new Ah(M);case R2.code:throw new R2(M);case O2.code:throw new O2(M);case k2.code:throw new k2(M);case D2.code:throw new D2(M);case N2.code:throw new N2(M);case M2.code:throw new M2(M);case L2.code:throw new L2(M);case 5e3:throw new to(M);case aw.code:throw new aw(M);default:throw D instanceof ln?D:new sde(M)}}},{delay:({count:D,error:M})=>{var z;if(M&&M instanceof Fx){const U=(z=M==null?void 0:M.headers)==null?void 0:z.get("Retry-After");if(U!=null&&U.match(/\d/))return Number.parseInt(U,10)*1e3}return~~(1<<D)*h},retryCount:s,shouldRetry:({error:D})=>Jhe(D)}),{enabled:o,id:A})}}function Jhe(t){return"code"in t&&typeof t.code=="number"?t.code===-1||t.code===ow.code||t.code===X0.code:t instanceof Fx&&t.status?t.status===403||t.status===408||t.status===413||t.status===429||t.status===500||t.status===502||t.status===503||t.status===504:!0}function Jk(t){const e={formatters:void 0,fees:void 0,serializers:void 0,...t};function n(i){return o=>{const l=typeof o=="function"?o(i):o,h={...i,...l};return Object.assign(h,{extend:n(h)})}}return Object.assign(e,{extend:n(e)})}function x$e(){return{}}function nG(t,{errorInstance:e=new Error("timed out"),timeout:n,signal:i}){return new Promise((o,l)=>{(async()=>{let h;try{const s=new AbortController;n>0&&(h=setTimeout(()=>{i?s.abort():l(e)},n)),o(await t({signal:(s==null?void 0:s.signal)||null}))}catch(s){(s==null?void 0:s.name)==="AbortError"&&l(e),l(s)}finally{clearTimeout(h)}})()})}function Qhe(){return{current:0,take(){return this.current++},reset(){this.current=0}}}const d$=Qhe();function efe(t,e={}){const{url:n,headers:i}=tfe(t);return{async request(o){var z;const{body:l,fetchFn:h=e.fetchFn??fetch,onRequest:s=e.onRequest,onResponse:w=e.onResponse,timeout:x=e.timeout??1e4}=o,A={...e.fetchOptions??{},...o.fetchOptions??{}},{headers:P,method:D,signal:M}=A;try{const U=await nG(async({signal:ne})=>{const oe={...A,body:Array.isArray(l)?Ul(l.map(Ie=>({jsonrpc:"2.0",id:Ie.id??d$.take(),...Ie}))):Ul({jsonrpc:"2.0",id:l.id??d$.take(),...l}),headers:{...i,"Content-Type":"application/json",...P},method:D||"POST",signal:M||(x>0?ne:null)},Q=new Request(n,oe),de=await(s==null?void 0:s(Q,oe))??{...oe,url:n};return await h(de.url??n,de)},{errorInstance:new ZF({body:l,url:n}),timeout:x,signal:!0});w&&await w(U);let G;if((z=U.headers.get("Content-Type"))!=null&&z.startsWith("application/json"))G=await U.json();else{G=await U.text();try{G=JSON.parse(G||"{}")}catch(ne){if(U.ok)throw ne;G={error:G}}}if(!U.ok)throw new Fx({body:l,details:Ul(G.error)||U.statusText,headers:U.headers,status:U.status,url:n});return G}catch(U){throw U instanceof Fx||U instanceof ZF?U:new Fx({body:l,cause:U,url:n})}}}}function tfe(t){try{const e=new URL(t),n=(()=>{if(e.username){const i=`${decodeURIComponent(e.username)}:${decodeURIComponent(e.password)}`;return e.username="",e.password="",{url:e.toString(),headers:{Authorization:`Basic ${btoa(i)}`}}}})();return{url:e.toString(),...n}}catch{return{url:t}}}class iG extends Rk{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Kle(e);const i=NS(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,l=new Uint8Array(o);l.set(i.length>o?e.create().update(i).digest():i);for(let h=0;h<l.length;h++)l[h]^=54;this.iHash.update(l),this.oHash=e.create();for(let h=0;h<l.length;h++)l[h]^=106;this.oHash.update(l),Lm(l)}update(e){return iw(this),this.iHash.update(e),this}digestInto(e){iw(this),Mm(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:i,finished:o,destroyed:l,blockLen:h,outputLen:s}=this;return e=e,e.finished=o,e.destroyed=l,e.blockLen=h,e.outputLen=s,e.oHash=n._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const rG=(t,e,n)=>new iG(t,e).update(n).digest();rG.create=(t,e)=>new iG(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const il=BigInt(0),Ic=BigInt(1),A0=BigInt(2),nfe=BigInt(3),sG=BigInt(4),oG=BigInt(5),aG=BigInt(8);function Qc(t,e){const n=t%e;return n>=il?n:e+n}function hu(t,e,n){let i=t;for(;e-- >il;)i*=i,i%=n;return i}function y8(t,e){if(t===il)throw new Error("invert: expected non-zero number");if(e<=il)throw new Error("invert: expected positive modulus, got "+e);let n=Qc(t,e),i=e,o=il,l=Ic;for(;n!==il;){const s=i/n,w=i%n,x=o-l*s;i=n,n=w,o=l,l=x}if(i!==Ic)throw new Error("invert: does not exist");return Qc(o,e)}function cG(t,e){const n=(t.ORDER+Ic)/sG,i=t.pow(e,n);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function ife(t,e){const n=(t.ORDER-oG)/aG,i=t.mul(e,A0),o=t.pow(i,n),l=t.mul(e,o),h=t.mul(t.mul(l,A0),o),s=t.mul(l,t.sub(h,t.ONE));if(!t.eql(t.sqr(s),e))throw new Error("Cannot find square root");return s}function rfe(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Ic,n=0;for(;e%A0===il;)e/=A0,n++;let i=A0;const o=Qk(t);for(;h$(o,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return cG;let l=o.pow(i,e);const h=(e+Ic)/A0;return function(w,x){if(w.is0(x))return x;if(h$(w,x)!==1)throw new Error("Cannot find square root");let A=n,P=w.mul(w.ONE,l),D=w.pow(x,e),M=w.pow(x,h);for(;!w.eql(D,w.ONE);){if(w.is0(D))return w.ZERO;let z=1,U=w.sqr(D);for(;!w.eql(U,w.ONE);)if(z++,U=w.sqr(U),z===A)throw new Error("Cannot find square root");const G=Ic<<BigInt(A-z-1),ne=w.pow(P,G);A=z,P=w.sqr(ne),D=w.mul(D,P),M=w.mul(M,ne)}return M}}function sfe(t){return t%sG===nfe?cG:t%aG===oG?ife:rfe(t)}const ofe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function afe(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=ofe.reduce((i,o)=>(i[o]="function",i),e);return VS(t,n)}function cfe(t,e,n){if(n<il)throw new Error("invalid exponent, negatives unsupported");if(n===il)return t.ONE;if(n===Ic)return e;let i=t.ONE,o=e;for(;n>il;)n&Ic&&(i=t.mul(i,o)),o=t.sqr(o),n>>=Ic;return i}function lG(t,e,n=!1){const i=new Array(e.length).fill(n?t.ZERO:void 0),o=e.reduce((h,s,w)=>t.is0(s)?h:(i[w]=h,t.mul(h,s)),t.ONE),l=t.inv(o);return e.reduceRight((h,s,w)=>t.is0(s)?h:(i[w]=t.mul(h,i[w]),t.mul(h,s)),l),i}function h$(t,e){const n=(t.ORDER-Ic)/A0,i=t.pow(e,n),o=t.eql(i,t.ONE),l=t.eql(i,t.ZERO),h=t.eql(i,t.neg(t.ONE));if(!o&&!l&&!h)throw new Error("invalid Legendre symbol result");return o?1:l?0:-1}function uG(t,e){e!==void 0&&_2(e);const n=e!==void 0?e:t.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function Qk(t,e,n=!1,i={}){if(t<=il)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:o,nByteLength:l}=uG(t,e);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const s=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:l,MASK:jS(o),ZERO:il,ONE:Ic,create:w=>Qc(w,t),isValid:w=>{if(typeof w!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof w);return il<=w&&w<t},is0:w=>w===il,isOdd:w=>(w&Ic)===Ic,neg:w=>Qc(-w,t),eql:(w,x)=>w===x,sqr:w=>Qc(w*w,t),add:(w,x)=>Qc(w+x,t),sub:(w,x)=>Qc(w-x,t),mul:(w,x)=>Qc(w*x,t),pow:(w,x)=>cfe(s,w,x),div:(w,x)=>Qc(w*y8(x,t),t),sqrN:w=>w*w,addN:(w,x)=>w+x,subN:(w,x)=>w-x,mulN:(w,x)=>w*x,inv:w=>y8(w,t),sqrt:i.sqrt||(w=>(h||(h=sfe(t)),h(s,w))),toBytes:w=>n?DH(w,l):SE(w,l),fromBytes:w=>{if(w.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+w.length);return n?kH(w):B0(w)},invertBatch:w=>lG(s,w),cmov:(w,x,A)=>A?x:w});return Object.freeze(s)}function dG(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function hG(t){const e=dG(t);return e+Math.ceil(e/2)}function lfe(t,e,n=!1){const i=t.length,o=dG(e),l=hG(e);if(i<16||i<l||i>1024)throw new Error("expected "+l+"-1024 bytes of input, got "+i);const h=n?kH(t):B0(t),s=Qc(h,e-Ic)+Ic;return n?DH(s,o):SE(s,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const f$=BigInt(0),_8=BigInt(1);function rP(t,e){const n=e.negate();return t?n:e}function fG(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function sP(t,e){fG(t,e);const n=Math.ceil(e/t)+1,i=2**(t-1),o=2**t,l=jS(t),h=BigInt(t);return{windows:n,windowSize:i,mask:l,maxNumber:o,shiftBy:h}}function p$(t,e,n){const{windowSize:i,mask:o,maxNumber:l,shiftBy:h}=n;let s=Number(t&o),w=t>>h;s>i&&(s-=l,w+=_8);const x=e*i,A=x+Math.abs(s)-1,P=s===0,D=s<0,M=e%2!==0;return{nextN:w,offset:A,isZero:P,isNeg:D,isNegF:M,offsetF:x}}function ufe(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,i)=>{if(!(n instanceof e))throw new Error("invalid point at index "+i)})}function dfe(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,i)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+i)})}const oP=new WeakMap,pG=new WeakMap;function aP(t){return pG.get(t)||1}function hfe(t,e){return{constTimeNegate:rP,hasPrecomputes(n){return aP(n)!==1},unsafeLadder(n,i,o=t.ZERO){let l=n;for(;i>f$;)i&_8&&(o=o.add(l)),l=l.double(),i>>=_8;return o},precomputeWindow(n,i){const{windows:o,windowSize:l}=sP(i,e),h=[];let s=n,w=s;for(let x=0;x<o;x++){w=s,h.push(w);for(let A=1;A<l;A++)w=w.add(s),h.push(w);s=w.double()}return h},wNAF(n,i,o){let l=t.ZERO,h=t.BASE;const s=sP(n,e);for(let w=0;w<s.windows;w++){const{nextN:x,offset:A,isZero:P,isNeg:D,isNegF:M,offsetF:z}=p$(o,w,s);o=x,P?h=h.add(rP(M,i[z])):l=l.add(rP(D,i[A]))}return{p:l,f:h}},wNAFUnsafe(n,i,o,l=t.ZERO){const h=sP(n,e);for(let s=0;s<h.windows&&o!==f$;s++){const{nextN:w,offset:x,isZero:A,isNeg:P}=p$(o,s,h);if(o=w,!A){const D=i[x];l=l.add(P?D.negate():D)}}return l},getPrecomputes(n,i,o){let l=oP.get(i);return l||(l=this.precomputeWindow(i,n),n!==1&&oP.set(i,o(l))),l},wNAFCached(n,i,o){const l=aP(n);return this.wNAF(l,this.getPrecomputes(l,n,o),i)},wNAFCachedUnsafe(n,i,o,l){const h=aP(n);return h===1?this.unsafeLadder(n,i,l):this.wNAFUnsafe(h,this.getPrecomputes(h,n,o),i,l)},setWindowSize(n,i){fG(i,e),pG.set(n,i),oP.delete(n)}}}function ffe(t,e,n,i){ufe(n,t),dfe(i,e);const o=n.length,l=i.length;if(o!==l)throw new Error("arrays of points and scalars must have equal length");const h=t.ZERO,s=Kde(BigInt(o));let w=1;s>12?w=s-3:s>4?w=s-2:s>0&&(w=2);const x=jS(w),A=new Array(Number(x)+1).fill(h),P=Math.floor((e.BITS-1)/w)*w;let D=h;for(let M=P;M>=0;M-=w){A.fill(h);for(let U=0;U<l;U++){const G=i[U],ne=Number(G>>BigInt(M)&x);A[ne]=A[ne].add(n[U])}let z=h;for(let U=A.length-1,G=h;U>0;U--)G=G.add(A[U]),z=z.add(G);if(D=D.add(z),M!==0)for(let U=0;U<w;U++)D=D.double()}return D}function mG(t){return afe(t.Fp),VS(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...uG(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function m$(t){t.lowS!==void 0&&B2("lowS",t.lowS),t.prehash!==void 0&&B2("prehash",t.prehash)}function pfe(t){const e=mG(t);VS(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:i,a:o}=e;if(n){if(!i.eql(o,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class mfe extends Error{constructor(e=""){super(e)}}const Of={Err:mfe,_tlv:{encode:(t,e)=>{const{Err:n}=Of;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const i=e.length/2,o=W5(i);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const l=i>127?W5(o.length/2|128):"";return W5(t)+l+o+e},decode(t,e){const{Err:n}=Of;let i=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new n("tlv.decode: wrong tlv");const o=e[i++],l=!!(o&128);let h=0;if(!l)h=o;else{const w=o&127;if(!w)throw new n("tlv.decode(long): indefinite length not supported");if(w>4)throw new n("tlv.decode(long): byte length is too big");const x=e.subarray(i,i+w);if(x.length!==w)throw new n("tlv.decode: length bytes not complete");if(x[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const A of x)h=h<<8|A;if(i+=w,h<128)throw new n("tlv.decode(long): not minimal encoding")}const s=e.subarray(i,i+h);if(s.length!==h)throw new n("tlv.decode: wrong value length");return{v:s,l:e.subarray(i+h)}}},_int:{encode(t){const{Err:e}=Of;if(t<Df)throw new e("integer: negative integers are not allowed");let n=W5(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=Of;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return B0(t)}},toSig(t){const{Err:e,_int:n,_tlv:i}=Of,o=_u("signature",t),{v:l,l:h}=i.decode(48,o);if(h.length)throw new e("invalid signature: left bytes after parsing");const{v:s,l:w}=i.decode(2,l),{v:x,l:A}=i.decode(2,w);if(A.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(s),s:n.decode(x)}},hexFromSig(t){const{_tlv:e,_int:n}=Of,i=e.encode(2,n.encode(t.r)),o=e.encode(2,n.encode(t.s)),l=i+o;return e.encode(48,l)}};function cP(t,e){return F2(SE(t,e))}const Df=BigInt(0),na=BigInt(1);BigInt(2);const lP=BigInt(3),gfe=BigInt(4);function yfe(t){const e=pfe(t),{Fp:n}=e,i=Qk(e.n,e.nBitLength),o=e.toBytes||((Q,de,he)=>{const Ie=de.toAffine();return wA(Uint8Array.from([4]),n.toBytes(Ie.x),n.toBytes(Ie.y))}),l=e.fromBytes||(Q=>{const de=Q.subarray(1),he=n.fromBytes(de.subarray(0,n.BYTES)),Ie=n.fromBytes(de.subarray(n.BYTES,2*n.BYTES));return{x:he,y:Ie}});function h(Q){const{a:de,b:he}=e,Ie=n.sqr(Q),ke=n.mul(Ie,Q);return n.add(n.add(ke,n.mul(Q,de)),he)}function s(Q,de){const he=n.sqr(de),Ie=h(Q);return n.eql(he,Ie)}if(!s(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const w=n.mul(n.pow(e.a,lP),gfe),x=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(w,x)))throw new Error("bad curve params: a or b");function A(Q){return Yk(Q,na,e.n)}function P(Q){const{allowedPrivateKeyLengths:de,nByteLength:he,wrapPrivateKey:Ie,n:ke}=e;if(de&&typeof Q!="bigint"){if(AE(Q)&&(Q=F2(Q)),typeof Q!="string"||!de.includes(Q.length))throw new Error("invalid private key");Q=Q.padStart(he*2,"0")}let Ue;try{Ue=typeof Q=="bigint"?Q:B0(_u("private key",Q,he))}catch{throw new Error("invalid private key, expected hex or "+he+" bytes, got "+typeof Q)}return Ie&&(Ue=Qc(Ue,ke)),U1("private key",Ue,na,ke),Ue}function D(Q){if(!(Q instanceof U))throw new Error("ProjectivePoint expected")}const M=s$((Q,de)=>{const{px:he,py:Ie,pz:ke}=Q;if(n.eql(ke,n.ONE))return{x:he,y:Ie};const Ue=Q.is0();de==null&&(de=Ue?n.ONE:n.inv(ke));const ze=n.mul(he,de),ht=n.mul(Ie,de),ft=n.mul(ke,de);if(Ue)return{x:n.ZERO,y:n.ZERO};if(!n.eql(ft,n.ONE))throw new Error("invZ was invalid");return{x:ze,y:ht}}),z=s$(Q=>{if(Q.is0()){if(e.allowInfinityPoint&&!n.is0(Q.py))return;throw new Error("bad point: ZERO")}const{x:de,y:he}=Q.toAffine();if(!n.isValid(de)||!n.isValid(he))throw new Error("bad point: x or y not FE");if(!s(de,he))throw new Error("bad point: equation left != right");if(!Q.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class U{constructor(de,he,Ie){if(de==null||!n.isValid(de))throw new Error("x required");if(he==null||!n.isValid(he)||n.is0(he))throw new Error("y required");if(Ie==null||!n.isValid(Ie))throw new Error("z required");this.px=de,this.py=he,this.pz=Ie,Object.freeze(this)}static fromAffine(de){const{x:he,y:Ie}=de||{};if(!de||!n.isValid(he)||!n.isValid(Ie))throw new Error("invalid affine point");if(de instanceof U)throw new Error("projective point not allowed");const ke=Ue=>n.eql(Ue,n.ZERO);return ke(he)&&ke(Ie)?U.ZERO:new U(he,Ie,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(de){const he=lG(n,de.map(Ie=>Ie.pz));return de.map((Ie,ke)=>Ie.toAffine(he[ke])).map(U.fromAffine)}static fromHex(de){const he=U.fromAffine(l(_u("pointHex",de)));return he.assertValidity(),he}static fromPrivateKey(de){return U.BASE.multiply(P(de))}static msm(de,he){return ffe(U,i,de,he)}_setWindowSize(de){oe.setWindowSize(this,de)}assertValidity(){z(this)}hasEvenY(){const{y:de}=this.toAffine();if(n.isOdd)return!n.isOdd(de);throw new Error("Field doesn't support isOdd")}equals(de){D(de);const{px:he,py:Ie,pz:ke}=this,{px:Ue,py:ze,pz:ht}=de,ft=n.eql(n.mul(he,ht),n.mul(Ue,ke)),ct=n.eql(n.mul(Ie,ht),n.mul(ze,ke));return ft&&ct}negate(){return new U(this.px,n.neg(this.py),this.pz)}double(){const{a:de,b:he}=e,Ie=n.mul(he,lP),{px:ke,py:Ue,pz:ze}=this;let ht=n.ZERO,ft=n.ZERO,ct=n.ZERO,je=n.mul(ke,ke),Ye=n.mul(Ue,Ue),re=n.mul(ze,ze),le=n.mul(ke,Ue);return le=n.add(le,le),ct=n.mul(ke,ze),ct=n.add(ct,ct),ht=n.mul(de,ct),ft=n.mul(Ie,re),ft=n.add(ht,ft),ht=n.sub(Ye,ft),ft=n.add(Ye,ft),ft=n.mul(ht,ft),ht=n.mul(le,ht),ct=n.mul(Ie,ct),re=n.mul(de,re),le=n.sub(je,re),le=n.mul(de,le),le=n.add(le,ct),ct=n.add(je,je),je=n.add(ct,je),je=n.add(je,re),je=n.mul(je,le),ft=n.add(ft,je),re=n.mul(Ue,ze),re=n.add(re,re),je=n.mul(re,le),ht=n.sub(ht,je),ct=n.mul(re,Ye),ct=n.add(ct,ct),ct=n.add(ct,ct),new U(ht,ft,ct)}add(de){D(de);const{px:he,py:Ie,pz:ke}=this,{px:Ue,py:ze,pz:ht}=de;let ft=n.ZERO,ct=n.ZERO,je=n.ZERO;const Ye=e.a,re=n.mul(e.b,lP);let le=n.mul(he,Ue),Ae=n.mul(Ie,ze),Le=n.mul(ke,ht),De=n.add(he,Ie),He=n.add(Ue,ze);De=n.mul(De,He),He=n.add(le,Ae),De=n.sub(De,He),He=n.add(he,ke);let Et=n.add(Ue,ht);return He=n.mul(He,Et),Et=n.add(le,Le),He=n.sub(He,Et),Et=n.add(Ie,ke),ft=n.add(ze,ht),Et=n.mul(Et,ft),ft=n.add(Ae,Le),Et=n.sub(Et,ft),je=n.mul(Ye,He),ft=n.mul(re,Le),je=n.add(ft,je),ft=n.sub(Ae,je),je=n.add(Ae,je),ct=n.mul(ft,je),Ae=n.add(le,le),Ae=n.add(Ae,le),Le=n.mul(Ye,Le),He=n.mul(re,He),Ae=n.add(Ae,Le),Le=n.sub(le,Le),Le=n.mul(Ye,Le),He=n.add(He,Le),le=n.mul(Ae,He),ct=n.add(ct,le),le=n.mul(Et,He),ft=n.mul(De,ft),ft=n.sub(ft,le),le=n.mul(De,Ae),je=n.mul(Et,je),je=n.add(je,le),new U(ft,ct,je)}subtract(de){return this.add(de.negate())}is0(){return this.equals(U.ZERO)}wNAF(de){return oe.wNAFCached(this,de,U.normalizeZ)}multiplyUnsafe(de){const{endo:he,n:Ie}=e;U1("scalar",de,Df,Ie);const ke=U.ZERO;if(de===Df)return ke;if(this.is0()||de===na)return this;if(!he||oe.hasPrecomputes(this))return oe.wNAFCachedUnsafe(this,de,U.normalizeZ);let{k1neg:Ue,k1:ze,k2neg:ht,k2:ft}=he.splitScalar(de),ct=ke,je=ke,Ye=this;for(;ze>Df||ft>Df;)ze&na&&(ct=ct.add(Ye)),ft&na&&(je=je.add(Ye)),Ye=Ye.double(),ze>>=na,ft>>=na;return Ue&&(ct=ct.negate()),ht&&(je=je.negate()),je=new U(n.mul(je.px,he.beta),je.py,je.pz),ct.add(je)}multiply(de){const{endo:he,n:Ie}=e;U1("scalar",de,na,Ie);let ke,Ue;if(he){const{k1neg:ze,k1:ht,k2neg:ft,k2:ct}=he.splitScalar(de);let{p:je,f:Ye}=this.wNAF(ht),{p:re,f:le}=this.wNAF(ct);je=oe.constTimeNegate(ze,je),re=oe.constTimeNegate(ft,re),re=new U(n.mul(re.px,he.beta),re.py,re.pz),ke=je.add(re),Ue=Ye.add(le)}else{const{p:ze,f:ht}=this.wNAF(de);ke=ze,Ue=ht}return U.normalizeZ([ke,Ue])[0]}multiplyAndAddUnsafe(de,he,Ie){const ke=U.BASE,Ue=(ht,ft)=>ft===Df||ft===na||!ht.equals(ke)?ht.multiplyUnsafe(ft):ht.multiply(ft),ze=Ue(this,he).add(Ue(de,Ie));return ze.is0()?void 0:ze}toAffine(de){return M(this,de)}isTorsionFree(){const{h:de,isTorsionFree:he}=e;if(de===na)return!0;if(he)return he(U,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:de,clearCofactor:he}=e;return de===na?this:he?he(U,this):this.multiplyUnsafe(e.h)}toRawBytes(de=!0){return B2("isCompressed",de),this.assertValidity(),o(U,this,de)}toHex(de=!0){return B2("isCompressed",de),F2(this.toRawBytes(de))}}U.BASE=new U(e.Gx,e.Gy,n.ONE),U.ZERO=new U(n.ZERO,n.ONE,n.ZERO);const{endo:G,nBitLength:ne}=e,oe=hfe(U,G?Math.ceil(ne/2):ne);return{CURVE:e,ProjectivePoint:U,normPrivateKeyToScalar:P,weierstrassEquation:h,isWithinCurveOrder:A}}function _fe(t){const e=mG(t);return VS(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function wfe(t){const e=_fe(t),{Fp:n,n:i,nByteLength:o,nBitLength:l}=e,h=n.BYTES+1,s=2*n.BYTES+1;function w(re){return Qc(re,i)}function x(re){return y8(re,i)}const{ProjectivePoint:A,normPrivateKeyToScalar:P,weierstrassEquation:D,isWithinCurveOrder:M}=yfe({...e,toBytes(re,le,Ae){const Le=le.toAffine(),De=n.toBytes(Le.x),He=wA;return B2("isCompressed",Ae),Ae?He(Uint8Array.from([le.hasEvenY()?2:3]),De):He(Uint8Array.from([4]),De,n.toBytes(Le.y))},fromBytes(re){const le=re.length,Ae=re[0],Le=re.subarray(1);if(le===h&&(Ae===2||Ae===3)){const De=B0(Le);if(!Yk(De,na,n.ORDER))throw new Error("Point is not on curve");const He=D(De);let Et;try{Et=n.sqrt(He)}catch(Bt){const Yt=Bt instanceof Error?": "+Bt.message:"";throw new Error("Point is not on curve"+Yt)}const Ct=(Et&na)===na;return(Ae&1)===1!==Ct&&(Et=n.neg(Et)),{x:De,y:Et}}else if(le===s&&Ae===4){const De=n.fromBytes(Le.subarray(0,n.BYTES)),He=n.fromBytes(Le.subarray(n.BYTES,2*n.BYTES));return{x:De,y:He}}else{const De=h,He=s;throw new Error("invalid Point, expected length of "+De+", or uncompressed "+He+", got "+le)}}});function z(re){const le=i>>na;return re>le}function U(re){return z(re)?w(-re):re}const G=(re,le,Ae)=>B0(re.slice(le,Ae));class ne{constructor(le,Ae,Le){U1("r",le,na,i),U1("s",Ae,na,i),this.r=le,this.s=Ae,Le!=null&&(this.recovery=Le),Object.freeze(this)}static fromCompact(le){const Ae=o;return le=_u("compactSignature",le,Ae*2),new ne(G(le,0,Ae),G(le,Ae,2*Ae))}static fromDER(le){const{r:Ae,s:Le}=Of.toSig(_u("DER",le));return new ne(Ae,Le)}assertValidity(){}addRecoveryBit(le){return new ne(this.r,this.s,le)}recoverPublicKey(le){const{r:Ae,s:Le,recovery:De}=this,He=ke(_u("msgHash",le));if(De==null||![0,1,2,3].includes(De))throw new Error("recovery id invalid");const Et=De===2||De===3?Ae+e.n:Ae;if(Et>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Ct=De&1?"03":"02",Dt=A.fromHex(Ct+cP(Et,n.BYTES)),Bt=x(Et),Yt=w(-He*Bt),yn=w(Le*Bt),mn=A.BASE.multiplyAndAddUnsafe(Dt,Yt,yn);if(!mn)throw new Error("point at infinify");return mn.assertValidity(),mn}hasHighS(){return z(this.s)}normalizeS(){return this.hasHighS()?new ne(this.r,w(-this.s),this.recovery):this}toDERRawBytes(){return _A(this.toDERHex())}toDERHex(){return Of.hexFromSig(this)}toCompactRawBytes(){return _A(this.toCompactHex())}toCompactHex(){const le=o;return cP(this.r,le)+cP(this.s,le)}}const oe={isValidPrivateKey(re){try{return P(re),!0}catch{return!1}},normPrivateKeyToScalar:P,randomPrivateKey:()=>{const re=hG(e.n);return lfe(e.randomBytes(re),e.n)},precompute(re=8,le=A.BASE){return le._setWindowSize(re),le.multiply(BigInt(3)),le}};function Q(re,le=!0){return A.fromPrivateKey(re).toRawBytes(le)}function de(re){if(typeof re=="bigint")return!1;if(re instanceof A)return!0;const Ae=_u("key",re).length,Le=n.BYTES,De=Le+1,He=2*Le+1;if(!(e.allowedPrivateKeyLengths||o===De))return Ae===De||Ae===He}function he(re,le,Ae=!0){if(de(re)===!0)throw new Error("first arg must be private key");if(de(le)===!1)throw new Error("second arg must be public key");return A.fromHex(le).multiply(P(re)).toRawBytes(Ae)}const Ie=e.bits2int||function(re){if(re.length>8192)throw new Error("input is too large");const le=B0(re),Ae=re.length*8-l;return Ae>0?le>>BigInt(Ae):le},ke=e.bits2int_modN||function(re){return w(Ie(re))},Ue=jS(l);function ze(re){return U1("num < 2^"+l,re,Df,Ue),SE(re,o)}function ht(re,le,Ae=ft){if(["recovered","canonical"].some(sn=>sn in Ae))throw new Error("sign() legacy options not supported");const{hash:Le,randomBytes:De}=e;let{lowS:He,prehash:Et,extraEntropy:Ct}=Ae;He==null&&(He=!0),re=_u("msgHash",re),m$(Ae),Et&&(re=_u("prehashed msgHash",Le(re)));const Dt=ke(re),Bt=P(le),Yt=[ze(Bt),ze(Dt)];if(Ct!=null&&Ct!==!1){const sn=Ct===!0?De(n.BYTES):Ct;Yt.push(_u("extraEntropy",sn))}const yn=wA(...Yt),mn=Dt;function oi(sn){const _n=Ie(sn);if(!M(_n))return;const ai=x(_n),er=A.BASE.multiply(_n).toAffine(),ui=w(er.x);if(ui===Df)return;const Yr=w(ai*w(mn+ui*Bt));if(Yr===Df)return;let $s=(er.x===ui?0:2)|Number(er.y&na),Xs=Yr;return He&&z(Yr)&&(Xs=U(Yr),$s^=1),new ne(ui,Xs,$s)}return{seed:yn,k2sig:oi}}const ft={lowS:e.lowS,prehash:!1},ct={lowS:e.lowS,prehash:!1};function je(re,le,Ae=ft){const{seed:Le,k2sig:De}=ht(re,le,Ae),He=e;return Yde(He.hash.outputLen,He.nByteLength,He.hmac)(Le,De)}A.BASE._setWindowSize(8);function Ye(re,le,Ae,Le=ct){var $s;const De=re;le=_u("msgHash",le),Ae=_u("publicKey",Ae);const{lowS:He,prehash:Et,format:Ct}=Le;if(m$(Le),"strict"in Le)throw new Error("options.strict was renamed to lowS");if(Ct!==void 0&&Ct!=="compact"&&Ct!=="der")throw new Error("format must be compact or der");const Dt=typeof De=="string"||AE(De),Bt=!Dt&&!Ct&&typeof De=="object"&&De!==null&&typeof De.r=="bigint"&&typeof De.s=="bigint";if(!Dt&&!Bt)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Yt,yn;try{if(Bt&&(Yt=new ne(De.r,De.s)),Dt){try{Ct!=="compact"&&(Yt=ne.fromDER(De))}catch(Xs){if(!(Xs instanceof Of.Err))throw Xs}!Yt&&Ct!=="der"&&(Yt=ne.fromCompact(De))}yn=A.fromHex(Ae)}catch{return!1}if(!Yt||He&&Yt.hasHighS())return!1;Et&&(le=e.hash(le));const{r:mn,s:oi}=Yt,sn=ke(le),_n=x(oi),ai=w(sn*_n),er=w(mn*_n),ui=($s=A.BASE.multiplyAndAddUnsafe(yn,ai,er))==null?void 0:$s.toAffine();return ui?w(ui.x)===mn:!1}return{CURVE:e,getPublicKey:Q,getSharedSecret:he,sign:je,verify:Ye,ProjectivePoint:A,Signature:ne,utils:oe}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function bfe(t){return{hash:t,hmac:(e,...n)=>rG(t,e,nue(...n)),randomBytes:iue}}function vfe(t,e){const n=i=>wfe({...t,...bfe(i)});return{...n(e),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gG=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),g$=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),xfe=BigInt(0),Efe=BigInt(1),w8=BigInt(2),y$=(t,e)=>(t+e/w8)/e;function Cfe(t){const e=gG,n=BigInt(3),i=BigInt(6),o=BigInt(11),l=BigInt(22),h=BigInt(23),s=BigInt(44),w=BigInt(88),x=t*t*t%e,A=x*x*t%e,P=hu(A,n,e)*A%e,D=hu(P,n,e)*A%e,M=hu(D,w8,e)*x%e,z=hu(M,o,e)*M%e,U=hu(z,l,e)*z%e,G=hu(U,s,e)*U%e,ne=hu(G,w,e)*G%e,oe=hu(ne,s,e)*U%e,Q=hu(oe,n,e)*A%e,de=hu(Q,h,e)*z%e,he=hu(de,i,e)*x%e,Ie=hu(he,w8,e);if(!b8.eql(b8.sqr(Ie),t))throw new Error("Cannot find square root");return Ie}const b8=Qk(gG,void 0,void 0,{sqrt:Cfe}),yG=vfe({a:xfe,b:BigInt(7),Fp:b8,n:g$,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=g$,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Efe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),l=n,h=BigInt("0x100000000000000000000000000000000"),s=y$(l*t,e),w=y$(-i*t,e);let x=Qc(t-s*n-w*o,e),A=Qc(-s*i-w*l,e);const P=x>h,D=A>h;if(P&&(x=e-x),D&&(A=e-A),x>h||A>h)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:P,k1:x,k2neg:D,k2:A}}}},xH),Tfe=Object.freeze(Object.defineProperty({__proto__:null,secp256k1:yG},Symbol.toStringTag,{value:"Module"}));class Afe extends ln{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function Sfe(t,e){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(t))throw new Afe({value:t});let[n,i="0"]=t.split(".");const o=n.startsWith("-");if(o&&(n=n.slice(1)),i=i.replace(/(0+)$/,""),e===0)Math.round(+`.${i}`)===1&&(n=`${BigInt(n)+1n}`),i="";else if(i.length>e){const[l,h,s]=[i.slice(0,e-1),i.slice(e-1,e),i.slice(e)],w=Math.round(+`${h}.${s}`);w>9?i=`${BigInt(l)+BigInt(1)}0`.padStart(l.length+1,"0"):i=`${l}${w}`,i.length>e&&(i=i.slice(1),n=`${BigInt(n)+1n}`),i=i.slice(0,e)}else i=i.padEnd(e,"0");return BigInt(`${o?"-":""}${n}${i}`)}async function _G(t,{blockHash:e,blockNumber:n,blockTag:i,hash:o,index:l,sender:h,nonce:s}){var D,M,z;const w=i||"latest",x=n!==void 0?ar(n):void 0;let A=null;if(o?A=await t.request({method:"eth_getTransactionByHash",params:[o]},{dedupe:!0}):e?A=await t.request({method:"eth_getTransactionByBlockHashAndIndex",params:[e,ar(l)]},{dedupe:!0}):typeof l=="number"?A=await t.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[x||w,ar(l)]},{dedupe:!!x}):h&&typeof s=="number"&&(A=await t.request({method:"eth_getTransactionBySenderAndNonce",params:[h,ar(s)]},{dedupe:!0})),!A)throw new rH({blockHash:e,blockNumber:n,blockTag:w,hash:o,index:l});return(((z=(M=(D=t.chain)==null?void 0:D.formatters)==null?void 0:M.transaction)==null?void 0:z.format)||US)(A,"getTransaction")}async function uP(t,{hash:e}){var o,l,h;const n=await t.request({method:"eth_getTransactionReceipt",params:[e]},{dedupe:!0});if(!n)throw new sH({hash:e});return(((h=(l=(o=t.chain)==null?void 0:o.formatters)==null?void 0:l.transactionReceipt)==null?void 0:h.format)||QH)(n,"getTransactionReceipt")}function Ife(t,{emitOnBegin:e=!1,emitMissed:n=!1,onBlockNumber:i,onError:o,poll:l,pollingInterval:h=t.pollingInterval}){const s=typeof l<"u"?l:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc"));let w;return s?(()=>{const P=Ul(["watchBlockNumber",t.uid,e,n,h]);return vA(P,{onBlockNumber:i,onError:o},D=>XH(async()=>{var M;try{const z=await is(t,jhe,"getBlockNumber")({cacheTime:0});if(w!==void 0){if(z===w)return;if(z-w>1&&n)for(let U=w+1n;U<z;U++)D.onBlockNumber(U,w),w=U}(w===void 0||z>w)&&(D.onBlockNumber(z,w),w=z)}catch(z){(M=D.onError)==null||M.call(D,z)}},{emitOnBegin:e,interval:h}))})():(()=>{const P=Ul(["watchBlockNumber",t.uid,e,n]);return vA(P,{onBlockNumber:i,onError:o},D=>{let M=!0,z=()=>M=!1;return(async()=>{try{const U=(()=>{if(t.transport.type==="fallback"){const ne=t.transport.transports.find(oe=>oe.config.type==="webSocket"||oe.config.type==="ipc");return ne?ne.value:t.transport}return t.transport})(),{unsubscribe:G}=await U.subscribe({params:["newHeads"],onData(ne){var Q;if(!M)return;const oe=Z0((Q=ne.result)==null?void 0:Q.number);D.onBlockNumber(oe,w),w=oe},onError(ne){var oe;(oe=D.onError)==null||oe.call(D,ne)}});z=G,M||z()}catch(U){o==null||o(U)}})(),()=>z()})})()}async function Pfe(t,e){const{checkReplacement:n=!0,confirmations:i=1,hash:o,onReplaced:l,retryCount:h=6,retryDelay:s=({count:he})=>~~(1<<he)*200,timeout:w=18e4}=e,x=Ul(["waitForTransactionReceipt",t.uid,o]),A=(()=>{var he;return e.pollingInterval?e.pollingInterval:(he=t.chain)!=null&&he.experimental_preconfirmationTime?t.chain.experimental_preconfirmationTime:t.pollingInterval})();let P,D,M,z=!1,U,G;const{promise:ne,resolve:oe,reject:Q}=qH(),de=w?setTimeout(()=>{G==null||G(),U==null||U(),Q(new Xue({hash:o}))},w):void 0;return U=vA(x,{onReplaced:l,resolve:oe,reject:Q},async he=>{if(M=await is(t,uP,"getTransactionReceipt")({hash:o}).catch(()=>{}),M&&i<=1){clearTimeout(de),he.resolve(M),U==null||U();return}G=is(t,Ife,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:A,async onBlockNumber(Ie){const ke=ze=>{clearTimeout(de),G==null||G(),ze(),U==null||U()};let Ue=Ie;if(!z)try{if(M){if(i>1&&(!M.blockNumber||Ue-M.blockNumber+1n<i))return;ke(()=>he.resolve(M));return}if(n&&!P&&(z=!0,await CA(async()=>{P=await is(t,_G,"getTransaction")({hash:o}),P.blockNumber&&(Ue=P.blockNumber)},{delay:s,retryCount:h}),z=!1),M=await is(t,uP,"getTransactionReceipt")({hash:o}),i>1&&(!M.blockNumber||Ue-M.blockNumber+1n<i))return;ke(()=>he.resolve(M))}catch(ze){if(ze instanceof rH||ze instanceof sH){if(!P){z=!1;return}try{D=P,z=!0;const ht=await CA(()=>is(t,cw,"getBlock")({blockNumber:Ue,includeTransactions:!0}),{delay:s,retryCount:h,shouldRetry:({error:je})=>je instanceof hH});z=!1;const ft=ht.transactions.find(({from:je,nonce:Ye})=>je===D.from&&Ye===D.nonce);if(!ft||(M=await is(t,uP,"getTransactionReceipt")({hash:ft.hash}),i>1&&(!M.blockNumber||Ue-M.blockNumber+1n<i)))return;let ct="replaced";ft.to===D.to&&ft.value===D.value&&ft.input===D.input?ct="repriced":ft.from===ft.to&&ft.value===0n&&(ct="cancelled"),ke(()=>{var je;(je=he.onReplaced)==null||je.call(he,{reason:ct,replacedTransaction:D,transaction:ft,transactionReceipt:M}),he.resolve(M)})}catch(ht){ke(()=>he.reject(ht))}}else ke(()=>he.reject(ze))}}})}),ne}function Rfe(t,{batch:e=!0,onError:n,onTransactions:i,poll:o,pollingInterval:l=t.pollingInterval}){return(typeof o<"u"?o:t.transport.type!=="webSocket"&&t.transport.type!=="ipc")?(()=>{const x=Ul(["watchPendingTransactions",t.uid,e,l]);return vA(x,{onTransactions:i,onError:n},A=>{let P;const D=XH(async()=>{var M;try{if(!P)try{P=await is(t,Zhe,"createPendingTransactionFilter")({});return}catch(U){throw D(),U}const z=await is(t,Vhe,"getFilterChanges")({filter:P});if(z.length===0)return;if(e)A.onTransactions(z);else for(const U of z)A.onTransactions([U])}catch(z){(M=A.onError)==null||M.call(A,z)}},{emitOnBegin:!0,interval:l});return async()=>{P&&await is(t,Whe,"uninstallFilter")({filter:P}),D()}})})():(()=>{let x=!0,A=()=>x=!1;return(async()=>{try{const{unsubscribe:P}=await t.transport.subscribe({params:["newPendingTransactions"],onData(D){if(!x)return;const M=D.result;i([M])},onError(D){n==null||n(D)}});A=P,x||A()}catch(P){n==null||n(P)}})(),()=>A()})()}async function Ofe(t,{account:e=t.account,message:n}){if(!e)throw new Xk({docsPath:"/docs/actions/wallet/signMessage"});const i=Tu(e);if(i.signMessage)return i.signMessage({message:n});const o=typeof n=="string"?kS(n):n.raw instanceof Uint8Array?K0(n.raw):n.raw;return t.request({method:"personal_sign",params:[o,i.address]},{retryCount:0})}function eD({key:t,methods:e,name:n,request:i,retryCount:o=3,retryDelay:l=150,timeout:h,type:s},w){const x=eG();return{config:{key:t,methods:e,name:n,request:i,retryCount:o,retryDelay:l,timeout:h,type:s},request:Xhe(i,{methods:e,retryCount:o,retryDelay:l,uid:x}),value:w}}function kfe(t,e={}){const{key:n="custom",methods:i,name:o="Custom Provider",retryDelay:l}=e;return({retryCount:h})=>eD({key:n,methods:i,name:o,request:t.request.bind(t),retryCount:e.retryCount??h,retryDelay:l,type:"custom"})}function _$(t,e={}){const{key:n="fallback",name:i="Fallback",rank:o=!1,shouldThrow:l=Dfe,retryCount:h,retryDelay:s}=e;return({chain:w,pollingInterval:x=4e3,timeout:A,...P})=>{let D=t,M=()=>{};const z=eD({key:n,name:i,async request({method:U,params:G}){let ne;const oe=async(Q=0)=>{const de=D[Q]({...P,chain:w,retryCount:0,timeout:A});try{const he=await de.request({method:U,params:G});return M({method:U,params:G,response:he,transport:de,status:"success"}),he}catch(he){if(M({error:he,method:U,params:G,transport:de,status:"error"}),l(he)||Q===D.length-1||(ne??(ne=D.slice(Q+1).some(Ie=>{const{include:ke,exclude:Ue}=Ie({chain:w}).config.methods||{};return ke?ke.includes(U):Ue?!Ue.includes(U):!0})),!ne))throw he;return oe(Q+1)}};return oe()},retryCount:h,retryDelay:s,type:"fallback"},{onResponse:U=>M=U,transports:D.map(U=>U({chain:w,retryCount:0}))});if(o){const U=typeof o=="object"?o:{};Nfe({chain:w,interval:U.interval??x,onTransports:G=>D=G,ping:U.ping,sampleCount:U.sampleCount,timeout:U.timeout,transports:D,weights:U.weights})}return z}}function Dfe(t){return!!("code"in t&&typeof t.code=="number"&&(t.code===sw.code||t.code===to.code||t.code===aw.code||T0.nodeMessage.test(t.message)||t.code===5e3))}function Nfe({chain:t,interval:e=4e3,onTransports:n,ping:i,sampleCount:o=10,timeout:l=1e3,transports:h,weights:s={}}){const{stability:w=.7,latency:x=.3}=s,A=[],P=async()=>{const D=await Promise.all(h.map(async U=>{const G=U({chain:t,retryCount:0,timeout:l}),ne=Date.now();let oe,Q;try{await(i?i({transport:G}):G.request({method:"net_listening"})),Q=1}catch{Q=0}finally{oe=Date.now()}return{latency:oe-ne,success:Q}}));A.push(D),A.length>o&&A.shift();const M=Math.max(...A.map(U=>Math.max(...U.map(({latency:G})=>G)))),z=h.map((U,G)=>{const ne=A.map(Ie=>Ie[G].latency),Q=1-ne.reduce((Ie,ke)=>Ie+ke,0)/ne.length/M,de=A.map(Ie=>Ie[G].success),he=de.reduce((Ie,ke)=>Ie+ke,0)/de.length;return he===0?[0,G]:[x*Q+w*he,G]}).sort((U,G)=>G[0]-U[0]);n(z.map(([,U])=>h[U])),await xA(e),P()};P()}class Mfe extends ln{constructor(){super("No URL was provided to the Transport. Please provide a valid RPC URL to the Transport.",{docsPath:"/docs/clients/intro",name:"UrlRequiredError"})}}function Y5(t,e={}){const{batch:n,fetchFn:i,fetchOptions:o,key:l="http",methods:h,name:s="HTTP JSON-RPC",onFetchRequest:w,onFetchResponse:x,retryDelay:A,raw:P}=e;return({chain:D,retryCount:M,timeout:z})=>{const{batchSize:U=1e3,wait:G=0}=typeof n=="object"?n:{},ne=e.retryCount??M,oe=z??e.timeout??1e4,Q=t||(D==null?void 0:D.rpcUrls.default.http[0]);if(!Q)throw new Mfe;const de=efe(Q,{fetchFn:i,fetchOptions:o,onRequest:w,onResponse:x,timeout:oe});return eD({key:l,methods:h,name:s,async request({method:he,params:Ie}){const ke={method:he,params:Ie},{schedule:Ue}=ZH({id:Q,wait:G,shouldSplitBatch(ct){return ct.length>U},fn:ct=>de.request({body:ct}),sort:(ct,je)=>ct.id-je.id}),ze=async ct=>n?Ue(ct):[await de.request({body:ct})],[{error:ht,result:ft}]=await ze(ke);if(P)return{error:ht,result:ft};if(ht)throw new Uk({body:ke,error:ht,url:Q});return ft},retryCount:ne,retryDelay:A,timeout:oe,type:"http"},{fetchOptions:o,url:Q})}}async function lx(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class IE{constructor({baseUrl:e,clientId:n}){this.baseUrl=e,this.clientId=n}async get({headers:e,signal:n,cache:i,...o}){const l=this.createUrl(o);return(await lx(l,{method:"GET",headers:e,signal:n,cache:i})).json()}async getBlob({headers:e,signal:n,...i}){const o=this.createUrl(i);return(await lx(o,{method:"GET",headers:e,signal:n})).blob()}async post({body:e,headers:n,signal:i,...o}){const l=this.createUrl(o);return(await lx(l,{method:"POST",headers:n,body:e?JSON.stringify(e):void 0,signal:i})).json()}async put({body:e,headers:n,signal:i,...o}){const l=this.createUrl(o);return(await lx(l,{method:"PUT",headers:n,body:e?JSON.stringify(e):void 0,signal:i})).json()}async delete({body:e,headers:n,signal:i,...o}){const l=this.createUrl(o);return(await lx(l,{method:"DELETE",headers:n,body:e?JSON.stringify(e):void 0,signal:i})).json()}createUrl({path:e,params:n}){const i=new URL(e,this.baseUrl);return n&&Object.entries(n).forEach(([o,l])=>{l&&i.searchParams.append(o,l)}),this.clientId&&i.searchParams.append("clientId",this.clientId),i}sendBeacon({body:e,...n}){const i=this.createUrl(n);return navigator.sendBeacon(i.toString(),e?JSON.stringify(e):void 0)}}const v8={getFeatureValue(t,e){const n=e==null?void 0:e[t];return n===void 0?hi.DEFAULT_FEATURES[t]:n},filterSocialsByPlatform(t){if(!t||!t.length)return t;let e=t;return Ft.isTelegram()&&(Ft.isIos()&&(e=e.filter(n=>n!=="google")),Ft.isMac()&&(e=e.filter(n=>n!=="x")),Ft.isAndroid()&&(e=e.filter(n=>!["facebook","x"].includes(n)))),Ft.isMobile()&&(e=e.filter(n=>n!=="facebook")),e},isSocialsEnabled(){var t,e,n,i;return Array.isArray((t=ut.state.features)==null?void 0:t.socials)&&((e=ut.state.features)==null?void 0:e.socials.length)>0||Array.isArray((n=ut.state.remoteFeatures)==null?void 0:n.socials)&&((i=ut.state.remoteFeatures)==null?void 0:i.socials.length)>0},isEmailEnabled(){var t,e;return!!((t=ut.state.features)!=null&&t.email||(e=ut.state.remoteFeatures)!=null&&e.email)}},si=Zr({features:hi.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:hi.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{},enableMobileFullScreen:!1,coinbasePreference:"all"}),ut={state:si,subscribeKey(t,e){return oo(si,t,e)},setOptions(t){Object.assign(si,t)},setRemoteFeatures(t){var n,i;if(!t)return;const e={...si.remoteFeatures,...t};si.remoteFeatures=e,(n=si.remoteFeatures)!=null&&n.socials&&(si.remoteFeatures.socials=v8.filterSocialsByPlatform(si.remoteFeatures.socials)),(i=si.features)!=null&&i.pay&&(si.remoteFeatures.email=!1,si.remoteFeatures.socials=!1)},setFeatures(t){var n;if(!t)return;si.features||(si.features=hi.DEFAULT_FEATURES);const e={...si.features,...t};si.features=e,(n=si.features)!=null&&n.pay&&si.remoteFeatures&&(si.remoteFeatures.email=!1,si.remoteFeatures.socials=!1)},setProjectId(t){si.projectId=t},setCustomRpcUrls(t){si.customRpcUrls=t},setAllWallets(t){si.allWallets=t},setIncludeWalletIds(t){si.includeWalletIds=t},setExcludeWalletIds(t){si.excludeWalletIds=t},setFeaturedWalletIds(t){si.featuredWalletIds=t},setTokens(t){si.tokens=t},setTermsConditionsUrl(t){si.termsConditionsUrl=t},setPrivacyPolicyUrl(t){si.privacyPolicyUrl=t},setCustomWallets(t){si.customWallets=t},setIsSiweEnabled(t){si.isSiweEnabled=t},setIsUniversalProvider(t){si.isUniversalProvider=t},setSdkVersion(t){si.sdkVersion=t},setMetadata(t){si.metadata=t},setDisableAppend(t){si.disableAppend=t},setEIP6963Enabled(t){si.enableEIP6963=t},setEnableCoinbase(t){si.enableCoinbase=t},setDebug(t){si.debug=t},setEnableWalletGuide(t){si.enableWalletGuide=t},setEnableAuthLogger(t){si.enableAuthLogger=t},setEnableWallets(t){si.enableWallets=t},setPreferUniversalLinks(t){si.experimental_preferUniversalLinks=t},setSIWX(t){if(t)for(const[e,n]of Object.entries(hi.SIWX_DEFAULTS))t[e]??(t[e]=n);si.siwx=t},setConnectMethodsOrder(t){si.features={...si.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){si.features={...si.features,walletFeaturesOrder:t}},setSocialsOrder(t){si.remoteFeatures={...si.remoteFeatures,socials:t}},setCollapseWallets(t){si.features={...si.features,collapseWallets:t}},setEnableEmbedded(t){si.enableEmbedded=t},setAllowUnsupportedChain(t){si.allowUnsupportedChain=t},setManualWCControl(t){si.manualWCControl=t},setEnableNetworkSwitch(t){si.enableNetworkSwitch=t},setEnableMobileFullScreen(t){si.enableMobileFullScreen=Ft.isMobile()&&t},setEnableReconnect(t){si.enableReconnect=t},setCoinbasePreference(t){si.coinbasePreference=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,n])=>{n&&(si.defaultAccountTypes[e]=n)})},setUniversalProviderConfigOverride(t){si.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return si.universalProviderConfigOverride},getSnapshot(){return j0(si)}},g0=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),So=Zr({...g0}),Lfe={state:So,subscribeKey(t,e){return oo(So,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=Ft.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){So.message=g0.message,So.variant=g0.variant,So.svg=g0.svg,So.open=g0.open,So.autoClose=g0.autoClose},_showMessage({message:t,svg:e,variant:n="success",autoClose:i=g0.autoClose}){So.open?(So.open=!1,setTimeout(()=>{So.message=t,So.variant=n,So.svg=e,So.open=!0,So.autoClose=i},150)):(So.message=t,So.variant=n,So.svg=e,So.open=!0,So.autoClose=i)}},Ji=Lfe,Bfe={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},wG=Ft.getBlockchainApiUrl(),vc=Zr({clientId:null,api:new IE({baseUrl:wG,clientId:null}),supportedChains:{http:[],ws:[]}}),Ci={state:vc,async get(t){const{st:e,sv:n}=Ci.getSdkProperties(),i=ut.state.projectId,o={...t.params||{},st:e,sv:n,projectId:i};return vc.api.get({...t,params:o})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=ut.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{vc.supportedChains.http.length||await Ci.getSupportedNetworks()}catch{return!1}return vc.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await Ci.get({path:"v1/supported-chains"});return vc.supportedChains=t,t}catch{return vc.supportedChains}},async fetchIdentity({address:t}){const e=Jt.getIdentityFromCacheForAddress(t);if(e)return e;const n=await Ci.get({path:`/v1/identity/${t}`,params:{sender:ue.state.activeCaipAddress?Ft.getPlainAddress(ue.state.activeCaipAddress):void 0}});return Jt.updateIdentityCache({address:t,identity:n,timestamp:Date.now()}),n},async fetchTransactions({account:t,cursor:e,signal:n,cache:i,chainId:o}){var w;if(!await Ci.isNetworkSupported((w=ue.state.activeCaipNetwork)==null?void 0:w.caipNetworkId))return{data:[],next:void 0};const h=Jt.getTransactionsCacheForAddress({address:t,chainId:o});if(h)return h;const s=await Ci.get({path:`/v1/account/${t}/history`,params:{cursor:e,chainId:o},signal:n,cache:i});return Jt.updateTransactionsCache({address:t,chainId:o,timestamp:Date.now(),transactions:s}),s},async fetchSwapQuote({amount:t,userAddress:e,from:n,to:i,gasPrice:o}){var h;return await Ci.isNetworkSupported((h=ue.state.activeCaipNetwork)==null?void 0:h.caipNetworkId)?Ci.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:n,to:i,gasPrice:o}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){var n;return await Ci.isNetworkSupported((n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?Ci.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async getAddressBalance({caipNetworkId:t,address:e}){return vc.api.post({path:`/v1?chainId=${t}&projectId=${ut.state.projectId}`,body:{id:"1",jsonrpc:"2.0",method:"getAddressBalance",params:{address:e}}}).then(n=>n.result)},async fetchTokenPrice({addresses:t,caipNetworkId:e=(n=>(n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)()}){if(!await Ci.isNetworkSupported(e))return{fungibles:[]};const o=Jt.getTokenPriceCacheForAddresses(t);if(o)return o;const l=await vc.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:ut.state.projectId},headers:{"Content-Type":"application/json"}});return Jt.updateTokenPriceCache({addresses:t,timestamp:Date.now(),tokenPrice:l}),l},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){var i;return await Ci.isNetworkSupported((i=ue.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?Ci.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){var o;const{st:e,sv:n}=Ci.getSdkProperties();if(!await Ci.isNetworkSupported((o=ue.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Gas Price");return Ci.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:n}})},async generateSwapCalldata({amount:t,from:e,to:n,userAddress:i,disableEstimate:o}){var h;if(!await Ci.isNetworkSupported((h=ue.state.activeCaipNetwork)==null?void 0:h.caipNetworkId))throw new Error("Network not supported for Swaps");return vc.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:hi.CONVERT_SLIPPAGE_TOLERANCE},projectId:ut.state.projectId,from:e,to:n,userAddress:i,disableEstimate:o}})},async generateApproveCalldata({from:t,to:e,userAddress:n}){var h;const{st:i,sv:o}=Ci.getSdkProperties();if(!await Ci.isNetworkSupported((h=ue.state.activeCaipNetwork)==null?void 0:h.caipNetworkId))throw new Error("Network not supported for Swaps");return Ci.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:n,from:t,to:e,st:i,sv:o}})},async getBalance(t,e,n){var x;const{st:i,sv:o}=Ci.getSdkProperties();if(!await Ci.isNetworkSupported((x=ue.state.activeCaipNetwork)==null?void 0:x.caipNetworkId))return Ji.showError("Token Balance Unavailable"),{balances:[]};const h=`${e}:${t}`,s=Jt.getBalanceCacheForCaipAddress(h);if(s)return s;const w=await Ci.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:n,st:i,sv:o}});return Jt.updateBalanceCache({caipAddress:h,balance:w,timestamp:Date.now()}),w},async lookupEnsName(t){var n;return await Ci.isNetworkSupported((n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?Ci.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){var i,o;if(!await Ci.isNetworkSupported((i=ue.state.activeCaipNetwork)==null?void 0:i.caipNetworkId))return[];const n=(o=ue.getAccountData())==null?void 0:o.address;return Ci.get({path:`/v1/profile/reverse/${t}`,params:{sender:n,apiVersion:"2"}})},async getEnsNameSuggestions(t){var n;return await Ci.isNetworkSupported((n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?Ci.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:n,signature:i}){var l;return await Ci.isNetworkSupported((l=ue.state.activeCaipNetwork)==null?void 0:l.caipNetworkId)?vc.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:n,signature:i},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:n,purchaseAmount:i,paymentAmount:o}){var s;return await Ci.isNetworkSupported((s=ue.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?(await vc.api.post({path:"/v1/generators/onrampurl",params:{projectId:ut.state.projectId},body:{destinationWallets:t,defaultNetwork:n,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:i,presetFiatAmount:o}})).url:""},async getOnrampOptions(){var e;if(!await Ci.isNetworkSupported((e=ue.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await Ci.get({path:"/v1/onramp/options"})}catch{return Bfe}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:n,network:i}){var o;try{return await Ci.isNetworkSupported((o=ue.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?await vc.api.post({path:"/v1/onramp/quote",params:{projectId:ut.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:n,network:i}}):null}catch{return{networkFee:{amount:n,currency:e.id},paymentSubtotal:{amount:n,currency:e.id},paymentTotal:{amount:n,currency:e.id},purchaseAmount:{amount:n,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){var n;return await Ci.isNetworkSupported((n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?Ci.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,n){var o;return await Ci.isNetworkSupported((o=ue.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?vc.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:ut.state.projectId},body:{pci:e,signature:n}}):{success:!1}},setClientId(t){vc.clientId=t,vc.api=new IE({baseUrl:wG,clientId:t})}},Ffe=Object.freeze({enabled:!0,events:[]}),$fe=new IE({baseUrl:Ft.getAnalyticsUrl(),clientId:null}),zfe=5,Ufe=60*1e3,Gp=Zr({...Ffe}),jfe={state:Gp,subscribeKey(t,e){return oo(Gp,t,e)},async sendError(t,e){if(!Gp.enabled)return;const n=Date.now();if(Gp.events.filter(l=>{const h=new Date(l.properties.timestamp||"").getTime();return n-h<Ufe}).length>=zfe)return;const o={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};Gp.events.push(o);try{if(typeof window>"u")return;const{projectId:l,sdkType:h,sdkVersion:s}=ut.state;await $fe.post({path:"/e",params:{projectId:l,st:h,sv:s||"html-wagmi-4.2.2"},body:{eventId:Ft.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){Gp.enabled=!0},disable(){Gp.enabled=!1},clearEvents(){Gp.events=[]}};class Sh extends Error{constructor(e,n,i){super(e),this.originalName="AppKitError",this.name="AppKitError",this.category=n,this.originalError=i,i&&i instanceof Error&&(this.originalName=i.name),Object.setPrototypeOf(this,Sh.prototype);let o=!1;if(i instanceof Error&&typeof i.stack=="string"&&i.stack){const l=i.stack,h=l.indexOf(`
`);if(h>-1){const s=l.substring(h+1);this.stack=`${this.name}: ${this.message}
${s}`,o=!0}}o||(Error.captureStackTrace?Error.captureStackTrace(this,Sh):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function w$(t,e){let n="";try{t instanceof Error?n=t.message:typeof t=="string"?n=t:typeof t=="object"&&t!==null?Object.keys(t).length===0?n="Unknown error":n=(t==null?void 0:t.message)||JSON.stringify(t):n=String(t)}catch(o){n="Unknown error",console.error("Error parsing error message",o)}const i=t instanceof Sh?t:new Sh(n,e,t);throw jfe.sendError(i,i.category),i}function Hl(t,e="INTERNAL_SDK_ERROR"){const n={};return Object.keys(t).forEach(i=>{const o=t[i];if(typeof o=="function"){let l=o;o.constructor.name==="AsyncFunction"?l=async(...h)=>{try{return await o(...h)}catch(s){return w$(s,e)}}:l=(...h)=>{try{return o(...h)}catch(s){return w$(s,e)}},n[i]=l}else n[i]=o}),n}const Pl=Zr({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),Vfe={state:Pl,subscribeNetworkImages(t){return so(Pl.networkImages,()=>t(Pl.networkImages))},subscribeKey(t,e){return oo(Pl,t,e)},subscribe(t){return so(Pl,()=>t(Pl))},setWalletImage(t,e){Pl.walletImages[t]=e},setNetworkImage(t,e){Pl.networkImages[t]=e},setChainImage(t,e){Pl.chainImages[t]=e},setConnectorImage(t,e){Pl.connectorImages={...Pl.connectorImages,[t]:e}},setTokenImage(t,e){Pl.tokenImages[t]=e},setCurrencyImage(t,e){Pl.currencyImages[t]=e}},_o=Hl(Vfe),b$={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:"",sui:"",stacks:"",ton:"20f673c0-095e-49b2-07cf-eb5049dcf600"},d1=Zr({networkImagePromises:{},tokenImagePromises:{}}),Ur={async fetchWalletImage(t){if(t)return await fn._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||(d1.networkImagePromises[t]||(d1.networkImagePromises[t]=fn._fetchNetworkImage(t)),await d1.networkImagePromises[t],this.getNetworkImageById(t))},async fetchTokenImage(t){if(t)return d1.tokenImagePromises[t]||(d1.tokenImagePromises[t]=fn._fetchTokenImage(t)),await d1.tokenImagePromises[t],this.getTokenImage(t)},getWalletImageById(t){if(t)return _o.state.walletImages[t]},getWalletImage(t){if(t!=null&&t.image_url)return t==null?void 0:t.image_url;if(t!=null&&t.image_id)return _o.state.walletImages[t.image_id]},getNetworkImage(t){var e,n,i;if((e=t==null?void 0:t.assets)!=null&&e.imageUrl)return(n=t==null?void 0:t.assets)==null?void 0:n.imageUrl;if((i=t==null?void 0:t.assets)!=null&&i.imageId)return _o.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return _o.state.networkImages[t]},getConnectorImage(t){var e;if(t!=null&&t.imageUrl)return t.imageUrl;if((e=t==null?void 0:t.info)!=null&&e.icon)return t.info.icon;if(t!=null&&t.imageId)return _o.state.connectorImages[t.imageId]},getChainImage(t){return _o.state.networkImages[b$[t]]},getTokenImage(t){if(t)return _o.state.tokenImages[t]},getWalletImageUrl(t){if(!t)return"";const{projectId:e,sdkType:n,sdkVersion:i}=ut.state,o=new URL(`${at.W3M_API_URL}/getWalletImage/${t}`);return o.searchParams.set("projectId",e),o.searchParams.set("st",n),o.searchParams.set("sv",i),o.toString()},getAssetImageUrl(t){if(!t)return"";const{projectId:e,sdkType:n,sdkVersion:i}=ut.state,o=new URL(`${at.W3M_API_URL}/public/getAssetImage/${t}`);return o.searchParams.set("projectId",e),o.searchParams.set("st",n),o.searchParams.set("sv",i),o.toString()},getChainNamespaceImageUrl(t){return this.getAssetImageUrl(b$[t])},async getImageByToken(t,e){if(t==="native"){const i=at.NATIVE_IMAGE_IDS_BY_NAMESPACE[e]??null;return i?Ur.fetchNetworkImage(i):void 0}const[,n]=Object.entries(at.TOKEN_SYMBOLS_BY_ADDRESS).find(([i])=>i.toLowerCase()===t.toLowerCase())??[];if(n)return Ur.fetchTokenImage(n)}},Po={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app",androidPackage:"app.phantom"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com",evmDeeplink:"cbwallet://miniapp"},BINANCE:{id:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25",appId:"yFK5FCqYprrXDiVFbhyRx7",deeplink:"bnc://app.binance.com/mp/app",url:"https://app.binance.com/en/download"}},bG={isCustomDeeplinkWallet(t,e){return t===Po.PHANTOM.id?e===at.CHAIN.SOLANA||e===at.CHAIN.EVM||e===at.CHAIN.BITCOIN:t===Po.SOLFLARE.id?e===at.CHAIN.SOLANA:t===Po.COINBASE.id?e===at.CHAIN.SOLANA||e===at.CHAIN.EVM:t===Po.BINANCE.id?e===at.CHAIN.BITCOIN:!1},handleMobileDeeplinkRedirect(t,e,n){const i=window.location.href,o=encodeURIComponent(i),l=(n==null?void 0:n.isCoinbaseDisabled)??!1;if(t===Po.PHANTOM.id&&!("phantom"in window)){const h=i.startsWith("https")?"https":"http",s=i.split("/")[2],w=encodeURIComponent(`${h}://${s}`),x=`${Po.PHANTOM.url}/ul/browse/${o}?ref=${w}`;if(Ft.isAndroid()){const A=`intent://browse/${o}?ref=${w}#Intent;scheme=phantom;package=${Po.PHANTOM.androidPackage};end`;window.location.href=A}else window.location.href=x}if(t===Po.SOLFLARE.id&&e===at.CHAIN.SOLANA&&!("solflare"in window)&&(window.location.href=`${Po.SOLFLARE.url}/ul/v1/browse/${o}?ref=${o}`),e===at.CHAIN.SOLANA&&t===Po.COINBASE.id&&(l||!("coinbaseSolana"in window))&&(window.location.href=`${Po.COINBASE.url}/dapp?cb_url=${o}`),e===at.CHAIN.EVM&&t===Po.COINBASE.id&&(l||!("coinbaseWalletExtension"in window))&&(window.location.href=`${Po.COINBASE.evmDeeplink}?url=${o}`),e===at.CHAIN.BITCOIN&&t===Po.BINANCE.id&&!("binancew3w"in window)){const h=ue.state.activeCaipNetwork,s=window.btoa("/pages/browser/index"),w=window.btoa(`url=${o}&defaultChainId=${(h==null?void 0:h.id)??1}`),x=new URL(Po.BINANCE.deeplink);x.searchParams.set("appId",Po.BINANCE.appId),x.searchParams.set("startPagePath",s),x.searchParams.set("startPageQuery",w);const A=new URL(Po.BINANCE.url);A.searchParams.set("_dp",window.btoa(x.toString())),window.location.href=A.toString()}}},Wfe=Ft.getAnalyticsUrl(),Hfe=new IE({baseUrl:Wfe,clientId:null}),Gfe=["MODAL_CREATED"],qfe=45,v$=1e3*10,Ks=Zr({timestamp:Date.now(),lastFlush:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"},pendingEvents:[],subscribedToVisibilityChange:!1,walletImpressions:[]}),Sn={state:Ks,subscribe(t){return so(Ks,()=>t(Ks))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:n}=ut.state;return{projectId:t,st:e,sv:n||"html-wagmi-4.2.2"}},shouldFlushEvents(){const t=JSON.stringify(Ks.pendingEvents).length/1024>qfe,e=Ks.lastFlush+v$<Date.now();return t||e},_setPendingEvent(t){var e,n;try{let i=(e=ue.getAccountData())==null?void 0:e.address;if("address"in t.data&&t.data.address&&(i=t.data.address),Gfe.includes(t.data.event)||typeof window>"u")return;const o=(n=ue.getActiveCaipNetwork())==null?void 0:n.caipNetworkId;this.state.pendingEvents.push({eventId:Ft.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:i,properties:{..."properties"in t.data?t.data.properties:{},caipNetworkId:o}}}),Ks.reportedErrors.FORBIDDEN=!1,Sn.shouldFlushEvents()&&Sn._submitPendingEvents()}catch(i){console.warn("_setPendingEvent",i)}},sendEvent(t){var n;Ks.timestamp=Date.now(),Ks.data=t;const e=["INITIALIZE","CONNECT_SUCCESS","SOCIAL_LOGIN_SUCCESS"];((n=ut.state.features)!=null&&n.analytics||e.includes(t.event))&&Sn._setPendingEvent(Ks),this.subscribeToFlushTriggers()},sendWalletImpressionEvent(t){Ks.walletImpressions.push(t)},_transformPendingEventsForBatch(t){try{return t.filter(e=>e.props.event!=="WALLET_IMPRESSION_V2")}catch{return t}},_submitPendingEvents(){if(Ks.lastFlush=Date.now(),!(Ks.pendingEvents.length===0&&Ks.walletImpressions.length===0))try{const t=Sn._transformPendingEventsForBatch(Ks.pendingEvents);Ks.walletImpressions.length&&t.push({eventId:Ft.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:Date.now(),props:{type:"track",event:"WALLET_IMPRESSION_V2",items:[...Ks.walletImpressions]}}),Hfe.sendBeacon({path:"/batch",params:Sn.getSdkProperties(),body:t}),Ks.reportedErrors.FORBIDDEN=!1,Ks.pendingEvents=[],Ks.walletImpressions=[]}catch{Ks.reportedErrors.FORBIDDEN=!0}},subscribeToFlushTriggers(){var t,e,n;Ks.subscribedToVisibilityChange||typeof document>"u"||(Ks.subscribedToVisibilityChange=!0,(t=document==null?void 0:document.addEventListener)==null||t.call(document,"visibilitychange",()=>{document.visibilityState==="hidden"&&Sn._submitPendingEvents()}),(e=document==null?void 0:document.addEventListener)==null||e.call(document,"freeze",()=>{Sn._submitPendingEvents()}),(n=window==null?void 0:window.addEventListener)==null||n.call(window,"pagehide",()=>{Sn._submitPendingEvents()}),setInterval(()=>{Sn._submitPendingEvents()},v$))}},Zfe=Ft.getApiUrl(),xc=new IE({baseUrl:Zfe,clientId:null}),Kfe=40,x$=4,Yfe=20,$i=Zr({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1,explorerWallets:[],explorerFilteredWallets:[],plan:{tier:"none",hasExceededUsageLimit:!1,limits:{isAboveRpcLimit:!1,isAboveMauLimit:!1}}}),fn={state:$i,subscribeKey(t,e){return oo($i,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:n}=ut.state;return{projectId:t,st:e||"appkit",sv:n||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return ut.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${xc.baseUrl}/getWalletImage/${t}`,n=await xc.getBlob({path:e,params:fn._getSdkProperties()});_o.setWalletImage(t,URL.createObjectURL(n))},async _fetchNetworkImage(t){const e=`${xc.baseUrl}/public/getAssetImage/${t}`,n=await xc.getBlob({path:e,params:fn._getSdkProperties()});_o.setNetworkImage(t,URL.createObjectURL(n))},async _fetchConnectorImage(t){const e=`${xc.baseUrl}/public/getAssetImage/${t}`,n=await xc.getBlob({path:e,params:fn._getSdkProperties()});_o.setConnectorImage(t,URL.createObjectURL(n))},async _fetchCurrencyImage(t){const e=`${xc.baseUrl}/public/getCurrencyImage/${t}`,n=await xc.getBlob({path:e,params:fn._getSdkProperties()});_o.setCurrencyImage(t,URL.createObjectURL(n))},async _fetchTokenImage(t){const e=`${xc.baseUrl}/public/getTokenImage/${t}`,n=await xc.getBlob({path:e,params:fn._getSdkProperties()});_o.setTokenImage(t,URL.createObjectURL(n))},_filterWalletsByPlatform(t){const e=t.length,n=Ft.isMobile()?t==null?void 0:t.filter(o=>o.mobile_link||o.webapp_link?!0:Object.values(Po).map(h=>h.id).includes(o.id)):t,i=e-n.length;return{filteredWallets:n,mobileFilteredOutWalletsLength:i}},async fetchProjectConfig(){return(await xc.get({path:"/appkit/v1/config",params:fn._getSdkProperties()})).features},async fetchUsage(){try{const t=await xc.get({path:"/appkit/v1/project-limits",params:fn._getSdkProperties()}),{tier:e,isAboveMauLimit:n,isAboveRpcLimit:i}=t.planLimits,o=e==="starter",l=n||i;fn.state.plan={tier:e,hasExceededUsageLimit:o&&l,limits:{isAboveRpcLimit:i,isAboveMauLimit:n}}}catch(t){console.warn("Failed to fetch usage",t)}},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await xc.get({path:"/projects/v1/origins",params:fn._getSdkProperties()});return t}catch(t){if(t instanceof Error&&t.cause instanceof Response){const e=t.cause.status;if(e===at.HTTP_STATUS_CODES.TOO_MANY_REQUESTS)throw new Error("RATE_LIMITED",{cause:t});if(e>=at.HTTP_STATUS_CODES.SERVER_ERROR&&e<600)throw new Error("SERVER_ERROR",{cause:t});return[]}return[]}},async fetchNetworkImages(){const t=ue.getAllRequestedCaipNetworks(),e=t==null?void 0:t.map(({assets:n})=>n==null?void 0:n.imageId).filter(Boolean).filter(n=>!Ur.getNetworkImageById(n));e&&await Promise.allSettled(e.map(n=>fn._fetchNetworkImage(n)))},async fetchConnectorImages(){const{connectors:t}=Nt.state,e=t.map(({imageId:n})=>n).filter(Boolean);await Promise.allSettled(e.map(n=>fn._fetchConnectorImage(n)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>fn._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>fn._fetchTokenImage(e)))},async fetchWallets(t){var h;const e=t.exclude??[];fn._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(Po).map(s=>s.id));const i=await xc.get({path:"/getWallets",params:{...fn._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:(h=t.include)==null?void 0:h.join(","),exclude:e.join(",")}}),{filteredWallets:o,mobileFilteredOutWalletsLength:l}=fn._filterWalletsByPlatform(i==null?void 0:i.data);return{data:o||[],count:i==null?void 0:i.count,mobileFilteredOutWalletsLength:l}},async prefetchWalletRanks(){const t=Nt.state.connectors;if(!(t!=null&&t.length))return;const e={page:1,entries:20,badge:"certified"};if(e.names=t.map(o=>o.name).join(","),ue.state.activeChain===at.CHAIN.EVM){const o=[...t.flatMap(l=>{var h;return((h=l.connectors)==null?void 0:h.map(s=>{var w;return(w=s.info)==null?void 0:w.rdns}))||[]}),...t.map(l=>{var h;return(h=l.info)==null?void 0:h.rdns})].filter(l=>typeof l=="string"&&l.length>0);o.length&&(e.rdns=o.join(","))}const{data:n}=await fn.fetchWallets(e);$i.explorerWallets=n,Nt.extendConnectorsWithExplorerWallets(n);const i=ue.getRequestedCaipNetworkIds().join(",");$i.explorerFilteredWallets=n.filter(o=>{var l;return(l=o.chains)==null?void 0:l.some(h=>i.includes(h))})},async fetchFeaturedWallets(){const{featuredWalletIds:t}=ut.state;if(t!=null&&t.length){const e={...fn._getSdkProperties(),page:1,entries:(t==null?void 0:t.length)??x$,include:t},{data:n}=await fn.fetchWallets(e),i=[...n].sort((l,h)=>t.indexOf(l.id)-t.indexOf(h.id)),o=i.map(l=>l.image_id).filter(Boolean);await Promise.allSettled(o.map(l=>fn._fetchWalletImage(l))),$i.featured=i,$i.allFeatured=i}},async fetchRecommendedWallets(){try{$i.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:n}=ut.state,i=[...e??[],...n??[]].filter(Boolean),o=ue.getRequestedCaipNetworkIds().join(","),l={page:1,entries:x$,include:t,exclude:i,chains:o},{data:h,count:s}=await fn.fetchWallets(l),w=Jt.getRecentWallets(),x=h.map(P=>P.image_id).filter(Boolean),A=w.map(P=>P.image_id).filter(Boolean);await Promise.allSettled([...x,...A].map(P=>fn._fetchWalletImage(P))),$i.recommended=h,$i.allRecommended=h,$i.count=s??0}catch{}finally{$i.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){const{includeWalletIds:e,excludeWalletIds:n,featuredWalletIds:i}=ut.state,o=ue.getRequestedCaipNetworkIds().join(","),l=[...$i.recommended.map(({id:P})=>P),...n??[],...i??[]].filter(Boolean),h={page:t,entries:Kfe,include:e,exclude:l,chains:o},{data:s,count:w,mobileFilteredOutWalletsLength:x}=await fn.fetchWallets(h);$i.mobileFilteredOutWalletsLength=x+($i.mobileFilteredOutWalletsLength??0);const A=s.slice(0,Yfe).map(P=>P.image_id).filter(Boolean);await Promise.allSettled(A.map(P=>fn._fetchWalletImage(P))),$i.wallets=Ft.uniqueBy([...$i.wallets,...fn._filterOutExtensions(s)],"id").filter(P=>{var D;return(D=P.chains)==null?void 0:D.some(M=>o.includes(M))}),$i.count=w>$i.count?w:$i.count,$i.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:n}=await fn.fetchWallets(e);n&&n.forEach(i=>{$i.excludedWallets.push({rdns:i.rdns,name:i.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:n,excludeWalletIds:i}=ut.state,o=ue.getRequestedCaipNetworkIds().join(",");$i.search=[];const l={page:1,entries:100,search:t==null?void 0:t.trim(),badge_type:e,include:n,exclude:i,chains:o},{data:h}=await fn.fetchWallets(l);Sn.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const s=h.map(w=>w.image_id).filter(Boolean);await Promise.allSettled([...s.map(w=>fn._fetchWalletImage(w)),Ft.wait(300)]),$i.search=fn._filterOutExtensions(h)},initPromise(t,e){const n=$i.promises[t];return n||($i.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:n=!0,fetchNetworkImages:i=!0,fetchWalletRanks:o=!0}={}){const l=[t&&fn.initPromise("connectorImages",fn.fetchConnectorImages),e&&fn.initPromise("featuredWallets",fn.fetchFeaturedWallets),n&&fn.initPromise("recommendedWallets",fn.fetchRecommendedWallets),i&&fn.initPromise("networkImages",fn.fetchNetworkImages),o&&fn.initPromise("walletRanks",fn.prefetchWalletRanks)].filter(Boolean);return Promise.allSettled(l)},prefetchAnalyticsConfig(){var t;(t=ut.state.features)!=null&&t.analytics&&fn.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await xc.get({path:"/getAnalyticsConfig",params:fn._getSdkProperties()});ut.setFeatures({analytics:t})}catch{ut.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!(t!=null&&t.length)){$i.featured=$i.allFeatured,$i.recommended=$i.allRecommended;return}const e=ue.getRequestedCaipNetworkIds().join(",");$i.featured=$i.allFeatured.filter(n=>{var i;return(i=n.chains)==null?void 0:i.some(o=>e.includes(o))}),$i.recommended=$i.allRecommended.filter(n=>{var i;return(i=n.chains)==null?void 0:i.some(o=>e.includes(o))}),$i.filteredWallets=$i.wallets.filter(n=>{var i;return(i=n.chains)==null?void 0:i.some(o=>e.includes(o))})},clearFilterByNamespaces(){$i.filteredWallets=[]},setFilterByNamespace(t){if(!t){$i.featured=$i.allFeatured,$i.recommended=$i.allRecommended;return}const e=ue.getRequestedCaipNetworkIds().join(",");$i.featured=$i.allFeatured.filter(n=>{var i;return(i=n.chains)==null?void 0:i.some(o=>e.includes(o))}),$i.recommended=$i.allRecommended.filter(n=>{var i;return(i=n.chains)==null?void 0:i.some(o=>e.includes(o))}),$i.filteredWallets=$i.wallets.filter(n=>{var i;return(i=n.chains)==null?void 0:i.some(o=>e.includes(o))})}},Fl={filterOutDuplicatesByRDNS(t){const e=ut.state.enableEIP6963?Nt.state.connectors:[],n=Jt.getRecentWallets(),i=e.map(s=>{var w;return(w=s.info)==null?void 0:w.rdns}).filter(Boolean),o=n.map(s=>s.rdns).filter(Boolean),l=i.concat(o);if(l.includes("io.metamask.mobile")&&Ft.isMobile()){const s=l.indexOf("io.metamask.mobile");l[s]="io.metamask"}return t.filter(s=>!(s!=null&&s.rdns&&l.includes(String(s.rdns))||!(s!=null&&s.rdns)&&e.some(x=>x.name===s.name)))},filterOutDuplicatesByIds(t){const e=Nt.state.connectors.filter(s=>s.type==="ANNOUNCED"||s.type==="INJECTED"||s.type==="MULTI_CHAIN"),n=Jt.getRecentWallets(),i=e.map(s=>{var w;return s.explorerId||((w=s.explorerWallet)==null?void 0:w.id)||s.id}),o=n.map(s=>s.id),l=i.concat(o);return t.filter(s=>!l.includes(s==null?void 0:s.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=Nt.state,{featuredWalletIds:n}=ut.state,i=e.filter(h=>h.type==="ANNOUNCED").reduce((h,s)=>{var w;return(w=s.info)!=null&&w.rdns&&(h[s.info.rdns]=!0),h},{});return t.map(h=>({...h,installed:!!h.rdns&&!!i[h.rdns??""]})).sort((h,s)=>{const w=Number(s.installed)-Number(h.installed);if(w!==0)return w;if(n!=null&&n.length){const x=n.indexOf(h.id),A=n.indexOf(s.id);if(x!==-1&&A!==-1)return x-A;if(x!==-1)return-1;if(A!==-1)return 1}return 0})},getConnectOrderMethod(t,e){var w;const n=(t==null?void 0:t.connectMethodsOrder)||((w=ut.state.features)==null?void 0:w.connectMethodsOrder),i=e||Nt.state.connectors;if(n)return n;const{injected:o,announced:l}=ia.getConnectorsByType(i,fn.state.recommended,fn.state.featured),h=o.filter(ia.showConnector),s=l.filter(ia.showConnector);return h.length||s.length?["wallet","email","social"]:hi.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&fn.state.excludedWallets.some(i=>i.rdns===t.rdns),n=!!t.name&&fn.state.excludedWallets.some(i=>KV.isLowerCaseMatch(i.name,t.name));return e||n},markWalletsWithDisplayIndex(t){return t.map((e,n)=>({...e,display_index:n}))},filterWalletsByWcSupport(t){return Ht.state.wcBasic?t.filter(e=>e.supports_wc):Ft.isMobile()?t.filter(e=>e.supports_wc||hi.MANDATORY_WALLET_IDS_ON_MOBILE.includes(e.id)):t},getWalletConnectWallets(t){var l;const e=[...fn.state.featured,...fn.state.recommended];((l=fn.state.filteredWallets)==null?void 0:l.length)>0?e.push(...fn.state.filteredWallets):e.push(...t);const n=Ft.uniqueBy(e,"id"),i=Fl.markWalletsAsInstalled(n),o=Fl.filterWalletsByWcSupport(i);return Fl.markWalletsWithDisplayIndex(o)}},ia={getConnectorsByType(t,e,n){const{customWallets:i}=ut.state,o=Jt.getRecentWallets(),l=Fl.filterOutDuplicateWallets(e),h=Fl.filterOutDuplicateWallets(n),s=t.filter(P=>P.type==="MULTI_CHAIN"),w=t.filter(P=>P.type==="ANNOUNCED"),x=t.filter(P=>P.type==="INJECTED"),A=t.filter(P=>P.type==="EXTERNAL");return{custom:i,recent:o,external:A,multiChain:s,announced:w,injected:x,recommended:l,featured:h}},showConnector(t){var o;const e=(o=t.info)==null?void 0:o.rdns,n=!!e&&fn.state.excludedWallets.some(l=>!!l.rdns&&l.rdns===e),i=!!t.name&&fn.state.excludedWallets.some(l=>KV.isLowerCaseMatch(l.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!Ft.isMobile()||Ft.isMobile()&&!e&&!Ht.checkInstalled())||n||i)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(n||i))},getIsConnectedWithWC(){return Array.from(ue.state.chains.values()).some(n=>Nt.getConnectorId(n.namespace)===at.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:n,recent:i,announced:o,injected:l,multiChain:h,external:s,overriddenConnectors:w=(x=>(x=ut.state.features)==null?void 0:x.connectorTypeOrder)()??[]}){const P=[{type:"walletConnect",isEnabled:!0},{type:"recent",isEnabled:i.length>0},{type:"injected",isEnabled:[...l,...o,...h].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:n&&n.length>0},{type:"external",isEnabled:s.length>0},{type:"recommended",isEnabled:t.length>0}].filter(U=>U.isEnabled),D=new Set(P.map(U=>U.type)),M=w.filter(U=>D.has(U)).map(U=>({type:U,isEnabled:!0})),z=P.filter(({type:U})=>!M.some(({type:ne})=>ne===U));return Array.from(new Set([...M,...z].map(({type:U})=>U)))},sortConnectorsByExplorerWallet(t){return[...t].sort((e,n)=>e.explorerWallet&&n.explorerWallet?(e.explorerWallet.order??0)-(n.explorerWallet.order??0):e.explorerWallet?-1:n.explorerWallet?1:0)},getPriority(t){return t.id===at.CONNECTOR_ID.BASE_ACCOUNT?0:t.id===at.CONNECTOR_ID.COINBASE||t.id===at.CONNECTOR_ID.COINBASE_SDK?1:2},sortConnectorsByPriority(t){return[...t].sort((e,n)=>ia.getPriority(e)-ia.getPriority(n))},getAuthName({email:t,socialUsername:e,socialProvider:n}){return e?n&&n==="discord"&&e.endsWith("0")?e.slice(0,-1):e:t.length>30?`${t.slice(0,-3)}...`:t},async fetchProviderData(t){var e,n;try{if(t.name==="Browser Wallet"&&!Ft.isMobile())return{accounts:[],chainId:void 0};if(t.id===at.CONNECTOR_ID.AUTH)return{accounts:[],chainId:void 0};const[i,o]=await Promise.all([(e=t.provider)==null?void 0:e.request({method:"eth_accounts"}),(n=t.provider)==null?void 0:n.request({method:"eth_chainId"}).then(l=>Number(l))]);return{accounts:i,chainId:o}}catch(i){return console.warn(`Failed to fetch provider data for ${t.name}`,i),{accounts:[],chainId:void 0}}},getFilteredCustomWallets(t){const e=Jt.getRecentWallets(),n=Nt.state.connectors.map(h=>{var s;return(s=h.info)==null?void 0:s.rdns}).filter(Boolean),i=e.map(h=>h.rdns).filter(Boolean),o=n.concat(i);if(o.includes("io.metamask.mobile")&&Ft.isMobile()){const h=o.indexOf("io.metamask.mobile");o[h]="io.metamask"}return t.filter(h=>!o.includes(String(h==null?void 0:h.rdns)))},hasWalletConnector(t){return Nt.state.connectors.some(e=>e.id===t.id||e.name===t.name)},isWalletCompatibleWithCurrentChain(t){const e=ue.state.activeChain;return e&&t.chains?t.chains.some(n=>{const i=n.split(":")[0];return e===i}):!0},getFilteredRecentWallets(){return Jt.getRecentWallets().filter(n=>!Fl.isExcluded(n)).filter(n=>!this.hasWalletConnector(n)).filter(n=>this.isWalletCompatibleWithCurrentChain(n))},getCappedRecommendedWallets(t){const{connectors:e}=Nt.state,{customWallets:n,featuredWalletIds:i}=ut.state,o=e.find(oe=>oe.id==="walletConnect"),l=e.filter(oe=>oe.type==="INJECTED"||oe.type==="ANNOUNCED"||oe.type==="MULTI_CHAIN");if(!o&&!l.length&&!(n!=null&&n.length))return[];const h=v8.isEmailEnabled(),s=v8.isSocialsEnabled(),w=l.filter(oe=>oe.name!=="Browser Wallet"&&oe.name!=="WalletConnect"),x=(i==null?void 0:i.length)||0,A=(n==null?void 0:n.length)||0,P=w.length||0,D=h?1:0,M=s?1:0,z=x+A+P+D+M,G=Math.max(0,4-z);return G<=0?[]:Fl.filterOutDuplicateWallets(t).slice(0,G)},processConnectorsByType(t,e=!0){const n=ia.sortConnectorsByExplorerWallet([...t]);return e?n.filter(ia.showConnector):n},connectorList(){const t=ia.getConnectorsByType(Nt.state.connectors,fn.state.recommended,fn.state.featured),e=this.processConnectorsByType(t.announced.filter(M=>M.id!=="walletConnect")),n=this.processConnectorsByType(t.injected),i=this.processConnectorsByType(t.multiChain.filter(M=>M.name!=="WalletConnect"),!1),o=t.custom,l=t.recent,h=this.processConnectorsByType(t.external.filter(M=>M.id!==at.CONNECTOR_ID.COINBASE_SDK&&M.id!==at.CONNECTOR_ID.BASE_ACCOUNT)),s=t.recommended,w=t.featured,x=ia.getConnectorTypeOrder({custom:o,recent:l,announced:e,injected:n,multiChain:i,recommended:s,featured:w,external:h}),A=Nt.state.connectors.find(M=>M.id==="walletConnect"),P=Ft.isMobile(),D=[];for(const M of x)switch(M){case"walletConnect":{!P&&A&&D.push({kind:"connector",subtype:"walletConnect",connector:A});break}case"recent":{ia.getFilteredRecentWallets().forEach(U=>D.push({kind:"wallet",subtype:"recent",wallet:U}));break}case"injected":{i.forEach(z=>D.push({kind:"connector",subtype:"multiChain",connector:z})),e.forEach(z=>D.push({kind:"connector",subtype:"announced",connector:z})),n.forEach(z=>D.push({kind:"connector",subtype:"injected",connector:z}));break}case"featured":{w.forEach(z=>D.push({kind:"wallet",subtype:"featured",wallet:z}));break}case"custom":{ia.getFilteredCustomWallets(o??[]).forEach(U=>D.push({kind:"wallet",subtype:"custom",wallet:U}));break}case"external":{h.forEach(z=>D.push({kind:"connector",subtype:"external",connector:z}));break}case"recommended":{ia.getCappedRecommendedWallets(s).forEach(U=>D.push({kind:"wallet",subtype:"recommended",wallet:U}));break}default:console.warn(`Unknown connector type: ${M}`)}return D},hasInjectedConnectors(){return Nt.state.connectors.filter(t=>(t.type==="INJECTED"||t.type==="ANNOUNCED"||t.type==="MULTI_CHAIN")&&t.name!=="Browser Wallet"&&t.name!=="WalletConnect").length}},Xfe=["ConnectingExternal","ConnectingMultiChain","ConnectingSocial","ConnectingFarcaster"],Vr=Zr({view:"Connect",history:["Connect"],transactionStack:[]}),Jfe={state:Vr,subscribeKey(t,e){return oo(Vr,t,e)},pushTransactionStack(t){Vr.transactionStack.push(t)},popTransactionStack(t){const e=Vr.transactionStack.pop();if(!e)return;const{onSuccess:n,onError:i,onCancel:o}=e;switch(t){case"success":n==null||n();break;case"error":i==null||i(),Pt.goBack();break;case"cancel":o==null||o(),Pt.goBack();break}},push(t,e){let n=t,i=e;fn.state.plan.hasExceededUsageLimit&&Xfe.includes(t)&&(n="UsageExceeded",i=void 0),n!==Vr.view&&(Vr.view=n,Vr.history.push(n),Vr.data=i)},reset(t,e){Vr.view=t,Vr.history=[t],Vr.data=e},replace(t,e){Vr.history.at(-1)===t||(Vr.view=t,Vr.history[Vr.history.length-1]=t,Vr.data=e)},goBack(){var i,o;const t=ue.state.activeCaipAddress,e=Pt.state.view==="ConnectingFarcaster",n=!t&&e;if(Vr.history.length>1){Vr.history.pop();const[l]=Vr.history.slice(-1);l&&(t&&l==="Connect"?Vr.view="Account":Vr.view=l)}else gi.close();(i=Vr.data)!=null&&i.wallet&&(Vr.data.wallet=void 0),(o=Vr.data)!=null&&o.redirectView&&(Vr.data.redirectView=void 0),setTimeout(()=>{var l,h,s;if(n){ue.setAccountProp("farcasterUrl",void 0,ue.state.activeChain);const w=Nt.getAuthConnector();(l=w==null?void 0:w.provider)==null||l.reload();const x=j0(ut.state);(s=(h=w==null?void 0:w.provider)==null?void 0:h.syncDappData)==null||s.call(h,{metadata:x.metadata,sdkVersion:x.sdkVersion,projectId:x.projectId,sdkType:x.sdkType})}},100)},goBackToIndex(t){if(Vr.history.length>1){Vr.history=Vr.history.slice(0,t+1);const[e]=Vr.history.slice(-1);e&&(Vr.view=e)}},goBackOrCloseModal(){Pt.state.history.length>1?Pt.goBack():gi.close()}},Pt=Hl(Jfe),mf=Zr({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),x8={state:mf,subscribe(t){return so(mf,()=>t(mf))},setThemeMode(t){mf.themeMode=t;try{const e=Nt.getAuthConnector();if(e){const n=x8.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:n,w3mThemeVariables:r2(n,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){mf.themeVariables={...mf.themeVariables,...t};try{const e=Nt.getAuthConnector();if(e){const n=x8.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:n,w3mThemeVariables:r2(mf.themeVariables,mf.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return j0(mf)}},ra=Hl(x8),vG=Object.fromEntries(eW.map(t=>[t,void 0])),Qfe=Object.fromEntries(eW.map(t=>[t,!0])),Er=Zr({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:vG,filterByNamespaceMap:Qfe}),epe={state:Er,subscribe(t){return so(Er,()=>{t(Er)})},subscribeKey(t,e){return oo(Er,t,e)},initialize(t){t.forEach(e=>{const n=Jt.getConnectedConnectorId(e);n&&Nt.setConnectorId(n,e)})},setActiveConnector(t){t&&(Er.activeConnector=J1(t))},setConnectors(t){t.filter(o=>!Er.allConnectors.some(l=>l.id===o.id&&Nt.getConnectorName(l.name)===Nt.getConnectorName(o.name)&&l.chain===o.chain)).forEach(o=>{o.type!=="MULTI_CHAIN"&&Er.allConnectors.push(J1(o))});const n=Nt.getEnabledNamespaces(),i=Nt.getEnabledConnectors(n);Er.connectors=Nt.mergeMultiChainConnectors(i)},filterByNamespaces(t){Object.keys(Er.filterByNamespaceMap).forEach(e=>{Er.filterByNamespaceMap[e]=!1}),t.forEach(e=>{Er.filterByNamespaceMap[e]=!0}),Nt.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){Er.filterByNamespaceMap[t]=e,Nt.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=Nt.getEnabledNamespaces(),e=Nt.getEnabledConnectors(t),n=Nt.areAllNamespacesEnabled();Er.connectors=Nt.mergeMultiChainConnectors(e),n?fn.clearFilterByNamespaces():fn.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(Er.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return Er.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(Er.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=Nt.generateConnectorMapByName(t),n=[];return e.forEach(i=>{const o=i[0],l=(o==null?void 0:o.id)===at.CONNECTOR_ID.AUTH;i.length>1&&o?n.push({name:o.name,imageUrl:o.imageUrl,imageId:o.imageId,connectors:[...i],type:l?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(o==null?void 0:o.id)||""}):o&&n.push(o)}),n},generateConnectorMapByName(t){const e=new Map;return t.forEach(n=>{const{name:i}=n,o=Nt.getConnectorName(i);if(!o)return;const l=e.get(o)||[];l.find(s=>s.chain===n.chain)||l.push(n),e.set(o,l)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(n=>{e.find(i=>i.chain===n.chain)||e.push(n)}),e},addConnector(t){var e,n,i;if(t.id===at.CONNECTOR_ID.AUTH){const o=t,l=j0(ut.state),h=ra.getSnapshot().themeMode,s=ra.getSnapshot().themeVariables;(n=(e=o==null?void 0:o.provider)==null?void 0:e.syncDappData)==null||n.call(e,{metadata:l.metadata,sdkVersion:l.sdkVersion,projectId:l.projectId,sdkType:l.sdkType}),(i=o==null?void 0:o.provider)==null||i.syncTheme({themeMode:h,themeVariables:s,w3mThemeVariables:r2(s,h)}),Nt.setConnectors([t])}else Nt.setConnectors([t])},getAuthConnector(t){var i;const e=t||ue.state.activeChain,n=Er.connectors.find(o=>o.id===at.CONNECTOR_ID.AUTH);if(n)return(i=n==null?void 0:n.connectors)!=null&&i.length?n.connectors.find(l=>l.chain===e):n},getAnnouncedConnectorRdns(){return Er.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>{var e;return(e=t.info)==null?void 0:e.rdns})},getConnectorById(t){return ia.sortConnectorsByPriority(Er.allConnectors).find(n=>n.id===t)},getConnector({id:t,namespace:e}){const n=e||ue.state.activeChain,i=Er.allConnectors.filter(h=>h.chain===n);return ia.sortConnectorsByPriority(i).find(h=>h.id===t||h.explorerId===t)},syncIfAuthConnector(t){var l,h;if(t.id!=="AUTH")return;const e=t,n=j0(ut.state),i=ra.getSnapshot().themeMode,o=ra.getSnapshot().themeVariables;(h=(l=e==null?void 0:e.provider)==null?void 0:l.syncDappData)==null||h.call(l,{metadata:n.metadata,sdkVersion:n.sdkVersion,sdkType:n.sdkType,projectId:n.projectId}),e.provider.syncTheme({themeMode:i,themeVariables:o,w3mThemeVariables:r2(o,i)})},getConnectorsByNamespace(t){const e=Er.allConnectors.filter(n=>n.chain===t);return Nt.mergeMultiChainConnectors(e)},canSwitchToSmartAccount(t){return ue.checkIfSmartAccountEnabled()&&Fs(t)===Gr.ACCOUNT_TYPES.EOA},selectWalletConnector(t){var o;const e=(o=Pt.state.data)==null?void 0:o.redirectView,n=ue.state.activeChain,i=n?Nt.getConnector({id:t.id,namespace:n}):void 0;bG.handleMobileDeeplinkRedirect((i==null?void 0:i.explorerId)||t.id,ue.state.activeChain,{isCoinbaseDisabled:ut.state.enableCoinbase===!1}),i?Pt.push("ConnectingExternal",{connector:i,wallet:t,redirectView:e}):Pt.push("ConnectingWalletConnect",{wallet:t,redirectView:e})},getConnectors(t){return t?Nt.getConnectorsByNamespace(t):Nt.mergeMultiChainConnectors(Er.allConnectors)},setFilterByNamespace(t){Er.filterByNamespace=t,Er.connectors=Nt.getConnectors(t),fn.setFilterByNamespace(t)},setConnectorId(t,e){t&&(Er.activeConnectorIds={...Er.activeConnectorIds,[e]:t},Jt.setConnectedConnectorId(e,t))},removeConnectorId(t){Er.activeConnectorIds={...Er.activeConnectorIds,[t]:void 0},Jt.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return Er.activeConnectorIds[t]},isConnected(t){return t?!!Er.activeConnectorIds[t]:Object.values(Er.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){Er.activeConnectorIds={...vG}},extendConnectorsWithExplorerWallets(t){Er.allConnectors.forEach(i=>{const o=t.find(l=>{var h;return l.id===i.id||l.rdns&&l.rdns===((h=i.info)==null?void 0:h.rdns)});o&&(i.explorerWallet=o)});const e=Nt.getEnabledNamespaces(),n=Nt.getEnabledConnectors(e);Er.connectors=Nt.mergeMultiChainConnectors(n)},async connect(t={}){const{namespace:e}=t;return Nt.setFilterByNamespace(e),Pt.push("Connect",{addWalletForNamespace:e}),new Promise((n,i)=>{if(e){const o=ue.subscribeChainProp("accountState",h=>{h!=null&&h.caipAddress&&(n({caipAddress:h==null?void 0:h.caipAddress}),o())},e),l=gi.subscribeKey("open",h=>{h||(i(new Error("Modal closed")),l())})}else{const o=ue.subscribeKey("activeCaipAddress",h=>{h&&(n({caipAddress:h}),o())}),l=gi.subscribeKey("open",h=>{h||(i(new Error("Modal closed")),l())})}})}},Nt=Hl(epe),tpe=1e3,ux={checkNamespaceConnectorId(t,e){return Nt.getConnectorId(t)===e},isSocialProvider(t){return hi.DEFAULT_REMOTE_FEATURES.socials.includes(t)},connectWalletConnect({walletConnect:t,connector:e,closeModalOnConnect:n=!0,redirectViewOnModalClose:i="Connect",onOpen:o,onConnect:l}){return new Promise((h,s)=>{if(t&&Nt.setActiveConnector(e),o==null||o(Ft.isMobile()&&t),i){const x=gi.subscribeKey("open",A=>{A||(Pt.state.view!==i&&Pt.replace(i),x(),s(new Error("Modal closed")))})}const w=ue.subscribeKey("activeCaipAddress",x=>{x&&(l==null||l(),n&&gi.close(),w(),h(No.parseCaipAddress(x)))})})},connectExternal(t){return new Promise((e,n)=>{const i=ue.subscribeKey("activeCaipAddress",o=>{o&&(gi.close(),i(),e(No.parseCaipAddress(o)))});Ht.connectExternal(t,t.chain).catch(()=>{i(),n(new Error("Connection rejected"))})})},connectSocial({social:t,namespace:e,closeModalOnConnect:n=!0,onOpenFarcaster:i,onConnect:o}){let l,h=!1,s=null;const w=e||ue.state.activeChain,x=ue.subscribeKey("activeCaipAddress",A=>{A&&(n&&gi.close(),x())});return new Promise((A,P)=>{async function D(z){var U;if((U=z.data)!=null&&U.resultUri)if(z.origin===at.SECURE_SITE_SDK_ORIGIN){window.removeEventListener("message",D,!1);try{const G=Nt.getAuthConnector(w);if(G&&!h){l&&l.close(),h=!0;const ne=z.data.resultUri;Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_REQUEST_USER_DATA",properties:{provider:t}}),Jt.setConnectedSocialProvider(t),await Ht.connectExternal({id:G.id,type:G.type,socialUri:ne},G.chain);const oe=ue.state.activeCaipAddress;if(!oe){P(new Error("Failed to connect"));return}A(No.parseCaipAddress(oe)),Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:t}})}}catch(G){Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:Ft.parseError(G)}}),P(new Error("Failed to connect"))}}else Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:"Untrusted Origin"}})}async function M(){if(Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_STARTED",properties:{provider:t}}),t==="farcaster"){i==null||i();const z=gi.subscribeKey("open",G=>{!G&&t==="farcaster"&&(P(new Error("Popup closed")),o==null||o(),z())}),U=Nt.getAuthConnector();if(U){const G=ue.getAccountData(w);if(!(G!=null&&G.farcasterUrl))try{const{url:ne}=await U.provider.getFarcasterUri();ue.setAccountProp("farcasterUrl",ne,w)}catch{P(new Error("Failed to connect to farcaster"))}}}else{const z=Nt.getAuthConnector();s=Ft.returnOpenHref(`${at.SECURE_SITE_SDK_ORIGIN}/loading`,"popupWindow","width=600,height=800,scrollbars=yes");try{if(z){const{uri:U}=await z.provider.getSocialRedirectUri({provider:t});if(s&&U){s.location.href=U,l=s;const G=setInterval(()=>{l!=null&&l.closed&&!h&&(P(new Error("Popup closed")),clearInterval(G))},1e3);window.addEventListener("message",D,!1)}else s==null||s.close(),P(new Error("Failed to initiate social connection"))}}catch{P(new Error("Failed to initiate social connection")),s==null||s.close()}}}M()})},connectEmail({closeModalOnConnect:t=!0,redirectViewOnModalClose:e="Connect",onOpen:n,onConnect:i}){return new Promise((o,l)=>{if(n==null||n(),e){const s=gi.subscribeKey("open",w=>{w||(Pt.state.view!==e&&Pt.replace(e),s(),l(new Error("Modal closed")))})}const h=ue.subscribeKey("activeCaipAddress",s=>{s&&(i==null||i(),t&&gi.close(),h(),o(No.parseCaipAddress(s)))})})},async updateEmail(){const t=Jt.getConnectedConnectorId(ue.state.activeChain),e=Nt.getAuthConnector();if(!e)throw new Error("No auth connector found");if(t!==at.CONNECTOR_ID.AUTH)throw new Error("Not connected to email or social");const n=e.provider.getEmail()??"";return await gi.open({view:"UpdateEmailWallet",data:{email:n,redirectView:void 0}}),new Promise((i,o)=>{const l=setInterval(()=>{const s=e.provider.getEmail()??"";s!==n&&(gi.close(),clearInterval(l),h(),i({email:s}))},tpe),h=gi.subscribeKey("open",s=>{s||(Pt.state.view!=="Connect"&&Pt.push("Connect"),clearInterval(l),h(),o(new Error("Modal closed")))})})},canSwitchToSmartAccount(t){return ue.checkIfSmartAccountEnabled()&&Fs(t)===Gr.ACCOUNT_TYPES.EOA}};function TA(){var i,o;const t=((i=ue.state.activeCaipNetwork)==null?void 0:i.chainNamespace)||"eip155",e=((o=ue.state.activeCaipNetwork)==null?void 0:o.id)||1,n=hi.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${n}`}function E$e(t){return hi.NATIVE_TOKEN_ADDRESS[t]}function Fs(t){var n;return(n=ue.getAccountData(t))==null?void 0:n.preferredAccountType}function Nf(t){var e,n;return t?(n=(e=ue.state.chains.get(t))==null?void 0:e.networkState)==null?void 0:n.caipNetwork:ue.state.activeCaipNetwork}const Bl={getConnectionStatus(t,e){const n=Nt.state.activeConnectorIds[e],i=Ht.getConnections(e);return!!n&&t.connectorId===n?"connected":i.some(h=>h.connectorId.toLowerCase()===t.connectorId.toLowerCase())?"active":"disconnected"},excludeConnectorAddressFromConnections({connections:t,connectorId:e,addresses:n}){return t.map(i=>{if((e?i.connectorId.toLowerCase()===e.toLowerCase():!1)&&n){const l=i.accounts.filter(h=>!n.some(w=>w.toLowerCase()===h.address.toLowerCase()));return{...i,accounts:l}}return i})},excludeExistingConnections(t,e){const n=new Set(t);return e.filter(i=>!n.has(i.connectorId))},getConnectionsByConnectorId(t,e){return t.filter(n=>n.connectorId.toLowerCase()===e.toLowerCase())},getConnectionsData(t){var s;const e=!!((s=ut.state.remoteFeatures)!=null&&s.multiWallet),n=Nt.state.activeConnectorIds[t],i=Ht.getConnections(t),l=(Ht.state.recentConnections.get(t)??[]).filter(w=>Nt.getConnectorById(w.connectorId)),h=Bl.excludeExistingConnections([...i.map(w=>w.connectorId),...n?[n]:[]],l);return e?{connections:i,recentConnections:h}:{connections:i.filter(w=>w.connectorId.toLowerCase()===(n==null?void 0:n.toLowerCase())),recentConnections:[]}},onConnectMobile(t,e){const n=Ht.state.wcUri;if(t!=null&&t.mobile_link&&n)try{Ht.setWcError(!1);const{mobile_link:i,link_mode:o,name:l}=t,h=Ft.appendPayToUri(n,e),{redirect:s,redirectUniversalLink:w,href:x}=Ft.formatNativeUrl(i,h,o),A=s,P=w,D=Ft.isIframe()?"_top":"_self";Ht.setWcLinking({name:l,href:x}),Ht.setRecentWallet(t),ut.state.experimental_preferUniversalLinks&&P?Ft.openHref(P,D):Ft.openHref(A,D)}catch(i){Sn.sendEvent({type:"track",event:"CONNECT_PROXY_ERROR",properties:{message:i instanceof Error?i.message:"Error parsing the deep link",uri:n,mobile_link:t.mobile_link,name:t.name}}),Ht.setWcError(!0)}}},h1=Zr({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1,connectingWallet:void 0}),$l={state:h1,subscribe(t){return so(h1,()=>t(h1))},subscribeOpen(t){return oo(h1,"open",t)},set(t){Object.assign(h1,{...h1,...t})}},Cs=Zr({transactions:[],transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),npe={state:Cs,subscribe(t){return so(Cs,()=>t(Cs))},setLastNetworkInView(t){Cs.lastNetworkInView=t},async fetchTransactions(t){var e;if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Cs.loading=!0;try{const n=await Ci.fetchTransactions({account:t,cursor:Cs.next,chainId:(e=ue.state.activeCaipNetwork)==null?void 0:e.caipNetworkId}),i=Ec.filterSpamTransactions(n.data),o=Ec.filterByConnectedChain(i),l=[...Cs.transactions,...o];Cs.loading=!1,Cs.transactions=l,Cs.transactionsByYear=Ec.groupTransactionsByYearAndMonth(Cs.transactionsByYear,o),Cs.empty=l.length===0,Cs.next=n.next?n.next:void 0}catch{const i=ue.state.activeChain;Sn.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:ut.state.projectId,cursor:Cs.next,isSmartAccount:Fs(i)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}),Ji.showError("Failed to fetch transactions"),Cs.loading=!1,Cs.empty=!0,Cs.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const n=t;return e.forEach(i=>{const o=new Date(i.metadata.minedAt).getFullYear(),l=new Date(i.metadata.minedAt).getMonth(),h=n[o]??{},w=(h[l]??[]).filter(x=>x.id!==i.id);n[o]={...h,[l]:[...w,i].sort((x,A)=>new Date(A.metadata.minedAt).getTime()-new Date(x.metadata.minedAt).getTime())}}),n},filterSpamTransactions(t){return t.filter(e=>{var i;return!((i=e.transfers)==null?void 0:i.every(o=>{var l;return((l=o.nft_info)==null?void 0:l.flags.is_spam)===!0}))})},filterByConnectedChain(t){var i;const e=(i=ue.state.activeCaipNetwork)==null?void 0:i.caipNetworkId;return t.filter(o=>o.metadata.chain===e)},clearCursor(){Cs.next=void 0},resetTransactions(){Cs.transactions=[],Cs.transactionsByYear={},Cs.lastNetworkInView=void 0,Cs.loading=!1,Cs.empty=!1,Cs.next=void 0}},Ec=Hl(npe,"API_ERROR"),rr=Zr({connections:new Map,recentConnections:new Map,isSwitchingConnection:!1,wcError:!1,wcFetchingUri:!1,buffering:!1,status:"disconnected"});let a0;const ipe={state:rr,subscribe(t){return so(rr,()=>t(rr))},subscribeKey(t,e){return oo(rr,t,e)},_getClient(){return rr._client},setClient(t){rr._client=J1(t)},initialize(t){const e=t.filter(n=>!!n.namespace).map(n=>n.namespace);Ht.syncStorageConnections(e)},syncStorageConnections(t){const e=Jt.getConnections(),n=t??Array.from(ue.state.chains.keys());for(const i of n){const o=e[i]??[],l=new Map(rr.recentConnections);l.set(i,o),rr.recentConnections=l}},getConnections(t){return t?rr.connections.get(t)??[]:[]},hasAnyConnection(t){const e=Ht.state.connections;return Array.from(e.values()).flatMap(n=>n).some(({connectorId:n})=>n===t)},async connectWalletConnect({cache:t="auto"}={}){var n,i,o,l;rr.wcFetchingUri=!0;const e=Ft.isTelegram()||Ft.isSafari()&&Ft.isIos();if(t==="always"||t==="auto"&&e){if(a0){await a0,a0=void 0;return}if(!Ft.isPairingExpired(rr==null?void 0:rr.wcPairingExpiry)){const h=rr.wcUri;rr.wcUri=h;return}a0=(i=(n=Ht._getClient())==null?void 0:n.connectWalletConnect)==null?void 0:i.call(n).catch(()=>{}),Ht.state.status="connecting",await a0,a0=void 0,rr.wcPairingExpiry=void 0,Ht.state.status="connected"}else await((l=(o=Ht._getClient())==null?void 0:o.connectWalletConnect)==null?void 0:l.call(o))},async connectExternal(t,e,n=!0){var h,s,w;const i=await((s=(h=Ht._getClient())==null?void 0:h.connectExternal)==null?void 0:s.call(h,t));n&&ue.setActiveNamespace(e);const o=Nt.state.allConnectors.find(x=>x.id===(t==null?void 0:t.id)),l=t.type==="AUTH"?"email":"browser";return Sn.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:l,name:(o==null?void 0:o.name)||"Unknown",view:Pt.state.view,walletRank:(w=o==null?void 0:o.explorerWallet)==null?void 0:w.order}}),i},async reconnectExternal(t){var n,i;await((i=(n=Ht._getClient())==null?void 0:n.reconnectExternal)==null?void 0:i.call(n,t));const e=t.chain||ue.state.activeChain;e&&Nt.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){var i;if(!e)return;gi.setLoading(!0,ue.state.activeChain);const n=Nt.getAuthConnector();n&&(ue.setAccountProp("preferredAccountType",t,e),await n.provider.setPreferredAccount(t),Jt.setPreferredAccountTypes(Object.entries(ue.state.chains).reduce((o,[l,h])=>{const s=l,w=Fs(s);return w!==void 0&&(o[s]=w),o},{})),await Ht.reconnectExternal(n),gi.setLoading(!1,ue.state.activeChain),Sn.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:((i=ue.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}}))},async signMessage(t){var e;return(e=Ht._getClient())==null?void 0:e.signMessage(t)},parseUnits(t,e){var n;return(n=Ht._getClient())==null?void 0:n.parseUnits(t,e)},formatUnits(t,e){var n;return(n=Ht._getClient())==null?void 0:n.formatUnits(t,e)},updateBalance(t){var e;return(e=Ht._getClient())==null?void 0:e.updateBalance(t)},async sendTransaction(t){var e;return(e=Ht._getClient())==null?void 0:e.sendTransaction(t)},async getCapabilities(t){var e;return(e=Ht._getClient())==null?void 0:e.getCapabilities(t)},async grantPermissions(t){var e;return(e=Ht._getClient())==null?void 0:e.grantPermissions(t)},async walletGetAssets(t){var e;return((e=Ht._getClient())==null?void 0:e.walletGetAssets(t))??{}},async estimateGas(t){var e;return(e=Ht._getClient())==null?void 0:e.estimateGas(t)},async writeContract(t){var e;return(e=Ht._getClient())==null?void 0:e.writeContract(t)},async writeSolanaTransaction(t){var e;return(e=Ht._getClient())==null?void 0:e.writeSolanaTransaction(t)},async getEnsAddress(t){var e;return(e=Ht._getClient())==null?void 0:e.getEnsAddress(t)},async getEnsAvatar(t){var e;return(e=Ht._getClient())==null?void 0:e.getEnsAvatar(t)},checkInstalled(t){var e,n;return((n=(e=Ht._getClient())==null?void 0:e.checkInstalled)==null?void 0:n.call(e,t))||!1},resetWcConnection(){rr.wcUri=void 0,rr.wcPairingExpiry=void 0,rr.wcLinking=void 0,rr.recentWallet=void 0,rr.wcFetchingUri=!1,rr.status="disconnected",Ec.resetTransactions(),Jt.deleteWalletConnectDeepLink(),Jt.deleteRecentWallet(),$l.set({connectingWallet:void 0})},resetUri(){rr.wcUri=void 0,rr.wcPairingExpiry=void 0,a0=void 0,rr.wcFetchingUri=!1,$l.set({connectingWallet:void 0})},finalizeWcConnection(t){var i,o;const{wcLinking:e,recentWallet:n}=Ht.state;e&&Jt.setWalletConnectDeepLink(e),n&&Jt.setAppKitRecent(n),t&&Sn.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:t,properties:{method:e?"mobile":"qrcode",name:((o=(i=Pt.state.data)==null?void 0:i.wallet)==null?void 0:o.name)||"Unknown",view:Pt.state.view,walletRank:n==null?void 0:n.order}})},setWcBasic(t){rr.wcBasic=t},setUri(t){rr.wcUri=t,rr.wcFetchingUri=!1,rr.wcPairingExpiry=Ft.getPairingExpiry()},setWcLinking(t){rr.wcLinking=t},setWcError(t){rr.wcError=t,rr.wcFetchingUri=!1,rr.buffering=!1},setRecentWallet(t){rr.recentWallet=t},setBuffering(t){rr.buffering=t},setStatus(t){rr.status=t},setIsSwitchingConnection(t){rr.isSwitchingConnection=t},async disconnect({id:t,namespace:e,initialDisconnect:n}={}){var i;try{await((i=Ht._getClient())==null?void 0:i.disconnect({id:t,chainNamespace:e,initialDisconnect:n}))}catch(o){throw new Sh("Failed to disconnect","INTERNAL_SDK_ERROR",o)}},async disconnectConnector({id:t,namespace:e}){var n;try{await((n=Ht._getClient())==null?void 0:n.disconnectConnector({id:t,namespace:e}))}catch(i){throw new Sh("Failed to disconnect connector","INTERNAL_SDK_ERROR",i)}},setConnections(t,e){const n=new Map(rr.connections);n.set(e,t),rr.connections=n},async handleAuthAccountSwitch({address:t,namespace:e}){var l,h;const n=ue.getAccountData(e),i=(h=(l=n==null?void 0:n.user)==null?void 0:l.accounts)==null?void 0:h.find(s=>s.type==="smartAccount"),o=i&&i.address.toLowerCase()===t.toLowerCase()&&ux.canSwitchToSmartAccount(e)?"smartAccount":"eoa";await Ht.setPreferredAccountType(o,e)},async handleActiveConnection({connection:t,namespace:e,address:n}){const i=Nt.getConnectorById(t.connectorId),o=t.connectorId===at.CONNECTOR_ID.AUTH;if(!i)throw new Error(`No connector found for connection: ${t.connectorId}`);if(o)n&&await Ht.handleAuthAccountSwitch({address:n,namespace:e});else{const l=await Ht.connectExternal({id:i.id,type:i.type,provider:i.provider,address:n,chain:e},e);return l==null?void 0:l.address}return n},async handleDisconnectedConnection({connection:t,namespace:e,address:n,closeModalOnConnect:i}){var x,A;const o=Nt.getConnectorById(t.connectorId),l=(A=(x=t.auth)==null?void 0:x.name)==null?void 0:A.toLowerCase(),h=t.connectorId===at.CONNECTOR_ID.AUTH,s=t.connectorId===at.CONNECTOR_ID.WALLET_CONNECT;if(!o)throw new Error(`No connector found for connection: ${t.connectorId}`);let w;if(h)if(l&&ux.isSocialProvider(l)){const{address:P}=await ux.connectSocial({social:l,closeModalOnConnect:i,onOpenFarcaster(){gi.open({view:"ConnectingFarcaster"})},onConnect(){Pt.replace("ProfileWallets")}});w=P}else{const{address:P}=await ux.connectEmail({closeModalOnConnect:i,onOpen(){gi.open({view:"EmailLogin"})},onConnect(){Pt.replace("ProfileWallets")}});w=P}else if(s){const{address:P}=await ux.connectWalletConnect({walletConnect:!0,connector:o,closeModalOnConnect:i,onOpen(D){const M=D?"AllWallets":"ConnectingWalletConnect";gi.state.open?Pt.push(M):gi.open({view:M})},onConnect(){Pt.replace("ProfileWallets")}});w=P}else{const P=await Ht.connectExternal({id:o.id,type:o.type,provider:o.provider,chain:e},e);P&&(w=P.address)}return h&&n&&await Ht.handleAuthAccountSwitch({address:n,namespace:e}),w},async switchConnection({connection:t,address:e,namespace:n,closeModalOnConnect:i,onChange:o}){var w;let l;const h=(w=ue.getAccountData(n))==null?void 0:w.caipAddress;if(h){const{address:x}=No.parseCaipAddress(h);l=x}const s=Bl.getConnectionStatus(t,n);switch(s){case"connected":case"active":{const x=await Ht.handleActiveConnection({connection:t,namespace:n,address:e});if(l&&x){const A=x.toLowerCase()!==l.toLowerCase();o==null||o({address:x,namespace:n,hasSwitchedAccount:A,hasSwitchedWallet:s==="active"})}break}case"disconnected":{const x=await Ht.handleDisconnectedConnection({connection:t,namespace:n,address:e,closeModalOnConnect:i});x&&(o==null||o({address:x,namespace:n,hasSwitchedAccount:!0,hasSwitchedWallet:!0}));break}default:throw new Error(`Invalid connection status: ${s}`)}}},Ht=Hl(ipe),dP={createBalance(t,e){const n={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:n.name,symbol:n.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:n.value,price:n.price,quantity:{decimals:n.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:n.decimals})},iconUrl:n.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return vE(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const n=e[1],i=parseInt(n,10);return isNaN(i)?"0x0":`0x${i.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(n=>this.isValidAsset(n)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}};let hP;async function E$(){if(!hP){const{createPublicClient:t,http:e,defineChain:n}=await Un(async()=>{const{createPublicClient:i,http:o,defineChain:l}=await import("./index-CK3LYl2A.js").then(h=>h._);return{createPublicClient:i,http:o,defineChain:l}},__vite__mapDeps([6,7,1,8,0,2,3,4,5]));hP={createPublicClient:t,http:e,defineChain:n}}return hP}const E8={getBlockchainApiRpcUrl(t,e){const n=new URL("https://rpc.walletconnect.org/v1/");return n.searchParams.set("chainId",t),n.searchParams.set("projectId",e),n.toString()},async getViemChain(t){const{defineChain:e}=await E$(),{chainId:n}=No.parseCaipNetworkId(t.caipNetworkId);return e({...t,id:Number(n)})},async createViemPublicClient(t){const{createPublicClient:e,http:n}=await E$(),i=ut.state.projectId,o=await E8.getViemChain(t);if(!o)throw new Error(`Chain ${t.caipNetworkId} not found in viem/chains`);return e({chain:o,transport:n(E8.getBlockchainApiRpcUrl(t.caipNetworkId,i))})}},tD={async getMyTokensWithBalance(t={forceUpdate:void 0,caipNetwork:ue.state.activeCaipNetwork,address:(e=>(e=ue.getAccountData())==null?void 0:e.address)()}){const{forceUpdate:n,caipNetwork:i,address:o}=t,l=Nt.getConnectorId("eip155")===at.CONNECTOR_ID.AUTH;if(!o)return[];const h=i?`${i.caipNetworkId}:${o}`:o,s=Jt.getBalanceCacheForCaipAddress(h);if(s)return s.balances;if(i&&i.chainNamespace===at.CHAIN.EVM&&l){const x=await this.getEIP155Balances(o,i);if(x)return this.filterLowQualityTokens(x)}const w=await Ci.getBalance(o,i==null?void 0:i.caipNetworkId,n);return this.filterLowQualityTokens(w.balances)},async getEIP155Balances(t,e){var n,i;try{const o=dP.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),l=await Ht.getCapabilities(t);if(!((i=(n=l==null?void 0:l[o])==null?void 0:n.assetDiscovery)!=null&&i.supported))return null;const h=await Ht.walletGetAssets({account:t,chainFilter:[o]});if(!dP.isWalletGetAssetsResponse(h))return null;const w=(h[o]||[]).map(x=>dP.createBalance(x,e.caipNetworkId));return Jt.updateBalanceCache({caipAddress:`${e.caipNetworkId}:${t}`,balance:{balances:w},timestamp:Date.now()}),w}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},async fetchERC20Balance({caipAddress:t,assetAddress:e,caipNetwork:n}){const i=await E8.createViemPublicClient(n),{address:o}=No.parseCaipAddress(t),[{result:l},{result:h},{result:s},{result:w}]=await i.multicall({contracts:[{address:e,functionName:"name",args:[],abi:G5},{address:e,functionName:"symbol",args:[],abi:G5},{address:e,functionName:"balanceOf",args:[o],abi:G5},{address:e,functionName:"decimals",args:[],abi:G5}]});return{name:l,symbol:h,decimals:w,balance:s&&w?vE(s,w):"0"}}},fP={adapters:{}},xG={state:fP,initialize(t){fP.adapters={...t}},get(t){return fP.adapters[t]}},AA={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0,sui:void 0,stacks:void 0,ton:void 0},Gc=Zr({providers:{...AA},providerIds:{...AA}}),Qr={state:Gc,subscribeKey(t,e){return oo(Gc,t,e)},subscribe(t){return so(Gc,()=>{t(Gc)})},subscribeProviders(t){return so(Gc.providers,()=>t(Gc.providers))},setProvider(t,e){t&&e&&(Gc.providers[t]=J1(e))},getProvider(t){if(t)return Gc.providers[t]},setProviderId(t,e){e&&(Gc.providerIds[t]=e)},getProviderId(t){if(t)return Gc.providerIds[t]},reset(){Gc.providers={...AA},Gc.providerIds={...AA}},resetChain(t){Gc.providers[t]=void 0,Gc.providerIds[t]=void 0}},rpe={async getTokenList(t){var i;const e=await Ci.fetchSwapTokens({chainId:t});return((i=e==null?void 0:e.tokens)==null?void 0:i.map(o=>({...o,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0})))||[]},async fetchGasPrice(){var e;const t=ue.state.activeCaipNetwork;if(!t)return null;try{switch(t.chainNamespace){case"solana":const n=(e=await(Ht==null?void 0:Ht.estimateGas({chainNamespace:"solana"})))==null?void 0:e.toString();return{standard:n,fast:n,instant:n};case"eip155":default:return await Ci.fetchGasPrice({chainId:t.caipNetworkId})}}catch{return null}},async fetchSwapAllowance({tokenAddress:t,userAddress:e,sourceTokenAmount:n,sourceTokenDecimals:i}){const o=await Ci.fetchSwapAllowance({tokenAddress:t,userAddress:e});if(o!=null&&o.allowance&&n&&i){const l=Ht.parseUnits(n,i)||0;return BigInt(o.allowance)>=l}return!1},async getMyTokensWithBalance(t){var n;const e=await tD.getMyTokensWithBalance({forceUpdate:t,caipNetwork:ue.state.activeCaipNetwork,address:(n=ue.getAccountData())==null?void 0:n.address});return ue.setAccountProp("tokenBalance",e,ue.state.activeChain),this.mapBalancesToSwapTokens(e)},mapBalancesToSwapTokens(t){return(t==null?void 0:t.map(e=>({...e,address:e!=null&&e.address?e.address:TA(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]},async handleSwapError(t){var e,n;try{const i=t==null?void 0:t.cause;if(!(i!=null&&i.json))return;const o=await i.json(),l=(n=(e=o==null?void 0:o.reasons)==null?void 0:e[0])==null?void 0:n.description;return l!=null&&l.includes("insufficient liquidity")?"Insufficient liquidity":void 0}catch{return}}},Cr=Zr({tokenBalances:[],loading:!1}),spe={state:Cr,subscribe(t){return so(Cr,()=>t(Cr))},subscribeKey(t,e){return oo(Cr,t,e)},setToken(t){t&&(Cr.token=J1(t))},setTokenAmount(t){Cr.sendTokenAmount=t},setReceiverAddress(t){Cr.receiverAddress=t},setReceiverProfileImageUrl(t){Cr.receiverProfileImageUrl=t},setReceiverProfileName(t){Cr.receiverProfileName=t},setNetworkBalanceInUsd(t){Cr.networkBalanceInUSD=t},setLoading(t){Cr.loading=t},getSdkEventProperties(t){var e,n;return{message:Ft.parseError(t),isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT,token:((e=Cr.token)==null?void 0:e.symbol)||"",amount:Cr.sendTokenAmount??0,network:((n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}},async sendToken(){var t;try{switch(Xi.setLoading(!0),(t=ue.state.activeCaipNetwork)==null?void 0:t.chainNamespace){case"eip155":await Xi.sendEvmToken();return;case"solana":await Xi.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}catch(e){throw nl.isUserRejectedRequestError(e)?new T1(e):e}finally{Xi.setLoading(!1)}},async sendEvmToken(){var n,i,o;const t=ue.state.activeChain;if(!t)throw new Error("SendController:sendEvmToken - activeChainNamespace is required");const e=Fs(t);if(!Xi.state.sendTokenAmount||!Xi.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!Xi.state.token)throw new Error("A token is required");if((n=Xi.state.token)!=null&&n.address){Sn.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Gr.ACCOUNT_TYPES.SMART_ACCOUNT,token:Xi.state.token.address,amount:Xi.state.sendTokenAmount,network:((i=ue.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}});const{hash:l}=await Xi.sendERC20Token({receiverAddress:Xi.state.receiverAddress,tokenAddress:Xi.state.token.address,sendTokenAmount:Xi.state.sendTokenAmount,decimals:Xi.state.token.quantity.decimals});l&&(Cr.hash=l)}else{Sn.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Gr.ACCOUNT_TYPES.SMART_ACCOUNT,token:Xi.state.token.symbol||"",amount:Xi.state.sendTokenAmount,network:((o=ue.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)||""}});const{hash:l}=await Xi.sendNativeToken({receiverAddress:Xi.state.receiverAddress,sendTokenAmount:Xi.state.sendTokenAmount,decimals:Xi.state.token.quantity.decimals});l&&(Cr.hash=l)}},async fetchTokenBalance(t){var h,s,w;Cr.loading=!0;const e=ue.state.activeChain,n=(h=ue.state.activeCaipNetwork)==null?void 0:h.caipNetworkId,i=(s=ue.state.activeCaipNetwork)==null?void 0:s.chainNamespace,o=((w=ue.getAccountData(e))==null?void 0:w.caipAddress)??ue.state.activeCaipAddress,l=o?Ft.getPlainAddress(o):void 0;if(Cr.lastRetry&&!Ft.isAllowedRetry(Cr.lastRetry,30*hi.ONE_SEC_MS))return Cr.loading=!1,[];try{if(l&&n&&i){const x=await tD.getMyTokensWithBalance();return Cr.tokenBalances=x,Cr.lastRetry=void 0,x}}catch(x){Cr.lastRetry=Date.now(),t==null||t(x),Ji.showError("Token Balance Unavailable")}finally{Cr.loading=!1}return[]},fetchNetworkBalance(){if(Cr.tokenBalances.length===0)return;const t=rpe.mapBalancesToSwapTokens(Cr.tokenBalances);if(!t)return;const e=t.find(n=>n.address===TA());e&&(Cr.networkBalanceInUSD=e?Q1.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){var h,s,w,x;Pt.pushTransactionStack({});const e=t.receiverAddress,n=(h=ue.getAccountData())==null?void 0:h.address,i=Ht.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),l=await Ht.sendTransaction({chainNamespace:at.CHAIN.EVM,to:e,address:n,data:"0x",value:i??BigInt(0)});return Sn.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Fs("eip155")===Gr.ACCOUNT_TYPES.SMART_ACCOUNT,token:((s=Xi.state.token)==null?void 0:s.symbol)||"",amount:t.sendTokenAmount,network:((w=ue.state.activeCaipNetwork)==null?void 0:w.caipNetworkId)||"",hash:l||""}}),(x=Ht._getClient())==null||x.updateBalance("eip155"),Xi.resetSend(),{hash:l}},async sendERC20Token(t){var i,o,l;Pt.pushTransactionStack({onSuccess(){Pt.replace("Account")}});const e=Ht.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),n=(i=ue.getAccountData())==null?void 0:i.address;if(n&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const h=Ft.getPlainAddress(t.tokenAddress);if(!h)throw new Error("SendController:sendERC20Token - tokenAddress is required");const s=await Ht.writeContract({fromAddress:n,tokenAddress:h,args:[t.receiverAddress,e??BigInt(0)],method:"transfer",abi:cse.getERC20Abi(h),chainNamespace:at.CHAIN.EVM});return Sn.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Fs("eip155")===Gr.ACCOUNT_TYPES.SMART_ACCOUNT,token:((o=Xi.state.token)==null?void 0:o.symbol)||"",amount:t.sendTokenAmount,network:((l=ue.state.activeCaipNetwork)==null?void 0:l.caipNetworkId)||"",hash:s||""}}),Xi.resetSend(),{hash:s}}return{hash:void 0}},async sendSolanaToken(){var n,i,o;if(!Xi.state.sendTokenAmount||!Xi.state.receiverAddress)throw new Error("An amount and receiver address are required");Pt.pushTransactionStack({onSuccess(){Pt.replace("Account")}});let t;Xi.state.token&&Xi.state.token.address!==hi.SOLANA_NATIVE_TOKEN_ADDRESS&&(Ft.isCaipAddress(Xi.state.token.address)?t=Ft.getPlainAddress(Xi.state.token.address):t=Xi.state.token.address);const e=await Ht.sendTransaction({chainNamespace:"solana",tokenMint:t,to:Xi.state.receiverAddress,value:Xi.state.sendTokenAmount});e&&(Cr.hash=e),(n=Ht._getClient())==null||n.updateBalance("solana"),Sn.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:!1,token:((i=Xi.state.token)==null?void 0:i.symbol)||"",amount:Xi.state.sendTokenAmount,network:((o=ue.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)||"",hash:e||""}}),Xi.resetSend()},resetSend(){Cr.token=void 0,Cr.sendTokenAmount=void 0,Cr.receiverAddress=void 0,Cr.receiverProfileImageUrl=void 0,Cr.receiverProfileName=void 0,Cr.loading=!1,Cr.tokenBalances=[]}},Xi=Hl(spe),pP={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,user:void 0,preferredAccountType:void 0},X5={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},Mn=Zr({chains:Ure(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{connectionControllerClient:void 0},isSwitchingNamespace:!1}),EG={state:Mn,subscribe(t){return so(Mn,()=>{t(Mn)})},subscribeKey(t,e){return oo(Mn,t,e)},subscribeAccountStateProp(t,e,n){var o;const i=n||Mn.activeChain;return i?oo(((o=Mn.chains.get(i))==null?void 0:o.accountState)||{},t,e):()=>{}},subscribeChainProp(t,e,n){let i;return so(Mn.chains,()=>{var l;const o=n||Mn.activeChain;if(o){const h=(l=Mn.chains.get(o))==null?void 0:l[t];i!==h&&(i=h,e(h))}})},initialize(t,e,n){const{chainId:i,namespace:o}=Jt.getActiveNetworkProps(),l=e==null?void 0:e.find(A=>A.id.toString()===(i==null?void 0:i.toString())),s=t.find(A=>(A==null?void 0:A.namespace)===o)||(t==null?void 0:t[0]),w=t.map(A=>A.namespace).filter(A=>A!==void 0),x=ut.state.enableEmbedded?new Set([...w]):new Set([...(e==null?void 0:e.map(A=>A.chainNamespace))??[]]);((t==null?void 0:t.length)===0||!s)&&(Mn.noAdapters=!0),Mn.noAdapters||(Mn.activeChain=s==null?void 0:s.namespace,Mn.activeCaipNetwork=l,ue.setChainNetworkData(s==null?void 0:s.namespace,{caipNetwork:l}),Mn.activeChain&&$l.set({activeChain:s==null?void 0:s.namespace})),x.forEach(A=>{const P=e==null?void 0:e.filter(z=>z.chainNamespace===A),D=Jt.getPreferredAccountTypes()||{},M={...ut.state.defaultAccountTypes,...D};ue.state.chains.set(A,{namespace:A,networkState:Zr({...X5,caipNetwork:P==null?void 0:P[0]}),accountState:Zr({...pP,preferredAccountType:M[A]}),caipNetworks:P??[],...n}),ue.setRequestedCaipNetworks(P??[],A)})},removeAdapter(t){var e,n;if(Mn.activeChain===t){const i=Array.from(Mn.chains.entries()).find(([o])=>o!==t);if(i){const o=(n=(e=i[1])==null?void 0:e.caipNetworks)==null?void 0:n[0];o&&ue.setActiveCaipNetwork(o)}}Mn.chains.delete(t)},addAdapter(t,{connectionControllerClient:e},n){if(!t.namespace)throw new Error("ChainController:addAdapter - adapter must have a namespace");Mn.chains.set(t.namespace,{namespace:t.namespace,networkState:{...X5,caipNetwork:n[0]},accountState:{...pP},caipNetworks:n,connectionControllerClient:e}),ue.setRequestedCaipNetworks((n==null?void 0:n.filter(i=>i.chainNamespace===t.namespace))??[],t.namespace)},addNetwork(t){var n;const e=Mn.chains.get(t.chainNamespace);if(e){const i=[...e.caipNetworks||[]];(n=e.caipNetworks)!=null&&n.find(o=>o.id===t.id)||i.push(t),Mn.chains.set(t.chainNamespace,{...e,caipNetworks:i}),ue.setRequestedCaipNetworks(i,t.chainNamespace),Nt.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){var i,o,l;const n=Mn.chains.get(t);if(n){const h=((i=Mn.activeCaipNetwork)==null?void 0:i.id)===e,s=[...((o=n.caipNetworks)==null?void 0:o.filter(w=>w.id!==e))||[]];h&&((l=n==null?void 0:n.caipNetworks)!=null&&l[0])&&ue.setActiveCaipNetwork(n.caipNetworks[0]),Mn.chains.set(t,{...n,caipNetworks:s}),ue.setRequestedCaipNetworks(s||[],t),s.length===0&&Nt.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const n=Mn.chains.get(t);n&&(n.networkState={...n.networkState||X5,...e},Mn.chains.set(t,n))},setChainAccountData(t,e,n=!0){if(!t)throw new Error("Chain is required to update chain account data");const i=Mn.chains.get(t);if(i){const o={...i.accountState||pP,...e};Mn.chains.set(t,{...i,accountState:o}),(Mn.chains.size===1||Mn.activeChain===t)&&e.caipAddress&&(Mn.activeCaipAddress=e.caipAddress)}},setChainNetworkData(t,e){if(!t)return;const n=Mn.chains.get(t);if(n){const i={...n.networkState||X5,...e};Mn.chains.set(t,{...n,networkState:i})}},setAccountProp(t,e,n,i=!0){ue.setChainAccountData(n,{[t]:e},i)},setActiveNamespace(t){var i,o;Mn.activeChain=t;const e=t?Mn.chains.get(t):void 0,n=(i=e==null?void 0:e.networkState)==null?void 0:i.caipNetwork;n!=null&&n.id&&t&&(Mn.activeCaipAddress=(o=e==null?void 0:e.accountState)==null?void 0:o.caipAddress,Mn.activeCaipNetwork=n,ue.setChainNetworkData(t,{caipNetwork:n}),Jt.setActiveCaipNetworkId(n==null?void 0:n.caipNetworkId),$l.set({activeChain:t,selectedNetworkId:n==null?void 0:n.caipNetworkId}))},setActiveCaipNetwork(t){var l,h;if(!t)return;const e=Mn.activeChain===t.chainNamespace;e||ue.setIsSwitchingNamespace(!0);const n=Mn.chains.get(t.chainNamespace);Mn.activeChain=t.chainNamespace,Mn.activeCaipNetwork=t,ue.setChainNetworkData(t.chainNamespace,{caipNetwork:t});let i=(l=n==null?void 0:n.accountState)==null?void 0:l.address;if(i)Mn.activeCaipAddress=`${t.chainNamespace}:${t.id}:${i}`;else if(e&&Mn.activeCaipAddress){const{address:s}=No.parseCaipAddress(Mn.activeCaipAddress);i=s,Mn.activeCaipAddress=`${t.caipNetworkId}:${i}`}else Mn.activeCaipAddress=void 0;ue.setChainAccountData(t.chainNamespace,{address:i,caipAddress:Mn.activeCaipAddress}),Xi.resetSend(),$l.set({activeChain:Mn.activeChain,selectedNetworkId:(h=Mn.activeCaipNetwork)==null?void 0:h.caipNetworkId}),Jt.setActiveCaipNetworkId(t.caipNetworkId),!ue.checkIfSupportedNetwork(t.chainNamespace)&&ut.state.enableNetworkSwitch&&!ut.state.allowUnsupportedChain&&!Ht.state.wcBasic&&ue.showUnsupportedChainUI()},addCaipNetwork(t){var n;if(!t)return;const e=Mn.chains.get(t.chainNamespace);e&&((n=e==null?void 0:e.caipNetworks)==null||n.push(t))},async switchActiveNamespace(t){var o;if(!t)return;const e=t!==ue.state.activeChain,n=(o=ue.getNetworkData(t))==null?void 0:o.caipNetwork,i=ue.getCaipNetworkByNamespace(t,n==null?void 0:n.id);e&&i&&await ue.switchActiveNetwork(i)},async switchActiveNetwork(t,{throwOnFailure:e=!1}={}){var h;const n=ue.state.activeChain;if(!n)throw new Error("ChainController:switchActiveNetwork - namespace is required");const i=Qr.getProviderId(Mn.activeChain)==="AUTH",o=(h=ue.getAccountData(n))==null?void 0:h.address,l=at.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(t.chainNamespace);try{if(o&&t.chainNamespace===n||i&&l){const s=xG.get(t.chainNamespace);if(!s)throw new Error("Adapter not found");await s.switchNetwork({caipNetwork:t})}ue.setActiveCaipNetwork(t)}catch(s){if(e)throw s}Sn.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})},getConnectionControllerClient(t){const e=t||Mn.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const n=Mn.chains.get(e);if(!(n!=null&&n.connectionControllerClient))throw new Error("ConnectionController client not set");return n.connectionControllerClient},getNetworkProp(t,e){var i;const n=(i=Mn.chains.get(e))==null?void 0:i.networkState;if(n)return n[t]},getRequestedCaipNetworks(t){const e=Mn.chains.get(t),{approvedCaipNetworkIds:n=[],requestedCaipNetworks:i=[]}=(e==null?void 0:e.networkState)||{};return Ft.sortRequestedNetworks(n,i).filter(h=>h==null?void 0:h.id)},getAllRequestedCaipNetworks(){const t=[];return Mn.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllRequestedCaipNetworks - chainAdapter must have a namespace");const n=ue.getRequestedCaipNetworks(e.namespace);t.push(...n)}),t},setRequestedCaipNetworks(t,e){ue.setAdapterNetworkState(e,{requestedCaipNetworks:t});const i=ue.getAllRequestedCaipNetworks().map(l=>l.chainNamespace),o=Array.from(new Set(i));Nt.filterByNamespaces(o)},getAllApprovedCaipNetworkIds(){const t=[];return Mn.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllApprovedCaipNetworkIds - chainAdapter must have a namespace");const n=ue.getApprovedCaipNetworkIds(e.namespace);t.push(...n)}),t},getActiveCaipNetwork(t){var e,n;return t?(n=(e=Mn.chains.get(t))==null?void 0:e.networkState)==null?void 0:n.caipNetwork:Mn.activeCaipNetwork},getActiveCaipAddress(){return Mn.activeCaipAddress},getApprovedCaipNetworkIds(t){var i;const e=Mn.chains.get(t);return((i=e==null?void 0:e.networkState)==null?void 0:i.approvedCaipNetworkIds)||[]},setApprovedCaipNetworksData(t,e){ue.setAdapterNetworkState(t,e)},checkIfSupportedNetwork(t,e){var o;const n=e||((o=Mn.activeCaipNetwork)==null?void 0:o.caipNetworkId),i=ue.getRequestedCaipNetworks(t);return i.length?i==null?void 0:i.some(l=>l.caipNetworkId===n):!0},checkIfSupportedChainId(t){if(!Mn.activeChain)return!0;const e=ue.getRequestedCaipNetworks(Mn.activeChain);return e==null?void 0:e.some(n=>n.id===t)},checkIfSmartAccountEnabled(){var i,o;const t=i2.caipNetworkIdToNumber((i=Mn.activeCaipNetwork)==null?void 0:i.caipNetworkId);if(!Mn.activeChain||!t)return!1;const n=((o=Ro.get(Kn.SMART_ACCOUNT_ENABLED_NETWORKS))==null?void 0:o.split(","))||[];return!!(n!=null&&n.includes(t.toString()))},showUnsupportedChainUI(){gi.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=Mn.activeCaipNetwork;return!!(t!=null&&t.chainNamespace&&hi.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){ue.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0})},resetAccount(t){var o,l;const e=t;if(!e)throw new Error("Chain is required to set account prop");const n=(l=(o=ue.state.chains.get(e))==null?void 0:o.accountState)==null?void 0:l.preferredAccountType,i=ut.state.defaultAccountTypes[e];Mn.activeCaipAddress=void 0,ue.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:i||n,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,user:void 0,status:"disconnected"}),Nt.removeConnectorId(e)},setIsSwitchingNamespace(t){Mn.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){var n,i;const t=[];let e;if(Mn.chains.forEach(o=>{at.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(l=>l===o.namespace)&&o.namespace&&t.push(o.namespace)}),t.length>0){const o=t[0];return e=o?(i=(n=Mn.chains.get(o))==null?void 0:n.caipNetworks)==null?void 0:i[0]:void 0,e}},getAccountData(t){var n;const e=t||Mn.activeChain;if(e)return(n=ue.state.chains.get(e))==null?void 0:n.accountState},getNetworkData(t){var n;const e=t||Mn.activeChain;if(e)return(n=ue.state.chains.get(e))==null?void 0:n.networkState},getCaipNetworkByNamespace(t,e){var o,l,h;if(!t)return;const n=ue.state.chains.get(t),i=(o=n==null?void 0:n.caipNetworks)==null?void 0:o.find(s=>s.id.toString()===(e==null?void 0:e.toString()));return i||((l=n==null?void 0:n.networkState)==null?void 0:l.caipNetwork)||((h=n==null?void 0:n.caipNetworks)==null?void 0:h[0])},getRequestedCaipNetworkIds(){const t=Nt.state.filterByNamespace;return(t?[Mn.chains.get(t)]:Array.from(Mn.chains.values())).flatMap(n=>(n==null?void 0:n.caipNetworks)||[]).map(n=>n.caipNetworkId)},getCaipNetworks(t){return t?ue.getRequestedCaipNetworks(t):ue.getAllRequestedCaipNetworks()},getCaipNetworkById(t,e){return EG.getCaipNetworks(e).find(n=>n.id.toString()===t.toString()||n.caipNetworkId.toString()===t.toString())},setLastConnectedSIWECaipNetwork(t){Mn.lastConnectedSIWECaipNetwork=t},getLastConnectedSIWECaipNetwork(){return Mn.lastConnectedSIWECaipNetwork},async fetchTokenBalance(t){var h,s;const e=ue.getAccountData();if(!e)return[];const n=(h=ue.state.activeCaipNetwork)==null?void 0:h.caipNetworkId,i=(s=ue.state.activeCaipNetwork)==null?void 0:s.chainNamespace,o=ue.state.activeCaipAddress,l=o?Ft.getPlainAddress(o):void 0;if(ue.setAccountProp("balanceLoading",!0,i),e.lastRetry&&!Ft.isAllowedRetry(e.lastRetry,30*hi.ONE_SEC_MS))return ue.setAccountProp("balanceLoading",!1,i),[];try{if(l&&n&&i){const w=await tD.getMyTokensWithBalance();return ue.setAccountProp("tokenBalance",w,i),ue.setAccountProp("lastRetry",void 0,i),ue.setAccountProp("balanceLoading",!1,i),w}}catch(w){ue.setAccountProp("lastRetry",Date.now(),i),t==null||t(w),Ji.showError("Token Balance Unavailable")}finally{ue.setAccountProp("balanceLoading",!1,i)}return[]},isCaipNetworkDisabled(t){var w;const e=t.chainNamespace,n=!!((w=ue.getAccountData(e))!=null&&w.caipAddress),i=ue.getAllApprovedCaipNetworkIds(),o=ue.getNetworkProp("supportsAllNetworks",e)!==!1,l=Nt.getConnectorId(e),h=Nt.getAuthConnector(),s=l===at.CONNECTOR_ID.AUTH&&h;return!n||o||s?!1:!(i!=null&&i.includes(t.caipNetworkId))}},ue=Hl(EG),CG={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){var D,M;const n=ue.state.activeCaipNetwork,i=ue.state.activeChain,o=Pt.state.data;if(t.id===(n==null?void 0:n.id))return;const h=!!((D=ue.getAccountData(i))!=null&&D.address),s=!!((M=ue.getAccountData(t.chainNamespace))!=null&&M.address),w=t.chainNamespace!==i,A=Nt.getConnectorId(i)===at.CONNECTOR_ID.AUTH,P=at.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(z=>z===t.chainNamespace);e||A&&P?Pt.push("SwitchNetwork",{...o,network:t}):h&&w&&!s?Pt.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):Pt.push("SwitchNetwork",{...o,network:t})}},qc=Zr({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),ope={state:qc,subscribe(t){return so(qc,()=>t(qc))},subscribeKey(t,e){return oo(qc,t,e)},async open(t){var h,s;const e=t==null?void 0:t.namespace,n=ue.state.activeChain,i=e&&e!==n,o=(h=ue.getAccountData(t==null?void 0:t.namespace))==null?void 0:h.caipAddress,l=ue.state.noAdapters;if(Ht.state.wcBasic?fn.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1}):await fn.prefetch(),Nt.setFilterByNamespace(t==null?void 0:t.namespace),gi.setLoading(!0,e),e&&i){const w=((s=ue.getNetworkData(e))==null?void 0:s.caipNetwork)||ue.getRequestedCaipNetworks(e)[0];w&&(l?(await ue.switchActiveNetwork(w),Pt.push("ConnectingWalletConnectBasic")):CG.onSwitchNetwork({network:w,ignoreSwitchConfirmation:!0}))}else ut.state.manualWCControl||l&&!o?Ft.isMobile()?Pt.reset("AllWallets"):Pt.reset("ConnectingWalletConnectBasic"):t!=null&&t.view?Pt.reset(t.view,t.data):o?Pt.reset("Account"):Pt.reset("Connect");qc.open=!0,$l.set({open:!0}),Sn.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!o}})},close(){const t=ut.state.enableEmbedded,e=!!ue.state.activeCaipAddress;qc.open&&Sn.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),qc.open=!1,Pt.reset("Connect"),gi.clearLoading(),t?e?Pt.replace("Account"):Pt.push("Connect"):$l.set({open:!1}),Ht.resetUri()},setLoading(t,e){e&&qc.loadingNamespaceMap.set(e,t),qc.loading=t,$l.set({loading:t})},clearLoading(){qc.loadingNamespaceMap.clear(),qc.loading=!1,$l.set({loading:!1})},shake(){qc.shake||(qc.shake=!0,setTimeout(()=>{qc.shake=!1},500))}},gi=Hl(ope),$x={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},C8={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},ape={providers:iW,selectedProvider:null,error:null,purchaseCurrency:$x,paymentCurrency:C8,purchaseCurrencies:[$x],paymentCurrencies:[],quotesLoading:!1},Ir=Zr(ape),cpe={state:Ir,subscribe(t){return so(Ir,()=>t(Ir))},subscribeKey(t,e){return oo(Ir,t,e)},setSelectedProvider(t){var e,n;if(t&&t.name==="meld"){const i=ue.state.activeChain,o=i===at.CHAIN.SOLANA?"SOL":"USDC",l=i?((n=(e=ue.state.chains.get(i))==null?void 0:e.accountState)==null?void 0:n.address)??"":"",h=new URL(t.url);h.searchParams.append("publicKey",dse),h.searchParams.append("destinationCurrencyCode",o),h.searchParams.append("walletAddress",l),h.searchParams.append("externalCustomerId",ut.state.projectId),Ir.selectedProvider={...t,url:h.toString()}}else Ir.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,n=iW.filter(i=>e.includes(i.name));Ir.providers=n}else Ir.providers=[]},setPurchaseCurrency(t){Ir.purchaseCurrency=t},setPaymentCurrency(t){Ir.paymentCurrency=t},setPurchaseAmount(t){T8.state.purchaseAmount=t},setPaymentAmount(t){T8.state.paymentAmount=t},async getAvailableCurrencies(){const t=await Ci.getOnrampOptions();Ir.purchaseCurrencies=t.purchaseCurrencies,Ir.paymentCurrencies=t.paymentCurrencies,Ir.paymentCurrency=t.paymentCurrencies[0]||C8,Ir.purchaseCurrency=t.purchaseCurrencies[0]||$x,await fn.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await fn.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){var t,e;Ir.quotesLoading=!0;try{const n=await Ci.getOnrampQuote({purchaseCurrency:Ir.purchaseCurrency,paymentCurrency:Ir.paymentCurrency,amount:((t=Ir.paymentAmount)==null?void 0:t.toString())||"0",network:(e=Ir.purchaseCurrency)==null?void 0:e.symbol});return Ir.quotesLoading=!1,Ir.purchaseAmount=Number(n==null?void 0:n.purchaseAmount.amount),n}catch(n){return Ir.error=n.message,Ir.quotesLoading=!1,null}finally{Ir.quotesLoading=!1}},resetState(){Ir.selectedProvider=null,Ir.error=null,Ir.purchaseCurrency=$x,Ir.paymentCurrency=C8,Ir.purchaseCurrencies=[$x],Ir.paymentCurrencies=[],Ir.paymentAmount=void 0,Ir.purchaseAmount=void 0,Ir.quotesLoading=!1}},T8=Hl(cpe);var nD={exports:{}},j1=typeof Reflect=="object"?Reflect:null,C$=j1&&typeof j1.apply=="function"?j1.apply:function(e,n,i){return Function.prototype.apply.call(e,n,i)},BT;j1&&typeof j1.ownKeys=="function"?BT=j1.ownKeys:Object.getOwnPropertySymbols?BT=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:BT=function(e){return Object.getOwnPropertyNames(e)};function lpe(t){console&&console.warn&&console.warn(t)}var TG=Number.isNaN||function(e){return e!==e};function es(){es.init.call(this)}nD.exports=es;nD.exports.once=fpe;es.EventEmitter=es;es.prototype._events=void 0;es.prototype._eventsCount=0;es.prototype._maxListeners=void 0;var T$=10;function HS(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(es,"defaultMaxListeners",{enumerable:!0,get:function(){return T$},set:function(t){if(typeof t!="number"||t<0||TG(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");T$=t}});es.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};es.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||TG(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function AG(t){return t._maxListeners===void 0?es.defaultMaxListeners:t._maxListeners}es.prototype.getMaxListeners=function(){return AG(this)};es.prototype.emit=function(e){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var o=e==="error",l=this._events;if(l!==void 0)o=o&&l.error===void 0;else if(!o)return!1;if(o){var h;if(n.length>0&&(h=n[0]),h instanceof Error)throw h;var s=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw s.context=h,s}var w=l[e];if(w===void 0)return!1;if(typeof w=="function")C$(w,this,n);else for(var x=w.length,A=OG(w,x),i=0;i<x;++i)C$(A[i],this,n);return!0};function SG(t,e,n,i){var o,l,h;if(HS(n),l=t._events,l===void 0?(l=t._events=Object.create(null),t._eventsCount=0):(l.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),l=t._events),h=l[e]),h===void 0)h=l[e]=n,++t._eventsCount;else if(typeof h=="function"?h=l[e]=i?[n,h]:[h,n]:i?h.unshift(n):h.push(n),o=AG(t),o>0&&h.length>o&&!h.warned){h.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=h.length,lpe(s)}return t}es.prototype.addListener=function(e,n){return SG(this,e,n,!1)};es.prototype.on=es.prototype.addListener;es.prototype.prependListener=function(e,n){return SG(this,e,n,!0)};function upe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function IG(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=upe.bind(i);return o.listener=n,i.wrapFn=o,o}es.prototype.once=function(e,n){return HS(n),this.on(e,IG(this,e,n)),this};es.prototype.prependOnceListener=function(e,n){return HS(n),this.prependListener(e,IG(this,e,n)),this};es.prototype.removeListener=function(e,n){var i,o,l,h,s;if(HS(n),o=this._events,o===void 0)return this;if(i=o[e],i===void 0)return this;if(i===n||i.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,i.listener||n));else if(typeof i!="function"){for(l=-1,h=i.length-1;h>=0;h--)if(i[h]===n||i[h].listener===n){s=i[h].listener,l=h;break}if(l<0)return this;l===0?i.shift():dpe(i,l),i.length===1&&(o[e]=i[0]),o.removeListener!==void 0&&this.emit("removeListener",e,s||n)}return this};es.prototype.off=es.prototype.removeListener;es.prototype.removeAllListeners=function(e){var n,i,o;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var l=Object.keys(i),h;for(o=0;o<l.length;++o)h=l[o],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=i[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(o=n.length-1;o>=0;o--)this.removeListener(e,n[o]);return this};function PG(t,e,n){var i=t._events;if(i===void 0)return[];var o=i[e];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?hpe(o):OG(o,o.length)}es.prototype.listeners=function(e){return PG(this,e,!0)};es.prototype.rawListeners=function(e){return PG(this,e,!1)};es.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):RG.call(t,e)};es.prototype.listenerCount=RG;function RG(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}es.prototype.eventNames=function(){return this._eventsCount>0?BT(this._events):[]};function OG(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function dpe(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function hpe(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function fpe(t,e){return new Promise(function(n,i){function o(h){t.removeListener(e,l),i(h)}function l(){typeof t.removeListener=="function"&&t.removeListener("error",o),n([].slice.call(arguments))}kG(t,e,l,{once:!0}),e!=="error"&&ppe(t,o,{once:!0})})}function ppe(t,e,n){typeof t.on=="function"&&kG(t,"error",e,n)}function kG(t,e,n,i){if(typeof t.on=="function")i.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(l){i.once&&t.removeEventListener(e,o),n(l)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Ru=nD.exports;const iD=Zm(Ru);var vn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var A8=function(t,e){return A8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},A8(t,e)};function mpe(t,e){A8(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var S8=function(){return S8=Object.assign||function(e){for(var n,i=1,o=arguments.length;i<o;i++){n=arguments[i];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},S8.apply(this,arguments)};function gpe(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]]);return n}function ype(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l}function _pe(t,e){return function(n,i){e(n,i,t)}}function wpe(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function bpe(t,e,n,i){function o(l){return l instanceof n?l:new n(function(h){h(l)})}return new(n||(n=Promise))(function(l,h){function s(A){try{x(i.next(A))}catch(P){h(P)}}function w(A){try{x(i.throw(A))}catch(P){h(P)}}function x(A){A.done?l(A.value):o(A.value).then(s,w)}x((i=i.apply(t,e||[])).next())})}function vpe(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,o,l,h;return h={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function s(x){return function(A){return w([x,A])}}function w(x){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,o&&(l=x[0]&2?o.return:x[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,x[1])).done)return l;switch(o=0,l&&(x=[x[0]&2,l.value]),x[0]){case 0:case 1:l=x;break;case 4:return n.label++,{value:x[1],done:!1};case 5:n.label++,o=x[1],x=[0];continue;case 7:x=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(x[0]===6||x[0]===2)){n=0;continue}if(x[0]===3&&(!l||x[1]>l[0]&&x[1]<l[3])){n.label=x[1];break}if(x[0]===6&&n.label<l[1]){n.label=l[1],l=x;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(x);break}l[2]&&n.ops.pop(),n.trys.pop();continue}x=e.call(t,n)}catch(A){x=[6,A],o=0}finally{i=l=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function xpe(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}function Epe(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function I8(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function DG(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),o,l=[],h;try{for(;(e===void 0||e-- >0)&&!(o=i.next()).done;)l.push(o.value)}catch(s){h={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(h)throw h.error}}return l}function Cpe(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(DG(arguments[e]));return t}function Tpe(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),o=0,e=0;e<n;e++)for(var l=arguments[e],h=0,s=l.length;h<s;h++,o++)i[o]=l[h];return i}function $2(t){return this instanceof $2?(this.v=t,this):new $2(t)}function Ape(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),o,l=[];return o={},h("next"),h("throw"),h("return"),o[Symbol.asyncIterator]=function(){return this},o;function h(D){i[D]&&(o[D]=function(M){return new Promise(function(z,U){l.push([D,M,z,U])>1||s(D,M)})})}function s(D,M){try{w(i[D](M))}catch(z){P(l[0][3],z)}}function w(D){D.value instanceof $2?Promise.resolve(D.value.v).then(x,A):P(l[0][2],D)}function x(D){s("next",D)}function A(D){s("throw",D)}function P(D,M){D(M),l.shift(),l.length&&s(l[0][0],l[0][1])}}function Spe(t){var e,n;return e={},i("next"),i("throw",function(o){throw o}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(o,l){e[o]=t[o]?function(h){return(n=!n)?{value:$2(t[o](h)),done:o==="return"}:l?l(h):h}:l}}function Ipe(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof I8=="function"?I8(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(l){n[l]=t[l]&&function(h){return new Promise(function(s,w){h=t[l](h),o(s,w,h.done,h.value)})}}function o(l,h,s,w){Promise.resolve(w).then(function(x){l({value:x,done:s})},h)}}function Ppe(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Rpe(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function Ope(t){return t&&t.__esModule?t:{default:t}}function kpe(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Dpe(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const Npe=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return S8},__asyncDelegator:Spe,__asyncGenerator:Ape,__asyncValues:Ipe,__await:$2,__awaiter:bpe,__classPrivateFieldGet:kpe,__classPrivateFieldSet:Dpe,__createBinding:xpe,__decorate:ype,__exportStar:Epe,__extends:mpe,__generator:vpe,__importDefault:Ope,__importStar:Rpe,__makeTemplateObject:Ppe,__metadata:wpe,__param:_pe,__read:DG,__rest:gpe,__spread:Cpe,__spreadArrays:Tpe,__values:I8},Symbol.toStringTag,{value:"Module"})),PE=Bne(Npe);var mP={},dx={},A$;function Mpe(){if(A$)return dx;A$=1,Object.defineProperty(dx,"__esModule",{value:!0}),dx.delay=void 0;function t(e){return new Promise(n=>{setTimeout(()=>{n(!0)},e)})}return dx.delay=t,dx}var c0={},gP={},l0={},S$;function Lpe(){return S$||(S$=1,Object.defineProperty(l0,"__esModule",{value:!0}),l0.ONE_THOUSAND=l0.ONE_HUNDRED=void 0,l0.ONE_HUNDRED=100,l0.ONE_THOUSAND=1e3),l0}var yP={},I$;function Bpe(){return I$||(I$=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(yP)),yP}var P$;function NG(){return P$||(P$=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=PE;e.__exportStar(Lpe(),t),e.__exportStar(Bpe(),t)}(gP)),gP}var R$;function Fpe(){if(R$)return c0;R$=1,Object.defineProperty(c0,"__esModule",{value:!0}),c0.fromMiliseconds=c0.toMiliseconds=void 0;const t=NG();function e(i){return i*t.ONE_THOUSAND}c0.toMiliseconds=e;function n(i){return Math.floor(i/t.ONE_THOUSAND)}return c0.fromMiliseconds=n,c0}var O$;function $pe(){return O$||(O$=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=PE;e.__exportStar(Mpe(),t),e.__exportStar(Fpe(),t)}(mP)),mP}var f1={},k$;function zpe(){if(k$)return f1;k$=1,Object.defineProperty(f1,"__esModule",{value:!0}),f1.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const i=this.get(n);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const o=Date.now()-i.started;this.timestamps.set(n,{started:i.started,elapsed:o})}get(n){const i=this.timestamps.get(n);if(typeof i>"u")throw new Error(`No timestamp found for label: ${n}`);return i}elapsed(n){const i=this.get(n);return i.elapsed||Date.now()-i.started}}return f1.Watch=t,f1.default=t,f1}var _P={},hx={},D$;function Upe(){if(D$)return hx;D$=1,Object.defineProperty(hx,"__esModule",{value:!0}),hx.IWatch=void 0;class t{}return hx.IWatch=t,hx}var N$;function jpe(){return N$||(N$=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),PE.__exportStar(Upe(),t)}(_P)),_P}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=PE;e.__exportStar($pe(),t),e.__exportStar(zpe(),t),e.__exportStar(jpe(),t),e.__exportStar(NG(),t)})(vn);class Sy{}let Vpe=class extends Sy{constructor(e){super()}};const M$=vn.FIVE_SECONDS,Iy={pulse:"heartbeat_pulse"};let Wpe=class MG extends Vpe{constructor(e){super(e),this.events=new Ru.EventEmitter,this.interval=M$,this.interval=(e==null?void 0:e.interval)||M$}static async init(e){const n=new MG(e);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),vn.toMiliseconds(this.interval))}pulse(){this.events.emit(Iy.pulse)}};const Hpe=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Gpe=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,qpe=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Zpe(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Kpe(t);return}return e}function Kpe(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function J5(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!qpe.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Hpe.test(t)||Gpe.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Zpe)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function Ype(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ta(t,...e){try{return Ype(t(...e))}catch(n){return Promise.reject(n)}}function Xpe(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Jpe(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function FT(t){if(Xpe(t))return String(t);if(Jpe(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return FT(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const P8="base64:";function Qpe(t){return typeof t=="string"?t:P8+nme(t)}function eme(t){return typeof t!="string"||!t.startsWith(P8)?t:tme(t.slice(P8.length))}function tme(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function nme(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Yc(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function ime(...t){return Yc(t.join(":"))}function Q5(t){return t=Yc(t),t?t+":":""}function rme(t,e){if(e===void 0)return!0;let n=0,i=t.indexOf(":");for(;i>-1;)n++,i=t.indexOf(":",i+1);return n<=e}function sme(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const ome="memory",ame=()=>{const t=new Map;return{name:ome,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,n){t.set(e,n)},setItemRaw(e,n){t.set(e,n)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function cme(t={}){const e={mounts:{"":t.driver||ame()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=x=>{for(const A of e.mountpoints)if(x.startsWith(A))return{base:A,relativeKey:x.slice(A.length),driver:e.mounts[A]};return{base:"",relativeKey:x,driver:e.mounts[""]}},i=(x,A)=>e.mountpoints.filter(P=>P.startsWith(x)||A&&x.startsWith(P)).map(P=>({relativeBase:x.length>P.length?x.slice(P.length):void 0,mountpoint:P,driver:e.mounts[P]})),o=(x,A)=>{if(e.watching){A=Yc(A);for(const P of e.watchListeners)P(x,A)}},l=async()=>{if(!e.watching){e.watching=!0;for(const x in e.mounts)e.unwatch[x]=await L$(e.mounts[x],o,x)}},h=async()=>{if(e.watching){for(const x in e.unwatch)await e.unwatch[x]();e.unwatch={},e.watching=!1}},s=(x,A,P)=>{const D=new Map,M=z=>{let U=D.get(z.base);return U||(U={driver:z.driver,base:z.base,items:[]},D.set(z.base,U)),U};for(const z of x){const U=typeof z=="string",G=Yc(U?z:z.key),ne=U?void 0:z.value,oe=U||!z.options?A:{...A,...z.options},Q=n(G);M(Q).items.push({key:G,value:ne,relativeKey:Q.relativeKey,options:oe})}return Promise.all([...D.values()].map(z=>P(z))).then(z=>z.flat())},w={hasItem(x,A={}){x=Yc(x);const{relativeKey:P,driver:D}=n(x);return ta(D.hasItem,P,A)},getItem(x,A={}){x=Yc(x);const{relativeKey:P,driver:D}=n(x);return ta(D.getItem,P,A).then(M=>J5(M))},getItems(x,A={}){return s(x,A,P=>P.driver.getItems?ta(P.driver.getItems,P.items.map(D=>({key:D.relativeKey,options:D.options})),A).then(D=>D.map(M=>({key:ime(P.base,M.key),value:J5(M.value)}))):Promise.all(P.items.map(D=>ta(P.driver.getItem,D.relativeKey,D.options).then(M=>({key:D.key,value:J5(M)})))))},getItemRaw(x,A={}){x=Yc(x);const{relativeKey:P,driver:D}=n(x);return D.getItemRaw?ta(D.getItemRaw,P,A):ta(D.getItem,P,A).then(M=>eme(M))},async setItem(x,A,P={}){if(A===void 0)return w.removeItem(x);x=Yc(x);const{relativeKey:D,driver:M}=n(x);M.setItem&&(await ta(M.setItem,D,FT(A),P),M.watch||o("update",x))},async setItems(x,A){await s(x,A,async P=>{if(P.driver.setItems)return ta(P.driver.setItems,P.items.map(D=>({key:D.relativeKey,value:FT(D.value),options:D.options})),A);P.driver.setItem&&await Promise.all(P.items.map(D=>ta(P.driver.setItem,D.relativeKey,FT(D.value),D.options)))})},async setItemRaw(x,A,P={}){if(A===void 0)return w.removeItem(x,P);x=Yc(x);const{relativeKey:D,driver:M}=n(x);if(M.setItemRaw)await ta(M.setItemRaw,D,A,P);else if(M.setItem)await ta(M.setItem,D,Qpe(A),P);else return;M.watch||o("update",x)},async removeItem(x,A={}){typeof A=="boolean"&&(A={removeMeta:A}),x=Yc(x);const{relativeKey:P,driver:D}=n(x);D.removeItem&&(await ta(D.removeItem,P,A),(A.removeMeta||A.removeMata)&&await ta(D.removeItem,P+"$",A),D.watch||o("remove",x))},async getMeta(x,A={}){typeof A=="boolean"&&(A={nativeOnly:A}),x=Yc(x);const{relativeKey:P,driver:D}=n(x),M=Object.create(null);if(D.getMeta&&Object.assign(M,await ta(D.getMeta,P,A)),!A.nativeOnly){const z=await ta(D.getItem,P+"$",A).then(U=>J5(U));z&&typeof z=="object"&&(typeof z.atime=="string"&&(z.atime=new Date(z.atime)),typeof z.mtime=="string"&&(z.mtime=new Date(z.mtime)),Object.assign(M,z))}return M},setMeta(x,A,P={}){return this.setItem(x+"$",A,P)},removeMeta(x,A={}){return this.removeItem(x+"$",A)},async getKeys(x,A={}){var G;x=Q5(x);const P=i(x,!0);let D=[];const M=[];let z=!0;for(const ne of P){(G=ne.driver.flags)!=null&&G.maxDepth||(z=!1);const oe=await ta(ne.driver.getKeys,ne.relativeBase,A);for(const Q of oe){const de=ne.mountpoint+Yc(Q);D.some(he=>de.startsWith(he))||M.push(de)}D=[ne.mountpoint,...D.filter(Q=>!Q.startsWith(ne.mountpoint))]}const U=A.maxDepth!==void 0&&!z;return M.filter(ne=>(!U||rme(ne,A.maxDepth))&&sme(ne,x))},async clear(x,A={}){x=Q5(x),await Promise.all(i(x,!1).map(async P=>{if(P.driver.clear)return ta(P.driver.clear,P.relativeBase,A);if(P.driver.removeItem){const D=await P.driver.getKeys(P.relativeBase||"",A);return Promise.all(D.map(M=>P.driver.removeItem(M,A)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(x=>B$(x)))},async watch(x){return await l(),e.watchListeners.push(x),async()=>{e.watchListeners=e.watchListeners.filter(A=>A!==x),e.watchListeners.length===0&&await h()}},async unwatch(){e.watchListeners=[],await h()},mount(x,A){if(x=Q5(x),x&&e.mounts[x])throw new Error(`already mounted at ${x}`);return x&&(e.mountpoints.push(x),e.mountpoints.sort((P,D)=>D.length-P.length)),e.mounts[x]=A,e.watching&&Promise.resolve(L$(A,o,x)).then(P=>{e.unwatch[x]=P}).catch(console.error),w},async unmount(x,A=!0){var P,D;x=Q5(x),!(!x||!e.mounts[x])&&(e.watching&&x in e.unwatch&&((D=(P=e.unwatch)[x])==null||D.call(P),delete e.unwatch[x]),A&&await B$(e.mounts[x]),e.mountpoints=e.mountpoints.filter(M=>M!==x),delete e.mounts[x])},getMount(x=""){x=Yc(x)+":";const A=n(x);return{driver:A.driver,base:A.base}},getMounts(x="",A={}){return x=Yc(x),i(x,A.parents).map(D=>({driver:D.driver,base:D.mountpoint}))},keys:(x,A={})=>w.getKeys(x,A),get:(x,A={})=>w.getItem(x,A),set:(x,A,P={})=>w.setItem(x,A,P),has:(x,A={})=>w.hasItem(x,A),del:(x,A={})=>w.removeItem(x,A),remove:(x,A={})=>w.removeItem(x,A)};return w}function L$(t,e,n){return t.watch?t.watch((i,o)=>e(i,n+o)):()=>{}}async function B$(t){typeof t.dispose=="function"&&await ta(t.dispose)}function Py(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function LG(t,e){let n;const i=()=>{if(n)return n;const o=indexedDB.open(t);return o.onupgradeneeded=()=>o.result.createObjectStore(e),n=Py(o),n.then(l=>{l.onclose=()=>n=void 0},()=>{}),n};return(o,l)=>i().then(h=>l(h.transaction(e,o).objectStore(e)))}let wP;function RE(){return wP||(wP=LG("keyval-store","keyval")),wP}function F$(t,e=RE()){return e("readonly",n=>Py(n.get(t)))}function lme(t,e,n=RE()){return n("readwrite",i=>(i.put(e,t),Py(i.transaction)))}function ume(t,e=RE()){return e("readwrite",n=>(n.delete(t),Py(n.transaction)))}function dme(t=RE()){return t("readwrite",e=>(e.clear(),Py(e.transaction)))}function hme(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Py(t.transaction)}function fme(t=RE()){return t("readonly",e=>{if(e.getAllKeys)return Py(e.getAllKeys());const n=[];return hme(e,i=>n.push(i.key)).then(()=>n)})}const pme=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),mme=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(i,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function J0(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return mme(t)}catch{return t}}function Q0(t){return typeof t=="string"?t:pme(t)||""}const gme="idb-keyval";var yme=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",n=o=>e+o;let i;return t.dbName&&t.storeName&&(i=LG(t.dbName,t.storeName)),{name:gme,options:t,async hasItem(o){return!(typeof await F$(n(o),i)>"u")},async getItem(o){return await F$(n(o),i)??null},setItem(o,l){return lme(n(o),l,i)},removeItem(o){return ume(n(o),i)},getKeys(){return fme(i)},clear(){return dme(i)}}};const _me="WALLET_CONNECT_V2_INDEXED_DB",wme="keyvaluestorage";let bme=class{constructor(){this.indexedDb=cme({driver:yme({dbName:_me,storeName:wme})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const n=await this.indexedDb.getItem(e);if(n!==null)return n}async setItem(e,n){await this.indexedDb.setItem(e,Q0(n))}async removeItem(e){await this.indexedDb.removeItem(e)}};var bP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$T={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},t.prototype.setItem=function(n,i){this[n]=String(i)},t.prototype.removeItem=function(n){delete this[n]},t.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(i){n[i]=void 0,delete n[i]})},t.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof bP<"u"&&bP.localStorage?$T.exports=bP.localStorage:typeof window<"u"&&window.localStorage?$T.exports=window.localStorage:$T.exports=new e})();function vme(t){var e;return[t[0],J0((e=t[1])!=null?e:"")]}let xme=class{constructor(){this.localStorage=$T.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(vme)}async getItem(e){const n=this.localStorage.getItem(e);if(n!==null)return J0(n)}async setItem(e,n){this.localStorage.setItem(e,Q0(n))}async removeItem(e){this.localStorage.removeItem(e)}};const Eme="wc_storage_version",$$=1,Cme=async(t,e,n)=>{const i=Eme,o=await e.getItem(i);if(o&&o>=$$){n(e);return}const l=await t.getKeys();if(!l.length){n(e);return}const h=[];for(;l.length;){const s=l.shift();if(!s)continue;const w=s.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const x=await t.getItem(s);await e.setItem(s,x),h.push(s)}}await e.setItem(i,$$),n(e),Tme(t,h)},Tme=async(t,e)=>{e.length&&e.forEach(async n=>{await t.removeItem(n)})};let Ame=class{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const e=new xme;this.storage=e;try{const n=new bme;Cme(e,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,n){return await this.initialize(),this.storage.setItem(e,n)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),e())},20)})}};var Sme=Object.defineProperty,Ime=(t,e,n)=>e in t?Sme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,z$=(t,e,n)=>Ime(t,typeof e!="symbol"?e+"":e,n);let Pme=class extends Sy{constructor(e){super(),this.opts=e,z$(this,"protocol","wc"),z$(this,"version",2)}};var Rme=Object.defineProperty,Ome=(t,e,n)=>e in t?Rme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kme=(t,e,n)=>Ome(t,e+"",n);let Dme=class extends Sy{constructor(e,n){super(),this.core=e,this.logger=n,kme(this,"records",new Map)}},Nme=class{constructor(e,n){this.logger=e,this.core=n}},Mme=class extends Sy{constructor(e,n){super(),this.relayer=e,this.logger=n}},Lme=class extends Sy{constructor(e){super()}},Bme=class{constructor(e,n,i,o){this.core=e,this.logger=n,this.name=i}},Fme=class extends Sy{constructor(e,n){super(),this.relayer=e,this.logger=n}},$me=class extends Sy{constructor(e,n){super(),this.core=e,this.logger=n}},zme=class{constructor(e,n,i){this.core=e,this.logger=n,this.store=i}},Ume=class{constructor(e,n){this.projectId=e,this.logger=n}},jme=class{constructor(e,n,i){this.core=e,this.logger=n,this.telemetryEnabled=i}};var Vme=Object.defineProperty,Wme=(t,e,n)=>e in t?Vme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,U$=(t,e,n)=>Wme(t,typeof e!="symbol"?e+"":e,n);let Hme=class{constructor(e){this.opts=e,U$(this,"protocol","wc"),U$(this,"version",2)}},Gme=class{constructor(e){this.client=e}};function qme(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function BG(t,...e){if(!qme(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function j$(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zme(t,e){BG(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const p1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vP=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Kme(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function FG(t){return typeof t=="string"&&(t=Kme(t)),BG(t),t}let Yme=class{clone(){return this._cloneInto()}};function Xme(t){const e=i=>t().update(FG(i)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function $G(t=32){if(p1&&typeof p1.getRandomValues=="function")return p1.getRandomValues(new Uint8Array(t));if(p1&&typeof p1.randomBytes=="function")return p1.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Jme(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const o=BigInt(32),l=BigInt(4294967295),h=Number(n>>o&l),s=Number(n&l),w=i?4:0,x=i?0:4;t.setUint32(e+w,h,i),t.setUint32(e+x,s,i)}let Qme=class extends Yme{constructor(e,n,i,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=vP(this.buffer)}update(e){j$(this);const{view:n,buffer:i,blockLen:o}=this;e=FG(e);const l=e.length;for(let h=0;h<l;){const s=Math.min(o-this.pos,l-h);if(s===o){const w=vP(e);for(;o<=l-h;h+=o)this.process(w,h);continue}i.set(e.subarray(h,h+s),this.pos),this.pos+=s,h+=s,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){j$(this),Zme(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:o,isLE:l}=this;let{pos:h}=this;n[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(i,0),h=0);for(let P=h;P<o;P++)n[P]=0;Jme(i,o-8,BigInt(this.length*8),l),this.process(i,0);const s=vP(e),w=this.outputLen;if(w%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const x=w/4,A=this.get();if(x>A.length)throw new Error("_sha2: outputLen bigger than state");for(let P=0;P<x;P++)s.setUint32(4*P,A[P],l)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:o,finished:l,destroyed:h,pos:s}=this;return e.length=o,e.pos=s,e.finished=l,e.destroyed=h,o%n&&e.buffer.set(i),e}};const eT=BigInt(2**32-1),R8=BigInt(32);function zG(t,e=!1){return e?{h:Number(t&eT),l:Number(t>>R8&eT)}:{h:Number(t>>R8&eT)|0,l:Number(t&eT)|0}}function ege(t,e=!1){let n=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:l,l:h}=zG(t[o],e);[n[o],i[o]]=[l,h]}return[n,i]}const tge=(t,e)=>BigInt(t>>>0)<<R8|BigInt(e>>>0),nge=(t,e,n)=>t>>>n,ige=(t,e,n)=>t<<32-n|e>>>n,rge=(t,e,n)=>t>>>n|e<<32-n,sge=(t,e,n)=>t<<32-n|e>>>n,oge=(t,e,n)=>t<<64-n|e>>>n-32,age=(t,e,n)=>t>>>n-32|e<<64-n,cge=(t,e)=>e,lge=(t,e)=>t,uge=(t,e,n)=>t<<n|e>>>32-n,dge=(t,e,n)=>e<<n|t>>>32-n,hge=(t,e,n)=>e<<n-32|t>>>64-n,fge=(t,e,n)=>t<<n-32|e>>>64-n;function pge(t,e,n,i){const o=(e>>>0)+(i>>>0);return{h:t+n+(o/2**32|0)|0,l:o|0}}const mge=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),gge=(t,e,n,i)=>e+n+i+(t/2**32|0)|0,yge=(t,e,n,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0),_ge=(t,e,n,i,o)=>e+n+i+o+(t/2**32|0)|0,wge=(t,e,n,i,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0)+(o>>>0),bge=(t,e,n,i,o,l)=>e+n+i+o+l+(t/2**32|0)|0,Yi={fromBig:zG,split:ege,toBig:tge,shrSH:nge,shrSL:ige,rotrSH:rge,rotrSL:sge,rotrBH:oge,rotrBL:age,rotr32H:cge,rotr32L:lge,rotlSH:uge,rotlSL:dge,rotlBH:hge,rotlBL:fge,add:pge,add3L:mge,add3H:gge,add4L:yge,add4H:_ge,add5H:bge,add5L:wge},[vge,xge]=Yi.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),qp=new Uint32Array(80),Zp=new Uint32Array(80);let Ege=class extends Qme{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:i,Bl:o,Ch:l,Cl:h,Dh:s,Dl:w,Eh:x,El:A,Fh:P,Fl:D,Gh:M,Gl:z,Hh:U,Hl:G}=this;return[e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G]}set(e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G){this.Ah=e|0,this.Al=n|0,this.Bh=i|0,this.Bl=o|0,this.Ch=l|0,this.Cl=h|0,this.Dh=s|0,this.Dl=w|0,this.Eh=x|0,this.El=A|0,this.Fh=P|0,this.Fl=D|0,this.Gh=M|0,this.Gl=z|0,this.Hh=U|0,this.Hl=G|0}process(e,n){for(let Q=0;Q<16;Q++,n+=4)qp[Q]=e.getUint32(n),Zp[Q]=e.getUint32(n+=4);for(let Q=16;Q<80;Q++){const de=qp[Q-15]|0,he=Zp[Q-15]|0,Ie=Yi.rotrSH(de,he,1)^Yi.rotrSH(de,he,8)^Yi.shrSH(de,he,7),ke=Yi.rotrSL(de,he,1)^Yi.rotrSL(de,he,8)^Yi.shrSL(de,he,7),Ue=qp[Q-2]|0,ze=Zp[Q-2]|0,ht=Yi.rotrSH(Ue,ze,19)^Yi.rotrBH(Ue,ze,61)^Yi.shrSH(Ue,ze,6),ft=Yi.rotrSL(Ue,ze,19)^Yi.rotrBL(Ue,ze,61)^Yi.shrSL(Ue,ze,6),ct=Yi.add4L(ke,ft,Zp[Q-7],Zp[Q-16]),je=Yi.add4H(ct,Ie,ht,qp[Q-7],qp[Q-16]);qp[Q]=je|0,Zp[Q]=ct|0}let{Ah:i,Al:o,Bh:l,Bl:h,Ch:s,Cl:w,Dh:x,Dl:A,Eh:P,El:D,Fh:M,Fl:z,Gh:U,Gl:G,Hh:ne,Hl:oe}=this;for(let Q=0;Q<80;Q++){const de=Yi.rotrSH(P,D,14)^Yi.rotrSH(P,D,18)^Yi.rotrBH(P,D,41),he=Yi.rotrSL(P,D,14)^Yi.rotrSL(P,D,18)^Yi.rotrBL(P,D,41),Ie=P&M^~P&U,ke=D&z^~D&G,Ue=Yi.add5L(oe,he,ke,xge[Q],Zp[Q]),ze=Yi.add5H(Ue,ne,de,Ie,vge[Q],qp[Q]),ht=Ue|0,ft=Yi.rotrSH(i,o,28)^Yi.rotrBH(i,o,34)^Yi.rotrBH(i,o,39),ct=Yi.rotrSL(i,o,28)^Yi.rotrBL(i,o,34)^Yi.rotrBL(i,o,39),je=i&l^i&s^l&s,Ye=o&h^o&w^h&w;ne=U|0,oe=G|0,U=M|0,G=z|0,M=P|0,z=D|0,{h:P,l:D}=Yi.add(x|0,A|0,ze|0,ht|0),x=s|0,A=w|0,s=l|0,w=h|0,l=i|0,h=o|0;const re=Yi.add3L(ht,ct,Ye);i=Yi.add3H(re,ze,ft,je),o=re|0}({h:i,l:o}=Yi.add(this.Ah|0,this.Al|0,i|0,o|0)),{h:l,l:h}=Yi.add(this.Bh|0,this.Bl|0,l|0,h|0),{h:s,l:w}=Yi.add(this.Ch|0,this.Cl|0,s|0,w|0),{h:x,l:A}=Yi.add(this.Dh|0,this.Dl|0,x|0,A|0),{h:P,l:D}=Yi.add(this.Eh|0,this.El|0,P|0,D|0),{h:M,l:z}=Yi.add(this.Fh|0,this.Fl|0,M|0,z|0),{h:U,l:G}=Yi.add(this.Gh|0,this.Gl|0,U|0,G|0),{h:ne,l:oe}=Yi.add(this.Hh|0,this.Hl|0,ne|0,oe|0),this.set(i,o,l,h,s,w,x,A,P,D,M,z,U,G,ne,oe)}roundClean(){qp.fill(0),Zp.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Cge=Xme(()=>new Ege);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rD=BigInt(0),UG=BigInt(1),Tge=BigInt(2);function sD(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function oD(t){if(!sD(t))throw new Error("Uint8Array expected")}function xP(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Age=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function aD(t){oD(t);let e="";for(let n=0;n<t.length;n++)e+=Age[t[n]];return e}function jG(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?rD:BigInt("0x"+t)}const gf={_0:48,_9:57,A:65,F:70,a:97,f:102};function V$(t){if(t>=gf._0&&t<=gf._9)return t-gf._0;if(t>=gf.A&&t<=gf.F)return t-(gf.A-10);if(t>=gf.a&&t<=gf.f)return t-(gf.a-10)}function VG(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let o=0,l=0;o<n;o++,l+=2){const h=V$(t.charCodeAt(l)),s=V$(t.charCodeAt(l+1));if(h===void 0||s===void 0){const w=t[l]+t[l+1];throw new Error('hex string expected, got non-hex character "'+w+'" at index '+l)}i[o]=h*16+s}return i}function Sge(t){return jG(aD(t))}function zT(t){return oD(t),jG(aD(Uint8Array.from(t).reverse()))}function WG(t,e){return VG(t.toString(16).padStart(e*2,"0"))}function O8(t,e){return WG(t,e).reverse()}function yf(t,e,n){let i;if(typeof e=="string")try{i=VG(e)}catch(l){throw new Error(t+" must be hex string or Uint8Array, cause: "+l)}else if(sD(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const o=i.length;if(typeof n=="number"&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return i}function W$(...t){let e=0;for(let i=0;i<t.length;i++){const o=t[i];oD(o),e+=o.length}const n=new Uint8Array(e);for(let i=0,o=0;i<t.length;i++){const l=t[i];n.set(l,o),o+=l.length}return n}const EP=t=>typeof t=="bigint"&&rD<=t;function Ige(t,e,n){return EP(t)&&EP(e)&&EP(n)&&e<=t&&t<n}function fx(t,e,n,i){if(!Ige(e,n,i))throw new Error("expected valid "+t+": "+n+" <= n < "+i+", got "+e)}function Pge(t){let e;for(e=0;t>rD;t>>=UG,e+=1);return e}const Rge=t=>(Tge<<BigInt(t-1))-UG,Oge={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||sD(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function cD(t,e,n={}){const i=(o,l,h)=>{const s=Oge[l];if(typeof s!="function")throw new Error("invalid validator function");const w=t[o];if(!(h&&w===void 0)&&!s(w,t))throw new Error("param "+String(o)+" is invalid. Expected "+l+", got "+w)};for(const[o,l]of Object.entries(e))i(o,l,!1);for(const[o,l]of Object.entries(n))i(o,l,!0);return t}function H$(t){const e=new WeakMap;return(n,...i)=>{const o=e.get(n);if(o!==void 0)return o;const l=t(n,...i);return e.set(n,l),l}}const oa=BigInt(0),io=BigInt(1),w0=BigInt(2),kge=BigInt(3),k8=BigInt(4),G$=BigInt(5),q$=BigInt(8);function Do(t,e){const n=t%e;return n>=oa?n:e+n}function Dge(t,e,n){if(e<oa)throw new Error("invalid exponent, negatives unsupported");if(n<=oa)throw new Error("invalid modulus");if(n===io)return oa;let i=io;for(;e>oa;)e&io&&(i=i*t%n),t=t*t%n,e>>=io;return i}function rh(t,e,n){let i=t;for(;e-- >oa;)i*=i,i%=n;return i}function Z$(t,e){if(t===oa)throw new Error("invert: expected non-zero number");if(e<=oa)throw new Error("invert: expected positive modulus, got "+e);let n=Do(t,e),i=e,o=oa,l=io;for(;n!==oa;){const h=i/n,s=i%n,w=o-l*h;i=n,n=s,o=l,l=w}if(i!==io)throw new Error("invert: does not exist");return Do(o,e)}function Nge(t){const e=(t-io)/w0;let n,i,o;for(n=t-io,i=0;n%w0===oa;n/=w0,i++);for(o=w0;o<t&&Dge(o,e,t)!==t-io;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const h=(t+io)/k8;return function(s,w){const x=s.pow(w,h);if(!s.eql(s.sqr(x),w))throw new Error("Cannot find square root");return x}}const l=(n+io)/w0;return function(h,s){if(h.pow(s,e)===h.neg(h.ONE))throw new Error("Cannot find square root");let w=i,x=h.pow(h.mul(h.ONE,o),n),A=h.pow(s,l),P=h.pow(s,n);for(;!h.eql(P,h.ONE);){if(h.eql(P,h.ZERO))return h.ZERO;let D=1;for(let z=h.sqr(P);D<w&&!h.eql(z,h.ONE);D++)z=h.sqr(z);const M=h.pow(x,io<<BigInt(w-D-1));x=h.sqr(M),A=h.mul(A,M),P=h.mul(P,x),w=D}return A}}function Mge(t){if(t%k8===kge){const e=(t+io)/k8;return function(n,i){const o=n.pow(i,e);if(!n.eql(n.sqr(o),i))throw new Error("Cannot find square root");return o}}if(t%q$===G$){const e=(t-G$)/q$;return function(n,i){const o=n.mul(i,w0),l=n.pow(o,e),h=n.mul(i,l),s=n.mul(n.mul(h,w0),l),w=n.mul(h,n.sub(s,n.ONE));if(!n.eql(n.sqr(w),i))throw new Error("Cannot find square root");return w}}return Nge(t)}const Lge=(t,e)=>(Do(t,e)&io)===io,Bge=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Fge(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Bge.reduce((i,o)=>(i[o]="function",i),e);return cD(t,n)}function $ge(t,e,n){if(n<oa)throw new Error("invalid exponent, negatives unsupported");if(n===oa)return t.ONE;if(n===io)return e;let i=t.ONE,o=e;for(;n>oa;)n&io&&(i=t.mul(i,o)),o=t.sqr(o),n>>=io;return i}function zge(t,e){const n=new Array(e.length),i=e.reduce((l,h,s)=>t.is0(h)?l:(n[s]=l,t.mul(l,h)),t.ONE),o=t.inv(i);return e.reduceRight((l,h,s)=>t.is0(h)?l:(n[s]=t.mul(l,n[s]),t.mul(l,h)),o),n}function HG(t,e){const n=e!==void 0?e:t.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function GG(t,e,n=!1,i={}){if(t<=oa)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:o,nByteLength:l}=HG(t,e);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const s=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:l,MASK:Rge(o),ZERO:oa,ONE:io,create:w=>Do(w,t),isValid:w=>{if(typeof w!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof w);return oa<=w&&w<t},is0:w=>w===oa,isOdd:w=>(w&io)===io,neg:w=>Do(-w,t),eql:(w,x)=>w===x,sqr:w=>Do(w*w,t),add:(w,x)=>Do(w+x,t),sub:(w,x)=>Do(w-x,t),mul:(w,x)=>Do(w*x,t),pow:(w,x)=>$ge(s,w,x),div:(w,x)=>Do(w*Z$(x,t),t),sqrN:w=>w*w,addN:(w,x)=>w+x,subN:(w,x)=>w-x,mulN:(w,x)=>w*x,inv:w=>Z$(w,t),sqrt:i.sqrt||(w=>(h||(h=Mge(t)),h(s,w))),invertBatch:w=>zge(s,w),cmov:(w,x,A)=>A?x:w,toBytes:w=>n?O8(w,l):WG(w,l),fromBytes:w=>{if(w.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+w.length);return n?zT(w):Sge(w)}});return Object.freeze(s)}const K$=BigInt(0),tT=BigInt(1);function CP(t,e){const n=e.negate();return t?n:e}function qG(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function TP(t,e){qG(t,e);const n=Math.ceil(e/t)+1,i=2**(t-1);return{windows:n,windowSize:i}}function Uge(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,i)=>{if(!(n instanceof e))throw new Error("invalid point at index "+i)})}function jge(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,i)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+i)})}const AP=new WeakMap,ZG=new WeakMap;function SP(t){return ZG.get(t)||1}function Vge(t,e){return{constTimeNegate:CP,hasPrecomputes(n){return SP(n)!==1},unsafeLadder(n,i,o=t.ZERO){let l=n;for(;i>K$;)i&tT&&(o=o.add(l)),l=l.double(),i>>=tT;return o},precomputeWindow(n,i){const{windows:o,windowSize:l}=TP(i,e),h=[];let s=n,w=s;for(let x=0;x<o;x++){w=s,h.push(w);for(let A=1;A<l;A++)w=w.add(s),h.push(w);s=w.double()}return h},wNAF(n,i,o){const{windows:l,windowSize:h}=TP(n,e);let s=t.ZERO,w=t.BASE;const x=BigInt(2**n-1),A=2**n,P=BigInt(n);for(let D=0;D<l;D++){const M=D*h;let z=Number(o&x);o>>=P,z>h&&(z-=A,o+=tT);const U=M,G=M+Math.abs(z)-1,ne=D%2!==0,oe=z<0;z===0?w=w.add(CP(ne,i[U])):s=s.add(CP(oe,i[G]))}return{p:s,f:w}},wNAFUnsafe(n,i,o,l=t.ZERO){const{windows:h,windowSize:s}=TP(n,e),w=BigInt(2**n-1),x=2**n,A=BigInt(n);for(let P=0;P<h;P++){const D=P*s;if(o===K$)break;let M=Number(o&w);if(o>>=A,M>s&&(M-=x,o+=tT),M===0)continue;let z=i[D+Math.abs(M)-1];M<0&&(z=z.negate()),l=l.add(z)}return l},getPrecomputes(n,i,o){let l=AP.get(i);return l||(l=this.precomputeWindow(i,n),n!==1&&AP.set(i,o(l))),l},wNAFCached(n,i,o){const l=SP(n);return this.wNAF(l,this.getPrecomputes(l,n,o),i)},wNAFCachedUnsafe(n,i,o,l){const h=SP(n);return h===1?this.unsafeLadder(n,i,l):this.wNAFUnsafe(h,this.getPrecomputes(h,n,o),i,l)},setWindowSize(n,i){qG(i,e),ZG.set(n,i),AP.delete(n)}}}function Wge(t,e,n,i){if(Uge(n,t),jge(i,e),n.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,l=Pge(BigInt(n.length)),h=l>12?l-3:l>4?l-2:l?2:1,s=(1<<h)-1,w=new Array(s+1).fill(o),x=Math.floor((e.BITS-1)/h)*h;let A=o;for(let P=x;P>=0;P-=h){w.fill(o);for(let M=0;M<i.length;M++){const z=i[M],U=Number(z>>BigInt(P)&BigInt(s));w[U]=w[U].add(n[M])}let D=o;for(let M=w.length-1,z=o;M>0;M--)z=z.add(w[M]),D=D.add(z);if(A=A.add(D),P!==0)for(let M=0;M<h;M++)A=A.double()}return A}function Hge(t){return Fge(t.Fp),cD(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...HG(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const ed=BigInt(0),Zc=BigInt(1),nT=BigInt(2),Gge=BigInt(8),qge={zip215:!0};function Zge(t){const e=Hge(t);return cD(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Kge(t){const e=Zge(t),{Fp:n,n:i,prehash:o,hash:l,randomBytes:h,nByteLength:s,h:w}=e,x=nT<<BigInt(s*8)-Zc,A=n.create,P=GG(e.n,e.nBitLength),D=e.uvRatio||((re,le)=>{try{return{isValid:!0,value:n.sqrt(re*n.inv(le))}}catch{return{isValid:!1,value:ed}}}),M=e.adjustScalarBytes||(re=>re),z=e.domain||((re,le,Ae)=>{if(xP("phflag",Ae),le.length||Ae)throw new Error("Contexts/pre-hash are not supported");return re});function U(re,le){fx("coordinate "+re,le,ed,x)}function G(re){if(!(re instanceof Q))throw new Error("ExtendedPoint expected")}const ne=H$((re,le)=>{const{ex:Ae,ey:Le,ez:De}=re,He=re.is0();le==null&&(le=He?Gge:n.inv(De));const Et=A(Ae*le),Ct=A(Le*le),Dt=A(De*le);if(He)return{x:ed,y:Zc};if(Dt!==Zc)throw new Error("invZ was invalid");return{x:Et,y:Ct}}),oe=H$(re=>{const{a:le,d:Ae}=e;if(re.is0())throw new Error("bad point: ZERO");const{ex:Le,ey:De,ez:He,et:Et}=re,Ct=A(Le*Le),Dt=A(De*De),Bt=A(He*He),Yt=A(Bt*Bt),yn=A(Ct*le),mn=A(Bt*A(yn+Dt)),oi=A(Yt+A(Ae*A(Ct*Dt)));if(mn!==oi)throw new Error("bad point: equation left != right (1)");const sn=A(Le*De),_n=A(He*Et);if(sn!==_n)throw new Error("bad point: equation left != right (2)");return!0});class Q{constructor(le,Ae,Le,De){this.ex=le,this.ey=Ae,this.ez=Le,this.et=De,U("x",le),U("y",Ae),U("z",Le),U("t",De),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(le){if(le instanceof Q)throw new Error("extended point not allowed");const{x:Ae,y:Le}=le||{};return U("x",Ae),U("y",Le),new Q(Ae,Le,Zc,A(Ae*Le))}static normalizeZ(le){const Ae=n.invertBatch(le.map(Le=>Le.ez));return le.map((Le,De)=>Le.toAffine(Ae[De])).map(Q.fromAffine)}static msm(le,Ae){return Wge(Q,P,le,Ae)}_setWindowSize(le){Ie.setWindowSize(this,le)}assertValidity(){oe(this)}equals(le){G(le);const{ex:Ae,ey:Le,ez:De}=this,{ex:He,ey:Et,ez:Ct}=le,Dt=A(Ae*Ct),Bt=A(He*De),Yt=A(Le*Ct),yn=A(Et*De);return Dt===Bt&&Yt===yn}is0(){return this.equals(Q.ZERO)}negate(){return new Q(A(-this.ex),this.ey,this.ez,A(-this.et))}double(){const{a:le}=e,{ex:Ae,ey:Le,ez:De}=this,He=A(Ae*Ae),Et=A(Le*Le),Ct=A(nT*A(De*De)),Dt=A(le*He),Bt=Ae+Le,Yt=A(A(Bt*Bt)-He-Et),yn=Dt+Et,mn=yn-Ct,oi=Dt-Et,sn=A(Yt*mn),_n=A(yn*oi),ai=A(Yt*oi),er=A(mn*yn);return new Q(sn,_n,er,ai)}add(le){G(le);const{a:Ae,d:Le}=e,{ex:De,ey:He,ez:Et,et:Ct}=this,{ex:Dt,ey:Bt,ez:Yt,et:yn}=le;if(Ae===BigInt(-1)){const _l=A((He-De)*(Bt+Dt)),Ra=A((He+De)*(Bt-Dt)),Lo=A(Ra-_l);if(Lo===ed)return this.double();const oc=A(Et*nT*yn),Bo=A(Ct*nT*Yt),Js=Bo+oc,zs=Ra+_l,ts=Bo-oc,co=A(Js*Lo),Fc=A(zs*ts),wl=A(Js*ts),hs=A(Lo*zs);return new Q(co,Fc,hs,wl)}const mn=A(De*Dt),oi=A(He*Bt),sn=A(Ct*Le*yn),_n=A(Et*Yt),ai=A((De+He)*(Dt+Bt)-mn-oi),er=_n-sn,ui=_n+sn,Yr=A(oi-Ae*mn),$s=A(ai*er),Xs=A(ui*Yr),la=A(ai*Yr),xr=A(er*ui);return new Q($s,Xs,xr,la)}subtract(le){return this.add(le.negate())}wNAF(le){return Ie.wNAFCached(this,le,Q.normalizeZ)}multiply(le){const Ae=le;fx("scalar",Ae,Zc,i);const{p:Le,f:De}=this.wNAF(Ae);return Q.normalizeZ([Le,De])[0]}multiplyUnsafe(le,Ae=Q.ZERO){const Le=le;return fx("scalar",Le,ed,i),Le===ed?he:this.is0()||Le===Zc?this:Ie.wNAFCachedUnsafe(this,Le,Q.normalizeZ,Ae)}isSmallOrder(){return this.multiplyUnsafe(w).is0()}isTorsionFree(){return Ie.unsafeLadder(this,i).is0()}toAffine(le){return ne(this,le)}clearCofactor(){const{h:le}=e;return le===Zc?this:this.multiplyUnsafe(le)}static fromHex(le,Ae=!1){const{d:Le,a:De}=e,He=n.BYTES;le=yf("pointHex",le,He),xP("zip215",Ae);const Et=le.slice(),Ct=le[He-1];Et[He-1]=Ct&-129;const Dt=zT(Et),Bt=Ae?x:n.ORDER;fx("pointHex.y",Dt,ed,Bt);const Yt=A(Dt*Dt),yn=A(Yt-Zc),mn=A(Le*Yt-De);let{isValid:oi,value:sn}=D(yn,mn);if(!oi)throw new Error("Point.fromHex: invalid y coordinate");const _n=(sn&Zc)===Zc,ai=(Ct&128)!==0;if(!Ae&&sn===ed&&ai)throw new Error("Point.fromHex: x=0 and x_0=1");return ai!==_n&&(sn=A(-sn)),Q.fromAffine({x:sn,y:Dt})}static fromPrivateKey(le){return ze(le).point}toRawBytes(){const{x:le,y:Ae}=this.toAffine(),Le=O8(Ae,n.BYTES);return Le[Le.length-1]|=le&Zc?128:0,Le}toHex(){return aD(this.toRawBytes())}}Q.BASE=new Q(e.Gx,e.Gy,Zc,A(e.Gx*e.Gy)),Q.ZERO=new Q(ed,Zc,Zc,ed);const{BASE:de,ZERO:he}=Q,Ie=Vge(Q,s*8);function ke(re){return Do(re,i)}function Ue(re){return ke(zT(re))}function ze(re){const le=n.BYTES;re=yf("private key",re,le);const Ae=yf("hashed private key",l(re),2*le),Le=M(Ae.slice(0,le)),De=Ae.slice(le,2*le),He=Ue(Le),Et=de.multiply(He),Ct=Et.toRawBytes();return{head:Le,prefix:De,scalar:He,point:Et,pointBytes:Ct}}function ht(re){return ze(re).pointBytes}function ft(re=new Uint8Array,...le){const Ae=W$(...le);return Ue(l(z(Ae,yf("context",re),!!o)))}function ct(re,le,Ae={}){re=yf("message",re),o&&(re=o(re));const{prefix:Le,scalar:De,pointBytes:He}=ze(le),Et=ft(Ae.context,Le,re),Ct=de.multiply(Et).toRawBytes(),Dt=ft(Ae.context,Ct,He,re),Bt=ke(Et+Dt*De);fx("signature.s",Bt,ed,i);const Yt=W$(Ct,O8(Bt,n.BYTES));return yf("result",Yt,n.BYTES*2)}const je=qge;function Ye(re,le,Ae,Le=je){const{context:De,zip215:He}=Le,Et=n.BYTES;re=yf("signature",re,2*Et),le=yf("message",le),Ae=yf("publicKey",Ae,Et),He!==void 0&&xP("zip215",He),o&&(le=o(le));const Ct=zT(re.slice(Et,2*Et));let Dt,Bt,Yt;try{Dt=Q.fromHex(Ae,He),Bt=Q.fromHex(re.slice(0,Et),He),Yt=de.multiplyUnsafe(Ct)}catch{return!1}if(!He&&Dt.isSmallOrder())return!1;const yn=ft(De,Bt.toRawBytes(),Dt.toRawBytes(),le);return Bt.add(Dt.multiplyUnsafe(yn)).subtract(Yt).clearCofactor().equals(Q.ZERO)}return de._setWindowSize(8),{CURVE:e,getPublicKey:ht,sign:ct,verify:Ye,ExtendedPoint:Q,utils:{getExtendedPublicKey:ze,randomPrivateKey:()=>h(n.BYTES),precompute(re=8,le=Q.BASE){return le._setWindowSize(re),le.multiply(BigInt(3)),le}}}}BigInt(0),BigInt(1);const lD=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Y$=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Yge=BigInt(1),X$=BigInt(2);BigInt(3);const Xge=BigInt(5),Jge=BigInt(8);function Qge(t){const e=BigInt(10),n=BigInt(20),i=BigInt(40),o=BigInt(80),l=lD,h=t*t%l*t%l,s=rh(h,X$,l)*h%l,w=rh(s,Yge,l)*t%l,x=rh(w,Xge,l)*w%l,A=rh(x,e,l)*x%l,P=rh(A,n,l)*A%l,D=rh(P,i,l)*P%l,M=rh(D,o,l)*D%l,z=rh(M,o,l)*D%l,U=rh(z,e,l)*x%l;return{pow_p_5_8:rh(U,X$,l)*t%l,b2:h}}function e0e(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function t0e(t,e){const n=lD,i=Do(e*e*e,n),o=Do(i*i*e,n),l=Qge(t*o).pow_p_5_8;let h=Do(t*i*l,n);const s=Do(e*h*h,n),w=h,x=Do(h*Y$,n),A=s===t,P=s===Do(-t,n),D=s===Do(-t*Y$,n);return A&&(h=w),(P||D)&&(h=x),Lge(h,n)&&(h=Do(-h,n)),{isValid:A||P,value:h}}const n0e=GG(lD,void 0,!0),i0e={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:n0e,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Jge,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Cge,randomBytes:$G,adjustScalarBytes:e0e,uvRatio:t0e},KG=Kge(i0e),r0e="EdDSA",s0e="JWT",SA=".",GS="base64url",YG="utf8",XG="utf8",o0e=":",a0e="did",c0e="key",J$="base58btc",l0e="z",u0e="K36",d0e=32;function uD(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function JG(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?uD(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function QG(t,e){e||(e=t.reduce((o,l)=>o+l.length,0));const n=JG(e);let i=0;for(const o of t)n.set(o,i),i+=o.length;return uD(n)}function h0e(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var o=0;o<t.length;o++){var l=t.charAt(o),h=l.charCodeAt(0);if(n[h]!==255)throw new TypeError(l+" is ambiguous");n[h]=o}var s=t.length,w=t.charAt(0),x=Math.log(s)/Math.log(256),A=Math.log(256)/Math.log(s);function P(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var U=0,G=0,ne=0,oe=z.length;ne!==oe&&z[ne]===0;)ne++,U++;for(var Q=(oe-ne)*A+1>>>0,de=new Uint8Array(Q);ne!==oe;){for(var he=z[ne],Ie=0,ke=Q-1;(he!==0||Ie<G)&&ke!==-1;ke--,Ie++)he+=256*de[ke]>>>0,de[ke]=he%s>>>0,he=he/s>>>0;if(he!==0)throw new Error("Non-zero carry");G=Ie,ne++}for(var Ue=Q-G;Ue!==Q&&de[Ue]===0;)Ue++;for(var ze=w.repeat(U);Ue<Q;++Ue)ze+=t.charAt(de[Ue]);return ze}function D(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var U=0;if(z[U]!==" "){for(var G=0,ne=0;z[U]===w;)G++,U++;for(var oe=(z.length-U)*x+1>>>0,Q=new Uint8Array(oe);z[U];){var de=n[z.charCodeAt(U)];if(de===255)return;for(var he=0,Ie=oe-1;(de!==0||he<ne)&&Ie!==-1;Ie--,he++)de+=s*Q[Ie]>>>0,Q[Ie]=de%256>>>0,de=de/256>>>0;if(de!==0)throw new Error("Non-zero carry");ne=he,U++}if(z[U]!==" "){for(var ke=oe-ne;ke!==oe&&Q[ke]===0;)ke++;for(var Ue=new Uint8Array(G+(oe-ke)),ze=G;ke!==oe;)Ue[ze++]=Q[ke++];return Ue}}}function M(z){var U=D(z);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:P,decodeUnsafe:D,decode:M}}var f0e=h0e,p0e=f0e;const eq=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},m0e=t=>new TextEncoder().encode(t),g0e=t=>new TextDecoder().decode(t);let y0e=class{constructor(e,n,i){this.name=e,this.prefix=n,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_0e=class{constructor(e,n,i){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return tq(this,e)}},w0e=class{constructor(e){this.decoders=e}or(e){return tq(this,e)}decode(e){const n=e[0],i=this.decoders[n];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const tq=(t,e)=>new w0e({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let b0e=class{constructor(e,n,i,o){this.name=e,this.prefix=n,this.baseEncode=i,this.baseDecode=o,this.encoder=new y0e(e,n,i),this.decoder=new _0e(e,n,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const qS=({name:t,prefix:e,encode:n,decode:i})=>new b0e(t,e,n,i),OE=({prefix:t,name:e,alphabet:n})=>{const{encode:i,decode:o}=p0e(n,e);return qS({prefix:t,name:e,encode:i,decode:l=>eq(o(l))})},v0e=(t,e,n,i)=>{const o={};for(let A=0;A<e.length;++A)o[e[A]]=A;let l=t.length;for(;t[l-1]==="=";)--l;const h=new Uint8Array(l*n/8|0);let s=0,w=0,x=0;for(let A=0;A<l;++A){const P=o[t[A]];if(P===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<n|P,s+=n,s>=8&&(s-=8,h[x++]=255&w>>s)}if(s>=n||255&w<<8-s)throw new SyntaxError("Unexpected end of data");return h},x0e=(t,e,n)=>{const i=e[e.length-1]==="=",o=(1<<n)-1;let l="",h=0,s=0;for(let w=0;w<t.length;++w)for(s=s<<8|t[w],h+=8;h>n;)h-=n,l+=e[o&s>>h];if(h&&(l+=e[o&s<<n-h]),i)for(;l.length*n&7;)l+="=";return l},Sa=({name:t,prefix:e,bitsPerChar:n,alphabet:i})=>qS({prefix:e,name:t,encode(o){return x0e(o,i,n)},decode(o){return v0e(o,i,n,t)}}),E0e=qS({prefix:"\0",name:"identity",encode:t=>g0e(t),decode:t=>m0e(t)});var C0e=Object.freeze({__proto__:null,identity:E0e});const T0e=Sa({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var A0e=Object.freeze({__proto__:null,base2:T0e});const S0e=Sa({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var I0e=Object.freeze({__proto__:null,base8:S0e});const P0e=OE({prefix:"9",name:"base10",alphabet:"0123456789"});var R0e=Object.freeze({__proto__:null,base10:P0e});const O0e=Sa({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),k0e=Sa({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var D0e=Object.freeze({__proto__:null,base16:O0e,base16upper:k0e});const N0e=Sa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),M0e=Sa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),L0e=Sa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),B0e=Sa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),F0e=Sa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$0e=Sa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),z0e=Sa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),U0e=Sa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),j0e=Sa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var V0e=Object.freeze({__proto__:null,base32:N0e,base32upper:M0e,base32pad:L0e,base32padupper:B0e,base32hex:F0e,base32hexupper:$0e,base32hexpad:z0e,base32hexpadupper:U0e,base32z:j0e});const W0e=OE({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),H0e=OE({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var G0e=Object.freeze({__proto__:null,base36:W0e,base36upper:H0e});const q0e=OE({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Z0e=OE({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var K0e=Object.freeze({__proto__:null,base58btc:q0e,base58flickr:Z0e});const Y0e=Sa({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),X0e=Sa({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),J0e=Sa({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Q0e=Sa({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var eye=Object.freeze({__proto__:null,base64:Y0e,base64pad:X0e,base64url:J0e,base64urlpad:Q0e});const nq=Array.from(""),tye=nq.reduce((t,e,n)=>(t[n]=e,t),[]),nye=nq.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function iye(t){return t.reduce((e,n)=>(e+=tye[n],e),"")}function rye(t){const e=[];for(const n of t){const i=nye[n.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(i)}return new Uint8Array(e)}const sye=qS({prefix:"",name:"base256emoji",encode:iye,decode:rye});var oye=Object.freeze({__proto__:null,base256emoji:sye}),aye=iq,Q$=128,cye=-128,lye=Math.pow(2,31);function iq(t,e,n){e=e||[],n=n||0;for(var i=n;t>=lye;)e[n++]=t&255|Q$,t/=128;for(;t&cye;)e[n++]=t&255|Q$,t>>>=7;return e[n]=t|0,iq.bytes=n-i+1,e}var uye=D8,dye=128,e7=127;function D8(t,i){var n=0,i=i||0,o=0,l=i,h,s=t.length;do{if(l>=s)throw D8.bytes=0,new RangeError("Could not decode varint");h=t[l++],n+=o<28?(h&e7)<<o:(h&e7)*Math.pow(2,o),o+=7}while(h>=dye);return D8.bytes=l-i,n}var hye=Math.pow(2,7),fye=Math.pow(2,14),pye=Math.pow(2,21),mye=Math.pow(2,28),gye=Math.pow(2,35),yye=Math.pow(2,42),_ye=Math.pow(2,49),wye=Math.pow(2,56),bye=Math.pow(2,63),vye=function(t){return t<hye?1:t<fye?2:t<pye?3:t<mye?4:t<gye?5:t<yye?6:t<_ye?7:t<wye?8:t<bye?9:10},xye={encode:aye,decode:uye,encodingLength:vye},rq=xye;const t7=(t,e,n=0)=>(rq.encode(t,e,n),e),n7=t=>rq.encodingLength(t),N8=(t,e)=>{const n=e.byteLength,i=n7(t),o=i+n7(n),l=new Uint8Array(o+n);return t7(t,l,0),t7(n,l,i),l.set(e,o),new Eye(t,n,e,l)};let Eye=class{constructor(e,n,i,o){this.code=e,this.size=n,this.digest=i,this.bytes=o}};const sq=({name:t,code:e,encode:n})=>new Cye(t,e,n);let Cye=class{constructor(e,n,i){this.name=e,this.code=n,this.encode=i}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?N8(this.code,n):n.then(i=>N8(this.code,i))}else throw Error("Unknown type, must be binary type")}};const oq=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Tye=sq({name:"sha2-256",code:18,encode:oq("SHA-256")}),Aye=sq({name:"sha2-512",code:19,encode:oq("SHA-512")});var Sye=Object.freeze({__proto__:null,sha256:Tye,sha512:Aye});const aq=0,Iye="identity",cq=eq,Pye=t=>N8(aq,cq(t)),Rye={code:aq,name:Iye,encode:cq,digest:Pye};var Oye=Object.freeze({__proto__:null,identity:Rye});new TextEncoder,new TextDecoder;const i7={...C0e,...A0e,...I0e,...R0e,...D0e,...V0e,...G0e,...K0e,...eye,...oye};({...Sye,...Oye});function lq(t,e,n,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:i}}}const r7=lq("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),IP=lq("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=JG(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),uq={utf8:r7,"utf-8":r7,hex:i7.base16,latin1:IP,ascii:IP,binary:IP,...i7};function ZS(t,e="utf8"){const n=uq[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}function Nw(t,e="utf8"){const n=uq[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?uD(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function s7(t){return J0(ZS(Nw(t,GS),YG))}function IA(t){return ZS(Nw(Q0(t),YG),GS)}function dq(t){const e=Nw(u0e,J$),n=l0e+ZS(QG([e,t]),J$);return[a0e,c0e,n].join(o0e)}function kye(t){return ZS(t,GS)}function Dye(t){return Nw(t,GS)}function Nye(t){return Nw([IA(t.header),IA(t.payload)].join(SA),XG)}function Mye(t){return[IA(t.header),IA(t.payload),kye(t.signature)].join(SA)}function M8(t){const e=t.split(SA),n=s7(e[0]),i=s7(e[1]),o=Dye(e[2]),l=Nw(e.slice(0,2).join(SA),XG);return{header:n,payload:i,signature:o,data:l}}function o7(t=$G(d0e)){const e=KG.getPublicKey(t);return{secretKey:QG([t,e]),publicKey:e}}async function Lye(t,e,n,i,o=vn.fromMiliseconds(Date.now())){const l={alg:r0e,typ:s0e},h=dq(i.publicKey),s=o+n,w={iss:h,sub:t,aud:e,iat:o,exp:s},x=Nye({header:l,payload:w}),A=KG.sign(x,i.secretKey.slice(0,32));return Mye({header:l,payload:w,signature:A})}var a7=function(t,e,n){if(n||arguments.length===2)for(var i=0,o=e.length,l;i<o;i++)(l||!(i in e))&&(l||(l=Array.prototype.slice.call(e,0,i)),l[i]=e[i]);return t.concat(l||Array.prototype.slice.call(e))},Bye=function(){function t(e,n,i){this.name=e,this.version=n,this.os=i,this.type="browser"}return t}(),Fye=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),$ye=function(){function t(e,n,i,o){this.name=e,this.version=n,this.os=i,this.bot=o,this.type="bot-device"}return t}(),zye=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Uye=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),jye=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Vye=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,c7=3,Wye=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",jye]],l7=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Hye(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Uye:typeof navigator<"u"?qye(navigator.userAgent):Kye()}function Gye(t){return t!==""&&Wye.reduce(function(e,n){var i=n[0],o=n[1];if(e)return e;var l=o.exec(t);return!!l&&[i,l]},!1)}function qye(t){var e=Gye(t);if(!e)return null;var n=e[0],i=e[1];if(n==="searchbot")return new zye;var o=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);o?o.length<c7&&(o=a7(a7([],o,!0),Yye(c7-o.length),!0)):o=[];var l=o.join("."),h=Zye(t),s=Vye.exec(t);return s&&s[1]?new $ye(n,l,h,s[1]):new Bye(n,l,h)}function Zye(t){for(var e=0,n=l7.length;e<n;e++){var i=l7[e],o=i[0],l=i[1],h=l.exec(t);if(h)return o}return null}function Kye(){var t=typeof process<"u"&&process.version;return t?new Fye(process.version.slice(1)):null}function Yye(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}var ls={};Object.defineProperty(ls,"__esModule",{value:!0});ls.getLocalStorage=ls.getLocalStorageOrThrow=ls.getCrypto=ls.getCryptoOrThrow=hq=ls.getLocation=ls.getLocationOrThrow=dD=ls.getNavigator=ls.getNavigatorOrThrow=ey=ls.getDocument=ls.getDocumentOrThrow=ls.getFromWindowOrThrow=ls.getFromWindow=void 0;function Ry(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ls.getFromWindow=Ry;function Mw(t){const e=Ry(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ls.getFromWindowOrThrow=Mw;function Xye(){return Mw("document")}ls.getDocumentOrThrow=Xye;function Jye(){return Ry("document")}var ey=ls.getDocument=Jye;function Qye(){return Mw("navigator")}ls.getNavigatorOrThrow=Qye;function e_e(){return Ry("navigator")}var dD=ls.getNavigator=e_e;function t_e(){return Mw("location")}ls.getLocationOrThrow=t_e;function n_e(){return Ry("location")}var hq=ls.getLocation=n_e;function i_e(){return Mw("crypto")}ls.getCryptoOrThrow=i_e;function r_e(){return Ry("crypto")}ls.getCrypto=r_e;function s_e(){return Mw("localStorage")}ls.getLocalStorageOrThrow=s_e;function o_e(){return Ry("localStorage")}ls.getLocalStorage=o_e;var hD={};Object.defineProperty(hD,"__esModule",{value:!0});var fq=hD.getWindowMetadata=void 0;const u7=ls;function a_e(){let t,e;try{t=u7.getDocumentOrThrow(),e=u7.getLocationOrThrow()}catch{return null}function n(){const P=t.getElementsByTagName("link"),D=[];for(let M=0;M<P.length;M++){const z=P[M],U=z.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const G=z.getAttribute("href");if(G)if(G.toLowerCase().indexOf("https:")===-1&&G.toLowerCase().indexOf("http:")===-1&&G.indexOf("//")!==0){let ne=e.protocol+"//"+e.host;if(G.indexOf("/")===0)ne+=G;else{const oe=e.pathname.split("/");oe.pop();const Q=oe.join("/");ne+=Q+"/"+G}D.push(ne)}else if(G.indexOf("//")===0){const ne=e.protocol+G;D.push(ne)}else D.push(G)}}return D}function i(...P){const D=t.getElementsByTagName("meta");for(let M=0;M<D.length;M++){const z=D[M],U=["itemprop","property","name"].map(G=>z.getAttribute(G)).filter(G=>G?P.includes(G):!1);if(U.length&&U){const G=z.getAttribute("content");if(G)return G}}return""}function o(){let P=i("name","og:site_name","og:title","twitter:title");return P||(P=t.title),P}function l(){return i("description","og:description","twitter:description","keywords")}const h=o(),s=l(),w=e.origin,x=n();return{description:s,url:w,icons:x,name:h}}fq=hD.getWindowMetadata=a_e;const c_e="0.1.1";function l_e(){return c_e}let ao=class L8 extends Error{constructor(e,n={}){const i=(()=>{var w;if(n.cause instanceof L8){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:(w=n.cause)!=null&&w.message?n.cause.message:n.details})(),o=n.cause instanceof L8&&n.cause.docsPath||n.docsPath,h=`https://oxlib.sh${o??""}`,s=[e||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...i||o?["",i?`Details: ${i}`:void 0,o?`See: ${h}`:void 0]:[]].filter(w=>typeof w=="string").join(`
`);super(s,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${l_e()}`}),this.cause=n.cause,this.details=i,this.docs=h,this.docsPath=o,this.shortMessage=e}walk(e){return pq(this,e)}};function pq(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?pq(t.cause,e):e?null:t}function u_e(t,e){if(p7(t)>e)throw new O_e({givenSize:p7(t),maxSize:e})}const _f={zero:48,nine:57,A:65,F:70,a:97,f:102};function d7(t){if(t>=_f.zero&&t<=_f.nine)return t-_f.zero;if(t>=_f.A&&t<=_f.F)return t-(_f.A-10);if(t>=_f.a&&t<=_f.f)return t-(_f.a-10)}function d_e(t,e={}){const{dir:n,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new k_e({size:t.length,targetSize:i,type:"Bytes"});const o=new Uint8Array(i);for(let l=0;l<i;l++){const h=n==="right";o[h?l:i-l-1]=t[h?l:t.length-l-1]}return o}function mq(t,e){if(Fm(t)>e)throw new v_e({givenSize:Fm(t),maxSize:e})}function h_e(t,e){if(typeof e=="number"&&e>0&&e>Fm(t)-1)throw new _q({offset:e,position:"start",size:Fm(t)})}function f_e(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Fm(t)!==n-e)throw new _q({offset:n,position:"end",size:Fm(t)})}function gq(t,e={}){const{dir:n,size:i=32}=e;if(i===0)return t;const o=t.replace("0x","");if(o.length>i*2)throw new x_e({size:Math.ceil(o.length/2),targetSize:i,type:"Hex"});return`0x${o[n==="right"?"padEnd":"padStart"](i*2,"0")}`}const p_e="#__bigint";function fD(t,e,n){return JSON.stringify(t,(i,o)=>typeof o=="bigint"?o.toString()+p_e:o,n)}const m_e=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function g_e(t,e={}){const{strict:n=!1}=e;if(!t)throw new h7(t);if(typeof t!="string")throw new h7(t);if(n&&!/^0x[0-9a-fA-F]*$/.test(t))throw new f7(t);if(!t.startsWith("0x"))throw new f7(t)}function y_e(...t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function pD(t){return t instanceof Uint8Array?PA(t):Array.isArray(t)?PA(new Uint8Array(t)):t}function PA(t,e={}){let n="";for(let o=0;o<t.length;o++)n+=m_e[t[o]];const i=`0x${n}`;return typeof e.size=="number"?(mq(i,e.size),yq(i,e.size)):i}function PP(t,e={}){const{signed:n,size:i}=e,o=BigInt(t);let l;i?n?l=(1n<<BigInt(i)*8n-1n)-1n:l=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(l=BigInt(Number.MAX_SAFE_INTEGER));const h=typeof l=="bigint"&&n?-l-1n:0;if(l&&o>l||o<h){const x=typeof t=="bigint"?"n":"";throw new b_e({max:l?`${l}${x}`:void 0,min:`${h}${x}`,signed:n,size:i,value:`${t}${x}`})}const w=`0x${(n&&o<0?(1n<<BigInt(i*8))+BigInt(o):o).toString(16)}`;return i?__e(w,i):w}function __e(t,e){return gq(t,{dir:"left",size:e})}function yq(t,e){return gq(t,{dir:"right",size:e})}function If(t,e,n,i={}){const{strict:o}=i;h_e(t,e);const l=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return o&&f_e(l,e,n),l}function Fm(t){return Math.ceil((t.length-2)/2)}function w_e(t,e={}){const{strict:n=!1}=e;try{return g_e(t,{strict:n}),!0}catch{return!1}}class b_e extends ao{constructor({max:e,min:n,signed:i,size:o,value:l}){super(`Number \`${l}\` is not in safe${o?` ${o*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${n}\` to \`${e}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class h7 extends ao{constructor(e){super(`Value \`${typeof e=="object"?fD(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class f7 extends ao{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let v_e=class extends ao{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class _q extends ao{constructor({offset:e,position:n,size:i}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let x_e=class extends ao{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const E_e=new TextEncoder;function C_e(t){if(!(t instanceof Uint8Array)){if(!t)throw new iT(t);if(typeof t!="object")throw new iT(t);if(!("BYTES_PER_ELEMENT"in t))throw new iT(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new iT(t)}}function T_e(t){return t instanceof Uint8Array?t:typeof t=="string"?S_e(t):A_e(t)}function A_e(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function S_e(t,e={}){const{size:n}=e;let i=t;n&&(mq(t,n),i=yq(t,n));let o=i.slice(2);o.length%2&&(o=`0${o}`);const l=o.length/2,h=new Uint8Array(l);for(let s=0,w=0;s<l;s++){const x=d7(o.charCodeAt(w++)),A=d7(o.charCodeAt(w++));if(x===void 0||A===void 0)throw new ao(`Invalid byte sequence ("${o[w-2]}${o[w-1]}" in "${o}").`);h[s]=x*16+A}return h}function I_e(t,e={}){const{size:n}=e,i=E_e.encode(t);return typeof n=="number"?(u_e(i,n),P_e(i,n)):i}function P_e(t,e){return d_e(t,{dir:"right",size:e})}function p7(t){return t.length}function R_e(t){try{return C_e(t),!0}catch{return!1}}class iT extends ao{constructor(e){super(`Value \`${typeof e=="object"?fD(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class O_e extends ao{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class k_e extends ao{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function wq(t,e={}){const{as:n=typeof t=="string"?"Hex":"Bytes"}=e,i=GW(T_e(t));return n==="Bytes"?i:PA(i)}class D_e extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const N_e={checksum:new D_e(8192)},RP=N_e.checksum;function bq(t,e={}){const{compressed:n}=e,{prefix:i,x:o,y:l}=t;if(n===!1||typeof o=="bigint"&&typeof l=="bigint"){if(i!==4)throw new m7({prefix:i,cause:new z_e});return}if(n===!0||typeof o=="bigint"&&typeof l>"u"){if(i!==3&&i!==2)throw new m7({prefix:i,cause:new $_e});return}throw new F_e({publicKey:t})}function M_e(t){const e=(()=>{if(w_e(t))return vq(t);if(R_e(t))return L_e(t);const{prefix:n,x:i,y:o}=t;return typeof i=="bigint"&&typeof o=="bigint"?{prefix:n??4,x:i,y:o}:{prefix:n,x:i}})();return bq(e),e}function L_e(t){return vq(PA(t))}function vq(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new U_e({publicKey:t});if(t.length===130){const i=BigInt(If(t,0,32)),o=BigInt(If(t,32,64));return{prefix:4,x:i,y:o}}if(t.length===132){const i=Number(If(t,0,1)),o=BigInt(If(t,1,33)),l=BigInt(If(t,33,65));return{prefix:i,x:o,y:l}}const e=Number(If(t,0,1)),n=BigInt(If(t,1,33));return{prefix:e,x:n}}function B_e(t,e={}){bq(t);const{prefix:n,x:i,y:o}=t,{includePrefix:l=!0}=e;return y_e(l?PP(n,{size:1}):"0x",PP(i,{size:32}),typeof o=="bigint"?PP(o,{size:32}):"0x")}class F_e extends ao{constructor({publicKey:e}){super(`Value \`${fD(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class m7 extends ao{constructor({prefix:e,cause:n}){super(`Prefix "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class $_e extends ao{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class z_e extends ao{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let U_e=class extends ao{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Fm(pD(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const j_e=/^0x[a-fA-F0-9]{40}$/;function xq(t,e={}){const{strict:n=!0}=e;if(!j_e.test(t))throw new g7({address:t,cause:new H_e});if(n){if(t.toLowerCase()===t)return;if(Eq(t)!==t)throw new g7({address:t,cause:new G_e})}}function Eq(t){if(RP.has(t))return RP.get(t);xq(t,{strict:!1});const e=t.substring(2).toLowerCase(),n=wq(I_e(e),{as:"Bytes"}),i=e.split("");for(let l=0;l<40;l+=2)n[l>>1]>>4>=8&&i[l]&&(i[l]=i[l].toUpperCase()),(n[l>>1]&15)>=8&&i[l+1]&&(i[l+1]=i[l+1].toUpperCase());const o=`0x${i.join("")}`;return RP.set(t,o),o}function V_e(t,e={}){const{checksum:n=!1}=e;return xq(t),n?Eq(t):t}function W_e(t,e={}){const n=wq(`0x${B_e(t).slice(4)}`).substring(26);return V_e(`0x${n}`,e)}class g7 extends ao{constructor({address:e,cause:n}){super(`Address "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class H_e extends ao{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class G_e extends ao{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function q_e(t){if(t.length!==130&&t.length!==132)throw new K_e({signature:t});const e=BigInt(If(t,0,32)),n=BigInt(If(t,32,64)),i=(()=>{const o=+`0x${t.slice(130)}`;if(!Number.isNaN(o))try{return Z_e(o)}catch{throw new Y_e({value:o})}})();return typeof i>"u"?{r:e,s:n}:{r:e,s:n,yParity:i}}function Z_e(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new X_e({value:t})}class K_e extends ao{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Fm(pD(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class Y_e extends ao{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class X_e extends ao{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function J_e(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Cq(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function RA(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function mD(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function B8(t){if(!Array.isArray(t))throw new Error("array expected")}function OA(t,e){if(!Cq(!0,e))throw new Error(`${t}: array of strings expected`)}function Q_e(t,e){if(!Cq(!1,e))throw new Error(`${t}: array of numbers expected`)}function e1e(...t){const e=l=>l,n=(l,h)=>s=>l(h(s)),i=t.map(l=>l.encode).reduceRight(n,e),o=t.map(l=>l.decode).reduce(n,e);return{encode:i,decode:o}}function t1e(t){const e=typeof t=="string"?t.split(""):t,n=e.length;OA("alphabet",e);const i=new Map(e.map((o,l)=>[o,l]));return{encode:o=>(B8(o),o.map(l=>{if(!Number.isSafeInteger(l)||l<0||l>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${l}". Allowed: ${t}`);return e[l]})),decode:o=>(B8(o),o.map(l=>{RA("alphabet.decode",l);const h=i.get(l);if(h===void 0)throw new Error(`Unknown letter: "${l}". Allowed: ${t}`);return h}))}}function n1e(t=""){return RA("join",t),{encode:e=>(OA("join.decode",e),e.join(t)),decode:e=>(RA("join.decode",e),e.split(t))}}function i1e(t,e="="){return mD(t),RA("padding",e),{encode(n){for(OA("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){OA("padding.decode",n);let i=n.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&n[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,i)}}}const Tq=(t,e)=>e===0?t:Tq(e,t%e),kA=(t,e)=>t+(e-Tq(t,e)),OP=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function y7(t,e,n,i){if(B8(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(kA(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${kA(e,n)}`);let o=0,l=0;const h=OP[e],s=OP[n]-1,w=[];for(const x of t){if(mD(x),x>=h)throw new Error(`convertRadix2: invalid data word=${x} from=${e}`);if(o=o<<e|x,l+e>32)throw new Error(`convertRadix2: carry overflow pos=${l} from=${e}`);for(l+=e;l>=n;l-=n)w.push((o>>l-n&s)>>>0);const A=OP[l];if(A===void 0)throw new Error("invalid carry");o&=A-1}if(o=o<<n-l&s,!i&&l>=e)throw new Error("Excess padding");if(!i&&o>0)throw new Error(`Non-zero padding: ${o}`);return i&&l>0&&w.push(o>>>0),w}function r1e(t,e=!1){if(mD(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(kA(8,t)>32||kA(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!J_e(n))throw new Error("radix2.encode input should be Uint8Array");return y7(Array.from(n),8,t,!e)},decode:n=>(Q_e("radix2.decode",n),Uint8Array.from(y7(n,t,8,e)))}}const s1e=e1e(r1e(5),t1e("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),i1e(5),n1e(""));function o1e(t){return W_e(a1e(t))}function a1e(t){const{payload:e,signature:n}=t,{r:i,s:o,yParity:l}=n,s=new yG.Signature(BigInt(i),BigInt(o)).addRecoveryBit(l).recoverPublicKey(pD(e).substring(2));return M_e(s)}var Aq={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function o(w,x,A){this.fn=w,this.context=x,this.once=A||!1}function l(w,x,A,P,D){if(typeof A!="function")throw new TypeError("The listener must be a function");var M=new o(A,P||w,D),z=n?n+x:x;return w._events[z]?w._events[z].fn?w._events[z]=[w._events[z],M]:w._events[z].push(M):(w._events[z]=M,w._eventsCount++),w}function h(w,x){--w._eventsCount===0?w._events=new i:delete w._events[x]}function s(){this._events=new i,this._eventsCount=0}s.prototype.eventNames=function(){var x=[],A,P;if(this._eventsCount===0)return x;for(P in A=this._events)e.call(A,P)&&x.push(n?P.slice(1):P);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(A)):x},s.prototype.listeners=function(x){var A=n?n+x:x,P=this._events[A];if(!P)return[];if(P.fn)return[P.fn];for(var D=0,M=P.length,z=new Array(M);D<M;D++)z[D]=P[D].fn;return z},s.prototype.listenerCount=function(x){var A=n?n+x:x,P=this._events[A];return P?P.fn?1:P.length:0},s.prototype.emit=function(x,A,P,D,M,z){var U=n?n+x:x;if(!this._events[U])return!1;var G=this._events[U],ne=arguments.length,oe,Q;if(G.fn){switch(G.once&&this.removeListener(x,G.fn,void 0,!0),ne){case 1:return G.fn.call(G.context),!0;case 2:return G.fn.call(G.context,A),!0;case 3:return G.fn.call(G.context,A,P),!0;case 4:return G.fn.call(G.context,A,P,D),!0;case 5:return G.fn.call(G.context,A,P,D,M),!0;case 6:return G.fn.call(G.context,A,P,D,M,z),!0}for(Q=1,oe=new Array(ne-1);Q<ne;Q++)oe[Q-1]=arguments[Q];G.fn.apply(G.context,oe)}else{var de=G.length,he;for(Q=0;Q<de;Q++)switch(G[Q].once&&this.removeListener(x,G[Q].fn,void 0,!0),ne){case 1:G[Q].fn.call(G[Q].context);break;case 2:G[Q].fn.call(G[Q].context,A);break;case 3:G[Q].fn.call(G[Q].context,A,P);break;case 4:G[Q].fn.call(G[Q].context,A,P,D);break;default:if(!oe)for(he=1,oe=new Array(ne-1);he<ne;he++)oe[he-1]=arguments[he];G[Q].fn.apply(G[Q].context,oe)}}return!0},s.prototype.on=function(x,A,P){return l(this,x,A,P,!1)},s.prototype.once=function(x,A,P){return l(this,x,A,P,!0)},s.prototype.removeListener=function(x,A,P,D){var M=n?n+x:x;if(!this._events[M])return this;if(!A)return h(this,M),this;var z=this._events[M];if(z.fn)z.fn===A&&(!D||z.once)&&(!P||z.context===P)&&h(this,M);else{for(var U=0,G=[],ne=z.length;U<ne;U++)(z[U].fn!==A||D&&!z[U].once||P&&z[U].context!==P)&&G.push(z[U]);G.length?this._events[M]=G.length===1?G[0]:G:h(this,M)}return this},s.prototype.removeAllListeners=function(x){var A;return x?(A=n?n+x:x,this._events[A]&&h(this,A)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s})(Aq);var c1e=Aq.exports;const l1e=Zm(c1e);function u1e(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let x=0;x<e.length;x++)e[x]=255;for(let x=0;x<t.length;x++){const A=t.charAt(x),P=A.charCodeAt(0);if(e[P]!==255)throw new TypeError(A+" is ambiguous");e[P]=x}const n=t.length,i=t.charAt(0),o=Math.log(n)/Math.log(256),l=Math.log(256)/Math.log(n);function h(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";let A=0,P=0,D=0;const M=x.length;for(;D!==M&&x[D]===0;)D++,A++;const z=(M-D)*l+1>>>0,U=new Uint8Array(z);for(;D!==M;){let oe=x[D],Q=0;for(let de=z-1;(oe!==0||Q<P)&&de!==-1;de--,Q++)oe+=256*U[de]>>>0,U[de]=oe%n>>>0,oe=oe/n>>>0;if(oe!==0)throw new Error("Non-zero carry");P=Q,D++}let G=z-P;for(;G!==z&&U[G]===0;)G++;let ne=i.repeat(A);for(;G<z;++G)ne+=t.charAt(U[G]);return ne}function s(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;let A=0,P=0,D=0;for(;x[A]===i;)P++,A++;const M=(x.length-A)*o+1>>>0,z=new Uint8Array(M);for(;A<x.length;){const oe=x.charCodeAt(A);if(oe>255)return;let Q=e[oe];if(Q===255)return;let de=0;for(let he=M-1;(Q!==0||de<D)&&he!==-1;he--,de++)Q+=n*z[he]>>>0,z[he]=Q%256>>>0,Q=Q/256>>>0;if(Q!==0)throw new Error("Non-zero carry");D=de,A++}let U=M-D;for(;U!==M&&z[U]===0;)U++;const G=new Uint8Array(P+(M-U));let ne=P;for(;U!==M;)G[ne++]=z[U++];return G}function w(x){const A=s(x);if(A)return A;throw new Error("Non-base"+n+" character")}return{encode:h,decodeUnsafe:s,decode:w}}var d1e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Lw=u1e(d1e);function h1e(t){const e=t.length;let n=0,i=0;for(;i<e;){let o=t.charCodeAt(i++);if(o&4294967168)if(!(o&4294965248))n+=2;else{if(o>=55296&&o<=56319&&i<e){const l=t.charCodeAt(i);(l&64512)===56320&&(++i,o=((o&1023)<<10)+(l&1023)+65536)}o&4294901760?n+=4:n+=3}else{n++;continue}}return n}function f1e(t,e,n){const i=t.length;let o=n,l=0;for(;l<i;){let h=t.charCodeAt(l++);if(h&4294967168)if(!(h&4294965248))e[o++]=h>>6&31|192;else{if(h>=55296&&h<=56319&&l<i){const s=t.charCodeAt(l);(s&64512)===56320&&(++l,h=((h&1023)<<10)+(s&1023)+65536)}h&4294901760?(e[o++]=h>>18&7|240,e[o++]=h>>12&63|128,e[o++]=h>>6&63|128):(e[o++]=h>>12&15|224,e[o++]=h>>6&63|128)}else{e[o++]=h;continue}e[o++]=h&63|128}}const p1e=new TextEncoder,m1e=50;function g1e(t,e,n){p1e.encodeInto(t,e.subarray(n))}function y1e(t,e,n){t.length>m1e?g1e(t,e,n):f1e(t,e,n)}const _1e=4096;function Sq(t,e,n){let i=e;const o=i+n,l=[];let h="";for(;i<o;){const s=t[i++];if(!(s&128))l.push(s);else if((s&224)===192){const w=t[i++]&63;l.push((s&31)<<6|w)}else if((s&240)===224){const w=t[i++]&63,x=t[i++]&63;l.push((s&31)<<12|w<<6|x)}else if((s&248)===240){const w=t[i++]&63,x=t[i++]&63,A=t[i++]&63;let P=(s&7)<<18|w<<12|x<<6|A;P>65535&&(P-=65536,l.push(P>>>10&1023|55296),P=56320|P&1023),l.push(P)}else l.push(s);l.length>=_1e&&(h+=String.fromCharCode(...l),l.length=0)}return l.length>0&&(h+=String.fromCharCode(...l)),h}const w1e=new TextDecoder,b1e=200;function v1e(t,e,n){const i=t.subarray(e,e+n);return w1e.decode(i)}function x1e(t,e,n){return n>b1e?v1e(t,e,n):Sq(t,e,n)}class rT{constructor(e,n){this.type=e,this.data=n}}class Dl extends Error{constructor(e){super(e);const n=Object.create(Dl.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:Dl.name})}}const px=4294967295;function E1e(t,e,n){const i=n/4294967296,o=n;t.setUint32(e,i),t.setUint32(e+4,o)}function Iq(t,e,n){const i=Math.floor(n/4294967296),o=n;t.setUint32(e,i),t.setUint32(e+4,o)}function Pq(t,e){const n=t.getInt32(e),i=t.getUint32(e+4);return n*4294967296+i}function C1e(t,e){const n=t.getUint32(e),i=t.getUint32(e+4);return n*4294967296+i}const T1e=-1,A1e=4294967296-1,S1e=17179869184-1;function I1e({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=S1e)if(e===0&&t<=A1e){const n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t),n}else{const n=t/4294967296,i=t&4294967295,o=new Uint8Array(8),l=new DataView(o.buffer);return l.setUint32(0,e<<2|n&3),l.setUint32(4,i),o}else{const n=new Uint8Array(12),i=new DataView(n.buffer);return i.setUint32(0,e),Iq(i,4,t),n}}function P1e(t){const e=t.getTime(),n=Math.floor(e/1e3),i=(e-n*1e3)*1e6,o=Math.floor(i/1e9);return{sec:n+o,nsec:i-o*1e9}}function R1e(t){if(t instanceof Date){const e=P1e(t);return I1e(e)}else return null}function O1e(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const n=e.getUint32(0),i=e.getUint32(4),o=(n&3)*4294967296+i,l=n>>>2;return{sec:o,nsec:l}}case 12:{const n=Pq(e,4),i=e.getUint32(0);return{sec:n,nsec:i}}default:throw new Dl(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function k1e(t){const e=O1e(t);return new Date(e.sec*1e3+e.nsec/1e6)}const D1e={type:T1e,encode:R1e,decode:k1e};class DA{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(D1e)}register({type:e,encode:n,decode:i}){if(e>=0)this.encoders[e]=n,this.decoders[e]=i;else{const o=-1-e;this.builtInEncoders[o]=n,this.builtInDecoders[o]=i}}tryToEncode(e,n){for(let i=0;i<this.builtInEncoders.length;i++){const o=this.builtInEncoders[i];if(o!=null){const l=o(e,n);if(l!=null){const h=-1-i;return new rT(h,l)}}}for(let i=0;i<this.encoders.length;i++){const o=this.encoders[i];if(o!=null){const l=o(e,n);if(l!=null){const h=i;return new rT(h,l)}}}return e instanceof rT?e:null}decode(e,n,i){const o=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return o?o(e,n,i):new rT(n,e)}}DA.defaultCodec=new DA;function N1e(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function F8(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):N1e(t)?new Uint8Array(t):Uint8Array.from(t)}const M1e=100,L1e=2048;let B1e=class Rq{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??DA.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??M1e,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??L1e,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Rq({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,n){if(n>this.maxDepth)throw new Error(`Too deep objects in depth ${n}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)}ensureBufferSizeToWrite(e){const n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)}resizeBuffer(e){const n=new ArrayBuffer(e),i=new Uint8Array(n),o=new DataView(n);i.set(this.bytes),this.view=o,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=h1e(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),y1e(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,n){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error(`Too large binary: ${n}`);const i=F8(e);this.writeU8a(i)}encodeArray(e,n){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const o of e)this.doEncode(o,n+1)}countWithoutUndefined(e,n){let i=0;for(const o of n)e[o]!==void 0&&i++;return i}encodeMap(e,n){const i=Object.keys(e);this.sortKeys&&i.sort();const o=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(o<16)this.writeU8(128+o);else if(o<65536)this.writeU8(222),this.writeU16(o);else if(o<4294967296)this.writeU8(223),this.writeU32(o);else throw new Error(`Too large map object: ${o}`);for(const l of i){const h=e[l];this.ignoreUndefined&&h===void 0||(this.encodeString(l),this.doEncode(h,n+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),o=i.length;if(o>=4294967296)throw new Error(`Too large extension object: ${o}`);this.writeU8(201),this.writeU32(o),this.writeI8(e.type),this.writeU8a(i);return}const n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error(`Too large extension object: ${n}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),E1e(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Iq(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function F1e(t,e){return new B1e(e).encodeSharedRef(t)}function kP(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const $1e=16,z1e=16;class U1e{constructor(e=$1e,n=z1e){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=n,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,n,i){const o=this.caches[i-1];e:for(const l of o){const h=l.bytes;for(let s=0;s<i;s++)if(h[s]!==e[n+s])continue e;return l.str}return null}store(e,n){const i=this.caches[e.length-1],o={bytes:e,str:n};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=o:i.push(o)}decode(e,n,i){const o=this.find(e,n,i);if(o!=null)return this.hit++,o;this.miss++;const l=Sq(e,n,i),h=Uint8Array.prototype.slice.call(e,n,n+i);return this.store(h,l),l}}const $8="array",zx="map_key",Oq="map_value",j1e=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new Dl("The type of key must be string or number but "+typeof t)};class V1e{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const n=this.getUninitializedStateFromPool();n.type=$8,n.position=0,n.size=e,n.array=new Array(e)}pushMapState(e){const n=this.getUninitializedStateFromPool();n.type=zx,n.readCount=0,n.size=e,n.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===$8){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===zx||e.type===Oq){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const mx=-1,gD=new DataView(new ArrayBuffer(0)),W1e=new Uint8Array(gD.buffer);try{gD.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const _7=new RangeError("Insufficient data"),H1e=new U1e;let G1e=class kq{constructor(e){this.totalPos=0,this.pos=0,this.view=gD,this.bytes=W1e,this.headByte=mx,this.stack=new V1e,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??DA.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??px,this.maxBinLength=(e==null?void 0:e.maxBinLength)??px,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??px,this.maxMapLength=(e==null?void 0:e.maxMapLength)??px,this.maxExtLength=(e==null?void 0:e.maxExtLength)??px,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:H1e,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??j1e}clone(){return new kq({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=mx,this.stack.reset()}setBuffer(e){const n=F8(e);this.bytes=n,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===mx&&!this.hasRemaining(1))this.setBuffer(e);else{const n=this.bytes.subarray(this.pos),i=F8(e),o=new Uint8Array(n.length+i.length);o.set(n),o.set(i,n.length),this.setBuffer(o)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:n,pos:i}=this;return new RangeError(`Extra ${n.byteLength-i} of ${n.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let n=!1,i;for await(const s of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(s);try{i=this.doDecodeSync(),n=!0}catch(w){if(!(w instanceof RangeError))throw w}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:o,pos:l,totalPos:h}=this;throw new RangeError(`Insufficient data in parsing ${kP(o)} at ${h} (${l} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,n){if(this.entered){yield*this.clone().decodeMultiAsync(e,n);return}try{this.entered=!0;let i=n,o=-1;for await(const l of e){if(n&&o===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(l),i&&(o=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--o!==0;);}catch(h){if(!(h instanceof RangeError))throw h}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let n;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){const o=e-128;if(o!==0){this.pushMapState(o),this.complete();continue e}else n={}}else if(e<160){const o=e-144;if(o!==0){this.pushArrayState(o),this.complete();continue e}else n=[]}else{const o=e-160;n=this.decodeString(o,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){const o=this.lookU8();n=this.decodeString(o,1)}else if(e===218){const o=this.lookU16();n=this.decodeString(o,2)}else if(e===219){const o=this.lookU32();n=this.decodeString(o,4)}else if(e===220){const o=this.readU16();if(o!==0){this.pushArrayState(o),this.complete();continue e}else n=[]}else if(e===221){const o=this.readU32();if(o!==0){this.pushArrayState(o),this.complete();continue e}else n=[]}else if(e===222){const o=this.readU16();if(o!==0){this.pushMapState(o),this.complete();continue e}else n={}}else if(e===223){const o=this.readU32();if(o!==0){this.pushMapState(o),this.complete();continue e}else n={}}else if(e===196){const o=this.lookU8();n=this.decodeBinary(o,1)}else if(e===197){const o=this.lookU16();n=this.decodeBinary(o,2)}else if(e===198){const o=this.lookU32();n=this.decodeBinary(o,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){const o=this.lookU8();n=this.decodeExtension(o,1)}else if(e===200){const o=this.lookU16();n=this.decodeExtension(o,2)}else if(e===201){const o=this.lookU32();n=this.decodeExtension(o,4)}else throw new Dl(`Unrecognized type byte: ${kP(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const o=i.top();if(o.type===$8)if(o.array[o.position]=n,o.position++,o.position===o.size)n=o.array,i.release(o);else continue e;else if(o.type===zx){if(n==="__proto__")throw new Dl("The key __proto__ is not allowed");o.key=this.mapKeyConverter(n),o.type=Oq;continue e}else if(o.map[o.key]=n,o.readCount++,o.readCount===o.size)n=o.map,i.release(o);else{o.key=null,o.type=zx;continue e}}return n}}readHeadByte(){return this.headByte===mx&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=mx}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Dl(`Unrecognized array type byte: ${kP(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Dl(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Dl(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,n){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,n):this.decodeBinary(e,n)}decodeUtf8String(e,n){var l;if(e>this.maxStrLength)throw new Dl(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+n+e)throw _7;const i=this.pos+n;let o;return this.stateIsMapKey()&&((l=this.keyDecoder)!=null&&l.canBeCached(e))?o=this.keyDecoder.decode(this.bytes,i,e):o=x1e(this.bytes,i,e),this.pos+=n+e,o}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===zx:!1}decodeBinary(e,n){if(e>this.maxBinLength)throw new Dl(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+n))throw _7;const i=this.pos+n,o=this.bytes.subarray(i,i+e);return this.pos+=n+e,o}decodeExtension(e,n){if(e>this.maxExtLength)throw new Dl(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+n),o=this.decodeBinary(e,n+1);return this.extensionCodec.decode(o,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=C1e(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Pq(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function q1e(t,e){return new G1e(e).decode(t)}function yD(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Dq(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?yD(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ux(t,e){e||(e=t.reduce((o,l)=>o+l.length,0));const n=Dq(e);let i=0;for(const o of t)n.set(o,i),i+=o.length;return yD(n)}function Z1e(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var o=0;o<t.length;o++){var l=t.charAt(o),h=l.charCodeAt(0);if(n[h]!==255)throw new TypeError(l+" is ambiguous");n[h]=o}var s=t.length,w=t.charAt(0),x=Math.log(s)/Math.log(256),A=Math.log(256)/Math.log(s);function P(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var U=0,G=0,ne=0,oe=z.length;ne!==oe&&z[ne]===0;)ne++,U++;for(var Q=(oe-ne)*A+1>>>0,de=new Uint8Array(Q);ne!==oe;){for(var he=z[ne],Ie=0,ke=Q-1;(he!==0||Ie<G)&&ke!==-1;ke--,Ie++)he+=256*de[ke]>>>0,de[ke]=he%s>>>0,he=he/s>>>0;if(he!==0)throw new Error("Non-zero carry");G=Ie,ne++}for(var Ue=Q-G;Ue!==Q&&de[Ue]===0;)Ue++;for(var ze=w.repeat(U);Ue<Q;++Ue)ze+=t.charAt(de[Ue]);return ze}function D(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var U=0;if(z[U]!==" "){for(var G=0,ne=0;z[U]===w;)G++,U++;for(var oe=(z.length-U)*x+1>>>0,Q=new Uint8Array(oe);z[U];){var de=n[z.charCodeAt(U)];if(de===255)return;for(var he=0,Ie=oe-1;(de!==0||he<ne)&&Ie!==-1;Ie--,he++)de+=s*Q[Ie]>>>0,Q[Ie]=de%256>>>0,de=de/256>>>0;if(de!==0)throw new Error("Non-zero carry");ne=he,U++}if(z[U]!==" "){for(var ke=oe-ne;ke!==oe&&Q[ke]===0;)ke++;for(var Ue=new Uint8Array(G+(oe-ke)),ze=G;ke!==oe;)Ue[ze++]=Q[ke++];return Ue}}}function M(z){var U=D(z);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:P,decodeUnsafe:D,decode:M}}var K1e=Z1e,Y1e=K1e;const X1e=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},J1e=t=>new TextEncoder().encode(t),Q1e=t=>new TextDecoder().decode(t);class ewe{constructor(e,n,i){this.name=e,this.prefix=n,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class twe{constructor(e,n,i){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Nq(this,e)}}class nwe{constructor(e){this.decoders=e}or(e){return Nq(this,e)}decode(e){const n=e[0],i=this.decoders[n];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Nq=(t,e)=>new nwe({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class iwe{constructor(e,n,i,o){this.name=e,this.prefix=n,this.baseEncode=i,this.baseDecode=o,this.encoder=new ewe(e,n,i),this.decoder=new twe(e,n,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const KS=({name:t,prefix:e,encode:n,decode:i})=>new iwe(t,e,n,i),kE=({prefix:t,name:e,alphabet:n})=>{const{encode:i,decode:o}=Y1e(n,e);return KS({prefix:t,name:e,encode:i,decode:l=>X1e(o(l))})},rwe=(t,e,n,i)=>{const o={};for(let A=0;A<e.length;++A)o[e[A]]=A;let l=t.length;for(;t[l-1]==="=";)--l;const h=new Uint8Array(l*n/8|0);let s=0,w=0,x=0;for(let A=0;A<l;++A){const P=o[t[A]];if(P===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<n|P,s+=n,s>=8&&(s-=8,h[x++]=255&w>>s)}if(s>=n||255&w<<8-s)throw new SyntaxError("Unexpected end of data");return h},swe=(t,e,n)=>{const i=e[e.length-1]==="=",o=(1<<n)-1;let l="",h=0,s=0;for(let w=0;w<t.length;++w)for(s=s<<8|t[w],h+=8;h>n;)h-=n,l+=e[o&s>>h];if(h&&(l+=e[o&s<<n-h]),i)for(;l.length*n&7;)l+="=";return l},Ia=({name:t,prefix:e,bitsPerChar:n,alphabet:i})=>KS({prefix:e,name:t,encode(o){return swe(o,i,n)},decode(o){return rwe(o,i,n,t)}}),owe=KS({prefix:"\0",name:"identity",encode:t=>Q1e(t),decode:t=>J1e(t)}),awe=Object.freeze(Object.defineProperty({__proto__:null,identity:owe},Symbol.toStringTag,{value:"Module"})),cwe=Ia({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),lwe=Object.freeze(Object.defineProperty({__proto__:null,base2:cwe},Symbol.toStringTag,{value:"Module"})),uwe=Ia({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),dwe=Object.freeze(Object.defineProperty({__proto__:null,base8:uwe},Symbol.toStringTag,{value:"Module"})),hwe=kE({prefix:"9",name:"base10",alphabet:"0123456789"}),fwe=Object.freeze(Object.defineProperty({__proto__:null,base10:hwe},Symbol.toStringTag,{value:"Module"})),pwe=Ia({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mwe=Ia({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),gwe=Object.freeze(Object.defineProperty({__proto__:null,base16:pwe,base16upper:mwe},Symbol.toStringTag,{value:"Module"})),ywe=Ia({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_we=Ia({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wwe=Ia({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bwe=Ia({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vwe=Ia({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xwe=Ia({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ewe=Ia({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Cwe=Ia({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Twe=Ia({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Awe=Object.freeze(Object.defineProperty({__proto__:null,base32:ywe,base32hex:vwe,base32hexpad:Ewe,base32hexpadupper:Cwe,base32hexupper:xwe,base32pad:wwe,base32padupper:bwe,base32upper:_we,base32z:Twe},Symbol.toStringTag,{value:"Module"})),Swe=kE({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Iwe=kE({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Pwe=Object.freeze(Object.defineProperty({__proto__:null,base36:Swe,base36upper:Iwe},Symbol.toStringTag,{value:"Module"})),Rwe=kE({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Owe=kE({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),kwe=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Rwe,base58flickr:Owe},Symbol.toStringTag,{value:"Module"})),Dwe=Ia({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Nwe=Ia({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mwe=Ia({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Lwe=Ia({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Bwe=Object.freeze(Object.defineProperty({__proto__:null,base64:Dwe,base64pad:Nwe,base64url:Mwe,base64urlpad:Lwe},Symbol.toStringTag,{value:"Module"})),Mq=Array.from(""),Fwe=Mq.reduce((t,e,n)=>(t[n]=e,t),[]),$we=Mq.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function zwe(t){return t.reduce((e,n)=>(e+=Fwe[n],e),"")}function Uwe(t){const e=[];for(const n of t){const i=$we[n.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(i)}return new Uint8Array(e)}const jwe=KS({prefix:"",name:"base256emoji",encode:zwe,decode:Uwe}),Vwe=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:jwe},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const w7={...awe,...lwe,...dwe,...fwe,...gwe,...Awe,...Pwe,...kwe,...Bwe,...Vwe};function Lq(t,e,n,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:i}}}const b7=Lq("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),DP=Lq("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=Dq(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Bq={utf8:b7,"utf-8":b7,hex:w7.base16,latin1:DP,ascii:DP,binary:DP,...w7};function xu(t,e="utf8"){const n=Bq[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?yD(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function ol(t,e="utf8"){const n=Bq[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}const Wwe={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},Hwe="Input must be an string, Buffer or Uint8Array";function Gwe(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(Hwe);return e}function qwe(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function sT(t){return(4294967296+t).toString(16).substring(1)}function Zwe(t,e,n){let i=`
`+t+" = ";for(let o=0;o<e.length;o+=2){if(n===32)i+=sT(e[o]).toUpperCase(),i+=" ",i+=sT(e[o+1]).toUpperCase();else if(n===64)i+=sT(e[o+1]).toUpperCase(),i+=sT(e[o]).toUpperCase();else throw new Error("Invalid size "+n);o%6===4?i+=`
`+new Array(t.length+4).join(" "):o<e.length-2&&(i+=" ")}console.log(i)}function Kwe(t,e,n){let i=new Date().getTime();const o=new Uint8Array(e);for(let h=0;h<e;h++)o[h]=h%256;const l=new Date().getTime();console.log("Generated random input in "+(l-i)+"ms"),i=l;for(let h=0;h<n;h++){const s=t(o),w=new Date().getTime(),x=w-i;i=w,console.log("Hashed in "+x+"ms: "+s.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(x/1e3)*100)/100+" MB PER SECOND")}}var Fq={normalizeInput:Gwe,toHex:qwe,debugPrint:Zwe,testSpeed:Kwe};const UT=Fq;function oT(t,e,n){const i=t[e]+t[n];let o=t[e+1]+t[n+1];i>=4294967296&&o++,t[e]=i,t[e+1]=o}function v7(t,e,n,i){let o=t[e]+n;n<0&&(o+=4294967296);let l=t[e+1]+i;o>=4294967296&&l++,t[e]=o,t[e+1]=l}function $q(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Kp(t,e,n,i,o,l){const h=kx[o],s=kx[o+1],w=kx[l],x=kx[l+1];oT(Gi,t,e),v7(Gi,t,h,s);let A=Gi[i]^Gi[t],P=Gi[i+1]^Gi[t+1];Gi[i]=P,Gi[i+1]=A,oT(Gi,n,i),A=Gi[e]^Gi[n],P=Gi[e+1]^Gi[n+1],Gi[e]=A>>>24^P<<8,Gi[e+1]=P>>>24^A<<8,oT(Gi,t,e),v7(Gi,t,w,x),A=Gi[i]^Gi[t],P=Gi[i+1]^Gi[t+1],Gi[i]=A>>>16^P<<16,Gi[i+1]=P>>>16^A<<16,oT(Gi,n,i),A=Gi[e]^Gi[n],P=Gi[e+1]^Gi[n+1],Gi[e]=P>>>31^A<<1,Gi[e+1]=A>>>31^P<<1}const zq=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Ywe=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Va=new Uint8Array(Ywe.map(function(t){return t*2})),Gi=new Uint32Array(32),kx=new Uint32Array(32);function Uq(t,e){let n=0;for(n=0;n<16;n++)Gi[n]=t.h[n],Gi[n+16]=zq[n];for(Gi[24]=Gi[24]^t.t,Gi[25]=Gi[25]^t.t/4294967296,e&&(Gi[28]=~Gi[28],Gi[29]=~Gi[29]),n=0;n<32;n++)kx[n]=$q(t.b,4*n);for(n=0;n<12;n++)Kp(0,8,16,24,Va[n*16+0],Va[n*16+1]),Kp(2,10,18,26,Va[n*16+2],Va[n*16+3]),Kp(4,12,20,28,Va[n*16+4],Va[n*16+5]),Kp(6,14,22,30,Va[n*16+6],Va[n*16+7]),Kp(0,10,20,30,Va[n*16+8],Va[n*16+9]),Kp(2,12,22,24,Va[n*16+10],Va[n*16+11]),Kp(4,14,16,26,Va[n*16+12],Va[n*16+13]),Kp(6,8,18,28,Va[n*16+14],Va[n*16+15]);for(n=0;n<16;n++)t.h[n]=t.h[n]^Gi[n]^Gi[n+16]}const Yp=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function jq(t,e,n,i){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(n&&n.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(i&&i.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const o={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};Yp.fill(0),Yp[0]=t,e&&(Yp[1]=e.length),Yp[2]=1,Yp[3]=1,n&&Yp.set(n,32),i&&Yp.set(i,48);for(let l=0;l<16;l++)o.h[l]=zq[l]^$q(Yp,l*4);return e&&(_D(o,e),o.c=128),o}function _D(t,e){for(let n=0;n<e.length;n++)t.c===128&&(t.t+=t.c,Uq(t,!1),t.c=0),t.b[t.c++]=e[n]}function Vq(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;Uq(t,!0);const e=new Uint8Array(t.outlen);for(let n=0;n<t.outlen;n++)e[n]=t.h[n>>2]>>8*(n&3);return e}function Wq(t,e,n,i,o){n=n||64,t=UT.normalizeInput(t),i&&(i=UT.normalizeInput(i)),o&&(o=UT.normalizeInput(o));const l=jq(n,e,i,o);return _D(l,t),Vq(l)}function Xwe(t,e,n,i,o){const l=Wq(t,e,n,i,o);return UT.toHex(l)}var Jwe={blake2b:Wq,blake2bHex:Xwe,blake2bInit:jq,blake2bUpdate:_D,blake2bFinal:Vq};const Hq=Fq;function Qwe(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Xp(t,e,n,i,o,l){kr[t]=kr[t]+kr[e]+o,kr[i]=aT(kr[i]^kr[t],16),kr[n]=kr[n]+kr[i],kr[e]=aT(kr[e]^kr[n],12),kr[t]=kr[t]+kr[e]+l,kr[i]=aT(kr[i]^kr[t],8),kr[n]=kr[n]+kr[i],kr[e]=aT(kr[e]^kr[n],7)}function aT(t,e){return t>>>e^t<<32-e}const Gq=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Wa=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),kr=new Uint32Array(16),va=new Uint32Array(16);function qq(t,e){let n=0;for(n=0;n<8;n++)kr[n]=t.h[n],kr[n+8]=Gq[n];for(kr[12]^=t.t,kr[13]^=t.t/4294967296,e&&(kr[14]=~kr[14]),n=0;n<16;n++)va[n]=Qwe(t.b,4*n);for(n=0;n<10;n++)Xp(0,4,8,12,va[Wa[n*16+0]],va[Wa[n*16+1]]),Xp(1,5,9,13,va[Wa[n*16+2]],va[Wa[n*16+3]]),Xp(2,6,10,14,va[Wa[n*16+4]],va[Wa[n*16+5]]),Xp(3,7,11,15,va[Wa[n*16+6]],va[Wa[n*16+7]]),Xp(0,5,10,15,va[Wa[n*16+8]],va[Wa[n*16+9]]),Xp(1,6,11,12,va[Wa[n*16+10]],va[Wa[n*16+11]]),Xp(2,7,8,13,va[Wa[n*16+12]],va[Wa[n*16+13]]),Xp(3,4,9,14,va[Wa[n*16+14]],va[Wa[n*16+15]]);for(n=0;n<8;n++)t.h[n]^=kr[n]^kr[n+8]}function Zq(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const n=e?e.length:0;if(e&&!(n>0&&n<=32))throw new Error("Incorrect key length, should be in [1, 32]");const i={h:new Uint32Array(Gq),b:new Uint8Array(64),c:0,t:0,outlen:t};return i.h[0]^=16842752^n<<8^t,n>0&&(wD(i,e),i.c=64),i}function wD(t,e){for(let n=0;n<e.length;n++)t.c===64&&(t.t+=t.c,qq(t,!1),t.c=0),t.b[t.c++]=e[n]}function Kq(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;qq(t,!0);const e=new Uint8Array(t.outlen);for(let n=0;n<t.outlen;n++)e[n]=t.h[n>>2]>>8*(n&3)&255;return e}function Yq(t,e,n){n=n||32,t=Hq.normalizeInput(t);const i=Zq(n,e);return wD(i,t),Kq(i)}function ebe(t,e,n){const i=Yq(t,e,n);return Hq.toHex(i)}var tbe={blake2s:Yq,blake2sHex:ebe,blake2sInit:Zq,blake2sUpdate:wD,blake2sFinal:Kq};const gx=Jwe,yx=tbe;var nbe={blake2b:gx.blake2b,blake2bHex:gx.blake2bHex,blake2bInit:gx.blake2bInit,blake2bUpdate:gx.blake2bUpdate,blake2bFinal:gx.blake2bFinal,blake2s:yx.blake2s,blake2sHex:yx.blake2sHex,blake2sInit:yx.blake2sInit,blake2sUpdate:yx.blake2sUpdate,blake2sFinal:yx.blake2sFinal},ibe={};const rbe=":";function Ff(t){const[e,n]=t.split(rbe);return{namespace:e,reference:n}}function Xq(t,e){return t.includes(":")?[t]:e.chains||[]}var sbe=Object.defineProperty,obe=Object.defineProperties,abe=Object.getOwnPropertyDescriptors,x7=Object.getOwnPropertySymbols,cbe=Object.prototype.hasOwnProperty,lbe=Object.prototype.propertyIsEnumerable,z8=(t,e,n)=>e in t?sbe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E7=(t,e)=>{for(var n in e||(e={}))cbe.call(e,n)&&z8(t,n,e[n]);if(x7)for(var n of x7(e))lbe.call(e,n)&&z8(t,n,e[n]);return t},ube=(t,e)=>obe(t,abe(e)),C7=(t,e,n)=>z8(t,typeof e!="symbol"?e+"":e,n);const dbe="ReactNative",zl={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},hbe="js";function NA(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ym(){return!ey()&&!!dD()&&navigator.product===dbe}function fbe(){return Ym()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function pbe(){return Ym()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Bw(){return!NA()&&!!dD()&&!!ey()}function DE(){return Ym()?zl.reactNative:NA()?zl.node:Bw()?zl.browser:zl.unknown}function T7(){var t;try{return Ym()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function mbe(t,e){const n=new URLSearchParams(t);return Object.entries(e).sort(([i],[o])=>i.localeCompare(o)).forEach(([i,o])=>{o!=null&&n.set(i,String(o))}),n.toString()}function gbe(t){var e,n;const i=Jq();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(o=>o!=="")),ube(E7(E7({},i),t),{url:(t==null?void 0:t.url)||i.url,name:(t==null?void 0:t.name)||i.name,description:(t==null?void 0:t.description)||i.description,icons:(n=t==null?void 0:t.icons)!=null&&n.length&&t.icons.length>0?t.icons:i.icons})}catch(o){return console.warn("Error populating app metadata",o),t||i}}function Jq(){return fq()||{name:"",description:"",url:"",icons:[""]}}function ybe(){if(DE()===zl.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:i}=global.Platform;return[n,i].join("-")}const t=Hye();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function _be(){var t;const e=DE();return e===zl.browser?[e,((t=hq())==null?void 0:t.host)||"unknown"].join(":"):e}function Qq(t,e,n){const i=ybe(),o=_be();return[[t,e].join("-"),[hbe,n].join("-"),i,o].join("/")}function wbe({protocol:t,version:e,relayUrl:n,sdkVersion:i,auth:o,projectId:l,useOnCloseEvent:h,bundleId:s,packageName:w}){const x=n.split("?"),A=Qq(t,e,i),P={auth:o,ua:A,projectId:l,useOnCloseEvent:h,packageName:w||void 0,bundleId:s||void 0},D=mbe(x[1]||"",P);return x[0]+"?"+D}function S0(t,e){return t.filter(n=>e.includes(n)).length===t.length}function U8(t){return Object.fromEntries(t.entries())}function j8(t){return new Map(Object.entries(t))}function y0(t=vn.FIVE_MINUTES,e){const n=vn.toMiliseconds(t||vn.FIVE_MINUTES);let i,o,l,h;return{resolve:s=>{l&&i&&(clearTimeout(l),i(s),h=Promise.resolve(s))},reject:s=>{l&&o&&(clearTimeout(l),o(s))},done:()=>new Promise((s,w)=>{if(h)return s(h);l=setTimeout(()=>{const x=new Error(e);h=Promise.reject(x),w(x)},n),i=s,o=w})}}function mh(t,e,n){return new Promise(async(i,o)=>{const l=setTimeout(()=>o(new Error(n)),e);try{const h=await t;i(h)}catch(h){o(h)}clearTimeout(l)})}function eZ(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function bbe(t){return eZ("topic",t)}function vbe(t){return eZ("id",t)}function tZ(t){const[e,n]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")i.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))i.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return i}function mo(t,e){return vn.fromMiliseconds(Date.now()+vn.toMiliseconds(t))}function hh(t){return Date.now()>=vn.toMiliseconds(t)}function Hr(t,e){return`${t}${e?`:${e}`:""}`}function wh(t=[],e=[]){return[...new Set([...t,...e])]}async function xbe({id:t,topic:e,wcDeepLink:n}){var i;try{if(!n)return;const o=typeof n=="string"?JSON.parse(n):n,l=o==null?void 0:o.href;if(typeof l!="string")return;const h=Ebe(l,t,e),s=DE();if(s===zl.browser){if(!((i=ey())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Cbe(h)}else s===zl.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(o){console.error(o)}}function Ebe(t,e,n){const i=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let o=`${t}`;if(t.startsWith("https://t.me")){const l=t.includes("?")?"&startapp=":"?startapp=";o=`${o}${l}${Ibe(i,!0)}`}else o=`${o}/wc?${i}`;return o}function Cbe(t){let e="_self";Sbe()?e="_top":(Abe()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Tbe(t,e){let n="";try{if(Bw()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(i){console.error(i)}return n}function A7(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),i=n.indexOf(e);return n[i+2]}function S7(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function bD(){return typeof process<"u"&&ibe.IS_VITEST==="true"}function Abe(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Sbe(){try{return window.self!==window.top}catch{return!1}}function Ibe(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function nZ(t){return Buffer.from(t,"base64").toString("utf-8")}function Pbe(t){return new Promise(e=>setTimeout(e,t))}let Rbe=class{constructor({limit:e}){C7(this,"limit"),C7(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}};const cT=BigInt(2**32-1),I7=BigInt(32);function iZ(t,e=!1){return e?{h:Number(t&cT),l:Number(t>>I7&cT)}:{h:Number(t>>I7&cT)|0,l:Number(t&cT)|0}}function rZ(t,e=!1){const n=t.length;let i=new Uint32Array(n),o=new Uint32Array(n);for(let l=0;l<n;l++){const{h,l:s}=iZ(t[l],e);[i[l],o[l]]=[h,s]}return[i,o]}const P7=(t,e,n)=>t>>>n,R7=(t,e,n)=>t<<32-n|e>>>n,am=(t,e,n)=>t>>>n|e<<32-n,cm=(t,e,n)=>t<<32-n|e>>>n,Dx=(t,e,n)=>t<<64-n|e>>>n-32,Nx=(t,e,n)=>t>>>n-32|e<<64-n,Obe=(t,e)=>e,kbe=(t,e)=>t,Dbe=(t,e,n)=>t<<n|e>>>32-n,Nbe=(t,e,n)=>e<<n|t>>>32-n,Mbe=(t,e,n)=>e<<n-32|t>>>64-n,Lbe=(t,e,n)=>t<<n-32|e>>>64-n;function ad(t,e,n,i){const o=(e>>>0)+(i>>>0);return{h:t+n+(o/2**32|0)|0,l:o|0}}const vD=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),xD=(t,e,n,i)=>e+n+i+(t/2**32|0)|0,Bbe=(t,e,n,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0),Fbe=(t,e,n,i,o)=>e+n+i+o+(t/2**32|0)|0,$be=(t,e,n,i,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0)+(o>>>0),zbe=(t,e,n,i,o,l)=>e+n+i+o+l+(t/2**32|0)|0,m1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function YS(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Wf(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function vd(t,...e){if(!YS(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function XS(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Wf(t.outputLen),Wf(t.blockLen)}function $m(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ED(t,e){vd(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function z2(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Au(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function NP(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function sh(t,e){return t<<32-e|t>>>e}const sZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function oZ(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Cf=sZ?t=>t:t=>oZ(t);function Ube(t){for(let e=0;e<t.length;e++)t[e]=oZ(t[e]);return t}const lm=sZ?t=>t:Ube,aZ=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",jbe=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function V1(t){if(vd(t),aZ)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=jbe[t[n]];return e}const wf={_0:48,_9:57,A:65,F:70,a:97,f:102};function O7(t){if(t>=wf._0&&t<=wf._9)return t-wf._0;if(t>=wf.A&&t<=wf.F)return t-(wf.A-10);if(t>=wf.a&&t<=wf.f)return t-(wf.a-10)}function MA(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(aZ)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let o=0,l=0;o<n;o++,l+=2){const h=O7(t.charCodeAt(l)),s=O7(t.charCodeAt(l+1));if(h===void 0||s===void 0){const w=t[l]+t[l+1];throw new Error('hex string expected, got non-hex character "'+w+'" at index '+l)}i[o]=h*16+s}return i}function cZ(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function gd(t){return typeof t=="string"&&(t=cZ(t)),vd(t),t}function pm(...t){let e=0;for(let i=0;i<t.length;i++){const o=t[i];vd(o),e+=o.length}const n=new Uint8Array(e);for(let i=0,o=0;i<t.length;i++){const l=t[i];n.set(l,o),o+=l.length}return n}let JS=class{};function NE(t){const e=i=>t().update(gd(i)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Vbe(t){const e=(i,o)=>t(o).update(gd(i)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=i=>t(i),e}function Oy(t=32){if(m1&&typeof m1.getRandomValues=="function")return m1.getRandomValues(new Uint8Array(t));if(m1&&typeof m1.randomBytes=="function")return Uint8Array.from(m1.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Wbe=BigInt(0),_x=BigInt(1),Hbe=BigInt(2),Gbe=BigInt(7),qbe=BigInt(256),Zbe=BigInt(113),lZ=[],uZ=[],dZ=[];for(let t=0,e=_x,n=1,i=0;t<24;t++){[n,i]=[i,(2*n+3*i)%5],lZ.push(2*(5*i+n)),uZ.push((t+1)*(t+2)/2%64);let o=Wbe;for(let l=0;l<7;l++)e=(e<<_x^(e>>Gbe)*Zbe)%qbe,e&Hbe&&(o^=_x<<(_x<<BigInt(l))-_x);dZ.push(o)}const hZ=rZ(dZ,!0),Kbe=hZ[0],Ybe=hZ[1],k7=(t,e,n)=>n>32?Mbe(t,e,n):Dbe(t,e,n),D7=(t,e,n)=>n>32?Lbe(t,e,n):Nbe(t,e,n);function Xbe(t,e=24){const n=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let h=0;h<10;h++)n[h]=t[h]^t[h+10]^t[h+20]^t[h+30]^t[h+40];for(let h=0;h<10;h+=2){const s=(h+8)%10,w=(h+2)%10,x=n[w],A=n[w+1],P=k7(x,A,1)^n[s],D=D7(x,A,1)^n[s+1];for(let M=0;M<50;M+=10)t[h+M]^=P,t[h+M+1]^=D}let o=t[2],l=t[3];for(let h=0;h<24;h++){const s=uZ[h],w=k7(o,l,s),x=D7(o,l,s),A=lZ[h];o=t[A],l=t[A+1],t[A]=w,t[A+1]=x}for(let h=0;h<50;h+=10){for(let s=0;s<10;s++)n[s]=t[h+s];for(let s=0;s<10;s++)t[h+s]^=~n[(s+2)%10]&n[(s+4)%10]}t[0]^=Kbe[i],t[1]^=Ybe[i]}Au(n)}let Jbe=class fZ extends JS{constructor(e,n,i,o=!1,l=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=i,this.enableXOF=o,this.rounds=l,Wf(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=z2(this.state)}clone(){return this._cloneInto()}keccak(){lm(this.state32),Xbe(this.state32,this.rounds),lm(this.state32),this.posOut=0,this.pos=0}update(e){$m(this),e=gd(e),vd(e);const{blockLen:n,state:i}=this,o=e.length;for(let l=0;l<o;){const h=Math.min(n-this.pos,o-l);for(let s=0;s<h;s++)i[this.pos++]^=e[l++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:i,blockLen:o}=this;e[i]^=n,n&128&&i===o-1&&this.keccak(),e[o-1]^=128,this.keccak()}writeInto(e){$m(this,!1),vd(e),this.finish();const n=this.state,{blockLen:i}=this;for(let o=0,l=e.length;o<l;){this.posOut>=i&&this.keccak();const h=Math.min(i-this.posOut,l-o);e.set(n.subarray(this.posOut,this.posOut+h),o),this.posOut+=h,o+=h}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Wf(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ED(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Au(this.state)}_cloneInto(e){const{blockLen:n,suffix:i,outputLen:o,rounds:l,enableXOF:h}=this;return e||(e=new fZ(n,i,o,h,l)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=l,e.suffix=i,e.outputLen=o,e.enableXOF=h,e.destroyed=this.destroyed,e}};const Qbe=(t,e,n)=>NE(()=>new Jbe(e,t,n)),eve=Qbe(1,136,256/8);function tve(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const o=BigInt(32),l=BigInt(4294967295),h=Number(n>>o&l),s=Number(n&l),w=i?4:0,x=i?0:4;t.setUint32(e+w,h,i),t.setUint32(e+x,s,i)}function nve(t,e,n){return t&e^~t&n}function ive(t,e,n){return t&e^t&n^e&n}let pZ=class extends JS{constructor(e,n,i,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=o,this.buffer=new Uint8Array(e),this.view=NP(this.buffer)}update(e){$m(this),e=gd(e),vd(e);const{view:n,buffer:i,blockLen:o}=this,l=e.length;for(let h=0;h<l;){const s=Math.min(o-this.pos,l-h);if(s===o){const w=NP(e);for(;o<=l-h;h+=o)this.process(w,h);continue}i.set(e.subarray(h,h+s),this.pos),this.pos+=s,h+=s,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$m(this),ED(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:o,isLE:l}=this;let{pos:h}=this;n[h++]=128,Au(this.buffer.subarray(h)),this.padOffset>o-h&&(this.process(i,0),h=0);for(let P=h;P<o;P++)n[P]=0;tve(i,o-8,BigInt(this.length*8),l),this.process(i,0);const s=NP(e),w=this.outputLen;if(w%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const x=w/4,A=this.get();if(x>A.length)throw new Error("_sha2: outputLen bigger than state");for(let P=0;P<x;P++)s.setUint32(4*P,A[P],l)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:o,finished:l,destroyed:h,pos:s}=this;return e.destroyed=h,e.finished=l,e.length=o,e.pos=s,o%n&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const Jp=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ha=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ga=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),rve=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Qp=new Uint32Array(64);class sve extends pZ{constructor(e=32){super(64,e,8,!1),this.A=Jp[0]|0,this.B=Jp[1]|0,this.C=Jp[2]|0,this.D=Jp[3]|0,this.E=Jp[4]|0,this.F=Jp[5]|0,this.G=Jp[6]|0,this.H=Jp[7]|0}get(){const{A:e,B:n,C:i,D:o,E:l,F:h,G:s,H:w}=this;return[e,n,i,o,l,h,s,w]}set(e,n,i,o,l,h,s,w){this.A=e|0,this.B=n|0,this.C=i|0,this.D=o|0,this.E=l|0,this.F=h|0,this.G=s|0,this.H=w|0}process(e,n){for(let P=0;P<16;P++,n+=4)Qp[P]=e.getUint32(n,!1);for(let P=16;P<64;P++){const D=Qp[P-15],M=Qp[P-2],z=sh(D,7)^sh(D,18)^D>>>3,U=sh(M,17)^sh(M,19)^M>>>10;Qp[P]=U+Qp[P-7]+z+Qp[P-16]|0}let{A:i,B:o,C:l,D:h,E:s,F:w,G:x,H:A}=this;for(let P=0;P<64;P++){const D=sh(s,6)^sh(s,11)^sh(s,25),M=A+D+nve(s,w,x)+rve[P]+Qp[P]|0,z=(sh(i,2)^sh(i,13)^sh(i,22))+ive(i,o,l)|0;A=x,x=w,w=s,s=h+M|0,h=l,l=o,o=i,i=M+z|0}i=i+this.A|0,o=o+this.B|0,l=l+this.C|0,h=h+this.D|0,s=s+this.E|0,w=w+this.F|0,x=x+this.G|0,A=A+this.H|0,this.set(i,o,l,h,s,w,x,A)}roundClean(){Au(Qp)}destroy(){this.set(0,0,0,0,0,0,0,0),Au(this.buffer)}}const mZ=rZ(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ove=mZ[0],ave=mZ[1],em=new Uint32Array(80),tm=new Uint32Array(80);let CD=class extends pZ{constructor(e=64){super(128,e,16,!1),this.Ah=Ga[0]|0,this.Al=Ga[1]|0,this.Bh=Ga[2]|0,this.Bl=Ga[3]|0,this.Ch=Ga[4]|0,this.Cl=Ga[5]|0,this.Dh=Ga[6]|0,this.Dl=Ga[7]|0,this.Eh=Ga[8]|0,this.El=Ga[9]|0,this.Fh=Ga[10]|0,this.Fl=Ga[11]|0,this.Gh=Ga[12]|0,this.Gl=Ga[13]|0,this.Hh=Ga[14]|0,this.Hl=Ga[15]|0}get(){const{Ah:e,Al:n,Bh:i,Bl:o,Ch:l,Cl:h,Dh:s,Dl:w,Eh:x,El:A,Fh:P,Fl:D,Gh:M,Gl:z,Hh:U,Hl:G}=this;return[e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G]}set(e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G){this.Ah=e|0,this.Al=n|0,this.Bh=i|0,this.Bl=o|0,this.Ch=l|0,this.Cl=h|0,this.Dh=s|0,this.Dl=w|0,this.Eh=x|0,this.El=A|0,this.Fh=P|0,this.Fl=D|0,this.Gh=M|0,this.Gl=z|0,this.Hh=U|0,this.Hl=G|0}process(e,n){for(let Q=0;Q<16;Q++,n+=4)em[Q]=e.getUint32(n),tm[Q]=e.getUint32(n+=4);for(let Q=16;Q<80;Q++){const de=em[Q-15]|0,he=tm[Q-15]|0,Ie=am(de,he,1)^am(de,he,8)^P7(de,he,7),ke=cm(de,he,1)^cm(de,he,8)^R7(de,he,7),Ue=em[Q-2]|0,ze=tm[Q-2]|0,ht=am(Ue,ze,19)^Dx(Ue,ze,61)^P7(Ue,ze,6),ft=cm(Ue,ze,19)^Nx(Ue,ze,61)^R7(Ue,ze,6),ct=Bbe(ke,ft,tm[Q-7],tm[Q-16]),je=Fbe(ct,Ie,ht,em[Q-7],em[Q-16]);em[Q]=je|0,tm[Q]=ct|0}let{Ah:i,Al:o,Bh:l,Bl:h,Ch:s,Cl:w,Dh:x,Dl:A,Eh:P,El:D,Fh:M,Fl:z,Gh:U,Gl:G,Hh:ne,Hl:oe}=this;for(let Q=0;Q<80;Q++){const de=am(P,D,14)^am(P,D,18)^Dx(P,D,41),he=cm(P,D,14)^cm(P,D,18)^Nx(P,D,41),Ie=P&M^~P&U,ke=D&z^~D&G,Ue=$be(oe,he,ke,ave[Q],tm[Q]),ze=zbe(Ue,ne,de,Ie,ove[Q],em[Q]),ht=Ue|0,ft=am(i,o,28)^Dx(i,o,34)^Dx(i,o,39),ct=cm(i,o,28)^Nx(i,o,34)^Nx(i,o,39),je=i&l^i&s^l&s,Ye=o&h^o&w^h&w;ne=U|0,oe=G|0,U=M|0,G=z|0,M=P|0,z=D|0,{h:P,l:D}=ad(x|0,A|0,ze|0,ht|0),x=s|0,A=w|0,s=l|0,w=h|0,l=i|0,h=o|0;const re=vD(ht,ct,Ye);i=xD(re,ze,ft,je),o=re|0}({h:i,l:o}=ad(this.Ah|0,this.Al|0,i|0,o|0)),{h:l,l:h}=ad(this.Bh|0,this.Bl|0,l|0,h|0),{h:s,l:w}=ad(this.Ch|0,this.Cl|0,s|0,w|0),{h:x,l:A}=ad(this.Dh|0,this.Dl|0,x|0,A|0),{h:P,l:D}=ad(this.Eh|0,this.El|0,P|0,D|0),{h:M,l:z}=ad(this.Fh|0,this.Fl|0,M|0,z|0),{h:U,l:G}=ad(this.Gh|0,this.Gl|0,U|0,G|0),{h:ne,l:oe}=ad(this.Hh|0,this.Hl|0,ne|0,oe|0),this.set(i,o,l,h,s,w,x,A,P,D,M,z,U,G,ne,oe)}roundClean(){Au(em,tm)}destroy(){Au(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class cve extends CD{constructor(){super(48),this.Ah=Ha[0]|0,this.Al=Ha[1]|0,this.Bh=Ha[2]|0,this.Bl=Ha[3]|0,this.Ch=Ha[4]|0,this.Cl=Ha[5]|0,this.Dh=Ha[6]|0,this.Dl=Ha[7]|0,this.Eh=Ha[8]|0,this.El=Ha[9]|0,this.Fh=Ha[10]|0,this.Fl=Ha[11]|0,this.Gh=Ha[12]|0,this.Gl=Ha[13]|0,this.Hh=Ha[14]|0,this.Hl=Ha[15]|0}}const qa=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class lve extends CD{constructor(){super(32),this.Ah=qa[0]|0,this.Al=qa[1]|0,this.Bh=qa[2]|0,this.Bl=qa[3]|0,this.Ch=qa[4]|0,this.Cl=qa[5]|0,this.Dh=qa[6]|0,this.Dl=qa[7]|0,this.Eh=qa[8]|0,this.El=qa[9]|0,this.Fh=qa[10]|0,this.Fl=qa[11]|0,this.Gh=qa[12]|0,this.Gl=qa[13]|0,this.Hh=qa[14]|0,this.Hl=qa[15]|0}}const QS=NE(()=>new sve),uve=NE(()=>new CD),dve=NE(()=>new cve),hve=NE(()=>new lve),fve=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Io=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Bn=new Uint32Array(32);function nm(t,e,n,i,o,l){const h=o[l],s=o[l+1];let w=Bn[2*t],x=Bn[2*t+1],A=Bn[2*e],P=Bn[2*e+1],D=Bn[2*n],M=Bn[2*n+1],z=Bn[2*i],U=Bn[2*i+1],G=vD(w,A,h);x=xD(G,x,P,s),w=G|0,{Dh:U,Dl:z}={Dh:U^x,Dl:z^w},{Dh:U,Dl:z}={Dh:Obe(U,z),Dl:kbe(U)},{h:M,l:D}=ad(M,D,U,z),{Bh:P,Bl:A}={Bh:P^M,Bl:A^D},{Bh:P,Bl:A}={Bh:am(P,A,24),Bl:cm(P,A,24)},Bn[2*t]=w,Bn[2*t+1]=x,Bn[2*e]=A,Bn[2*e+1]=P,Bn[2*n]=D,Bn[2*n+1]=M,Bn[2*i]=z,Bn[2*i+1]=U}function im(t,e,n,i,o,l){const h=o[l],s=o[l+1];let w=Bn[2*t],x=Bn[2*t+1],A=Bn[2*e],P=Bn[2*e+1],D=Bn[2*n],M=Bn[2*n+1],z=Bn[2*i],U=Bn[2*i+1],G=vD(w,A,h);x=xD(G,x,P,s),w=G|0,{Dh:U,Dl:z}={Dh:U^x,Dl:z^w},{Dh:U,Dl:z}={Dh:am(U,z,16),Dl:cm(U,z,16)},{h:M,l:D}=ad(M,D,U,z),{Bh:P,Bl:A}={Bh:P^M,Bl:A^D},{Bh:P,Bl:A}={Bh:Dx(P,A,63),Bl:Nx(P,A,63)},Bn[2*t]=w,Bn[2*t+1]=x,Bn[2*e]=A,Bn[2*e+1]=P,Bn[2*n]=D,Bn[2*n+1]=M,Bn[2*i]=z,Bn[2*i+1]=U}function pve(t,e={},n,i,o){if(Wf(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:l,salt:h,personalization:s}=e;if(l!==void 0&&(l.length<1||l.length>n))throw new Error("key length must be undefined or 1.."+n);if(h!==void 0&&h.length!==i)throw new Error("salt must be undefined or "+i);if(s!==void 0&&s.length!==o)throw new Error("personalization must be undefined or "+o)}class mve extends JS{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Wf(e),Wf(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=z2(this.buffer)}update(e){$m(this),e=gd(e),vd(e);const{blockLen:n,buffer:i,buffer32:o}=this,l=e.length,h=e.byteOffset,s=e.buffer;for(let w=0;w<l;){this.pos===n&&(lm(o),this.compress(o,0,!1),lm(o),this.pos=0);const x=Math.min(n-this.pos,l-w),A=h+w;if(x===n&&!(A%4)&&w+x<l){const P=new Uint32Array(s,A,Math.floor((l-w)/4));lm(P);for(let D=0;w+n<l;D+=o.length,w+=n)this.length+=n,this.compress(P,D,!1);lm(P);continue}i.set(e.subarray(w,w+x),this.pos),this.pos+=x,this.length+=x,w+=x}return this}digestInto(e){$m(this),ED(e,this);const{pos:n,buffer32:i}=this;this.finished=!0,Au(this.buffer.subarray(n)),lm(i),this.compress(i,0,!0),lm(i);const o=z2(e);this.get().forEach((l,h)=>o[h]=Cf(l))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){const{buffer:n,length:i,finished:o,destroyed:l,outputLen:h,pos:s}=this;return e||(e=new this.constructor({dkLen:h})),e.set(...this.get()),e.buffer.set(n),e.destroyed=l,e.finished=o,e.length=i,e.pos=s,e.outputLen=h,e}clone(){return this._cloneInto()}}class gve extends mve{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=Io[0]|0,this.v0h=Io[1]|0,this.v1l=Io[2]|0,this.v1h=Io[3]|0,this.v2l=Io[4]|0,this.v2h=Io[5]|0,this.v3l=Io[6]|0,this.v3h=Io[7]|0,this.v4l=Io[8]|0,this.v4h=Io[9]|0,this.v5l=Io[10]|0,this.v5h=Io[11]|0,this.v6l=Io[12]|0,this.v6h=Io[13]|0,this.v7l=Io[14]|0,this.v7h=Io[15]|0,pve(n,e,64,16,16);let{key:i,personalization:o,salt:l}=e,h=0;if(i!==void 0&&(i=gd(i),h=i.length),this.v0l^=this.outputLen|h<<8|65536|1<<24,l!==void 0){l=gd(l);const s=z2(l);this.v4l^=Cf(s[0]),this.v4h^=Cf(s[1]),this.v5l^=Cf(s[2]),this.v5h^=Cf(s[3])}if(o!==void 0){o=gd(o);const s=z2(o);this.v6l^=Cf(s[0]),this.v6h^=Cf(s[1]),this.v7l^=Cf(s[2]),this.v7h^=Cf(s[3])}if(i!==void 0){const s=new Uint8Array(this.blockLen);s.set(i),this.update(s)}}get(){let{v0l:e,v0h:n,v1l:i,v1h:o,v2l:l,v2h:h,v3l:s,v3h:w,v4l:x,v4h:A,v5l:P,v5h:D,v6l:M,v6h:z,v7l:U,v7h:G}=this;return[e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G]}set(e,n,i,o,l,h,s,w,x,A,P,D,M,z,U,G){this.v0l=e|0,this.v0h=n|0,this.v1l=i|0,this.v1h=o|0,this.v2l=l|0,this.v2h=h|0,this.v3l=s|0,this.v3h=w|0,this.v4l=x|0,this.v4h=A|0,this.v5l=P|0,this.v5h=D|0,this.v6l=M|0,this.v6h=z|0,this.v7l=U|0,this.v7h=G|0}compress(e,n,i){this.get().forEach((w,x)=>Bn[x]=w),Bn.set(Io,16);let{h:o,l}=iZ(BigInt(this.length));Bn[24]=Io[8]^l,Bn[25]=Io[9]^o,i&&(Bn[28]=~Bn[28],Bn[29]=~Bn[29]);let h=0;const s=fve;for(let w=0;w<12;w++)nm(0,4,8,12,e,n+2*s[h++]),im(0,4,8,12,e,n+2*s[h++]),nm(1,5,9,13,e,n+2*s[h++]),im(1,5,9,13,e,n+2*s[h++]),nm(2,6,10,14,e,n+2*s[h++]),im(2,6,10,14,e,n+2*s[h++]),nm(3,7,11,15,e,n+2*s[h++]),im(3,7,11,15,e,n+2*s[h++]),nm(0,5,10,15,e,n+2*s[h++]),im(0,5,10,15,e,n+2*s[h++]),nm(1,6,11,12,e,n+2*s[h++]),im(1,6,11,12,e,n+2*s[h++]),nm(2,7,8,13,e,n+2*s[h++]),im(2,7,8,13,e,n+2*s[h++]),nm(3,4,9,14,e,n+2*s[h++]),im(3,4,9,14,e,n+2*s[h++]);this.v0l^=Bn[0]^Bn[16],this.v0h^=Bn[1]^Bn[17],this.v1l^=Bn[2]^Bn[18],this.v1h^=Bn[3]^Bn[19],this.v2l^=Bn[4]^Bn[20],this.v2h^=Bn[5]^Bn[21],this.v3l^=Bn[6]^Bn[22],this.v3h^=Bn[7]^Bn[23],this.v4l^=Bn[8]^Bn[24],this.v4h^=Bn[9]^Bn[25],this.v5l^=Bn[10]^Bn[26],this.v5h^=Bn[11]^Bn[27],this.v6l^=Bn[12]^Bn[28],this.v6h^=Bn[13]^Bn[29],this.v7l^=Bn[14]^Bn[30],this.v7h^=Bn[15]^Bn[31],Au(Bn)}destroy(){this.destroyed=!0,Au(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const yve=Vbe(t=>new gve(t)),_ve="https://rpc.walletconnect.org/v1";function gZ(t){const e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(eve(n)).toString("hex")}async function wve(t,e,n,i,o,l){switch(n.t){case"eip191":return await bve(t,e,n.s);case"eip1271":return await vve(t,e,n.s,i,o,l);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function bve(t,e,n){const i=q_e(n);return o1e({payload:gZ(e),signature:i}).toLowerCase()===t.toLowerCase()}async function vve(t,e,n,i,o,l){const h=Ff(i);if(!h.namespace||!h.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const s="0x1626ba7e",w="0000000000000000000000000000000000000000000000000000000000000040",x=n.substring(2),A=(x.length/2).toString(16).padStart(64,"0"),P=(e.startsWith("0x")?e:gZ(e)).substring(2),D=s+P+w+A+x,M=await fetch(`${l||_ve}/?chainId=${i}&projectId=${o}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:xve(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:D},"latest"]})}),{result:z}=await M.json();return z?z.slice(0,s.length).toLowerCase()===s.toLowerCase():!1}catch(s){return console.error("isValidEip1271Signature: ",s),!1}}function xve(){return Date.now()+Math.floor(Math.random()*1e3)}function Eve(t){const e=atob(t),n=new Uint8Array(e.length);for(let h=0;h<e.length;h++)n[h]=e.charCodeAt(h);const i=n[0];if(i===0)throw new Error("No signatures found");const o=1+i*64;if(n.length<o)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const l=Buffer.from(t,"base64").slice(1,65);return Lw.encode(l)}function Cve(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(l=>l.charCodeAt(0)),i=new Uint8Array(n.length+e.length);i.set(n),i.set(e,n.length);const o=yve(i,{dkLen:32});return Lw.encode(o)}function N7(t){const e=new Uint8Array(QS(Tve(t)));return Lw.encode(e)}function Tve(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function M7(t){const e=Buffer.from(t,"base64"),n=q1e(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const i=F1e(n),o=Buffer.from("TX"),l=Buffer.concat([o,Buffer.from(i)]),h=hve(l);return s1e.encode(h).replace(/=+$/,"")}function MP(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function Ave(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),o=[];o.push(Buffer.from([10])),o.push(MP(e.length)),o.push(e),o.push(Buffer.from([18])),o.push(MP(n.length)),o.push(n),o.push(Buffer.from([26])),o.push(MP(i.length)),o.push(i);const l=Buffer.concat(o),h=QS(l);return Buffer.from(h).toString("hex").toUpperCase()}function Sve(t){var e,n;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const o=(n=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:n.transactionHashes;o&&i.push(...o)}catch(o){console.warn("getWalletSendCallsHashes failed: ",o)}return i}var Ive=Object.defineProperty,Pve=Object.defineProperties,Rve=Object.getOwnPropertyDescriptors,L7=Object.getOwnPropertySymbols,Ove=Object.prototype.hasOwnProperty,kve=Object.prototype.propertyIsEnumerable,B7=(t,e,n)=>e in t?Ive(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Dve=(t,e)=>{for(var n in e||(e={}))Ove.call(e,n)&&B7(t,n,e[n]);if(L7)for(var n of L7(e))kve.call(e,n)&&B7(t,n,e[n]);return t},Nve=(t,e)=>Pve(t,Rve(e));const yZ="did:pkh:",Mve={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},Lve=t=>t?Mve[t]||t:"",eI=t=>t==null?void 0:t.split(":"),Bve=t=>{const e=t&&eI(t);if(e)return t.includes(yZ)?e[3]:e[1]},Fve=t=>{const e=t&&eI(t);if(e)return t.includes(yZ)?e[2]:e[0]},V8=t=>{const e=t&&eI(t);if(e)return e[2]+":"+e[3]},LA=t=>{const e=t&&eI(t);if(e)return e.pop()};async function F7(t){const{cacao:e,projectId:n}=t,{s:i,p:o}=e,l=_Z(o,o.iss),h=LA(o.iss);return await wve(h,l,i,V8(o.iss),n)}const _Z=(t,e)=>{const n=Fve(e);if(!n)throw new Error("Invalid issuer: "+e);const i=`${t.domain} wants you to sign in with your ${Lve(n)} account:`,o=LA(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let l=t.statement||void 0;const h=`URI: ${t.aud||t.uri}`,s=`Version: ${t.version}`,w=`Chain ID: ${Bve(e)}`,x=`Nonce: ${t.nonce}`,A=`Issued At: ${t.iat}`,P=t.exp?`Expiration Time: ${t.exp}`:void 0,D=t.nbf?`Not Before: ${t.nbf}`:void 0,M=t.requestId?`Request ID: ${t.requestId}`:void 0,z=t.resources?`Resources:${t.resources.map(G=>`
- ${G}`).join("")}`:void 0,U=jT(t.resources);if(U){const G=U2(U);l=qve(l,G)}return[i,o,"",l,"",h,s,w,x,A,P,D,M,z].filter(G=>G!=null).join(`
`)};function $ve(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function zve(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function ty(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{const i=t.att[n];if(Array.isArray(i))throw new Error(`Resource must be an object: ${n}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(i).forEach(o=>{const l=i[o];if(!Array.isArray(l))throw new Error(`Ability limits ${o} must be an array of objects, found: ${l}`);if(!l.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);l.forEach(h=>{if(typeof h!="object")throw new Error(`Ability limits (${o}) must be an array of objects, found: ${h}`)})})})}function Uve(t,e,n,i={}){return n==null||n.sort((o,l)=>o.localeCompare(l)),{att:{[t]:jve(e,n,i)}}}function jve(t,e,n={}){e=e==null?void 0:e.sort((o,l)=>o.localeCompare(l));const i=e.map(o=>({[`${t}/${o}`]:[n]}));return Object.assign({},...i)}function wZ(t){return ty(t),`urn:recap:${$ve(t).replace(/=/g,"")}`}function U2(t){const e=zve(t.replace("urn:recap:",""));return ty(e),e}function Vve(t,e,n){const i=Uve(t,e,n);return wZ(i)}function Wve(t){return t&&t.includes("urn:recap:")}function Hve(t,e){const n=U2(t),i=U2(e),o=Gve(n,i);return wZ(o)}function Gve(t,e){ty(t),ty(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((o,l)=>o.localeCompare(l)),i={att:{}};return n.forEach(o=>{var l,h;Object.keys(((l=t.att)==null?void 0:l[o])||{}).concat(Object.keys(((h=e.att)==null?void 0:h[o])||{})).sort((s,w)=>s.localeCompare(w)).forEach(s=>{var w,x;i.att[o]=Nve(Dve({},i.att[o]),{[s]:((w=t.att[o])==null?void 0:w[s])||((x=e.att[o])==null?void 0:x[s])})})}),i}function qve(t="",e){ty(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const i=[];let o=0;Object.keys(e.att).forEach(s=>{const w=Object.keys(e.att[s]).map(P=>({ability:P.split("/")[0],action:P.split("/")[1]}));w.sort((P,D)=>P.action.localeCompare(D.action));const x={};w.forEach(P=>{x[P.ability]||(x[P.ability]=[]),x[P.ability].push(P.action)});const A=Object.keys(x).map(P=>(o++,`(${o}) '${P}': '${x[P].join("', '")}' for '${s}'.`));i.push(A.join(", ").replace(".,","."))});const l=i.join(" "),h=`${n}${l}`;return`${t?t+" ":""}${h}`}function $7(t){var e;const n=U2(t);ty(n);const i=(e=n.att)==null?void 0:e.eip155;return i?Object.keys(i).map(o=>o.split("/")[1]):[]}function z7(t){const e=U2(t);ty(e);const n=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(o=>{var l;(l=o==null?void 0:o[0])!=null&&l.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function jT(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return Wve(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function bZ(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function W8(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function LP(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function el(t,...e){if(!bZ(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function U7(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zve(t,e){el(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Am(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function dw(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Kve(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Yve=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Xve(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function H8(t){if(typeof t=="string")t=Xve(t);else if(bZ(t))t=G8(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Jve(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Qve(t,e){if(t.length!==e.length)return!1;let n=0;for(let i=0;i<t.length;i++)n|=t[i]^e[i];return n===0}const exe=(t,e)=>{function n(i,...o){if(el(i),!Yve)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const x=o[0];if(!x)throw new Error("nonce / iv required");t.varSizeNonce?el(x):el(x,t.nonceLength)}const l=t.tagLength;l&&o[1]!==void 0&&el(o[1]);const h=e(i,...o),s=(x,A)=>{if(A!==void 0){if(x!==2)throw new Error("cipher output not supported");el(A)}};let w=!1;return{encrypt(x,A){if(w)throw new Error("cannot encrypt() twice with same key + nonce");return w=!0,el(x),s(h.encrypt.length,A),h.encrypt(x,A)},decrypt(x,A){if(el(x),l&&x.length<l)throw new Error("invalid ciphertext length: smaller than tagLength="+l);return s(h.decrypt.length,A),h.decrypt(x,A)}}}return Object.assign(n,t),n};function j7(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!nxe(e))throw new Error("invalid output, must be aligned");return e}function V7(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const o=BigInt(32),l=BigInt(4294967295),h=Number(n>>o&l),s=Number(n&l);t.setUint32(e+4,h,i),t.setUint32(e+0,s,i)}function txe(t,e,n){W8(n);const i=new Uint8Array(16),o=Kve(i);return V7(o,0,BigInt(e),n),V7(o,8,BigInt(t),n),i}function nxe(t){return t.byteOffset%4===0}function G8(t){return Uint8Array.from(t)}const vZ=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),ixe=vZ("expand 16-byte k"),rxe=vZ("expand 32-byte k"),sxe=Am(ixe),oxe=Am(rxe);function Rr(t,e){return t<<e|t>>>32-e}function q8(t){return t.byteOffset%4===0}const lT=64,axe=16,xZ=2**32-1,W7=new Uint32Array;function cxe(t,e,n,i,o,l,h,s){const w=o.length,x=new Uint8Array(lT),A=Am(x),P=q8(o)&&q8(l),D=P?Am(o):W7,M=P?Am(l):W7;for(let z=0;z<w;h++){if(t(e,n,i,A,h,s),h>=xZ)throw new Error("arx: counter overflow");const U=Math.min(lT,w-z);if(P&&U===lT){const G=z/4;if(z%4!==0)throw new Error("arx: invalid block position");for(let ne=0,oe;ne<axe;ne++)oe=G+ne,M[oe]=D[oe]^A[ne];z+=lT;continue}for(let G=0,ne;G<U;G++)ne=z+G,l[ne]=o[ne]^x[G];z+=U}}function lxe(t,e){const{allowShortKeys:n,extendNonceFn:i,counterLength:o,counterRight:l,rounds:h}=Jve({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return LP(o),LP(h),W8(l),W8(n),(s,w,x,A,P=0)=>{el(s),el(w),el(x);const D=x.length;if(A===void 0&&(A=new Uint8Array(D)),el(A),LP(P),P<0||P>=xZ)throw new Error("arx: counter overflow");if(A.length<D)throw new Error(`arx: output (${A.length}) is shorter than data (${D})`);const M=[];let z=s.length,U,G;if(z===32)M.push(U=G8(s)),G=oxe;else if(z===16&&n)U=new Uint8Array(32),U.set(s),U.set(s,16),G=sxe,M.push(U);else throw new Error(`arx: invalid 32-byte key, got length=${z}`);q8(w)||M.push(w=G8(w));const ne=Am(U);if(i){if(w.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(G,ne,Am(w.subarray(0,16)),ne),w=w.subarray(16)}const oe=16-o;if(oe!==w.length)throw new Error(`arx: nonce must be ${oe} or 16 bytes`);if(oe!==12){const de=new Uint8Array(12);de.set(w,l?0:12-w.length),w=de,M.push(w)}const Q=Am(w);return cxe(t,G,ne,Q,x,A,P,h),dw(...M),A}}const xa=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class uxe{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=H8(e),el(e,32);const n=xa(e,0),i=xa(e,2),o=xa(e,4),l=xa(e,6),h=xa(e,8),s=xa(e,10),w=xa(e,12),x=xa(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|i<<3)&8191,this.r[2]=(i>>>10|o<<6)&7939,this.r[3]=(o>>>7|l<<9)&8191,this.r[4]=(l>>>4|h<<12)&255,this.r[5]=h>>>1&8190,this.r[6]=(h>>>14|s<<2)&8191,this.r[7]=(s>>>11|w<<5)&8065,this.r[8]=(w>>>8|x<<8)&8191,this.r[9]=x>>>5&127;for(let A=0;A<8;A++)this.pad[A]=xa(e,16+2*A)}process(e,n,i=!1){const o=i?0:2048,{h:l,r:h}=this,s=h[0],w=h[1],x=h[2],A=h[3],P=h[4],D=h[5],M=h[6],z=h[7],U=h[8],G=h[9],ne=xa(e,n+0),oe=xa(e,n+2),Q=xa(e,n+4),de=xa(e,n+6),he=xa(e,n+8),Ie=xa(e,n+10),ke=xa(e,n+12),Ue=xa(e,n+14);let ze=l[0]+(ne&8191),ht=l[1]+((ne>>>13|oe<<3)&8191),ft=l[2]+((oe>>>10|Q<<6)&8191),ct=l[3]+((Q>>>7|de<<9)&8191),je=l[4]+((de>>>4|he<<12)&8191),Ye=l[5]+(he>>>1&8191),re=l[6]+((he>>>14|Ie<<2)&8191),le=l[7]+((Ie>>>11|ke<<5)&8191),Ae=l[8]+((ke>>>8|Ue<<8)&8191),Le=l[9]+(Ue>>>5|o),De=0,He=De+ze*s+ht*(5*G)+ft*(5*U)+ct*(5*z)+je*(5*M);De=He>>>13,He&=8191,He+=Ye*(5*D)+re*(5*P)+le*(5*A)+Ae*(5*x)+Le*(5*w),De+=He>>>13,He&=8191;let Et=De+ze*w+ht*s+ft*(5*G)+ct*(5*U)+je*(5*z);De=Et>>>13,Et&=8191,Et+=Ye*(5*M)+re*(5*D)+le*(5*P)+Ae*(5*A)+Le*(5*x),De+=Et>>>13,Et&=8191;let Ct=De+ze*x+ht*w+ft*s+ct*(5*G)+je*(5*U);De=Ct>>>13,Ct&=8191,Ct+=Ye*(5*z)+re*(5*M)+le*(5*D)+Ae*(5*P)+Le*(5*A),De+=Ct>>>13,Ct&=8191;let Dt=De+ze*A+ht*x+ft*w+ct*s+je*(5*G);De=Dt>>>13,Dt&=8191,Dt+=Ye*(5*U)+re*(5*z)+le*(5*M)+Ae*(5*D)+Le*(5*P),De+=Dt>>>13,Dt&=8191;let Bt=De+ze*P+ht*A+ft*x+ct*w+je*s;De=Bt>>>13,Bt&=8191,Bt+=Ye*(5*G)+re*(5*U)+le*(5*z)+Ae*(5*M)+Le*(5*D),De+=Bt>>>13,Bt&=8191;let Yt=De+ze*D+ht*P+ft*A+ct*x+je*w;De=Yt>>>13,Yt&=8191,Yt+=Ye*s+re*(5*G)+le*(5*U)+Ae*(5*z)+Le*(5*M),De+=Yt>>>13,Yt&=8191;let yn=De+ze*M+ht*D+ft*P+ct*A+je*x;De=yn>>>13,yn&=8191,yn+=Ye*w+re*s+le*(5*G)+Ae*(5*U)+Le*(5*z),De+=yn>>>13,yn&=8191;let mn=De+ze*z+ht*M+ft*D+ct*P+je*A;De=mn>>>13,mn&=8191,mn+=Ye*x+re*w+le*s+Ae*(5*G)+Le*(5*U),De+=mn>>>13,mn&=8191;let oi=De+ze*U+ht*z+ft*M+ct*D+je*P;De=oi>>>13,oi&=8191,oi+=Ye*A+re*x+le*w+Ae*s+Le*(5*G),De+=oi>>>13,oi&=8191;let sn=De+ze*G+ht*U+ft*z+ct*M+je*D;De=sn>>>13,sn&=8191,sn+=Ye*P+re*A+le*x+Ae*w+Le*s,De+=sn>>>13,sn&=8191,De=(De<<2)+De|0,De=De+He|0,He=De&8191,De=De>>>13,Et+=De,l[0]=He,l[1]=Et,l[2]=Ct,l[3]=Dt,l[4]=Bt,l[5]=Yt,l[6]=yn,l[7]=mn,l[8]=oi,l[9]=sn}finalize(){const{h:e,pad:n}=this,i=new Uint16Array(10);let o=e[1]>>>13;e[1]&=8191;for(let s=2;s<10;s++)e[s]+=o,o=e[s]>>>13,e[s]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,i[0]=e[0]+5,o=i[0]>>>13,i[0]&=8191;for(let s=1;s<10;s++)i[s]=e[s]+o,o=i[s]>>>13,i[s]&=8191;i[9]-=8192;let l=(o^1)-1;for(let s=0;s<10;s++)i[s]&=l;l=~l;for(let s=0;s<10;s++)e[s]=e[s]&l|i[s];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let h=e[0]+n[0];e[0]=h&65535;for(let s=1;s<8;s++)h=(e[s]+n[s]|0)+(h>>>16)|0,e[s]=h&65535;dw(i)}update(e){U7(this),e=H8(e),el(e);const{buffer:n,blockLen:i}=this,o=e.length;for(let l=0;l<o;){const h=Math.min(i-this.pos,o-l);if(h===i){for(;i<=o-l;l+=i)this.process(e,l);continue}n.set(e.subarray(l,l+h),this.pos),this.pos+=h,l+=h,this.pos===i&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){dw(this.h,this.r,this.buffer,this.pad)}digestInto(e){U7(this),Zve(e,this),this.finished=!0;const{buffer:n,h:i}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let l=0;for(let h=0;h<8;h++)e[l++]=i[h]>>>0,e[l++]=i[h]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}}function dxe(t){const e=(i,o)=>t(o).update(H8(i)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=i=>t(i),e}const hxe=dxe(t=>new uxe(t));function fxe(t,e,n,i,o,l=20){let h=t[0],s=t[1],w=t[2],x=t[3],A=e[0],P=e[1],D=e[2],M=e[3],z=e[4],U=e[5],G=e[6],ne=e[7],oe=o,Q=n[0],de=n[1],he=n[2],Ie=h,ke=s,Ue=w,ze=x,ht=A,ft=P,ct=D,je=M,Ye=z,re=U,le=G,Ae=ne,Le=oe,De=Q,He=de,Et=he;for(let Dt=0;Dt<l;Dt+=2)Ie=Ie+ht|0,Le=Rr(Le^Ie,16),Ye=Ye+Le|0,ht=Rr(ht^Ye,12),Ie=Ie+ht|0,Le=Rr(Le^Ie,8),Ye=Ye+Le|0,ht=Rr(ht^Ye,7),ke=ke+ft|0,De=Rr(De^ke,16),re=re+De|0,ft=Rr(ft^re,12),ke=ke+ft|0,De=Rr(De^ke,8),re=re+De|0,ft=Rr(ft^re,7),Ue=Ue+ct|0,He=Rr(He^Ue,16),le=le+He|0,ct=Rr(ct^le,12),Ue=Ue+ct|0,He=Rr(He^Ue,8),le=le+He|0,ct=Rr(ct^le,7),ze=ze+je|0,Et=Rr(Et^ze,16),Ae=Ae+Et|0,je=Rr(je^Ae,12),ze=ze+je|0,Et=Rr(Et^ze,8),Ae=Ae+Et|0,je=Rr(je^Ae,7),Ie=Ie+ft|0,Et=Rr(Et^Ie,16),le=le+Et|0,ft=Rr(ft^le,12),Ie=Ie+ft|0,Et=Rr(Et^Ie,8),le=le+Et|0,ft=Rr(ft^le,7),ke=ke+ct|0,Le=Rr(Le^ke,16),Ae=Ae+Le|0,ct=Rr(ct^Ae,12),ke=ke+ct|0,Le=Rr(Le^ke,8),Ae=Ae+Le|0,ct=Rr(ct^Ae,7),Ue=Ue+je|0,De=Rr(De^Ue,16),Ye=Ye+De|0,je=Rr(je^Ye,12),Ue=Ue+je|0,De=Rr(De^Ue,8),Ye=Ye+De|0,je=Rr(je^Ye,7),ze=ze+ht|0,He=Rr(He^ze,16),re=re+He|0,ht=Rr(ht^re,12),ze=ze+ht|0,He=Rr(He^ze,8),re=re+He|0,ht=Rr(ht^re,7);let Ct=0;i[Ct++]=h+Ie|0,i[Ct++]=s+ke|0,i[Ct++]=w+Ue|0,i[Ct++]=x+ze|0,i[Ct++]=A+ht|0,i[Ct++]=P+ft|0,i[Ct++]=D+ct|0,i[Ct++]=M+je|0,i[Ct++]=z+Ye|0,i[Ct++]=U+re|0,i[Ct++]=G+le|0,i[Ct++]=ne+Ae|0,i[Ct++]=oe+Le|0,i[Ct++]=Q+De|0,i[Ct++]=de+He|0,i[Ct++]=he+Et|0}const pxe=lxe(fxe,{counterRight:!1,counterLength:4,allowShortKeys:!1}),mxe=new Uint8Array(16),H7=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(mxe.subarray(n))},gxe=new Uint8Array(32);function G7(t,e,n,i,o){const l=t(e,n,gxe),h=hxe.create(l);o&&H7(h,o),H7(h,i);const s=txe(i.length,o?o.length:0,!0);h.update(s);const w=h.digest();return dw(l,s),w}const yxe=t=>(e,n,i)=>({encrypt(o,l){const h=o.length;l=j7(h+16,l,!1),l.set(o);const s=l.subarray(0,-16);t(e,n,s,s,1);const w=G7(t,e,n,s,i);return l.set(w,h),dw(w),l},decrypt(o,l){l=j7(o.length-16,l,!1);const h=o.subarray(0,-16),s=o.subarray(-16),w=G7(t,e,n,h,i);if(!Qve(s,w))throw new Error("invalid tag");return l.set(o.subarray(0,-16)),t(e,n,l,l,1),dw(w),l}}),EZ=exe({blockSize:64,nonceLength:12,tagLength:16},yxe(pxe));let CZ=class extends JS{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,XS(e);const i=gd(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,l=new Uint8Array(o);l.set(i.length>o?e.create().update(i).digest():i);for(let h=0;h<l.length;h++)l[h]^=54;this.iHash.update(l),this.oHash=e.create();for(let h=0;h<l.length;h++)l[h]^=106;this.oHash.update(l),Au(l)}update(e){return $m(this),this.iHash.update(e),this}digestInto(e){$m(this),vd(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:i,finished:o,destroyed:l,blockLen:h,outputLen:s}=this;return e=e,e.finished=o,e.destroyed=l,e.blockLen=h,e.outputLen=s,e.oHash=n._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const tI=(t,e,n)=>new CZ(t,e).update(n).digest();tI.create=(t,e)=>new CZ(t,e);function _xe(t,e,n){return XS(t),n===void 0&&(n=new Uint8Array(t.outputLen)),tI(t,gd(n),gd(e))}const BP=Uint8Array.from([0]),q7=Uint8Array.of();function wxe(t,e,n,i=32){XS(t),Wf(i);const o=t.outputLen;if(i>255*o)throw new Error("Length should be <= 255*HashLen");const l=Math.ceil(i/o);n===void 0&&(n=q7);const h=new Uint8Array(l*o),s=tI.create(t,e),w=s._cloneInto(),x=new Uint8Array(s.outputLen);for(let A=0;A<l;A++)BP[0]=A+1,w.update(A===0?q7:x).update(n).update(BP).digestInto(x),h.set(x,o*A),s._cloneInto(w);return s.destroy(),w.destroy(),Au(x,BP),h.slice(0,i)}const bxe=(t,e,n,i,o)=>wxe(t,_xe(t,e,n),i,o),nI=QS,TD=BigInt(0),Z8=BigInt(1);function BA(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function I0(t,e,n=""){const i=YS(t),o=t==null?void 0:t.length,l=e!==void 0;if(!i||l&&o!==e){const h=n&&`"${n}" `,s=l?` of length ${e}`:"",w=i?`length=${o}`:`type=${typeof t}`;throw new Error(h+"expected Uint8Array"+s+", got "+w)}return t}function uT(t){const e=t.toString(16);return e.length&1?"0"+e:e}function TZ(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?TD:BigInt("0x"+t)}function iI(t){return TZ(V1(t))}function FA(t){return vd(t),TZ(V1(Uint8Array.from(t).reverse()))}function AD(t,e){return MA(t.toString(16).padStart(e*2,"0"))}function SD(t,e){return AD(t,e).reverse()}function Ka(t,e,n){let i;if(typeof e=="string")try{i=MA(e)}catch(l){throw new Error(t+" must be hex string or Uint8Array, cause: "+l)}else if(YS(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const o=i.length;if(typeof n=="number"&&o!==n)throw new Error(t+" of length "+n+" expected, got "+o);return i}const FP=t=>typeof t=="bigint"&&TD<=t;function vxe(t,e,n){return FP(t)&&FP(e)&&FP(n)&&e<=t&&t<n}function K8(t,e,n,i){if(!vxe(e,n,i))throw new Error("expected valid "+t+": "+n+" <= n < "+i+", got "+e)}function AZ(t){let e;for(e=0;t>TD;t>>=Z8,e+=1);return e}const ME=t=>(Z8<<BigInt(t))-Z8;function xxe(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const i=D=>new Uint8Array(D),o=D=>Uint8Array.of(D);let l=i(t),h=i(t),s=0;const w=()=>{l.fill(1),h.fill(0),s=0},x=(...D)=>n(h,l,...D),A=(D=i(0))=>{h=x(o(0),D),l=x(),D.length!==0&&(h=x(o(1),D),l=x())},P=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let D=0;const M=[];for(;D<e;){l=x();const z=l.slice();M.push(z),D+=l.length}return pm(...M)};return(D,M)=>{w(),A(D);let z;for(;!(z=M(P()));)A();return w(),z}}function rI(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(o,l,h){const s=t[o];if(h&&s===void 0)return;const w=typeof s;if(w!==l||s===null)throw new Error(`param "${o}" is invalid: expected ${l}, got ${w}`)}Object.entries(e).forEach(([o,l])=>i(o,l,!1)),Object.entries(n).forEach(([o,l])=>i(o,l,!0))}function Z7(t){const e=new WeakMap;return(n,...i)=>{const o=e.get(n);if(o!==void 0)return o;const l=t(n,...i);return e.set(n,l),l}}const rl=BigInt(0),Pc=BigInt(1),P0=BigInt(2),SZ=BigInt(3),IZ=BigInt(4),PZ=BigInt(5),Exe=BigInt(7),RZ=BigInt(8),Cxe=BigInt(9),OZ=BigInt(16);function Nl(t,e){const n=t%e;return n>=rl?n:e+n}function od(t,e,n){let i=t;for(;e-- >rl;)i*=i,i%=n;return i}function K7(t,e){if(t===rl)throw new Error("invert: expected non-zero number");if(e<=rl)throw new Error("invert: expected positive modulus, got "+e);let n=Nl(t,e),i=e,o=rl,l=Pc;for(;n!==rl;){const h=i/n,s=i%n,w=o-l*h;i=n,n=s,o=l,l=w}if(i!==Pc)throw new Error("invert: does not exist");return Nl(o,e)}function ID(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function kZ(t,e){const n=(t.ORDER+Pc)/IZ,i=t.pow(e,n);return ID(t,i,e),i}function Txe(t,e){const n=(t.ORDER-PZ)/RZ,i=t.mul(e,P0),o=t.pow(i,n),l=t.mul(e,o),h=t.mul(t.mul(l,P0),o),s=t.mul(l,t.sub(h,t.ONE));return ID(t,s,e),s}function Axe(t){const e=Xm(t),n=DZ(t),i=n(e,e.neg(e.ONE)),o=n(e,i),l=n(e,e.neg(i)),h=(t+Exe)/OZ;return(s,w)=>{let x=s.pow(w,h),A=s.mul(x,i);const P=s.mul(x,o),D=s.mul(x,l),M=s.eql(s.sqr(A),w),z=s.eql(s.sqr(P),w);x=s.cmov(x,A,M),A=s.cmov(D,P,z);const U=s.eql(s.sqr(A),w),G=s.cmov(x,A,U);return ID(s,G,w),G}}function DZ(t){if(t<SZ)throw new Error("sqrt is not defined for small field");let e=t-Pc,n=0;for(;e%P0===rl;)e/=P0,n++;let i=P0;const o=Xm(t);for(;Y7(o,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return kZ;let l=o.pow(i,e);const h=(e+Pc)/P0;return function(s,w){if(s.is0(w))return w;if(Y7(s,w)!==1)throw new Error("Cannot find square root");let x=n,A=s.mul(s.ONE,l),P=s.pow(w,e),D=s.pow(w,h);for(;!s.eql(P,s.ONE);){if(s.is0(P))return s.ZERO;let M=1,z=s.sqr(P);for(;!s.eql(z,s.ONE);)if(M++,z=s.sqr(z),M===x)throw new Error("Cannot find square root");const U=Pc<<BigInt(x-M-1),G=s.pow(A,U);x=M,A=s.sqr(G),P=s.mul(P,A),D=s.mul(D,G)}return D}}function Sxe(t){return t%IZ===SZ?kZ:t%RZ===PZ?Txe:t%OZ===Cxe?Axe(t):DZ(t)}const Ixe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pxe(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=Ixe.reduce((i,o)=>(i[o]="function",i),e);return rI(t,n),t}function Rxe(t,e,n){if(n<rl)throw new Error("invalid exponent, negatives unsupported");if(n===rl)return t.ONE;if(n===Pc)return e;let i=t.ONE,o=e;for(;n>rl;)n&Pc&&(i=t.mul(i,o)),o=t.sqr(o),n>>=Pc;return i}function NZ(t,e,n=!1){const i=new Array(e.length).fill(n?t.ZERO:void 0),o=e.reduce((h,s,w)=>t.is0(s)?h:(i[w]=h,t.mul(h,s)),t.ONE),l=t.inv(o);return e.reduceRight((h,s,w)=>t.is0(s)?h:(i[w]=t.mul(h,i[w]),t.mul(h,s)),l),i}function Y7(t,e){const n=(t.ORDER-Pc)/P0,i=t.pow(e,n),o=t.eql(i,t.ONE),l=t.eql(i,t.ZERO),h=t.eql(i,t.neg(t.ONE));if(!o&&!l&&!h)throw new Error("invalid Legendre symbol result");return o?1:l?0:-1}function MZ(t,e){e!==void 0&&Wf(e);const n=e!==void 0?e:t.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function Xm(t,e,n=!1,i={}){if(t<=rl)throw new Error("invalid field: expected ORDER > 0, got "+t);let o,l,h=!1,s;if(typeof e=="object"&&e!=null){if(i.sqrt||n)throw new Error("cannot specify opts in two arguments");const D=e;D.BITS&&(o=D.BITS),D.sqrt&&(l=D.sqrt),typeof D.isLE=="boolean"&&(n=D.isLE),typeof D.modFromBytes=="boolean"&&(h=D.modFromBytes),s=D.allowedLengths}else typeof e=="number"&&(o=e),i.sqrt&&(l=i.sqrt);const{nBitLength:w,nByteLength:x}=MZ(t,o);if(x>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let A;const P=Object.freeze({ORDER:t,isLE:n,BITS:w,BYTES:x,MASK:ME(w),ZERO:rl,ONE:Pc,allowedLengths:s,create:D=>Nl(D,t),isValid:D=>{if(typeof D!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof D);return rl<=D&&D<t},is0:D=>D===rl,isValidNot0:D=>!P.is0(D)&&P.isValid(D),isOdd:D=>(D&Pc)===Pc,neg:D=>Nl(-D,t),eql:(D,M)=>D===M,sqr:D=>Nl(D*D,t),add:(D,M)=>Nl(D+M,t),sub:(D,M)=>Nl(D-M,t),mul:(D,M)=>Nl(D*M,t),pow:(D,M)=>Rxe(P,D,M),div:(D,M)=>Nl(D*K7(M,t),t),sqrN:D=>D*D,addN:(D,M)=>D+M,subN:(D,M)=>D-M,mulN:(D,M)=>D*M,inv:D=>K7(D,t),sqrt:l||(D=>(A||(A=Sxe(t)),A(P,D))),toBytes:D=>n?SD(D,x):AD(D,x),fromBytes:(D,M=!0)=>{if(s){if(!s.includes(D.length)||D.length>x)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+D.length);const U=new Uint8Array(x);U.set(D,n?0:U.length-D.length),D=U}if(D.length!==x)throw new Error("Field.fromBytes: expected "+x+" bytes, got "+D.length);let z=n?FA(D):iI(D);if(h&&(z=Nl(z,t)),!M&&!P.isValid(z))throw new Error("invalid field element: outside of range 0..ORDER");return z},invertBatch:D=>NZ(P,D),cmov:(D,M,z)=>z?M:D});return Object.freeze(P)}function LZ(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function BZ(t){const e=LZ(t);return e+Math.ceil(e/2)}function Oxe(t,e,n=!1){const i=t.length,o=LZ(e),l=BZ(e);if(i<16||i<l||i>1024)throw new Error("expected "+l+"-1024 bytes of input, got "+i);const h=n?FA(t):iI(t),s=Nl(h,e-Pc)+Pc;return n?SD(s,o):AD(s,o)}const hw=BigInt(0),R0=BigInt(1);function $A(t,e){const n=e.negate();return t?n:e}function $P(t,e){const n=NZ(t.Fp,e.map(i=>i.Z));return e.map((i,o)=>t.fromAffine(i.toAffine(n[o])))}function FZ(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function zP(t,e){FZ(t,e);const n=Math.ceil(e/t)+1,i=2**(t-1),o=2**t,l=ME(t),h=BigInt(t);return{windows:n,windowSize:i,mask:l,maxNumber:o,shiftBy:h}}function X7(t,e,n){const{windowSize:i,mask:o,maxNumber:l,shiftBy:h}=n;let s=Number(t&o),w=t>>h;s>i&&(s-=l,w+=R0);const x=e*i,A=x+Math.abs(s)-1,P=s===0,D=s<0,M=e%2!==0;return{nextN:w,offset:A,isZero:P,isNeg:D,isNegF:M,offsetF:x}}function kxe(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,i)=>{if(!(n instanceof e))throw new Error("invalid point at index "+i)})}function Dxe(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,i)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+i)})}const UP=new WeakMap,$Z=new WeakMap;function jP(t){return $Z.get(t)||1}function J7(t){if(t!==hw)throw new Error("invalid wNAF")}class Nxe{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,i=this.ZERO){let o=e;for(;n>hw;)n&R0&&(i=i.add(o)),o=o.double(),n>>=R0;return i}precomputeWindow(e,n){const{windows:i,windowSize:o}=zP(n,this.bits),l=[];let h=e,s=h;for(let w=0;w<i;w++){s=h,l.push(s);for(let x=1;x<o;x++)s=s.add(h),l.push(s);h=s.double()}return l}wNAF(e,n,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let o=this.ZERO,l=this.BASE;const h=zP(e,this.bits);for(let s=0;s<h.windows;s++){const{nextN:w,offset:x,isZero:A,isNeg:P,isNegF:D,offsetF:M}=X7(i,s,h);i=w,A?l=l.add($A(D,n[M])):o=o.add($A(P,n[x]))}return J7(i),{p:o,f:l}}wNAFUnsafe(e,n,i,o=this.ZERO){const l=zP(e,this.bits);for(let h=0;h<l.windows&&i!==hw;h++){const{nextN:s,offset:w,isZero:x,isNeg:A}=X7(i,h,l);if(i=s,!x){const P=n[w];o=o.add(A?P.negate():P)}}return J7(i),o}getPrecomputes(e,n,i){let o=UP.get(n);return o||(o=this.precomputeWindow(n,e),e!==1&&(typeof i=="function"&&(o=i(o)),UP.set(n,o))),o}cached(e,n,i){const o=jP(e);return this.wNAF(o,this.getPrecomputes(o,e,i),n)}unsafe(e,n,i,o){const l=jP(e);return l===1?this._unsafeLadder(e,n,o):this.wNAFUnsafe(l,this.getPrecomputes(l,e,i),n,o)}createCache(e,n){FZ(n,this.bits),$Z.set(e,n),UP.delete(e)}hasCache(e){return jP(e)!==1}}function Mxe(t,e,n,i){let o=e,l=t.ZERO,h=t.ZERO;for(;n>hw||i>hw;)n&R0&&(l=l.add(o)),i&R0&&(h=h.add(o)),o=o.double(),n>>=R0,i>>=R0;return{p1:l,p2:h}}function Lxe(t,e,n,i){kxe(n,t),Dxe(i,e);const o=n.length,l=i.length;if(o!==l)throw new Error("arrays of points and scalars must have equal length");const h=t.ZERO,s=AZ(BigInt(o));let w=1;s>12?w=s-3:s>4?w=s-2:s>0&&(w=2);const x=ME(w),A=new Array(Number(x)+1).fill(h),P=Math.floor((e.BITS-1)/w)*w;let D=h;for(let M=P;M>=0;M-=w){A.fill(h);for(let U=0;U<l;U++){const G=i[U],ne=Number(G>>BigInt(M)&x);A[ne]=A[ne].add(n[U])}let z=h;for(let U=A.length-1,G=h;U>0;U--)G=G.add(A[U]),z=z.add(G);if(D=D.add(z),M!==0)for(let U=0;U<w;U++)D=D.double()}return D}function Q7(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Pxe(e),e}else return Xm(t,{isLE:n})}function Bxe(t,e,n={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const s of["p","n","h"]){const w=e[s];if(!(typeof w=="bigint"&&w>hw))throw new Error(`CURVE.${s} must be positive bigint`)}const o=Q7(e.p,n.Fp,i),l=Q7(e.n,n.Fn,i),h=["Gx","Gy","a","b"];for(const s of h)if(!o.isValid(e[s]))throw new Error(`CURVE.${s} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:l}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),cZ("HashToScalar-");const wx=BigInt(0),g1=BigInt(1),dT=BigInt(2);function Fxe(t){return rI(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function $xe(t){const e=Fxe(t),{P:n,type:i,adjustScalarBytes:o,powPminus2:l,randomBytes:h}=e,s=i==="x25519";if(!s&&i!=="x448")throw new Error("invalid type");const w=h||Oy,x=s?255:448,A=s?32:56,P=BigInt(s?9:5),D=BigInt(s?121665:39081),M=s?dT**BigInt(254):dT**BigInt(447),z=s?BigInt(8)*dT**BigInt(251)-g1:BigInt(4)*dT**BigInt(445)-g1,U=M+z+g1,G=ct=>Nl(ct,n),ne=oe(P);function oe(ct){return SD(G(ct),A)}function Q(ct){const je=Ka("u coordinate",ct,A);return s&&(je[31]&=127),G(FA(je))}function de(ct){return FA(o(Ka("scalar",ct,A)))}function he(ct,je){const Ye=Ue(Q(je),de(ct));if(Ye===wx)throw new Error("invalid private or public key received");return oe(Ye)}function Ie(ct){return he(ct,ne)}function ke(ct,je,Ye){const re=G(ct*(je-Ye));return je=G(je-re),Ye=G(Ye+re),{x_2:je,x_3:Ye}}function Ue(ct,je){K8("u",ct,wx,n),K8("scalar",je,M,U);const Ye=je,re=ct;let le=g1,Ae=wx,Le=ct,De=g1,He=wx;for(let Ct=BigInt(x-1);Ct>=wx;Ct--){const Dt=Ye>>Ct&g1;He^=Dt,{x_2:le,x_3:Le}=ke(He,le,Le),{x_2:Ae,x_3:De}=ke(He,Ae,De),He=Dt;const Bt=le+Ae,Yt=G(Bt*Bt),yn=le-Ae,mn=G(yn*yn),oi=Yt-mn,sn=Le+De,_n=Le-De,ai=G(_n*Bt),er=G(sn*yn),ui=ai+er,Yr=ai-er;Le=G(ui*ui),De=G(re*G(Yr*Yr)),le=G(Yt*mn),Ae=G(oi*(Yt+G(D*oi)))}({x_2:le,x_3:Le}=ke(He,le,Le)),{x_2:Ae,x_3:De}=ke(He,Ae,De);const Et=l(Ae);return G(le*Et)}const ze={secretKey:A,publicKey:A,seed:A},ht=(ct=w(A))=>(vd(ct,ze.seed),ct);function ft(ct){const je=ht(ct);return{secretKey:je,publicKey:Ie(je)}}return{keygen:ft,getSharedSecret:(ct,je)=>he(ct,je),getPublicKey:ct=>Ie(ct),scalarMult:he,scalarMultBase:Ie,utils:{randomSecretKey:ht,randomPrivateKey:ht},GuBytes:ne.slice(),lengths:ze}}const zxe=BigInt(1),ez=BigInt(2),Uxe=BigInt(3),jxe=BigInt(5);BigInt(8);const zZ=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Vxe={p:zZ,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Wxe(t){const e=BigInt(10),n=BigInt(20),i=BigInt(40),o=BigInt(80),l=zZ,h=t*t%l*t%l,s=od(h,ez,l)*h%l,w=od(s,zxe,l)*t%l,x=od(w,jxe,l)*w%l,A=od(x,e,l)*x%l,P=od(A,n,l)*A%l,D=od(P,i,l)*P%l,M=od(D,o,l)*D%l,z=od(M,o,l)*D%l,U=od(z,e,l)*x%l;return{pow_p_5_8:od(U,ez,l)*t%l,b2:h}}function Hxe(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Gxe=Xm(Vxe.p,{isLE:!0}),Y8=(()=>{const t=Gxe.ORDER;return $xe({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:i}=Wxe(e);return Nl(od(n,Uxe,t)*i,t)},adjustScalarBytes:Hxe})})(),tz=(t,e)=>(t+(t>=0?e:-e)/UZ)/e;function qxe(t,e,n){const[[i,o],[l,h]]=e,s=tz(h*t,n),w=tz(-o*t,n);let x=t-s*i-w*l,A=-s*o-w*h;const P=x<Mf,D=A<Mf;P&&(x=-x),D&&(A=-A);const M=ME(Math.ceil(AZ(n)/2))+W1;if(x<Mf||x>=M||A<Mf||A>=M)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:P,k1:x,k2neg:D,k2:A}}function X8(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function VP(t,e){const n={};for(let i of Object.keys(e))n[i]=t[i]===void 0?e[i]:t[i];return BA(n.lowS,"lowS"),BA(n.prehash,"prehash"),n.format!==void 0&&X8(n.format),n}class Zxe extends Error{constructor(e=""){super(e)}}const kf={Err:Zxe,_tlv:{encode:(t,e)=>{const{Err:n}=kf;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const i=e.length/2,o=uT(i);if(o.length/2&128)throw new n("tlv.encode: long form length too big");const l=i>127?uT(o.length/2|128):"";return uT(t)+l+o+e},decode(t,e){const{Err:n}=kf;let i=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new n("tlv.decode: wrong tlv");const o=e[i++],l=!!(o&128);let h=0;if(!l)h=o;else{const w=o&127;if(!w)throw new n("tlv.decode(long): indefinite length not supported");if(w>4)throw new n("tlv.decode(long): byte length is too big");const x=e.subarray(i,i+w);if(x.length!==w)throw new n("tlv.decode: length bytes not complete");if(x[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const A of x)h=h<<8|A;if(i+=w,h<128)throw new n("tlv.decode(long): not minimal encoding")}const s=e.subarray(i,i+h);if(s.length!==h)throw new n("tlv.decode: wrong value length");return{v:s,l:e.subarray(i+h)}}},_int:{encode(t){const{Err:e}=kf;if(t<Mf)throw new e("integer: negative integers are not allowed");let n=uT(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=kf;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return iI(t)}},toSig(t){const{Err:e,_int:n,_tlv:i}=kf,o=Ka("signature",t),{v:l,l:h}=i.decode(48,o);if(h.length)throw new e("invalid signature: left bytes after parsing");const{v:s,l:w}=i.decode(2,l),{v:x,l:A}=i.decode(2,w);if(A.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(s),s:n.decode(x)}},hexFromSig(t){const{_tlv:e,_int:n}=kf,i=e.encode(2,n.encode(t.r)),o=e.encode(2,n.encode(t.s)),l=i+o;return e.encode(48,l)}},Mf=BigInt(0),W1=BigInt(1),UZ=BigInt(2),hT=BigInt(3),Kxe=BigInt(4);function A1(t,e){const{BYTES:n}=t;let i;if(typeof e=="bigint")i=e;else{let o=Ka("private key",e);try{i=t.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function Yxe(t,e={}){const n=Bxe("weierstrass",t,e),{Fp:i,Fn:o}=n;let l=n.CURVE;const{h,n:s}=l;rI(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:w}=e;if(w&&(!i.is0(l.a)||typeof w.beta!="bigint"||!Array.isArray(w.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const x=VZ(i,o);function A(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function P(ct,je,Ye){const{x:re,y:le}=je.toAffine(),Ae=i.toBytes(re);if(BA(Ye,"isCompressed"),Ye){A();const Le=!i.isOdd(le);return pm(jZ(Le),Ae)}else return pm(Uint8Array.of(4),Ae,i.toBytes(le))}function D(ct){I0(ct,void 0,"Point");const{publicKey:je,publicKeyUncompressed:Ye}=x,re=ct.length,le=ct[0],Ae=ct.subarray(1);if(re===je&&(le===2||le===3)){const Le=i.fromBytes(Ae);if(!i.isValid(Le))throw new Error("bad point: is not on curve, wrong x");const De=U(Le);let He;try{He=i.sqrt(De)}catch(Ct){const Dt=Ct instanceof Error?": "+Ct.message:"";throw new Error("bad point: is not on curve, sqrt error"+Dt)}A();const Et=i.isOdd(He);return(le&1)===1!==Et&&(He=i.neg(He)),{x:Le,y:He}}else if(re===Ye&&le===4){const Le=i.BYTES,De=i.fromBytes(Ae.subarray(0,Le)),He=i.fromBytes(Ae.subarray(Le,Le*2));if(!G(De,He))throw new Error("bad point: is not on curve");return{x:De,y:He}}else throw new Error(`bad point: got length ${re}, expected compressed=${je} or uncompressed=${Ye}`)}const M=e.toBytes||P,z=e.fromBytes||D;function U(ct){const je=i.sqr(ct),Ye=i.mul(je,ct);return i.add(i.add(Ye,i.mul(ct,l.a)),l.b)}function G(ct,je){const Ye=i.sqr(je),re=U(ct);return i.eql(Ye,re)}if(!G(l.Gx,l.Gy))throw new Error("bad curve params: generator point");const ne=i.mul(i.pow(l.a,hT),Kxe),oe=i.mul(i.sqr(l.b),BigInt(27));if(i.is0(i.add(ne,oe)))throw new Error("bad curve params: a or b");function Q(ct,je,Ye=!1){if(!i.isValid(je)||Ye&&i.is0(je))throw new Error(`bad point coordinate ${ct}`);return je}function de(ct){if(!(ct instanceof ze))throw new Error("ProjectivePoint expected")}function he(ct){if(!w||!w.basises)throw new Error("no endo");return qxe(ct,w.basises,o.ORDER)}const Ie=Z7((ct,je)=>{const{X:Ye,Y:re,Z:le}=ct;if(i.eql(le,i.ONE))return{x:Ye,y:re};const Ae=ct.is0();je==null&&(je=Ae?i.ONE:i.inv(le));const Le=i.mul(Ye,je),De=i.mul(re,je),He=i.mul(le,je);if(Ae)return{x:i.ZERO,y:i.ZERO};if(!i.eql(He,i.ONE))throw new Error("invZ was invalid");return{x:Le,y:De}}),ke=Z7(ct=>{if(ct.is0()){if(e.allowInfinityPoint&&!i.is0(ct.Y))return;throw new Error("bad point: ZERO")}const{x:je,y:Ye}=ct.toAffine();if(!i.isValid(je)||!i.isValid(Ye))throw new Error("bad point: x or y not field elements");if(!G(je,Ye))throw new Error("bad point: equation left != right");if(!ct.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Ue(ct,je,Ye,re,le){return Ye=new ze(i.mul(Ye.X,ct),Ye.Y,Ye.Z),je=$A(re,je),Ye=$A(le,Ye),je.add(Ye)}class ze{constructor(je,Ye,re){this.X=Q("x",je),this.Y=Q("y",Ye,!0),this.Z=Q("z",re),Object.freeze(this)}static CURVE(){return l}static fromAffine(je){const{x:Ye,y:re}=je||{};if(!je||!i.isValid(Ye)||!i.isValid(re))throw new Error("invalid affine point");if(je instanceof ze)throw new Error("projective point not allowed");return i.is0(Ye)&&i.is0(re)?ze.ZERO:new ze(Ye,re,i.ONE)}static fromBytes(je){const Ye=ze.fromAffine(z(I0(je,void 0,"point")));return Ye.assertValidity(),Ye}static fromHex(je){return ze.fromBytes(Ka("pointHex",je))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(je=8,Ye=!0){return ft.createCache(this,je),Ye||this.multiply(hT),this}assertValidity(){ke(this)}hasEvenY(){const{y:je}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(je)}equals(je){de(je);const{X:Ye,Y:re,Z:le}=this,{X:Ae,Y:Le,Z:De}=je,He=i.eql(i.mul(Ye,De),i.mul(Ae,le)),Et=i.eql(i.mul(re,De),i.mul(Le,le));return He&&Et}negate(){return new ze(this.X,i.neg(this.Y),this.Z)}double(){const{a:je,b:Ye}=l,re=i.mul(Ye,hT),{X:le,Y:Ae,Z:Le}=this;let De=i.ZERO,He=i.ZERO,Et=i.ZERO,Ct=i.mul(le,le),Dt=i.mul(Ae,Ae),Bt=i.mul(Le,Le),Yt=i.mul(le,Ae);return Yt=i.add(Yt,Yt),Et=i.mul(le,Le),Et=i.add(Et,Et),De=i.mul(je,Et),He=i.mul(re,Bt),He=i.add(De,He),De=i.sub(Dt,He),He=i.add(Dt,He),He=i.mul(De,He),De=i.mul(Yt,De),Et=i.mul(re,Et),Bt=i.mul(je,Bt),Yt=i.sub(Ct,Bt),Yt=i.mul(je,Yt),Yt=i.add(Yt,Et),Et=i.add(Ct,Ct),Ct=i.add(Et,Ct),Ct=i.add(Ct,Bt),Ct=i.mul(Ct,Yt),He=i.add(He,Ct),Bt=i.mul(Ae,Le),Bt=i.add(Bt,Bt),Ct=i.mul(Bt,Yt),De=i.sub(De,Ct),Et=i.mul(Bt,Dt),Et=i.add(Et,Et),Et=i.add(Et,Et),new ze(De,He,Et)}add(je){de(je);const{X:Ye,Y:re,Z:le}=this,{X:Ae,Y:Le,Z:De}=je;let He=i.ZERO,Et=i.ZERO,Ct=i.ZERO;const Dt=l.a,Bt=i.mul(l.b,hT);let Yt=i.mul(Ye,Ae),yn=i.mul(re,Le),mn=i.mul(le,De),oi=i.add(Ye,re),sn=i.add(Ae,Le);oi=i.mul(oi,sn),sn=i.add(Yt,yn),oi=i.sub(oi,sn),sn=i.add(Ye,le);let _n=i.add(Ae,De);return sn=i.mul(sn,_n),_n=i.add(Yt,mn),sn=i.sub(sn,_n),_n=i.add(re,le),He=i.add(Le,De),_n=i.mul(_n,He),He=i.add(yn,mn),_n=i.sub(_n,He),Ct=i.mul(Dt,sn),He=i.mul(Bt,mn),Ct=i.add(He,Ct),He=i.sub(yn,Ct),Ct=i.add(yn,Ct),Et=i.mul(He,Ct),yn=i.add(Yt,Yt),yn=i.add(yn,Yt),mn=i.mul(Dt,mn),sn=i.mul(Bt,sn),yn=i.add(yn,mn),mn=i.sub(Yt,mn),mn=i.mul(Dt,mn),sn=i.add(sn,mn),Yt=i.mul(yn,sn),Et=i.add(Et,Yt),Yt=i.mul(_n,sn),He=i.mul(oi,He),He=i.sub(He,Yt),Yt=i.mul(oi,yn),Ct=i.mul(_n,Ct),Ct=i.add(Ct,Yt),new ze(He,Et,Ct)}subtract(je){return this.add(je.negate())}is0(){return this.equals(ze.ZERO)}multiply(je){const{endo:Ye}=e;if(!o.isValidNot0(je))throw new Error("invalid scalar: out of range");let re,le;const Ae=Le=>ft.cached(this,Le,De=>$P(ze,De));if(Ye){const{k1neg:Le,k1:De,k2neg:He,k2:Et}=he(je),{p:Ct,f:Dt}=Ae(De),{p:Bt,f:Yt}=Ae(Et);le=Dt.add(Yt),re=Ue(Ye.beta,Ct,Bt,Le,He)}else{const{p:Le,f:De}=Ae(je);re=Le,le=De}return $P(ze,[re,le])[0]}multiplyUnsafe(je){const{endo:Ye}=e,re=this;if(!o.isValid(je))throw new Error("invalid scalar: out of range");if(je===Mf||re.is0())return ze.ZERO;if(je===W1)return re;if(ft.hasCache(this))return this.multiply(je);if(Ye){const{k1neg:le,k1:Ae,k2neg:Le,k2:De}=he(je),{p1:He,p2:Et}=Mxe(ze,re,Ae,De);return Ue(Ye.beta,He,Et,le,Le)}else return ft.unsafe(re,je)}multiplyAndAddUnsafe(je,Ye,re){const le=this.multiplyUnsafe(Ye).add(je.multiplyUnsafe(re));return le.is0()?void 0:le}toAffine(je){return Ie(this,je)}isTorsionFree(){const{isTorsionFree:je}=e;return h===W1?!0:je?je(ze,this):ft.unsafe(this,s).is0()}clearCofactor(){const{clearCofactor:je}=e;return h===W1?this:je?je(ze,this):this.multiplyUnsafe(h)}isSmallOrder(){return this.multiplyUnsafe(h).is0()}toBytes(je=!0){return BA(je,"isCompressed"),this.assertValidity(),M(ze,this,je)}toHex(je=!0){return V1(this.toBytes(je))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(je=!0){return this.toBytes(je)}_setWindowSize(je){this.precompute(je)}static normalizeZ(je){return $P(ze,je)}static msm(je,Ye){return Lxe(ze,o,je,Ye)}static fromPrivateKey(je){return ze.BASE.multiply(A1(o,je))}}ze.BASE=new ze(l.Gx,l.Gy,i.ONE),ze.ZERO=new ze(i.ZERO,i.ONE,i.ZERO),ze.Fp=i,ze.Fn=o;const ht=o.BITS,ft=new Nxe(ze,e.endo?Math.ceil(ht/2):ht);return ze.BASE.precompute(8),ze}function jZ(t){return Uint8Array.of(t?2:3)}function VZ(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Xxe(t,e={}){const{Fn:n}=t,i=e.randomBytes||Oy,o=Object.assign(VZ(t.Fp,n),{seed:BZ(n.ORDER)});function l(D){try{return!!A1(n,D)}catch{return!1}}function h(D,M){const{publicKey:z,publicKeyUncompressed:U}=o;try{const G=D.length;return M===!0&&G!==z||M===!1&&G!==U?!1:!!t.fromBytes(D)}catch{return!1}}function s(D=i(o.seed)){return Oxe(I0(D,o.seed,"seed"),n.ORDER)}function w(D,M=!0){return t.BASE.multiply(A1(n,D)).toBytes(M)}function x(D){const M=s(D);return{secretKey:M,publicKey:w(M)}}function A(D){if(typeof D=="bigint")return!1;if(D instanceof t)return!0;const{secretKey:M,publicKey:z,publicKeyUncompressed:U}=o;if(n.allowedLengths||M===z)return;const G=Ka("key",D).length;return G===z||G===U}function P(D,M,z=!0){if(A(D)===!0)throw new Error("first arg must be private key");if(A(M)===!1)throw new Error("second arg must be public key");const U=A1(n,D);return t.fromHex(M).multiply(U).toBytes(z)}return Object.freeze({getPublicKey:w,getSharedSecret:P,keygen:x,Point:t,utils:{isValidSecretKey:l,isValidPublicKey:h,randomSecretKey:s,isValidPrivateKey:l,randomPrivateKey:s,normPrivateKeyToScalar:D=>A1(n,D),precompute(D=8,M=t.BASE){return M.precompute(D,!1)}},lengths:o})}function Jxe(t,e,n={}){XS(e),rI(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=n.randomBytes||Oy,o=n.hmac||((Ye,...re)=>tI(e,Ye,pm(...re))),{Fp:l,Fn:h}=t,{ORDER:s,BITS:w}=h,{keygen:x,getPublicKey:A,getSharedSecret:P,utils:D,lengths:M}=Xxe(t,n),z={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},U="compact";function G(Ye){const re=s>>W1;return Ye>re}function ne(Ye,re){if(!h.isValidNot0(re))throw new Error(`invalid signature ${Ye}: out of range 1..Point.Fn.ORDER`);return re}function oe(Ye,re){X8(re);const le=M.signature,Ae=re==="compact"?le:re==="recovered"?le+1:void 0;return I0(Ye,Ae,`${re} signature`)}class Q{constructor(re,le,Ae){this.r=ne("r",re),this.s=ne("s",le),Ae!=null&&(this.recovery=Ae),Object.freeze(this)}static fromBytes(re,le=U){oe(re,le);let Ae;if(le==="der"){const{r:Et,s:Ct}=kf.toSig(I0(re));return new Q(Et,Ct)}le==="recovered"&&(Ae=re[0],le="compact",re=re.subarray(1));const Le=h.BYTES,De=re.subarray(0,Le),He=re.subarray(Le,Le*2);return new Q(h.fromBytes(De),h.fromBytes(He),Ae)}static fromHex(re,le){return this.fromBytes(MA(re),le)}addRecoveryBit(re){return new Q(this.r,this.s,re)}recoverPublicKey(re){const le=l.ORDER,{r:Ae,s:Le,recovery:De}=this;if(De==null||![0,1,2,3].includes(De))throw new Error("recovery id invalid");if(s*UZ<le&&De>1)throw new Error("recovery id is ambiguous for h>1 curve");const He=De===2||De===3?Ae+s:Ae;if(!l.isValid(He))throw new Error("recovery id 2 or 3 invalid");const Et=l.toBytes(He),Ct=t.fromBytes(pm(jZ((De&1)===0),Et)),Dt=h.inv(He),Bt=he(Ka("msgHash",re)),Yt=h.create(-Bt*Dt),yn=h.create(Le*Dt),mn=t.BASE.multiplyUnsafe(Yt).add(Ct.multiplyUnsafe(yn));if(mn.is0())throw new Error("point at infinify");return mn.assertValidity(),mn}hasHighS(){return G(this.s)}toBytes(re=U){if(X8(re),re==="der")return MA(kf.hexFromSig(this));const le=h.toBytes(this.r),Ae=h.toBytes(this.s);if(re==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return pm(Uint8Array.of(this.recovery),le,Ae)}return pm(le,Ae)}toHex(re){return V1(this.toBytes(re))}assertValidity(){}static fromCompact(re){return Q.fromBytes(Ka("sig",re),"compact")}static fromDER(re){return Q.fromBytes(Ka("sig",re),"der")}normalizeS(){return this.hasHighS()?new Q(this.r,h.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return V1(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return V1(this.toBytes("compact"))}}const de=n.bits2int||function(Ye){if(Ye.length>8192)throw new Error("input is too large");const re=iI(Ye),le=Ye.length*8-w;return le>0?re>>BigInt(le):re},he=n.bits2int_modN||function(Ye){return h.create(de(Ye))},Ie=ME(w);function ke(Ye){return K8("num < 2^"+w,Ye,Mf,Ie),h.toBytes(Ye)}function Ue(Ye,re){return I0(Ye,void 0,"message"),re?I0(e(Ye),void 0,"prehashed message"):Ye}function ze(Ye,re,le){if(["recovered","canonical"].some(yn=>yn in le))throw new Error("sign() legacy options not supported");const{lowS:Ae,prehash:Le,extraEntropy:De}=VP(le,z);Ye=Ue(Ye,Le);const He=he(Ye),Et=A1(h,re),Ct=[ke(Et),ke(He)];if(De!=null&&De!==!1){const yn=De===!0?i(M.secretKey):De;Ct.push(Ka("extraEntropy",yn))}const Dt=pm(...Ct),Bt=He;function Yt(yn){const mn=de(yn);if(!h.isValidNot0(mn))return;const oi=h.inv(mn),sn=t.BASE.multiply(mn).toAffine(),_n=h.create(sn.x);if(_n===Mf)return;const ai=h.create(oi*h.create(Bt+_n*Et));if(ai===Mf)return;let er=(sn.x===_n?0:2)|Number(sn.y&W1),ui=ai;return Ae&&G(ai)&&(ui=h.neg(ai),er^=1),new Q(_n,ui,er)}return{seed:Dt,k2sig:Yt}}function ht(Ye,re,le={}){Ye=Ka("message",Ye);const{seed:Ae,k2sig:Le}=ze(Ye,re,le);return xxe(e.outputLen,h.BYTES,o)(Ae,Le)}function ft(Ye){let re;const le=typeof Ye=="string"||YS(Ye),Ae=!le&&Ye!==null&&typeof Ye=="object"&&typeof Ye.r=="bigint"&&typeof Ye.s=="bigint";if(!le&&!Ae)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Ae)re=new Q(Ye.r,Ye.s);else if(le){try{re=Q.fromBytes(Ka("sig",Ye),"der")}catch(Le){if(!(Le instanceof kf.Err))throw Le}if(!re)try{re=Q.fromBytes(Ka("sig",Ye),"compact")}catch{return!1}}return re||!1}function ct(Ye,re,le,Ae={}){const{lowS:Le,prehash:De,format:He}=VP(Ae,z);if(le=Ka("publicKey",le),re=Ue(Ka("message",re),De),"strict"in Ae)throw new Error("options.strict was renamed to lowS");const Et=He===void 0?ft(Ye):Q.fromBytes(Ka("sig",Ye),He);if(Et===!1)return!1;try{const Ct=t.fromBytes(le);if(Le&&Et.hasHighS())return!1;const{r:Dt,s:Bt}=Et,Yt=he(re),yn=h.inv(Bt),mn=h.create(Yt*yn),oi=h.create(Dt*yn),sn=t.BASE.multiplyUnsafe(mn).add(Ct.multiplyUnsafe(oi));return sn.is0()?!1:h.create(sn.x)===Dt}catch{return!1}}function je(Ye,re,le={}){const{prehash:Ae}=VP(le,z);return re=Ue(re,Ae),Q.fromBytes(Ye,"recovered").recoverPublicKey(re).toBytes()}return Object.freeze({keygen:x,getPublicKey:A,getSharedSecret:P,utils:D,lengths:M,Point:t,sign:ht,verify:ct,recoverPublicKey:je,Signature:Q,hash:e})}function Qxe(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(h=>Math.ceil(h/2)))):void 0;const o=Xm(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),l={Fp:n,Fn:o,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:l}}function e2e(t){const{CURVE:e,curveOpts:n}=Qxe(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:i}}function t2e(t,e){const n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,MZ(n.Fn.ORDER,n.Fn.BITS))})}function n2e(t){const{CURVE:e,curveOpts:n,hash:i,ecdsaOpts:o}=e2e(t),l=Yxe(e,n),h=Jxe(l,i,o);return t2e(t,h)}function J8(t,e){const n=i=>n2e({...t,hash:i});return{...n(e),create:n}}const WZ={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},HZ={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},GZ={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},i2e=Xm(WZ.p),r2e=Xm(HZ.p),s2e=Xm(GZ.p),o2e=J8({...WZ,Fp:i2e,lowS:!1},QS);J8({...HZ,Fp:r2e,lowS:!1},dve),J8({...GZ,Fp:s2e,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},uve);const a2e=o2e,qZ="base10",Rc="base16",tl="base64pad",mm="base64url",LE="utf8",ZZ=0,$f=1,BE=2,c2e=0,nz=1,jx=12,PD=32;function l2e(){const t=Y8.utils.randomPrivateKey(),e=Y8.getPublicKey(t);return{privateKey:ol(t,Rc),publicKey:ol(e,Rc)}}function Q8(){const t=Oy(PD);return ol(t,Rc)}function u2e(t,e){const n=Y8.getSharedSecret(xu(t,Rc),xu(e,Rc)),i=bxe(nI,n,void 0,void 0,PD);return ol(i,Rc)}function VT(t){const e=nI(xu(t,Rc));return ol(e,Rc)}function wu(t){const e=nI(xu(t,LE));return ol(e,Rc)}function KZ(t){return xu(`${t}`,qZ)}function ny(t){return Number(ol(t,qZ))}function YZ(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function XZ(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function d2e(t){const e=KZ(typeof t.type<"u"?t.type:ZZ);if(ny(e)===$f&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?xu(t.senderPublicKey,Rc):void 0,i=typeof t.iv<"u"?xu(t.iv,Rc):Oy(jx),o=xu(t.symKey,Rc),l=EZ(o,i).encrypt(xu(t.message,LE)),h=JZ({type:e,sealed:l,iv:i,senderPublicKey:n});return t.encoding===mm?YZ(h):h}function h2e(t){const e=xu(t.symKey,Rc),{sealed:n,iv:i}=j2({encoded:t.encoded,encoding:t.encoding}),o=EZ(e,i).decrypt(n);if(o===null)throw new Error("Failed to decrypt");return ol(o,LE)}function f2e(t,e){const n=KZ(BE),i=Oy(jx),o=xu(t,LE),l=JZ({type:n,sealed:o,iv:i});return e===mm?YZ(l):l}function p2e(t,e){const{sealed:n}=j2({encoded:t,encoding:e});return ol(n,LE)}function JZ(t){if(ny(t.type)===BE)return ol(Ux([t.type,t.sealed]),tl);if(ny(t.type)===$f){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ol(Ux([t.type,t.senderPublicKey,t.iv,t.sealed]),tl)}return ol(Ux([t.type,t.iv,t.sealed]),tl)}function j2(t){const e=(t.encoding||tl)===mm?XZ(t.encoded):t.encoded,n=xu(e,tl),i=n.slice(c2e,nz),o=nz;if(ny(i)===$f){const w=o+PD,x=w+jx,A=n.slice(o,w),P=n.slice(w,x),D=n.slice(x);return{type:i,sealed:D,iv:P,senderPublicKey:A}}if(ny(i)===BE){const w=n.slice(o),x=Oy(jx);return{type:i,sealed:w,iv:x}}const l=o+jx,h=n.slice(o,l),s=n.slice(l);return{type:i,sealed:s,iv:h}}function m2e(t,e){const n=j2({encoded:t,encoding:e==null?void 0:e.encoding});return QZ({type:ny(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?ol(n.senderPublicKey,Rc):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function QZ(t){const e=(t==null?void 0:t.type)||ZZ;if(e===$f){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function iz(t){return t.type===$f&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function rz(t){return t.type===BE}function g2e(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return Ux([new Uint8Array([4]),e,n])}function y2e(t,e){const[n,i,o]=t.split("."),l=Buffer.from(XZ(o),"base64");if(l.length!==64)throw new Error("Invalid signature length");const h=l.slice(0,32),s=l.slice(32,64),w=`${n}.${i}`,x=nI(w),A=g2e(e);if(!a2e.verify(Ux([h,s]),x,A))throw new Error("Invalid signature");return M8(t).payload}const _2e="irn";function zA(t){return(t==null?void 0:t.relay)||{protocol:_2e}}function S1(t){const e=Wwe[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var w2e=Object.defineProperty,b2e=Object.defineProperties,v2e=Object.getOwnPropertyDescriptors,sz=Object.getOwnPropertySymbols,x2e=Object.prototype.hasOwnProperty,E2e=Object.prototype.propertyIsEnumerable,oz=(t,e,n)=>e in t?w2e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,WP=(t,e)=>{for(var n in e||(e={}))x2e.call(e,n)&&oz(t,n,e[n]);if(sz)for(var n of sz(e))E2e.call(e,n)&&oz(t,n,e[n]);return t},C2e=(t,e)=>b2e(t,v2e(e));function T2e(t,e="-"){const n={},i="relay"+e;return Object.keys(t).forEach(o=>{if(o.startsWith(i)){const l=o.replace(i,""),h=t[o];n[l]=h}}),n}function az(t){if(!t.includes("wc:")){const x=nZ(t);x!=null&&x.includes("wc:")&&(t=x)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),o=t.substring(e+1,n).split("@"),l=typeof n<"u"?t.substring(n):"",h=new URLSearchParams(l),s=Object.fromEntries(h.entries()),w=typeof s.methods=="string"?s.methods.split(","):void 0;return{protocol:i,topic:A2e(o[0]),version:parseInt(o[1],10),symKey:s.symKey,relay:T2e(s),methods:w,expiryTimestamp:s.expiryTimestamp?parseInt(s.expiryTimestamp,10):void 0}}function A2e(t){return t.startsWith("//")?t.substring(2):t}function S2e(t,e="-"){const n="relay",i={};return Object.keys(t).forEach(o=>{const l=o,h=n+e+l;t[l]&&(i[h]=t[l])}),i}function cz(t){const e=new URLSearchParams,n=WP(WP(C2e(WP({},S2e(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(n).sort(([i],[o])=>i.localeCompare(o)).forEach(([i,o])=>{o!==void 0&&e.append(i,String(o))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function fT(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var I2e=Object.defineProperty,P2e=Object.defineProperties,R2e=Object.getOwnPropertyDescriptors,lz=Object.getOwnPropertySymbols,O2e=Object.prototype.hasOwnProperty,k2e=Object.prototype.propertyIsEnumerable,uz=(t,e,n)=>e in t?I2e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,D2e=(t,e)=>{for(var n in e||(e={}))O2e.call(e,n)&&uz(t,n,e[n]);if(lz)for(var n of lz(e))k2e.call(e,n)&&uz(t,n,e[n]);return t},N2e=(t,e)=>P2e(t,R2e(e));function Fw(t){const e=[];return t.forEach(n=>{const[i,o]=n.split(":");e.push(`${i}:${o}`)}),e}function eK(t){const e=[];return Object.values(t).forEach(n=>{e.push(...Fw(n.accounts))}),[...new Set(e)]}function M2e(t){const e=[];return Object.values(t).forEach(n=>{e.push(...n.methods)}),[...new Set(e)]}function L2e(t){const e=[];return Object.values(t).forEach(n=>{e.push(...n.events)}),[...new Set(e)]}function B2e(t,e){const n=[];return Object.values(t).forEach(i=>{Fw(i.accounts).includes(e)&&n.push(...i.methods)}),n}function F2e(t,e){const n=[];return Object.values(t).forEach(i=>{Fw(i.accounts).includes(e)&&n.push(...i.events)}),n}function sI(t){return t.includes(":")}function I1(t){return sI(t)?t.split(":")[0]:t}function dz(t){var e,n,i;const o={};if(!bh(t))return o;for(const[l,h]of Object.entries(t)){const s=sI(l)?[l]:h.chains,w=h.methods||[],x=h.events||[],A=I1(l);o[A]=N2e(D2e({},o[A]),{chains:wh(s,(e=o[A])==null?void 0:e.chains),methods:wh(w,(n=o[A])==null?void 0:n.methods),events:wh(x,(i=o[A])==null?void 0:i.events)})}return o}function $2e(t){const e={};return t==null||t.forEach(n=>{var i;const[o,l]=n.split(":");e[o]||(e[o]={accounts:[],chains:[],events:[],methods:[]}),e[o].accounts.push(n),(i=e[o].chains)==null||i.push(`${o}:${l}`)}),e}function hz(t,e){e=e.map(i=>i.replace("did:pkh:",""));const n=$2e(e);for(const[i,o]of Object.entries(n))o.methods?o.methods=wh(o.methods,t):o.methods=t,o.events=["chainChanged","accountsChanged"];return n}function z2e(t,e){var n,i,o,l,h,s;const w=dz(t),x=dz(e),A={},P=Object.keys(w).concat(Object.keys(x));for(const D of P)A[D]={chains:wh((n=w[D])==null?void 0:n.chains,(i=x[D])==null?void 0:i.chains),methods:wh((o=w[D])==null?void 0:o.methods,(l=x[D])==null?void 0:l.methods),events:wh((h=w[D])==null?void 0:h.events,(s=x[D])==null?void 0:s.events)};return A}const U2e={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},j2e={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function An(t,e){const{message:n,code:i}=j2e[t];return{message:e?`${n} ${e}`:n,code:i}}function As(t,e){const{message:n,code:i}=U2e[t];return{message:e?`${n} ${e}`:n,code:i}}function zf(t,e){return!!Array.isArray(t)}function bh(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function sa(t){return typeof t>"u"}function wo(t,e){return e&&sa(t)?!0:typeof t=="string"&&!!t.trim().length}function RD(t,e){return typeof t=="number"&&!isNaN(t)}function V2e(t,e){const{requiredNamespaces:n}=e,i=Object.keys(t.namespaces),o=Object.keys(n);let l=!0;return S0(o,i)?(i.forEach(h=>{const{accounts:s,methods:w,events:x}=t.namespaces[h],A=Fw(s),P=n[h];(!S0(Xq(h,P),A)||!S0(P.methods,w)||!S0(P.events,x))&&(l=!1)}),l):!1}function UA(t){return wo(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function W2e(t){if(wo(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const n=e[0]+":"+e[1];return!!e[2]&&UA(n)}}return!1}function H2e(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(wo(t,!1)){if(e(t))return!0;const n=nZ(t);return e(n)}}catch{}return!1}function G2e(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function q2e(t){return t==null?void 0:t.topic}function Z2e(t,e){let n=null;return wo(t==null?void 0:t.publicKey,!1)||(n=An("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function fz(t){let e=!0;return zf(t)?t.length&&(e=t.every(n=>wo(n,!1))):e=!1,e}function K2e(t,e,n){let i=null;return zf(e)&&e.length?e.forEach(o=>{i||UA(o)||(i=As("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):UA(t)||(i=As("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Y2e(t,e,n){let i=null;return Object.entries(t).forEach(([o,l])=>{if(i)return;const h=K2e(o,Xq(o,l),`${e} ${n}`);h&&(i=h)}),i}function X2e(t,e){let n=null;return zf(t)?t.forEach(i=>{n||W2e(i)||(n=As("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):n=As("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function J2e(t,e){let n=null;return Object.values(t).forEach(i=>{if(n)return;const o=X2e(i==null?void 0:i.accounts,`${e} namespace`);o&&(n=o)}),n}function Q2e(t,e){let n=null;return fz(t==null?void 0:t.methods)?fz(t==null?void 0:t.events)||(n=As("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=As("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function tK(t,e){let n=null;return Object.values(t).forEach(i=>{if(n)return;const o=Q2e(i,`${e}, namespace`);o&&(n=o)}),n}function eEe(t,e,n){let i=null;if(t&&bh(t)){const o=tK(t,e);o&&(i=o);const l=Y2e(t,e,n);l&&(i=l)}else i=An("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return i}function HP(t,e){let n=null;if(t&&bh(t)){const i=tK(t,e);i&&(n=i);const o=J2e(t,e);o&&(n=o)}else n=An("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function nK(t){return wo(t.protocol,!0)}function tEe(t,e){let n=!1;return t?t&&zf(t)&&t.length&&t.forEach(i=>{n=nK(i)}):n=!0,n}function nEe(t){return typeof t=="number"}function Xc(t){return typeof t<"u"&&typeof t!==null}function iEe(t){return!(!t||typeof t!="object"||!t.code||!RD(t.code)||!t.message||!wo(t.message,!1))}function rEe(t){return!(sa(t)||!wo(t.method,!1))}function sEe(t){return!(sa(t)||sa(t.result)&&sa(t.error)||!RD(t.id)||!wo(t.jsonrpc,!1))}function oEe(t){return!(sa(t)||!wo(t.name,!1))}function pz(t,e){return!(!UA(e)||!eK(t).includes(e))}function aEe(t,e,n){return wo(n,!1)?B2e(t,e).includes(n):!1}function cEe(t,e,n){return wo(n,!1)?F2e(t,e).includes(n):!1}function mz(t,e,n){let i=null;const o=lEe(t),l=uEe(e),h=Object.keys(o),s=Object.keys(l),w=gz(Object.keys(t)),x=gz(Object.keys(e)),A=w.filter(P=>!x.includes(P));return A.length&&(i=An("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${A.toString()}
      Received: ${Object.keys(e).toString()}`)),S0(h,s)||(i=An("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${h.toString()}
      Approved: ${s.toString()}`)),Object.keys(e).forEach(P=>{if(!P.includes(":")||i)return;const D=Fw(e[P].accounts);D.includes(P)||(i=An("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${P}
        Required: ${P}
        Approved: ${D.toString()}`))}),h.forEach(P=>{i||(S0(o[P].methods,l[P].methods)?S0(o[P].events,l[P].events)||(i=An("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${P}`)):i=An("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${P}`))}),i}function lEe(t){const e={};return Object.keys(t).forEach(n=>{var i;n.includes(":")?e[n]=t[n]:(i=t[n].chains)==null||i.forEach(o=>{e[o]={methods:t[n].methods,events:t[n].events}})}),e}function gz(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function uEe(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const i=Fw(t[n].accounts);i==null||i.forEach(o=>{e[o]={accounts:t[n].accounts.filter(l=>l.includes(`${o}:`)),methods:t[n].methods,events:t[n].events}})}}),e}function dEe(t,e){return RD(t)&&t<=e.max&&t>=e.min}function yz(){const t=DE();return new Promise(e=>{switch(t){case zl.browser:e(hEe());break;case zl.reactNative:e(fEe());break;case zl.node:e(pEe());break;default:e(!0)}})}function hEe(){return Bw()&&(navigator==null?void 0:navigator.onLine)}async function fEe(){if(Ym()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function pEe(){return!0}function mEe(t){switch(DE()){case zl.browser:gEe(t);break;case zl.reactNative:yEe(t);break}}function gEe(t){!Ym()&&Bw()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function yEe(t){Ym()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function _Ee(){var t;return Bw()&&ey()?((t=ey())==null?void 0:t.visibilityState)==="visible":!0}const GP={};class bx{static get(e){return GP[e]}static set(e,n){GP[e]=n}static delete(e){delete GP[e]}}function wEe(t){const e=Lw.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function bEe({publicKey:t,signature:e,payload:n}){var i;const o=eO(n.method),l=128|parseInt(((i=n.version)==null?void 0:i.toString())||"4"),h=EEe(n.address),s=n.era==="00"?new Uint8Array([0]):eO(n.era);if(s.length!==1&&s.length!==2)throw new Error("Invalid era length");const w=parseInt(n.nonce,16),x=new Uint8Array([w&255,w>>8&255]),A=BigInt(`0x${xEe(n.tip)}`),P=TEe(A),D=new Uint8Array([0,...t,h,...e,...s,...x,...P,...o]),M=CEe(D.length+1);return new Uint8Array([...M,l,...D])}function vEe(t){const e=eO(t),n=nbe.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function eO(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function xEe(t){return t.startsWith("0x")?t.slice(2):t}function EEe(t){const e=Lw.decode(t)[0];return e===42?0:e===60?2:1}function CEe(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function TEe(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function AEe(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=wEe(t.transaction.address),i=bEe({publicKey:n,signature:e,payload:t.transaction}),o=Buffer.from(i).toString("hex");return vEe(o)}function OD({logger:t,name:e}){const n=typeof t=="string"?RS({opts:{level:t,name:e}}).logger:t;return n.level=typeof t=="string"?t:t.level,n}const SEe="PARSE_ERROR",IEe="INVALID_REQUEST",PEe="METHOD_NOT_FOUND",REe="INVALID_PARAMS",iK="INTERNAL_ERROR",kD="SERVER_ERROR",OEe=[-32700,-32600,-32601,-32602,-32603],Vx={[SEe]:{code:-32700,message:"Parse error"},[IEe]:{code:-32600,message:"Invalid Request"},[PEe]:{code:-32601,message:"Method not found"},[REe]:{code:-32602,message:"Invalid params"},[iK]:{code:-32603,message:"Internal error"},[kD]:{code:-32e3,message:"Server error"}},rK=kD;function kEe(t){return OEe.includes(t)}function _z(t){return Object.keys(Vx).includes(t)?Vx[t]:Vx[rK]}function DEe(t){const e=Object.values(Vx).find(n=>n.code===t);return e||Vx[rK]}function sK(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var oK={},bf={},wz;function NEe(){if(wz)return bf;wz=1,Object.defineProperty(bf,"__esModule",{value:!0}),bf.isBrowserCryptoAvailable=bf.getSubtleCrypto=bf.getBrowerCrypto=void 0;function t(){return(Tc===null||Tc===void 0?void 0:Tc.crypto)||(Tc===null||Tc===void 0?void 0:Tc.msCrypto)||{}}bf.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}bf.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return bf.isBrowserCryptoAvailable=n,bf}var vf={},bz;function MEe(){if(bz)return vf;bz=1,Object.defineProperty(vf,"__esModule",{value:!0}),vf.isBrowser=vf.isNode=vf.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}vf.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}vf.isNode=e;function n(){return!t()&&!e()}return vf.isBrowser=n,vf}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=PE;e.__exportStar(NEe(),t),e.__exportStar(MEe(),t)})(oK);function lh(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function wm(t=6){return BigInt(lh(t))}function ud(t,e,n){return{id:n||lh(),jsonrpc:"2.0",method:t,params:e}}function V2(t,e){return{id:t,jsonrpc:"2.0",result:e}}function oI(t,e,n){return{id:t,jsonrpc:"2.0",error:LEe(e)}}function LEe(t,e){return typeof t>"u"?_z(iK):(typeof t=="string"&&(t=Object.assign(Object.assign({},_z(kD)),{message:t})),kEe(t.code)&&(t=DEe(t.code)),t)}let BEe=class{},FEe=class extends BEe{constructor(){super()}},$Ee=class extends FEe{constructor(e){super()}};const zEe="^https?:",UEe="^wss?:";function jEe(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function aK(t,e){const n=jEe(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function vz(t){return aK(t,zEe)}function xz(t){return aK(t,UEe)}function VEe(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function cK(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function DD(t){return cK(t)&&"method"in t}function aI(t){return cK(t)&&(uh(t)||bu(t))}function uh(t){return"result"in t}function bu(t){return"error"in t}let ND=class extends $Ee{constructor(e){super(e),this.events=new Ru.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(ud(e.method,e.params||[],e.id||wm().toString()),n)}async requestStrict(e,n){return new Promise(async(i,o)=>{if(!this.connection.connected)try{await this.open()}catch(l){o(l)}this.events.on(`${e.id}`,l=>{bu(l)?o(l.error):i(l.result)});try{await this.connection.send(e,n)}catch(l){o(l)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),aI(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const WEe=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),HEe=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ez=t=>t.split("?")[0],Cz=10,GEe=WEe();let qEe=class{constructor(e){if(this.url=e,this.events=new Ru.EventEmitter,this.registering=!1,!xz(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Q0(e))}catch(n){this.onError(e.id,n)}}register(e=this.url){if(!xz(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((i,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((n,i)=>{const o=oK.isReactNative()?void 0:{rejectUnauthorized:!VEe(e)},l=new GEe(e,[],o);HEe()?l.onerror=h=>{const s=h;i(this.emitError(s.error))}:l.on("error",h=>{i(this.emitError(h))}),l.onopen=()=>{this.onOpen(l),n(l)}})}onOpen(e){e.onmessage=n=>this.onPayload(n),e.onclose=n=>this.onClose(n),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?J0(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const i=this.parseError(n),o=i.message||i.toString(),l=oI(e,o);this.events.emit("payload",l)}parseError(e,n=this.url){return sK(e,Ez(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Cz&&this.events.setMaxListeners(Cz)}emitError(e){const n=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Ez(this.url)}`));return this.events.emit("register_error",n),n}};var ZEe={};const lK="wc",uK=2,tO="core",Ih=`${lK}@2:${tO}:`,KEe={logger:"error"},YEe={database:":memory:"},XEe="crypto",Tz="client_ed25519_seed",JEe=vn.ONE_DAY,QEe="keychain",e3e="0.3",t3e="messages",n3e="0.3",i3e=vn.SIX_HOURS,r3e="publisher",dK="irn",s3e="error",hK="wss://relay.walletconnect.org",o3e="relayer",yo={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},a3e="_subscription",fu={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},c3e=.1,nO="2.23.2",bs={link_mode:"link_mode",relay:"relay"},WT={inbound:"inbound",outbound:"outbound"},l3e="0.3",u3e="WALLETCONNECT_CLIENT_ID",Az="WALLETCONNECT_LINK_MODE_APPS",kl={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},d3e="subscription",h3e="0.3",f3e="pairing",p3e="0.3",vx={wc_pairingDelete:{req:{ttl:vn.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:vn.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:vn.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:vn.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:vn.ONE_DAY,prompt:!1,tag:0},res:{ttl:vn.ONE_DAY,prompt:!1,tag:0}}},b0={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},td={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},m3e="history",g3e="0.3",y3e="expirer",yu={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},_3e="0.3",w3e="verify-api",b3e="https://verify.walletconnect.com",fK="https://verify.walletconnect.org",Wx=fK,v3e=`${Wx}/v3`,x3e=[b3e,fK],E3e="echo",C3e="https://echo.walletconnect.com",ch={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Tf={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},nd={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},u0={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},d0={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},xx={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},T3e=.1,A3e="event-client",S3e=86400,I3e="https://pulse.walletconnect.org/batch";function P3e(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var o=0;o<t.length;o++){var l=t.charAt(o),h=l.charCodeAt(0);if(n[h]!==255)throw new TypeError(l+" is ambiguous");n[h]=o}var s=t.length,w=t.charAt(0),x=Math.log(s)/Math.log(256),A=Math.log(256)/Math.log(s);function P(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var U=0,G=0,ne=0,oe=z.length;ne!==oe&&z[ne]===0;)ne++,U++;for(var Q=(oe-ne)*A+1>>>0,de=new Uint8Array(Q);ne!==oe;){for(var he=z[ne],Ie=0,ke=Q-1;(he!==0||Ie<G)&&ke!==-1;ke--,Ie++)he+=256*de[ke]>>>0,de[ke]=he%s>>>0,he=he/s>>>0;if(he!==0)throw new Error("Non-zero carry");G=Ie,ne++}for(var Ue=Q-G;Ue!==Q&&de[Ue]===0;)Ue++;for(var ze=w.repeat(U);Ue<Q;++Ue)ze+=t.charAt(de[Ue]);return ze}function D(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var U=0;if(z[U]!==" "){for(var G=0,ne=0;z[U]===w;)G++,U++;for(var oe=(z.length-U)*x+1>>>0,Q=new Uint8Array(oe);z[U];){var de=n[z.charCodeAt(U)];if(de===255)return;for(var he=0,Ie=oe-1;(de!==0||he<ne)&&Ie!==-1;Ie--,he++)de+=s*Q[Ie]>>>0,Q[Ie]=de%256>>>0,de=de/256>>>0;if(de!==0)throw new Error("Non-zero carry");ne=he,U++}if(z[U]!==" "){for(var ke=oe-ne;ke!==oe&&Q[ke]===0;)ke++;for(var Ue=new Uint8Array(G+(oe-ke)),ze=G;ke!==oe;)Ue[ze++]=Q[ke++];return Ue}}}function M(z){var U=D(z);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:P,decodeUnsafe:D,decode:M}}var R3e=P3e,O3e=R3e;const pK=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},k3e=t=>new TextEncoder().encode(t),D3e=t=>new TextDecoder().decode(t);class N3e{constructor(e,n,i){this.name=e,this.prefix=n,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class M3e{constructor(e,n,i){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mK(this,e)}}class L3e{constructor(e){this.decoders=e}or(e){return mK(this,e)}decode(e){const n=e[0],i=this.decoders[n];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const mK=(t,e)=>new L3e({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class B3e{constructor(e,n,i,o){this.name=e,this.prefix=n,this.baseEncode=i,this.baseDecode=o,this.encoder=new N3e(e,n,i),this.decoder=new M3e(e,n,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const cI=({name:t,prefix:e,encode:n,decode:i})=>new B3e(t,e,n,i),FE=({prefix:t,name:e,alphabet:n})=>{const{encode:i,decode:o}=O3e(n,e);return cI({prefix:t,name:e,encode:i,decode:l=>pK(o(l))})},F3e=(t,e,n,i)=>{const o={};for(let A=0;A<e.length;++A)o[e[A]]=A;let l=t.length;for(;t[l-1]==="=";)--l;const h=new Uint8Array(l*n/8|0);let s=0,w=0,x=0;for(let A=0;A<l;++A){const P=o[t[A]];if(P===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<n|P,s+=n,s>=8&&(s-=8,h[x++]=255&w>>s)}if(s>=n||255&w<<8-s)throw new SyntaxError("Unexpected end of data");return h},$3e=(t,e,n)=>{const i=e[e.length-1]==="=",o=(1<<n)-1;let l="",h=0,s=0;for(let w=0;w<t.length;++w)for(s=s<<8|t[w],h+=8;h>n;)h-=n,l+=e[o&s>>h];if(h&&(l+=e[o&s<<n-h]),i)for(;l.length*n&7;)l+="=";return l},Pa=({name:t,prefix:e,bitsPerChar:n,alphabet:i})=>cI({prefix:e,name:t,encode(o){return $3e(o,i,n)},decode(o){return F3e(o,i,n,t)}}),z3e=cI({prefix:"\0",name:"identity",encode:t=>D3e(t),decode:t=>k3e(t)});var U3e=Object.freeze({__proto__:null,identity:z3e});const j3e=Pa({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var V3e=Object.freeze({__proto__:null,base2:j3e});const W3e=Pa({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var H3e=Object.freeze({__proto__:null,base8:W3e});const G3e=FE({prefix:"9",name:"base10",alphabet:"0123456789"});var q3e=Object.freeze({__proto__:null,base10:G3e});const Z3e=Pa({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),K3e=Pa({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Y3e=Object.freeze({__proto__:null,base16:Z3e,base16upper:K3e});const X3e=Pa({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),J3e=Pa({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q3e=Pa({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),eCe=Pa({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),tCe=Pa({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),nCe=Pa({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),iCe=Pa({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rCe=Pa({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),sCe=Pa({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var oCe=Object.freeze({__proto__:null,base32:X3e,base32upper:J3e,base32pad:Q3e,base32padupper:eCe,base32hex:tCe,base32hexupper:nCe,base32hexpad:iCe,base32hexpadupper:rCe,base32z:sCe});const aCe=FE({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),cCe=FE({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var lCe=Object.freeze({__proto__:null,base36:aCe,base36upper:cCe});const uCe=FE({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dCe=FE({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var hCe=Object.freeze({__proto__:null,base58btc:uCe,base58flickr:dCe});const fCe=Pa({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pCe=Pa({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mCe=Pa({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gCe=Pa({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var yCe=Object.freeze({__proto__:null,base64:fCe,base64pad:pCe,base64url:mCe,base64urlpad:gCe});const gK=Array.from(""),_Ce=gK.reduce((t,e,n)=>(t[n]=e,t),[]),wCe=gK.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function bCe(t){return t.reduce((e,n)=>(e+=_Ce[n],e),"")}function vCe(t){const e=[];for(const n of t){const i=wCe[n.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(i)}return new Uint8Array(e)}const xCe=cI({prefix:"",name:"base256emoji",encode:bCe,decode:vCe});var ECe=Object.freeze({__proto__:null,base256emoji:xCe}),CCe=yK,Sz=128,TCe=-128,ACe=Math.pow(2,31);function yK(t,e,n){e=e||[],n=n||0;for(var i=n;t>=ACe;)e[n++]=t&255|Sz,t/=128;for(;t&TCe;)e[n++]=t&255|Sz,t>>>=7;return e[n]=t|0,yK.bytes=n-i+1,e}var SCe=iO,ICe=128,Iz=127;function iO(t,i){var n=0,i=i||0,o=0,l=i,h,s=t.length;do{if(l>=s)throw iO.bytes=0,new RangeError("Could not decode varint");h=t[l++],n+=o<28?(h&Iz)<<o:(h&Iz)*Math.pow(2,o),o+=7}while(h>=ICe);return iO.bytes=l-i,n}var PCe=Math.pow(2,7),RCe=Math.pow(2,14),OCe=Math.pow(2,21),kCe=Math.pow(2,28),DCe=Math.pow(2,35),NCe=Math.pow(2,42),MCe=Math.pow(2,49),LCe=Math.pow(2,56),BCe=Math.pow(2,63),FCe=function(t){return t<PCe?1:t<RCe?2:t<OCe?3:t<kCe?4:t<DCe?5:t<NCe?6:t<MCe?7:t<LCe?8:t<BCe?9:10},$Ce={encode:CCe,decode:SCe,encodingLength:FCe},_K=$Ce;const Pz=(t,e,n=0)=>(_K.encode(t,e,n),e),Rz=t=>_K.encodingLength(t),rO=(t,e)=>{const n=e.byteLength,i=Rz(t),o=i+Rz(n),l=new Uint8Array(o+n);return Pz(t,l,0),Pz(n,l,i),l.set(e,o),new zCe(t,n,e,l)};class zCe{constructor(e,n,i,o){this.code=e,this.size=n,this.digest=i,this.bytes=o}}const wK=({name:t,code:e,encode:n})=>new UCe(t,e,n);class UCe{constructor(e,n,i){this.name=e,this.code=n,this.encode=i}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?rO(this.code,n):n.then(i=>rO(this.code,i))}else throw Error("Unknown type, must be binary type")}}const bK=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),jCe=wK({name:"sha2-256",code:18,encode:bK("SHA-256")}),VCe=wK({name:"sha2-512",code:19,encode:bK("SHA-512")});var WCe=Object.freeze({__proto__:null,sha256:jCe,sha512:VCe});const vK=0,HCe="identity",xK=pK,GCe=t=>rO(vK,xK(t)),qCe={code:vK,name:HCe,encode:xK,digest:GCe};var ZCe=Object.freeze({__proto__:null,identity:qCe});new TextEncoder,new TextDecoder;const Oz={...U3e,...V3e,...H3e,...q3e,...Y3e,...oCe,...lCe,...hCe,...yCe,...ECe};({...WCe,...ZCe});function EK(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function KCe(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?EK(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function CK(t,e,n,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:i}}}const kz=CK("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),qP=CK("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=KCe(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),YCe={utf8:kz,"utf-8":kz,hex:Oz.base16,latin1:qP,ascii:qP,binary:qP,...Oz};function XCe(t,e="utf8"){const n=YCe[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?EK(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var JCe=Object.defineProperty,QCe=(t,e,n)=>e in t?JCe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,oh=(t,e,n)=>QCe(t,typeof e!="symbol"?e+"":e,n);class e5e{constructor(e,n){this.core=e,this.logger=n,oh(this,"keychain",new Map),oh(this,"name",QEe),oh(this,"version",e3e),oh(this,"initialized",!1),oh(this,"storagePrefix",Ih),oh(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),oh(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),oh(this,"set",async(i,o)=>{this.isInitialized(),this.keychain.set(i,o),await this.persist()}),oh(this,"get",i=>{this.isInitialized();const o=this.keychain.get(i);if(typeof o>"u"){const{message:l}=An("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(l)}return o}),oh(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=dl(n,this.name)}get context(){return ul(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,U8(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?j8(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}}var t5e=Object.defineProperty,n5e=(t,e,n)=>e in t?t5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qo=(t,e,n)=>n5e(t,typeof e!="symbol"?e+"":e,n);class i5e{constructor(e,n,i){this.core=e,this.logger=n,Qo(this,"name",XEe),Qo(this,"keychain"),Qo(this,"randomSessionIdentifier",Q8()),Qo(this,"initialized",!1),Qo(this,"clientId"),Qo(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Qo(this,"hasKeys",o=>(this.isInitialized(),this.keychain.has(o))),Qo(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const o=await this.getClientSeed(),l=o7(o),h=dq(l.publicKey);return this.clientId=h,h}),Qo(this,"generateKeyPair",()=>{this.isInitialized();const o=l2e();return this.setPrivateKey(o.publicKey,o.privateKey)}),Qo(this,"signJWT",async o=>{this.isInitialized();const l=await this.getClientSeed(),h=o7(l),s=this.randomSessionIdentifier;return await Lye(s,o,JEe,h)}),Qo(this,"generateSharedKey",(o,l,h)=>{this.isInitialized();const s=this.getPrivateKey(o),w=u2e(s,l);return this.setSymKey(w,h)}),Qo(this,"setSymKey",async(o,l)=>{this.isInitialized();const h=l||VT(o);return await this.keychain.set(h,o),h}),Qo(this,"deleteKeyPair",async o=>{this.isInitialized(),await this.keychain.del(o)}),Qo(this,"deleteSymKey",async o=>{this.isInitialized(),await this.keychain.del(o)}),Qo(this,"encode",async(o,l,h)=>{this.isInitialized();const s=QZ(h),w=Q0(l);if(rz(s))return f2e(w,h==null?void 0:h.encoding);if(iz(s)){const D=s.senderPublicKey,M=s.receiverPublicKey;o=await this.generateSharedKey(D,M)}const x=this.getSymKey(o),{type:A,senderPublicKey:P}=s;return d2e({type:A,symKey:x,message:w,senderPublicKey:P,encoding:h==null?void 0:h.encoding})}),Qo(this,"decode",async(o,l,h)=>{this.isInitialized();const s=m2e(l,h);if(rz(s)){const w=p2e(l,h==null?void 0:h.encoding);return J0(w)}if(iz(s)){const w=s.receiverPublicKey,x=s.senderPublicKey;o=await this.generateSharedKey(w,x)}try{const w=this.getSymKey(o),x=h2e({symKey:w,encoded:l,encoding:h==null?void 0:h.encoding});return J0(x)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}}),Qo(this,"getPayloadType",(o,l=tl)=>{const h=j2({encoded:o,encoding:l});return ny(h.type)}),Qo(this,"getPayloadSenderPublicKey",(o,l=tl)=>{const h=j2({encoded:o,encoding:l});return h.senderPublicKey?ol(h.senderPublicKey,Rc):void 0}),this.core=e,this.logger=dl(n,this.name),this.keychain=i||new e5e(this.core,this.logger)}get context(){return ul(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Tz)}catch{e=Q8(),await this.keychain.set(Tz,e)}return XCe(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}}var r5e=Object.defineProperty,s5e=Object.defineProperties,o5e=Object.getOwnPropertyDescriptors,Dz=Object.getOwnPropertySymbols,a5e=Object.prototype.hasOwnProperty,c5e=Object.prototype.propertyIsEnumerable,sO=(t,e,n)=>e in t?r5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,l5e=(t,e)=>{for(var n in e||(e={}))a5e.call(e,n)&&sO(t,n,e[n]);if(Dz)for(var n of Dz(e))c5e.call(e,n)&&sO(t,n,e[n]);return t},u5e=(t,e)=>s5e(t,o5e(e)),Rl=(t,e,n)=>sO(t,typeof e!="symbol"?e+"":e,n);class d5e extends Nme{constructor(e,n){super(e,n),this.logger=e,this.core=n,Rl(this,"messages",new Map),Rl(this,"messagesWithoutClientAck",new Map),Rl(this,"name",t3e),Rl(this,"version",n3e),Rl(this,"initialized",!1),Rl(this,"storagePrefix",Ih),Rl(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const o=await this.getRelayerMessagesWithoutClientAck();typeof o<"u"&&(this.messagesWithoutClientAck=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Rl(this,"set",async(i,o,l)=>{this.isInitialized();const h=wu(o);let s=this.messages.get(i);if(typeof s>"u"&&(s={}),typeof s[h]<"u")return h;if(s[h]=o,this.messages.set(i,s),l===WT.inbound){const w=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,u5e(l5e({},w),{[h]:o}))}return await this.persist(),h}),Rl(this,"get",i=>{this.isInitialized();let o=this.messages.get(i);return typeof o>"u"&&(o={}),o}),Rl(this,"getWithoutAck",i=>{this.isInitialized();const o={};for(const l of i){const h=this.messagesWithoutClientAck.get(l)||{};o[l]=Object.values(h)}return o}),Rl(this,"has",(i,o)=>{this.isInitialized();const l=this.get(i),h=wu(o);return typeof l[h]<"u"}),Rl(this,"ack",async(i,o)=>{this.isInitialized();const l=this.messagesWithoutClientAck.get(i);if(typeof l>"u")return;const h=wu(o);delete l[h],Object.keys(l).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,l),await this.persist()}),Rl(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=dl(e,this.name),this.core=n}get context(){return ul(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,U8(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,U8(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?j8(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?j8(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}}var h5e=Object.defineProperty,f5e=Object.defineProperties,p5e=Object.getOwnPropertyDescriptors,Nz=Object.getOwnPropertySymbols,m5e=Object.prototype.hasOwnProperty,g5e=Object.prototype.propertyIsEnumerable,oO=(t,e,n)=>e in t?h5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,y1=(t,e)=>{for(var n in e||(e={}))m5e.call(e,n)&&oO(t,n,e[n]);if(Nz)for(var n of Nz(e))g5e.call(e,n)&&oO(t,n,e[n]);return t},Mz=(t,e)=>f5e(t,p5e(e)),pu=(t,e,n)=>oO(t,typeof e!="symbol"?e+"":e,n);class y5e extends Mme{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,pu(this,"events",new Ru.EventEmitter),pu(this,"name",r3e),pu(this,"queue",new Map),pu(this,"publishTimeout",vn.toMiliseconds(vn.ONE_MINUTE)),pu(this,"initialPublishTimeout",vn.toMiliseconds(vn.ONE_SECOND*15)),pu(this,"needsTransportRestart",!1),pu(this,"publish",async(i,o,l)=>{var h,s,w,x,A;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:o,opts:l}});const P=(l==null?void 0:l.ttl)||i3e,D=(l==null?void 0:l.prompt)||!1,M=(l==null?void 0:l.tag)||0,z=(l==null?void 0:l.id)||wm().toString(),U=S1(zA().protocol),G={id:z,method:(l==null?void 0:l.publishMethod)||U.publish,params:y1({topic:i,message:o,ttl:P,prompt:D,tag:M,attestation:l==null?void 0:l.attestation},l==null?void 0:l.tvf)},ne=`Failed to publish payload, please try again. id:${z} tag:${M}`;try{sa((h=G.params)==null?void 0:h.prompt)&&((s=G.params)==null||delete s.prompt),sa((w=G.params)==null?void 0:w.tag)&&((x=G.params)==null||delete x.tag);const oe=new Promise(async Q=>{const de=({id:Ie})=>{var ke;((ke=G.id)==null?void 0:ke.toString())===Ie.toString()&&(this.removeRequestFromQueue(Ie),this.relayer.events.removeListener(yo.publish,de),Q())};this.relayer.events.on(yo.publish,de);const he=mh(new Promise((Ie,ke)=>{this.rpcPublish(G,l).then(Ie).catch(Ue=>{this.logger.warn(Ue,Ue==null?void 0:Ue.message),ke(Ue)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${z} tag:${M}`);try{await he,this.events.removeListener(yo.publish,de)}catch(Ie){this.queue.set(z,{request:G,opts:l,attempt:1}),this.logger.warn(Ie,Ie==null?void 0:Ie.message)}});this.logger.trace({type:"method",method:"publish",params:{id:z,topic:i,message:o,opts:l}}),await mh(oe,this.publishTimeout,ne)}catch(oe){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(oe),(A=l==null?void 0:l.internal)!=null&&A.throwOnFailedPublish)throw oe}finally{this.queue.delete(z)}}),pu(this,"publishCustom",async i=>{var o,l,h,s,w;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:x,opts:A={}}=i,{attestation:P,tvf:D,publishMethod:M,prompt:z,tag:U,ttl:G=vn.FIVE_MINUTES}=A,ne=A.id||wm().toString(),oe=S1(zA().protocol),Q=M||oe.publish,de={id:ne,method:Q,params:y1(Mz(y1({},x),{ttl:G,prompt:z,tag:U,attestation:P}),D)},he=`Failed to publish custom payload, please try again. id:${ne} tag:${U}`;try{sa((o=de.params)==null?void 0:o.prompt)&&((l=de.params)==null||delete l.prompt),sa((h=de.params)==null?void 0:h.tag)&&((s=de.params)==null||delete s.tag);const Ie=new Promise(async ke=>{const Ue=({id:ht})=>{var ft;((ft=de.id)==null?void 0:ft.toString())===ht.toString()&&(this.removeRequestFromQueue(ht),this.relayer.events.removeListener(yo.publish,Ue),ke())};this.relayer.events.on(yo.publish,Ue);const ze=mh(new Promise((ht,ft)=>{this.rpcPublish(de,A).then(ht).catch(ct=>{this.logger.warn(ct,ct==null?void 0:ct.message),ft(ct)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${Q} id:${ne} tag:${U}`);try{await ze,this.events.removeListener(yo.publish,Ue)}catch(ht){this.queue.set(ne,{request:de,opts:A,attempt:1}),this.logger.warn(ht,ht==null?void 0:ht.message)}});this.logger.trace({type:"method",method:"publish",params:{id:ne,payload:x,opts:A}}),await mh(Ie,this.publishTimeout,he)}catch(Ie){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(Ie),(w=A==null?void 0:A.internal)!=null&&w.throwOnFailedPublish)throw Ie}finally{this.queue.delete(ne)}}),pu(this,"on",(i,o)=>{this.events.on(i,o)}),pu(this,"once",(i,o)=>{this.events.once(i,o)}),pu(this,"off",(i,o)=>{this.events.off(i,o)}),pu(this,"removeListener",(i,o)=>{this.events.removeListener(i,o)}),this.relayer=e,this.logger=dl(n,this.name),this.registerEventListeners()}get context(){return ul(this.logger)}async rpcPublish(e,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(yo.publish,y1(y1({},e),n)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{var i;const o=e.attempt+1;this.queue.set(n,Mz(y1({},e),{attempt:o})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${o}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Iy.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(yo.connection_stalled);return}this.checkQueue()}),this.relayer.on(yo.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var _5e=Object.defineProperty,w5e=(t,e,n)=>e in t?_5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_1=(t,e,n)=>w5e(t,typeof e!="symbol"?e+"":e,n);class b5e{constructor(){_1(this,"map",new Map),_1(this,"set",(e,n)=>{const i=this.get(e);this.exists(e,n)||this.map.set(e,[...i,n])}),_1(this,"get",e=>this.map.get(e)||[]),_1(this,"exists",(e,n)=>this.get(e).includes(n)),_1(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,n))return;const o=i.filter(l=>l!==n);if(!o.length){this.map.delete(e);return}this.map.set(e,o)}),_1(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var v5e=Object.defineProperty,x5e=Object.defineProperties,E5e=Object.getOwnPropertyDescriptors,Lz=Object.getOwnPropertySymbols,C5e=Object.prototype.hasOwnProperty,T5e=Object.prototype.propertyIsEnumerable,aO=(t,e,n)=>e in t?v5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ex=(t,e)=>{for(var n in e||(e={}))C5e.call(e,n)&&aO(t,n,e[n]);if(Lz)for(var n of Lz(e))T5e.call(e,n)&&aO(t,n,e[n]);return t},ZP=(t,e)=>x5e(t,E5e(e)),ns=(t,e,n)=>aO(t,typeof e!="symbol"?e+"":e,n);class A5e extends Fme{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,ns(this,"subscriptions",new Map),ns(this,"topicMap",new b5e),ns(this,"events",new Ru.EventEmitter),ns(this,"name",d3e),ns(this,"version",h3e),ns(this,"pending",new Map),ns(this,"cached",[]),ns(this,"initialized",!1),ns(this,"storagePrefix",Ih),ns(this,"subscribeTimeout",vn.toMiliseconds(vn.ONE_MINUTE)),ns(this,"initialSubscribeTimeout",vn.toMiliseconds(vn.ONE_SECOND*15)),ns(this,"clientId"),ns(this,"batchSubscribeTopicsLimit",500),ns(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ns(this,"subscribe",async(i,o)=>{var l;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:o}});try{const h=zA(o),s={topic:i,relay:h,transportType:o==null?void 0:o.transportType};(l=o==null?void 0:o.internal)!=null&&l.skipSubscribe||this.pending.set(i,s);const w=await this.rpcSubscribe(i,h,o);return typeof w=="string"&&(this.onSubscribe(w,s),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:o}})),w}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}}),ns(this,"unsubscribe",async(i,o)=>{this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(i,o.id,o):await this.unsubscribeByTopic(i,o)}),ns(this,"isSubscribed",i=>new Promise(o=>{o(this.topicMap.topics.includes(i))})),ns(this,"isKnownTopic",i=>new Promise(o=>{o(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(l=>l.topic===i))})),ns(this,"on",(i,o)=>{this.events.on(i,o)}),ns(this,"once",(i,o)=>{this.events.once(i,o)}),ns(this,"off",(i,o)=>{this.events.off(i,o)}),ns(this,"removeListener",(i,o)=>{this.events.removeListener(i,o)}),ns(this,"start",async()=>{await this.onConnect()}),ns(this,"stop",async()=>{await this.onDisconnect()}),ns(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ns(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(o=>{i.push(o)}),await this.batchSubscribe(i)}),ns(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Iy.pulse,async()=>{await this.checkPending()}),this.events.on(kl.created,async i=>{const o=kl.created;this.logger.info(`Emitting ${o}`),this.logger.debug({type:"event",event:o,data:i}),await this.persist()}),this.events.on(kl.deleted,async i=>{const o=kl.deleted;this.logger.info(`Emitting ${o}`),this.logger.debug({type:"event",event:o,data:i}),await this.persist()})}),this.relayer=e,this.logger=dl(n,this.name),this.clientId=""}get context(){return ul(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let i=!1;try{i=this.getSubscription(e).topic===n}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){const i=this.topicMap.get(e);await Promise.all(i.map(async o=>await this.unsubscribeById(e,o,n)))}async unsubscribeById(e,n,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:i}});try{const o=zA(i);await this.restartToComplete({topic:e,id:n,relay:o}),await this.rpcUnsubscribe(e,n,o);const l=As("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:i}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(e,n,i){var o,l;const h=await this.getSubscriptionId(e);if((o=i==null?void 0:i.internal)!=null&&o.skipSubscribe)return h;(!i||(i==null?void 0:i.transportType)===bs.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});const s={method:S1(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const w=(l=i==null?void 0:i.internal)==null?void 0:l.throwOnFailedPublish;try{if((i==null?void 0:i.transportType)===bs.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(P=>this.logger.warn(P))},vn.toMiliseconds(vn.ONE_SECOND)),h;const x=new Promise(async P=>{const D=M=>{M.topic===e&&(this.events.removeListener(kl.created,D),P(M.id))};this.events.on(kl.created,D);try{const M=await mh(new Promise((z,U)=>{this.relayer.request(s).catch(G=>{this.logger.warn(G,G==null?void 0:G.message),U(G)}).then(z)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(kl.created,D),P(M)}catch{}}),A=await mh(x,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!A&&w)throw new Error(`Subscribing to ${e} failed, please try again`);return A?h:null}catch(x){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(yo.connection_stalled),w)throw x}return null}async rpcBatchSubscribe(e){if(!e.length)return;const n=e[0].relay,i={method:S1(n.protocol).batchSubscribe,params:{topics:e.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await mh(new Promise(o=>{this.relayer.request(i).catch(l=>this.logger.warn(l)).then(o)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(yo.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const n=e[0].relay,i={method:S1(n.protocol).batchFetchMessages,params:{topics:e.map(l=>l.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let o;try{o=await await mh(new Promise((l,h)=>{this.relayer.request(i).catch(s=>{this.logger.warn(s),h(s)}).then(l)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(yo.connection_stalled)}return o}rpcUnsubscribe(e,n,i){const o={method:S1(i.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(e,n){this.setSubscription(e,ZP(Ex({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Ex({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,i){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Ex({},n)),this.topicMap.set(n.topic,e),this.events.emit(kl.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const n=this.subscriptions.get(e);if(!n){const{message:i}=An("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(kl.deleted,ZP(Ex({},i),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(kl.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<n;i++){const o=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(o)}}this.events.emit(kl.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(n=>{var i;return n.topic===((i=this.subscriptions.get(n.id))==null?void 0:i.topic)})){const{message:n}=An("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>ZP(Ex({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await Pbe(vn.toMiliseconds(vn.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return wu(e+await this.getClientId())}}var S5e=Object.defineProperty,Bz=Object.getOwnPropertySymbols,I5e=Object.prototype.hasOwnProperty,P5e=Object.prototype.propertyIsEnumerable,cO=(t,e,n)=>e in t?S5e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fz=(t,e)=>{for(var n in e||(e={}))I5e.call(e,n)&&cO(t,n,e[n]);if(Bz)for(var n of Bz(e))P5e.call(e,n)&&cO(t,n,e[n]);return t},Or=(t,e,n)=>cO(t,typeof e!="symbol"?e+"":e,n);class R5e extends Lme{constructor(e){var n;super(e),Or(this,"protocol","wc"),Or(this,"version",2),Or(this,"core"),Or(this,"logger"),Or(this,"events",new Ru.EventEmitter),Or(this,"provider"),Or(this,"messages"),Or(this,"subscriber"),Or(this,"publisher"),Or(this,"name",o3e),Or(this,"transportExplicitlyClosed",!1),Or(this,"initialized",!1),Or(this,"connectionAttemptInProgress",!1),Or(this,"relayUrl"),Or(this,"projectId"),Or(this,"packageName"),Or(this,"bundleId"),Or(this,"hasExperiencedNetworkDisruption",!1),Or(this,"pingTimeout"),Or(this,"heartBeatTimeout",vn.toMiliseconds(vn.THIRTY_SECONDS+vn.FIVE_SECONDS)),Or(this,"reconnectTimeout"),Or(this,"connectPromise"),Or(this,"reconnectInProgress",!1),Or(this,"requestsInFlight",[]),Or(this,"connectTimeout",vn.toMiliseconds(vn.ONE_SECOND*15)),Or(this,"request",async i=>{var o,l;this.logger.debug("Publishing Request Payload");const h=i.id||wm().toString();await this.toEstablishConnection();try{this.logger.trace({id:h,method:i.method,topic:(o=i.params)==null?void 0:o.topic},"relayer.request - publishing...");const s=`${h}:${((l=i.params)==null?void 0:l.tag)||""}`;this.requestsInFlight.push(s);const w=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(x=>x!==s),w}catch(s){throw this.logger.debug(`Failed to Publish Request: ${h}`),s}}),Or(this,"resetPingTimeout",()=>{NA()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,o,l,h;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(h=(l=(o=(i=this.provider)==null?void 0:i.connection)==null?void 0:o.socket)==null?void 0:l.terminate)==null||h.call(l)}catch(s){this.logger.warn(s,s==null?void 0:s.message)}},this.heartBeatTimeout))}),Or(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),Or(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(yo.connect)}),Or(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Or(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(yo.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Or(this,"registerProviderListeners",()=>{this.provider.on(fu.payload,this.onPayloadHandler),this.provider.on(fu.connect,this.onConnectHandler),this.provider.on(fu.disconnect,this.onDisconnectHandler),this.provider.on(fu.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=OD({logger:(n=e.logger)!=null?n:s3e,name:this.name}),this.messages=new d5e(this.logger,e.core),this.subscriber=new A5e(this,this.logger),this.publisher=new y5e(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||hK,fbe()?this.packageName=T7():pbe()&&(this.bundleId=T7()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return ul(this.logger)}get connected(){var e,n,i;return((i=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,n,i;return((i=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,i){this.isInitialized(),await this.publisher.publish(e,n,i),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:bs.relay},WT.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,n){var i,o,l;this.isInitialized(),(!(n!=null&&n.transportType)||(n==null?void 0:n.transportType)==="relay")&&await this.toEstablishConnection();const h=typeof((i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(o=n==null?void 0:n.internal)==null?void 0:o.throwOnFailedPublish;let s=((l=this.subscriber.topicMap.get(e))==null?void 0:l[0])||"",w;const x=A=>{A.topic===e&&(this.subscriber.off(kl.created,x),w())};return await Promise.all([new Promise(A=>{w=A,this.subscriber.on(kl.created,x)}),new Promise(async(A,P)=>{s=await this.subscriber.subscribe(e,Fz({internal:{throwOnFailedPublish:h}},n)).catch(D=>{h&&P(D)})||s,A()})]),s}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await mh(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,i)=>{await this.connect(e).then(n).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await yz())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=e.sort((i,o)=>i.publishedAt-o.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const i of n)try{await this.onMessageEvent(i)}catch(o){this.logger.warn(o,"Error while processing batch message event: "+(o==null?void 0:o.message))}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){const{topic:i}=e;if(!n.sessionExists){const o=mo(vn.FIVE_MINUTES),l={topic:i,expiry:o,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,l)}this.events.emit(yo.message,e),await this.recordMessageEvent(e,WT.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(i,o)=>{const l=()=>{o(new Error("Connection interrupted while trying to connect"))};this.provider.once(fu.disconnect,l),await mh(new Promise((h,s)=>{this.provider.connect().then(h).catch(s)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(h=>{o(h)}).finally(()=>{this.provider.off(fu.disconnect,l),clearTimeout(this.reconnectTimeout)}),await new Promise(async(h,s)=>{const w=()=>{o(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(fu.disconnect,w),await this.subscriber.start().then(h).catch(s).finally(()=>{this.provider.off(fu.disconnect,w)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const o=i;this.logger.warn({},o.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(i=>setTimeout(i,vn.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,i,o,l;if(NA())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((l=(o=(i=this.provider)==null?void 0:i.connection)==null?void 0:o.socket)==null||l.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(h){this.logger.warn(h,h==null?void 0:h.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ND(new qEe(wbe({sdkVersion:nO,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){const{topic:i,message:o}=e;await this.messages.set(i,o,n)}async shouldIgnoreMessageEvent(e){const{topic:n,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const o=this.messages.has(n,i);return o&&this.logger.warn(`Ignoring duplicate message: ${i}`),o}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),DD(e)){if(!e.method.endsWith(a3e))return;const n=e.params,{topic:i,message:o,publishedAt:l,attestation:h}=n.data,s={topic:i,message:o,publishedAt:l,transportType:bs.relay,attestation:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Fz({type:"event",event:n.id},s)),this.events.emit(n.id,s),await this.acknowledgePayload(e),await this.onMessageEvent(s)}else aI(e)&&this.events.emit(yo.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,WT.inbound),this.events.emit(yo.message,e))}async acknowledgePayload(e){const n=V2(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(fu.payload,this.onPayloadHandler),this.provider.off(fu.connect,this.onConnectHandler),this.provider.off(fu.disconnect,this.onDisconnectHandler),this.provider.off(fu.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await yz();mEe(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Iy.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&_Ee())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n==null?void 0:n.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(yo.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},vn.toMiliseconds(c3e)))))}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function O5e(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function $z(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function zz(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const k5e="[object RegExp]",D5e="[object String]",N5e="[object Number]",M5e="[object Boolean]",Uz="[object Arguments]",L5e="[object Symbol]",B5e="[object Date]",F5e="[object Map]",$5e="[object Set]",z5e="[object Array]",U5e="[object Function]",j5e="[object ArrayBuffer]",KP="[object Object]",V5e="[object Error]",W5e="[object DataView]",H5e="[object Uint8Array]",G5e="[object Uint8ClampedArray]",q5e="[object Uint16Array]",Z5e="[object Uint32Array]",K5e="[object BigUint64Array]",Y5e="[object Int8Array]",X5e="[object Int16Array]",J5e="[object Int32Array]",Q5e="[object BigInt64Array]",eTe="[object Float32Array]",tTe="[object Float64Array]";function nTe(){}function jz(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function iTe(t,e,n){return Mx(t,e,void 0,void 0,void 0,void 0,n)}function Mx(t,e,n,i,o,l,h){const s=h(t,e,n,i,o,l);if(s!==void 0)return s;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Hx(t,e,l,h)}return Hx(t,e,l,h)}function Hx(t,e,n,i){if(Object.is(t,e))return!0;let o=zz(t),l=zz(e);if(o===Uz&&(o=KP),l===Uz&&(l=KP),o!==l)return!1;switch(o){case D5e:return t.toString()===e.toString();case N5e:{const w=t.valueOf(),x=e.valueOf();return O5e(w,x)}case M5e:case B5e:case L5e:return Object.is(t.valueOf(),e.valueOf());case k5e:return t.source===e.source&&t.flags===e.flags;case U5e:return t===e}n=n??new Map;const h=n.get(t),s=n.get(e);if(h!=null&&s!=null)return h===e;n.set(t,e),n.set(e,t);try{switch(o){case F5e:{if(t.size!==e.size)return!1;for(const[w,x]of t.entries())if(!e.has(w)||!Mx(x,e.get(w),w,t,e,n,i))return!1;return!0}case $5e:{if(t.size!==e.size)return!1;const w=Array.from(t.values()),x=Array.from(e.values());for(let A=0;A<w.length;A++){const P=w[A],D=x.findIndex(M=>Mx(P,M,void 0,t,e,n,i));if(D===-1)return!1;x.splice(D,1)}return!0}case z5e:case H5e:case G5e:case q5e:case Z5e:case K5e:case Y5e:case X5e:case J5e:case Q5e:case eTe:case tTe:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let w=0;w<t.length;w++)if(!Mx(t[w],e[w],w,t,e,n,i))return!1;return!0}case j5e:return t.byteLength!==e.byteLength?!1:Hx(new Uint8Array(t),new Uint8Array(e),n,i);case W5e:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Hx(new Uint8Array(t),new Uint8Array(e),n,i);case V5e:return t.name===e.name&&t.message===e.message;case KP:{if(!(Hx(t.constructor,e.constructor,n,i)||jz(t)&&jz(e)))return!1;const w=[...Object.keys(t),...$z(t)],x=[...Object.keys(e),...$z(e)];if(w.length!==x.length)return!1;for(let A=0;A<w.length;A++){const P=w[A],D=t[P];if(!Object.hasOwn(e,P))return!1;const M=e[P];if(!Mx(D,M,P,t,e,n,i))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function rTe(t,e){return iTe(t,e,nTe)}var sTe=Object.defineProperty,Vz=Object.getOwnPropertySymbols,oTe=Object.prototype.hasOwnProperty,aTe=Object.prototype.propertyIsEnumerable,lO=(t,e,n)=>e in t?sTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wz=(t,e)=>{for(var n in e||(e={}))oTe.call(e,n)&&lO(t,n,e[n]);if(Vz)for(var n of Vz(e))aTe.call(e,n)&&lO(t,n,e[n]);return t},Kc=(t,e,n)=>lO(t,typeof e!="symbol"?e+"":e,n);class ky extends Bme{constructor(e,n,i,o=Ih,l=void 0){super(e,n,i,o),this.core=e,this.logger=n,this.name=i,Kc(this,"map",new Map),Kc(this,"version",l3e),Kc(this,"cached",[]),Kc(this,"initialized",!1),Kc(this,"getKey"),Kc(this,"storagePrefix",Ih),Kc(this,"recentlyDeleted",[]),Kc(this,"recentlyDeletedLimit",200),Kc(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!sa(h)?this.map.set(this.getKey(h),h):G2e(h)?this.map.set(h.id,h):q2e(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)}),Kc(this,"set",async(h,s)=>{this.isInitialized(),this.map.has(h)?await this.update(h,s):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:s}),this.map.set(h,s),await this.persist())}),Kc(this,"get",h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h))),Kc(this,"getAll",h=>(this.isInitialized(),h?this.values.filter(s=>Object.keys(h).every(w=>rTe(s[w],h[w]))):this.values)),Kc(this,"update",async(h,s)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:s});const w=Wz(Wz({},this.getData(h)),s);this.map.set(h,w),await this.persist()}),Kc(this,"delete",async(h,s)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:s}),this.map.delete(h),this.addToRecentlyDeleted(h),await this.persist())}),this.logger=dl(n,this.name),this.storagePrefix=o,this.getKey=l}get context(){return ul(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){const{message:o}=An("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(o),new Error(o)}const{message:i}=An("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:n}=An("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}}var cTe=Object.defineProperty,lTe=(t,e,n)=>e in t?cTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,br=(t,e,n)=>lTe(t,typeof e!="symbol"?e+"":e,n);class uTe{constructor(e,n){this.core=e,this.logger=n,br(this,"name",f3e),br(this,"version",p3e),br(this,"events",new iD),br(this,"pairings"),br(this,"initialized",!1),br(this,"storagePrefix",Ih),br(this,"ignoredPayloadTypes",[$f]),br(this,"registeredMethods",[]),br(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),br(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),br(this,"create",async i=>{this.isInitialized();const o=Q8(),l=await this.core.crypto.setSymKey(o),h=mo(vn.FIVE_MINUTES),s={protocol:dK},w={topic:l,expiry:h,relay:s,active:!1,methods:i==null?void 0:i.methods},x=cz({protocol:this.core.protocol,version:this.core.version,topic:l,symKey:o,relay:s,expiryTimestamp:h,methods:i==null?void 0:i.methods});return this.events.emit(b0.create,w),this.core.expirer.set(l,h),await this.pairings.set(l,w),await this.core.relayer.subscribe(l,{transportType:i==null?void 0:i.transportType,internal:i==null?void 0:i.internal}),{topic:l,uri:x}}),br(this,"pair",async i=>{this.isInitialized();const o=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[ch.pairing_started]}});this.isValidPair(i,o);const{topic:l,symKey:h,relay:s,expiryTimestamp:w,methods:x}=az(i.uri);o.props.properties.topic=l,o.addTrace(ch.pairing_uri_validation_success),o.addTrace(ch.pairing_uri_not_expired);let A;if(this.pairings.keys.includes(l)){if(A=this.pairings.get(l),o.addTrace(ch.existing_pairing),A.active)throw o.setError(Tf.active_pairing_already_exists),new Error(`Pairing already exists: ${l}. Please try again with a new connection URI.`);o.addTrace(ch.pairing_not_expired)}const P=w||mo(vn.FIVE_MINUTES),D={topic:l,relay:s,expiry:P,active:!1,methods:x};this.core.expirer.set(l,P),await this.pairings.set(l,D),o.addTrace(ch.store_new_pairing),i.activatePairing&&await this.activate({topic:l}),this.events.emit(b0.create,D),o.addTrace(ch.emit_inactive_pairing),this.core.crypto.keychain.has(l)||await this.core.crypto.setSymKey(h,l),o.addTrace(ch.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{o.setError(Tf.no_internet_connection)}try{await this.core.relayer.subscribe(l,{relay:s})}catch(M){throw o.setError(Tf.subscribe_pairing_topic_failure),M}return o.addTrace(ch.subscribe_pairing_topic_success),D}),br(this,"activate",async({topic:i})=>{this.isInitialized();const o=mo(vn.FIVE_MINUTES);this.core.expirer.set(i,o),await this.pairings.update(i,{active:!0,expiry:o})}),br(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:o}=i;if(this.pairings.keys.includes(o)){const l=await this.sendRequest(o,"wc_pairingPing",{}),{done:h,resolve:s,reject:w}=y0();this.events.once(Hr("pairing_ping",l),({error:x})=>{x?w(x):s()}),await h()}}),br(this,"updateExpiry",async({topic:i,expiry:o})=>{this.isInitialized(),await this.pairings.update(i,{expiry:o})}),br(this,"updateMetadata",async({topic:i,metadata:o})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:o})}),br(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),br(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:o}=i;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",As("USER_DISCONNECTED")),await this.deletePairing(o))}),br(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:o,relay:l,expiry:h,methods:s}=i,w=this.core.crypto.keychain.get(o);return cz({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:w,relay:l,expiryTimestamp:h,methods:s})}),br(this,"sendRequest",async(i,o,l)=>{const h=ud(o,l),s=await this.core.crypto.encode(i,h),w=vx[o].req;return this.core.history.set(i,h),this.core.relayer.publish(i,s,w),h.id}),br(this,"sendResult",async(i,o,l)=>{const h=V2(i,l),s=await this.core.crypto.encode(o,h),w=(await this.core.history.get(o,i)).request.method,x=vx[w].res;await this.core.relayer.publish(o,s,x),await this.core.history.resolve(h)}),br(this,"sendError",async(i,o,l)=>{const h=oI(i,l),s=await this.core.crypto.encode(o,h),w=(await this.core.history.get(o,i)).request.method,x=vx[w]?vx[w].res:vx.unregistered_method.res;await this.core.relayer.publish(o,s,x),await this.core.history.resolve(h)}),br(this,"deletePairing",async(i,o)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,As("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),o?Promise.resolve():this.core.expirer.del(i)])}),br(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(o=>hh(o.expiry));await Promise.all(i.map(o=>this.deletePairing(o.topic)))}),br(this,"onRelayEventRequest",async i=>{const{topic:o,payload:l}=i;switch(l.method){case"wc_pairingPing":return await this.onPairingPingRequest(o,l);case"wc_pairingDelete":return await this.onPairingDeleteRequest(o,l);default:return await this.onUnknownRpcMethodRequest(o,l)}}),br(this,"onRelayEventResponse",async i=>{const{topic:o,payload:l}=i,h=(await this.core.history.get(o,l.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(o,l);default:return this.onUnknownRpcMethodResponse(h)}}),br(this,"onPairingPingRequest",async(i,o)=>{const{id:l}=o;try{this.isValidPing({topic:i}),await this.sendResult(l,i,!0),this.events.emit(b0.ping,{id:l,topic:i})}catch(h){await this.sendError(l,i,h),this.logger.error(h)}}),br(this,"onPairingPingResponse",(i,o)=>{const{id:l}=o;setTimeout(()=>{uh(o)?this.events.emit(Hr("pairing_ping",l),{}):bu(o)&&this.events.emit(Hr("pairing_ping",l),{error:o.error})},500)}),br(this,"onPairingDeleteRequest",async(i,o)=>{const{id:l}=o;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(b0.delete,{id:l,topic:i})}catch(h){await this.sendError(l,i,h),this.logger.error(h)}}),br(this,"onUnknownRpcMethodRequest",async(i,o)=>{const{id:l,method:h}=o;try{if(this.registeredMethods.includes(h))return;const s=As("WC_METHOD_UNSUPPORTED",h);await this.sendError(l,i,s),this.logger.error(s)}catch(s){await this.sendError(l,i,s),this.logger.error(s)}}),br(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(As("WC_METHOD_UNSUPPORTED",i))}),br(this,"isValidPair",(i,o)=>{var l;if(!Xc(i)){const{message:s}=An("MISSING_OR_INVALID",`pair() params: ${i}`);throw o.setError(Tf.malformed_pairing_uri),new Error(s)}if(!H2e(i.uri)){const{message:s}=An("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw o.setError(Tf.malformed_pairing_uri),new Error(s)}const h=az(i==null?void 0:i.uri);if(!((l=h==null?void 0:h.relay)!=null&&l.protocol)){const{message:s}=An("MISSING_OR_INVALID","pair() uri#relay-protocol");throw o.setError(Tf.malformed_pairing_uri),new Error(s)}if(!(h!=null&&h.symKey)){const{message:s}=An("MISSING_OR_INVALID","pair() uri#symKey");throw o.setError(Tf.malformed_pairing_uri),new Error(s)}if(h!=null&&h.expiryTimestamp&&vn.toMiliseconds(h==null?void 0:h.expiryTimestamp)<Date.now()){o.setError(Tf.pairing_expired);const{message:s}=An("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(s)}}),br(this,"isValidPing",async i=>{if(!Xc(i)){const{message:l}=An("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(l)}const{topic:o}=i;await this.isValidPairingTopic(o)}),br(this,"isValidDisconnect",async i=>{if(!Xc(i)){const{message:l}=An("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(l)}const{topic:o}=i;await this.isValidPairingTopic(o)}),br(this,"isValidPairingTopic",async i=>{if(!wo(i,!1)){const{message:o}=An("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(o)}if(!this.pairings.keys.includes(i)){const{message:o}=An("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(o)}if(hh(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:o}=An("EXPIRED",`pairing topic: ${i}`);throw new Error(o)}}),this.core=e,this.logger=dl(n,this.name),this.pairings=new ky(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ul(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(yo.message,async e=>{const{topic:n,message:i,transportType:o}=e;if(this.pairings.keys.includes(n)&&o!==bs.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const l=await this.core.crypto.decode(n,i);DD(l)?(this.core.history.set(n,l),await this.onRelayEventRequest({topic:n,payload:l})):aI(l)&&(await this.core.history.resolve(l),await this.onRelayEventResponse({topic:n,payload:l}),this.core.history.delete(n,l.id)),await this.core.relayer.messages.ack(n,i)}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(yu.expired,async e=>{const{topic:n}=tZ(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(b0.expire,{topic:n}))})}}var dTe=Object.defineProperty,hTe=(t,e,n)=>e in t?dTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ea=(t,e,n)=>hTe(t,typeof e!="symbol"?e+"":e,n);class fTe extends Dme{constructor(e,n){super(e,n),this.core=e,this.logger=n,Ea(this,"records",new Map),Ea(this,"events",new Ru.EventEmitter),Ea(this,"name",m3e),Ea(this,"version",g3e),Ea(this,"cached",[]),Ea(this,"initialized",!1),Ea(this,"storagePrefix",Ih),Ea(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ea(this,"set",(i,o,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:o,chainId:l}),this.records.has(o.id))return;const h={id:o.id,topic:i,request:{method:o.method,params:o.params||null},chainId:l,expiry:mo(vn.THIRTY_DAYS)};this.records.set(h.id,h),this.persist(),this.events.emit(td.created,h)}),Ea(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const o=await this.getRecord(i.id);typeof o.response>"u"&&(o.response=bu(i)?{error:i.error}:{result:i.result},this.records.set(o.id,o),this.persist(),this.events.emit(td.updated,o))}),Ea(this,"get",async(i,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:o}),await this.getRecord(o))),Ea(this,"delete",(i,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(l=>{if(l.topic===i){if(typeof o<"u"&&l.id!==o)return;this.records.delete(l.id),this.events.emit(td.deleted,l)}}),this.persist()}),Ea(this,"exists",async(i,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===i:!1)),Ea(this,"on",(i,o)=>{this.events.on(i,o)}),Ea(this,"once",(i,o)=>{this.events.once(i,o)}),Ea(this,"off",(i,o)=>{this.events.off(i,o)}),Ea(this,"removeListener",(i,o)=>{this.events.removeListener(i,o)}),this.logger=dl(n,this.name)}get context(){return ul(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const i={topic:n.topic,request:ud(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const n=this.records.get(e);if(!n){const{message:i}=An("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(td.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:n}=An("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(td.created,e=>{const n=td.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(td.updated,e=>{const n=td.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(td.deleted,e=>{const n=td.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(Iy.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{vn.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(td.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}}var pTe=Object.defineProperty,mTe=(t,e,n)=>e in t?pTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Za=(t,e,n)=>mTe(t,typeof e!="symbol"?e+"":e,n);class gTe extends $me{constructor(e,n){super(e,n),this.core=e,this.logger=n,Za(this,"expirations",new Map),Za(this,"events",new Ru.EventEmitter),Za(this,"name",y3e),Za(this,"version",_3e),Za(this,"cached",[]),Za(this,"initialized",!1),Za(this,"storagePrefix",Ih),Za(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Za(this,"has",i=>{try{const o=this.formatTarget(i);return typeof this.getExpiration(o)<"u"}catch{return!1}}),Za(this,"set",(i,o)=>{this.isInitialized();const l=this.formatTarget(i),h={target:l,expiry:o};this.expirations.set(l,h),this.checkExpiry(l,h),this.events.emit(yu.created,{target:l,expiration:h})}),Za(this,"get",i=>{this.isInitialized();const o=this.formatTarget(i);return this.getExpiration(o)}),Za(this,"del",i=>{if(this.isInitialized(),this.has(i)){const o=this.formatTarget(i),l=this.getExpiration(o);this.expirations.delete(o),this.events.emit(yu.deleted,{target:o,expiration:l})}}),Za(this,"on",(i,o)=>{this.events.on(i,o)}),Za(this,"once",(i,o)=>{this.events.once(i,o)}),Za(this,"off",(i,o)=>{this.events.off(i,o)}),Za(this,"removeListener",(i,o)=>{this.events.removeListener(i,o)}),this.logger=dl(n,this.name)}get context(){return ul(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return bbe(e);if(typeof e=="number")return vbe(e);const{message:n}=An("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(yu.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:n}=An("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const n=this.expirations.get(e);if(!n){const{message:i}=An("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return n}checkExpiry(e,n){const{expiry:i}=n;vn.toMiliseconds(i)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(yu.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(Iy.pulse,()=>this.checkExpirations()),this.events.on(yu.created,e=>{const n=yu.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(yu.expired,e=>{const n=yu.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(yu.deleted,e=>{const n=yu.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yTe=Object.defineProperty,_Te=(t,e,n)=>e in t?yTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,po=(t,e,n)=>_Te(t,typeof e!="symbol"?e+"":e,n);class wTe extends zme{constructor(e,n,i){super(e,n,i),this.core=e,this.logger=n,this.store=i,po(this,"name",w3e),po(this,"abortController"),po(this,"isDevEnv"),po(this,"verifyUrlV3",v3e),po(this,"storagePrefix",Ih),po(this,"version",uK),po(this,"publicKey"),po(this,"fetchPromise"),po(this,"init",async()=>{var o;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&vn.toMiliseconds((o=this.publicKey)==null?void 0:o.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),po(this,"register",async o=>{if(!Bw()||this.isDevEnv)return;const l=window.location.origin,{id:h,decryptedId:s}=o,w=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${l}&id=${h}&decryptedId=${s}`;try{const x=ey(),A=this.startAbortTimer(vn.ONE_SECOND*5),P=await new Promise((D,M)=>{const z=()=>{window.removeEventListener("message",G),x.body.removeChild(U),M("attestation aborted")};this.abortController.signal.addEventListener("abort",z);const U=x.createElement("iframe");U.src=w,U.style.display="none",U.addEventListener("error",z,{signal:this.abortController.signal});const G=ne=>{if(ne.data&&typeof ne.data=="string")try{const oe=JSON.parse(ne.data);if(oe.type==="verify_attestation"){if(M8(oe.attestation).payload.id!==h)return;clearInterval(A),x.body.removeChild(U),this.abortController.signal.removeEventListener("abort",z),window.removeEventListener("message",G),D(oe.attestation===null?"":oe.attestation)}}catch(oe){this.logger.warn(oe)}};x.body.appendChild(U),window.addEventListener("message",G,{signal:this.abortController.signal})});return this.logger.debug(P,"jwt attestation"),P}catch(x){this.logger.warn(x)}return""}),po(this,"resolve",async o=>{if(this.isDevEnv)return"";const{attestationId:l,hash:h,encryptedId:s}=o;if(l===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(l){if(M8(l).payload.id!==s)return;const x=await this.isValidJwtAttestation(l);if(x){if(!x.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return x}}if(!h)return;const w=this.getVerifyUrl(o==null?void 0:o.verifyUrl);return this.fetchAttestation(h,w)}),po(this,"fetchAttestation",async(o,l)=>{this.logger.debug(`resolving attestation: ${o} from url: ${l}`);const h=this.startAbortTimer(vn.ONE_SECOND*5),s=await fetch(`${l}/attestation/${o}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(h),s.status===200?await s.json():void 0}),po(this,"getVerifyUrl",o=>{let l=o||Wx;return x3e.includes(l)||(this.logger.info(`verify url: ${l}, not included in trusted list, assigning default: ${Wx}`),l=Wx),l}),po(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const o=this.startAbortTimer(vn.FIVE_SECONDS),l=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(o),await l.json()}catch(o){this.logger.warn(o)}}),po(this,"persistPublicKey",async o=>{this.logger.debug(o,"persisting public key to local storage"),await this.store.setItem(this.storeKey,o),this.publicKey=o}),po(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),po(this,"isValidJwtAttestation",async o=>{const l=await this.getPublicKey();try{if(l)return this.validateAttestation(o,l)}catch(s){this.logger.error(s),this.logger.warn("error validating attestation")}const h=await this.fetchAndPersistPublicKey();try{if(h)return this.validateAttestation(o,h)}catch(s){this.logger.error(s),this.logger.warn("error validating attestation")}}),po(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),po(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async l=>{const h=await this.fetchPublicKey();h&&(await this.persistPublicKey(h),l(h))});const o=await this.fetchPromise;return this.fetchPromise=void 0,o}),po(this,"validateAttestation",(o,l)=>{const h=y2e(o,l.publicKey),s={hasExpired:vn.toMiliseconds(h.exp)<Date.now(),payload:h};if(s.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:s.payload.origin,isScam:s.payload.isScam,isVerified:s.payload.isVerified}}),this.logger=dl(n,this.name),this.abortController=new AbortController,this.isDevEnv=bD(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ul(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),vn.toMiliseconds(e))}}var bTe=Object.defineProperty,vTe=(t,e,n)=>e in t?bTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Hz=(t,e,n)=>vTe(t,typeof e!="symbol"?e+"":e,n);class xTe extends Ume{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,Hz(this,"context",E3e),Hz(this,"registerDeviceToken",async i=>{const{clientId:o,token:l,notificationType:h,enableEncrypted:s=!1}=i,w=`${C3e}/${this.projectId}/clients`;await fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:h,token:l,always_raw:s})})}),this.logger=dl(n,this.context)}}var ETe=Object.defineProperty,Gz=Object.getOwnPropertySymbols,CTe=Object.prototype.hasOwnProperty,TTe=Object.prototype.propertyIsEnumerable,uO=(t,e,n)=>e in t?ETe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Cx=(t,e)=>{for(var n in e||(e={}))CTe.call(e,n)&&uO(t,n,e[n]);if(Gz)for(var n of Gz(e))TTe.call(e,n)&&uO(t,n,e[n]);return t},ea=(t,e,n)=>uO(t,typeof e!="symbol"?e+"":e,n);class ATe extends jme{constructor(e,n,i=!0){super(e,n,i),this.core=e,this.logger=n,ea(this,"context",A3e),ea(this,"storagePrefix",Ih),ea(this,"storageVersion",T3e),ea(this,"events",new Map),ea(this,"shouldPersist",!1),ea(this,"init",async()=>{if(!bD())try{const o={eventId:S7(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Qq(this.core.relayer.protocol,this.core.relayer.version,nO)}}};await this.sendEvent([o])}catch(o){this.logger.warn(o)}}),ea(this,"createEvent",o=>{const{event:l="ERROR",type:h="",properties:{topic:s,trace:w}}=o,x=S7(),A=this.core.projectId||"",P=Date.now(),D=Cx({eventId:x,timestamp:P,props:{event:l,type:h,properties:{topic:s,trace:w}},bundleId:A,domain:this.getAppDomain()},this.setMethods(x));return this.telemetryEnabled&&(this.events.set(x,D),this.shouldPersist=!0),D}),ea(this,"getEvent",o=>{const{eventId:l,topic:h}=o;if(l)return this.events.get(l);const s=Array.from(this.events.values()).find(w=>w.props.properties.topic===h);if(s)return Cx(Cx({},s),this.setMethods(s.eventId))}),ea(this,"deleteEvent",o=>{const{eventId:l}=o;this.events.delete(l),this.shouldPersist=!0}),ea(this,"setEventListeners",()=>{this.core.heartbeat.on(Iy.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(o=>{vn.fromMiliseconds(Date.now())-vn.fromMiliseconds(o.timestamp)>S3e&&(this.events.delete(o.eventId),this.shouldPersist=!0)})})}),ea(this,"setMethods",o=>({addTrace:l=>this.addTrace(o,l),setError:l=>this.setError(o,l)})),ea(this,"addTrace",(o,l)=>{const h=this.events.get(o);h&&(h.props.properties.trace.push(l),this.events.set(o,h),this.shouldPersist=!0)}),ea(this,"setError",(o,l)=>{const h=this.events.get(o);h&&(h.props.type=l,h.timestamp=Date.now(),this.events.set(o,h),this.shouldPersist=!0)}),ea(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ea(this,"restore",async()=>{try{const o=await this.core.storage.getItem(this.storageKey)||[];if(!o.length)return;o.forEach(l=>{this.events.set(l.eventId,Cx(Cx({},l),this.setMethods(l.eventId)))})}catch(o){this.logger.warn(o)}}),ea(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const o=[];for(const[l,h]of this.events)h.props.type&&o.push(h);if(o.length!==0)try{if((await this.sendEvent(o)).ok)for(const l of o)this.events.delete(l.eventId),this.shouldPersist=!0}catch(l){this.logger.warn(l)}}),ea(this,"sendEvent",async o=>{const l=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${I3e}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${nO}${l}`,{method:"POST",body:JSON.stringify(o)})}),ea(this,"getAppDomain",()=>Jq().url),this.logger=dl(n,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var STe=Object.defineProperty,qz=Object.getOwnPropertySymbols,ITe=Object.prototype.hasOwnProperty,PTe=Object.prototype.propertyIsEnumerable,dO=(t,e,n)=>e in t?STe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zz=(t,e)=>{for(var n in e||(e={}))ITe.call(e,n)&&dO(t,n,e[n]);if(qz)for(var n of qz(e))PTe.call(e,n)&&dO(t,n,e[n]);return t},cs=(t,e,n)=>dO(t,typeof e!="symbol"?e+"":e,n);let RTe=class TK extends Pme{constructor(e){var n;super(e),cs(this,"protocol",lK),cs(this,"version",uK),cs(this,"name",tO),cs(this,"relayUrl"),cs(this,"projectId"),cs(this,"customStoragePrefix"),cs(this,"events",new Ru.EventEmitter),cs(this,"logger"),cs(this,"heartbeat"),cs(this,"relayer"),cs(this,"crypto"),cs(this,"storage"),cs(this,"history"),cs(this,"expirer"),cs(this,"pairing"),cs(this,"verify"),cs(this,"echoClient"),cs(this,"linkModeSupportedApps"),cs(this,"eventClient"),cs(this,"initialized",!1),cs(this,"logChunkController"),cs(this,"on",(s,w)=>this.events.on(s,w)),cs(this,"once",(s,w)=>this.events.once(s,w)),cs(this,"off",(s,w)=>this.events.off(s,w)),cs(this,"removeListener",(s,w)=>this.events.removeListener(s,w)),cs(this,"dispatchEnvelope",({topic:s,message:w,sessionExists:x})=>{if(!s||!w)return;const A={topic:s,message:w,publishedAt:Date.now(),transportType:bs.link_mode};this.relayer.onLinkMessageEvent(A,{sessionExists:x})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(s){console.warn("Failed to copy global core",s)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||hK,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const o=Sk({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:KEe.logger,name:tO}),{logger:l,chunkLoggerController:h}=RS({opts:o,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=h,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var s,w;(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&((w=this.logChunkController)==null||w.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=dl(l,this.name),this.heartbeat=new Wpe,this.crypto=new i5e(this,this.logger,e==null?void 0:e.keychain),this.history=new fTe(this,this.logger),this.expirer=new gTe(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ame(Zz(Zz({},YEe),e==null?void 0:e.storageOptions)),this.relayer=new R5e({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new uTe(this,this.logger),this.verify=new wTe(this,this.logger,this.storage),this.echoClient=new xTe(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new ATe(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const n=new TK(e);await n.initialize();const i=await n.crypto.getClientId();return await n.storage.setItem(u3e,i),n}get context(){return ul(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Az,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Az)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${e}`,i=`${n}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&ZEe.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const OTe=RTe,AK="wc",SK=2,IK="client",MD=`${AK}@${SK}:${IK}:`,YP={name:IK,logger:"error"},Kz="WALLETCONNECT_DEEPLINK_CHOICE",kTe="proposal",Yz="Proposal expired",DTe="session",w1=vn.SEVEN_DAYS,NTe="engine",Ca={wc_sessionPropose:{req:{ttl:vn.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:vn.ONE_DAY,prompt:!1,tag:1104},res:{ttl:vn.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:vn.ONE_DAY,prompt:!1,tag:1106},res:{ttl:vn.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:vn.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:vn.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:vn.ONE_DAY,prompt:!1,tag:1112},res:{ttl:vn.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:vn.ONE_DAY,prompt:!1,tag:1114},res:{ttl:vn.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:vn.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:vn.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:vn.FIVE_MINUTES,prompt:!1,tag:1119}}},XP={min:vn.FIVE_MINUTES,max:vn.SEVEN_DAYS},ah={idle:"IDLE",active:"ACTIVE"},MTe={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},LTe="request",BTe=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],FTe="wc",$Te="auth",zTe="authKeys",UTe="pairingTopics",jTe="requests",lI=`${FTe}@${1.5}:${$Te}:`,HT=`${lI}:PUB_KEY`;var VTe=Object.defineProperty,WTe=Object.defineProperties,HTe=Object.getOwnPropertyDescriptors,Xz=Object.getOwnPropertySymbols,GTe=Object.prototype.hasOwnProperty,qTe=Object.prototype.propertyIsEnumerable,hO=(t,e,n)=>e in t?VTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zr=(t,e)=>{for(var n in e||(e={}))GTe.call(e,n)&&hO(t,n,e[n]);if(Xz)for(var n of Xz(e))qTe.call(e,n)&&hO(t,n,e[n]);return t},Ta=(t,e)=>WTe(t,HTe(e)),dn=(t,e,n)=>hO(t,typeof e!="symbol"?e+"":e,n);class ZTe extends Gme{constructor(e){super(e),dn(this,"name",NTe),dn(this,"events",new iD),dn(this,"initialized",!1),dn(this,"requestQueue",{state:ah.idle,queue:[]}),dn(this,"sessionRequestQueue",{state:ah.idle,queue:[]}),dn(this,"emittedSessionRequests",new Rbe({limit:500})),dn(this,"requestQueueDelay",vn.ONE_SECOND),dn(this,"expectedPairingMethodMap",new Map),dn(this,"recentlyDeletedMap",new Map),dn(this,"recentlyDeletedLimit",200),dn(this,"relayMessageCache",[]),dn(this,"pendingSessions",new Map),dn(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ca)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},vn.toMiliseconds(this.requestQueueDelay)))}),dn(this,"connect",async n=>{var i;this.isInitialized(),await this.confirmOnlineStateOrThrow();const o=Ta(zr({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(o),o.optionalNamespaces=z2e(o.requiredNamespaces,o.optionalNamespaces),o.requiredNamespaces={};const{pairingTopic:l,requiredNamespaces:h,optionalNamespaces:s,sessionProperties:w,scopedProperties:x,relays:A,authentication:P,walletPay:D}=o,M=((i=P==null?void 0:P[0])==null?void 0:i.ttl)||Ca.wc_sessionPropose.req.ttl||vn.FIVE_MINUTES;this.validateRequestExpiry(M);let z=l,U,G=!1;try{if(z){const ze=this.client.core.pairing.pairings.get(z);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),G=ze.active}}catch(ze){throw this.client.logger.error(`connect() -> pairing.get(${z}) failed`),ze}if(!z||!G){const{topic:ze,uri:ht}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});z=ze,U=ht}if(!z){const{message:ze}=An("NO_MATCHING_KEY",`connect() pairing topic: ${z}`);throw new Error(ze)}const ne=await this.client.core.crypto.generateKeyPair(),oe=mo(M),Q=zr(Ta(zr(zr({requiredNamespaces:h,optionalNamespaces:s,relays:A??[{protocol:dK}],proposer:{publicKey:ne,metadata:this.client.metadata},expiryTimestamp:oe,pairingTopic:z},w&&{sessionProperties:w}),x&&{scopedProperties:x}),{id:lh()}),(P||D)&&{requests:{authentication:P==null?void 0:P.map(ze=>{const{domain:ht,chains:ft,nonce:ct,uri:je,exp:Ye,nbf:re,type:le,statement:Ae,requestId:Le,resources:De,signatureTypes:He}=ze;return{domain:ht,chains:ft,nonce:ct,type:le??"caip122",aud:je,version:"1",iat:new Date().toISOString(),exp:Ye,nbf:re,statement:Ae,requestId:Le,resources:De,signatureTypes:He}}),walletPay:D}}),de=Hr("session_connect",Q.id),{reject:he,resolve:Ie,done:ke}=y0(M,Yz),Ue=({id:ze})=>{ze===Q.id&&(this.client.events.off("proposal_expire",Ue),this.pendingSessions.delete(Q.id),this.events.emit(de,{error:{message:Yz,code:0}}))};return this.client.events.on("proposal_expire",Ue),this.events.once(de,({error:ze,session:ht})=>{this.client.events.off("proposal_expire",Ue),ze?he(ze):ht&&Ie(ht)}),await this.setProposal(Q.id,Q),await this.sendProposeSession({proposal:Q,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:Q.id}}}).catch(ze=>{throw this.deleteProposal(Q.id),ze}),{uri:U,approval:ke}}),dn(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(i){throw this.client.logger.error("pair() failed"),i}}),dn(this,"approve",async n=>{var i,o,l;const h=this.client.core.eventClient.createEvent({properties:{topic:(i=n==null?void 0:n.id)==null?void 0:i.toString(),trace:[nd.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(ht){throw h.setError(u0.no_internet_connection),ht}try{await this.isValidProposalId(n==null?void 0:n.id)}catch(ht){throw this.client.logger.error(`approve() -> proposal.get(${n==null?void 0:n.id}) failed`),h.setError(u0.proposal_not_found),ht}try{await this.isValidApprove(n)}catch(ht){throw this.client.logger.error("approve() -> isValidApprove() failed"),h.setError(u0.session_approve_namespace_validation_failure),ht}const{id:s,relayProtocol:w,namespaces:x,sessionProperties:A,scopedProperties:P,sessionConfig:D,proposalRequestsResponses:M}=n,z=this.client.proposal.get(s);this.client.core.eventClient.deleteEvent({eventId:h.eventId});const{pairingTopic:U,proposer:G,requiredNamespaces:ne,optionalNamespaces:oe}=z;let Q=(o=this.client.core.eventClient)==null?void 0:o.getEvent({topic:U});Q||(Q=(l=this.client.core.eventClient)==null?void 0:l.createEvent({type:nd.session_approve_started,properties:{topic:U,trace:[nd.session_approve_started,nd.session_namespaces_validation_success]}}));const de=await this.client.core.crypto.generateKeyPair(),he=G.publicKey,Ie=await this.client.core.crypto.generateSharedKey(de,he),ke=Ta(zr(zr(zr({relay:{protocol:w??"irn"},namespaces:x,controller:{publicKey:de,metadata:this.client.metadata},expiry:mo(w1)},A&&{sessionProperties:A}),P&&{scopedProperties:P}),D&&{sessionConfig:D}),{proposalRequestsResponses:M}),Ue=bs.relay;Q.addTrace(nd.subscribing_session_topic);try{await this.client.core.relayer.subscribe(Ie,{transportType:Ue,internal:{skipSubscribe:!0}})}catch(ht){throw Q.setError(u0.subscribe_session_topic_failure),ht}Q.addTrace(nd.subscribe_session_topic_success);const ze=Ta(zr({},ke),{topic:Ie,requiredNamespaces:ne,optionalNamespaces:oe,pairingTopic:U,acknowledged:!1,self:ke.controller,peer:{publicKey:G.publicKey,metadata:G.metadata},controller:de,transportType:bs.relay,authentication:M==null?void 0:M.authentication,walletPayResult:M==null?void 0:M.walletPay});await this.client.session.set(Ie,ze),Q.addTrace(nd.store_session);try{await this.sendApproveSession({sessionTopic:Ie,proposal:z,pairingProposalResponse:{relay:{protocol:w??"irn"},responderPublicKey:de},sessionSettleRequest:ke,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:zr({correlationId:s},this.getTVFApproveParams(ze))}}),Q.addTrace(nd.session_approve_publish_success)}catch(ht){throw this.client.logger.error(ht),this.client.session.delete(Ie,As("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(Ie),ht}return this.client.core.eventClient.deleteEvent({eventId:Q.eventId}),await this.client.core.pairing.updateMetadata({topic:U,metadata:G.metadata}),await this.deleteProposal(s),await this.client.core.pairing.activate({topic:U}),await this.setExpiry(Ie,mo(w1)),{topic:Ie,acknowledged:()=>Promise.resolve(this.client.session.get(Ie))}}),dn(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(h){throw this.client.logger.error("reject() -> isValidReject() failed"),h}const{id:i,reason:o}=n;let l;try{l=this.client.proposal.get(i).pairingTopic}catch(h){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),h}l&&await this.sendError({id:i,topic:l,error:o,rpcOpts:Ca.wc_sessionPropose.reject}),await this.deleteProposal(i)}),dn(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(P){throw this.client.logger.error("update() -> isValidUpdate() failed"),P}const{topic:i,namespaces:o}=n,{done:l,resolve:h,reject:s}=y0(vn.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),w=lh(),x=wm().toString(),A=this.client.session.get(i).namespaces;return this.events.once(Hr("session_update",w),({error:P})=>{P?s(P):h()}),await this.client.session.update(i,{namespaces:o}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:o},throwOnFailedPublish:!0,clientRpcId:w,relayRpcId:x}).catch(P=>{this.client.logger.error(P),this.client.session.update(i,{namespaces:A}),s(P)}),{acknowledged:l}}),dn(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(w){throw this.client.logger.error("extend() -> isValidExtend() failed"),w}const{topic:i}=n,o=lh(),{done:l,resolve:h,reject:s}=y0(vn.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(Hr("session_extend",o),({error:w})=>{w?s(w):h()}),await this.setExpiry(i,mo(w1)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:o,throwOnFailedPublish:!0}).catch(w=>{s(w)}),{acknowledged:l}}),dn(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(G){throw this.client.logger.error("request() -> isValidRequest() failed"),G}const{chainId:i,request:o,topic:l,expiry:h=Ca.wc_sessionRequest.req.ttl}=n,s=this.client.session.get(l);(s==null?void 0:s.transportType)===bs.relay&&await this.confirmOnlineStateOrThrow();const w=lh(),x=wm().toString(),{done:A,resolve:P,reject:D}=y0(h,"Request expired. Please try again.");this.events.once(Hr("session_request",w),({error:G,result:ne})=>{G?D(G):P(ne)});const M="wc_sessionRequest",z=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);if(z)return await this.sendRequest({clientRpcId:w,relayRpcId:x,topic:l,method:M,params:{request:Ta(zr({},o),{expiryTimestamp:mo(h)}),chainId:i},expiry:h,throwOnFailedPublish:!0,appLink:z}).catch(G=>D(G)),this.client.events.emit("session_request_sent",{topic:l,request:o,chainId:i,id:w}),await A();const U={request:Ta(zr({},o),{expiryTimestamp:mo(h)}),chainId:i};return await Promise.all([new Promise(async G=>{await this.sendRequest({clientRpcId:w,relayRpcId:x,topic:l,method:M,params:U,expiry:h,throwOnFailedPublish:!0,tvf:this.getTVFParams(w,U)}).catch(ne=>D(ne)),this.client.events.emit("session_request_sent",{topic:l,request:o,chainId:i,id:w}),G()}),new Promise(async G=>{var ne;if(!((ne=s.sessionConfig)!=null&&ne.disableDeepLink)){const oe=await Tbe(this.client.core.storage,Kz);await xbe({id:w,topic:l,wcDeepLink:oe})}G()}),A()]).then(G=>G[2])}),dn(this,"respond",async n=>{var i,o;this.isInitialized();const l=this.client.core.eventClient.createEvent({properties:{topic:(n==null?void 0:n.topic)||((o=(i=n==null?void 0:n.response)==null?void 0:i.id)==null?void 0:o.toString()),trace:[nd.session_request_response_started]}});try{await this.isValidRespond(n)}catch(P){throw l.addTrace(P==null?void 0:P.message),l.setError(u0.session_request_response_validation_failure),P}l.addTrace(nd.session_request_response_validation_success);const{topic:h,response:s}=n,{id:w}=s,x=this.client.session.get(h);x.transportType===bs.relay&&await this.confirmOnlineStateOrThrow();const A=this.getAppLinkIfEnabled(x.peer.metadata,x.transportType);try{l.addTrace(nd.session_request_response_publish_started),uh(s)?await this.sendResult({id:w,topic:h,result:s.result,throwOnFailedPublish:!0,appLink:A}):bu(s)&&await this.sendError({id:w,topic:h,error:s.error,appLink:A}),this.cleanupAfterResponse(n)}catch(P){throw l.addTrace(P==null?void 0:P.message),l.setError(u0.session_request_response_publish_failure),P}}),dn(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(o){throw this.client.logger.error("ping() -> isValidPing() failed"),o}const{topic:i}=n;if(this.client.session.keys.includes(i)){const o=lh(),l=wm().toString(),{done:h,resolve:s,reject:w}=y0(vn.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(Hr("session_ping",o),({error:x})=>{x?w(x):s()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:l}),h()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),dn(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);const{topic:i,event:o,chainId:l}=n,h=wm().toString(),s=lh();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:o,chainId:l},throwOnFailedPublish:!0,relayRpcId:h,clientRpcId:s})}),dn(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);const{topic:i}=n;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:As("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:o}=An("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(o)}}),dn(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(i=>V2e(i,n)))),dn(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),dn(this,"authenticate",async(n,i)=>{var o;this.isInitialized(),this.isValidAuthenticate(n);const l=i&&this.client.core.linkModeSupportedApps.includes(i)&&((o=this.client.metadata.redirect)==null?void 0:o.linkMode),h=l?bs.link_mode:bs.relay;h===bs.relay&&await this.confirmOnlineStateOrThrow();const{chains:s,statement:w="",uri:x,domain:A,nonce:P,type:D,exp:M,nbf:z,methods:U=[],expiry:G}=n,ne=[...n.resources||[]],{topic:oe,uri:Q}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:h});this.client.logger.info({message:"Generated new pairing",pairing:{topic:oe,uri:Q}});const de=await this.client.core.crypto.generateKeyPair(),he=VT(de);if(await Promise.all([this.client.auth.authKeys.set(HT,{responseTopic:he,publicKey:de}),this.client.auth.pairingTopics.set(he,{topic:he,pairingTopic:oe})]),await this.client.core.relayer.subscribe(he,{transportType:h}),this.client.logger.info(`sending request to new pairing topic: ${oe}`),U.length>0){const{namespace:De}=Ff(s[0]);let He=Vve(De,"request",U);jT(ne)&&(He=Hve(He,ne.pop())),ne.push(He)}const Ie=G&&G>Ca.wc_sessionAuthenticate.req.ttl?G:Ca.wc_sessionAuthenticate.req.ttl,ke={authPayload:{type:D??"caip122",chains:s,statement:w,aud:x,domain:A,version:"1",nonce:P,iat:new Date().toISOString(),exp:M,nbf:z,resources:ne},requester:{publicKey:de,metadata:this.client.metadata},expiryTimestamp:mo(Ie)},Ue={eip155:{chains:s,methods:[...new Set(["personal_sign",...U])],events:["chainChanged","accountsChanged"]}},ze={requiredNamespaces:{},optionalNamespaces:Ue,relays:[{protocol:"irn"}],pairingTopic:oe,proposer:{publicKey:de,metadata:this.client.metadata},expiryTimestamp:mo(Ca.wc_sessionPropose.req.ttl),id:lh()},{done:ht,resolve:ft,reject:ct}=y0(Ie,"Request expired"),je=lh(),Ye=Hr("session_connect",ze.id),re=Hr("session_request",je),le=async({error:De,session:He})=>{this.events.off(re,Ae),De?ct(De):He&&ft({session:He})},Ae=async De=>{var He,Et,Ct;if(await this.deletePendingAuthRequest(je,{message:"fulfilled",code:0}),De.error){const sn=As("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return De.error.code===sn.code?void 0:(this.events.off(Ye,le),ct(De.error.message))}await this.deleteProposal(ze.id),this.events.off(Ye,le);const{cacaos:Dt,responder:Bt}=De.result,Yt=[],yn=[];for(const sn of Dt){await F7({cacao:sn,projectId:this.client.core.projectId})||(this.client.logger.error(sn,"Signature verification failed"),ct(As("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:_n}=sn,ai=jT(_n.resources),er=[V8(_n.iss)],ui=LA(_n.iss);if(ai){const Yr=$7(ai),$s=z7(ai);Yt.push(...Yr),er.push(...$s)}for(const Yr of er)yn.push(`${Yr}:${ui}`)}const mn=await this.client.core.crypto.generateSharedKey(de,Bt.publicKey);let oi;Yt.length>0&&(oi={topic:mn,acknowledged:!0,self:{publicKey:de,metadata:this.client.metadata},peer:Bt,controller:Bt.publicKey,expiry:mo(w1),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:oe,namespaces:hz([...new Set(Yt)],[...new Set(yn)]),transportType:h},await this.client.core.relayer.subscribe(mn,{transportType:h}),await this.client.session.set(mn,oi),oe&&await this.client.core.pairing.updateMetadata({topic:oe,metadata:Bt.metadata}),oi=this.client.session.get(mn)),(He=this.client.metadata.redirect)!=null&&He.linkMode&&(Et=Bt.metadata.redirect)!=null&&Et.linkMode&&(Ct=Bt.metadata.redirect)!=null&&Ct.universal&&i&&(this.client.core.addLinkModeSupportedApp(Bt.metadata.redirect.universal),this.client.session.update(mn,{transportType:bs.link_mode})),ft({auths:Dt,session:oi})};this.events.once(Ye,le),this.events.once(re,Ae);let Le;try{if(l){const De=ud("wc_sessionAuthenticate",ke,je);this.client.core.history.set(oe,De);const He=await this.client.core.crypto.encode("",De,{type:BE,encoding:mm});Le=fT(i,oe,He)}else await Promise.all([this.sendRequest({topic:oe,method:"wc_sessionAuthenticate",params:ke,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:je}),this.sendRequest({topic:oe,method:"wc_sessionPropose",params:ze,expiry:Ca.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:ze.id})])}catch(De){throw this.events.off(Ye,le),this.events.off(re,Ae),De}return await this.setProposal(ze.id,ze),await this.setAuthRequest(je,{request:Ta(zr({},ke),{verifyContext:{}}),pairingTopic:oe,transportType:h}),{uri:Le??Q,response:ht}}),dn(this,"approveSessionAuthenticate",async n=>{const{id:i,auths:o}=n,l=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[d0.authenticated_session_approve_started]}});try{this.isInitialized()}catch(G){throw l.setError(xx.no_internet_connection),G}const h=this.getPendingAuthRequest(i);if(!h)throw l.setError(xx.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const s=h.transportType||bs.relay;s===bs.relay&&await this.confirmOnlineStateOrThrow();const w=h.requester.publicKey,x=await this.client.core.crypto.generateKeyPair(),A=VT(w),P={type:$f,receiverPublicKey:w,senderPublicKey:x},D=[],M=[];for(const G of o){if(!await F7({cacao:G,projectId:this.client.core.projectId})){l.setError(xx.invalid_cacao);const he=As("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:A,error:he,encodeOpts:P}),new Error(he.message)}l.addTrace(d0.cacaos_verified);const{p:ne}=G,oe=jT(ne.resources),Q=[V8(ne.iss)],de=LA(ne.iss);if(oe){const he=$7(oe),Ie=z7(oe);D.push(...he),Q.push(...Ie)}for(const he of Q)M.push(`${he}:${de}`)}const z=await this.client.core.crypto.generateSharedKey(x,w);l.addTrace(d0.create_authenticated_session_topic);let U;if((D==null?void 0:D.length)>0){U={topic:z,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:{publicKey:w,metadata:h.requester.metadata},controller:w,expiry:mo(w1),authentication:o,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:h.pairingTopic,namespaces:hz([...new Set(D)],[...new Set(M)]),transportType:s},l.addTrace(d0.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(z,{transportType:s})}catch(G){throw l.setError(xx.subscribe_authenticated_session_topic_failure),G}l.addTrace(d0.subscribe_authenticated_session_topic_success),await this.client.session.set(z,U),l.addTrace(d0.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:h.pairingTopic,metadata:h.requester.metadata})}l.addTrace(d0.publishing_authenticated_session_approve);try{await this.sendResult({topic:A,id:i,result:{cacaos:o,responder:{publicKey:x,metadata:this.client.metadata}},encodeOpts:P,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(h.requester.metadata,s)})}catch(G){throw l.setError(xx.authenticated_session_approve_publish_failure),G}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:h.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:l.eventId}),{session:U}}),dn(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();const{id:i,reason:o}=n,l=this.getPendingAuthRequest(i);if(!l)throw new Error(`Could not find pending auth request with id ${i}`);l.transportType===bs.relay&&await this.confirmOnlineStateOrThrow();const h=l.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),w=VT(h),x={type:$f,receiverPublicKey:h,senderPublicKey:s};await this.sendError({id:i,topic:w,error:o,encodeOpts:x,rpcOpts:Ca.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(l.requester.metadata,l.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),dn(this,"formatAuthMessage",n=>{this.isInitialized();const{request:i,iss:o}=n;return _Z(i,o)}),dn(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),dn(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{const i=this.client.core.pairing.pairings.get(n.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(l=>{var h,s;return((h=l.peerMetadata)==null?void 0:h.url)&&((s=l.peerMetadata)==null?void 0:s.url)===n.peer.metadata.url&&l.topic&&l.topic!==i.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),dn(this,"deleteSession",async n=>{var i;const{topic:o,expirerHasDeleted:l=!1,emitEvent:h=!0,id:s=0}=n,{self:w}=this.client.session.get(o);await this.client.core.relayer.unsubscribe(o),await this.client.session.delete(o,As("USER_DISCONNECTED")),this.addToRecentlyDeleted(o,"session"),this.client.core.crypto.keychain.has(w.publicKey)&&await this.client.core.crypto.deleteKeyPair(w.publicKey),this.client.core.crypto.keychain.has(o)&&await this.client.core.crypto.deleteSymKey(o),l||this.client.core.expirer.del(o),this.client.core.storage.removeItem(Kz).catch(x=>this.client.logger.warn(x)),o===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=ah.idle),await Promise.all(this.getPendingSessionRequests().filter(x=>x.topic===o).map(x=>this.deletePendingSessionRequest(x.id,As("USER_DISCONNECTED")))),h&&this.client.events.emit("session_delete",{id:s,topic:o})}),dn(this,"deleteProposal",async(n,i)=>{if(i)try{const o=this.client.proposal.get(n),l=this.client.core.eventClient.getEvent({topic:o.pairingTopic});l==null||l.setError(u0.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,As("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),dn(this,"deletePendingSessionRequest",async(n,i,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,i),o?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==n),o&&(this.sessionRequestQueue.state=ah.idle,this.client.events.emit("session_request_expire",{id:n}))}),dn(this,"deletePendingAuthRequest",async(n,i,o=!1)=>{await Promise.all([this.client.auth.requests.delete(n,i),o?Promise.resolve():this.client.core.expirer.del(n)])}),dn(this,"setExpiry",async(n,i)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,i),await this.client.session.update(n,{expiry:i}))}),dn(this,"setProposal",async(n,i)=>{this.client.core.expirer.set(n,mo(Ca.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,i)}),dn(this,"setAuthRequest",async(n,i)=>{const{request:o,pairingTopic:l,transportType:h=bs.relay}=i;this.client.core.expirer.set(n,o.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:o.authPayload,requester:o.requester,expiryTimestamp:o.expiryTimestamp,id:n,pairingTopic:l,verifyContext:o.verifyContext,transportType:h})}),dn(this,"setPendingSessionRequest",async n=>{const{id:i,topic:o,params:l,verifyContext:h}=n,s=l.request.expiryTimestamp||mo(Ca.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,s),await this.client.pendingRequest.set(i,{id:i,topic:o,params:l,verifyContext:h})}),dn(this,"sendRequest",async n=>{const{topic:i,method:o,params:l,expiry:h,relayRpcId:s,clientRpcId:w,throwOnFailedPublish:x,appLink:A,tvf:P,publishOpts:D={}}=n,M=ud(o,l,w);let z;const U=!!A;try{const oe=U?mm:tl;z=await this.client.core.crypto.encode(i,M,{encoding:oe})}catch(oe){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),oe}let G;if(BTe.includes(o)){const oe=wu(JSON.stringify(M)),Q=wu(z);G=await this.client.core.verify.register({id:Q,decryptedId:oe})}const ne=zr(zr({},Ca[o].req),D);if(ne.attestation=G,h&&(ne.ttl=h),s&&(ne.id=s),this.client.core.history.set(i,M),U){const oe=fT(A,i,z);await global.Linking.openURL(oe,this.client.name)}else ne.tvf=Ta(zr({},P),{correlationId:M.id}),x?(ne.internal=Ta(zr({},ne.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,z,ne)):this.client.core.relayer.publish(i,z,ne).catch(oe=>this.client.logger.error(oe));return M.id}),dn(this,"sendProposeSession",async n=>{const{proposal:i,publishOpts:o}=n,l=ud("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,l);const h=await this.client.core.crypto.encode(i.pairingTopic,l,{encoding:tl}),s=wu(JSON.stringify(l)),w=wu(h),x=await this.client.core.verify.register({id:w,decryptedId:s});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:h},opts:Ta(zr({},o),{publishMethod:"wc_proposeSession",attestation:x})})}),dn(this,"sendApproveSession",async n=>{const{sessionTopic:i,pairingProposalResponse:o,proposal:l,sessionSettleRequest:h,publishOpts:s}=n,w=V2(l.id,o),x=await this.client.core.crypto.encode(l.pairingTopic,w,{encoding:tl}),A=ud("wc_sessionSettle",h,s==null?void 0:s.id),P=await this.client.core.crypto.encode(i,A,{encoding:tl});this.client.core.history.set(i,A),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:l.pairingTopic,sessionProposalResponse:x,sessionSettlementRequest:P},opts:Ta(zr({},s),{publishMethod:"wc_approveSession"})})}),dn(this,"sendResult",async n=>{const{id:i,topic:o,result:l,throwOnFailedPublish:h,encodeOpts:s,appLink:w}=n,x=V2(i,l);let A;const P=w&&typeof(global==null?void 0:global.Linking)<"u";try{const z=P?mm:tl;A=await this.client.core.crypto.encode(o,x,Ta(zr({},s||{}),{encoding:z}))}catch(z){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${o} failed`),z}let D,M;try{D=await this.client.core.history.get(o,i);const z=D.request;try{M=this.getTVFParams(i,z.params,l)}catch(U){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${U==null?void 0:U.message}`)}}catch(z){throw this.client.logger.error(`sendResult() -> history.get(${o}, ${i}) failed`),z}if(P){const z=fT(w,o,A);await global.Linking.openURL(z,this.client.name)}else{const z=D.request.method,U=Ca[z].res;U.tvf=Ta(zr({},M),{correlationId:i}),h?(U.internal=Ta(zr({},U.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,A,U)):this.client.core.relayer.publish(o,A,U).catch(G=>this.client.logger.error(G))}await this.client.core.history.resolve(x)}),dn(this,"sendError",async n=>{const{id:i,topic:o,error:l,encodeOpts:h,rpcOpts:s,appLink:w}=n,x=oI(i,l);let A;const P=w&&typeof(global==null?void 0:global.Linking)<"u";try{const M=P?mm:tl;A=await this.client.core.crypto.encode(o,x,Ta(zr({},h||{}),{encoding:M}))}catch(M){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${o} failed`),M}let D;try{D=await this.client.core.history.get(o,i)}catch(M){throw this.client.logger.error(`sendError() -> history.get(${o}, ${i}) failed`),M}if(P){const M=fT(w,o,A);await global.Linking.openURL(M,this.client.name)}else{const M=D.request.method,z=s||Ca[M].res;this.client.core.relayer.publish(o,A,z)}await this.client.core.history.resolve(x)}),dn(this,"cleanup",async()=>{const n=[],i=[];this.client.session.getAll().forEach(o=>{let l=!1;hh(o.expiry)&&(l=!0),this.client.core.crypto.keychain.has(o.topic)||(l=!0),l&&n.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{hh(o.expiryTimestamp)&&i.push(o.id)}),await Promise.all([...n.map(o=>this.deleteSession({topic:o})),...i.map(o=>this.deleteProposal(o))])}),dn(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),dn(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),dn(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ah.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ah.active;const n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=ah.idle}),dn(this,"processRequest",async n=>{const{topic:i,payload:o,attestation:l,transportType:h,encryptedId:s}=n,w=o.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:w}))switch(w){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:o,attestation:l,encryptedId:s});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,o);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,o);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,o);case"wc_sessionPing":return await this.onSessionPingRequest(i,o);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,o);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:o,attestation:l,encryptedId:s,transportType:h});case"wc_sessionEvent":return await this.onSessionEventRequest(i,o);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:o,attestation:l,encryptedId:s,transportType:h});default:return this.client.logger.info(`Unsupported request method ${w}`)}}),dn(this,"onRelayEventResponse",async n=>{const{topic:i,payload:o,transportType:l}=n,h=(await this.client.core.history.get(i,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(i,o,l);case"wc_sessionSettle":return this.onSessionSettleResponse(i,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,o);case"wc_sessionExtend":return this.onSessionExtendResponse(i,o);case"wc_sessionPing":return this.onSessionPingResponse(i,o);case"wc_sessionRequest":return this.onSessionRequestResponse(i,o);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}}),dn(this,"onRelayEventUnknownPayload",n=>{const{topic:i}=n,{message:o}=An("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)}),dn(this,"shouldIgnorePairingRequest",n=>{const{topic:i,requestMethod:o}=n,l=this.expectedPairingMethodMap.get(i);return!l||l.includes(o)?!1:!!(l.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),dn(this,"onSessionProposeRequest",async n=>{const{topic:i,payload:o,attestation:l,encryptedId:h}=n,{params:s,id:w}=o;try{const x=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),x==null||x.setError(Tf.proposal_listener_not_found)),this.isValidConnect(zr({},o.params));const A=s.expiryTimestamp||mo(Ca.wc_sessionPropose.req.ttl),P=zr({id:w,pairingTopic:i,expiryTimestamp:A,attestation:l,encryptedId:h},s);await this.setProposal(w,P);const D=await this.getVerifyContext({attestationId:l,hash:wu(JSON.stringify(o)),encryptedId:h,metadata:P.proposer.metadata});x==null||x.addTrace(ch.emit_session_proposal),this.client.events.emit("session_proposal",{id:w,params:P,verifyContext:D})}catch(x){await this.sendError({id:w,topic:i,error:x,rpcOpts:Ca.wc_sessionPropose.autoReject}),this.client.logger.error(x)}}),dn(this,"onSessionProposeResponse",async(n,i,o)=>{const{id:l}=i;if(uh(i)){const{result:h}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const s=this.client.proposal.get(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:s});const w=s.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:w});const x=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:x});const A=await this.client.core.crypto.generateSharedKey(w,x);this.pendingSessions.set(l,{sessionTopic:A,pairingTopic:n,proposalId:l,publicKey:w});const P=await this.client.core.relayer.subscribe(A,{transportType:o});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:P}),await this.client.core.pairing.activate({topic:n})}else if(bu(i)){await this.deleteProposal(l);const h=Hr("session_connect",l);if(this.events.listenerCount(h)===0)throw new Error(`emitting ${h} without any listeners, 954`);this.events.emit(h,{error:i.error})}}),dn(this,"onSessionSettleRequest",async(n,i)=>{const{id:o,params:l}=i;try{this.isValidSessionSettleRequest(l);const{relay:h,controller:s,expiry:w,namespaces:x,sessionProperties:A,scopedProperties:P,sessionConfig:D,proposalRequestsResponses:M}=i.params,z=[...this.pendingSessions.values()].find(ne=>ne.sessionTopic===n);if(!z)return this.client.logger.error(`Pending session not found for topic ${n}`);const U=this.client.proposal.get(z.proposalId),G=Ta(zr(zr(zr({topic:n,relay:h,expiry:w,namespaces:x,acknowledged:!0,pairingTopic:z.pairingTopic,requiredNamespaces:U.requiredNamespaces,optionalNamespaces:U.optionalNamespaces,controller:s.publicKey,self:{publicKey:z.publicKey,metadata:this.client.metadata},peer:{publicKey:s.publicKey,metadata:s.metadata}},A&&{sessionProperties:A}),P&&{scopedProperties:P}),D&&{sessionConfig:D}),{transportType:bs.relay,authentication:M==null?void 0:M.authentication,walletPayResult:M==null?void 0:M.walletPay});await this.client.session.set(G.topic,G),await this.setExpiry(G.topic,G.expiry),await this.client.core.pairing.updateMetadata({topic:z.pairingTopic,metadata:G.peer.metadata}),this.pendingSessions.delete(z.proposalId),this.deleteProposal(z.proposalId,!1),this.cleanupDuplicatePairings(G),await this.sendResult({id:i.id,topic:n,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:G}),this.events.emit(Hr("session_connect",z.proposalId),{session:G})}catch(h){await this.sendError({id:o,topic:n,error:h}),this.client.logger.error(h)}}),dn(this,"onSessionSettleResponse",async(n,i)=>{const{id:o}=i;uh(i)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(Hr("session_approve",o),{})):bu(i)&&(await this.client.session.delete(n,As("USER_DISCONNECTED")),this.events.emit(Hr("session_approve",o),{error:i.error}))}),dn(this,"onSessionUpdateRequest",async(n,i)=>{const{params:o,id:l}=i;try{const h=`${n}_session_update`,s=bx.get(h);if(s&&this.isRequestOutOfSync(s,l)){this.client.logger.warn(`Discarding out of sync request - ${l}`),this.sendError({id:l,topic:n,error:As("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(zr({topic:n},o));try{bx.set(h,l),await this.client.session.update(n,{namespaces:o.namespaces}),await this.sendResult({id:l,topic:n,result:!0})}catch(w){throw bx.delete(h),w}this.client.events.emit("session_update",{id:l,topic:n,params:o})}catch(h){await this.sendError({id:l,topic:n,error:h}),this.client.logger.error(h)}}),dn(this,"isRequestOutOfSync",(n,i)=>i.toString().slice(0,-3)<n.toString().slice(0,-3)),dn(this,"onSessionUpdateResponse",(n,i)=>{const{id:o}=i,l=Hr("session_update",o);if(this.events.listenerCount(l)===0)throw new Error(`emitting ${l} without any listeners`);uh(i)?this.events.emit(Hr("session_update",o),{}):bu(i)&&this.events.emit(Hr("session_update",o),{error:i.error})}),dn(this,"onSessionExtendRequest",async(n,i)=>{const{id:o}=i;try{this.isValidExtend({topic:n}),await this.setExpiry(n,mo(w1)),await this.sendResult({id:o,topic:n,result:!0}),this.client.events.emit("session_extend",{id:o,topic:n})}catch(l){await this.sendError({id:o,topic:n,error:l}),this.client.logger.error(l)}}),dn(this,"onSessionExtendResponse",(n,i)=>{const{id:o}=i,l=Hr("session_extend",o);if(this.events.listenerCount(l)===0)throw new Error(`emitting ${l} without any listeners`);uh(i)?this.events.emit(Hr("session_extend",o),{}):bu(i)&&this.events.emit(Hr("session_extend",o),{error:i.error})}),dn(this,"onSessionPingRequest",async(n,i)=>{const{id:o}=i;try{this.isValidPing({topic:n}),await this.sendResult({id:o,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:o,topic:n})}catch(l){await this.sendError({id:o,topic:n,error:l}),this.client.logger.error(l)}}),dn(this,"onSessionPingResponse",(n,i)=>{const{id:o}=i,l=Hr("session_ping",o);setTimeout(()=>{if(this.events.listenerCount(l)===0)throw new Error(`emitting ${l} without any listeners 2176`);uh(i)?this.events.emit(Hr("session_ping",o),{}):bu(i)&&this.events.emit(Hr("session_ping",o),{error:i.error})},500)}),dn(this,"onSessionDeleteRequest",async(n,i)=>{const{id:o}=i;try{await this.isValidDisconnect({topic:n,reason:i.params}),this.cleanupPendingSentRequestsForTopic({topic:n,error:As("USER_DISCONNECTED")}),await this.deleteSession({topic:n,id:o})}catch(l){this.client.logger.error(l)}}),dn(this,"onSessionRequest",async n=>{var i,o,l;const{topic:h,payload:s,attestation:w,encryptedId:x,transportType:A}=n,{id:P,params:D}=s;try{await this.isValidRequest(zr({topic:h},D));const M=this.client.session.get(h),z=await this.getVerifyContext({attestationId:w,hash:wu(JSON.stringify(ud("wc_sessionRequest",D,P))),encryptedId:x,metadata:M.peer.metadata,transportType:A}),U={id:P,topic:h,params:D,verifyContext:z};await this.setPendingSessionRequest(U),A===bs.link_mode&&(i=M.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((o=M.peer.metadata.redirect)==null?void 0:o.universal),(l=this.client.signConfig)!=null&&l.disableRequestQueue?this.emitSessionRequest(U):(this.addSessionRequestToSessionRequestQueue(U),this.processSessionRequestQueue())}catch(M){await this.sendError({id:P,topic:h,error:M}),this.client.logger.error(M)}}),dn(this,"onSessionRequestResponse",(n,i)=>{const{id:o}=i,l=Hr("session_request",o);if(this.events.listenerCount(l)===0)throw new Error(`emitting ${l} without any listeners`);uh(i)?this.events.emit(Hr("session_request",o),{result:i.result}):bu(i)&&this.events.emit(Hr("session_request",o),{error:i.error})}),dn(this,"onSessionEventRequest",async(n,i)=>{const{id:o,params:l}=i;try{const h=`${n}_session_event_${l.event.name}`,s=bx.get(h);if(s&&this.isRequestOutOfSync(s,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(zr({topic:n},l)),this.client.events.emit("session_event",{id:o,topic:n,params:l}),bx.set(h,o)}catch(h){await this.sendError({id:o,topic:n,error:h}),this.client.logger.error(h)}}),dn(this,"onSessionAuthenticateResponse",(n,i)=>{const{id:o}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:i}),uh(i)?this.events.emit(Hr("session_request",o),{result:i.result}):bu(i)&&this.events.emit(Hr("session_request",o),{error:i.error})}),dn(this,"onSessionAuthenticateRequest",async n=>{var i;const{topic:o,payload:l,attestation:h,encryptedId:s,transportType:w}=n;try{const{requester:x,authPayload:A,expiryTimestamp:P}=l.params,D=await this.getVerifyContext({attestationId:h,hash:wu(JSON.stringify(l)),encryptedId:s,metadata:x.metadata,transportType:w}),M={requester:x,pairingTopic:o,id:l.id,authPayload:A,verifyContext:D,expiryTimestamp:P};await this.setAuthRequest(l.id,{request:M,pairingTopic:o,transportType:w}),w===bs.link_mode&&(i=x.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(x.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:o,params:l.params,id:l.id,verifyContext:D})}catch(x){this.client.logger.error(x);const A=l.params.requester.publicKey,P=await this.client.core.crypto.generateKeyPair(),D=this.getAppLinkIfEnabled(l.params.requester.metadata,w),M={type:$f,receiverPublicKey:A,senderPublicKey:P};await this.sendError({id:l.id,topic:o,error:x,encodeOpts:M,rpcOpts:Ca.wc_sessionAuthenticate.autoReject,appLink:D})}}),dn(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),dn(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ah.idle,this.processSessionRequestQueue()},vn.toMiliseconds(this.requestQueueDelay))}),dn(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:i})=>{const o=this.client.core.history.pending;o.length>0&&o.filter(l=>l.topic===n&&l.request.method==="wc_sessionRequest").forEach(l=>{this.events.emit(Hr("session_request",l.request.id),{error:i})})}),dn(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ah.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(n)}catch(i){this.client.logger.error(i)}}),dn(this,"emitSessionRequest",n=>{if(this.emittedSessionRequests.has(n.id)){this.client.logger.warn({id:n.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${n.id}`);return}this.sessionRequestQueue.state=ah.active,this.emittedSessionRequests.add(n.id),this.client.events.emit("session_request",n)}),dn(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;const i=this.client.proposal.getAll().find(o=>o.pairingTopic===n.topic);i&&this.onSessionProposeRequest({topic:n.topic,payload:ud("wc_sessionPropose",Ta(zr({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),dn(this,"isValidConnect",async n=>{if(!Xc(n)){const{message:x}=An("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(x)}const{pairingTopic:i,requiredNamespaces:o,optionalNamespaces:l,sessionProperties:h,scopedProperties:s,relays:w}=n;if(sa(i)||await this.isValidPairingTopic(i),!tEe(w)){const{message:x}=An("MISSING_OR_INVALID",`connect() relays: ${w}`);throw new Error(x)}if(o&&!sa(o)&&bh(o)!==0){const x="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(x):this.client.logger.warn(x),this.validateNamespaces(o,"requiredNamespaces")}if(l&&!sa(l)&&bh(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),h&&!sa(h)&&this.validateSessionProps(h,"sessionProperties"),s&&!sa(s)){this.validateSessionProps(s,"scopedProperties");const x=Object.keys(o||{}).concat(Object.keys(l||{}));if(!Object.keys(s).every(A=>x.includes(A.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(s)}, required/optional namespaces: ${JSON.stringify(x)}`)}}),dn(this,"validateNamespaces",(n,i)=>{const o=eEe(n,"connect()",i);if(o)throw new Error(o.message)}),dn(this,"isValidApprove",async n=>{if(!Xc(n))throw new Error(An("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:i,namespaces:o,relayProtocol:l,sessionProperties:h,scopedProperties:s}=n;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const w=this.client.proposal.get(i),x=HP(o,"approve()");if(x)throw new Error(x.message);const A=mz(w.requiredNamespaces,o,"approve()");if(A)throw new Error(A.message);if(!wo(l,!0)){const{message:P}=An("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(P)}if(h&&!sa(h)&&this.validateSessionProps(h,"sessionProperties"),s&&!sa(s)){this.validateSessionProps(s,"scopedProperties");const P=new Set(Object.keys(o));if(!Object.keys(s).every(D=>P.has(D.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(s)}, approved namespaces: ${Array.from(P).join(", ")}`)}}),dn(this,"isValidReject",async n=>{if(!Xc(n)){const{message:l}=An("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(l)}const{id:i,reason:o}=n;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!iEe(o)){const{message:l}=An("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(l)}}),dn(this,"isValidSessionSettleRequest",n=>{if(!Xc(n)){const{message:x}=An("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(x)}const{relay:i,controller:o,namespaces:l,expiry:h}=n;if(!nK(i)){const{message:x}=An("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const s=Z2e(o,"onSessionSettleRequest()");if(s)throw new Error(s.message);const w=HP(l,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(hh(h)){const{message:x}=An("EXPIRED","onSessionSettleRequest()");throw new Error(x)}}),dn(this,"isValidUpdate",async n=>{if(!Xc(n)){const{message:w}=An("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(w)}const{topic:i,namespaces:o}=n;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const l=this.client.session.get(i),h=HP(o,"update()");if(h)throw new Error(h.message);const s=mz(l.requiredNamespaces,o,"update()");if(s)throw new Error(s.message)}),dn(this,"isValidExtend",async n=>{if(!Xc(n)){const{message:o}=An("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(o)}const{topic:i}=n;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),dn(this,"isValidRequest",async n=>{if(!Xc(n)){const{message:w}=An("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(w)}const{topic:i,request:o,chainId:l,expiry:h}=n;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:s}=this.client.session.get(i);if(!pz(s,l)){const{message:w}=An("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(w)}if(!rEe(o)){const{message:w}=An("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!aEe(s,l,o.method)){const{message:w}=An("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}this.validateRequestExpiry(h)}),dn(this,"isValidRespond",async n=>{var i;if(!Xc(n)){const{message:s}=An("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(s)}const{topic:o,response:l}=n;try{await this.isValidSessionTopic(o)}catch(s){throw(i=n==null?void 0:n.response)!=null&&i.id&&this.cleanupAfterResponse(n),s}if(!sEe(l)){const{message:s}=An("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(l)}`);throw new Error(s)}const h=this.client.pendingRequest.get(l.id);if(h.topic!==o){const{message:s}=An("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${l.id}, expected topic: ${h.topic}, received topic: ${o}`);throw new Error(s)}}),dn(this,"isValidPing",async n=>{if(!Xc(n)){const{message:o}=An("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(o)}const{topic:i}=n;await this.isValidSessionOrPairingTopic(i)}),dn(this,"isValidEmit",async n=>{if(!Xc(n)){const{message:s}=An("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(s)}const{topic:i,event:o,chainId:l}=n;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!pz(h,l)){const{message:s}=An("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(s)}if(!oEe(o)){const{message:s}=An("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(s)}if(!cEe(h,l,o.name)){const{message:s}=An("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(s)}}),dn(this,"isValidDisconnect",async n=>{if(!Xc(n)){const{message:o}=An("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(o)}const{topic:i}=n;await this.isValidSessionOrPairingTopic(i)}),dn(this,"isValidAuthenticate",n=>{const{chains:i,uri:o,domain:l,nonce:h}=n;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!wo(o,!1))throw new Error("uri is required parameter");if(!wo(l,!1))throw new Error("domain is required parameter");if(!wo(h,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(w=>Ff(w).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:s}=Ff(i[0]);if(s!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),dn(this,"getVerifyContext",async n=>{const{attestationId:i,hash:o,encryptedId:l,metadata:h,transportType:s}=n,w={verified:{verifyUrl:h.verifyUrl||Wx,validation:"UNKNOWN",origin:h.url||""}};try{if(s===bs.link_mode){const A=this.getAppLinkIfEnabled(h,s);return w.verified.validation=A&&new URL(A).origin===new URL(h.url).origin?"VALID":"INVALID",w}const x=await this.client.core.verify.resolve({attestationId:i,hash:o,encryptedId:l,verifyUrl:h.verifyUrl});x&&(w.verified.origin=x.origin,w.verified.isScam=x.isScam,w.verified.validation=x.origin===new URL(h.url).origin?"VALID":"INVALID")}catch(x){this.client.logger.warn(x)}return this.client.logger.debug(`Verify context: ${JSON.stringify(w)}`),w}),dn(this,"validateSessionProps",(n,i)=>{Object.values(n).forEach((o,l)=>{if(o==null){const{message:h}=An("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${o} for key ${Object.keys(n)[l]}`);throw new Error(h)}})}),dn(this,"getPendingAuthRequest",n=>{const i=this.client.auth.requests.get(n);return typeof i=="object"?i:void 0}),dn(this,"addToRecentlyDeleted",(n,i)=>{if(this.recentlyDeletedMap.set(n,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let o=0;const l=this.recentlyDeletedLimit/2;for(const h of this.recentlyDeletedMap.keys()){if(o++>=l)break;this.recentlyDeletedMap.delete(h)}}}),dn(this,"checkRecentlyDeleted",n=>{const i=this.recentlyDeletedMap.get(n);if(i){const{message:o}=An("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${n}`);throw new Error(o)}}),dn(this,"isLinkModeEnabled",(n,i)=>{var o,l,h,s,w,x,A,P,D;return!n||i!==bs.link_mode?!1:((l=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:l.linkMode)===!0&&((s=(h=this.client.metadata)==null?void 0:h.redirect)==null?void 0:s.universal)!==void 0&&((x=(w=this.client.metadata)==null?void 0:w.redirect)==null?void 0:x.universal)!==""&&((A=n==null?void 0:n.redirect)==null?void 0:A.universal)!==void 0&&((P=n==null?void 0:n.redirect)==null?void 0:P.universal)!==""&&((D=n==null?void 0:n.redirect)==null?void 0:D.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),dn(this,"getAppLinkIfEnabled",(n,i)=>{var o;return this.isLinkModeEnabled(n,i)?(o=n==null?void 0:n.redirect)==null?void 0:o.universal:void 0}),dn(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;const i=A7(n,"topic")||"",o=decodeURIComponent(A7(n,"wc_ev")||""),l=this.client.session.keys.includes(i);l&&this.client.session.update(i,{transportType:bs.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:o,sessionExists:l})}),dn(this,"registerLinkModeListeners",async()=>{var n;if(bD()||Ym()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const o=await i.getInitialURL();o&&setTimeout(()=>{this.handleLinkModeMessage({url:o})},50)}}}),dn(this,"getTVFApproveParams",n=>{try{const i=eK(n.namespaces),o=M2e(n.namespaces),l=L2e(n.namespaces),h=n.sessionProperties,s=n.scopedProperties;return{approvedChains:i,approvedMethods:o,approvedEvents:l,sessionProperties:h,scopedProperties:s}}catch(i){return this.client.logger.warn(i,"Error getting TVF approve params"),{}}}),dn(this,"getTVFParams",(n,i,o)=>{var l,h,s;if(!((l=i.request)!=null&&l.method))return{};const w={correlationId:n,rpcMethods:[i.request.method],chainId:i.chainId};try{const x=this.extractTxHashesFromResult(i.request,o);w.txHashes=x,w.contractAddresses=this.isValidContractData(i.request.params)?[(s=(h=i.request.params)==null?void 0:h[0])==null?void 0:s.to]:[]}catch(x){this.client.logger.warn(x,"Error getting TVF params")}return w}),dn(this,"isValidContractData",n=>{var i;if(!n)return!1;try{const o=(n==null?void 0:n.data)||((i=n==null?void 0:n[0])==null?void 0:i.data);if(!o.startsWith("0x"))return!1;const l=o.slice(2);return/^[0-9a-fA-F]*$/.test(l)?l.length%2===0:!1}catch{}return!1}),dn(this,"extractTxHashesFromResult",(n,i)=>{var o;try{if(!i)return[];const l=n.method,h=MTe[l];if(l==="sui_signTransaction")return[Cve(i.transactionBytes)];if(l==="near_signTransaction")return[N7(i)];if(l==="near_signTransactions")return i.map(w=>N7(w));if(l==="xrpl_signTransactionFor"||l==="xrpl_signTransaction")return[(o=i.tx_json)==null?void 0:o.hash];if(l==="polkadot_signTransaction")return[AEe({transaction:n.params.transactionPayload,signature:i.signature})];if(l==="algo_signTxn")return zf(i)?i.map(w=>M7(w)):[M7(i)];if(l==="cosmos_signDirect")return[Ave(i)];if(l==="wallet_sendCalls")return Sve(i);if(typeof i=="string")return[i];const s=i[h.key];if(zf(s))return l==="solana_signAllTransactions"?s.map(w=>Eve(w)):s;if(typeof s=="string")return[s]}catch(l){this.client.logger.warn(l,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,o]of Object.entries(n))for(const l of o)try{await this.onProviderMessageEvent({topic:i,message:l,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${l}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=An("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(yo.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:n,message:i,attestation:o,transportType:l}=e,{publicKey:h}=this.client.auth.authKeys.keys.includes(HT)?this.client.auth.authKeys.get(HT):{publicKey:void 0};try{const s=await this.client.core.crypto.decode(n,i,{receiverPublicKey:h,encoding:l===bs.link_mode?mm:tl});DD(s)?(this.client.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s,attestation:o,transportType:l,encryptedId:wu(i)})):aI(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s,transportType:l}),this.client.core.history.delete(n,s.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(s)}`),await this.onRelayEventUnknownPayload({topic:n,payload:s,transportType:l})),await this.client.core.relayer.messages.ack(n,i)}catch(s){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${i}`),this.client.logger.error(s)}}registerExpirerEvents(){this.client.core.expirer.on(yu.expired,async e=>{const{topic:n,id:i}=tZ(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,An("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,An("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(b0.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(b0.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!wo(e,!1)){const{message:n}=An("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:n}=An("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(hh(this.client.core.pairing.pairings.get(e).expiry)){const{message:n}=An("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!wo(e,!1)){const{message:n}=An("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:n}=An("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(hh(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:n}=An("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){const{message:n}=An("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(wo(e,!1)){const{message:n}=An("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{const{message:n}=An("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!nEe(e)){const{message:n}=An("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){const{message:n}=An("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(hh(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:n}=An("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}validateRequestExpiry(e){if(e&&!dEe(e,XP)){const{message:n}=An("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${XP.min} and ${XP.max}`);throw new Error(n)}}}class KTe extends ky{constructor(e,n){super(e,n,kTe,MD),this.core=e,this.logger=n}}let YTe=class extends ky{constructor(e,n){super(e,n,DTe,MD),this.core=e,this.logger=n}};class XTe extends ky{constructor(e,n){super(e,n,LTe,MD,i=>i.id),this.core=e,this.logger=n}}class JTe extends ky{constructor(e,n){super(e,n,zTe,lI,()=>HT),this.core=e,this.logger=n}}class QTe extends ky{constructor(e,n){super(e,n,UTe,lI),this.core=e,this.logger=n}}class eAe extends ky{constructor(e,n){super(e,n,jTe,lI,i=>i.id),this.core=e,this.logger=n}}var tAe=Object.defineProperty,nAe=(t,e,n)=>e in t?tAe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,JP=(t,e,n)=>nAe(t,typeof e!="symbol"?e+"":e,n);class iAe{constructor(e,n){this.core=e,this.logger=n,JP(this,"authKeys"),JP(this,"pairingTopics"),JP(this,"requests"),this.authKeys=new JTe(this.core,this.logger),this.pairingTopics=new QTe(this.core,this.logger),this.requests=new eAe(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var rAe=Object.defineProperty,sAe=(t,e,n)=>e in t?rAe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vr=(t,e,n)=>sAe(t,typeof e!="symbol"?e+"":e,n);class LD extends Hme{constructor(e){super(e),vr(this,"protocol",AK),vr(this,"version",SK),vr(this,"name",YP.name),vr(this,"metadata"),vr(this,"core"),vr(this,"logger"),vr(this,"events",new Ru.EventEmitter),vr(this,"engine"),vr(this,"session"),vr(this,"proposal"),vr(this,"pendingRequest"),vr(this,"auth"),vr(this,"signConfig"),vr(this,"on",(i,o)=>this.events.on(i,o)),vr(this,"once",(i,o)=>this.events.once(i,o)),vr(this,"off",(i,o)=>this.events.off(i,o)),vr(this,"removeListener",(i,o)=>this.events.removeListener(i,o)),vr(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),vr(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"update",async i=>{try{return await this.engine.update(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"request",async i=>{try{return await this.engine.request(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"find",i=>{try{return this.engine.find(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),vr(this,"authenticate",async(i,o)=>{try{return await this.engine.authenticate(i,o)}catch(l){throw this.logger.error(l.message),l}}),vr(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(o){throw this.logger.error(o.message),o}}),vr(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(o){throw this.logger.error(o.message),o}}),this.name=(e==null?void 0:e.name)||YP.name,this.metadata=gbe(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const n=OD({logger:(e==null?void 0:e.logger)||YP.logger,name:this.name});this.logger=n,this.core=(e==null?void 0:e.core)||new OTe(e),this.session=new YTe(this.core,this.logger),this.proposal=new KTe(this.core,this.logger),this.pendingRequest=new XTe(this.core,this.logger),this.engine=new ZTe(this),this.auth=new iAe(this.core,this.logger)}static async init(e){const n=new LD(e);return await n.initialize(),n}get context(){return ul(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const oAe=LD;var fO={exports:{}};(function(t,e){var n=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Tc<"u"&&Tc,i=function(){function l(){this.fetch=!1,this.DOMException=n.DOMException}return l.prototype=n,new l}();(function(l){(function(h){var s=typeof l<"u"&&l||typeof self<"u"&&self||typeof Tc<"u"&&Tc||{},w={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function x(re){return re&&DataView.prototype.isPrototypeOf(re)}if(w.arrayBuffer)var A=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],P=ArrayBuffer.isView||function(re){return re&&A.indexOf(Object.prototype.toString.call(re))>-1};function D(re){if(typeof re!="string"&&(re=String(re)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(re)||re==="")throw new TypeError('Invalid character in header field name: "'+re+'"');return re.toLowerCase()}function M(re){return typeof re!="string"&&(re=String(re)),re}function z(re){var le={next:function(){var Ae=re.shift();return{done:Ae===void 0,value:Ae}}};return w.iterable&&(le[Symbol.iterator]=function(){return le}),le}function U(re){this.map={},re instanceof U?re.forEach(function(le,Ae){this.append(Ae,le)},this):Array.isArray(re)?re.forEach(function(le){if(le.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+le.length);this.append(le[0],le[1])},this):re&&Object.getOwnPropertyNames(re).forEach(function(le){this.append(le,re[le])},this)}U.prototype.append=function(re,le){re=D(re),le=M(le);var Ae=this.map[re];this.map[re]=Ae?Ae+", "+le:le},U.prototype.delete=function(re){delete this.map[D(re)]},U.prototype.get=function(re){return re=D(re),this.has(re)?this.map[re]:null},U.prototype.has=function(re){return this.map.hasOwnProperty(D(re))},U.prototype.set=function(re,le){this.map[D(re)]=M(le)},U.prototype.forEach=function(re,le){for(var Ae in this.map)this.map.hasOwnProperty(Ae)&&re.call(le,this.map[Ae],Ae,this)},U.prototype.keys=function(){var re=[];return this.forEach(function(le,Ae){re.push(Ae)}),z(re)},U.prototype.values=function(){var re=[];return this.forEach(function(le){re.push(le)}),z(re)},U.prototype.entries=function(){var re=[];return this.forEach(function(le,Ae){re.push([Ae,le])}),z(re)},w.iterable&&(U.prototype[Symbol.iterator]=U.prototype.entries);function G(re){if(!re._noBody){if(re.bodyUsed)return Promise.reject(new TypeError("Already read"));re.bodyUsed=!0}}function ne(re){return new Promise(function(le,Ae){re.onload=function(){le(re.result)},re.onerror=function(){Ae(re.error)}})}function oe(re){var le=new FileReader,Ae=ne(le);return le.readAsArrayBuffer(re),Ae}function Q(re){var le=new FileReader,Ae=ne(le),Le=/charset=([A-Za-z0-9_-]+)/.exec(re.type),De=Le?Le[1]:"utf-8";return le.readAsText(re,De),Ae}function de(re){for(var le=new Uint8Array(re),Ae=new Array(le.length),Le=0;Le<le.length;Le++)Ae[Le]=String.fromCharCode(le[Le]);return Ae.join("")}function he(re){if(re.slice)return re.slice(0);var le=new Uint8Array(re.byteLength);return le.set(new Uint8Array(re)),le.buffer}function Ie(){return this.bodyUsed=!1,this._initBody=function(re){this.bodyUsed=this.bodyUsed,this._bodyInit=re,re?typeof re=="string"?this._bodyText=re:w.blob&&Blob.prototype.isPrototypeOf(re)?this._bodyBlob=re:w.formData&&FormData.prototype.isPrototypeOf(re)?this._bodyFormData=re:w.searchParams&&URLSearchParams.prototype.isPrototypeOf(re)?this._bodyText=re.toString():w.arrayBuffer&&w.blob&&x(re)?(this._bodyArrayBuffer=he(re.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):w.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(re)||P(re))?this._bodyArrayBuffer=he(re):this._bodyText=re=Object.prototype.toString.call(re):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof re=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):w.searchParams&&URLSearchParams.prototype.isPrototypeOf(re)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},w.blob&&(this.blob=function(){var re=G(this);if(re)return re;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var re=G(this);return re||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(w.blob)return this.blob().then(oe);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var re=G(this);if(re)return re;if(this._bodyBlob)return Q(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(de(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},w.formData&&(this.formData=function(){return this.text().then(ht)}),this.json=function(){return this.text().then(JSON.parse)},this}var ke=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Ue(re){var le=re.toUpperCase();return ke.indexOf(le)>-1?le:re}function ze(re,le){if(!(this instanceof ze))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');le=le||{};var Ae=le.body;if(re instanceof ze){if(re.bodyUsed)throw new TypeError("Already read");this.url=re.url,this.credentials=re.credentials,le.headers||(this.headers=new U(re.headers)),this.method=re.method,this.mode=re.mode,this.signal=re.signal,!Ae&&re._bodyInit!=null&&(Ae=re._bodyInit,re.bodyUsed=!0)}else this.url=String(re);if(this.credentials=le.credentials||this.credentials||"same-origin",(le.headers||!this.headers)&&(this.headers=new U(le.headers)),this.method=Ue(le.method||this.method||"GET"),this.mode=le.mode||this.mode||null,this.signal=le.signal||this.signal||function(){if("AbortController"in s){var He=new AbortController;return He.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Ae)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(Ae),(this.method==="GET"||this.method==="HEAD")&&(le.cache==="no-store"||le.cache==="no-cache")){var Le=/([?&])_=[^&]*/;if(Le.test(this.url))this.url=this.url.replace(Le,"$1_="+new Date().getTime());else{var De=/\?/;this.url+=(De.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}ze.prototype.clone=function(){return new ze(this,{body:this._bodyInit})};function ht(re){var le=new FormData;return re.trim().split("&").forEach(function(Ae){if(Ae){var Le=Ae.split("="),De=Le.shift().replace(/\+/g," "),He=Le.join("=").replace(/\+/g," ");le.append(decodeURIComponent(De),decodeURIComponent(He))}}),le}function ft(re){var le=new U,Ae=re.replace(/\r?\n[\t ]+/g," ");return Ae.split("\r").map(function(Le){return Le.indexOf(`
`)===0?Le.substr(1,Le.length):Le}).forEach(function(Le){var De=Le.split(":"),He=De.shift().trim();if(He){var Et=De.join(":").trim();try{le.append(He,Et)}catch(Ct){console.warn("Response "+Ct.message)}}}),le}Ie.call(ze.prototype);function ct(re,le){if(!(this instanceof ct))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(le||(le={}),this.type="default",this.status=le.status===void 0?200:le.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=le.statusText===void 0?"":""+le.statusText,this.headers=new U(le.headers),this.url=le.url||"",this._initBody(re)}Ie.call(ct.prototype),ct.prototype.clone=function(){return new ct(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new U(this.headers),url:this.url})},ct.error=function(){var re=new ct(null,{status:200,statusText:""});return re.ok=!1,re.status=0,re.type="error",re};var je=[301,302,303,307,308];ct.redirect=function(re,le){if(je.indexOf(le)===-1)throw new RangeError("Invalid status code");return new ct(null,{status:le,headers:{location:re}})},h.DOMException=s.DOMException;try{new h.DOMException}catch{h.DOMException=function(le,Ae){this.message=le,this.name=Ae;var Le=Error(le);this.stack=Le.stack},h.DOMException.prototype=Object.create(Error.prototype),h.DOMException.prototype.constructor=h.DOMException}function Ye(re,le){return new Promise(function(Ae,Le){var De=new ze(re,le);if(De.signal&&De.signal.aborted)return Le(new h.DOMException("Aborted","AbortError"));var He=new XMLHttpRequest;function Et(){He.abort()}He.onload=function(){var Bt={statusText:He.statusText,headers:ft(He.getAllResponseHeaders()||"")};De.url.indexOf("file://")===0&&(He.status<200||He.status>599)?Bt.status=200:Bt.status=He.status,Bt.url="responseURL"in He?He.responseURL:Bt.headers.get("X-Request-URL");var Yt="response"in He?He.response:He.responseText;setTimeout(function(){Ae(new ct(Yt,Bt))},0)},He.onerror=function(){setTimeout(function(){Le(new TypeError("Network request failed"))},0)},He.ontimeout=function(){setTimeout(function(){Le(new TypeError("Network request timed out"))},0)},He.onabort=function(){setTimeout(function(){Le(new h.DOMException("Aborted","AbortError"))},0)};function Ct(Bt){try{return Bt===""&&s.location.href?s.location.href:Bt}catch{return Bt}}if(He.open(De.method,Ct(De.url),!0),De.credentials==="include"?He.withCredentials=!0:De.credentials==="omit"&&(He.withCredentials=!1),"responseType"in He&&(w.blob?He.responseType="blob":w.arrayBuffer&&(He.responseType="arraybuffer")),le&&typeof le.headers=="object"&&!(le.headers instanceof U||s.Headers&&le.headers instanceof s.Headers)){var Dt=[];Object.getOwnPropertyNames(le.headers).forEach(function(Bt){Dt.push(D(Bt)),He.setRequestHeader(Bt,M(le.headers[Bt]))}),De.headers.forEach(function(Bt,Yt){Dt.indexOf(Yt)===-1&&He.setRequestHeader(Yt,Bt)})}else De.headers.forEach(function(Bt,Yt){He.setRequestHeader(Yt,Bt)});De.signal&&(De.signal.addEventListener("abort",Et),He.onreadystatechange=function(){He.readyState===4&&De.signal.removeEventListener("abort",Et)}),He.send(typeof De._bodyInit>"u"?null:De._bodyInit)})}return Ye.polyfill=!0,s.fetch||(s.fetch=Ye,s.Headers=U,s.Request=ze,s.Response=ct),h.Headers=U,h.Request=ze,h.Response=ct,h.fetch=Ye,Object.defineProperty(h,"__esModule",{value:!0}),h})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var o=n.fetch?n:i;e=o.fetch,e.default=o.fetch,e.fetch=o.fetch,e.Headers=o.Headers,e.Request=o.Request,e.Response=o.Response,t.exports=e})(fO,fO.exports);var aAe=fO.exports;const Jz=Zm(aAe);var cAe=Object.defineProperty,lAe=Object.defineProperties,uAe=Object.getOwnPropertyDescriptors,Qz=Object.getOwnPropertySymbols,dAe=Object.prototype.hasOwnProperty,hAe=Object.prototype.propertyIsEnumerable,eU=(t,e,n)=>e in t?cAe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tU=(t,e)=>{for(var n in e||(e={}))dAe.call(e,n)&&eU(t,n,e[n]);if(Qz)for(var n of Qz(e))hAe.call(e,n)&&eU(t,n,e[n]);return t},nU=(t,e)=>lAe(t,uAe(e));const fAe={Accept:"application/json","Content-Type":"application/json"},pAe="POST",iU={headers:fAe,method:pAe},rU=10;let PK=class{constructor(e,n=!1){if(this.url=e,this.disableProviderPing=n,this.events=new Ru.EventEmitter,this.isAvailable=!1,this.registering=!1,!vz(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=n}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const n=Q0(e),i=await(await Jz(this.url,nU(tU({},iU),{body:n}))).json();this.onPayload({data:i})}catch(n){this.onError(e.id,n)}}async register(e=this.url){if(!vz(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((i,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const n=Q0({id:1,jsonrpc:"2.0",method:"test",params:[]});await Jz(e,nU(tU({},iU),{body:n}))}this.onOpen()}catch(n){const i=this.parseError(n);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?J0(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const i=this.parseError(n),o=i.message||i.toString(),l=oI(e,o);this.events.emit("payload",l)}parseError(e,n=this.url){return sK(e,n,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>rU&&this.events.setMaxListeners(rU)}};function BD(t){return t==null||typeof t!="object"&&typeof t!="function"}function RK(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function OK(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const mAe="[object RegExp]",kK="[object String]",DK="[object Number]",NK="[object Boolean]",MK="[object Arguments]",gAe="[object Symbol]",yAe="[object Date]",_Ae="[object Map]",wAe="[object Set]",bAe="[object Array]",vAe="[object ArrayBuffer]",xAe="[object Object]",EAe="[object DataView]",CAe="[object Uint8Array]",TAe="[object Uint8ClampedArray]",AAe="[object Uint16Array]",SAe="[object Uint32Array]",IAe="[object Int8Array]",PAe="[object Int16Array]",RAe="[object Int32Array]",OAe="[object Float32Array]",kAe="[object Float64Array]";function FD(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function DAe(t,e){return P1(t,void 0,t,new Map,e)}function P1(t,e,n,i=new Map,o=void 0){const l=o==null?void 0:o(t,e,n,i);if(l!=null)return l;if(BD(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const h=new Array(t.length);i.set(t,h);for(let s=0;s<t.length;s++)h[s]=P1(t[s],s,n,i,o);return Object.hasOwn(t,"index")&&(h.index=t.index),Object.hasOwn(t,"input")&&(h.input=t.input),h}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const h=new RegExp(t.source,t.flags);return h.lastIndex=t.lastIndex,h}if(t instanceof Map){const h=new Map;i.set(t,h);for(const[s,w]of t)h.set(s,P1(w,s,n,i,o));return h}if(t instanceof Set){const h=new Set;i.set(t,h);for(const s of t)h.add(P1(s,void 0,n,i,o));return h}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(FD(t)){const h=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,h);for(let s=0;s<t.length;s++)h[s]=P1(t[s],s,n,i,o);return h}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const h=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,h),v0(h,t,n,i,o),h}if(typeof File<"u"&&t instanceof File){const h=new File([t],t.name,{type:t.type});return i.set(t,h),v0(h,t,n,i,o),h}if(t instanceof Blob){const h=new Blob([t],{type:t.type});return i.set(t,h),v0(h,t,n,i,o),h}if(t instanceof Error){const h=new t.constructor;return i.set(t,h),h.message=t.message,h.name=t.name,h.stack=t.stack,h.cause=t.cause,v0(h,t,n,i,o),h}if(typeof t=="object"&&NAe(t)){const h=Object.create(Object.getPrototypeOf(t));return i.set(t,h),v0(h,t,n,i,o),h}return t}function v0(t,e,n=t,i,o){const l=[...Object.keys(e),...RK(e)];for(let h=0;h<l.length;h++){const s=l[h],w=Object.getOwnPropertyDescriptor(t,s);(w==null||w.writable)&&(t[s]=P1(e[s],s,n,i,o))}}function NAe(t){switch(OK(t)){case MK:case bAe:case vAe:case EAe:case NK:case yAe:case OAe:case kAe:case IAe:case PAe:case RAe:case _Ae:case DK:case xAe:case mAe:case wAe:case kK:case gAe:case CAe:case TAe:case AAe:case SAe:return!0;default:return!1}}function MAe(t,e){return DAe(t,(n,i,o,l)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case DK:case kK:case NK:{const h=new t.constructor(t==null?void 0:t.valueOf());return v0(h,t),h}case MK:{const h={};return v0(h,t),h.length=t.length,h[Symbol.iterator]=t[Symbol.iterator],h}default:return}})}function sU(t){return MAe(t)}function oU(t){return t!==null&&typeof t=="object"&&OK(t)==="[object Arguments]"}function aU(t){return typeof t=="object"&&t!==null}function LAe(){}function BAe(t){return FD(t)}function FAe(t){var n;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const i=t[Symbol.toStringTag];return i==null||!((n=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&n.writable)?!1:t.toString()===`[object ${i}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function $Ae(t){if(BD(t))return t;if(Array.isArray(t)||FD(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),n=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new n(t);if(t instanceof RegExp){const i=new n(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new n(t.buffer.slice(0));if(t instanceof Error){const i=new n(t.message);return i.stack=t.stack,i.name=t.name,i.cause=t.cause,i}if(typeof File<"u"&&t instanceof File)return new n([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function zAe(t,...e){const n=e.slice(0,-1),i=e[e.length-1];let o=t;for(let l=0;l<n.length;l++){const h=n[l];o=pO(o,h,i,new Map)}return o}function pO(t,e,n,i){if(BD(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return $Ae(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let l=0;l<e.length;l++)e[l]=e[l]??void 0}const o=[...Object.keys(e),...RK(e)];for(let l=0;l<o.length;l++){const h=o[l];let s=e[h],w=t[h];if(oU(s)&&(s={...s}),oU(w)&&(w={...w}),typeof Buffer<"u"&&Buffer.isBuffer(s)&&(s=sU(s)),Array.isArray(s))if(typeof w=="object"&&w!=null){const A=[],P=Reflect.ownKeys(w);for(let D=0;D<P.length;D++){const M=P[D];A[M]=w[M]}w=A}else w=[];const x=n(w,s,h,t,e,i);x!=null?t[h]=x:Array.isArray(s)||aU(w)&&aU(s)?t[h]=pO(w,s,n,i):w==null&&FAe(s)?t[h]=pO({},s,n,i):w==null&&BAe(s)?t[h]=sU(s):(w===void 0||s!==void 0)&&(t[h]=s)}return t}function UAe(t,...e){return zAe(t,...e,LAe)}const cU="error",jAe="wss://relay.walletconnect.org",VAe="wc",LK="universal_provider",pT=`${VAe}@2:${LK}:`,BK="https://rpc.walletconnect.org/v1/",FK="generic",WAe=`${BK}bundler`,H1="call_status",HAe=86400,$D={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var GAe=Object.defineProperty,qAe=Object.defineProperties,ZAe=Object.getOwnPropertyDescriptors,lU=Object.getOwnPropertySymbols,KAe=Object.prototype.hasOwnProperty,YAe=Object.prototype.propertyIsEnumerable,uU=(t,e,n)=>e in t?GAe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mT=(t,e)=>{for(var n in e||(e={}))KAe.call(e,n)&&uU(t,n,e[n]);if(lU)for(var n of lU(e))YAe.call(e,n)&&uU(t,n,e[n]);return t},XAe=(t,e)=>qAe(t,ZAe(e));function $K(t,e,n){var i;const o=Ff(t);return((i=e.rpcMap)==null?void 0:i[o.reference])||`${BK}?chainId=${o.namespace}:${o.reference}&projectId=${n}`}function JAe(t){return t.includes(":")?t.split(":")[1]:t}function zK(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function QAe(t,e){const n=Object.keys(e.namespaces).filter(o=>o.includes(t));if(!n.length)return[];const i=[];return n.forEach(o=>{const l=e.namespaces[o].accounts;i.push(...l)}),i}function dU(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>{var i,o;return((i=n==null?void 0:n.chains)==null?void 0:i.length)&&((o=n==null?void 0:n.chains)==null?void 0:o.length)>0}))}function gT(t={},e={}){const n=dU(hU(t)),i=dU(hU(e));return UAe(n,i)}function hU(t){var e,n,i,o,l;const h={};if(!bh(t))return h;for(const[s,w]of Object.entries(t)){const x=sI(s)?[s]:w.chains,A=w.methods||[],P=w.events||[],D=w.rpcMap||{},M=I1(s);h[M]=XAe(mT(mT({},h[M]),w),{chains:wh(x,(e=h[M])==null?void 0:e.chains),methods:wh(A,(n=h[M])==null?void 0:n.methods),events:wh(P,(i=h[M])==null?void 0:i.events)}),(bh(D)||bh(((o=h[M])==null?void 0:o.rpcMap)||{}))&&(h[M].rpcMap=mT(mT({},D),(l=h[M])==null?void 0:l.rpcMap))}return h}function fU(t){return t.includes(":")?t.split(":")[2]:t}function pU(t){const e={};for(const[n,i]of Object.entries(t)){const o=i.methods||[],l=i.events||[],h=i.accounts||[],s=sI(n)?[n]:i.chains?i.chains:zK(i.accounts);e[n]={chains:s,methods:o,events:l,accounts:h}}return e}function QP(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function eSe(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const UK={},G1=t=>UK[t],eR=(t,e)=>{UK[t]=e};var tSe=Object.defineProperty,mU=Object.getOwnPropertySymbols,nSe=Object.prototype.hasOwnProperty,iSe=Object.prototype.propertyIsEnumerable,gU=(t,e,n)=>e in t?tSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,yU=(t,e)=>{for(var n in e||(e={}))nSe.call(e,n)&&gU(t,n,e[n]);if(mU)for(var n of mU(e))iSe.call(e,n)&&gU(t,n,e[n]);return t};const _U="eip155",rSe=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],sSe=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,tR=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,wU=t=>Object.keys(t).filter(e=>rSe.includes(e)).reduce((e,n)=>(e[n]=oSe(t[n]),e),{}),oSe=t=>typeof t=="string"&&eSe(t)?JSON.parse(t):t,aSe=(t,e,n)=>{const{sessionProperties:i={},scopedProperties:o={}}=t,l={};if(!bh(o)&&!bh(i))return;const h=wU(i);for(const s of n){const w=sSe(s);if(!w)continue;l[tR(w)]=h;const x=o==null?void 0:o[`${_U}:${w}`];if(x){const A=x==null?void 0:x[`${_U}:${w}:${e}`];l[tR(w)]=yU(yU({},l[tR(w)]),wU(A||x))}}for(const[s,w]of Object.entries(l))Object.keys(w).length===0&&delete l[s];return Object.keys(l).length>0?l:void 0};var cSe=Object.defineProperty,lSe=(t,e,n)=>e in t?cSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,uSe=(t,e,n)=>lSe(t,e+"",n);let nR;class zD{constructor(e){uSe(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,n){return await this.storage.setItem(e,n)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return nR||(nR=new zD(e)),nR}}var dSe=Object.defineProperty,hSe=Object.defineProperties,fSe=Object.getOwnPropertyDescriptors,bU=Object.getOwnPropertySymbols,pSe=Object.prototype.hasOwnProperty,mSe=Object.prototype.propertyIsEnumerable,vU=(t,e,n)=>e in t?dSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,gSe=(t,e)=>{for(var n in e||(e={}))pSe.call(e,n)&&vU(t,n,e[n]);if(bU)for(var n of bU(e))mSe.call(e,n)&&vU(t,n,e[n]);return t},ySe=(t,e)=>hSe(t,fSe(e));async function _Se(t,e){const n=Ff(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,o=await Promise.allSettled(i.map(P=>wSe(n.reference,P,e))),l=o.filter(P=>P.status==="fulfilled").map(P=>P.value).filter(P=>P);o.filter(P=>P.status==="rejected").forEach(P=>console.warn("Failed to fetch transaction receipt:",P.reason));const h=!l.length||l.some(P=>!P),s=l.every(P=>(P==null?void 0:P.status)==="0x1"),w=l.every(P=>(P==null?void 0:P.status)==="0x0"),x=l.some(P=>(P==null?void 0:P.status)==="0x0");let A;return h?A=100:s?A=200:w?A=500:x&&(A=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:l,status:A}}async function wSe(t,e,n){return await n(parseInt(t)).request(ud("eth_getTransactionReceipt",[e]))}async function bSe({sendCalls:t,storage:e}){const n=await e.getItem(H1);await e.setItem(H1,ySe(gSe({},n),{[t.result.id]:{request:t.request,result:t.result,expiry:mo(HAe)}}))}async function vSe({resultId:t,storage:e}){const n=await e.getItem(H1);if(n){delete n[t],await e.setItem(H1,n);for(const i in n)hh(n[i].expiry)&&delete n[i];await e.setItem(H1,n)}}async function xSe({resultId:t,storage:e}){const n=await e.getItem(H1),i=n==null?void 0:n[t];if(i&&!hh(i.expiry))return i;await vSe({resultId:t,storage:e})}var ESe=Object.defineProperty,CSe=Object.defineProperties,TSe=Object.getOwnPropertyDescriptors,xU=Object.getOwnPropertySymbols,ASe=Object.prototype.hasOwnProperty,SSe=Object.prototype.propertyIsEnumerable,mO=(t,e,n)=>e in t?ESe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,iR=(t,e)=>{for(var n in e||(e={}))ASe.call(e,n)&&mO(t,n,e[n]);if(xU)for(var n of xU(e))SSe.call(e,n)&&mO(t,n,e[n]);return t},rR=(t,e)=>CSe(t,TSe(e)),h0=(t,e,n)=>mO(t,typeof e!="symbol"?e+"":e,n);class ISe{constructor(e){h0(this,"name","eip155"),h0(this,"client"),h0(this,"chainId"),h0(this,"namespace"),h0(this,"httpProviders"),h0(this,"events"),h0(this,"storage"),this.namespace=e.namespace,this.events=G1("events"),this.client=G1("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=zD.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,n){this.httpProviders[e]||this.setHttpProvider(parseInt(e),n);const i=this.chainId;this.chainId=parseInt(e),this.events.emit($D.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,n){const i=n||$K(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ND(new PK(i,G1("disableProviderPing")))}setHttpProvider(e,n){const i=this.createHttpProvider(e,n);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(n=>{var i;const o=parseInt(JAe(n));e[o]=this.createHttpProvider(o,(i=this.namespace.rpcMap)==null?void 0:i[n])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}getHttpProvider(e){const n=e||this.chainId;return this.httpProviders[n]||(this.httpProviders=rR(iR({},this.httpProviders),{[n]:this.createHttpProvider(n)}),this.httpProviders[n])}async handleSwitchChain(e){var n,i;let o=e.request.params?(n=e.request.params[0])==null?void 0:n.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const l=parseInt(o,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:o}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var n,i,o,l,h;const s=(i=(n=e.request)==null?void 0:n.params)==null?void 0:i[0],w=((l=(o=e.request)==null?void 0:o.params)==null?void 0:l[1])||[];if(!s)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const x=this.client.session.get(e.topic),A=((h=x==null?void 0:x.sessionProperties)==null?void 0:h.capabilities)||{},P=w.length>0?w.join(","):`0x${this.chainId.toString(16)}`,D=`${s}${P}`,M=A==null?void 0:A[D];if(M)return M;let z;try{z=aSe(x,s,w)}catch(G){console.warn("Failed to extract capabilities from session",G)}if(z)return z;const U=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:rR(iR({},x.sessionProperties||{}),{capabilities:rR(iR({},A||{}),{[D]:U})})})}catch(G){console.warn("Failed to update session with capabilities",G)}return U}async getCallStatus(e){var n,i,o;const l=this.client.session.get(e.topic),h=(n=l.sessionProperties)==null?void 0:n.bundler_name;if(h){const x=this.getBundlerUrl(e.chainId,h);try{return await this.getUserOperationReceipt(x,e)}catch(A){console.warn("Failed to fetch call status from bundler",A,x)}}const s=(i=l.sessionProperties)==null?void 0:i.bundler_url;if(s)try{return await this.getUserOperationReceipt(s,e)}catch(x){console.warn("Failed to fetch call status from custom bundler",x,s)}const w=await xSe({resultId:(o=e.request.params)==null?void 0:o[0],storage:this.storage});if(w)try{return await _Se(w,this.getHttpProvider.bind(this))}catch(x){console.warn("Failed to fetch call status from stored send calls",x,w)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,n){var i;const o=new URL(e),l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ud("eth_getUserOperationReceipt",[(i=n.request.params)==null?void 0:i[0]]))});if(!l.ok)throw new Error(`Failed to fetch user operation receipt - ${l.status}`);return await l.json()}getBundlerUrl(e,n){return`${WAe}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${n}`}async sendCalls(e){var n,i,o;const l=await this.client.request(e),h=(n=e.request.params)==null?void 0:n[0],s=l==null?void 0:l.id,w=(l==null?void 0:l.capabilities)||{},x=(i=w==null?void 0:w.caip345)==null?void 0:i.caip2,A=(o=w==null?void 0:w.caip345)==null?void 0:o.transactionHashes;return!s||!x||!(A!=null&&A.length)||await bSe({sendCalls:{request:h,result:l},storage:this.storage}),l}}var PSe=Object.defineProperty,RSe=(t,e,n)=>e in t?PSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,b1=(t,e,n)=>RSe(t,typeof e!="symbol"?e+"":e,n);class OSe{constructor(e){b1(this,"name",FK),b1(this,"client"),b1(this,"httpProviders"),b1(this,"events"),b1(this,"namespace"),b1(this,"chainId"),this.namespace=e.namespace,this.events=G1("events"),this.client=G1("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,n){this.httpProviders[e]||this.setHttpProvider(e,n);const i=this.chainId;this.chainId=e,this.events.emit($D.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Ff(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){var e,n;const i={};return(n=(e=this.namespace)==null?void 0:e.accounts)==null||n.forEach(o=>{var l,h;const s=Ff(o),w=(h=(l=this.namespace)==null?void 0:l.rpcMap)==null?void 0:h[`${s.namespace}:${s.reference}`];i[s.reference]=this.createHttpProvider(o,w)}),i}getHttpProvider(e){const n=Ff(e).reference,i=this.httpProviders[n];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,n){const i=this.createHttpProvider(e,n);i&&(this.httpProviders[e]=i)}createHttpProvider(e,n){const i=n||$K(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new ND(new PK(i,G1("disableProviderPing")))}}var kSe=Object.defineProperty,DSe=Object.defineProperties,NSe=Object.getOwnPropertyDescriptors,EU=Object.getOwnPropertySymbols,MSe=Object.prototype.hasOwnProperty,LSe=Object.prototype.propertyIsEnumerable,gO=(t,e,n)=>e in t?kSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Tx=(t,e)=>{for(var n in e||(e={}))MSe.call(e,n)&&gO(t,n,e[n]);if(EU)for(var n of EU(e))LSe.call(e,n)&&gO(t,n,e[n]);return t},yT=(t,e)=>DSe(t,NSe(e)),Ol=(t,e,n)=>gO(t,typeof e!="symbol"?e+"":e,n);let BSe=class jK{constructor(e){Ol(this,"client"),Ol(this,"namespaces"),Ol(this,"optionalNamespaces"),Ol(this,"sessionProperties"),Ol(this,"scopedProperties"),Ol(this,"events",new iD),Ol(this,"rpcProviders",{}),Ol(this,"session"),Ol(this,"providerOpts"),Ol(this,"logger"),Ol(this,"uri"),Ol(this,"disableProviderPing",!1),Ol(this,"connectParams");var n,i;this.providerOpts=e,this.logger=OD({logger:(n=e.logger)!=null?n:cU,name:(i=this.providerOpts.name)!=null?i:LK}),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const n=new jK(e);return await n.initialize(),n}async request(e,n,i){const[o,l]=this.validateChain(n);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(o).request({request:Tx({},e),chainId:`${o}:${l}`,topic:this.session.topic,expiry:i})}sendAsync(e,n,i,o){const l=new Date().getTime();this.request(e,i,o).then(h=>n(null,V2(l,h))).catch(h=>n(h,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:As("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,n){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:o}=await this.client.authenticate(e,n);i&&(this.uri=i,this.events.emit("display_uri",i));const l=await o();if(this.session=l.session,this.session){const h=pU(this.session.namespaces);this.namespaces=gT(this.namespaces,h),await this.persist("namespaces",this.namespaces),this.onConnect()}return l}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}removeListener(e,n){this.events.removeListener(e,n)}off(e,n){this.events.off(e,n)}get isWalletConnect(){return!0}async pair(e){var n,i;const{uri:o,approval:l}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(n=this.connectParams)==null?void 0:n.authentication,walletPay:(i=this.connectParams)==null?void 0:i.walletPay});o&&(this.uri=o,this.events.emit("display_uri",o));const h=await l();this.session=h;const s=pU(h.namespaces);return this.namespaces=gT(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,n){try{if(!this.session)return;const[i,o]=this.validateChain(e);this.getProvider(i).setDefaultChain(o,n)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const n=this.client.pairing.getAll();if(!zf(n))return;for(const i of n)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${n.length}`)}catch(n){this.logger.warn(n,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,n;if(this.client=this.providerOpts.client||await oAe.init({core:this.providerOpts.core,logger:this.providerOpts.logger||cU,relayUrl:this.providerOpts.relayUrl||jAe,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error(i,"Failed to get session"),new Error(`The provided session: ${(n=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:n.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(n=>I1(n)))];eR("client",this.client),eR("events",this.events),eR("disableProviderPing",this.disableProviderPing),e.forEach(n=>{if(!this.session)return;const i=QAe(n,this.session);if((i==null?void 0:i.length)===0)return;const o=zK(i),l=gT(this.namespaces,this.optionalNamespaces),h=yT(Tx({},l[n]),{accounts:i,chains:o});switch(n){case"eip155":this.rpcProviders[n]=new ISe({namespace:h});break;default:this.rpcProviders[n]=new OSe({namespace:h})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var n;const{topic:i}=e;i===((n=this.session)==null?void 0:n.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var n;const{params:i,topic:o}=e;if(o!==((n=this.session)==null?void 0:n.topic))return;const{event:l}=i;if(l.name==="accountsChanged"){const h=l.data;h&&zf(h)&&this.events.emit("accountsChanged",h.map(fU))}else if(l.name==="chainChanged"){const h=i.chainId,s=i.event.data,w=I1(h),x=QP(h)!==QP(s)?`${w}:${QP(s)}`:h;this.onChainChanged({currentCaipChainId:x})}else this.events.emit(l.name,l.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:n})=>{var i,o;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:l}=n,h=(o=this.client)==null?void 0:o.session.get(e);this.session=yT(Tx({},h),{namespaces:l}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:n})}),this.client.on("session_delete",async e=>{var n;e.topic===((n=this.session)==null?void 0:n.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",yT(Tx({},As("USER_DISCONNECTED")),{data:e.topic})))}),this.on($D.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(yT(Tx({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[FK]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var n;this.getProvider(e).updateNamespace((n=this.session)==null?void 0:n.namespaces[e])})}setNamespaces(e){const{namespaces:n={},optionalNamespaces:i={},sessionProperties:o,scopedProperties:l}=e;this.optionalNamespaces=gT(n,i),this.sessionProperties=o,this.scopedProperties=l}validateChain(e){const[n,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[n,i];if(n&&!Object.keys(this.namespaces||{}).map(h=>I1(h)).includes(n))throw new Error(`Namespace '${n}' is not configured. Please call connect() first with namespace config.`);if(n&&i)return[n,i];const o=I1(Object.keys(this.namespaces)[0]),l=this.rpcProviders[o].getDefaultChain();return[o,l]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:n,internal:i=!1}){if(!this.namespaces)return;const[o,l]=this.validateChain(e);l&&(this.updateNamespaceChain(o,l),i?(this.events.emit("chainChanged",l),this.emitAccountsChangedOnChainChange({namespace:o,currentCaipChainId:e,previousCaipChainId:n})):this.getProvider(o).setDefaultChain(l),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:n,previousCaipChainId:i}){var o,l;try{if(i===n)return;const h=(l=(o=this.session)==null?void 0:o.namespaces[e])==null?void 0:l.accounts;if(!h)return;const s=h.filter(w=>w.includes(`${n}:`)).map(fU);if(!zf(s))return;this.events.emit("accountsChanged",s)}catch(h){this.logger.warn(h,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,n){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${n}`,o={chains:[],methods:[],events:[],defaultChain:n};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=n):this.namespaces[i]=o}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,n){var i;const o=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${pT}/${e}${o}`,n)}async getFromStore(e){var n;const i=((n=this.session)==null?void 0:n.topic)||"";return await this.client.core.storage.getItem(`${pT}/${e}${i}`)}async deleteFromStore(e){var n;const i=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.removeItem(`${pT}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const n=await this.client.core.storage.getKeys();for(const i of n)i.startsWith(pT)&&await this.client.core.storage.removeItem(i)}catch(n){this.logger.warn(n,"Failed to cleanup storage")}}};const CU=2147483648,FSe={convertEVMChainIdToCoinType(t){if(t>=CU)throw new Error("Invalid chainId");return(CU|t)>>>0}},mu=Zr({suggestions:[],loading:!1}),$Se={state:mu,subscribe(t){return so(mu,()=>t(mu))},subscribeKey(t,e){return oo(mu,t,e)},async resolveName(t){var e,n;try{return await Ci.lookupEnsName(t)}catch(i){const o=i;throw new Error(((n=(e=o==null?void 0:o.reasons)==null?void 0:e[0])==null?void 0:n.description)||"Error resolving name")}},async isNameRegistered(t){try{return await Ci.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{mu.loading=!0,mu.suggestions=[];const e=await Ci.getEnsNameSuggestions(t);return mu.suggestions=e.suggestions||[],mu.suggestions}catch(e){const n=Gx.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(n)}finally{mu.loading=!1}},async getNamesForAddress(t){try{if(!ue.state.activeCaipNetwork)return[];const n=Jt.getEnsFromCacheForAddress(t);if(n)return n;const i=await Ci.reverseLookupEnsName({address:t});return Jt.updateEnsCache({address:t,ens:i,timestamp:Date.now()}),i}catch(e){const n=Gx.parseEnsApiError(e,"Error fetching names for address");throw new Error(n)}},async registerName(t){var o;const e=ue.state.activeCaipNetwork,n=(o=ue.getAccountData(e==null?void 0:e.chainNamespace))==null?void 0:o.address,i=Nt.getAuthConnector();if(!e)throw new Error("Network not found");if(!n||!i)throw new Error("Address or auth connector not found");mu.loading=!0;try{const l=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});Pt.pushTransactionStack({onCancel(){Pt.replace("RegisterAccountName")}});const h=await Ht.signMessage(l);mu.loading=!1;const s=e.id;if(!s)throw new Error("Network not found");const w=FSe.convertEVMChainIdToCoinType(Number(s));await Ci.registerEnsName({coinType:w,address:n,signature:h,message:l}),ue.setAccountProp("profileName",t,e.chainNamespace),Jt.updateEnsCache({address:n,ens:[{name:t,registered_at:new Date().toISOString(),updated_at:void 0,addresses:{},attributes:[]}],timestamp:Date.now()}),Pt.replace("RegisterAccountNameSuccess")}catch(l){const h=Gx.parseEnsApiError(l,`Error registering name ${t}`);throw Pt.replace("RegisterAccountName"),new Error(h)}finally{mu.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){var i,o;const n=t;return((o=(i=n==null?void 0:n.reasons)==null?void 0:i[0])==null?void 0:o.description)||e}},Gx=Hl($Se);function yO(t){try{return new URL(t)}catch{return null}}function zSe(t){const e=t.split("/"),n=e.length>0&&e[0]!==void 0?e[0]:"",i=n.lastIndexOf(":");return i===-1?{host:n}:{host:n.slice(0,i),port:n.slice(i+1)}}function USe(t){const e=t.indexOf("://");if(e===-1)return null;const n=t.slice(0,e),i=e+3;let o=t.indexOf("/",i);o===-1&&(o=t.length);const l=t.slice(i,o),h=l.lastIndexOf(":");return h===-1?{scheme:n,host:l}:{scheme:n,host:l.slice(0,h),port:l.slice(h+1)}}function jSe(t,e){if(e.includes("://")){const h=yO(e);return h?h.origin===t:!1}const{host:n,port:i}=zSe(e),o=t.indexOf("://");if(o!==-1){const h=o+3;let s=t.indexOf("/",h);s===-1&&(s=t.length);const w=t.slice(h,s);if(i!==void 0)return`${n}:${i}`===w;const x=w.split(":")[0];return n===x}const l=yO(t);return l?i!==void 0?n===l.hostname&&i===(l.port||void 0):n===l.hostname:!1}function VSe(t,e,n){let i=n,o;const l=i.indexOf("://");l!==-1&&(o=i.slice(0,l),i=i.slice(l+3));const h=i.indexOf("/");h!==-1&&(i=i.slice(0,h));let s=i,w;const x=s.lastIndexOf(":");x!==-1&&(w=s.slice(x+1),s=s.slice(0,x));const A=s.split(".");for(const U of A)if(U.includes("*")&&U!=="*")return!1;const P=t.protocol.replace(/:$/u,"");if(o&&o!==P||w!==void 0&&w!=="*"&&w!==t.port)return!1;const D=USe(e),z=(D?D.host:t.hostname).split(".");if(A.length!==z.length)return!1;for(let U=A.length-1;U>=0;U-=1){const G=A[U],ne=z[U];if(G!=="*"&&G!==ne)return!1}return!0}const WSe={ton:["ton_sendMessage","ton_signData"],solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Uf={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace(t){return WSe[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const n={...t},i=new Set;if(e.methods&&Object.keys(e.methods).forEach(o=>i.add(o)),e.chains&&Object.keys(e.chains).forEach(o=>i.add(o)),e.events&&Object.keys(e.events).forEach(o=>i.add(o)),e.rpcMap&&Object.keys(e.rpcMap).forEach(o=>{const[l]=o.split(":");l&&i.add(l)}),i.forEach(o=>{n[o]||(n[o]=this.createDefaultNamespace(o))}),e.methods&&Object.entries(e.methods).forEach(([o,l])=>{n[o]&&(n[o].methods=l)}),e.chains&&Object.entries(e.chains).forEach(([o,l])=>{n[o]&&(n[o].chains=l)}),e.events&&Object.entries(e.events).forEach(([o,l])=>{n[o]&&(n[o].events=l)}),e.rpcMap){const o=new Set;Object.entries(e.rpcMap).forEach(([l,h])=>{const[s,w]=l.split(":");!s||!w||!n[s]||(n[s].rpcMap||(n[s].rpcMap={}),o.has(s)||(n[s].rpcMap={},o.add(s)),n[s].rpcMap[w]=h)})}return n},createNamespaces(t,e){const n=t.reduce((i,o)=>{const{id:l,chainNamespace:h,rpcUrls:s}=o,w=s.default.http[0];i[h]||(i[h]=this.createDefaultNamespace(h));const x=`${h}:${l}`,A=i[h];switch(A.chains.push(x),x){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":A.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":A.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K");break}return A!=null&&A.rpcMap&&w&&(A.rpcMap[l]=w),i},{});return this.applyNamespaceOverrides(n,e)},resolveReownName:async t=>{var i;const e=await Gx.resolveName(t);return((i=(e!=null&&e.addresses?Object.values(e.addresses):[])[0])==null?void 0:i.address)||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const n=e.chains||[],i=e.accounts.map(o=>{const[l,h]=o.split(":");return`${l}:${h}`});return Array.from(new Set([...n,...i]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isUserRejectedRequestError(t){try{if(typeof t=="object"&&t!==null){const e=t,n=typeof e.code=="number",i=n&&e.code===Uf.RPC_ERROR_CODE.USER_REJECTED_METHODS,o=n&&e.code===Uf.RPC_ERROR_CODE.USER_REJECTED;return i||o}return!1}catch{return!1}},isOriginAllowed(t,e,n){const i=[...e,...n];if(e.length===0)return!0;const o=yO(t);if(!o)return i.some(l=>!l.includes("*")&&l===t);if(o.hostname==="localhost"||o.hostname==="127.0.0.1")return!0;for(const l of i)if(l.includes("*")){if(VSe(o,t,l))return!0}else if(jSe(t,l))return!0;return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:n,onDisconnect:i,onAccountsChanged:o,onChainChanged:l,onDisplayUri:h}){n&&t.on("connect",()=>{const s=Uf.getWalletConnectAccounts(t,e);n(s)}),i&&t.on("disconnect",()=>{i()}),o&&t.on("accountsChanged",s=>{var w,x,A,P,D;try{const M=((A=(x=(w=t.session)==null?void 0:w.namespaces)==null?void 0:x[e])==null?void 0:A.accounts)||[],z=(D=(P=t.rpcProviders)==null?void 0:P[e])==null?void 0:D.getDefaultChain(),U=s.map(G=>{const ne=M.find(de=>de.includes(`${e}:${z}:${G}`));if(!ne)return;const{chainId:oe,chainNamespace:Q}=No.parseCaipAddress(ne);return{address:G,chainId:oe,chainNamespace:Q}}).filter(G=>G!==void 0);U.length>0&&o(U)}catch(M){console.warn("Failed to parse accounts for namespace on accountsChanged event",e,s,M)}}),l&&t.on("chainChanged",s=>{l(s)}),h&&t.on("display_uri",s=>{h(s)})},getWalletConnectAccounts(t,e){var o,l,h,s;const n=new Set,i=(s=(h=(l=(o=t==null?void 0:t.session)==null?void 0:o.namespaces)==null?void 0:l[e])==null?void 0:h.accounts)==null?void 0:s.map(w=>No.parseCaipAddress(w)).filter(({address:w})=>n.has(w.toLowerCase())?!1:(n.add(w.toLowerCase()),!0));return i&&i.length>0?i:[]}},HSe=[at.CONNECTOR_ID.AUTH,at.CONNECTOR_ID.WALLET_CONNECT];class VK{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=n=>ue.getCaipNetworks(n),this.getConnectorId=n=>Nt.getConnectorId(n),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:n}){const i=this.getCaipNetworks().filter(o=>o.chainNamespace===this.namespace).find(o=>o.id.toString()===(n==null?void 0:n.toString()));e&&i&&this.addConnection({connectorId:at.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:i})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:at.CONNECTOR_ID.AUTH,type:"AUTH",name:at.CONNECTOR_NAMES.AUTH,provider:e,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...e){const n=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(i=>n.has(i.id)?!1:(n.add(i.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){const n=new Set;this.availableConnections=[...e,...this.availableConnections].filter(i=>n.has(i.connectorId.toLowerCase())?!1:(n.add(i.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(n=>n.connectorId.toLowerCase()!==e.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,n){ue.setAccountProp("status",e,n)}on(e,n){var i;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(i=this.eventListeners.get(e))==null||i.add(n)}off(e,n){const i=this.eventListeners.get(e);i&&i.delete(n)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,n){const i=this.eventListeners.get(e);i&&i.forEach(o=>o(n))}async connectWalletConnect(e){try{return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}catch(n){throw Uf.isUserRejectedRequestError(n)?new T1(n):n}}async switchNetwork(e){var l;const{caipNetwork:n}=e,i=Qr.getProviderId(n.chainNamespace),o=Qr.getProvider(n.chainNamespace);if(!o)throw new Error("Provider not found");if(i==="WALLET_CONNECT"){o.setDefaultChain(n.caipNetworkId);return}if(i==="AUTH"){const h=(l=Nt.getAuthConnector())==null?void 0:l.provider;if(!h)throw new Error("Auth provider not found");const s=Fs(n.chainNamespace);await h.switchNetwork({chainId:n.caipNetworkId});const w=await h.getUser({chainId:n.caipNetworkId,preferredAccountType:s});this.emit("switchNetwork",w)}}getWalletConnectConnector(){const e=this.connectors.find(n=>n.id==="walletConnect");if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,n){if(e.length>0){const{address:i,chainId:o}=Ft.getAccount(e[0]),l=this.getCaipNetworks().filter(s=>s.chainNamespace===this.namespace).find(s=>s.id.toString()===(o==null?void 0:o.toString())),h=this.connectors.find(s=>s.id===n);i&&(this.emit("accountChanged",{address:i,chainId:o,connector:h}),this.addConnection({connectorId:n,accounts:e.map(s=>{const{address:w}=Ft.getAccount(s);return{address:w}}),caipNetwork:l}))}}onAccountsChanged(e,n,i=!0){var o,l;if(e.length>0){const{address:h}=Ft.getAccount(e[0]),s=this.getConnection({connectorId:n,connections:this.connections,connectors:this.connectors});h&&((o=this.getConnectorId(at.CHAIN.EVM))==null?void 0:o.toLowerCase())===n.toLowerCase()&&this.emit("accountChanged",{address:h,chainId:(l=s==null?void 0:s.caipNetwork)==null?void 0:l.id,connector:s==null?void 0:s.connector}),this.addConnection({connectorId:n,accounts:e.map(w=>{const{address:x}=Ft.getAccount(w);return{address:x}}),caipNetwork:s==null?void 0:s.caipNetwork})}else i&&this.onDisconnect(n)}onDisconnect(e){var n;this.removeProviderListeners(e),this.deleteConnection(e),((n=this.getConnectorId(at.CHAIN.EVM))==null?void 0:n.toLowerCase())===e.toLowerCase()&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,n){var h;const i=typeof e=="string"&&e.startsWith("0x")?parseInt(e,16).toString():e.toString(),o=this.getConnection({connectorId:n,connections:this.connections,connectors:this.connectors}),l=this.getCaipNetworks().filter(s=>s.chainNamespace===this.namespace).find(s=>s.id.toString()===i);o&&this.addConnection({connectorId:n,accounts:o.accounts,caipNetwork:l}),((h=this.getConnectorId(at.CHAIN.EVM))==null?void 0:h.toLowerCase())===n.toLowerCase()&&this.emit("switchNetwork",{chainId:i})}listenProviderEvents(e,n){if(HSe.includes(e))return;const i=h=>this.onAccountsChanged(h,e),o=h=>this.onChainChanged(h,e),l=()=>this.onDisconnect(e);this.providerHandlers[e]||(n.on("disconnect",l),n.on("accountsChanged",i),n.on("chainChanged",o),this.providerHandlers[e]={provider:n,disconnect:l,accountsChanged:i,chainChanged:o})}removeProviderListeners(e){if(this.providerHandlers[e]){const{provider:n,disconnect:i,accountsChanged:o,chainChanged:l}=this.providerHandlers[e];n.removeListener("disconnect",i),n.removeListener("accountsChanged",o),n.removeListener("chainChanged",l),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){var n;const e=this.getConnection({connections:this.connections,connectors:this.connectors});if(e){const[i]=e.accounts;this.emit("accountChanged",{address:i==null?void 0:i.address,chainId:(n=e.caipNetwork)==null?void 0:n.id,connector:e.connector})}}getConnection({address:e,connectorId:n,connections:i,connectors:o}){if(n){const h=i.find(x=>x.connectorId.toLowerCase()===n.toLowerCase());if(!h)return null;const s=o.find(x=>x.id.toLowerCase()===h.connectorId.toLowerCase()),w=e?h.accounts.find(x=>x.address.toLowerCase()===e.toLowerCase()):h.accounts[0];return{...h,account:w,connector:s}}const l=i.find(h=>h.accounts.length>0&&o.some(s=>s.id.toLowerCase()===h.connectorId.toLowerCase()));if(l){const[h]=l.accounts,s=o.find(w=>w.id.toLowerCase()===l.connectorId.toLowerCase());return{...l,account:h,connector:s}}return null}}let f0=null;const Xa={getSIWX(){return ut.state.siwx},async initializeIfEnabled(t=ue.getActiveCaipAddress()){var l,h,s;const e=ut.state.siwx;if(!(e&&t))return;const[n,i,o]=t.split(":");if(ue.checkIfSupportedNetwork(n,`${n}:${i}`))try{if((l=ut.state.remoteFeatures)!=null&&l.emailCapture){const x=(h=ue.getAccountData(n))==null?void 0:h.user;await gi.open({view:"DataCapture",data:{email:(x==null?void 0:x.email)??void 0}});return}if(f0&&await f0,(await e.getSessions(`${n}:${i}`,o)).length)return;await gi.open({view:"SIWXSignMessage"})}catch(w){console.error("SIWXUtil:initializeIfEnabled",w),Sn.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(w)}),await((s=Ht._getClient())==null?void 0:s.disconnect().catch(console.error)),Pt.reset("Connect"),Ji.showError("A problem occurred while trying initialize authentication")}},async isAuthenticated(t=ue.getActiveCaipAddress()){if(!ut.state.siwx||!t)return!0;const{chainNamespace:n,chainId:i,address:o}=No.parseCaipAddress(t),l=`${n}:${i}`;return(await Xa.getSessions({address:o,caipNetworkId:l})).length>0},async requestSignMessage(){const t=ut.state.siwx,e=Ft.getPlainAddress(ue.getActiveCaipAddress()),n=Nf();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!n)throw new Error("No ActiveCaipNetwork or client found");try{const i=await t.createMessage({chainId:n.caipNetworkId,accountAddress:e}),o=i.toString();let l="";t.signMessage?l=await t.signMessage({message:o,chainId:n.caipNetworkId,accountAddress:e}):(Nt.getConnectorId(n.chainNamespace)===at.CONNECTOR_ID.AUTH&&Pt.pushTransactionStack({}),l=await Ht.signMessage(o)||""),await t.addSession({data:i,message:o,signature:l}),ue.setLastConnectedSIWECaipNetwork(n),gi.close(),Sn.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(i){(!gi.state.open||Pt.state.view==="ApproveTransaction")&&await gi.open({view:"SIWXSignMessage"}),Ji.showError("Error signing message"),Sn.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(i)}),console.error("SWIXUtil:requestSignMessage",i)}},async cancelSignMessage(){var t;try{const e=this.getSIWX();if((t=e==null?void 0:e.getRequired)==null?void 0:t.call(e)){const i=ue.getLastConnectedSIWECaipNetwork();if(i){const o=await(e==null?void 0:e.getSessions(i==null?void 0:i.caipNetworkId,Ft.getPlainAddress(ue.getActiveCaipAddress())||""));o&&o.length>0?await ue.switchActiveNetwork(i):await Ht.disconnect()}else await Ht.disconnect()}else gi.close();gi.close(),Sn.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getAllSessions(){const t=this.getSIWX(),e=ue.getAllRequestedCaipNetworks(),n=[];return await Promise.all(e.map(async i=>{const o=await(t==null?void 0:t.getSessions(i.caipNetworkId,Ft.getPlainAddress(ue.getActiveCaipAddress())||""));o&&n.push(...o)})),n},async getSessions(t){const e=ut.state.siwx;let n=t==null?void 0:t.address;if(!n){const o=ue.getActiveCaipAddress();n=Ft.getPlainAddress(o)}let i=t==null?void 0:t.caipNetworkId;if(!i){const o=ue.getActiveCaipNetwork();i=o==null?void 0:o.caipNetworkId}return e&&n&&i?e.getSessions(i,n):[]},async isSIWXCloseDisabled(){var e;const t=this.getSIWX();if(t){const n=Pt.state.view==="ApproveTransaction",i=Pt.state.view==="SIWXSignMessage";if(n||i)return((e=t.getRequired)==null?void 0:e.call(t))&&(await this.getSessions()).length===0}return!1},async authConnectorAuthenticate({authConnector:t,chainId:e,socialUri:n,preferredAccountType:i,chainNamespace:o}){var P;const l=Xa.getSIWX(),h=Nf();if(!l||!o.includes(at.CHAIN.EVM)||(P=ut.state.remoteFeatures)!=null&&P.emailCapture){const D=await t.connect({chainId:e,socialUri:n,preferredAccountType:i});return{address:D.address,chainId:D.chainId,accounts:D.accounts}}const s=`${o}:${e}`,w=await l.createMessage({chainId:s,accountAddress:"<<AccountAddress>>"}),x={accountAddress:w.accountAddress,chainId:w.chainId,domain:w.domain,uri:w.uri,version:w.version,nonce:w.nonce,notBefore:w.notBefore,statement:w.statement,resources:w.resources,requestId:w.requestId,issuedAt:w.issuedAt,expirationTime:w.expirationTime,serializedMessage:w.toString()},A=await t.connect({chainId:e,socialUri:n,siwxMessage:x,preferredAccountType:i});return x.accountAddress=A.address,x.serializedMessage=A.message||"",A.signature&&A.message&&await Xa.addEmbeddedWalletSession(x,A.message,A.signature),ue.setLastConnectedSIWECaipNetwork(h),{address:A.address,chainId:A.chainId,accounts:A.accounts}},async addEmbeddedWalletSession(t,e,n){if(f0)return f0;const i=Xa.getSIWX();return i?(f0=i.addSession({data:t,message:e,signature:n}).finally(()=>{f0=null}),f0):Promise.resolve()},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:n}){var x,A,P;const i=Xa.getSIWX(),o=Nf(),l=new Set(e.map(D=>D.split(":")[0]));if(!i||l.size!==1||!l.has("eip155"))return!1;const h=await i.createMessage({chainId:((x=Nf())==null?void 0:x.caipNetworkId)||"",accountAddress:""}),s=await t.authenticate({nonce:h.nonce,domain:h.domain,uri:h.uri,exp:h.expirationTime,iat:h.issuedAt,nbf:h.notBefore,requestId:h.requestId,version:h.version,resources:h.resources,statement:h.statement,chainId:h.chainId,methods:n,chains:[h.chainId,...e.filter(D=>D!==h.chainId)]});Ji.showLoading("Authenticating...",{autoClose:!1});const w={...s.session.peer.metadata,name:s.session.peer.metadata.name,icon:(A=s.session.peer.metadata.icons)==null?void 0:A[0],type:"WALLET_CONNECT"};if(ue.setAccountProp("connectedWalletInfo",w,Array.from(l)[0]),(P=s==null?void 0:s.auths)!=null&&P.length){const D=s.auths.map(M=>{const z=t.client.formatAuthMessage({request:M.p,iss:M.p.iss});return{data:{...M.p,accountAddress:M.p.iss.split(":").slice(-1).join(""),chainId:M.p.iss.split(":").slice(2,4).join(":"),uri:M.p.aud??"",version:M.p.version||h.version,expirationTime:M.p.exp,issuedAt:M.p.iat,notBefore:M.p.nbf},message:z,signature:M.s.s,cacao:M}});try{await i.setSessions(D),o&&ue.setLastConnectedSIWECaipNetwork(o),Sn.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:Xa.getSIWXEventProperties()})}catch(M){throw console.error("SIWX:universalProviderAuth - failed to set sessions",M),Sn.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:Xa.getSIWXEventProperties(M)}),await t.disconnect().catch(console.error),M}finally{Ji.hide()}}return!0},getSIWXEventProperties(t){var n;const e=ue.state.activeChain;if(!e)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:((n=ue.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||"",isSmartAccount:Fs(e)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT,message:t?Ft.parseError(t):void 0}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}};class WK{constructor({provider:e,namespace:n}){this.id=at.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=ue.getCaipNetworks.bind(ue),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=n}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const n=this.getCaipNetworks(),i=ut.state.universalProviderConfigOverride,o=Uf.createNamespaces(n,i);await this.provider.connect({optionalNamespaces:o})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(n=>n.caipNetworkId);return Xa.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:GSe})}}const GSe=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],id=Zr({message:"",variant:"info",open:!1}),qSe={state:id,subscribeKey(t,e){return oo(id,t,e)},open(t,e){const{debug:n}=ut.state,{code:i,displayMessage:o,debugMessage:l}=t;o&&n&&(id.message=o,id.variant=e,id.open=!0)},warn(t,e,n){id.open=!0,id.message=t,id.variant="warning",e&&console.warn(e,n)},close(){id.open=!1,id.message="",id.variant="info"}},Ts=Hl(qSe),rd=Zr({message:"",open:!1,triggerRect:{width:0,height:0,top:0,left:0},variant:"shade"}),ZSe={state:rd,subscribe(t){return so(rd,()=>t(rd))},subscribeKey(t,e){return oo(rd,t,e)},showTooltip({message:t,triggerRect:e,variant:n}){rd.open=!0,rd.message=t,rd.triggerRect=e,rd.variant=n},hide(){rd.open=!1,rd.message="",rd.triggerRect={width:0,height:0,top:0,left:0}}},vu=Hl(ZSe),Ax=Zr({isLegalCheckboxChecked:!1}),F0={state:Ax,subscribe(t){return so(Ax,()=>t(Ax))},subscribeKey(t,e){return oo(Ax,t,e)},setIsLegalCheckboxChecked(t){Ax.isLegalCheckboxChecked=t}},KSe={eip155:{native:{assetNamespace:"slip44",assetReference:"60"},defaultTokenNamespace:"erc20"},solana:{native:{assetNamespace:"slip44",assetReference:"501"},defaultTokenNamespace:"token"}},TU={56:"714",204:"714"};class YSe extends Error{}function XSe(){const{sdkType:t,sdkVersion:e,projectId:n}=ut.getSnapshot(),i=new URL("https://rpc.walletconnect.org/v1/json-rpc");return i.searchParams.set("projectId",n),i.searchParams.set("st",t),i.searchParams.set("sv",e),i.searchParams.set("source","fund-wallet"),i.toString()}async function UD(t,e){const n=XSe(),{projectId:i}=ut.getSnapshot(),o={jsonrpc:"2.0",id:1,method:t,params:{...e||{},projectId:i}},h=await(await fetch(n,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})).json();if(h.error)throw new YSe(h.error.message);return h}async function JSe(t){return(await UD("reown_getExchanges",t)).result}async function QSe(t){return(await UD("reown_getExchangePayUrl",t)).result}async function eIe(t){return(await UD("reown_getExchangeBuyStatus",t)).result}function AU(t,e){const{chainNamespace:n,chainId:i}=No.parseCaipNetworkId(t),o=KSe[n];if(!o)throw new Error(`Unsupported chain namespace for CAIP-19 formatting: ${n}`);let l=o.native.assetNamespace,h=o.native.assetReference;return e!=="native"?(l=o.defaultTokenNamespace,h=e):n==="eip155"&&TU[i]&&(h=TU[i]),`${`${n}:${i}`}/${l}:${h}`}const tIe={network:"eip155:1",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},nIe={network:"eip155:8453",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},HK={network:"eip155:8453",asset:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},iIe={asset:"0x036CbD53842c5426634e7929541eC2318f3dCF7e"},rIe={network:"eip155:84532",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},sIe={network:"eip155:1",asset:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},oIe={network:"eip155:42161",asset:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},aIe={network:"eip155:137",asset:"0x2791bca1f2de4661ed88a30c99a7a9449aa84174",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},cIe={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},lIe={network:"eip155:1",asset:"0xdAC17F958D2ee523a2206206994597C13D831ec7",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},uIe={network:"eip155:10",asset:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},dIe={network:"eip155:42161",asset:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},hIe={network:"eip155:137",asset:"0xc2132d05d31c914a87c6611c10748aeb04b58e8f",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},fIe={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},pIe={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"native",metadata:{name:"Solana",symbol:"SOL",decimals:9}},mIe={ethereumETH:tIe,baseETH:nIe,baseUSDC:HK,baseSepoliaETH:rIe,ethereumUSDC:sIe,arbitrumUSDC:oIe,polygonUSDC:aIe,solanaUSDC:cIe,ethereumUSDT:lIe,optimismUSDT:uIe,arbitrumUSDT:dIe,polygonUSDT:hIe,solanaUSDT:fIe,solanaSOL:pIe};function gIe(t){return Object.values(mIe).filter(e=>e.network===t)}const yIe=0,GK={paymentAsset:null,amount:null,tokenAmount:0,priceLoading:!1,error:null,exchanges:[],isLoading:!1,currentPayment:void 0,isPaymentInProgress:!1,paymentId:"",assets:[]},mi=Zr(GK),ko={state:mi,subscribe(t){return so(mi,()=>t(mi))},subscribeKey(t,e){return oo(mi,t,e)},resetState(){Object.assign(mi,{...GK})},async getAssetsForNetwork(t){const e=gIe(t),n=await ko.getAssetsImageAndPrice(e),i=e.map(o=>{var s,w,x,A;const l=o.asset==="native"?TA():`${o.network}:${o.asset}`,h=n.find(P=>{var D,M,z;return((z=(M=(D=P.fungibles)==null?void 0:D[0])==null?void 0:M.address)==null?void 0:z.toLowerCase())===l.toLowerCase()});return{...o,price:((w=(s=h==null?void 0:h.fungibles)==null?void 0:s[0])==null?void 0:w.price)||1,metadata:{...o.metadata,iconUrl:(A=(x=h==null?void 0:h.fungibles)==null?void 0:x[0])==null?void 0:A.iconUrl}}});return mi.assets=i,i},async getAssetsImageAndPrice(t){const e=t.map(i=>i.asset==="native"?TA():`${i.network}:${i.asset}`);return await Promise.all(e.map(i=>Ci.fetchTokenPrice({addresses:[i]})))},getTokenAmount(){var n;if(!((n=mi==null?void 0:mi.paymentAsset)!=null&&n.price))throw new Error("Cannot get token price");const t=Q1.bigNumber(mi.amount??0).round(8),e=Q1.bigNumber(mi.paymentAsset.price).round(8);return t.div(e).round(8).toNumber()},setAmount(t){var e;mi.amount=t,(e=mi.paymentAsset)!=null&&e.price&&(mi.tokenAmount=ko.getTokenAmount())},setPaymentAsset(t){mi.paymentAsset=t},isPayWithExchangeEnabled(){var t;return(t=ut.state.remoteFeatures)==null?void 0:t.payWithExchange},isPayWithExchangeSupported(){return ko.isPayWithExchangeEnabled()&&ue.state.activeCaipNetwork&&hi.PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES.includes(ue.state.activeCaipNetwork.chainNamespace)},async fetchExchanges(){var t;try{const e=ko.isPayWithExchangeSupported();if(!mi.paymentAsset||!e){mi.exchanges=[],mi.isLoading=!1;return}mi.isLoading=!0;const n=await JSe({page:yIe,asset:AU(mi.paymentAsset.network,mi.paymentAsset.asset),amount:((t=mi.amount)==null?void 0:t.toString())??"0"});mi.exchanges=n.exchanges.slice(0,2)}catch{throw Ji.showError("Unable to get exchanges"),new Error("Unable to get exchanges")}finally{mi.isLoading=!1}},async getPayUrl(t,e){try{const n=Number(e.amount),i=await QSe({exchangeId:t,asset:AU(e.network,e.asset),amount:n.toString(),recipient:`${e.network}:${e.recipient}`});return Sn.sendEvent({type:"track",event:"PAY_EXCHANGE_SELECTED",properties:{exchange:{id:t},configuration:{network:e.network,asset:e.asset,recipient:e.recipient,amount:n},currentPayment:{type:"exchange",exchangeId:t},source:"fund-from-exchange",headless:!1}}),i}catch(n){throw n instanceof Error&&n.message.includes("is not supported")?new Error("Asset not supported"):new Error(n.message)}},async handlePayWithExchange(t){var e;try{const n=(e=ue.getAccountData())==null?void 0:e.address;if(!n)throw new Error("No account connected");if(!mi.paymentAsset)throw new Error("No payment asset selected");const i=Ft.returnOpenHref("","popupWindow","scrollbar=yes,width=480,height=720");if(!i)throw new Error("Could not create popup window");mi.isPaymentInProgress=!0,mi.paymentId=crypto.randomUUID(),mi.currentPayment={type:"exchange",exchangeId:t};const{network:o,asset:l}=mi.paymentAsset,h={network:o,asset:l,amount:mi.tokenAmount,recipient:n},s=await ko.getPayUrl(t,h);if(!s){try{i.close()}catch(w){console.error("Unable to close popup window",w)}throw new Error("Unable to initiate payment")}mi.currentPayment.sessionId=s.sessionId,mi.currentPayment.status="IN_PROGRESS",mi.currentPayment.exchangeId=t,i.location.href=s.url}catch{mi.error="Unable to initiate payment",Ji.showError(mi.error)}},async waitUntilComplete({exchangeId:t,sessionId:e,paymentId:n,retries:i=20}){const o=await ko.getBuyStatus(t,e,n);if(o.status==="SUCCESS"||o.status==="FAILED")return o;if(i===0)throw new Error("Unable to get deposit status");return await new Promise(l=>{setTimeout(l,5e3)}),ko.waitUntilComplete({exchangeId:t,sessionId:e,paymentId:n,retries:i-1})},async getBuyStatus(t,e,n){var i,o,l,h,s;try{if(!mi.currentPayment)throw new Error("No current payment");const w=await eIe({sessionId:e,exchangeId:t});if(mi.currentPayment.status=w.status,w.status==="SUCCESS"||w.status==="FAILED"){const x=(i=ue.getAccountData())==null?void 0:i.address;mi.currentPayment.result=w.txHash,mi.isPaymentInProgress=!1,Sn.sendEvent({type:"track",event:w.status==="SUCCESS"?"PAY_SUCCESS":"PAY_ERROR",properties:{message:w.status==="FAILED"?Ft.parseError(mi.error):void 0,source:"fund-from-exchange",paymentId:n,configuration:{network:((o=mi.paymentAsset)==null?void 0:o.network)||"",asset:((l=mi.paymentAsset)==null?void 0:l.asset)||"",recipient:x||"",amount:mi.amount??0},currentPayment:{type:"exchange",exchangeId:(h=mi.currentPayment)==null?void 0:h.exchangeId,sessionId:(s=mi.currentPayment)==null?void 0:s.sessionId,result:w.txHash}}})}return w}catch{return{status:"UNKNOWN",txHash:""}}},reset(){mi.currentPayment=void 0,mi.isPaymentInProgress=!1,mi.paymentId="",mi.paymentAsset=null,mi.amount=0,mi.tokenAmount=0,mi.priceLoading=!1,mi.error=null,mi.exchanges=[],mi.isLoading=!1}},_Ie={},wIe=(t,e)=>{const n=qt.useRef(void 0);qt.useEffect(()=>{n.current=Ore(t,e)}),qt.useDebugValue(n.current)},bIe=wIe,vIe=new WeakMap;function SU(t,e){const i=qt.useMemo(()=>t&&new WeakMap,[t]),o=qt.useRef(void 0);let l=!0;const h=qt.useSyncExternalStore(qt.useCallback(w=>{const x=so(t,w);return w(),x},[t,void 0]),()=>{const w=j0(t);try{if(!l&&o.current&&!qV(o.current,w,i,new WeakMap))return o.current}catch{}return w},()=>j0(t));l=!1,qt.useLayoutEffect(()=>{o.current=h}),(_Ie?"production":void 0)!=="production"&&bIe(h,i);const s=qt.useMemo(()=>new WeakMap,[]);return GV(h,i,s,vIe)}function xIe(){try{return Ft.returnOpenHref(`${at.SECURE_SITE_SDK_ORIGIN}/loading`,"popupWindow","width=600,height=800,scrollbars=yes")}catch{throw new Error("Could not open social popup")}}async function EIe(){Pt.push("ConnectingFarcaster");const t=Nt.getAuthConnector();if(t){const e=ue.getAccountData();if(!(e!=null&&e.farcasterUrl))try{const{url:n}=await t.provider.getFarcasterUri();ue.setAccountProp("farcasterUrl",n,ue.state.activeChain)}catch(n){Pt.goBack(),Ji.showError(n)}}}async function CIe(t){Pt.push("ConnectingSocial");const e=Nt.getAuthConnector();let n=null;try{const i=setTimeout(()=>{throw new Error("Social login timed out. Please try again.")},45e3);if(e&&t){if(Ft.isTelegram()||(n=xIe()),n)ue.setAccountProp("socialWindow",J1(n),ue.state.activeChain);else if(!Ft.isTelegram())throw new Error("Could not create social popup");const{uri:o}=await e.provider.getSocialRedirectUri({provider:t});if(!o)throw n==null||n.close(),new Error("Could not fetch the social redirect uri");if(n&&(n.location.href=o),Ft.isTelegram()){Jt.setTelegramSocialProvider(t);const l=Ft.formatTelegramSocialLoginUrl(o);Ft.openHref(l,"_top")}clearTimeout(i)}}catch(i){n==null||n.close();const o=Ft.parseError(i);Ji.showError(o),Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:o}})}}async function TIe(t){ue.setAccountProp("socialProvider",t,ue.state.activeChain),Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_STARTED",properties:{provider:t}}),t==="farcaster"?await EIe():await CIe(t)}function qK(t){var x;const e=SU(ue.state),{activeConnectorIds:n}=SU(Nt.state),i=e.activeChain;if(!i)return{allAccounts:[],address:void 0,caipAddress:void 0,status:void 0,isConnected:!1,embeddedWalletInfo:void 0};const o=(x=e.chains.get(i))==null?void 0:x.accountState,l=Nt.getAuthConnector(i),h=n[i];return{allAccounts:Ht.getConnections(i).flatMap(A=>A.accounts.map(({address:P,type:D,publicKey:M})=>Ft.createAccount(i,P,D||"eoa",M))),caipAddress:o==null?void 0:o.caipAddress,address:Ft.getPlainAddress(o==null?void 0:o.caipAddress),isConnected:!!(o!=null&&o.caipAddress),status:o==null?void 0:o.status,embeddedWalletInfo:l&&h===at.CONNECTOR_ID.AUTH?{user:o!=null&&o.user?{...o.user,username:Jt.getConnectedSocialUsername()}:void 0,authProvider:(o==null?void 0:o.socialProvider)||"email",accountType:o==null?void 0:o.preferredAccountType,isSmartAccountDeployed:!!(o!=null&&o.smartAccountDeployed)}:void 0}}const Ya={METMASK_CONNECTOR_NAME:"MetaMask",TRUST_CONNECTOR_NAME:"Trust Wallet",SOLFLARE_CONNECTOR_NAME:"Solflare",PHANTOM_CONNECTOR_NAME:"Phantom",COIN98_CONNECTOR_NAME:"Coin98",MAGIC_EDEN_CONNECTOR_NAME:"Magic Eden",BACKPACK_CONNECTOR_NAME:"Backpack",BITGET_CONNECTOR_NAME:"Bitget Wallet",FRONTIER_CONNECTOR_NAME:"Frontier",XVERSE_CONNECTOR_NAME:"Xverse Wallet",LEATHER_CONNECTOR_NAME:"Leather",OKX_CONNECTOR_NAME:"OKX Wallet",BINANCE_CONNECTOR_NAME:"Binance Wallet",EIP155:at.CHAIN.EVM,ADD_CHAIN_METHOD:"wallet_addEthereumChain",EIP6963_ANNOUNCE_EVENT:"eip6963:announceProvider",EIP6963_REQUEST_EVENT:"eip6963:requestProvider",CONNECTOR_RDNS_MAP:{coinbaseWallet:"com.coinbase.wallet",coinbaseWalletSDK:"com.coinbase.wallet"},CONNECTOR_TYPE_EXTERNAL:"EXTERNAL",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH",CONNECTOR_TYPE_MULTI_CHAIN:"MULTI_CHAIN",CONNECTOR_TYPE_W3M_AUTH:"AUTH",getSDKVersionWarningMessage(t,e){return`
     @@@@@@@           @@@@@@@@@@@@@@@@@@      
   @@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@@   
  @@@@@@@@@@@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@  
 @@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@  
 @@@@@@@@@@@@@@@  @@@@@@@@@@@@@@   @@@@@@@@@@@ 
 @@@@@@@@@@@@@@@  @@@@@@@@@@@@@   @@@@@@@@@@@@ 
 @@@@@@@@@@@@@@@  @@@@@@@@@@@@@  @@@@@@@@@@@@@
 @@@@@@@@@@@@@@@  @@@@@@@@@@@@   @@@@@@@@@@@@@    
 @@@@@@   @@@@@@  @@@@@@@@@@@   @@@@@@@@@@@@@@    
 @@@@@@   @@@@@@  @@@@@@@@@@@  @@@@@@@@@@@@@@@ 
 @@@@@@@@@@@@@@@  @@@@@@@@@@   @@@@@@@@@@@@@@@ 
 @@@@@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@@@@@@@@@@  
  @@@@@@@@@@@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@  
   @@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@@   
      @@@@@            @@@@@@@@@@@@@@@@@@  
      
AppKit SDK version ${t} is outdated. Latest version is ${e}. Please update to the latest version for bug fixes and new features.
            
Changelog: https://github.com/reown-com/appkit/releases
NPM Registry: https://www.npmjs.com/package/@reown/appkit`}},AIe={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200","00000008819873e925422c1ff0f99f7c":"b3406e4a-bbfc-44fb-e3a6-89673c78b700","-239":"20f673c0-095e-49b2-07cf-eb5049dcf600","-3":"20f673c0-095e-49b2-07cf-eb5049dcf600"}},no={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([n,i])=>{e[`${Ya.EIP155}:${n}`]=i}),e},isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())},getActiveNamespaceConnectedToAuth(){const t=ue.state.activeChain;return at.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(e=>Nt.getConnectorId(e)===at.CONNECTOR_ID.AUTH&&e===t)},withRetry({conditionFn:t,intervalMs:e,maxRetries:n}){let i=0;return new Promise(o=>{async function l(){return i+=1,await t()?o(!0):i>=n?o(!1):(setTimeout(l,e),null)}l()})},userChainIdToChainNamespace(t){if(typeof t=="number")return at.CHAIN.EVM;const[e]=t.split(":");return e},getOtherAuthNamespaces(t){return t?at.AUTH_CONNECTOR_SUPPORTED_CHAINS.filter(i=>i!==t):[]},getConnectorStorageInfo(t,e){const i=Jt.getConnections()[e]??[];return{hasDisconnected:Jt.isConnectorDisconnected(t,e),hasConnected:i.some(o=>no.isLowerCaseMatch(o.connectorId,t))}}},SIe=new AbortController,vs={EmbeddedWalletAbortController:SIe,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"ORIGIN_NOT_ALLOWED"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{code:"APKT001",displayMessage:"Network Not Found",debugMessage:"The specified network is not recognized. Please ensure it is included in the `networks` array of your `createAppKit` configuration."},ORIGIN_NOT_ALLOWED:{code:"APKT002",displayMessage:"Invalid App Configuration",debugMessage:()=>`The origin ${Ox()?window.origin:"unknown"} is not in your allow list. Please update your allowed domains at https://dashboard.reown.com. [PID: ${ut.state.projectId}]`},IFRAME_LOAD_FAILED:{code:"APKT003",displayMessage:"Network Error: Wallet Load Failed",debugMessage:()=>"Failed to load the embedded wallet. This may be due to network issues or server downtime. Please check your network connection and try again shortly. Contact support if the issue persists."},IFRAME_REQUEST_TIMEOUT:{code:"APKT004",displayMessage:"Wallet Request Timeout",debugMessage:()=>"The request to the embedded wallet timed out. Please check your network connection and try again shortly. Contact support if the issue persists."},UNVERIFIED_DOMAIN:{code:"APKT005",displayMessage:"Unverified Domain",debugMessage:()=>"Embedded wallet load failed. Ensure your domain is verified in https://dashboard.reown.com."},JWT_TOKEN_NOT_VALID:{code:"APKT006",displayMessage:"Session Expired",debugMessage:"Your session is invalid or expired. Please check your systems date and time settings, then reconnect."},INVALID_PROJECT_ID:{code:"APKT007",displayMessage:"Invalid Project ID",debugMessage:"The specified project ID is invalid. Please visit https://dashboard.reown.com to obtain a valid project ID."},PROJECT_ID_NOT_CONFIGURED:{code:"APKT008",displayMessage:"Project ID Missing",debugMessage:"No project ID is configured. You can create and configure a project ID at https://dashboard.reown.com."},SERVER_ERROR_APP_CONFIGURATION:{code:"APKT009",displayMessage:"Server Error",debugMessage:t=>`Unable to fetch App Configuration. ${t}. Please check your network connection and try again shortly. Contact support if the issue persists.`},RATE_LIMITED_APP_CONFIGURATION:{code:"APKT010",displayMessage:"Rate Limited",debugMessage:"You have been rate limited while retrieving App Configuration. Please wait a few minutes and try again. Contact support if the issue persists."}},ALERT_WARNINGS:{LOCAL_CONFIGURATION_IGNORED:{debugMessage:t=>`[Reown Config Notice] ${t}`},INACTIVE_NAMESPACE_NOT_CONNECTED:{code:"APKTW001",displayMessage:"Inactive Namespace Not Connected",debugMessage:(t,e)=>`An error occurred while connecting an inactive namespace ${t}: "${e}"`},INVALID_EMAIL:{code:"APKTW002",displayMessage:"Invalid Email Address",debugMessage:"Please enter a valid email address"}}},ZK={TOKEN_ADDRESSES_BY_SYMBOL:{USDC:{8453:HK.asset,84532:iIe.asset}},getTokenSymbolByAddress(t){if(!t)return;const[e]=Object.entries(ZK.TOKEN_ADDRESSES_BY_SYMBOL).find(([n,i])=>Object.values(i).includes(t))??[];return e}},IIe={createLogger(t,e="error"){const n=Sk({level:e}),{logger:i}=RS({opts:n});return i.error=(...o)=>{for(const l of o)if(l instanceof Error){t(l,...o);return}t(void 0,...o)},i}},PIe="rpc.walletconnect.org";function IU(t,e){const n=new URL("https://rpc.walletconnect.org/v1/");return n.searchParams.set("chainId",t),n.searchParams.set("projectId",e),n.toString()}const sR=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","eip155:80094","eip155:80069","eip155:560048","eip155:31","eip155:2818","eip155:57054","eip155:911867","eip155:534351","eip155:1112","eip155:534352","eip155:1111","eip155:146","eip155:130","eip155:1284","eip155:30","eip155:2810","eip155:55931","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],hd={extendRpcUrlWithProjectId(t,e){let n=!1;try{n=new URL(t).host===PIe}catch{n=!1}if(n){const i=new URL(t);return i.searchParams.has("projectId")||i.searchParams.set("projectId",e),i.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:at.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${at.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,n){var o,l,h;const i=(h=(l=(o=t.rpcUrls)==null?void 0:o.default)==null?void 0:l.http)==null?void 0:h[0];return sR.includes(e)?IU(e,n):i||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:n,customRpcUrls:i}){var D,M,z,U,G,ne,oe;const o=this.getChainNamespace(t),l=this.getCaipNetworkId(t),h=(z=(M=(D=t.rpcUrls)==null?void 0:D.default)==null?void 0:M.http)==null?void 0:z[0],s=this.getDefaultRpcUrl(t,l,n),w=((ne=(G=(U=t==null?void 0:t.rpcUrls)==null?void 0:U.chainDefault)==null?void 0:G.http)==null?void 0:ne[0])||h,x=((oe=i==null?void 0:i[l])==null?void 0:oe.map(Q=>Q.url))||[],A=[...x,...s?[s]:[]],P=[...x];return w&&!P.includes(w)&&P.push(w),{...t,chainNamespace:o,caipNetworkId:l,assets:{imageId:AIe.NetworkImageIds[t.id],imageUrl:e==null?void 0:e[t.id]},rpcUrls:{...t.rpcUrls,default:{http:A},chainDefault:{http:P}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:n,customRpcUrls:i}){return t.map(o=>hd.extendCaipNetwork(o,{customNetworkImageUrls:e,customRpcUrls:i,projectId:n}))},getViemTransport(t,e,n){var o,l,h;const i=[];return n==null||n.forEach(s=>{i.push(Y5(s.url,s.config))}),sR.includes(t.caipNetworkId)&&i.push(Y5(IU(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),(h=(l=(o=t==null?void 0:t.rpcUrls)==null?void 0:o.default)==null?void 0:l.http)==null||h.forEach(s=>{i.push(Y5(s))}),_$(i)},extendWagmiTransports(t,e,n){if(sR.includes(t.caipNetworkId)){const i=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return _$([n,Y5(i)])}return n},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:at.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){var w;const e=Jt.getActiveCaipNetworkId(),n=ue.getAllRequestedCaipNetworks(),i=Array.from(((w=ue.state.chains)==null?void 0:w.keys())||[]),o=e==null?void 0:e.split(":")[0],l=o?i.includes(o):!1,h=n==null?void 0:n.find(x=>x.caipNetworkId===e);return l&&!h&&e?this.getUnsupportedNetwork(e):h||t||(n==null?void 0:n[0])}};class $0{constructor(){}static getInstance({projectId:e,chainId:n,enableLogger:i,onTimeout:o,abortController:l,getActiveCaipNetwork:h,getCaipNetworks:s}){var P;const{metadata:w,sdkVersion:x,sdkType:A}=ut.getSnapshot();return $0.instance||($0.instance=new gW({projectId:e,chainId:n,enableLogger:i,onTimeout:o,abortController:l,getActiveCaipNetwork:h,getCaipNetworks:s,enableCloudAuthAccount:!!((P=ut.state.remoteFeatures)!=null&&P.emailCapture),metadata:w,sdkVersion:x,sdkType:A})),$0.instance}}const jA={interpolate(t,e,n){if(t.length!==2||e.length!==2)throw new Error("inputRange and outputRange must be an array of length 2");const i=t[0]||0,o=t[1]||0,l=e[0]||0,h=e[1]||0;return n<i?l:n>o?h:(h-l)/(o-i)*(n-i)+l}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const GT=globalThis,jD=GT.ShadowRoot&&(GT.ShadyCSS===void 0||GT.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,VD=Symbol(),PU=new WeakMap;let KK=class{constructor(e,n,i){if(this._$cssResult$=!0,i!==VD)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=n}get styleSheet(){let e=this.o;const n=this.t;if(jD&&e===void 0){const i=n!==void 0&&n.length===1;i&&(e=PU.get(n)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&PU.set(n,e))}return e}toString(){return this.cssText}};const ld=t=>new KK(typeof t=="string"?t:t+"",void 0,VD),rs=(t,...e)=>{const n=t.length===1?t[0]:e.reduce((i,o,l)=>i+(h=>{if(h._$cssResult$===!0)return h.cssText;if(typeof h=="number")return h;throw Error("Value passed to 'css' function must be a 'css' function result: "+h+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(o)+t[l+1],t[0]);return new KK(n,t,VD)},RIe=(t,e)=>{if(jD)t.adoptedStyleSheets=e.map(n=>n instanceof CSSStyleSheet?n:n.styleSheet);else for(const n of e){const i=document.createElement("style"),o=GT.litNonce;o!==void 0&&i.setAttribute("nonce",o),i.textContent=n.cssText,t.appendChild(i)}},RU=jD?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let n="";for(const i of e.cssRules)n+=i.cssText;return ld(n)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:OIe,defineProperty:kIe,getOwnPropertyDescriptor:DIe,getOwnPropertyNames:NIe,getOwnPropertySymbols:MIe,getPrototypeOf:LIe}=Object,Sm=globalThis,OU=Sm.trustedTypes,BIe=OU?OU.emptyScript:"",oR=Sm.reactiveElementPolyfillSupport,qx=(t,e)=>t,VA={toAttribute(t,e){switch(e){case Boolean:t=t?BIe:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=t!==null;break;case Number:n=t===null?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch{n=null}}return n}},WD=(t,e)=>!OIe(t,e),kU={attribute:!0,type:String,converter:VA,reflect:!1,useDefault:!1,hasChanged:WD};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Sm.litPropertyMetadata??(Sm.litPropertyMetadata=new WeakMap);let E1=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,n=kU){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(e,n),!n.noAccessor){const i=Symbol(),o=this.getPropertyDescriptor(e,i,n);o!==void 0&&kIe(this.prototype,e,o)}}static getPropertyDescriptor(e,n,i){const{get:o,set:l}=DIe(this.prototype,e)??{get(){return this[n]},set(h){this[n]=h}};return{get:o,set(h){const s=o==null?void 0:o.call(this);l==null||l.call(this,h),this.requestUpdate(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??kU}static _$Ei(){if(this.hasOwnProperty(qx("elementProperties")))return;const e=LIe(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(qx("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(qx("properties"))){const n=this.properties,i=[...NIe(n),...MIe(n)];for(const o of i)this.createProperty(o,n[o])}const e=this[Symbol.metadata];if(e!==null){const n=litPropertyMetadata.get(e);if(n!==void 0)for(const[i,o]of n)this.elementProperties.set(i,o)}this._$Eh=new Map;for(const[n,i]of this.elementProperties){const o=this._$Eu(n,i);o!==void 0&&this._$Eh.set(o,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const n=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const o of i)n.unshift(RU(o))}else e!==void 0&&n.push(RU(e));return n}static _$Eu(e,n){const i=n.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(n=>this.enableUpdating=n),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(n=>n(this))}addController(e){var n;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((n=e.hostConnected)==null||n.call(e))}removeController(e){var n;(n=this._$EO)==null||n.delete(e)}_$E_(){const e=new Map,n=this.constructor.elementProperties;for(const i of n.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return RIe(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(n=>{var i;return(i=n.hostConnected)==null?void 0:i.call(n)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(n=>{var i;return(i=n.hostDisconnected)==null?void 0:i.call(n)})}attributeChangedCallback(e,n,i){this._$AK(e,i)}_$ET(e,n){var l;const i=this.constructor.elementProperties.get(e),o=this.constructor._$Eu(e,i);if(o!==void 0&&i.reflect===!0){const h=(((l=i.converter)==null?void 0:l.toAttribute)!==void 0?i.converter:VA).toAttribute(n,i.type);this._$Em=e,h==null?this.removeAttribute(o):this.setAttribute(o,h),this._$Em=null}}_$AK(e,n){var l,h;const i=this.constructor,o=i._$Eh.get(e);if(o!==void 0&&this._$Em!==o){const s=i.getPropertyOptions(o),w=typeof s.converter=="function"?{fromAttribute:s.converter}:((l=s.converter)==null?void 0:l.fromAttribute)!==void 0?s.converter:VA;this._$Em=o;const x=w.fromAttribute(n,s.type);this[o]=x??((h=this._$Ej)==null?void 0:h.get(o))??x,this._$Em=null}}requestUpdate(e,n,i,o=!1,l){var h;if(e!==void 0){const s=this.constructor;if(o===!1&&(l=this[e]),i??(i=s.getPropertyOptions(e)),!((i.hasChanged??WD)(l,n)||i.useDefault&&i.reflect&&l===((h=this._$Ej)==null?void 0:h.get(e))&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,n,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,n,{useDefault:i,reflect:o,wrapped:l},h){i&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,h??n??this[e]),l!==!0||h!==void 0)||(this._$AL.has(e)||(this.hasUpdated||i||(n=void 0),this._$AL.set(e,n)),o===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[l,h]of this._$Ep)this[l]=h;this._$Ep=void 0}const o=this.constructor.elementProperties;if(o.size>0)for(const[l,h]of o){const{wrapped:s}=h,w=this[l];s!==!0||this._$AL.has(l)||w===void 0||this.C(l,void 0,h,w)}}let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),(i=this._$EO)==null||i.forEach(o=>{var l;return(l=o.hostUpdate)==null?void 0:l.call(o)}),this.update(n)):this._$EM()}catch(o){throw e=!1,this._$EM(),o}e&&this._$AE(n)}willUpdate(e){}_$AE(e){var n;(n=this._$EO)==null||n.forEach(i=>{var o;return(o=i.hostUpdated)==null?void 0:o.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(n=>this._$ET(n,this[n]))),this._$EM()}updated(e){}firstUpdated(e){}};E1.elementStyles=[],E1.shadowRootOptions={mode:"open"},E1[qx("elementProperties")]=new Map,E1[qx("finalized")]=new Map,oR==null||oR({ReactiveElement:E1}),(Sm.reactiveElementVersions??(Sm.reactiveElementVersions=[])).push("2.1.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Zx=globalThis,DU=t=>t,WA=Zx.trustedTypes,NU=WA?WA.createPolicy("lit-html",{createHTML:t=>t}):void 0,YK="$lit$",gm=`lit$${Math.random().toFixed(9).slice(2)}$`,XK="?"+gm,FIe=`<${XK}>`,iy=document,W2=()=>iy.createComment(""),H2=t=>t===null||typeof t!="object"&&typeof t!="function",HD=Array.isArray,$Ie=t=>HD(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",aR=`[ 	
\f\r]`,Sx=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,MU=/-->/g,LU=/>/g,p0=RegExp(`>|${aR}(?:([^\\s"'>=/]+)(${aR}*=${aR}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),BU=/'/g,FU=/"/g,JK=/^(?:script|style|textarea|title)$/i,QK=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),we=QK(1),yi=QK(2),ry=Symbol.for("lit-noChange"),ro=Symbol.for("lit-nothing"),$U=new WeakMap,O0=iy.createTreeWalker(iy,129);function eY(t,e){if(!HD(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return NU!==void 0?NU.createHTML(e):e}const zIe=(t,e)=>{const n=t.length-1,i=[];let o,l=e===2?"<svg>":e===3?"<math>":"",h=Sx;for(let s=0;s<n;s++){const w=t[s];let x,A,P=-1,D=0;for(;D<w.length&&(h.lastIndex=D,A=h.exec(w),A!==null);)D=h.lastIndex,h===Sx?A[1]==="!--"?h=MU:A[1]!==void 0?h=LU:A[2]!==void 0?(JK.test(A[2])&&(o=RegExp("</"+A[2],"g")),h=p0):A[3]!==void 0&&(h=p0):h===p0?A[0]===">"?(h=o??Sx,P=-1):A[1]===void 0?P=-2:(P=h.lastIndex-A[2].length,x=A[1],h=A[3]===void 0?p0:A[3]==='"'?FU:BU):h===FU||h===BU?h=p0:h===MU||h===LU?h=Sx:(h=p0,o=void 0);const M=h===p0&&t[s+1].startsWith("/>")?" ":"";l+=h===Sx?w+FIe:P>=0?(i.push(x),w.slice(0,P)+YK+w.slice(P)+gm+M):w+gm+(P===-2?s:M)}return[eY(t,l+(t[n]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]};class G2{constructor({strings:e,_$litType$:n},i){let o;this.parts=[];let l=0,h=0;const s=e.length-1,w=this.parts,[x,A]=zIe(e,n);if(this.el=G2.createElement(x,i),O0.currentNode=this.el.content,n===2||n===3){const P=this.el.content.firstChild;P.replaceWith(...P.childNodes)}for(;(o=O0.nextNode())!==null&&w.length<s;){if(o.nodeType===1){if(o.hasAttributes())for(const P of o.getAttributeNames())if(P.endsWith(YK)){const D=A[h++],M=o.getAttribute(P).split(gm),z=/([.?@])?(.*)/.exec(D);w.push({type:1,index:l,name:z[2],strings:M,ctor:z[1]==="."?jIe:z[1]==="?"?VIe:z[1]==="@"?WIe:uI}),o.removeAttribute(P)}else P.startsWith(gm)&&(w.push({type:6,index:l}),o.removeAttribute(P));if(JK.test(o.tagName)){const P=o.textContent.split(gm),D=P.length-1;if(D>0){o.textContent=WA?WA.emptyScript:"";for(let M=0;M<D;M++)o.append(P[M],W2()),O0.nextNode(),w.push({type:2,index:++l});o.append(P[D],W2())}}}else if(o.nodeType===8)if(o.data===XK)w.push({type:2,index:l});else{let P=-1;for(;(P=o.data.indexOf(gm,P+1))!==-1;)w.push({type:7,index:l}),P+=gm.length-1}l++}}static createElement(e,n){const i=iy.createElement("template");return i.innerHTML=e,i}}function fw(t,e,n=t,i){var h,s;if(e===ry)return e;let o=i!==void 0?(h=n._$Co)==null?void 0:h[i]:n._$Cl;const l=H2(e)?void 0:e._$litDirective$;return(o==null?void 0:o.constructor)!==l&&((s=o==null?void 0:o._$AO)==null||s.call(o,!1),l===void 0?o=void 0:(o=new l(t),o._$AT(t,n,i)),i!==void 0?(n._$Co??(n._$Co=[]))[i]=o:n._$Cl=o),o!==void 0&&(e=fw(t,o._$AS(t,e.values),o,i)),e}class UIe{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:i}=this._$AD,o=((e==null?void 0:e.creationScope)??iy).importNode(n,!0);O0.currentNode=o;let l=O0.nextNode(),h=0,s=0,w=i[0];for(;w!==void 0;){if(h===w.index){let x;w.type===2?x=new $E(l,l.nextSibling,this,e):w.type===1?x=new w.ctor(l,w.name,w.strings,this,e):w.type===6&&(x=new HIe(l,this,e)),this._$AV.push(x),w=i[++s]}h!==(w==null?void 0:w.index)&&(l=O0.nextNode(),h++)}return O0.currentNode=iy,o}p(e){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,n),n+=i.strings.length-2):i._$AI(e[n])),n++}}class $E{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,n,i,o){this.type=2,this._$AH=ro,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=i,this.options=o,this._$Cv=(o==null?void 0:o.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=fw(this,e,n),H2(e)?e===ro||e==null||e===""?(this._$AH!==ro&&this._$AR(),this._$AH=ro):e!==this._$AH&&e!==ry&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):$Ie(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==ro&&H2(this._$AH)?this._$AA.nextSibling.data=e:this.T(iy.createTextNode(e)),this._$AH=e}$(e){var l;const{values:n,_$litType$:i}=e,o=typeof i=="number"?this._$AC(e):(i.el===void 0&&(i.el=G2.createElement(eY(i.h,i.h[0]),this.options)),i);if(((l=this._$AH)==null?void 0:l._$AD)===o)this._$AH.p(n);else{const h=new UIe(o,this),s=h.u(this.options);h.p(n),this.T(s),this._$AH=h}}_$AC(e){let n=$U.get(e.strings);return n===void 0&&$U.set(e.strings,n=new G2(e)),n}k(e){HD(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,o=0;for(const l of e)o===n.length?n.push(i=new $E(this.O(W2()),this.O(W2()),this,this.options)):i=n[o],i._$AI(l),o++;o<n.length&&(this._$AR(i&&i._$AB.nextSibling,o),n.length=o)}_$AR(e=this._$AA.nextSibling,n){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,n);e!==this._$AB;){const o=DU(e).nextSibling;DU(e).remove(),e=o}}setConnected(e){var n;this._$AM===void 0&&(this._$Cv=e,(n=this._$AP)==null||n.call(this,e))}}class uI{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,i,o,l){this.type=1,this._$AH=ro,this._$AN=void 0,this.element=e,this.name=n,this._$AM=o,this.options=l,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=ro}_$AI(e,n=this,i,o){const l=this.strings;let h=!1;if(l===void 0)e=fw(this,e,n,0),h=!H2(e)||e!==this._$AH&&e!==ry,h&&(this._$AH=e);else{const s=e;let w,x;for(e=l[0],w=0;w<l.length-1;w++)x=fw(this,s[i+w],n,w),x===ry&&(x=this._$AH[w]),h||(h=!H2(x)||x!==this._$AH[w]),x===ro?e=ro:e!==ro&&(e+=(x??"")+l[w+1]),this._$AH[w]=x}h&&!o&&this.j(e)}j(e){e===ro?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class jIe extends uI{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===ro?void 0:e}}class VIe extends uI{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==ro)}}class WIe extends uI{constructor(e,n,i,o,l){super(e,n,i,o,l),this.type=5}_$AI(e,n=this){if((e=fw(this,e,n,0)??ro)===ry)return;const i=this._$AH,o=e===ro&&i!==ro||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,l=e!==ro&&(i===ro||o);o&&this.element.removeEventListener(this.name,this,i),l&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var n;typeof this._$AH=="function"?this._$AH.call(((n=this.options)==null?void 0:n.host)??this.element,e):this._$AH.handleEvent(e)}}class HIe{constructor(e,n,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){fw(this,e)}}const cR=Zx.litHtmlPolyfillSupport;cR==null||cR(G2,$E),(Zx.litHtmlVersions??(Zx.litHtmlVersions=[])).push("3.3.2");const GIe=(t,e,n)=>{const i=(n==null?void 0:n.renderBefore)??e;let o=i._$litPart$;if(o===void 0){const l=(n==null?void 0:n.renderBefore)??null;i._$litPart$=o=new $E(e.insertBefore(W2(),l),l,void 0,n??{})}return o._$AI(t),o};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const z0=globalThis;let on=class extends E1{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var n;const e=super.createRenderRoot();return(n=this.renderOptions).renderBefore??(n.renderBefore=e.firstChild),e}update(e){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=GIe(n,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return ry}};var IV;on._$litElement$=!0,on.finalized=!0,(IV=z0.litElementHydrateSupport)==null||IV.call(z0,{LitElement:on});const lR=z0.litElementPolyfillSupport;lR==null||lR({LitElement:on});(z0.litElementVersions??(z0.litElementVersions=[])).push("4.2.2");const qIe={black:"#202020",white:"#FFFFFF",white010:"rgba(255, 255, 255, 0.1)",accent010:"rgba(9, 136, 240, 0.1)",accent020:"rgba(9, 136, 240, 0.2)",accent030:"rgba(9, 136, 240, 0.3)",accent040:"rgba(9, 136, 240, 0.4)",accent050:"rgba(9, 136, 240, 0.5)",accent060:"rgba(9, 136, 240, 0.6)",accent070:"rgba(9, 136, 240, 0.7)",accent080:"rgba(9, 136, 240, 0.8)",accent090:"rgba(9, 136, 240, 0.9)",accent100:"rgba(9, 136, 240, 1.0)",accentSecondary010:"rgba(199, 185, 148, 0.1)",accentSecondary020:"rgba(199, 185, 148, 0.2)",accentSecondary030:"rgba(199, 185, 148, 0.3)",accentSecondary040:"rgba(199, 185, 148, 0.4)",accentSecondary050:"rgba(199, 185, 148, 0.5)",accentSecondary060:"rgba(199, 185, 148, 0.6)",accentSecondary070:"rgba(199, 185, 148, 0.7)",accentSecondary080:"rgba(199, 185, 148, 0.8)",accentSecondary090:"rgba(199, 185, 148, 0.9)",accentSecondary100:"rgba(199, 185, 148, 1.0)",productWalletKit:"#FFB800",productAppKit:"#FF573B",productCloud:"#0988F0",productDocumentation:"#008847",neutrals050:"#F6F6F6",neutrals100:"#F3F3F3",neutrals200:"#E9E9E9",neutrals300:"#D0D0D0",neutrals400:"#BBB",neutrals500:"#9A9A9A",neutrals600:"#6C6C6C",neutrals700:"#4F4F4F",neutrals800:"#363636",neutrals900:"#2A2A2A",neutrals1000:"#252525",semanticSuccess010:"rgba(48, 164, 107, 0.1)",semanticSuccess020:"rgba(48, 164, 107, 0.2)",semanticSuccess030:"rgba(48, 164, 107, 0.3)",semanticSuccess040:"rgba(48, 164, 107, 0.4)",semanticSuccess050:"rgba(48, 164, 107, 0.5)",semanticSuccess060:"rgba(48, 164, 107, 0.6)",semanticSuccess070:"rgba(48, 164, 107, 0.7)",semanticSuccess080:"rgba(48, 164, 107, 0.8)",semanticSuccess090:"rgba(48, 164, 107, 0.9)",semanticSuccess100:"rgba(48, 164, 107, 1.0)",semanticError010:"rgba(223, 74, 52, 0.1)",semanticError020:"rgba(223, 74, 52, 0.2)",semanticError030:"rgba(223, 74, 52, 0.3)",semanticError040:"rgba(223, 74, 52, 0.4)",semanticError050:"rgba(223, 74, 52, 0.5)",semanticError060:"rgba(223, 74, 52, 0.6)",semanticError070:"rgba(223, 74, 52, 0.7)",semanticError080:"rgba(223, 74, 52, 0.8)",semanticError090:"rgba(223, 74, 52, 0.9)",semanticError100:"rgba(223, 74, 52, 1.0)",semanticWarning010:"rgba(243, 161, 63, 0.1)",semanticWarning020:"rgba(243, 161, 63, 0.2)",semanticWarning030:"rgba(243, 161, 63, 0.3)",semanticWarning040:"rgba(243, 161, 63, 0.4)",semanticWarning050:"rgba(243, 161, 63, 0.5)",semanticWarning060:"rgba(243, 161, 63, 0.6)",semanticWarning070:"rgba(243, 161, 63, 0.7)",semanticWarning080:"rgba(243, 161, 63, 0.8)",semanticWarning090:"rgba(243, 161, 63, 0.9)",semanticWarning100:"rgba(243, 161, 63, 1.0)"},HA={core:{backgroundAccentPrimary:"#0988F0",backgroundAccentCertified:"#C7B994",backgroundWalletKit:"#FFB800",backgroundAppKit:"#FF573B",backgroundCloud:"#0988F0",backgroundDocumentation:"#008847",backgroundSuccess:"rgba(48, 164, 107, 0.20)",backgroundError:"rgba(223, 74, 52, 0.20)",backgroundWarning:"rgba(243, 161, 63, 0.20)",textAccentPrimary:"#0988F0",textAccentCertified:"#C7B994",textWalletKit:"#FFB800",textAppKit:"#FF573B",textCloud:"#0988F0",textDocumentation:"#008847",textSuccess:"#30A46B",textError:"#DF4A34",textWarning:"#F3A13F",borderAccentPrimary:"#0988F0",borderSecondary:"#C7B994",borderSuccess:"#30A46B",borderError:"#DF4A34",borderWarning:"#F3A13F",foregroundAccent010:"rgba(9, 136, 240, 0.1)",foregroundAccent020:"rgba(9, 136, 240, 0.2)",foregroundAccent040:"rgba(9, 136, 240, 0.4)",foregroundAccent060:"rgba(9, 136, 240, 0.6)",foregroundSecondary020:"rgba(199, 185, 148, 0.2)",foregroundSecondary040:"rgba(199, 185, 148, 0.4)",foregroundSecondary060:"rgba(199, 185, 148, 0.6)",iconAccentPrimary:"#0988F0",iconAccentCertified:"#C7B994",iconSuccess:"#30A46B",iconError:"#DF4A34",iconWarning:"#F3A13F",glass010:"rgba(255, 255, 255, 0.1)",zIndex:"9999"},dark:{overlay:"rgba(0, 0, 0, 0.50)",backgroundPrimary:"#202020",backgroundInvert:"#FFFFFF",textPrimary:"#FFFFFF",textSecondary:"#9A9A9A",textTertiary:"#BBBBBB",textInvert:"#202020",borderPrimary:"#2A2A2A",borderPrimaryDark:"#363636",borderSecondary:"#4F4F4F",foregroundPrimary:"#252525",foregroundSecondary:"#2A2A2A",foregroundTertiary:"#363636",iconDefault:"#9A9A9A",iconInverse:"#FFFFFF"},light:{overlay:"rgba(230 , 230, 230, 0.5)",backgroundPrimary:"#FFFFFF",borderPrimaryDark:"#E9E9E9",backgroundInvert:"#202020",textPrimary:"#202020",textSecondary:"#9A9A9A",textTertiary:"#6C6C6C",textInvert:"#FFFFFF",borderPrimary:"#E9E9E9",borderSecondary:"#D0D0D0",foregroundPrimary:"#F3F3F3",foregroundSecondary:"#E9E9E9",foregroundTertiary:"#D0D0D0",iconDefault:"#9A9A9A",iconInverse:"#202020"}},ZIe={1:"4px",2:"8px",10:"10px",3:"12px",4:"16px",6:"24px",5:"20px",8:"32px",16:"64px",20:"80px",32:"128px",64:"256px",128:"512px",round:"9999px"},KIe={0:"0px","01":"2px",1:"4px",2:"8px",3:"12px",4:"16px",5:"20px",6:"24px",7:"28px",8:"32px",9:"36px",10:"40px",12:"48px",14:"56px",16:"64px",20:"80px",32:"128px",64:"256px"},YIe={regular:"KHTeka",mono:"KHTekaMono"},XIe={regular:"400",medium:"500"},JIe={h1:"50px",h2:"44px",h3:"38px",h4:"32px",h5:"26px",h6:"20px",large:"16px",medium:"14px",small:"12px"},QIe={"h1-regular-mono":{lineHeight:"50px",letterSpacing:"-3px"},"h1-regular":{lineHeight:"50px",letterSpacing:"-1px"},"h1-medium":{lineHeight:"50px",letterSpacing:"-0.84px"},"h2-regular-mono":{lineHeight:"44px",letterSpacing:"-2.64px"},"h2-regular":{lineHeight:"44px",letterSpacing:"-0.88px"},"h2-medium":{lineHeight:"44px",letterSpacing:"-0.88px"},"h3-regular-mono":{lineHeight:"38px",letterSpacing:"-2.28px"},"h3-regular":{lineHeight:"38px",letterSpacing:"-0.76px"},"h3-medium":{lineHeight:"38px",letterSpacing:"-0.76px"},"h4-regular-mono":{lineHeight:"32px",letterSpacing:"-1.92px"},"h4-regular":{lineHeight:"32px",letterSpacing:"-0.32px"},"h4-medium":{lineHeight:"32px",letterSpacing:"-0.32px"},"h5-regular-mono":{lineHeight:"26px",letterSpacing:"-1.56px"},"h5-regular":{lineHeight:"26px",letterSpacing:"-0.26px"},"h5-medium":{lineHeight:"26px",letterSpacing:"-0.26px"},"h6-regular-mono":{lineHeight:"20px",letterSpacing:"-1.2px"},"h6-regular":{lineHeight:"20px",letterSpacing:"-0.6px"},"h6-medium":{lineHeight:"20px",letterSpacing:"-0.6px"},"lg-regular-mono":{lineHeight:"16px",letterSpacing:"-0.96px"},"lg-regular":{lineHeight:"18px",letterSpacing:"-0.16px"},"lg-medium":{lineHeight:"18px",letterSpacing:"-0.16px"},"md-regular-mono":{lineHeight:"14px",letterSpacing:"-0.84px"},"md-regular":{lineHeight:"16px",letterSpacing:"-0.14px"},"md-medium":{lineHeight:"16px",letterSpacing:"-0.14px"},"sm-regular-mono":{lineHeight:"12px",letterSpacing:"-0.72px"},"sm-regular":{lineHeight:"14px",letterSpacing:"-0.12px"},"sm-medium":{lineHeight:"14px",letterSpacing:"-0.12px"}},e6e={"ease-out-power-2":"cubic-bezier(0.23, 0.09, 0.08, 1.13)","ease-out-power-1":"cubic-bezier(0.12, 0.04, 0.2, 1.06)","ease-in-power-2":"cubic-bezier(0.92, -0.13, 0.77, 0.91)","ease-in-power-1":"cubic-bezier(0.88, -0.06, 0.8, 0.96)","ease-inout-power-2":"cubic-bezier(0.77, 0.09, 0.23, 1.13)","ease-inout-power-1":"cubic-bezier(0.88, 0.04, 0.12, 1.06)"},t6e={xl:"400ms",lg:"200ms",md:"125ms",sm:"75ms"},_O={colors:qIe,fontFamily:YIe,fontWeight:XIe,textSize:JIe,typography:QIe,tokens:{core:HA.core,theme:HA.dark},borderRadius:ZIe,spacing:KIe,durations:t6e,easings:e6e},zU="--apkt";function _T(t){if(!t)return{};const e={};return e["font-family"]=t["--apkt-font-family"]??t["--w3m-font-family"]??"KHTeka",e.accent=t["--apkt-accent"]??t["--w3m-accent"]??"#0988F0",e["color-mix"]=t["--apkt-color-mix"]??t["--w3m-color-mix"]??"#000",e["color-mix-strength"]=t["--apkt-color-mix-strength"]??t["--w3m-color-mix-strength"]??0,e["font-size-master"]=t["--apkt-font-size-master"]??t["--w3m-font-size-master"]??"10px",e["border-radius-master"]=t["--apkt-border-radius-master"]??t["--w3m-border-radius-master"]??"4px",t["--apkt-z-index"]!==void 0?e["z-index"]=t["--apkt-z-index"]:t["--w3m-z-index"]!==void 0&&(e["z-index"]=t["--w3m-z-index"]),e}const Pf={createCSSVariables(t){const e={},n={};function i(l,h,s=""){for(const[w,x]of Object.entries(l)){const A=s?`${s}-${w}`:w;x&&typeof x=="object"&&Object.keys(x).length?(h[w]={},i(x,h[w],A)):typeof x=="string"&&(h[w]=`${zU}-${A}`)}}function o(l,h){for(const[s,w]of Object.entries(l))w&&typeof w=="object"?(h[s]={},o(w,h[s])):typeof w=="string"&&(h[s]=`var(${w})`)}return i(t,e),o(e,n),{cssVariables:e,cssVariablesVarPrefix:n}},assignCSSVariables(t,e){const n={};function i(o,l,h){for(const[s,w]of Object.entries(o)){const x=h?`${h}-${s}`:s,A=l[s];w&&typeof w=="object"?i(w,A,x):typeof A=="string"&&(n[`${zU}-${x}`]=A)}}return i(t,e),n},createRootStyles(t,e){const n={..._O,tokens:{..._O.tokens,theme:t==="light"?HA.light:HA.dark}},{cssVariables:i}=Pf.createCSSVariables(n),o=Pf.assignCSSVariables(i,n),l=Pf.generateW3MVariables(e),h=Pf.generateW3MOverrides(e),s=Pf.generateScaledVariables(e),w=Pf.generateBaseVariables(o),x={...o,...w,...l,...h,...s},A=Pf.applyColorMixToVariables(e,x),P={...x,...A};return`:root {${Object.entries(P).map(([M,z])=>`${M}:${z.replace("/[:;{}</>]/g","")};`).join("")}}`},generateW3MVariables(t){if(!t)return{};const e=_T(t),n={};return n["--w3m-font-family"]=e["font-family"],n["--w3m-accent"]=e.accent,n["--w3m-color-mix"]=e["color-mix"],n["--w3m-color-mix-strength"]=`${e["color-mix-strength"]}%`,n["--w3m-font-size-master"]=e["font-size-master"],n["--w3m-border-radius-master"]=e["border-radius-master"],n},generateW3MOverrides(t){if(!t)return{};const e=_T(t),n={};if(t["--apkt-accent"]||t["--w3m-accent"]){const i=e.accent;n["--apkt-tokens-core-iconAccentPrimary"]=i,n["--apkt-tokens-core-borderAccentPrimary"]=i,n["--apkt-tokens-core-textAccentPrimary"]=i,n["--apkt-tokens-core-backgroundAccentPrimary"]=i}return(t["--apkt-font-family"]||t["--w3m-font-family"])&&(n["--apkt-fontFamily-regular"]=e["font-family"]),e["z-index"]!==void 0&&(n["--apkt-tokens-core-zIndex"]=`${e["z-index"]}`),n},generateScaledVariables(t){if(!t)return{};const e=_T(t),n={};if(t["--apkt-font-size-master"]||t["--w3m-font-size-master"]){const i=parseFloat(e["font-size-master"].replace("px",""));n["--apkt-textSize-h1"]=`${Number(i)*5}px`,n["--apkt-textSize-h2"]=`${Number(i)*4.4}px`,n["--apkt-textSize-h3"]=`${Number(i)*3.8}px`,n["--apkt-textSize-h4"]=`${Number(i)*3.2}px`,n["--apkt-textSize-h5"]=`${Number(i)*2.6}px`,n["--apkt-textSize-h6"]=`${Number(i)*2}px`,n["--apkt-textSize-large"]=`${Number(i)*1.6}px`,n["--apkt-textSize-medium"]=`${Number(i)*1.4}px`,n["--apkt-textSize-small"]=`${Number(i)*1.2}px`}if(t["--apkt-border-radius-master"]||t["--w3m-border-radius-master"]){const i=parseFloat(e["border-radius-master"].replace("px",""));n["--apkt-borderRadius-1"]=`${Number(i)}px`,n["--apkt-borderRadius-2"]=`${Number(i)*2}px`,n["--apkt-borderRadius-3"]=`${Number(i)*3}px`,n["--apkt-borderRadius-4"]=`${Number(i)*4}px`,n["--apkt-borderRadius-5"]=`${Number(i)*5}px`,n["--apkt-borderRadius-6"]=`${Number(i)*6}px`,n["--apkt-borderRadius-8"]=`${Number(i)*8}px`,n["--apkt-borderRadius-16"]=`${Number(i)*16}px`,n["--apkt-borderRadius-20"]=`${Number(i)*20}px`,n["--apkt-borderRadius-32"]=`${Number(i)*32}px`,n["--apkt-borderRadius-64"]=`${Number(i)*64}px`,n["--apkt-borderRadius-128"]=`${Number(i)*128}px`}return n},generateColorMixCSS(t,e){if(!(t!=null&&t["--w3m-color-mix"])||!t["--w3m-color-mix-strength"])return"";const n=t["--w3m-color-mix"],i=t["--w3m-color-mix-strength"];if(!i||i===0)return"";const o=Object.keys(e||{}).filter(h=>{const s=h.includes("-tokens-core-background")||h.includes("-tokens-core-text")||h.includes("-tokens-core-border")||h.includes("-tokens-core-foreground")||h.includes("-tokens-core-icon")||h.includes("-tokens-theme-background")||h.includes("-tokens-theme-text")||h.includes("-tokens-theme-border")||h.includes("-tokens-theme-foreground")||h.includes("-tokens-theme-icon"),w=h.includes("-borderRadius-")||h.includes("-spacing-")||h.includes("-textSize-")||h.includes("-fontFamily-")||h.includes("-fontWeight-")||h.includes("-typography-")||h.includes("-duration-")||h.includes("-ease-")||h.includes("-path-")||h.includes("-width-")||h.includes("-height-")||h.includes("-visual-size-")||h.includes("-modal-width")||h.includes("-cover");return s&&!w});return o.length===0?"":` @supports (background: color-mix(in srgb, white 50%, black)) {
      :root {
        ${o.map(h=>{const s=(e==null?void 0:e[h])||"";return s.includes("color-mix")||s.startsWith("#")||s.startsWith("rgb")?`${h}: color-mix(in srgb, ${n} ${i}%, ${s});`:`${h}: color-mix(in srgb, ${n} ${i}%, var(${h}-base, ${s}));`}).join("")}
      }
    }`},generateBaseVariables(t){const e={},n=t["--apkt-tokens-theme-backgroundPrimary"];n&&(e["--apkt-tokens-theme-backgroundPrimary-base"]=n);const i=t["--apkt-tokens-core-backgroundAccentPrimary"];return i&&(e["--apkt-tokens-core-backgroundAccentPrimary-base"]=i),e},applyColorMixToVariables(t,e){const n={};e!=null&&e["--apkt-tokens-theme-backgroundPrimary"]&&(n["--apkt-tokens-theme-backgroundPrimary"]="var(--apkt-tokens-theme-backgroundPrimary-base)"),e!=null&&e["--apkt-tokens-core-backgroundAccentPrimary"]&&(n["--apkt-tokens-core-backgroundAccentPrimary"]="var(--apkt-tokens-core-backgroundAccentPrimary-base)");const i=_T(t),o=i["color-mix"],l=i["color-mix-strength"];if(!l||l===0)return n;const h=Object.keys(e||{}).filter(s=>{const w=s.includes("-tokens-core-background")||s.includes("-tokens-core-text")||s.includes("-tokens-core-border")||s.includes("-tokens-core-foreground")||s.includes("-tokens-core-icon")||s.includes("-tokens-theme-background")||s.includes("-tokens-theme-text")||s.includes("-tokens-theme-border")||s.includes("-tokens-theme-foreground")||s.includes("-tokens-theme-icon")||s.includes("-tokens-theme-overlay"),x=s.includes("-borderRadius-")||s.includes("-spacing-")||s.includes("-textSize-")||s.includes("-fontFamily-")||s.includes("-fontWeight-")||s.includes("-typography-")||s.includes("-duration-")||s.includes("-ease-")||s.includes("-path-")||s.includes("-width-")||s.includes("-height-")||s.includes("-visual-size-")||s.includes("-modal-width")||s.includes("-cover");return w&&!x});return h.length===0||h.forEach(s=>{const w=(e==null?void 0:e[s])||"";s.endsWith("-base")||(s==="--apkt-tokens-theme-backgroundPrimary"||s==="--apkt-tokens-core-backgroundAccentPrimary"?n[s]=`color-mix(in srgb, ${o} ${l}%, var(${s}-base))`:w.includes("color-mix")||w.startsWith("#")||w.startsWith("rgb")?n[s]=`color-mix(in srgb, ${o} ${l}%, ${w})`:n[s]=`color-mix(in srgb, ${o} ${l}%, var(${s}-base, ${w}))`)}),n}},{cssVariablesVarPrefix:Ss}=Pf.createCSSVariables(_O);function Fn(t,...e){return rs(t,...e.map(n=>ld(typeof n=="function"?n(Ss):n)))}let x0,k0,gh,Ml,GA;const Af={"KHTeka-500-woff2":"https://fonts.reown.com/KHTeka-Medium.woff2","KHTeka-400-woff2":"https://fonts.reown.com/KHTeka-Regular.woff2","KHTeka-300-woff2":"https://fonts.reown.com/KHTeka-Light.woff2","KHTekaMono-400-woff2":"https://fonts.reown.com/KHTekaMono-Regular.woff2","KHTeka-500-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTeka-400-woff":"https://fonts.reown.com/KHTeka-Regular.woff","KHTeka-300-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTekaMono-400-woff":"https://fonts.reown.com/KHTekaMono-Regular.woff"};function qA(t,e="dark"){x0&&document.head.removeChild(x0),x0=document.createElement("style"),x0.textContent=Pf.createRootStyles(e,t),document.head.appendChild(x0)}function p7e(t,e="dark"){if(GA=t,k0=document.createElement("style"),gh=document.createElement("style"),Ml=document.createElement("style"),k0.textContent=q1(t).core.cssText,gh.textContent=q1(t).dark.cssText,Ml.textContent=q1(t).light.cssText,document.head.appendChild(k0),document.head.appendChild(gh),document.head.appendChild(Ml),qA(t,e),wO(e),!((t==null?void 0:t["--apkt-font-family"])||(t==null?void 0:t["--w3m-font-family"])))for(const[i,o]of Object.entries(Af)){const l=document.createElement("link");l.rel="preload",l.href=o,l.as="font",l.type=i.includes("woff2")?"font/woff2":"font/woff",l.crossOrigin="anonymous",document.head.appendChild(l)}wO(e)}function wO(t="dark"){gh&&Ml&&x0&&(t==="light"?(qA(GA,t),gh.removeAttribute("media"),Ml.media="enabled"):(qA(GA,t),Ml.removeAttribute("media"),gh.media="enabled"))}function n6e(t){var e,n,i;if(GA=t,k0&&gh&&Ml){k0.textContent=q1(t).core.cssText,gh.textContent=q1(t).dark.cssText,Ml.textContent=q1(t).light.cssText;const o=(t==null?void 0:t["--apkt-font-family"])||(t==null?void 0:t["--w3m-font-family"]);o&&(k0.textContent=(e=k0.textContent)==null?void 0:e.replace("font-family: KHTeka",`font-family: ${o}`),gh.textContent=(n=gh.textContent)==null?void 0:n.replace("font-family: KHTeka",`font-family: ${o}`),Ml.textContent=(i=Ml.textContent)==null?void 0:i.replace("font-family: KHTeka",`font-family: ${o}`))}if(x0){const o=(Ml==null?void 0:Ml.media)==="enabled"?"light":"dark";qA(t,o)}}function q1(t){const e=!!(t!=null&&t["--apkt-font-family"]||t!=null&&t["--w3m-font-family"]);return{core:rs`
      ${e?rs``:rs`
            @font-face {
              font-family: 'KHTeka';
              src:
                url(${ld(Af["KHTeka-400-woff2"])}) format('woff2'),
                url(${ld(Af["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
              font-display: swap;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${ld(Af["KHTeka-300-woff2"])}) format('woff2'),
                url(${ld(Af["KHTeka-300-woff"])}) format('woff');
              font-weight: 300;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTekaMono';
              src:
                url(${ld(Af["KHTekaMono-400-woff2"])}) format('woff2'),
                url(${ld(Af["KHTekaMono-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${ld(Af["KHTeka-400-woff2"])}) format('woff2'),
                url(${ld(Af["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }
          `}

      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --apkt-modal-width: 370px;

        --apkt-visual-size-inherit: inherit;
        --apkt-visual-size-sm: 40px;
        --apkt-visual-size-md: 55px;
        --apkt-visual-size-lg: 80px;

        --apkt-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --apkt-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --apkt-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --apkt-width-network-sm: 36px;
        --apkt-width-network-md: 48px;
        --apkt-width-network-lg: 86px;

        --apkt-duration-dynamic: 0ms;
        --apkt-height-network-sm: 40px;
        --apkt-height-network-md: 54px;
        --apkt-height-network-lg: 96px;
      }
    `,dark:rs`
      :root {
      }
    `,light:rs`
      :root {
      }
    `}}const Ei=rs`
  div,
  span,
  iframe,
  a,
  img,
  form,
  button,
  label,
  *::after,
  *::before {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    backface-visibility: hidden;
  }

  :host {
    font-family: var(--apkt-fontFamily-regular);
  }
`,Kr=rs`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;

    will-change: background-color, color, border, box-shadow, width, height, transform, opacity;
    outline: none;
    border: none;
    text-decoration: none;
    transition:
      background-color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      box-shadow var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      width var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      height var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      transform var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      opacity var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      scale var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border-radius var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2);
    will-change:
      background-color, color, border, box-shadow, width, height, transform, opacity, scale,
      border-radius;
  }

  a:active:not([disabled]),
  button:active:not([disabled]) {
    scale: 0.975;
    transform-origin: center;
  }

  button:disabled {
    cursor: default;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,wT=".",us={getSpacingStyles(t,e){if(Array.isArray(t))return t[e]?`var(--apkt-spacing-${t[e]})`:void 0;if(typeof t=="string")return`var(--apkt-spacing-${t})`},getFormattedDate(t){return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(t)},formatCurrency(t=0,e={}){const n=Number(t);return isNaN(n)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2,...e}).format(n)},getHostName(t){try{return new URL(t).hostname}catch{return""}},getTruncateString({string:t,charsStart:e,charsEnd:n,truncate:i}){return t.length<=e+n?t:i==="end"?`${t.substring(0,e)}...`:i==="start"?`...${t.substring(t.length-n)}`:`${t.substring(0,Math.floor(e))}...${t.substring(t.length-Math.floor(n))}`},generateAvatarColors(t){const n=t.toLowerCase().replace(/^0x/iu,"").replace(/[^a-f0-9]/gu,"").substring(0,6).padEnd(6,"0"),i=this.hexToRgb(n),o=getComputedStyle(document.documentElement).getPropertyValue("--w3m-border-radius-master"),h=100-3*Number(o==null?void 0:o.replace("px","")),s=`${h}% ${h}% at 65% 40%`,w=[];for(let x=0;x<5;x+=1){const A=this.tintColor(i,.15*x);w.push(`rgb(${A[0]}, ${A[1]}, ${A[2]})`)}return`
    --local-color-1: ${w[0]};
    --local-color-2: ${w[1]};
    --local-color-3: ${w[2]};
    --local-color-4: ${w[3]};
    --local-color-5: ${w[4]};
    --local-radial-circle: ${s}
   `},hexToRgb(t){const e=parseInt(t,16),n=e>>16&255,i=e>>8&255,o=e&255;return[n,i,o]},tintColor(t,e){const[n,i,o]=t,l=Math.round(n+(255-n)*e),h=Math.round(i+(255-i)*e),s=Math.round(o+(255-o)*e);return[l,h,s]},isNumber(t){return{number:/^[0-9]+$/u}.number.test(t)},getColorTheme(t){var e;return t||(typeof window<"u"&&window.matchMedia&&typeof window.matchMedia=="function"?(e=window.matchMedia("(prefers-color-scheme: dark)"))!=null&&e.matches?"dark":"light":"dark")},splitBalance(t){const e=t.split(".");return e.length===2?[e[0],e[1]]:["0","00"]},roundNumber(t,e,n){return t.toString().length>=e?Number(t).toFixed(n):t},cssDurationToNumber(t){return t.endsWith("s")?Number(t.replace("s",""))*1e3:t.endsWith("ms")?Number(t.replace("ms","")):0},maskInput({value:t,decimals:e,integers:n}){if(t=t.replace(",","."),t===wT)return`0${wT}`;const[i="",o]=t.split(wT).map(A=>A.replace(/[^0-9]/gu,"")),l=n?i.substring(0,n):i,h=l.length===2?String(Number(l)):l,s=typeof e=="number"?o==null?void 0:o.substring(0,e):o,w=typeof e!="number"||e>0;return(typeof s=="string"&&w?[h,s].join(wT):h)??""},capitalize(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}},i6e=3,bT=.1,r6e=["receive","deposit","borrow","claim"],s6e=["withdraw","repay","burn"],R1={getTransactionGroupTitle(t,e){const n=GR.getYear(),i=GR.getMonthNameByIndex(e);return t===n?i:`${i} ${t}`},getTransactionImages(t){const[e]=t;return(t==null?void 0:t.length)>1?t.map(i=>this.getTransactionImage(i)):[this.getTransactionImage(e)]},getTransactionImage(t){return{type:R1.getTransactionTransferTokenType(t),url:R1.getTransactionImageURL(t)}},getTransactionImageURL(t){var o,l,h,s,w;let e;const n=!!(t!=null&&t.nft_info),i=!!(t!=null&&t.fungible_info);return t&&n?e=(h=(l=(o=t==null?void 0:t.nft_info)==null?void 0:o.content)==null?void 0:l.preview)==null?void 0:h.url:t&&i&&(e=(w=(s=t==null?void 0:t.fungible_info)==null?void 0:s.icon)==null?void 0:w.url),e},getTransactionTransferTokenType(t){if(t!=null&&t.fungible_info)return"FUNGIBLE";if(t!=null&&t.nft_info)return"NFT"},getTransactionDescriptions(t,e){var D;const n=(D=t==null?void 0:t.metadata)==null?void 0:D.operationType,i=e||(t==null?void 0:t.transfers),o=i&&i.length>0,l=i&&i.length>1,h=o&&i.every(M=>!!(M!=null&&M.fungible_info)),[s,w]=i||[];let x=this.getTransferDescription(s),A=this.getTransferDescription(w);if(!o)return(n==="send"||n==="receive")&&h?(x=us.getTruncateString({string:t==null?void 0:t.metadata.sentFrom,charsStart:4,charsEnd:6,truncate:"middle"}),A=us.getTruncateString({string:t==null?void 0:t.metadata.sentTo,charsStart:4,charsEnd:6,truncate:"middle"}),[x,A]):[t.metadata.status];if(l)return i==null?void 0:i.map(M=>this.getTransferDescription(M));let P="";return r6e.includes(n)?P="+":s6e.includes(n)&&(P="-"),x=P.concat(x),[x]},getTransferDescription(t){var n;let e="";return t&&(t!=null&&t.nft_info?e=((n=t==null?void 0:t.nft_info)==null?void 0:n.name)||"-":t!=null&&t.fungible_info&&(e=this.getFungibleTransferDescription(t)||"-")),e},getFungibleTransferDescription(t){var i;return t?[this.getQuantityFixedValue(t==null?void 0:t.quantity.numeric),(i=t==null?void 0:t.fungible_info)==null?void 0:i.symbol].join(" ").trim():null},mergeTransfers(t){if((t==null?void 0:t.length)<=1)return t;const n=this.filterGasFeeTransfers(t).reduce((o,l)=>{var w;const h=(w=l==null?void 0:l.fungible_info)==null?void 0:w.name,s=o.find(({fungible_info:x,direction:A})=>h&&h===(x==null?void 0:x.name)&&A===l.direction);if(s){const x=Number(s.quantity.numeric)+Number(l.quantity.numeric);s.quantity.numeric=x.toString(),s.value=(s.value||0)+(l.value||0)}else o.push(l);return o},[]);let i=n;return n.length>2&&(i=n.sort((o,l)=>(l.value||0)-(o.value||0)).slice(0,2)),i=i.sort((o,l)=>o.direction==="out"&&l.direction==="in"?-1:o.direction==="in"&&l.direction==="out"?1:0),i},filterGasFeeTransfers(t){const e=t==null?void 0:t.reduce((i,o)=>{var h;const l=(h=o==null?void 0:o.fungible_info)==null?void 0:h.name;return l&&(i[l]||(i[l]=[]),i[l].push(o)),i},{}),n=[];return Object.values(e??{}).forEach(i=>{if(i.length===1){const o=i[0];o&&n.push(o)}else{const o=i.filter(h=>h.direction==="in"),l=i.filter(h=>h.direction==="out");if(o.length===1&&l.length===1){const h=o[0],s=l[0];let w=!1;if(h&&s){const x=Number(h.quantity.numeric),A=Number(s.quantity.numeric);A<x*bT?(n.push(h),w=!0):x<A*bT&&(n.push(s),w=!0)}w||n.push(...i)}else{const h=this.filterGasFeesFromTokenGroup(i);n.push(...h)}}}),t==null||t.forEach(i=>{var o;(o=i==null?void 0:i.fungible_info)!=null&&o.name||n.push(i)}),n},filterGasFeesFromTokenGroup(t){if(t.length<=1)return t;const e=t==null?void 0:t.map(s=>Number(s.quantity.numeric)),n=Math.max(...e),i=Math.min(...e),o=.01;if(i<n*o)return t==null?void 0:t.filter(w=>Number(w.quantity.numeric)>=n*o);const l=t==null?void 0:t.filter(s=>s.direction==="in"),h=t==null?void 0:t.filter(s=>s.direction==="out");if(l.length===1&&h.length===1){const s=l[0],w=h[0];if(s&&w){const x=Number(s.quantity.numeric),A=Number(w.quantity.numeric);if(A<x*bT)return[s];if(x<A*bT)return[w]}}return t},getQuantityFixedValue(t){return t?parseFloat(t).toFixed(i6e):null}};function o6e(t,e){const{kind:n,elements:i}=e;return{kind:n,elements:i,finisher(o){customElements.get(t)||customElements.define(t,o)}}}function a6e(t,e){return customElements.get(t)||customElements.define(t,e),e}function nn(t){return function(n){return typeof n=="function"?a6e(t,n):o6e(t,n)}}const vT={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603};class c6e extends VK{async setUniversalProvider(e){if(!this.namespace)throw new Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new WK({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect(),this.emit("disconnect")}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}return{connections:[]}}syncConnections(){return Promise.resolve()}async writeSolanaTransaction(){return Promise.resolve({hash:""})}async getAccounts({namespace:e}){var o,l,h,s;const n=this.provider,i=((s=(h=(l=(o=n==null?void 0:n.session)==null?void 0:o.namespaces)==null?void 0:l[e])==null?void 0:h.accounts)==null?void 0:s.map(w=>{const[,,x]=w.split(":");return x}).filter((w,x,A)=>A.indexOf(w)===x))||[];return Promise.resolve({accounts:i.map(w=>Ft.createAccount(e,w,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var h,s,w,x,A;if(!(e.caipNetwork&&hi.BALANCE_SUPPORTED_CHAINS.includes((h=e.caipNetwork)==null?void 0:h.chainNamespace))||(s=e.caipNetwork)!=null&&s.testnet)return{balance:"0.00",symbol:((w=e.caipNetwork)==null?void 0:w.nativeCurrency.symbol)||""};const i=ue.getAccountData();if(i!=null&&i.balanceLoading&&e.chainId===((x=ue.state.activeCaipNetwork)==null?void 0:x.id))return{balance:(i==null?void 0:i.balance)||"0.00",symbol:(i==null?void 0:i.balanceSymbol)||""};const l=(await ue.fetchTokenBalance()).find(P=>{var D,M;return P.chainId===`${(D=e.caipNetwork)==null?void 0:D.chainNamespace}:${e.chainId}`&&P.symbol===((M=e.caipNetwork)==null?void 0:M.nativeCurrency.symbol)});return{balance:(l==null?void 0:l.quantity.numeric)||"0.00",symbol:(l==null?void 0:l.symbol)||((A=e.caipNetwork)==null?void 0:A.nativeCurrency.symbol)||""}}async signMessage(e){var h,s,w;const{provider:n,message:i,address:o}=e;if(!n)throw new Error("UniversalAdapter:signMessage - provider is undefined");let l="";return((h=ue.state.activeCaipNetwork)==null?void 0:h.chainNamespace)===at.CHAIN.SOLANA?l=(await n.request({method:"solana_signMessage",params:{message:Lw.encode(new TextEncoder().encode(i)),pubkey:o}},(s=ue.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)).signature:l=await n.request({method:"personal_sign",params:[i,o]},(w=ue.state.activeCaipNetwork)==null?void 0:w.caipNetworkId),{signature:l}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var o,l,h,s,w,x;const{caipNetwork:n}=e,i=this.getWalletConnectConnector();if(n.chainNamespace===at.CHAIN.EVM)try{await((o=i.provider)==null?void 0:o.request({method:"wallet_switchEthereumChain",params:[{chainId:K0(n.id)}]}))}catch(A){if(A.code===vT.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||A.code===vT.ERROR_INVALID_CHAIN_ID||A.code===vT.ERROR_CODE_DEFAULT||((h=(l=A==null?void 0:A.data)==null?void 0:l.originalError)==null?void 0:h.code)===vT.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((x=i.provider)==null?void 0:x.request({method:"wallet_addEthereumChain",params:[{chainId:K0(n.id),rpcUrls:[(s=n==null?void 0:n.rpcUrls.chainDefault)==null?void 0:s.http],chainName:n.name,nativeCurrency:n.nativeCurrency,blockExplorerUrls:[(w=n.blockExplorers)==null?void 0:w.default.url]}]}))}catch{throw new Error("Chain is not supported")}}i.provider.setDefaultChain(n.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(i=>i.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}const l6e=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture","payWithExchange","payments","reownAuthentication","headless"],xT={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?hi.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(n=>n!=="email"):!1},processFallback:t=>t===void 0?hi.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?hi.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?hi.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?hi.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?hi.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?hi.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?hi.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?hi.DEFAULT_REMOTE_FEATURES.reownBranding:!!t},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>t.isEnabled&&(t.config??[]),processFallback:t=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>hi.DEFAULT_REMOTE_FEATURES.multiWallet},payWithExchange:{apiFeatureName:"fund_from_exchange",localFeatureName:"payWithExchange",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>hi.DEFAULT_REMOTE_FEATURES.payWithExchange},payments:{apiFeatureName:"payments",localFeatureName:"payments",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>hi.DEFAULT_REMOTE_FEATURES.payments},reownAuthentication:{apiFeatureName:"reown_authentication",localFeatureName:"reownAuthentication",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>typeof t>"u"?hi.DEFAULT_REMOTE_FEATURES.reownAuthentication:!!t},headless:{apiFeatureName:"headless",localFeatureName:"headless",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>hi.DEFAULT_REMOTE_FEATURES.headless}},u6e={localSettingsOverridden:new Set,getApiConfig(t,e){return e==null?void 0:e.find(n=>n.id===t)},addWarning(t,e){if(t!==void 0){const n=xT[e],i=n.isLegacy?`"features.${n.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(i)}},processFeature(t,e,n,i,o){const l=xT[t],h=e[l.localFeatureName];if(o&&!l.isAvailableOnBasic)return!1;if(i){const s=this.getApiConfig(l.apiFeatureName,n);return(s==null?void 0:s.config)===null?this.processFallbackFeature(t,h):s!=null&&s.config?(h!==void 0&&this.addWarning(h,t),this.processApiFeature(t,s)):!1}return this.processFallbackFeature(t,h)},processApiFeature(t,e){return xT[t].processApi(e)},processFallbackFeature(t,e){return xT[t].processFallback(e)},async fetchRemoteFeatures(t){const e=t.basic??!1,n=t.features||{};this.localSettingsOverridden.clear();let i=null,o=!1;try{i=await fn.fetchProjectConfig(),o=i!=null}catch(h){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",h)}const l=o&&!e?hi.DEFAULT_REMOTE_FEATURES:hi.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const h of l6e){const s=this.processFeature(h,n,i,o,e);Object.assign(l,{[h]:s})}}catch(h){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",h),hi.DEFAULT_REMOTE_FEATURES}if(o&&this.localSettingsOverridden.size>0){const h=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;Ts.open({debugMessage:vs.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(h)},"warning")}return l}};class d6e{constructor(e){this.chainNamespaces=[],this.features={},this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(n,i)=>{var o,l,h;if(n){const s=(o=ue.getCaipNetworks(n))==null?void 0:o.find(A=>A.id===i);if(s)return s;const w=(l=ue.getNetworkData(n))==null?void 0:l.caipNetwork;return w||((h=ue.getRequestedCaipNetworks(n).filter(A=>A.chainNamespace===n))==null?void 0:h[0])}return ue.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const n=this.getCaipNetwork();if(n)return n.id},this.getCaipNetworks=n=>ue.getCaipNetworks(n),this.getActiveChainNamespace=()=>ue.state.activeChain,this.setRequestedCaipNetworks=(n,i)=>{ue.setRequestedCaipNetworks(n,i)},this.getApprovedCaipNetworkIds=()=>ue.getAllApprovedCaipNetworkIds(),this.getCaipAddress=n=>{var i,o;return ue.state.activeChain===n||!n?ue.state.activeCaipAddress:(o=(i=ue.state.chains.get(n))==null?void 0:i.accountState)==null?void 0:o.caipAddress},this.setClientId=n=>{Ci.setClientId(n)},this.getProvider=n=>Qr.getProvider(n),this.getProviderType=n=>Qr.getProviderId(n),this.getPreferredAccountType=n=>Fs(n),this.setCaipAddress=(n,i,o=!1)=>{ue.setAccountProp("caipAddress",n,i,o),ue.setAccountProp("address",Ft.getPlainAddress(n),i,o)},this.setBalance=(n,i,o)=>{ue.setAccountProp("balance",n,o),ue.setAccountProp("balanceSymbol",i,o)},this.setProfileName=(n,i)=>{ue.setAccountProp("profileName",n,i)},this.setProfileImage=(n,i)=>{ue.setAccountProp("profileImage",n,i)},this.setUser=(n,i)=>{ue.setAccountProp("user",n,i)},this.resetAccount=n=>{ue.resetAccount(n)},this.setCaipNetwork=n=>{ue.setActiveCaipNetwork(n)},this.setCaipNetworkOfNamespace=(n,i)=>{ue.setChainNetworkData(i,{caipNetwork:n})},this.setStatus=(n,i)=>{ue.setAccountProp("status",n,i),Nt.isConnected()?Jt.setConnectionStatus("connected"):Jt.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=n=>{var i;return(i=ue.getAccountData(n))==null?void 0:i.address},this.setConnectors=n=>{const i=[...Nt.state.allConnectors,...n];Nt.setConnectors(i)},this.setConnections=(n,i)=>{Jt.setConnections(n,i),Ht.setConnections(n,i)},this.fetchIdentity=n=>Ci.fetchIdentity(n),this.getReownName=n=>Gx.getNamesForAddress(n),this.getConnectors=()=>Nt.getConnectors(),this.getConnectorImage=n=>Ur.getConnectorImage(n),this.getConnections=n=>this.remoteFeatures.multiWallet?Bl.getConnectionsData(n).connections:(Ts.open(at.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=n=>this.remoteFeatures.multiWallet?Bl.getConnectionsData(n).recentConnections:(Ts.open(at.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async n=>{if(!this.remoteFeatures.multiWallet){Ts.open(at.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}await Ht.switchConnection(n)},this.deleteConnection=n=>{if(!this.remoteFeatures.multiWallet){Ts.open(at.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}Jt.deleteAddressFromConnection(n),Ht.syncStorageConnections()},this.setConnectedWalletInfo=(n,i)=>{const o=Qr.getProviderId(i),l=n?{...n,type:o}:void 0;ue.setAccountProp("connectedWalletInfo",l,i)},this.getIsConnectedState=()=>!!ue.state.activeCaipAddress,this.addAddressLabel=(n,i,o)=>{var h;const l=((h=ue.getAccountData(o))==null?void 0:h.addressLabels)||{};ue.setAccountProp("addressLabels",{...l,[n]:i},o)},this.removeAddressLabel=(n,i)=>{var l;const o=((l=ue.getAccountData(i))==null?void 0:l.addressLabels)||{};ue.setAccountProp("addressLabels",{...o,[n]:void 0},i)},this.getAddress=n=>{var o;const i=n||ue.state.activeChain;return(o=ue.getAccountData(i))==null?void 0:o.address},this.resetNetwork=n=>{ue.resetNetwork(n)},this.addConnector=n=>{Nt.addConnector(n)},this.resetWcConnection=()=>{Ht.resetWcConnection()},this.setAddressExplorerUrl=(n,i)=>{ue.setAccountProp("addressExplorerUrl",n,i)},this.setSmartAccountDeployed=(n,i)=>{ue.setAccountProp("smartAccountDeployed",n,i)},this.setPreferredAccountType=(n,i)=>{ue.setAccountProp("preferredAccountType",n,i)},this.setEIP6963Enabled=n=>{ut.setEIP6963Enabled(n)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,n){const i=e==null?void 0:e.map(l=>l.namespace).filter(l=>!!l);if(i!=null&&i.length)return[...new Set(i)];const o=n==null?void 0:n.map(l=>l.chainNamespace);return[...new Set(o)]}async initialize(e){var n,i,o,l,h,s;if(this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),(n=e.features)!=null&&n.headless&&!ia.hasInjectedConnectors()&&fn.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1,fetchRecommendedWallets:!0}),ut.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),!e.basic&&!e.manualWCControl&&(this.remoteFeatures=await u6e.fetchRemoteFeatures(e)),await fn.fetchUsage(),ut.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&T8.setOnrampProviders(this.remoteFeatures.onramp),((i=ut.state.remoteFeatures)!=null&&i.email||Array.isArray((o=ut.state.remoteFeatures)==null?void 0:o.socials)&&((l=ut.state.remoteFeatures)==null?void 0:l.socials.length)>0)&&await this.checkAllowedOrigins(),(h=ut.state.features)!=null&&h.reownAuthentication||(s=ut.state.remoteFeatures)!=null&&s.reownAuthentication){const{ReownAuthentication:w}=await Un(async()=>{const{ReownAuthentication:A}=await import("./features-CUu0URF-.js");return{ReownAuthentication:A}},__vite__mapDeps([9,2,3,4,5])),x=ut.state.siwx;x instanceof w||(x&&console.warn("ReownAuthentication option is enabled, SIWX configuration will be overridden."),ut.setSIWX(new w))}}async openSend(e){var l;const n=e.namespace||ue.state.activeChain,i=this.getCaipAddress(n),o=(l=this.getCaipNetwork(n))==null?void 0:l.id;if(!i)throw new Error("openSend: caipAddress not found");if((o==null?void 0:o.toString())!==e.chainId.toString()){const h=ue.getCaipNetworkById(e.chainId,n);if(!h)throw new Error(`openSend: caipNetwork with chainId ${e.chainId} not found`);await this.switchNetwork(h,{throwOnFailure:!0})}try{const h=ZK.getTokenSymbolByAddress(e.assetAddress);h&&await fn.fetchTokenImages([h])}catch{}return await gi.open({view:"WalletSend",data:{send:e}}),new Promise((h,s)=>{const w=Xi.subscribeKey("hash",P=>{P&&(A(),h({hash:P}))}),x=gi.subscribe(P=>{P.open||(A(),s(new Error("Modal closed")))}),A=this.createCleanupHandler([w,x])})}toModalOptions(){function e(i){return(i==null?void 0:i.view)==="Swap"}function n(i){return(i==null?void 0:i.view)==="WalletSend"}return{isSwap:e,isSend:n}}async checkAllowedOrigins(){try{const e=await fn.fetchAllowedOrigins();if(!Ft.isClient())return;const n=window.location.origin;Uf.isOriginAllowed(n,e,at.DEFAULT_ALLOWED_ANCESTORS)||Ts.open(vs.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(e){if(!(e instanceof Error))return;switch(e.message){case"RATE_LIMITED":Ts.open(vs.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{const n=e.cause instanceof Error?e.cause:e;Ts.open({displayMessage:vs.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:vs.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(n.message)},"error");break}}}}createCleanupHandler(e){return()=>{e.forEach(n=>{try{n()}catch{}})}}sendInitializeEvent(e){var i;const{...n}=e;delete n.adapters,delete n.universalProvider,Sn.sendEvent({type:"track",event:"INITIALIZE",properties:{...n,networks:e.networks.map(o=>o.id),siweConfig:{options:((i=e.siweConfig)==null?void 0:i.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initAdapterController(){xG.initialize(this.chainAdapters)}initializeThemeController(e){e.themeMode&&ra.setThemeMode(e.themeMode),e.themeVariables&&ra.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient)throw new Error("ConnectionControllerClient must be set");ue.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient});const n=this.getDefaultNetwork();n&&ue.setActiveCaipNetwork(n)}initializeConnectionController(e){Ht.initialize(e.adapters??[]),Ht.setWcBasic(e.basic??!1)}initializeConnectorController(){Nt.initialize(this.chainNamespaces)}initializeProjectSettings(e){ut.setProjectId(e.projectId),ut.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){var o;ut.setDebug(e.debug!==!1),ut.setEnableWalletGuide(e.enableWalletGuide!==!1),ut.setEnableWallets(e.enableWallets!==!1),ut.setEIP6963Enabled(e.enableEIP6963!==!1),ut.setEnableCoinbase(e.enableCoinbase!==!1),ut.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),ut.setEnableReconnect(e.enableReconnect!==!1),ut.setEnableMobileFullScreen(e.enableMobileFullScreen===!0),ut.setCoinbasePreference(e.coinbasePreference),ut.setEnableAuthLogger(e.enableAuthLogger!==!1),ut.setCustomRpcUrls(e.customRpcUrls),ut.setEnableEmbedded(e.enableEmbedded),ut.setAllWallets(e.allWallets),ut.setIncludeWalletIds(e.includeWalletIds),ut.setExcludeWalletIds(e.excludeWalletIds),ut.setFeaturedWalletIds(e.featuredWalletIds),ut.setTokens(e.tokens),ut.setTermsConditionsUrl(e.termsConditionsUrl),ut.setPrivacyPolicyUrl(e.privacyPolicyUrl),ut.setCustomWallets(e.customWallets),ut.setFeatures(e.features),ut.setAllowUnsupportedChain(e.allowUnsupportedChain),ut.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),ut.setPreferUniversalLinks(e.experimental_preferUniversalLinks),ut.setDefaultAccountTypes(e.defaultAccountTypes);const n=this.getDefaultMetaData();if(!e.metadata&&n&&(e.metadata=n),ut.setMetadata(e.metadata),ut.setDisableAppend(e.disableAppend),ut.setEnableEmbedded(e.enableEmbedded),ut.setSIWX(e.siwx),this.features=ut.state.features??{},!e.projectId){Ts.open(vs.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(((o=e.adapters)==null?void 0:o.find(l=>l.namespace===at.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");ut.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,n,i,o;return Ft.isClient()?{name:((n=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:n.textContent)||"",description:((i=document.querySelector('meta[property="og:description"]'))==null?void 0:i.content)||"",url:window.location.origin,icons:[((o=document.querySelector('link[rel~="icon"]'))==null?void 0:o.href)||""]}:null}setUnsupportedNetwork(e){const n=this.getActiveChainNamespace();if(n){const i=hd.getUnsupportedNetwork(`${n}:${e}`);ue.setActiveCaipNetwork(i)}}getDefaultNetwork(){return hd.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,n){return hd.extendCaipNetwork(e,{customNetworkImageUrls:n.chainImages,projectId:n.projectId})}extendCaipNetworks(e){return hd.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const n=e.networks.find(o=>{var l;return o.id===((l=e.defaultNetwork)==null?void 0:l.id)});return n?hd.extendCaipNetwork(n,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectConnector(e,n){var i,o;try{this.setLoading(!0,e);let l={connections:[]};const h=this.getAdapter(e);return(((o=(i=ue.state.chains.get(e))==null?void 0:i.accountState)==null?void 0:o.caipAddress)||!ut.state.enableReconnect)&&(h!=null&&h.disconnect)&&(l=await h.disconnect({id:n})),this.setLoading(!1,e),l}catch(l){throw this.setLoading(!1,e),new Error(`Failed to disconnect chains: ${l.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var x;const e=ue.state.activeChain,n=this.getAdapter(e),i=(x=this.getCaipNetwork(e))==null?void 0:x.id,o=Ht.getConnections(e),l=this.remoteFeatures.multiWallet,h=o.length>0;if(!n)throw new Error("Adapter not found");const s=await n.connectWalletConnect(i);(!h||!l)&&this.close(),this.setClientId((s==null?void 0:s.clientId)||null),Jt.setConnectedNamespaces([...ue.state.chains.keys()]),await this.syncWalletConnectAccount(),await Xa.initializeIfEnabled()},connectExternal:async e=>{const n=await this.onConnectExternal(e);return await this.connectInactiveNamespaces(e,n),n?{address:n.address}:void 0},reconnectExternal:async({id:e,info:n,type:i,provider:o})=>{var s;const l=ue.state.activeChain,h=this.getAdapter(l);if(!l)throw new Error("reconnectExternal: namespace not found");if(!h)throw new Error("reconnectExternal: adapter not found");h!=null&&h.reconnect&&(await(h==null?void 0:h.reconnect({id:e,info:n,type:i,provider:o,chainId:(s=this.getCaipNetwork())==null?void 0:s.id})),Jt.addConnectedNamespace(l),this.syncConnectedWalletInfo(l))},disconnectConnector:async e=>{await this.disconnectConnector(e.namespace,e.id)},disconnect:async e=>{var x;const{id:n,chainNamespace:i,initialDisconnect:o}=e||{},l=i||ue.state.activeChain,h=Nt.getConnectorId(l),s=n===at.CONNECTOR_ID.AUTH||h===at.CONNECTOR_ID.AUTH,w=n===at.CONNECTOR_ID.WALLET_CONNECT||h===at.CONNECTOR_ID.WALLET_CONNECT;try{const A=Array.from(ue.state.chains.keys());let P=i?[i]:A;(w||s)&&(P=A);const D=P.map(async U=>{const G=Nt.getConnectorId(U),ne=n||G,oe=await this.disconnectConnector(U,ne);oe&&(s&&Jt.deleteConnectedSocialProvider(),oe.connections.forEach(Q=>{Jt.addDisconnectedConnectorId(Q.connectorId,U)})),o&&this.onDisconnectNamespace({chainNamespace:U,closeModal:!1})}),M=await Promise.allSettled(D);Xi.resetSend(),Ht.resetWcConnection(),(x=Xa.getSIWX())!=null&&x.signOutOnDisconnect&&await Xa.clearSessions(),Nt.setFilterByNamespace(void 0),Ht.syncStorageConnections();const z=M.filter(U=>U.status==="rejected");if(z.length>0)throw new Error(z.map(U=>U.reason.message).join(", "));Sn.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:i||"all"}})}catch(A){throw new Error(`Failed to disconnect chains: ${A.message}`)}},checkInstalled:e=>e?e.some(n=>{var i;return!!((i=window.ethereum)!=null&&i[String(n)])}):!!window.ethereum,signMessage:async e=>{const n=ue.state.activeChain,i=this.getAdapter(ue.state.activeChain);if(!n)throw new Error("signMessage: namespace not found");if(!i)throw new Error("signMessage: adapter not found");const o=this.getAddress(n);if(!o)throw new Error("signMessage: address not found");const l=await(i==null?void 0:i.signMessage({message:e,address:o,provider:Qr.getProvider(n)}));return(l==null?void 0:l.signature)||""},sendTransaction:async e=>{const n=e.chainNamespace;if(!n)throw new Error("sendTransaction: namespace not found");if(hi.SEND_SUPPORTED_NAMESPACES.includes(n)){const i=this.getAdapter(n);if(!i)throw new Error("sendTransaction: adapter not found");const o=Qr.getProvider(n),l=await(i==null?void 0:i.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:o}));return(l==null?void 0:l.hash)||""}return""},estimateGas:async e=>{const n=e.chainNamespace;if(n===at.CHAIN.EVM){const i=this.getAdapter(n);if(!i)throw new Error("estimateGas: adapter is required but got undefined");const o=Qr.getProvider(n),l=this.getCaipNetwork();if(!l)throw new Error("estimateGas: caipNetwork is required but got undefined");const h=await(i==null?void 0:i.estimateGas({...e,provider:o,caipNetwork:l}));return(h==null?void 0:h.gas)||0n}return 0n},getEnsAvatar:async()=>{var o;const e=ue.state.activeChain;if(!e)throw new Error("getEnsAvatar: namespace is required but got undefined");const n=this.getAddress(e);if(!n)throw new Error("getEnsAvatar: address not found");await this.syncIdentity({address:n,chainId:Number((o=this.getCaipNetwork())==null?void 0:o.id),chainNamespace:e});const i=ue.getAccountData();return(i==null?void 0:i.profileImage)||!1},getEnsAddress:async e=>await Uf.resolveReownName(e),writeContract:async e=>{const n=ue.state.activeChain,i=this.getAdapter(n);if(!n)throw new Error("writeContract: namespace is required but got undefined");if(!i)throw new Error("writeContract: adapter is required but got undefined");const o=this.getCaipNetwork(),l=this.getCaipAddress(),h=Qr.getProvider(n);if(!o||!l)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const s=await(i==null?void 0:i.writeContract({...e,caipNetwork:o,provider:h,caipAddress:l}));return s==null?void 0:s.hash},writeSolanaTransaction:async e=>{const n=ue.state.activeChain,i=this.getAdapter(n);if(!n)throw new Error("writeContract: namespace is required but got undefined");if(!i)throw new Error("writeContract: adapter is required but got undefined");const o=this.getCaipNetwork(),l=this.getCaipAddress(),h=Qr.getProvider(n);if(!o||!l)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const s=await(i==null?void 0:i.writeSolanaTransaction({...e,caipNetwork:o,provider:h,caipAddress:l}));return s==null?void 0:s.hash},parseUnits:(e,n)=>{const i=this.getAdapter(ue.state.activeChain);if(!i)throw new Error("parseUnits: adapter is required but got undefined");return(i==null?void 0:i.parseUnits({value:e,decimals:n}))??0n},formatUnits:(e,n)=>{const i=this.getAdapter(ue.state.activeChain);if(!i)throw new Error("formatUnits: adapter is required but got undefined");return(i==null?void 0:i.formatUnits({value:e,decimals:n}))??"0"},getCapabilities:async e=>{const n=this.getAdapter(ue.state.activeChain);if(!n)throw new Error("getCapabilities: adapter is required but got undefined");return await(n==null?void 0:n.getCapabilities(e))},grantPermissions:async e=>{const n=this.getAdapter(ue.state.activeChain);if(!n)throw new Error("grantPermissions: adapter is required but got undefined");return await(n==null?void 0:n.grantPermissions(e))},revokePermissions:async e=>{const n=this.getAdapter(ue.state.activeChain);if(!n)throw new Error("revokePermissions: adapter is required but got undefined");return n!=null&&n.revokePermissions?await n.revokePermissions(e):"0x"},walletGetAssets:async e=>{const n=this.getAdapter(ue.state.activeChain);if(!n)throw new Error("walletGetAssets: adapter is required but got undefined");return await(n==null?void 0:n.walletGetAssets(e))??{}},updateBalance:e=>{const n=this.getAddress(e),i=this.getCaipNetwork(e);!i||!n||this.updateNativeBalance(n,i==null?void 0:i.id,e)}},Ht.setClient(this.connectionControllerClient)}async onConnectExternal(e){var x,A,P,D,M,z,U,G;const n=ue.state.activeChain,i=e.chain||n,o=this.getAdapter(i);let l=!0;if(e.type===Ya.CONNECTOR_TYPE_AUTH&&at.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(Q=>Nt.getConnectorId(Q)===at.CONNECTOR_ID.AUTH)&&e.chain!==n&&(l=!1),e.chain&&e.chain!==n&&!e.caipNetwork){const ne=this.getCaipNetworks().find(oe=>oe.chainNamespace===e.chain);ne&&l&&this.setCaipNetwork(ne)}if(!i)throw new Error("connectExternal: namespace not found");if(!o)throw new Error("connectExternal: adapter not found");const h=this.getCaipNetwork(i),s=e.caipNetwork||h,w=await o.connect({id:e.id,address:e.address,info:e.info,type:e.type,provider:e.provider,socialUri:e.socialUri,chainId:((x=e.caipNetwork)==null?void 0:x.id)||(h==null?void 0:h.id),rpcUrl:((M=(D=(P=(A=e.caipNetwork)==null?void 0:A.rpcUrls)==null?void 0:P.default)==null?void 0:D.http)==null?void 0:M[0])||((G=(U=(z=h==null?void 0:h.rpcUrls)==null?void 0:z.default)==null?void 0:U.http)==null?void 0:G[0])});if(w)return Jt.addConnectedNamespace(i),this.syncProvider({...w,chainNamespace:i}),this.setStatus("connected",i),this.syncConnectedWalletInfo(i),Jt.removeDisconnectedConnectorId(e.id,i),{address:w.address,connectedCaipNetwork:s}}async connectInactiveNamespaces(e,n){var s;const i=e.type===Ya.CONNECTOR_TYPE_AUTH,o=no.getOtherAuthNamespaces((s=n==null?void 0:n.connectedCaipNetwork)==null?void 0:s.chainNamespace),l=ue.state.activeCaipNetwork,h=this.getAdapter(l==null?void 0:l.chainNamespace);i&&(await Promise.all(o.map(async w=>{var x,A,P;try{const D=Qr.getProvider(w),M=this.getCaipNetwork(w),z=this.getAdapter(w);await(z==null?void 0:z.connect({...e,provider:D,socialUri:void 0,chainId:M==null?void 0:M.id,rpcUrl:(P=(A=(x=M==null?void 0:M.rpcUrls)==null?void 0:x.default)==null?void 0:A.http)==null?void 0:P[0]}))&&(Jt.addConnectedNamespace(w),Jt.removeDisconnectedConnectorId(e.id,w),this.setStatus("connected",w),this.syncConnectedWalletInfo(w))}catch(D){Ts.warn(vs.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.displayMessage,vs.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.debugMessage(w,D instanceof Error?D.message:void 0),vs.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.code)}})),l&&await(h==null?void 0:h.switchNetwork({caipNetwork:l})))}getApprovedCaipNetworksData(){var n,i,o,l,h;if(Qr.getProviderId(ue.state.activeChain)===Ya.CONNECTOR_TYPE_WALLET_CONNECT){const s=(i=(n=this.universalProvider)==null?void 0:n.session)==null?void 0:i.namespaces;return{supportsAllNetworks:((h=(l=(o=this.universalProvider)==null?void 0:o.session)==null?void 0:l.peer)==null?void 0:h.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(s)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){const n=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const o=Qr.getProviderId(n);if(e.chainNamespace===ue.state.activeChain){const l=this.getAdapter(n);await(l==null?void 0:l.switchNetwork({caipNetwork:e}))}else if(this.setCaipNetwork(e),o===Ya.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const l=this.getAddressByChainNamespace(n);l&&this.syncAccount({address:l,chainId:e.id,chainNamespace:n})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(n=>{const i=n.chains||[],o=n.accounts.map(l=>{const{chainId:h,chainNamespace:s}=No.parseCaipAddress(l);return`${s}:${h}`});return Array.from(new Set([...i,...o]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((n,i)=>{var l,h;const o=e==null?void 0:e.find(s=>s.namespace===i);return o?(o.construct({namespace:i,projectId:(l=this.options)==null?void 0:l.projectId,networks:(h=this.caipNetworks)==null?void 0:h.filter(({chainNamespace:s})=>s===i)}),n[i]=o):n[i]=new c6e({namespace:i,networks:this.getCaipNetworks()}),n},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e);const n=this.getAdapter(e);if(!n)throw new Error("adapter not found");await n.syncConnectors(),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)})),this.initAdapterController()}onConnectors(e){const n=this.getAdapter(e);n==null||n.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const n=this.getAdapter(e);if(!n)return;const i=Jt.getConnectionStatus();ut.state.enableReconnect===!1?this.setStatus("disconnected",e):i==="connected"?this.setStatus("connecting",e):i==="disconnected"?(Jt.clearAddressCache(),this.setStatus(i,e)):this.setStatus(i,e),n.on("switchNetwork",({address:o,chainId:l})=>{var x,A;const h=this.getCaipNetworks().find(P=>P.id.toString()===l.toString()||P.caipNetworkId.toString()===l.toString()),s=ue.state.activeChain===e,w=(A=(x=ue.state.chains.get(e))==null?void 0:x.accountState)==null?void 0:A.address;if(h){const P=s&&o?o:w;P&&this.syncAccount({address:P,chainId:h.id,chainNamespace:e})}else this.setUnsupportedNetwork(l)}),n.on("disconnect",()=>{const o=this.remoteFeatures.multiWallet,l=Array.from(Ht.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:e,closeModal:!o||l.length===0})}),n.on("connections",o=>{this.setConnections(o,e)}),n.on("pendingTransactions",()=>{const o=this.getAddress(e),l=ue.state.activeCaipNetwork;!o||!(l!=null&&l.id)||this.updateNativeBalance(o,l.id,l.chainNamespace)}),n.on("accountChanged",({address:o,chainId:l,connector:h})=>{var A,P;this.handlePreviousConnectorConnection(h);const s=ue.state.activeChain===e;h!=null&&h.provider&&(this.syncProvider({id:h.id,type:h.type,provider:h==null?void 0:h.provider,chainNamespace:e}),this.syncConnectedWalletInfo(e));const w=(P=(A=ue.getNetworkData(e))==null?void 0:A.caipNetwork)==null?void 0:P.id,x=l||w;s&&x?this.syncAccount({address:o,chainId:x,chainNamespace:e}):!s&&x?(this.syncAccountInfo(o,x,e),this.syncBalance({address:o,chainId:x,chainNamespace:e})):this.syncAccountInfo(o,l,e),Jt.addConnectedNamespace(e)})}async handlePreviousConnectorConnection(e){var w;const n=e==null?void 0:e.chain,i=e==null?void 0:e.id,o=Nt.getConnectorId(n),l=(w=ut.state.remoteFeatures)==null?void 0:w.multiWallet,s=n&&i&&o&&o!==i&&!l;try{s&&await Ht.disconnect({id:o,namespace:n})}catch(x){console.warn("Error disconnecting previous connector",x)}}async createUniversalProviderForAdapter(e){var n,i,o;await this.getUniversalProvider(),this.universalProvider&&await((o=(i=(n=this.chainAdapters)==null?void 0:n[e])==null?void 0:i.setUniversalProvider)==null?void 0:o.call(i,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(e=>Ht.disconnect({namespace:e,initialDisconnect:!0})))}catch(e){console.error("Error disconnecting existing connections:",e)}}async reconnectWalletConnect(){await this.syncWalletConnectAccount();const e=this.getAddress();this.getCaipAddress()||Jt.deleteRecentWallet();const n=Jt.getRecentWallet();Sn.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:e,properties:{method:Ft.isMobile()?"mobile":"qrcode",name:(n==null?void 0:n.name)||"Unknown",reconnect:!0,view:Pt.state.view,walletRank:n==null?void 0:n.order}})}async syncNamespaceConnection(e){try{e===at.CHAIN.EVM&&Ft.isSafeApp()&&Nt.setConnectorId(at.CONNECTOR_ID.SAFE,e);const n=Nt.getConnectorId(e);switch(this.setStatus("connecting",e),n){case at.CONNECTOR_ID.WALLET_CONNECT:await this.reconnectWalletConnect();break;case at.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(n){console.warn("AppKit couldn't sync existing connection",n),this.setStatus("disconnected",e)}}onDisconnectNamespace(e){const{chainNamespace:n,closeModal:i}=e||{};ue.resetAccount(n),ue.resetNetwork(n),Jt.removeConnectedNamespace(n);const o=Array.from(ue.state.chains.keys());(n?[n]:o).forEach(h=>Jt.addDisconnectedConnectorId(Nt.getConnectorId(h)||"",h)),Nt.removeConnectorId(n),Qr.resetChain(n),this.setUser(null,n),this.setStatus("disconnected",n),this.setConnectedWalletInfo(null,n),i!==!1&&gi.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(e=>{const n=this.getAdapter(e),i=this.getCaipAddress(e),o=this.getCaipNetwork(e);return n==null?void 0:n.syncConnections({connectToFirstConnector:!i,caipNetwork:o})}))}async syncAdapterConnection(e){var s,w,x,A,P;const n=this.getAdapter(e),i=this.getCaipNetwork(e),o=Nt.getConnectorId(e),h=Nt.getConnectors(e).find(D=>D.id===o);try{if(!n||!h)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(i!=null&&i.id))throw new Error("CaipNetwork not found");const D=await(n==null?void 0:n.syncConnection({namespace:e,id:h.id,chainId:i.id,rpcUrl:(x=(w=(s=i==null?void 0:i.rpcUrls)==null?void 0:s.default)==null?void 0:w.http)==null?void 0:x[0]}));D?(this.syncProvider({...D,chainNamespace:e}),await this.syncAccount({...D,chainNamespace:e}),this.setStatus("connected",e),Sn.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:D.address,properties:{method:"browser",name:((A=h.info)==null?void 0:A.name)||h.name||"Unknown",reconnect:!0,view:Pt.state.view,walletRank:(P=h==null?void 0:h.explorerWallet)==null?void 0:P.order}})):this.setStatus("disconnected",e)}catch{this.onDisconnectNamespace({chainNamespace:e,closeModal:!1})}}async syncWalletConnectAccount(){var i,o;const e=Object.keys(((o=(i=this.universalProvider)==null?void 0:i.session)==null?void 0:o.namespaces)||{}),n=this.chainNamespaces.map(async l=>{var P,D,M,z,U;const h=this.getAdapter(l);if(!h)return;const s=((z=(M=(D=(P=this.universalProvider)==null?void 0:P.session)==null?void 0:D.namespaces)==null?void 0:M[l])==null?void 0:z.accounts)||[],w=(U=ue.state.activeCaipNetwork)==null?void 0:U.id,x=s.find(G=>{const{chainId:ne}=No.parseCaipAddress(G);return ne===(w==null?void 0:w.toString())})||s[0];if(x){const G=No.validateCaipAddress(x),{chainId:ne,address:oe}=No.parseCaipAddress(G);if(Qr.setProviderId(l,Ya.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&ue.state.activeCaipNetwork&&h.namespace!==at.CHAIN.EVM){const Q=h.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:ue.state.activeCaipNetwork});Qr.setProvider(l,Q)}else Qr.setProvider(l,this.universalProvider);Nt.setConnectorId(at.CONNECTOR_ID.WALLET_CONNECT,l),Jt.addConnectedNamespace(l),await this.syncAccount({address:oe,chainId:ne,chainNamespace:l})}else e.includes(l)&&this.setStatus("disconnected",l);const A=this.getApprovedCaipNetworksData();this.syncConnectedWalletInfo(l),ue.setApprovedCaipNetworksData(l,{approvedCaipNetworkIds:A.approvedCaipNetworkIds,supportsAllNetworks:A.supportsAllNetworks})});await Promise.all(n)}syncProvider({type:e,provider:n,id:i,chainNamespace:o}){Qr.setProviderId(o,e),Qr.setProvider(o,n),Nt.setConnectorId(i,o)}async syncAccount(e){var P,D;const n=e.chainNamespace===ue.state.activeChain,i=ue.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:o,chainId:l,chainNamespace:h}=e,{chainId:s}=Jt.getActiveNetworkProps(),w=(i==null?void 0:i.id)||s,x=((P=ue.state.activeCaipNetwork)==null?void 0:P.name)===at.UNSUPPORTED_NETWORK_NAME,A=ue.getNetworkProp("supportsAllNetworks",h);if(this.setStatus("connected",h),!(x&&!A)&&w){let M=this.getCaipNetworks().find(ne=>ne.id.toString()===w.toString()),z=this.getCaipNetworks().find(ne=>ne.chainNamespace===h);if(!A&&!M&&!z){const ne=this.getApprovedCaipNetworkIds()||[],oe=ne.find(de=>{var he;return((he=No.parseCaipNetworkId(de))==null?void 0:he.chainId)===w.toString()}),Q=ne.find(de=>{var he;return((he=No.parseCaipNetworkId(de))==null?void 0:he.chainNamespace)===h});M=this.getCaipNetworks().find(de=>de.caipNetworkId===oe),z=this.getCaipNetworks().find(de=>de.caipNetworkId===Q||"deprecatedCaipNetworkId"in de&&de.deprecatedCaipNetworkId===Q)}const U=M||z;(U==null?void 0:U.chainNamespace)===ue.state.activeChain?ut.state.enableNetworkSwitch&&!ut.state.allowUnsupportedChain&&((D=ue.state.activeCaipNetwork)==null?void 0:D.name)===at.UNSUPPORTED_NETWORK_NAME?ue.showUnsupportedChainUI():this.setCaipNetwork(U):n||i&&this.setCaipNetworkOfNamespace(i,h),this.syncConnectedWalletInfo(h);const G=this.getAddress(h);no.isLowerCaseMatch(o,G)||this.syncAccountInfo(o,U==null?void 0:U.id,h),n?await this.syncBalance({address:o,chainId:U==null?void 0:U.id,chainNamespace:h}):await this.syncBalance({address:o,chainId:i==null?void 0:i.id,chainNamespace:h}),this.syncIdentity({address:o,chainId:l,chainNamespace:h})}}async syncAccountInfo(e,n,i){const o=this.getCaipAddress(i),l=n||(o==null?void 0:o.split(":")[1]);if(!l)return;const h=`${i}:${l}:${e}`;this.setCaipAddress(h,i,!0),await this.syncIdentity({address:e,chainId:l,chainNamespace:i})}async syncReownName(e,n){try{const i=await this.getReownName(e);if(i[0]){const o=i[0];this.setProfileName(o.name,n)}else this.setProfileName(null,n)}catch{this.setProfileName(null,n)}}syncConnectedWalletInfo(e){var o;const n=Nt.getConnectorId(e),i=Qr.getProviderId(e);if(i===Ya.CONNECTOR_TYPE_ANNOUNCED||i===Ya.CONNECTOR_TYPE_INJECTED){if(n){const h=this.getConnectors().find(s=>{var P,D;const w=s.id===n,x=((P=s.info)==null?void 0:P.rdns)===n,A=(D=s.connectors)==null?void 0:D.some(M=>{var z;return M.id===n||((z=M.info)==null?void 0:z.rdns)===n});return w||x||!!A});if(h){const{info:s,name:w,imageUrl:x}=h,A=x||this.getConnectorImage(h);this.setConnectedWalletInfo({name:w,icon:A,...s},e)}}}else if(i===Ya.CONNECTOR_TYPE_WALLET_CONNECT){const l=Qr.getProvider(e);l!=null&&l.session&&this.setConnectedWalletInfo({...l.session.peer.metadata,name:l.session.peer.metadata.name,icon:(o=l.session.peer.metadata.icons)==null?void 0:o[0]},e)}else if(n&&(n===at.CONNECTOR_ID.COINBASE_SDK||n===at.CONNECTOR_ID.COINBASE)){const l=this.getConnectors().find(x=>x.id===n),h=(l==null?void 0:l.name)||"Coinbase Wallet",s=(l==null?void 0:l.imageUrl)||this.getConnectorImage(l),w=l==null?void 0:l.info;this.setConnectedWalletInfo({...w,name:h,icon:s},e)}}async syncBalance(e){!i2.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(i=>{var o;return i.id.toString()===((o=e.chainId)==null?void 0:o.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,n,i){const o=this.getAdapter(i),l=ue.getCaipNetworkByNamespace(i,n);if(o){const h=await o.getBalance({address:e,chainId:n,caipNetwork:l,tokens:this.options.tokens});return this.setBalance(h.balance,h.symbol,i),h}}async initializeUniversalAdapter(){var o,l,h,s,w,x,A,P,D,M;const e=IIe.createLogger((z,...U)=>{z&&this.handleAlertError(z),console.error(...U)}),n={projectId:(o=this.options)==null?void 0:o.projectId,metadata:{name:(l=this.options)!=null&&l.metadata?(h=this.options)==null?void 0:h.metadata.name:"",description:(s=this.options)!=null&&s.metadata?(w=this.options)==null?void 0:w.metadata.description:"",url:(x=this.options)!=null&&x.metadata?(A=this.options)==null?void 0:A.metadata.url:"",icons:(P=this.options)!=null&&P.metadata?(D=this.options)==null?void 0:D.metadata.icons:[""]},logger:e};ut.setManualWCControl(!!((M=this.options)!=null&&M.manualWCControl)),this.universalProvider=this.options.universalProvider??await BSe.init(n);const i=this.universalProvider.disconnect.bind(this.universalProvider);this.universalProvider.disconnect=async()=>{try{return await i()}catch(z){if(z instanceof Error&&z.message.includes("Missing or invalid. Record was recently deleted"))return;throw z}},ut.state.enableReconnect===!1&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(e=>{Uf.listenWcProvider({universalProvider:this.universalProvider,namespace:e,onDisplayUri:n=>{Ht.setUri(n)},onConnect:n=>{const{address:i}=Ft.getAccount(n[0]);for(const o of this.chainNamespaces)Jt.removeDisconnectedConnectorId(at.CONNECTOR_ID.WALLET_CONNECT,o);Ht.finalizeWcConnection(i)},onDisconnect:()=>{ue.state.noAdapters&&this.resetAccount(e),Ht.resetWcConnection()},onChainChanged:n=>{const i=ue.state.activeChain,o=i&&Nt.state.activeConnectorIds[i]===at.CONNECTOR_ID.WALLET_CONNECT;if(i===e&&(ue.state.noAdapters||o)){const l=this.getCaipNetworks().find(s=>s.id.toString()===n.toString()||s.caipNetworkId.toString()===n.toString()),h=this.getCaipNetwork();if(!l){this.setUnsupportedNetwork(n);return}(h==null?void 0:h.id.toString())!==(l==null?void 0:l.id.toString())&&(h==null?void 0:h.chainNamespace)===(l==null?void 0:l.chainNamespace)&&this.setCaipNetwork(l)}},onAccountsChanged:n=>{const i=ue.state.activeChain,o=i&&Nt.state.activeConnectorIds[i]===at.CONNECTOR_ID.WALLET_CONNECT;if(i===e&&(ue.state.noAdapters||o)){const l=n==null?void 0:n[0];l&&this.syncAccount({address:l.address,chainId:l.chainId,chainNamespace:l.chainNamespace})}}})})}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&Ft.isClient()&&((e=this.options)!=null&&e.projectId)&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Sn.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}getDisabledCaipNetworks(){const e=ue.getAllApprovedCaipNetworkIds(),n=ue.getAllRequestedCaipNetworks();return Ft.sortRequestedNetworks(e,n).filter(o=>ue.isCaipNetworkDisabled(o))}handleAlertError(e){const n=Object.entries(vs.UniversalProviderErrors).find(([,{message:s}])=>e.message.includes(s)),[i,o]=n??[],{message:l,alertErrorKey:h}=o??{};if(i&&l&&!this.reportedAlertErrors[i]){const s=vs.ALERT_ERRORS[h];s&&(Ts.open(s,"error"),this.reportedAlertErrors[i]=!0)}}getAdapter(e){var n;if(e)return(n=this.chainAdapters)==null?void 0:n[e]}createAdapter(e){var o,l;if(!e)return;const n=e.namespace;if(!n)return;this.createClients();const i=e;i.namespace=n,i.construct({namespace:n,projectId:(o=this.options)==null?void 0:o.projectId,networks:(l=this.caipNetworks)==null?void 0:l.filter(({chainNamespace:h})=>h===n)}),this.chainNamespaces.includes(n)||this.chainNamespaces.push(n),this.chainAdapters&&(this.chainAdapters[n]=i)}async open(e){await this.injectModalUi(),e!=null&&e.uri&&Ht.setUri(e.uri);const{isSwap:n,isSend:i}=this.toModalOptions();return n(e)?gi.open({...e,data:{swap:e.arguments}}):i(e)&&e.arguments?this.openSend(e.arguments):gi.open(e)}async close(){await this.injectModalUi(),gi.close()}setLoading(e,n){gi.setLoading(e,n)}async disconnect(e){await Ht.disconnect({namespace:e})}getSIWX(){return ut.state.siwx}getError(){return""}getChainId(){var e;return(e=ue.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e,{throwOnFailure:n=!1}={}){const i=this.getCaipNetworks().find(o=>o.id===e.id);if(!i){Ts.open(vs.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await ue.switchActiveNetwork(i,{throwOnFailure:n})}getWalletProvider(){return ue.state.activeChain?Qr.state.providers[ue.state.activeChain]:null}getWalletProviderType(){return Qr.getProviderId(ue.state.activeChain)}subscribeProviders(e){return Qr.subscribeProviders(e)}getThemeMode(){return ra.state.themeMode}getThemeVariables(){return ra.state.themeVariables}setThemeMode(e){ra.setThemeMode(e),wO(ra.state.themeMode)}setTermsConditionsUrl(e){ut.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){ut.setPrivacyPolicyUrl(e)}setThemeVariables(e){ra.setThemeVariables(e),n6e(ra.state.themeVariables)}subscribeTheme(e){return ra.subscribe(e)}subscribeConnections(e){return this.remoteFeatures.multiWallet?Ht.subscribe(e):(Ts.open(at.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>{})}getWalletInfo(e){var i,o;if(e)return(o=(i=ue.state.chains.get(e))==null?void 0:i.accountState)==null?void 0:o.connectedWalletInfo;const n=ue.getAccountData();return n==null?void 0:n.connectedWalletInfo}getAccount(e){const n=e||ue.state.activeChain,i=Nt.getAuthConnector(n),o=ue.getAccountData(n),l=Jt.getConnectedConnectorId(ue.state.activeChain),h=Ht.getConnections(n);if(!n)throw new Error("AppKit:getAccount - namespace is required");const s=h.flatMap(w=>w.accounts.map(({address:x,type:A,publicKey:P})=>Ft.createAccount(n,x,A||"eoa",P)));if(o)return{allAccounts:s,caipAddress:o.caipAddress,address:Ft.getPlainAddress(o.caipAddress),isConnected:!!o.caipAddress,status:o.status,embeddedWalletInfo:i&&l===at.CONNECTOR_ID.AUTH?{user:o.user?{...o.user,username:Jt.getConnectedSocialUsername()}:void 0,authProvider:o.socialProvider||"email",accountType:Fs(n),isSmartAccountDeployed:!!o.smartAccountDeployed}:void 0}}subscribeAccount(e,n){const i=[],o=()=>{const h=this.getAccount(n);h&&e(h)};if(n){const h=ue.subscribeChainProp("accountState",o,n);i.push(h)}else{const h=ue.subscribe(o);i.push(h)}const l=Nt.subscribe(o);return i.push(l),()=>{i.forEach(h=>h())}}subscribeNetwork(e){return ue.subscribe(({activeCaipNetwork:n})=>{e({caipNetwork:n,chainId:n==null?void 0:n.id,caipNetworkId:n==null?void 0:n.caipNetworkId})})}subscribeWalletInfo(e,n){return n?ue.subscribeChainProp("accountState",i=>e(i==null?void 0:i.connectedWalletInfo),n):ue.subscribeChainProp("accountState",i=>e(i==null?void 0:i.connectedWalletInfo))}subscribeShouldUpdateToAddress(e){return ue.subscribeChainProp("accountState",n=>e(n==null?void 0:n.shouldUpdateToAddress))}subscribeCaipNetworkChange(e){return ue.subscribeKey("activeCaipNetwork",e)}getState(){return $l.state}getRemoteFeatures(){return ut.state.remoteFeatures}subscribeState(e){return $l.subscribe(e)}subscribeRemoteFeatures(e){return ut.subscribeKey("remoteFeatures",e)}showErrorMessage(e){Ji.showError(e)}showSuccessMessage(e){Ji.showSuccess(e)}getEvent(){return{...Sn.state}}subscribeEvents(e){return Sn.subscribe(e)}replace(e){Pt.replace(e)}redirect(e){Pt.push(e)}popTransactionStack(e){Pt.popTransactionStack(e)}isOpen(){return gi.state.open}isTransactionStackEmpty(){return Pt.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){ut.setFeatures(e)}updateRemoteFeatures(e){ut.setRemoteFeatures(e)}updateOptions(e){const i={...ut.state||{},...e};ut.setOptions(i)}setConnectMethodsOrder(e){ut.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){ut.setWalletFeaturesOrder(e)}setCollapseWallets(e){ut.setCollapseWallets(e)}setSocialsOrder(e){ut.setSocialsOrder(e)}getConnectMethodsOrder(){return Fl.getConnectOrderMethod(ut.state.features,Nt.getConnectors())}addNetwork(e,n){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const i=this.extendCaipNetwork(n,this.options);this.getCaipNetworks().find(o=>o.id===i.id)||ue.addNetwork(i)}removeNetwork(e,n){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(o=>o.id===n)&&ue.removeNetwork(e,n)}}let UU=!1;class h6e extends d6e{async onAuthProviderConnected(e){const n=no.userChainIdToChainNamespace(e==null?void 0:e.chainId);if(e.message&&e.signature&&e.siwxMessage&&await Xa.addEmbeddedWalletSession({chainId:e.siwxMessage.chainId,accountAddress:e.address,notBefore:e.siwxMessage.notBefore,statement:e.siwxMessage.statement,resources:e.siwxMessage.resources,requestId:e.siwxMessage.requestId,issuedAt:e.siwxMessage.issuedAt,domain:e.siwxMessage.domain,uri:e.siwxMessage.uri,version:e.siwxMessage.version,nonce:e.siwxMessage.nonce},e.message,e.signature),!n)throw new Error("AppKit:onAuthProviderConnected - namespace is required");const i=n===at.CHAIN.EVM?`eip155:${e.chainId}:${e.address}`:`${e.chainId}:${e.address}`,o=ut.state.defaultAccountTypes[n],l=Fs(n),h=e.preferredAccountType||l||o;this.setCaipAddress(i,n);const{signature:s,siwxMessage:w,message:x,...A}=e,P=ue.getAccountData(n);this.setUser({...(P==null?void 0:P.user)||{},...A},n),this.setSmartAccountDeployed(!!e.smartAccountDeployed,n),this.setPreferredAccountType(h,n),await Promise.all([this.syncAuthConnectorTheme(this.authProvider),this.syncAccount({address:e.address,chainId:e.chainId,chainNamespace:n})]),this.setLoading(!1,n)}setupAuthConnectorListeners(e){e.onRpcRequest(n=>{Ll.checkIfRequestExists(n)?Ll.checkIfRequestIsSafe(n)||this.handleUnsafeRPCRequest():(this.open(),console.error(Gr.RPC_METHOD_NOT_ALLOWED_MESSAGE,{method:n.method}),setTimeout(()=>{this.showErrorMessage(Gr.RPC_METHOD_NOT_ALLOWED_UI_MESSAGE)},300),e.rejectRpcRequests())}),e.onRpcError(()=>{this.isOpen()&&(this.isTransactionStackEmpty()?this.close():this.popTransactionStack("error"))}),e.onRpcSuccess((n,i)=>{const o=Ll.checkIfRequestIsSafe(i),l=this.getAddress(),h=ue.state.activeCaipNetwork;o||(l&&(h!=null&&h.id)&&this.updateNativeBalance(l,h.id,h.chainNamespace),this.isTransactionStackEmpty()?this.close():this.popTransactionStack("success"))}),e.onNotConnected(()=>{const n=ue.state.activeChain;if(!n)throw new Error("AppKit:onNotConnected - namespace is required");Nt.getConnectorId(n)===at.CONNECTOR_ID.AUTH&&(this.setCaipAddress(null,n),this.setLoading(!1,n))}),e.onConnect(this.onAuthProviderConnected.bind(this)),e.onSocialConnected(this.onAuthProviderConnected.bind(this)),e.onSetPreferredAccount(({address:n,type:i})=>{const o=ue.state.activeChain;if(!o)throw new Error("AppKit:onSetPreferredAccount - namespace is required");n&&this.setPreferredAccountType(i,o)})}async syncAuthConnectorTheme(e){if(!e)return;const n=ra.getSnapshot();await e.syncTheme({themeMode:n.themeMode,themeVariables:n.themeVariables,w3mThemeVariables:r2(n.themeVariables,n.themeMode)})}async syncAuthConnector(e,n){var A,P,D,M,z,U,G,ne,oe;const i=at.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(n),o=n===ue.state.activeChain;if(!i)return;this.setLoading(!0,n);const l=e.getLoginEmailUsed();this.setLoading(l,n),l&&this.setStatus("connecting",n);const h=e.getEmail(),s=e.getUsername(),w=((A=ue.getAccountData(n))==null?void 0:A.user)||{};this.setUser({...w,username:s,email:h},n),this.setupAuthConnectorListeners(e);const{isConnected:x}=await e.isConnected();if(n&&i&&o)if(x&&((P=this.connectionControllerClient)!=null&&P.connectExternal)){await e.init(),await this.syncAuthConnectorTheme(e),await((z=this.connectionControllerClient)==null?void 0:z.connectExternal({id:at.CONNECTOR_ID.AUTH,info:{name:at.CONNECTOR_ID.AUTH},type:Ya.CONNECTOR_TYPE_AUTH,provider:e,chainId:(M=(D=ue.getNetworkData(n))==null?void 0:D.caipNetwork)==null?void 0:M.id,chain:n})),this.setStatus("connected",n);const Q=Jt.getConnectedSocialProvider();Q?Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",address:this.getAddress(),properties:{provider:Q,reconnect:!0}}):Sn.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:this.getAddress(),properties:{method:"email",name:((oe=(ne=(G=(U=this.universalProvider)==null?void 0:U.session)==null?void 0:G.peer)==null?void 0:ne.metadata)==null?void 0:oe.name)||"Unknown",reconnect:!0,view:Pt.state.view,walletRank:void 0}})}else Nt.getConnectorId(n)===at.CONNECTOR_ID.AUTH&&(this.setStatus("disconnected",n),Jt.removeConnectedNamespace(n));this.setLoading(!1,n)}async checkExistingTelegramSocialConnection(e){var n;try{if(!Ft.isTelegram())return;const i=Jt.getTelegramSocialProvider();if(!i||!Ft.isClient())return;const l=new URL(window.location.href).searchParams.get("result_uri");if(!l)return;i&&ue.setAccountProp("socialProvider",i,e),await((n=this.authProvider)==null?void 0:n.init());const h=Nt.getAuthConnector();i&&h&&(this.setLoading(!0,e),await Ht.connectExternal({id:h.id,type:h.type,socialUri:l},h.chain),Jt.setConnectedSocialProvider(i),Jt.removeTelegramSocialProvider(),Sn.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:i}}))}catch(i){this.setLoading(!1,e),console.error("checkExistingSTelegramocialConnection error",i)}try{const i=new URL(window.location.href);i.searchParams.delete("result_uri"),window.history.replaceState({},document.title,i.toString())}catch(i){console.error("tma social login failed",i)}}createAuthProvider(e){var x,A,P,D;if(!at.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(e))return;const i=(x=this.remoteFeatures)==null?void 0:x.email,o=Array.isArray((A=this.remoteFeatures)==null?void 0:A.socials)&&this.remoteFeatures.socials.length>0,l=i||o,s=no.getActiveNamespaceConnectedToAuth()||e;!this.authProvider&&((P=this.options)!=null&&P.projectId)&&l&&(this.authProvider=$0.getInstance({projectId:this.options.projectId,enableLogger:this.options.enableAuthLogger,chainId:(D=this.getCaipNetwork(s))==null?void 0:D.caipNetworkId,abortController:vs.EmbeddedWalletAbortController,onTimeout:M=>{M==="iframe_load_failed"?Ts.open(vs.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):M==="iframe_request_timeout"?Ts.open(vs.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):M==="unverified_domain"&&Ts.open(vs.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},getActiveCaipNetwork:M=>Nf(M),getCaipNetworks:M=>ue.getCaipNetworks(M)}),$l.subscribeOpen(M=>{var z;!M&&this.isTransactionStackEmpty()&&((z=this.authProvider)==null||z.rejectRpcRequests())}));const w=e===ue.state.activeChain&&ut.state.enableReconnect;ut.state.enableReconnect===!1?this.syncAuthConnectorTheme(this.authProvider):this.authProvider&&w&&(this.syncAuthConnector(this.authProvider,e),this.checkExistingTelegramSocialConnection(e))}createAuthProviderForAdapter(e){var n,i,o;this.createAuthProvider(e),this.authProvider&&((o=(i=(n=this.chainAdapters)==null?void 0:n[e])==null?void 0:i.setAuthProvider)==null||o.call(i,this.authProvider))}initControllers(e){super.initControllers(e),this.options.excludeWalletIds&&fn.initializeExcludedWallets({ids:this.options.excludeWalletIds})}async switchCaipNetwork(e){var h,s,w;if(!e)return;const n=ue.state.activeChain,i=e.chainNamespace,o=this.getAddressByChainNamespace(i);if(i===n&&((h=ue.getAccountData(i))!=null&&h.caipAddress)){const x=this.getAdapter(i);await(x==null?void 0:x.switchNetwork({caipNetwork:e})),this.setCaipNetwork(e)}else{const A=Qr.getProviderId(n)===Ya.CONNECTOR_TYPE_AUTH,P=Qr.getProviderId(i),D=P===Ya.CONNECTOR_TYPE_AUTH,M=at.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(i);if(!i)throw new Error("AppKit:switchCaipNetwork - networkNamespace is required");if((A&&P===void 0||D)&&M)try{if(ue.state.activeChain=e.chainNamespace,o){const z=this.getAdapter(i);await(z==null?void 0:z.switchNetwork({caipNetwork:e}))}else await((w=(s=this.connectionControllerClient)==null?void 0:s.connectExternal)==null?void 0:w.call(s,{id:at.CONNECTOR_ID.AUTH,provider:this.authProvider,chain:i,chainId:e.id,type:Ya.CONNECTOR_TYPE_AUTH,caipNetwork:e}));this.setCaipNetwork(e)}catch{const U=this.getAdapter(i);await(U==null?void 0:U.switchNetwork({caipNetwork:e}))}else if(P===Ya.CONNECTOR_TYPE_WALLET_CONNECT){if(!ue.state.noAdapters){const z=this.getAdapter(i);await(z==null?void 0:z.switchNetwork({caipNetwork:e}))}this.setCaipNetwork(e),this.syncWalletConnectAccount()}else this.setCaipNetwork(e),o&&this.syncAccount({address:o,chainId:e.id,chainNamespace:i})}}async initialize(e){var n;await super.initialize(e),(n=this.chainNamespaces)==null||n.forEach(i=>{this.createAuthProviderForAdapter(i)}),await this.injectModalUi(),$l.set({initialized:!0})}async syncIdentity({address:e,chainId:n,chainNamespace:i}){var s;const o=`${i}:${n}`,l=(s=this.caipNetworks)==null?void 0:s.find(w=>w.caipNetworkId===o);if(l!=null&&l.testnet){this.setProfileName(null,i),this.setProfileImage(null,i);return}const h=Nt.getConnectorId(i)===at.CONNECTOR_ID.AUTH;try{const{name:w,avatar:x}=await this.fetchIdentity({address:e});!w&&h?await this.syncReownName(e,i):(this.setProfileName(w,i),this.setProfileImage(x,i))}catch{n!==1&&this.setProfileImage(null,i)}}syncConnectedWalletInfo(e){const n=Qr.getProviderId(e);if(n===Ya.CONNECTOR_TYPE_AUTH){const i=this.authProvider;if(i){const o=Jt.getConnectedSocialProvider()??"email",l=i.getEmail()??i.getUsername();this.setConnectedWalletInfo({name:n,identifier:l,social:o},e)}}else super.syncConnectedWalletInfo(e)}async injectModalUi(){if(!Ft.isClient())return;const e={...hi.DEFAULT_FEATURES,...this.options.features};if(!e.headless&&!UU)try{const n=this.remoteFeatures;if(await this.loadModalComponents(e,n),Ft.isClient()&&!document.querySelector("w3m-modal")){const o=document.createElement("w3m-modal");!ut.state.disableAppend&&!ut.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",o)}UU=!0}catch(n){console.error("Error injecting modal UI:",n)}}async loadModalComponents(e,n){if(!Ft.isClient())return;const i=[];(n.email||n.socials&&n.socials.length>0)&&i.push(Un(()=>import("./embedded-wallet-DuJbZl46.js"),__vite__mapDeps([10,2,3,4,5]))),n.email&&i.push(Un(()=>import("./email-Q324fM_V.js"),__vite__mapDeps([11,12,2,3,4,5]))),n.socials&&i.push(Un(()=>import("./socials-B00vKuvs.js"),__vite__mapDeps([13,2,3,4,5]))),n.swaps&&n.swaps.length>0&&i.push(Un(()=>import("./swaps-BldsiCTg.js"),__vite__mapDeps([14,15,16,2,3,4,5]))),e.send&&i.push(Un(()=>import("./send-I1Ezn5Ih.js"),__vite__mapDeps([17,18,16,15,2,3,4,5]))),e.receive&&i.push(Un(()=>import("./receive-BL-C18pE.js"),__vite__mapDeps([19,2,3,4,5]))),n.onramp&&n.onramp.length>0&&i.push(Un(()=>import("./onramp-CpihnIxQ.js"),__vite__mapDeps([20,2,3,4,5]))),n.payWithExchange&&i.push(Un(()=>import("./pay-with-exchange-CXnV7RkL.js"),__vite__mapDeps([21,18,2,3,4,5]))),n.activity&&i.push(Un(()=>import("./transactions-BY6jWmOK.js"),__vite__mapDeps([22,2,3,4,5]))),(e.pay||n.payments)&&i.push(Un(()=>import("./index-1Sc4efZJ.js"),__vite__mapDeps([23,24,2,3,4,5]))),n.emailCapture&&i.push(Un(()=>import("./data-capture-BOzcniwQ.js"),__vite__mapDeps([25,12,9,2,3,4,5]))),await Promise.all([...i,Un(()=>Promise.resolve().then(()=>L8e),void 0),Un(()=>import("./w3m-modal-CNrQ2CsD.js"),__vite__mapDeps([26,24,15,2,3,4,5]))])}}let rm;function f6e(t){t&&(rm=t)}function p6e(){if(!rm)throw new Error('Please call "createAppKit" before using "useAppKit" hook');async function t(n){return rm==null?void 0:rm.open(n)}async function e(){await(rm==null?void 0:rm.close())}return{open:t,close:e}}const m6e="1.8.18";/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const g6e=new Set(["children","localName","ref","style","className"]),jU=new WeakMap,VU=(t,e,n,i,o)=>{const l=o==null?void 0:o[e];l===void 0?(t[e]=n,n==null&&e in HTMLElement.prototype&&t.removeAttribute(e)):n!==i&&((h,s,w)=>{let x=jU.get(h);x===void 0&&jU.set(h,x=new Map);let A=x.get(s);w!==void 0?A===void 0?(x.set(s,A={handleEvent:w}),h.addEventListener(s,A)):A.handleEvent=w:A!==void 0&&(x.delete(s),h.removeEventListener(s,A))})(t,l,n)},dI=({react:t,tagName:e,elementClass:n,events:i,displayName:o})=>{const l=new Set(Object.keys(i??{})),h=t.forwardRef((s,w)=>{const x=t.useRef(new Map),A=t.useRef(null),P={},D={};for(const[M,z]of Object.entries(s))g6e.has(M)?P[M==="className"?"class":M]=z:l.has(M)||M in n.prototype?D[M]=z:P[M]=z;return t.useLayoutEffect(()=>{if(A.current===null)return;const M=new Map;for(const z in D)VU(A.current,z,s[z],x.current.get(z),i),x.current.delete(z),M.set(z,s[z]);for(const[z,U]of x.current)VU(A.current,z,void 0,U,i);x.current=M}),t.useLayoutEffect(()=>{var M;(M=A.current)==null||M.removeAttribute("defer-hydration")},[]),P.suppressHydrationWarning=!0,t.createElement(e,{...P,ref:t.useCallback(M=>{A.current=M,typeof w=="function"?w(M):w!==null&&(w.current=M)},[w])})});return h.displayName=o??n.name,h};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const y6e={attribute:!0,type:String,converter:VA,reflect:!1,hasChanged:WD},_6e=(t=y6e,e,n)=>{const{kind:i,metadata:o}=n;let l=globalThis.litPropertyMetadata.get(o);if(l===void 0&&globalThis.litPropertyMetadata.set(o,l=new Map),i==="setter"&&((t=Object.create(t)).wrapped=!0),l.set(n.name,t),i==="accessor"){const{name:h}=n;return{set(s){const w=e.get.call(this);e.set.call(this,s),this.requestUpdate(h,w,t,!0,s)},init(s){return s!==void 0&&this.C(h,void 0,t,s),s}}}if(i==="setter"){const{name:h}=n;return function(s){const w=this[h];e.call(this,s),this.requestUpdate(h,w,t,!0,s)}}throw Error("Unsupported decorator location: "+i)};function Fe(t){return(e,n)=>typeof n=="object"?_6e(t,e,n):((i,o,l)=>{const h=o.hasOwnProperty(l);return o.constructor.createProperty(l,i),h?Object.getOwnPropertyDescriptor(o,l):void 0})(t,e,n)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Lt(t){return Fe({...t,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Tn=t=>t??ro;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const tY=Symbol.for(""),w6e=t=>{if((t==null?void 0:t.r)===tY)return t==null?void 0:t._$litStatic$},b6e=t=>({_$litStatic$:t,r:tY}),WU=new Map,v6e=t=>(e,...n)=>{const i=n.length;let o,l;const h=[],s=[];let w,x=0,A=!1;for(;x<i;){for(w=e[x];x<i&&(l=n[x],(o=w6e(l))!==void 0);)w+=o+e[++x],A=!0;x!==i&&s.push(l),h.push(w),x++}if(x===i&&h.push(e[i]),A){const P=h.join("$$lit$$");(e=WU.get(P))===void 0&&(h.raw=h,WU.set(P,e=h)),n=s}return t(e,...n)},HU=v6e(we),x6e=yi`<svg width="30" height="30" viewBox="0 0 30 30" fill="none">
  <g clip-path="url(#clip0_87_33)">
    <path d="M23.9367 2.29447e-07H6.05917C5.26333 -0.000218805 4.47526 0.156384 3.73997 0.46086C3.00469 0.765337 2.33661 1.21172 1.77391 1.7745C1.21121 2.33727 0.764917 3.00542 0.460542 3.74074C0.156167 4.47607 -0.000327963 5.26417 5.16031e-07 6.06V23.9433C4.48257e-07 24.7389 0.156744 25.5267 0.461276 26.2617C0.765808 26.9967 1.21216 27.6645 1.77484 28.2269C2.33752 28.7894 3.0055 29.2355 3.74061 29.5397C4.47573 29.8439 5.26358 30.0003 6.05917 30H23.9417C25.5486 29.9996 27.0895 29.3609 28.2257 28.2245C29.3618 27.0881 30 25.5469 30 23.94V6.06C29.9993 4.45241 29.3602 2.91091 28.2232 1.77449C27.0861 0.638064 25.5443 -0.000220881 23.9367 2.29447e-07Z" fill="url(#paint0_linear_87_33)"/>
    <path d="M14.8708 6.89259L15.4783 5.84259C15.5679 5.68703 15.6873 5.55064 15.8296 5.44122C15.9719 5.3318 16.1344 5.25148 16.3078 5.20486C16.4812 5.15824 16.662 5.14622 16.8401 5.1695C17.0181 5.19277 17.1898 5.25088 17.3453 5.34051C17.5009 5.43013 17.6373 5.54952 17.7467 5.69186C17.8561 5.83419 17.9364 5.99669 17.9831 6.17006C18.0297 6.34344 18.0417 6.5243 18.0184 6.70232C17.9952 6.88034 17.9371 7.05203 17.8474 7.20759L11.9949 17.3401H16.2283C17.5999 17.3401 18.3691 18.9526 17.7724 20.0701H5.36159C5.18215 20.0707 5.00436 20.0359 4.83845 19.9675C4.67254 19.8992 4.5218 19.7986 4.39492 19.6718C4.26803 19.5449 4.16751 19.3941 4.09915 19.2282C4.03079 19.0623 3.99593 18.8845 3.99659 18.7051C3.99659 17.9476 4.60492 17.3401 5.36159 17.3401H8.84159L13.2958 9.61926L11.9041 7.20426C11.738 6.89096 11.7 6.52543 11.7982 6.18469C11.8963 5.84395 12.1229 5.5546 12.4301 5.37763C12.7374 5.20065 13.1014 5.14987 13.4454 5.23599C13.7893 5.3221 14.0864 5.53838 14.2741 5.83926L14.8708 6.89259ZM9.60659 21.4759L8.29409 23.7526C8.20446 23.9082 8.08506 24.0446 7.94271 24.1541C7.80035 24.2636 7.63783 24.344 7.46441 24.3906C7.291 24.4373 7.11009 24.4493 6.93202 24.4261C6.75395 24.4028 6.58221 24.3447 6.42659 24.2551C6.27097 24.1655 6.13454 24.0461 6.02506 23.9037C5.91559 23.7613 5.83523 23.5988 5.78857 23.4254C5.74191 23.252 5.72986 23.0711 5.75311 22.893C5.77637 22.715 5.83446 22.5432 5.92409 22.3876L6.89909 20.7001C8.00159 20.3584 8.89742 20.6209 9.60659 21.4759ZM20.9066 17.3476H24.4583C25.2158 17.3476 25.8233 17.9551 25.8233 18.7126C25.8233 19.4701 25.2149 20.0776 24.4583 20.0776H22.4858L23.8166 22.3876C24.1916 23.0443 23.9708 23.8726 23.3149 24.2551C23.0006 24.4359 22.6274 24.4845 22.2772 24.3903C21.927 24.2961 21.6286 24.0667 21.4474 23.7526C19.2058 19.8643 17.5216 16.9534 16.4041 15.0151C15.2608 13.0426 16.0783 11.0626 16.8841 10.3909C17.7799 11.9293 19.1191 14.2501 20.9074 17.3476H20.9066Z" fill="white"/>
  </g>
  <defs>
    <linearGradient id="paint0_linear_87_33" x1="15" y1="2.29447e-07" x2="15" y2="30" gradientUnits="userSpaceOnUse">
      <stop stop-color="#18BFFB"/>
      <stop offset="1" stop-color="#2072F3"/>
    </linearGradient>
    <clipPath id="clip0_87_33">
      <rect width="30" height="30" fill="white"/>
    </clipPath>
  </defs>
</svg>`,E6e=yi`<svg fill="none" viewBox="0 0 40 40">
  <g clip-path="url(#a)">
    <g clip-path="url(#b)">
      <circle cx="20" cy="19.89" r="20" fill="#000" />
      <g clip-path="url(#c)">
        <path
          fill="#fff"
          d="M28.77 23.3c-.69 1.99-2.75 5.52-4.87 5.56-1.4.03-1.86-.84-3.46-.84-1.61 0-2.12.81-3.45.86-2.25.1-5.72-5.1-5.72-9.62 0-4.15 2.9-6.2 5.42-6.25 1.36-.02 2.64.92 3.47.92.83 0 2.38-1.13 4.02-.97.68.03 2.6.28 3.84 2.08-3.27 2.14-2.76 6.61.75 8.25ZM24.2 7.88c-2.47.1-4.49 2.69-4.2 4.84 2.28.17 4.47-2.39 4.2-4.84Z"
        />
      </g>
    </g>
  </g>
  <defs>
    <clipPath id="a"><rect width="40" height="40" fill="#fff" rx="20" /></clipPath>
    <clipPath id="b"><path fill="#fff" d="M0 0h40v40H0z" /></clipPath>
    <clipPath id="c"><path fill="#fff" d="M8 7.89h24v24H8z" /></clipPath>
  </defs>
</svg>`,C6e=yi`
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 11">
    <path
      fill="var(--apkt-tokens-theme-textPrimary)"
      d="M7.862 4.86c.159-1.064-.652-1.637-1.76-2.018l.36-1.443-.879-.218-.35 1.404c-.23-.058-.468-.112-.703-.166l.352-1.413-.877-.219-.36 1.442a29.02 29.02 0 0 1-.56-.132v-.005l-1.21-.302-.234.938s.652.15.638.158c.356.089.42.324.41.51l-.41 1.644a.715.715 0 0 1 .09.03l-.092-.024-.574 2.302c-.044.108-.154.27-.402.208.008.013-.639-.16-.639-.16L.227 8.403l1.142.285c.213.053.42.109.626.161l-.363 1.459.877.218.36-1.443c.239.065.472.125.7.182l-.36 1.436.879.219.363-1.456c1.497.283 2.623.17 3.097-1.185.381-1.09-.02-1.719-.807-2.129.574-.132 1.006-.51 1.12-1.289ZM5.856 7.673c-.272 1.09-2.107.5-2.702.353l.482-1.933c.595.149 2.503.443 2.22 1.58Zm.271-2.829c-.247.992-1.775.488-2.27.365l.436-1.753c.496.124 2.092.354 1.834 1.388Z"
    />
  </svg>
`,T6e=yi`<svg viewBox="0 0 32 32" fill="none">
<path d="M29.0612 10.0613L13.0612 26.0613C12.9218 26.2011 12.7563 26.3121 12.5739 26.3878C12.3916 26.4635 12.1961 26.5024 11.9987 26.5024C11.8013 26.5024 11.6058 26.4635 11.4235 26.3878C11.2411 26.3121 11.0756 26.2011 10.9362 26.0613L3.9362 19.0613C3.79667 18.9217 3.68599 18.7561 3.61047 18.5738C3.53496 18.3915 3.49609 18.1961 3.49609 17.9988C3.49609 17.8014 3.53496 17.606 3.61047 17.4237C3.68599 17.2414 3.79667 17.0758 3.9362 16.9363C4.07573 16.7967 4.24137 16.686 4.42367 16.6105C4.60598 16.535 4.80137 16.4962 4.9987 16.4962C5.19602 16.4962 5.39141 16.535 5.57372 16.6105C5.75602 16.686 5.92167 16.7967 6.0612 16.9363L11.9999 22.875L26.9387 7.93876C27.2205 7.65697 27.6027 7.49866 28.0012 7.49866C28.3997 7.49866 28.7819 7.65697 29.0637 7.93876C29.3455 8.22055 29.5038 8.60274 29.5038 9.00126C29.5038 9.39977 29.3455 9.78197 29.0637 10.0638L29.0612 10.0613Z" fill="currentColor"/>
</svg>
`,A6e=yi`<svg width="30" height="30" viewBox="0 0 30 30" fill="none">
<path d="M14.9978 7.80003H27.4668C26.2032 5.61107 24.3857 3.79333 22.1968 2.52955C20.008 1.26577 17.525 0.600485 14.9975 0.600586C12.47 0.600687 9.98712 1.26617 7.79838 2.53012C5.60964 3.79408 3.79221 5.61197 2.52881 7.80103L8.76281 18.599L8.76881 18.598C8.13412 17.5044 7.79906 16.2628 7.79743 14.9983C7.79579 13.7339 8.12764 12.4914 8.7595 11.3961C9.39136 10.3008 10.3009 9.39159 11.3963 8.76005C12.4918 8.12851 13.7344 7.79702 14.9988 7.79903L14.9978 7.80003Z" fill="url(#paint0_linear_87_32)"/>
<path d="M21.237 18.5981L15.003 29.3961C17.5305 29.3961 20.0134 28.7308 22.2022 27.467C24.391 26.2032 26.2086 24.3854 27.4721 22.1965C28.7356 20.0075 29.4006 17.5245 29.4003 14.997C29.3999 12.4695 28.7342 9.9867 27.47 7.7981H15.002L15 7.8041C16.2642 7.80168 17.5067 8.13257 18.6022 8.76342C19.6977 9.39428 20.6076 10.3028 21.2401 11.3974C21.8726 12.492 22.2053 13.734 22.2048 14.9982C22.2042 16.2623 21.8704 17.504 21.237 18.5981Z" fill="url(#paint1_linear_87_32)"/>
<path d="M8.76502 18.601L2.53102 7.80298C1.26664 9.99172 0.600848 12.4748 0.600586 15.0025C0.600324 17.5302 1.2656 20.0134 2.52953 22.2024C3.79345 24.3914 5.61145 26.209 7.80071 27.4725C9.98998 28.736 12.4733 29.4008 15.001 29.4L21.236 18.602L21.232 18.598C20.6022 19.6941 19.6944 20.6049 18.6003 21.2383C17.5062 21.8717 16.2644 22.2055 15.0002 22.2059C13.7359 22.2063 12.4939 21.8733 11.3994 21.2406C10.3049 20.6079 9.39657 19.6977 8.76602 18.602L8.76502 18.601Z" fill="url(#paint2_linear_87_32)"/>
<path d="M14.9998 22.2C16.9094 22.2 18.7407 21.4415 20.091 20.0912C21.4412 18.741 22.1998 16.9096 22.1998 15C22.1998 13.0905 21.4412 11.2591 20.091 9.90888C18.7407 8.55862 16.9094 7.80005 14.9998 7.80005C13.0902 7.80005 11.2589 8.55862 9.90864 9.90888C8.55837 11.2591 7.7998 13.0905 7.7998 15C7.7998 16.9096 8.55837 18.741 9.90864 20.0912C11.2589 21.4415 13.0902 22.2 14.9998 22.2Z" fill="white"/>
<path d="M14.9998 20.7C16.5115 20.7 17.9614 20.0995 19.0303 19.0306C20.0993 17.9616 20.6998 16.5118 20.6998 15C20.6998 13.4883 20.0993 12.0385 19.0303 10.9695C17.9614 9.90058 16.5115 9.30005 14.9998 9.30005C13.4881 9.30005 12.0383 9.90058 10.9693 10.9695C9.90034 12.0385 9.2998 13.4883 9.2998 15C9.2998 16.5118 9.90034 17.9616 10.9693 19.0306C12.0383 20.0995 13.4881 20.7 14.9998 20.7Z" fill="#1A73E8"/>
<defs>
  <linearGradient id="paint0_linear_87_32" x1="3.29381" y1="2.99503" x2="38.0998" y2="2.99503" gradientUnits="userSpaceOnUse">
    <stop stop-color="#D93025"/>
    <stop offset="1" stop-color="#EA4335"/>
  </linearGradient>
  <linearGradient id="paint1_linear_87_32" x1="17.953" y1="29.1431" x2="34.194" y2="-0.298904" gradientUnits="userSpaceOnUse">
    <stop stop-color="#FCC934"/>
    <stop offset="1" stop-color="#FBBC04"/>
  </linearGradient>
  <linearGradient id="paint2_linear_87_32" x1="22.873" y1="28.2" x2="6.63202" y2="-1.24102" gradientUnits="userSpaceOnUse">
    <stop stop-color="#1E8E3E"/>
    <stop offset="1" stop-color="#34A853"/>
  </linearGradient>
</defs>
</svg>`,S6e=yi`<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
<path d="M23 11.1962V10.5C23 7.365 18.2712 5 12 5C5.72875 5 1 7.365 1 10.5V15.5C1 18.1112 4.28125 20.1863 9 20.8075V21.5C9 24.635 13.7288 27 20 27C26.2712 27 31 24.635 31 21.5V16.5C31 13.9125 27.8225 11.835 23 11.1962ZM7 18.3587C4.55125 17.675 3 16.5487 3 15.5V13.7413C4.02 14.4637 5.38625 15.0463 7 15.4375V18.3587ZM17 15.4375C18.6138 15.0463 19.98 14.4637 21 13.7413V15.5C21 16.5487 19.4487 17.675 17 18.3587V15.4375ZM15 24.3587C12.5513 23.675 11 22.5487 11 21.5V20.9788C11.3287 20.9913 11.6613 21 12 21C12.485 21 12.9587 20.9837 13.4237 20.9562C13.9403 21.1412 14.4665 21.2981 15 21.4263V24.3587ZM15 18.7812C14.0068 18.928 13.004 19.0011 12 19C10.996 19.0011 9.99324 18.928 9 18.7812V15.8075C9.99472 15.9371 10.9969 16.0014 12 16C13.0031 16.0014 14.0053 15.9371 15 15.8075V18.7812ZM23 24.7812C21.0106 25.0729 18.9894 25.0729 17 24.7812V21.8C17.9944 21.9337 18.9967 22.0005 20 22C21.0031 22.0014 22.0053 21.9371 23 21.8075V24.7812ZM29 21.5C29 22.5487 27.4487 23.675 25 24.3587V21.4375C26.6138 21.0462 27.98 20.4637 29 19.7412V21.5Z" fill="currentColor"/>
</svg>
`,I6e=yi` <svg fill="none" viewBox="0 0 13 4">
  <path fill="currentColor" d="M.5 0h12L8.9 3.13a3.76 3.76 0 0 1-4.8 0L.5 0Z" />
</svg>`,P6e=yi`<svg fill="none" viewBox="0 0 40 40">
  <g clip-path="url(#a)">
    <g clip-path="url(#b)">
      <circle cx="20" cy="19.89" r="20" fill="#5865F2" />
      <path
        fill="#fff"
        fill-rule="evenodd"
        d="M25.71 28.15C30.25 28 32 25.02 32 25.02c0-6.61-2.96-11.98-2.96-11.98-2.96-2.22-5.77-2.15-5.77-2.15l-.29.32c3.5 1.07 5.12 2.61 5.12 2.61a16.75 16.75 0 0 0-10.34-1.93l-.35.04a15.43 15.43 0 0 0-5.88 1.9s1.71-1.63 5.4-2.7l-.2-.24s-2.81-.07-5.77 2.15c0 0-2.96 5.37-2.96 11.98 0 0 1.73 2.98 6.27 3.13l1.37-1.7c-2.6-.79-3.6-2.43-3.6-2.43l.58.35.09.06.08.04.02.01.08.05a17.25 17.25 0 0 0 4.52 1.58 14.4 14.4 0 0 0 8.3-.86c.72-.27 1.52-.66 2.37-1.21 0 0-1.03 1.68-3.72 2.44.61.78 1.35 1.67 1.35 1.67Zm-9.55-9.6c-1.17 0-2.1 1.03-2.1 2.28 0 1.25.95 2.28 2.1 2.28 1.17 0 2.1-1.03 2.1-2.28.01-1.25-.93-2.28-2.1-2.28Zm7.5 0c-1.17 0-2.1 1.03-2.1 2.28 0 1.25.95 2.28 2.1 2.28 1.17 0 2.1-1.03 2.1-2.28 0-1.25-.93-2.28-2.1-2.28Z"
        clip-rule="evenodd"
      />
    </g>
  </g>
  <defs>
    <clipPath id="a"><rect width="40" height="40" fill="#fff" rx="20" /></clipPath>
    <clipPath id="b"><path fill="#fff" d="M0 0h40v40H0z" /></clipPath>
  </defs>
</svg>`,R6e=yi`<svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  viewBox="0 0 9 12"
>
  <path
    fill="var(--apkt-tokens-theme-textPrimary)"
    d="M4.666.001v4.435l3.748 1.675L4.666.001Zm0 0L.917 6.111l3.749-1.675V.001Zm0 8.984V12l3.75-5.19-3.75 2.176Zm0 3.014V8.985L.917 6.81 4.666 12Zm0-3.712 3.748-2.176-3.748-1.675v3.851Z"
  />
  <path fill="var(--apkt-tokens-theme-textPrimary)" d="m.917 6.111 3.749 2.176v-3.85L.917 6.11Z" />
</svg>`,O6e=yi`<svg fill="none" viewBox="0 0 16 16">
  <path
    fill="currentColor"
    d="M4.25 7a.63.63 0 0 0-.63.63v3.97c0 .28-.2.51-.47.54l-.75.07a.93.93 0 0 1-.9-.47A7.51 7.51 0 0 1 5.54.92a7.5 7.5 0 0 1 9.54 4.62c.12.35.06.72-.16 1-.74.97-1.68 1.78-2.6 2.44V4.44a.64.64 0 0 0-.63-.64h-1.06c-.35 0-.63.3-.63.64v5.5c0 .23-.12.42-.32.5l-.52.23V6.05c0-.36-.3-.64-.64-.64H7.45c-.35 0-.64.3-.64.64v4.97c0 .25-.17.46-.4.52a5.8 5.8 0 0 0-.45.11v-4c0-.36-.3-.65-.64-.65H4.25ZM14.07 12.4A7.49 7.49 0 0 1 3.6 14.08c4.09-.58 9.14-2.5 11.87-6.6v.03a7.56 7.56 0 0 1-1.41 4.91Z"
  />
</svg>`,k6e=yi`<svg fill="none" viewBox="0 0 40 40">
  <g clip-path="url(#a)">
    <g clip-path="url(#b)">
      <circle cx="20" cy="19.89" r="20" fill="#1877F2" />
      <g clip-path="url(#c)">
        <path
          fill="#fff"
          d="M26 12.38h-2.89c-.92 0-1.61.38-1.61 1.34v1.66H26l-.36 4.5H21.5v12H17v-12h-3v-4.5h3V12.5c0-3.03 1.6-4.62 5.2-4.62H26v4.5Z"
        />
      </g>
    </g>
    <path
      fill="#1877F2"
      d="M40 20a20 20 0 1 0-23.13 19.76V25.78H11.8V20h5.07v-4.4c0-5.02 3-7.79 7.56-7.79 2.19 0 4.48.4 4.48.4v4.91h-2.53c-2.48 0-3.25 1.55-3.25 3.13V20h5.54l-.88 5.78h-4.66v13.98A20 20 0 0 0 40 20Z"
    />
    <path
      fill="#fff"
      d="m27.79 25.78.88-5.78h-5.55v-3.75c0-1.58.78-3.13 3.26-3.13h2.53V8.2s-2.3-.39-4.48-.39c-4.57 0-7.55 2.77-7.55 7.78V20H11.8v5.78h5.07v13.98a20.15 20.15 0 0 0 6.25 0V25.78h4.67Z"
    />
  </g>
  <defs>
    <clipPath id="a"><rect width="40" height="40" fill="#fff" rx="20" /></clipPath>
    <clipPath id="b"><path fill="#fff" d="M0 0h40v40H0z" /></clipPath>
    <clipPath id="c"><path fill="#fff" d="M8 7.89h24v24H8z" /></clipPath>
  </defs>
</svg>`,D6e=yi`<svg style="border-radius: 9999px; overflow: hidden;"  fill="none" viewBox="0 0 1000 1000">
  <rect width="1000" height="1000" rx="9999" ry="9999" fill="#855DCD"/>
  <path fill="#855DCD" d="M0 0h1000v1000H0V0Z" />
  <path
    fill="#fff"
    d="M320 248h354v504h-51.96V521.13h-.5c-5.76-63.8-59.31-113.81-124.54-113.81s-118.78 50-124.53 113.81h-.5V752H320V248Z"
  />
  <path
    fill="#fff"
    d="m225 320 21.16 71.46h17.9v289.09a16.29 16.29 0 0 0-16.28 16.24v19.49h-3.25a16.3 16.3 0 0 0-16.28 16.24V752h182.26v-19.48a16.22 16.22 0 0 0-16.28-16.24h-3.25v-19.5a16.22 16.22 0 0 0-16.28-16.23h-19.52V320H225Zm400.3 360.55a16.3 16.3 0 0 0-15.04 10.02 16.2 16.2 0 0 0-1.24 6.22v19.49h-3.25a16.29 16.29 0 0 0-16.27 16.24V752h182.24v-19.48a16.23 16.23 0 0 0-16.27-16.24h-3.25v-19.5a16.2 16.2 0 0 0-10.04-15 16.3 16.3 0 0 0-6.23-1.23v-289.1h17.9L775 320H644.82v360.55H625.3Z"
  />
</svg>`,N6e=yi`<svg fill="none" viewBox="0 0 40 40">
  <g clip-path="url(#a)">
    <g clip-path="url(#b)">
      <circle cx="20" cy="19.89" r="20" fill="#1B1F23" />
      <g clip-path="url(#c)">
        <path
          fill="#fff"
          d="M8 19.89a12 12 0 1 1 15.8 11.38c-.6.12-.8-.26-.8-.57v-3.3c0-1.12-.4-1.85-.82-2.22 2.67-.3 5.48-1.31 5.48-5.92 0-1.31-.47-2.38-1.24-3.22.13-.3.54-1.52-.12-3.18 0 0-1-.32-3.3 1.23a11.54 11.54 0 0 0-6 0c-2.3-1.55-3.3-1.23-3.3-1.23a4.32 4.32 0 0 0-.12 3.18 4.64 4.64 0 0 0-1.24 3.22c0 4.6 2.8 5.63 5.47 5.93-.34.3-.65.83-.76 1.6-.69.31-2.42.84-3.5-1 0 0-.63-1.15-1.83-1.23 0 0-1.18-.02-.09.73 0 0 .8.37 1.34 1.76 0 0 .7 2.14 4.03 1.41v2.24c0 .31-.2.68-.8.57A12 12 0 0 1 8 19.9Z"
        />
      </g>
    </g>
  </g>
  <defs>
    <clipPath id="a"><rect width="40" height="40" fill="#fff" rx="20" /></clipPath>
    <clipPath id="b"><path fill="#fff" d="M0 0h40v40H0z" /></clipPath>
    <clipPath id="c"><path fill="#fff" d="M8 7.89h24v24H8z" /></clipPath>
  </defs>
</svg>`,M6e=yi`<svg fill="none" viewBox="0 0 40 40">
  <path
    fill="#4285F4"
    d="M32.74 20.3c0-.93-.08-1.81-.24-2.66H20.26v5.03h7a6 6 0 0 1-2.62 3.91v3.28h4.22c2.46-2.27 3.88-5.6 3.88-9.56Z"
  />
  <path
    fill="#34A853"
    d="M20.26 33a12.4 12.4 0 0 0 8.6-3.14l-4.22-3.28a7.74 7.74 0 0 1-4.38 1.26 7.76 7.76 0 0 1-7.28-5.36H8.65v3.36A12.99 12.99 0 0 0 20.26 33Z"
  />
  <path
    fill="#FBBC05"
    d="M12.98 22.47a7.79 7.79 0 0 1 0-4.94v-3.36H8.65a12.84 12.84 0 0 0 0 11.66l3.37-2.63.96-.73Z"
  />
  <path
    fill="#EA4335"
    d="M20.26 12.18a7.1 7.1 0 0 1 4.98 1.93l3.72-3.72A12.47 12.47 0 0 0 20.26 7c-5.08 0-9.47 2.92-11.6 7.17l4.32 3.36a7.76 7.76 0 0 1 7.28-5.35Z"
  />
</svg>`,L6e=yi`<svg width="10" height="10" viewBox="0 0 10 10" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M4.875 0C3.91082 0 2.96829 0.285914 2.1666 0.821586C1.36491 1.35726 0.740067 2.11863 0.371089 3.00942C0.00211226 3.90021 -0.094429 4.88041 0.093674 5.82607C0.281777 6.77172 0.746076 7.64036 1.42786 8.32215C2.10964 9.00393 2.97828 9.46823 3.92394 9.65633C4.86959 9.84443 5.84979 9.74789 6.74058 9.37891C7.63137 9.00994 8.39274 8.38509 8.92842 7.5834C9.46409 6.78171 9.75 5.83918 9.75 4.875C9.74864 3.58249 9.23458 2.34331 8.32064 1.42936C7.4067 0.515418 6.16751 0.00136492 4.875 0ZM4.6875 2.25C4.79875 2.25 4.90751 2.28299 5.00001 2.3448C5.09251 2.40661 5.16461 2.49446 5.20718 2.59724C5.24976 2.70002 5.2609 2.81312 5.23919 2.92224C5.21749 3.03135 5.16392 3.13158 5.08525 3.21025C5.00658 3.28891 4.90635 3.34249 4.79724 3.36419C4.68813 3.3859 4.57503 3.37476 4.47224 3.33218C4.36946 3.28961 4.28161 3.21751 4.2198 3.12501C4.15799 3.03251 4.125 2.92375 4.125 2.8125C4.125 2.66332 4.18427 2.52024 4.28975 2.41475C4.39524 2.30926 4.53832 2.25 4.6875 2.25ZM5.25 7.5C5.05109 7.5 4.86032 7.42098 4.71967 7.28033C4.57902 7.13968 4.5 6.94891 4.5 6.75V4.875C4.40055 4.875 4.30516 4.83549 4.23484 4.76516C4.16451 4.69484 4.125 4.59946 4.125 4.5C4.125 4.40054 4.16451 4.30516 4.23484 4.23484C4.30516 4.16451 4.40055 4.125 4.5 4.125C4.69891 4.125 4.88968 4.20402 5.03033 4.34467C5.17098 4.48532 5.25 4.67609 5.25 4.875V6.75C5.34946 6.75 5.44484 6.78951 5.51517 6.85983C5.58549 6.93016 5.625 7.02554 5.625 7.125C5.625 7.22446 5.58549 7.31984 5.51517 7.39017C5.44484 7.46049 5.34946 7.5 5.25 7.5Z" fill="#9A9A9A"/>
</svg>
`,B6e=yi`<svg width="32" height="32" viewBox="0 0 32 32" fill="none">
<path d="M28.925 5.5425C28.925 5.5425 28.925 5.555 28.925 5.56125L21.65 29.5537C21.5399 29.9434 21.3132 30.2901 21.0004 30.5473C20.6876 30.8045 20.3036 30.9598 19.9 30.9925C19.8425 30.9975 19.785 31 19.7275 31C19.3493 31.0012 18.9786 30.8941 18.6592 30.6915C18.3398 30.4888 18.085 30.199 17.925 29.8563L13.375 20.5187C13.3295 20.4252 13.3143 20.3197 13.3315 20.2171C13.3488 20.1145 13.3976 20.0198 13.4713 19.9463L20.7113 12.7063C20.8909 12.5172 20.9895 12.2654 20.9862 12.0047C20.9829 11.7439 20.8778 11.4948 20.6934 11.3104C20.509 11.126 20.2599 11.0209 19.9991 11.0176C19.7383 11.0142 19.4866 11.1129 19.2975 11.2925L12.0538 18.5325C11.9802 18.6061 11.8855 18.655 11.7829 18.6722C11.6803 18.6895 11.5748 18.6743 11.4813 18.6287L2.13502 14.08C1.76954 13.9047 1.46598 13.6224 1.26454 13.2706C1.06311 12.9189 0.973316 12.5142 1.00707 12.1102C1.04082 11.7063 1.19652 11.3221 1.45354 11.0087C1.71056 10.6952 2.05676 10.4673 2.44627 10.355L26.4388 3.08H26.4575C26.7991 2.98403 27.1601 2.98066 27.5034 3.07025C27.8468 3.15984 28.1601 3.33916 28.4113 3.58981C28.6624 3.84045 28.8424 4.15341 28.9326 4.49656C29.0229 4.83971 29.0203 5.2007 28.925 5.5425Z" fill="currentColor"/>
</svg>
`,F6e=yi` <svg width="27" height="30" viewBox="0 0 27 30" fill="none">
  <path d="M12.5395 14.3237L0.116699 27.5049V27.5188C0.251527 28.0177 0.49972 28.4788 0.841941 28.866C1.18416 29.2533 1.61117 29.5563 2.0897 29.7515C2.56823 29.9467 3.08536 30.0287 3.60081 29.9913C4.11625 29.9538 4.61609 29.7979 5.06139 29.5356L5.0975 29.512L19.0718 21.4519L12.5395 14.3237Z" fill="#EA4335"/>
  <path d="M25.103 12.0833L25.0919 12.0722L19.0611 8.57202L12.2607 14.6279L19.0847 21.4504L25.0919 17.9864C25.6229 17.6983 26.0665 17.2725 26.376 16.7537C26.6854 16.2349 26.8493 15.6422 26.8505 15.0381C26.8516 14.434 26.6899 13.8408 26.3824 13.3208C26.0749 12.8008 25.633 12.3734 25.103 12.0833Z" fill="#FBBC04"/>
  <path d="M0.116672 2.49553C0.047224 2.7761 0 3.05528 0 3.35946V26.6537C0 26.9565 0.0347234 27.237 0.116672 27.5162L12.959 14.6725L0.116672 2.49553Z" fill="#4285F4"/>
  <path d="M12.634 15.0001L19.0607 8.57198L5.0975 0.477133C4.65115 0.210463 4.14916 0.0506574 3.63079 0.0102139C3.11242 -0.0302296 2.59172 0.0497852 2.10941 0.244001C1.6271 0.438216 1.19625 0.741368 0.850556 1.12975C0.504864 1.51813 0.253698 1.98121 0.116699 2.48279L12.634 15.0001Z" fill="#34A853"/>
</svg>`,$6e=yi`<svg width="75" height="20" viewBox="0 0 75 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.6666 5.83334C11.6666 2.61168 14.2783 0 17.5 0H25.8334C29.055 0 31.6666 2.61168 31.6666 5.83334V14.1666C31.6666 17.3883 29.055 20 25.8334 20H17.5C14.2783 20 11.6666 17.3883 11.6666 14.1666V5.83334Z" fill="var(--apkt-tokens-theme-foregroundTertiary)"/>
<path d="M19.5068 13.7499L22.4309 5.83331H23.2895L20.3654 13.7499H19.5068Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M0 5.41666C0 2.42513 2.42513 0 5.41666 0C8.40821 0 10.8334 2.42513 10.8334 5.41666V14.5833C10.8334 17.5748 8.40821 20 5.41666 20C2.42513 20 0 17.5748 0 14.5833V5.41666Z" fill="var(--apkt-tokens-theme-foregroundTertiary)"/>
<path d="M4.89581 12.4997V11.458H5.93747V12.4997H4.89581Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M32.5 10C32.5 4.47715 36.6896 0 41.8578 0H65.6422C70.8104 0 75 4.47715 75 10C75 15.5229 70.8104 20 65.6422 20H41.8578C36.6896 20 32.5 15.5229 32.5 10Z" fill="var(--apkt-tokens-theme-foregroundTertiary)"/>
<path d="M61.7108 12.4475V7.82751H62.5266V8.52418C62.8199 8.01084 63.4157 7.70834 64.0757 7.70834C65.0749 7.70834 65.7715 8.34084 65.7715 9.56918V12.4475H64.9649V9.61503C64.9649 8.80831 64.5066 8.38668 63.8374 8.38668C63.1132 8.38668 62.5266 8.9642 62.5266 9.78001V12.4475H61.7108Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M56.5671 12.4475L55.7147 7.82748H56.4846L57.0896 11.6409L57.8871 9.12916H58.6479L59.4363 11.6134L60.0505 7.82748H60.8204L59.9679 12.4475H59.0513L58.2721 10.0458L57.4838 12.4475H56.5671Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M52.9636 12.5666C51.5611 12.5666 50.7361 11.5217 50.7361 10.1375C50.7361 8.76254 51.5611 7.70834 52.9636 7.70834C54.3661 7.70834 55.1911 8.76254 55.1911 10.1375C55.1911 11.5217 54.3661 12.5666 52.9636 12.5666ZM52.9636 11.8883C53.9719 11.8883 54.357 11.0266 54.357 10.1283C54.357 9.23914 53.9719 8.38668 52.9636 8.38668C51.9552 8.38668 51.5702 9.23914 51.5702 10.1283C51.5702 11.0266 51.9552 11.8883 52.9636 11.8883Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M47.8507 12.5666C46.494 12.5666 45.6415 11.5308 45.6415 10.1375C45.6415 8.75337 46.494 7.70834 47.8507 7.70834C48.9965 7.70834 50.0048 8.35917 49.8948 10.3483H46.4756C46.5398 11.2009 46.934 11.8975 47.8507 11.8975C48.4648 11.8975 48.8681 11.5217 49.0057 11.0908H49.8123C49.684 11.8609 48.9598 12.5666 47.8507 12.5666ZM46.494 9.73416H49.1065C49.0423 8.80831 48.6114 8.37751 47.8507 8.37751C47.0165 8.37751 46.604 8.98254 46.494 9.73416Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M41.7284 12.4475V7.82748H42.5625V8.60665C42.8559 8.09332 43.3601 7.82748 43.8825 7.82748H44.9917V8.60665H43.8184C43.0851 8.60665 42.5625 9.08331 42.5625 10.0092V12.4475H41.7284Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
</svg>

`,z6e=yi`
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 8">
    <path
      fill="var(--apkt-tokens-theme-textPrimary)"
      d="m9.524 6.307-1.51 1.584A.35.35 0 0 1 7.76 8H.604a.178.178 0 0 1-.161-.103.168.168 0 0 1 .033-.186l1.51-1.583a.35.35 0 0 1 .256-.11h7.154c.034 0 .068.01.096.029a.168.168 0 0 1 .032.26Zm-1.51-3.189a.35.35 0 0 0-.255-.109H.604a.178.178 0 0 0-.161.103.168.168 0 0 0 .033.186l1.51 1.583a.35.35 0 0 0 .256.11h7.154a.178.178 0 0 0 .16-.104.168.168 0 0 0-.032-.185l-1.51-1.584ZM.605 1.981H7.76a.357.357 0 0 0 .256-.11L9.525.289a.17.17 0 0 0 .032-.185.173.173 0 0 0-.16-.103H2.241a.357.357 0 0 0-.256.109L.476 1.692a.17.17 0 0 0-.033.185.178.178 0 0 0 .16.103Z"
    />
  </svg>
`,U6e=yi`<svg width="32" height="32" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
  <g clip-path="url(#a)">
    <path fill="url(#b)" d="M0 0h32v32H0z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.034 15.252c4.975-2.167 8.293-3.596 9.953-4.287 4.74-1.971 5.725-2.314 6.366-2.325.142-.002.457.033.662.198.172.14.22.33.243.463.022.132.05.435.028.671-.257 2.7-1.368 9.248-1.933 12.27-.24 1.28-.71 1.708-1.167 1.75-.99.091-1.743-.655-2.703-1.284-1.502-.985-2.351-1.598-3.81-2.558-1.684-1.11-.592-1.721.368-2.718.252-.261 4.619-4.233 4.703-4.594.01-.045.02-.213-.08-.301-.1-.09-.246-.059-.353-.035-.15.034-2.55 1.62-7.198 4.758-.682.468-1.298.696-1.851.684-.61-.013-1.782-.344-2.653-.628-1.069-.347-1.918-.53-1.845-1.12.039-.308.462-.623 1.27-.944Z" fill="#fff"/>
  </g>
  <path d="M.5 16C.5 7.44 7.44.5 16 .5 24.56.5 31.5 7.44 31.5 16c0 8.56-6.94 15.5-15.5 15.5C7.44 31.5.5 24.56.5 16Z" stroke="#141414" stroke-opacity=".05"/>
  <defs>
    <linearGradient id="b" x1="1600" y1="0" x2="1600" y2="3176.27" gradientUnits="userSpaceOnUse">
      <stop stop-color="#2AABEE"/>
      <stop offset="1" stop-color="#229ED9"/>
    </linearGradient>
    <clipPath id="a">
      <path d="M0 16C0 7.163 7.163 0 16 0s16 7.163 16 16-7.163 16-16 16S0 24.837 0 16Z" fill="#fff"/>
    </clipPath>
  </defs>
</svg>`,nY=yi`
  <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10">
  <path d="M8.37651 0H1.62309C0.381381 0 -0.405611 1.33944 0.219059 2.42225L4.38701 9.64649C4.659 10.1182 5.3406 10.1182 5.61259 9.64649L9.78139 2.42225C10.4052 1.34117 9.61822 0 8.37736 0H8.37651ZM4.38362 7.48005L3.47591 5.72329L1.2857 1.80606C1.14121 1.55534 1.31968 1.23405 1.62225 1.23405H4.38278V7.4809L4.38362 7.48005ZM8.71221 1.80521L6.52284 5.72414L5.61513 7.48005V1.2332H8.37566C8.67823 1.2332 8.85669 1.55449 8.71221 1.80521Z" fill="var(--apkt-tokens-theme-textPrimary)" />
</svg>
`,j6e=yi`<svg fill="none" viewBox="0 0 40 40">
  <g clip-path="url(#a)">
    <g clip-path="url(#b)">
      <circle cx="20" cy="19.89" r="20" fill="#5A3E85" />
      <g clip-path="url(#c)">
        <path
          fill="#fff"
          d="M18.22 25.7 20 23.91h3.34l2.1-2.1v-6.68H15.4v8.78h2.82v1.77Zm3.87-8.16h1.25v3.66H22.1v-3.66Zm-3.34 0H20v3.66h-1.25v-3.66ZM20 7.9a12 12 0 1 0 0 24 12 12 0 0 0 0-24Zm6.69 14.56-3.66 3.66h-2.72l-1.77 1.78h-1.88V26.1H13.3v-9.82l.94-2.4H26.7v8.56Z"
        />
      </g>
    </g>
  </g>
  <defs>
    <clipPath id="a"><rect width="40" height="40" fill="#fff" rx="20" /></clipPath>
    <clipPath id="b"><path fill="#fff" d="M0 0h40v40H0z" /></clipPath>
    <clipPath id="c"><path fill="#fff" d="M8 7.89h24v24H8z" /></clipPath>
  </defs>
</svg>`,V6e=yi`<svg fill="none" viewBox="0 0 16 16">
  <path
    fill="currentColor"
    d="m14.36 4.74.01.42c0 4.34-3.3 9.34-9.34 9.34A9.3 9.3 0 0 1 0 13.03a6.6 6.6 0 0 0 4.86-1.36 3.29 3.29 0 0 1-3.07-2.28c.5.1 1 .07 1.48-.06A3.28 3.28 0 0 1 .64 6.11v-.04c.46.26.97.4 1.49.41A3.29 3.29 0 0 1 1.11 2.1a9.32 9.32 0 0 0 6.77 3.43 3.28 3.28 0 0 1 5.6-3 6.59 6.59 0 0 0 2.08-.8 3.3 3.3 0 0 1-1.45 1.82A6.53 6.53 0 0 0 16 3.04c-.44.66-1 1.23-1.64 1.7Z"
  />
</svg>`,W6e=yi`
<svg xmlns="http://www.w3.org/2000/svg" width="89" height="89" viewBox="0 0 89 89" fill="none">
<path d="M60.0468 39.2502L65.9116 33.3854C52.6562 20.13 36.1858 20.13 22.9304 33.3854L28.7952 39.2502C38.8764 29.169 49.9725 29.169 60.0536 39.2502H60.0468Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
<path d="M58.0927 52.9146L44.415 39.2369L30.7373 52.9146L17.0596 39.2369L11.2017 45.0949L30.7373 64.6374L44.415 50.9597L58.0927 64.6374L77.6284 45.0949L71.7704 39.2369L58.0927 52.9146Z" fill="var(--apkt-tokens-theme-textPrimary)"/>
</svg>`,H6e=yi`
<svg xmlns="http://www.w3.org/2000/svg" width="89" height="89" viewBox="0 0 89 89" fill="none">
<path d="M60.0468 39.2502L65.9116 33.3854C52.6562 20.13 36.1858 20.13 22.9304 33.3854L28.7952 39.2502C38.8764 29.169 49.9725 29.169 60.0536 39.2502H60.0468Z" fill="var(--apkt-tokens-theme-textInvert)"/>
<path d="M58.0927 52.9146L44.415 39.2369L30.7373 52.9146L17.0596 39.2369L11.2017 45.0949L30.7373 64.6374L44.415 50.9597L58.0927 64.6374L77.6284 45.0949L71.7704 39.2369L58.0927 52.9146Z" fill="var(--apkt-tokens-theme-textInvert)"/>
</svg>`,G6e=yi`
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_22274_4692)">
<path d="M0 6.64C0 4.17295 0 2.93942 0.525474 2.01817C0.880399 1.39592 1.39592 0.880399 2.01817 0.525474C2.93942 0 4.17295 0 6.64 0H9.36C11.8271 0 13.0606 0 13.9818 0.525474C14.6041 0.880399 15.1196 1.39592 15.4745 2.01817C16 2.93942 16 4.17295 16 6.64V9.36C16 11.8271 16 13.0606 15.4745 13.9818C15.1196 14.6041 14.6041 15.1196 13.9818 15.4745C13.0606 16 11.8271 16 9.36 16H6.64C4.17295 16 2.93942 16 2.01817 15.4745C1.39592 15.1196 0.880399 14.6041 0.525474 13.9818C0 13.0606 0 11.8271 0 9.36V6.64Z" fill="#C7B994"/>
<path d="M4.49038 5.76609C6.42869 3.86833 9.5713 3.86833 11.5096 5.76609L11.7429 5.99449C11.8398 6.08938 11.8398 6.24323 11.7429 6.33811L10.9449 7.11942C10.8964 7.16686 10.8179 7.16686 10.7694 7.11942L10.4484 6.80512C9.09617 5.48119 6.90381 5.48119 5.5516 6.80512L5.20782 7.14171C5.15936 7.18915 5.08079 7.18915 5.03234 7.14171L4.23434 6.3604C4.13742 6.26552 4.13742 6.11167 4.23434 6.01678L4.49038 5.76609ZM13.1599 7.38192L13.8702 8.07729C13.9671 8.17217 13.9671 8.32602 13.8702 8.4209L10.6677 11.5564C10.5708 11.6513 10.4137 11.6513 10.3168 11.5564L8.04388 9.33105C8.01965 9.30733 7.98037 9.30733 7.95614 9.33105L5.6833 11.5564C5.58638 11.6513 5.42925 11.6513 5.33234 11.5564L2.12982 8.42087C2.0329 8.32598 2.0329 8.17213 2.12982 8.07724L2.84004 7.38188C2.93695 7.28699 3.09408 7.28699 3.191 7.38188L5.46392 9.60726C5.48815 9.63098 5.52743 9.63098 5.55166 9.60726L7.82447 7.38188C7.92138 7.28699 8.07851 7.28699 8.17543 7.38187L10.4484 9.60726C10.4726 9.63098 10.5119 9.63098 10.5361 9.60726L12.809 7.38192C12.9059 7.28703 13.063 7.28703 13.1599 7.38192Z" fill="currentColor"/>
</g>
<defs>
<clipPath id="clip0_22274_4692">
<path d="M0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8Z" fill="white"/>
</clipPath>
</defs>
</svg>
`,q6e=yi`
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<circle cx="11" cy="11" r="11" transform="matrix(-1 0 0 1 23 1)" fill="#202020"/>
<circle cx="11" cy="11" r="11.5" transform="matrix(-1 0 0 1 23 1)" stroke="#C7B994" stroke-opacity="0.7"/>
<path d="M15.4523 11.0686L16.7472 9.78167C13.8205 6.87297 10.1838 6.87297 7.25708 9.78167L8.55201 11.0686C10.7779 8.85645 13.2279 8.85645 15.4538 11.0686H15.4523Z" fill="#C7B994"/>
<path d="M15.0199 14.067L12 11.0656L8.98 14.067L5.96004 11.0656L4.66663 12.3511L8.98 16.6393L12 13.638L15.0199 16.6393L19.3333 12.3511L18.0399 11.0656L15.0199 14.067Z" fill="#C7B994"/>
</svg>
`,GU=yi`<svg fill="none" viewBox="0 0 41 40">
  <g clip-path="url(#a)">
    <path fill="#000" d="M.8 0h40v40H.8z" />
    <path
      fill="#fff"
      d="m22.63 18.46 7.14-8.3h-1.69l-6.2 7.2-4.96-7.2H11.2l7.5 10.9-7.5 8.71h1.7l6.55-7.61 5.23 7.61h5.72l-7.77-11.31Zm-9.13-7.03h2.6l11.98 17.13h-2.6L13.5 11.43Z"
    />
  </g>
  <defs>
    <clipPath id="a"><path fill="#fff" d="M.8 20a20 20 0 1 1 40 0 20 20 0 0 1-40 0Z" /></clipPath>
  </defs>
</svg>`,Z6e=rs`
  :host {
    display: flex;
    justify-content: center;
    align-items: center;
    aspect-ratio: 1 / 1;
    color: var(--local-color);
    width: var(--local-width);
  }

  svg {
    height: inherit;
    width: inherit;
    object-fit: contain;
    object-position: center;
  }
`;var zE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const K6e={add:"ph-plus",allWallets:"ph-dots-three",arrowBottom:"ph-arrow-down",arrowBottomCircle:"ph-arrow-circle-down",arrowClockWise:"ph-arrow-clockwise",arrowLeft:"ph-arrow-left",arrowRight:"ph-arrow-right",arrowTop:"ph-arrow-up",arrowTopRight:"ph-arrow-up-right",bank:"ph-bank",bin:"ph-trash",browser:"ph-browser",card:"ph-credit-card",checkmarkBold:"ph-check",chevronBottom:"ph-caret-down",chevronLeft:"ph-caret-left",chevronRight:"ph-caret-right",chevronTop:"ph-caret-up",clock:"ph-clock",close:"ph-x",coinPlaceholder:"ph-circle-half",compass:"ph-compass",copy:"ph-copy",desktop:"ph-desktop",dollar:"ph-currency-dollar",download:"ph-vault",exclamationCircle:"ph-warning-circle",extension:"ph-puzzle-piece",externalLink:"ph-arrow-square-out",filters:"ph-funnel-simple",helpCircle:"ph-question",id:"ph-identification-card",image:"ph-image",info:"ph-info",lightbulb:"ph-lightbulb",mail:"ph-envelope",mobile:"ph-device-mobile",more:"ph-dots-three",networkPlaceholder:"ph-globe",nftPlaceholder:"ph-image",plus:"ph-plus",power:"ph-power",qrCode:"ph-qr-code",questionMark:"ph-question",refresh:"ph-arrow-clockwise",recycleHorizontal:"ph-arrows-clockwise",search:"ph-magnifying-glass",sealCheck:"ph-seal-check",send:"ph-paper-plane-right",signOut:"ph-sign-out",spinner:"ph-spinner",swapHorizontal:"ph-arrows-left-right",swapVertical:"ph-arrows-down-up",threeDots:"ph-dots-three",user:"ph-user",verify:"ph-seal-check",verifyFilled:"ph-seal-check",wallet:"ph-wallet",warning:"ph-warning",warningCircle:"ph-warning-circle",appStore:"",apple:"",bitcoin:"",coins:"",chromeStore:"",cursor:"",discord:"",ethereum:"",etherscan:"",facebook:"",farcaster:"",github:"",google:"",playStore:"",paperPlaneTitle:"",reown:"",solana:"",ton:"",telegram:"",twitch:"",twitterIcon:"",twitter:"",walletConnect:"",walletConnectBrown:"",walletConnectLightBrown:"",x:"",infoSeal:"",checkmark:""},Y6e={"ph-arrow-circle-down":()=>Un(()=>import("./PhArrowCircleDown-B305t-Sh.js"),__vite__mapDeps([27,28])),"ph-arrow-clockwise":()=>Un(()=>import("./PhArrowClockwise-CJPxQhr_.js"),__vite__mapDeps([29,28])),"ph-arrow-down":()=>Un(()=>import("./PhArrowDown-C4hT9BVu.js"),__vite__mapDeps([30,28])),"ph-arrow-left":()=>Un(()=>import("./PhArrowLeft-Way4Cu-r.js"),__vite__mapDeps([31,28])),"ph-arrow-right":()=>Un(()=>import("./PhArrowRight-Cp5ZME0F.js"),__vite__mapDeps([32,28])),"ph-arrow-square-out":()=>Un(()=>import("./PhArrowSquareOut-NnrK69c5.js"),__vite__mapDeps([33,28])),"ph-arrows-down-up":()=>Un(()=>import("./PhArrowsDownUp-BjBI4ckC.js"),__vite__mapDeps([34,28])),"ph-arrows-left-right":()=>Un(()=>import("./PhArrowsLeftRight-CuLpbKRk.js"),__vite__mapDeps([35,28])),"ph-arrow-up":()=>Un(()=>import("./PhArrowUp-Dph6j8rm.js"),__vite__mapDeps([36,28])),"ph-arrow-up-right":()=>Un(()=>import("./PhArrowUpRight-BpJjRRRh.js"),__vite__mapDeps([37,28])),"ph-arrows-clockwise":()=>Un(()=>import("./PhArrowsClockwise-CFUT8X7R.js"),__vite__mapDeps([38,28])),"ph-bank":()=>Un(()=>import("./PhBank-Dchr4XQJ.js"),__vite__mapDeps([39,28])),"ph-browser":()=>Un(()=>import("./PhBrowser-dUu2TrC1.js"),__vite__mapDeps([40,28])),"ph-caret-down":()=>Un(()=>import("./PhCaretDown-78IuKU3V.js"),__vite__mapDeps([41,28])),"ph-caret-left":()=>Un(()=>import("./PhCaretLeft-_aiyH7n1.js"),__vite__mapDeps([42,28])),"ph-caret-right":()=>Un(()=>import("./PhCaretRight-8zJQEuDX.js"),__vite__mapDeps([43,28])),"ph-caret-up":()=>Un(()=>import("./PhCaretUp-CiCxKWwN.js"),__vite__mapDeps([44,28])),"ph-check":()=>Un(()=>import("./PhCheck-CcADx8br.js"),__vite__mapDeps([45,28])),"ph-circle-half":()=>Un(()=>import("./PhCircleHalf-BYzSzd2h.js"),__vite__mapDeps([46,28])),"ph-clock":()=>Un(()=>import("./PhClock-UItiXeJq.js"),__vite__mapDeps([47,28])),"ph-compass":()=>Un(()=>import("./PhCompass-CUy3uA7t.js"),__vite__mapDeps([48,28])),"ph-copy":()=>Un(()=>import("./PhCopy-C-PDgSlZ.js"),__vite__mapDeps([49,28])),"ph-credit-card":()=>Un(()=>import("./PhCreditCard-CWRaUT6F.js"),__vite__mapDeps([50,28])),"ph-currency-dollar":()=>Un(()=>import("./PhCurrencyDollar-Cqla3AXT.js"),__vite__mapDeps([51,28])),"ph-desktop":()=>Un(()=>import("./PhDesktop-BBIPrYLl.js"),__vite__mapDeps([52,28])),"ph-device-mobile":()=>Un(()=>import("./PhDeviceMobile-BdsPaATg.js"),__vite__mapDeps([53,28])),"ph-dots-three":()=>Un(()=>import("./PhDotsThree-BMXCQl-0.js"),__vite__mapDeps([54,28])),"ph-vault":()=>Un(()=>import("./PhVault-l2PHF38a.js"),__vite__mapDeps([55,28])),"ph-envelope":()=>Un(()=>import("./PhEnvelope-yUsis6yU.js"),__vite__mapDeps([56,28])),"ph-funnel-simple":()=>Un(()=>import("./PhFunnelSimple-Ba7BbWTp.js"),__vite__mapDeps([57,28])),"ph-globe":()=>Un(()=>import("./PhGlobe-DgLxBk5U.js"),__vite__mapDeps([58,28])),"ph-identification-card":()=>Un(()=>import("./PhIdentificationCard-Czjmq9Z3.js"),__vite__mapDeps([59,28])),"ph-image":()=>Un(()=>import("./PhImage-BAJ_erz6.js"),__vite__mapDeps([60,28])),"ph-info":()=>Un(()=>import("./PhInfo-Cr4DhVUE.js"),__vite__mapDeps([61,28])),"ph-lightbulb":()=>Un(()=>import("./PhLightbulb-BX_7duTr.js"),__vite__mapDeps([62,28])),"ph-magnifying-glass":()=>Un(()=>import("./PhMagnifyingGlass-Mygfryvz.js"),__vite__mapDeps([63,28])),"ph-paper-plane-right":()=>Un(()=>import("./PhPaperPlaneRight-BeuCA660.js"),__vite__mapDeps([64,28])),"ph-plus":()=>Un(()=>import("./PhPlus-BMjcHjsT.js"),__vite__mapDeps([65,28])),"ph-power":()=>Un(()=>import("./PhPower-CGffGmdb.js"),__vite__mapDeps([66,28])),"ph-puzzle-piece":()=>Un(()=>import("./PhPuzzlePiece-wm_GpVSi.js"),__vite__mapDeps([67,28])),"ph-qr-code":()=>Un(()=>import("./PhQrCode-DRwRzXCH.js"),__vite__mapDeps([68,28])),"ph-question":()=>Un(()=>import("./PhQuestion-M09j2U0T.js"),__vite__mapDeps([69,28])),"ph-question-circle":()=>Un(()=>import("./PhQuestionMark-BP9EMB6h.js"),__vite__mapDeps([70,28])),"ph-seal-check":()=>Un(()=>import("./PhSealCheck-BfG80yKn.js"),__vite__mapDeps([71,28])),"ph-sign-out":()=>Un(()=>import("./PhSignOut-C5YOWlPT.js"),__vite__mapDeps([72,28])),"ph-spinner":()=>Un(()=>import("./PhSpinner-BXooDYzU.js"),__vite__mapDeps([73,28])),"ph-trash":()=>Un(()=>import("./PhTrash-Biq6rmmL.js"),__vite__mapDeps([74,28])),"ph-user":()=>Un(()=>import("./PhUser-CAgZSpGe.js"),__vite__mapDeps([75,28])),"ph-wallet":()=>Un(()=>import("./PhWallet-w25D16It.js"),__vite__mapDeps([76,28])),"ph-warning":()=>Un(()=>import("./PhWarning-DPEydIPw.js"),__vite__mapDeps([77,28])),"ph-warning-circle":()=>Un(()=>import("./PhWarningCircle-BqjT745H.js"),__vite__mapDeps([78,28])),"ph-x":()=>Un(()=>import("./PhX-s-SmVExa.js"),__vite__mapDeps([79,28]))},X6e={appStore:x6e,apple:E6e,bitcoin:C6e,coins:S6e,chromeStore:A6e,cursor:I6e,discord:P6e,ethereum:R6e,etherscan:O6e,facebook:k6e,farcaster:D6e,github:N6e,google:M6e,playStore:F6e,paperPlaneTitle:B6e,reown:$6e,solana:z6e,ton:nY,telegram:U6e,twitch:j6e,twitter:GU,twitterIcon:V6e,walletConnect:W6e,walletConnectInvert:H6e,walletConnectBrown:q6e,walletConnectLightBrown:G6e,x:GU,infoSeal:L6e,checkmark:T6e},J6e={"accent-primary":Ss.tokens.core.iconAccentPrimary,"accent-certified":Ss.tokens.core.iconAccentCertified,"foreground-secondary":Ss.tokens.theme.foregroundSecondary,default:Ss.tokens.theme.iconDefault,success:Ss.tokens.core.iconSuccess,error:Ss.tokens.core.iconError,warning:Ss.tokens.core.iconWarning,inverse:Ss.tokens.theme.iconInverse};let sy=class extends on{constructor(){super(...arguments),this.size="md",this.name="copy",this.weight="bold",this.color="inherit"}render(){const e={xxs:"2",xs:"3",sm:"3",md:"4",mdl:"5",lg:"5",xl:"6",xxl:"7",inherit:"inherit"};this.style.cssText=`
      --local-width: ${this.size==="inherit"?"inherit":`var(--apkt-spacing-${e[this.size]})`};
      --local-color: ${this.color==="inherit"?"inherit":J6e[this.color]}
    `;const n=K6e[this.name];if(n&&n!==""){const i=Y6e[n];i&&i();const o=b6e(n);return HU`<${o} size=${{xxs:"0.5em",xs:"0.75em",sm:"0.75em",md:"1em",mdl:"1.25em",lg:"1.25em",xl:"1.5em",xxl:"1.75em"}[this.size]} weight="${this.weight}"></${o}>`}return X6e[this.name]||HU``}};sy.styles=[Ei,Z6e];zE([Fe()],sy.prototype,"size",void 0);zE([Fe()],sy.prototype,"name",void 0);zE([Fe()],sy.prototype,"weight",void 0);zE([Fe()],sy.prototype,"color",void 0);sy=zE([nn("wui-icon")],sy);const Q6e=Fn`
  :host {
    display: block;
    width: var(--local-width);
    height: var(--local-height);
  }

  img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    border-radius: inherit;
    user-select: none;
    user-drag: none;
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
  }

  :host([data-boxed='true']) {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  :host([data-boxed='true']) img {
    width: 20px;
    height: 20px;
    border-radius: ${({borderRadius:t})=>t[16]};
  }

  :host([data-full='true']) img {
    width: 100%;
    height: 100%;
  }

  :host([data-boxed='true']) wui-icon {
    width: 20px;
    height: 20px;
  }

  :host([data-icon='error']) {
    background-color: ${({tokens:t})=>t.core.backgroundError};
  }

  :host([data-rounded='true']) {
    border-radius: ${({borderRadius:t})=>t[16]};
  }
`;var Mh=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Su=class extends on{constructor(){super(...arguments),this.src="./path/to/image.jpg",this.alt="Image",this.size=void 0,this.boxed=!1,this.rounded=!1,this.fullSize=!1}render(){const e={inherit:"inherit",xxs:"2",xs:"3",sm:"4",md:"4",mdl:"5",lg:"5",xl:"6",xxl:"7","3xl":"8","4xl":"9","5xl":"10"};return this.style.cssText=`
      --local-width: ${this.size?`var(--apkt-spacing-${e[this.size]});`:"100%"};
      --local-height: ${this.size?`var(--apkt-spacing-${e[this.size]});`:"100%"};
      `,this.dataset.boxed=this.boxed?"true":"false",this.dataset.rounded=this.rounded?"true":"false",this.dataset.full=this.fullSize?"true":"false",this.dataset.icon=this.iconColor||"inherit",this.icon?we`<wui-icon
        color=${this.iconColor||"inherit"}
        name=${this.icon}
        size="lg"
      ></wui-icon> `:this.logo?we`<wui-icon size="lg" color="inherit" name=${this.logo}></wui-icon> `:we`<img src=${Tn(this.src)} alt=${this.alt} @error=${this.handleImageError} />`}handleImageError(){this.dispatchEvent(new CustomEvent("onLoadError",{bubbles:!0,composed:!0}))}};Su.styles=[Ei,Q6e];Mh([Fe()],Su.prototype,"src",void 0);Mh([Fe()],Su.prototype,"logo",void 0);Mh([Fe()],Su.prototype,"icon",void 0);Mh([Fe()],Su.prototype,"iconColor",void 0);Mh([Fe()],Su.prototype,"alt",void 0);Mh([Fe()],Su.prototype,"size",void 0);Mh([Fe({type:Boolean})],Su.prototype,"boxed",void 0);Mh([Fe({type:Boolean})],Su.prototype,"rounded",void 0);Mh([Fe({type:Boolean})],Su.prototype,"fullSize",void 0);Su=Mh([nn("wui-image")],Su);const e4e=rs`
  :host {
    display: flex;
  }

  :host([data-size='sm']) > svg {
    width: 12px;
    height: 12px;
  }

  :host([data-size='md']) > svg {
    width: 16px;
    height: 16px;
  }

  :host([data-size='lg']) > svg {
    width: 24px;
    height: 24px;
  }

  :host([data-size='xl']) > svg {
    width: 32px;
    height: 32px;
  }

  svg {
    animation: rotate 1.4s linear infinite;
    color: var(--local-color);
  }

  :host([data-size='md']) > svg > circle {
    stroke-width: 6px;
  }

  :host([data-size='sm']) > svg > circle {
    stroke-width: 8px;
  }

  @keyframes rotate {
    100% {
      transform: rotate(360deg);
    }
  }
`;var GD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let q2=class extends on{constructor(){super(...arguments),this.color="primary",this.size="lg"}render(){const e={primary:Ss.tokens.theme.textPrimary,secondary:Ss.tokens.theme.textSecondary,tertiary:Ss.tokens.theme.textTertiary,invert:Ss.tokens.theme.textInvert,error:Ss.tokens.core.textError,warning:Ss.tokens.core.textWarning,"accent-primary":Ss.tokens.core.textAccentPrimary};return this.style.cssText=`
      --local-color: ${this.color==="inherit"?"inherit":e[this.color]};
      `,this.dataset.size=this.size,we`<svg viewBox="0 0 16 17" fill="none">
      <path
        d="M8.75 2.65625V4.65625C8.75 4.85516 8.67098 5.04593 8.53033 5.18658C8.38968 5.32723 8.19891 5.40625 8 5.40625C7.80109 5.40625 7.61032 5.32723 7.46967 5.18658C7.32902 5.04593 7.25 4.85516 7.25 4.65625V2.65625C7.25 2.45734 7.32902 2.26657 7.46967 2.12592C7.61032 1.98527 7.80109 1.90625 8 1.90625C8.19891 1.90625 8.38968 1.98527 8.53033 2.12592C8.67098 2.26657 8.75 2.45734 8.75 2.65625ZM14 7.90625H12C11.8011 7.90625 11.6103 7.98527 11.4697 8.12592C11.329 8.26657 11.25 8.45734 11.25 8.65625C11.25 8.85516 11.329 9.04593 11.4697 9.18658C11.6103 9.32723 11.8011 9.40625 12 9.40625H14C14.1989 9.40625 14.3897 9.32723 14.5303 9.18658C14.671 9.04593 14.75 8.85516 14.75 8.65625C14.75 8.45734 14.671 8.26657 14.5303 8.12592C14.3897 7.98527 14.1989 7.90625 14 7.90625ZM11.3588 10.9544C11.289 10.8846 11.2062 10.8293 11.115 10.7915C11.0239 10.7538 10.9262 10.7343 10.8275 10.7343C10.7288 10.7343 10.6311 10.7538 10.54 10.7915C10.4488 10.8293 10.366 10.8846 10.2963 10.9544C10.2265 11.0241 10.1711 11.107 10.1334 11.1981C10.0956 11.2893 10.0762 11.387 10.0762 11.4856C10.0762 11.5843 10.0956 11.682 10.1334 11.7731C10.1711 11.8643 10.2265 11.9471 10.2963 12.0169L11.7106 13.4312C11.8515 13.5721 12.0426 13.6513 12.2419 13.6513C12.4411 13.6513 12.6322 13.5721 12.7731 13.4312C12.914 13.2904 12.9932 13.0993 12.9932 12.9C12.9932 12.7007 12.914 12.5096 12.7731 12.3687L11.3588 10.9544ZM8 11.9062C7.80109 11.9062 7.61032 11.9853 7.46967 12.1259C7.32902 12.2666 7.25 12.4573 7.25 12.6562V14.6562C7.25 14.8552 7.32902 15.0459 7.46967 15.1866C7.61032 15.3272 7.80109 15.4062 8 15.4062C8.19891 15.4062 8.38968 15.3272 8.53033 15.1866C8.67098 15.0459 8.75 14.8552 8.75 14.6562V12.6562C8.75 12.4573 8.67098 12.2666 8.53033 12.1259C8.38968 11.9853 8.19891 11.9062 8 11.9062ZM4.64125 10.9544L3.22688 12.3687C3.08598 12.5096 3.00682 12.7007 3.00682 12.9C3.00682 13.0993 3.08598 13.2904 3.22688 13.4312C3.36777 13.5721 3.55887 13.6513 3.75813 13.6513C3.95738 13.6513 4.14848 13.5721 4.28937 13.4312L5.70375 12.0169C5.84465 11.876 5.9238 11.6849 5.9238 11.4856C5.9238 11.2864 5.84465 11.0953 5.70375 10.9544C5.56285 10.8135 5.37176 10.7343 5.1725 10.7343C4.97324 10.7343 4.78215 10.8135 4.64125 10.9544ZM4.75 8.65625C4.75 8.45734 4.67098 8.26657 4.53033 8.12592C4.38968 7.98527 4.19891 7.90625 4 7.90625H2C1.80109 7.90625 1.61032 7.98527 1.46967 8.12592C1.32902 8.26657 1.25 8.45734 1.25 8.65625C1.25 8.85516 1.32902 9.04593 1.46967 9.18658C1.61032 9.32723 1.80109 9.40625 2 9.40625H4C4.19891 9.40625 4.38968 9.32723 4.53033 9.18658C4.67098 9.04593 4.75 8.85516 4.75 8.65625ZM4.2875 3.88313C4.1466 3.74223 3.95551 3.66307 3.75625 3.66307C3.55699 3.66307 3.3659 3.74223 3.225 3.88313C3.0841 4.02402 3.00495 4.21512 3.00495 4.41438C3.00495 4.61363 3.0841 4.80473 3.225 4.94562L4.64125 6.35813C4.78215 6.49902 4.97324 6.57818 5.1725 6.57818C5.37176 6.57818 5.56285 6.49902 5.70375 6.35813C5.84465 6.21723 5.9238 6.02613 5.9238 5.82688C5.9238 5.62762 5.84465 5.43652 5.70375 5.29563L4.2875 3.88313Z"
        fill="currentColor"
      />
    </svg>`}};q2.styles=[Ei,e4e];GD([Fe()],q2.prototype,"color",void 0);GD([Fe()],q2.prototype,"size",void 0);q2=GD([nn("wui-loading-spinner")],q2);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const iY={ATTRIBUTE:1,CHILD:2},rY=t=>(...e)=>({_$litDirective$:t,values:e});class sY{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,n,i){this._$Ct=e,this._$AM=n,this._$Ci=i}_$AS(e,n){return this.update(e,n)}update(e,n){return this.render(...n)}}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const qD=rY(class extends sY{constructor(t){var e;if(super(t),t.type!==iY.ATTRIBUTE||t.name!=="class"||((e=t.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){var i,o;if(this.st===void 0){this.st=new Set,t.strings!==void 0&&(this.nt=new Set(t.strings.join(" ").split(/\s/).filter(l=>l!=="")));for(const l in e)e[l]&&!((i=this.nt)!=null&&i.has(l))&&this.st.add(l);return this.render(e)}const n=t.element.classList;for(const l of this.st)l in e||(n.remove(l),this.st.delete(l));for(const l in e){const h=!!e[l];h===this.st.has(l)||(o=this.nt)!=null&&o.has(l)||(h?(n.add(l),this.st.add(l)):(n.remove(l),this.st.delete(l)))}return ry}}),t4e=Fn`
  slot {
    width: 100%;
    display: inline-block;
    font-style: normal;
    overflow: inherit;
    text-overflow: inherit;
    text-align: var(--local-align);
    color: var(--local-color);
  }

  .wui-line-clamp-1 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
  }

  .wui-line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }

  /* -- Headings --------------------------------------------------- */
  .wui-font-h1-regular-mono {
    font-size: ${({textSize:t})=>t.h1};
    line-height: ${({typography:t})=>t["h1-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h1-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-h1-regular {
    font-size: ${({textSize:t})=>t.h1};
    line-height: ${({typography:t})=>t["h1-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h1-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h1-medium {
    font-size: ${({textSize:t})=>t.h1};
    line-height: ${({typography:t})=>t["h1-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h1-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h2-regular-mono {
    font-size: ${({textSize:t})=>t.h2};
    line-height: ${({typography:t})=>t["h2-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h2-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-h2-regular {
    font-size: ${({textSize:t})=>t.h2};
    line-height: ${({typography:t})=>t["h2-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h2-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h2-medium {
    font-size: ${({textSize:t})=>t.h2};
    line-height: ${({typography:t})=>t["h2-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h2-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h3-regular-mono {
    font-size: ${({textSize:t})=>t.h3};
    line-height: ${({typography:t})=>t["h3-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h3-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-h3-regular {
    font-size: ${({textSize:t})=>t.h3};
    line-height: ${({typography:t})=>t["h3-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h3-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h3-medium {
    font-size: ${({textSize:t})=>t.h3};
    line-height: ${({typography:t})=>t["h3-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h3-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h4-regular-mono {
    font-size: ${({textSize:t})=>t.h4};
    line-height: ${({typography:t})=>t["h4-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h4-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-h4-regular {
    font-size: ${({textSize:t})=>t.h4};
    line-height: ${({typography:t})=>t["h4-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h4-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h4-medium {
    font-size: ${({textSize:t})=>t.h4};
    line-height: ${({typography:t})=>t["h4-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h4-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h5-regular-mono {
    font-size: ${({textSize:t})=>t.h5};
    line-height: ${({typography:t})=>t["h5-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h5-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-h5-regular {
    font-size: ${({textSize:t})=>t.h5};
    line-height: ${({typography:t})=>t["h5-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h5-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h5-medium {
    font-size: ${({textSize:t})=>t.h5};
    line-height: ${({typography:t})=>t["h5-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h5-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h6-regular-mono {
    font-size: ${({textSize:t})=>t.h6};
    line-height: ${({typography:t})=>t["h6-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h6-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-h6-regular {
    font-size: ${({textSize:t})=>t.h6};
    line-height: ${({typography:t})=>t["h6-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h6-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-h6-medium {
    font-size: ${({textSize:t})=>t.h6};
    line-height: ${({typography:t})=>t["h6-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["h6-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-lg-regular-mono {
    font-size: ${({textSize:t})=>t.large};
    line-height: ${({typography:t})=>t["lg-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["lg-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-lg-regular {
    font-size: ${({textSize:t})=>t.large};
    line-height: ${({typography:t})=>t["lg-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["lg-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-lg-medium {
    font-size: ${({textSize:t})=>t.large};
    line-height: ${({typography:t})=>t["lg-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["lg-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-md-regular-mono {
    font-size: ${({textSize:t})=>t.medium};
    line-height: ${({typography:t})=>t["md-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["md-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-md-regular {
    font-size: ${({textSize:t})=>t.medium};
    line-height: ${({typography:t})=>t["md-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["md-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-md-medium {
    font-size: ${({textSize:t})=>t.medium};
    line-height: ${({typography:t})=>t["md-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["md-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-sm-regular-mono {
    font-size: ${({textSize:t})=>t.small};
    line-height: ${({typography:t})=>t["sm-regular-mono"].lineHeight};
    letter-spacing: ${({typography:t})=>t["sm-regular-mono"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.mono};
  }

  .wui-font-sm-regular {
    font-size: ${({textSize:t})=>t.small};
    line-height: ${({typography:t})=>t["sm-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["sm-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }

  .wui-font-sm-medium {
    font-size: ${({textSize:t})=>t.small};
    line-height: ${({typography:t})=>t["sm-medium"].lineHeight};
    letter-spacing: ${({typography:t})=>t["sm-medium"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.medium};
    font-family: ${({fontFamily:t})=>t.regular};
    font-feature-settings:
      'liga' off,
      'clig' off;
  }
`;var $w=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const n4e={primary:Ss.tokens.theme.textPrimary,secondary:Ss.tokens.theme.textSecondary,tertiary:Ss.tokens.theme.textTertiary,invert:Ss.tokens.theme.textInvert,error:Ss.tokens.core.textError,success:Ss.tokens.core.textSuccess,warning:Ss.tokens.core.textWarning,"accent-primary":Ss.tokens.core.textAccentPrimary};let zm=class extends on{constructor(){super(...arguments),this.variant="md-regular",this.color="inherit",this.align="left",this.lineClamp=void 0,this.display="inline-flex"}render(){const e={[`wui-font-${this.variant}`]:!0,[`wui-line-clamp-${this.lineClamp}`]:!!this.lineClamp};return this.style.cssText=`
      display: ${this.display};
      --local-align: ${this.align};
      --local-color: ${this.color==="inherit"?"inherit":n4e[this.color??"primary"]};
      `,we`<slot class=${qD(e)}></slot>`}};zm.styles=[Ei,t4e];$w([Fe()],zm.prototype,"variant",void 0);$w([Fe()],zm.prototype,"color",void 0);$w([Fe()],zm.prototype,"align",void 0);$w([Fe()],zm.prototype,"lineClamp",void 0);$w([Fe()],zm.prototype,"display",void 0);zm=$w([nn("wui-text")],zm);const i4e=rs`
  :host {
    display: flex;
    width: inherit;
    height: inherit;
    box-sizing: border-box;
  }
`;var pl=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let ec=class extends on{render(){return this.style.cssText=`
      flex-direction: ${this.flexDirection};
      flex-wrap: ${this.flexWrap};
      flex-basis: ${this.flexBasis};
      flex-grow: ${this.flexGrow};
      flex-shrink: ${this.flexShrink};
      align-items: ${this.alignItems};
      justify-content: ${this.justifyContent};
      column-gap: ${this.columnGap&&`var(--apkt-spacing-${this.columnGap})`};
      row-gap: ${this.rowGap&&`var(--apkt-spacing-${this.rowGap})`};
      gap: ${this.gap&&`var(--apkt-spacing-${this.gap})`};
      padding-top: ${this.padding&&us.getSpacingStyles(this.padding,0)};
      padding-right: ${this.padding&&us.getSpacingStyles(this.padding,1)};
      padding-bottom: ${this.padding&&us.getSpacingStyles(this.padding,2)};
      padding-left: ${this.padding&&us.getSpacingStyles(this.padding,3)};
      margin-top: ${this.margin&&us.getSpacingStyles(this.margin,0)};
      margin-right: ${this.margin&&us.getSpacingStyles(this.margin,1)};
      margin-bottom: ${this.margin&&us.getSpacingStyles(this.margin,2)};
      margin-left: ${this.margin&&us.getSpacingStyles(this.margin,3)};
      width: ${this.width};
    `,we`<slot></slot>`}};ec.styles=[Ei,i4e];pl([Fe()],ec.prototype,"flexDirection",void 0);pl([Fe()],ec.prototype,"flexWrap",void 0);pl([Fe()],ec.prototype,"flexBasis",void 0);pl([Fe()],ec.prototype,"flexGrow",void 0);pl([Fe()],ec.prototype,"flexShrink",void 0);pl([Fe()],ec.prototype,"alignItems",void 0);pl([Fe()],ec.prototype,"justifyContent",void 0);pl([Fe()],ec.prototype,"columnGap",void 0);pl([Fe()],ec.prototype,"rowGap",void 0);pl([Fe()],ec.prototype,"gap",void 0);pl([Fe()],ec.prototype,"padding",void 0);pl([Fe()],ec.prototype,"margin",void 0);pl([Fe()],ec.prototype,"width",void 0);ec=pl([nn("wui-flex")],ec);const r4e=Fn`
  :host {
    display: block;
    width: var(--local-width);
    height: var(--local-height);
    border-radius: ${({borderRadius:t})=>t[16]};
    overflow: hidden;
    position: relative;
  }

  :host([data-variant='generated']) {
    --mixed-local-color-1: var(--local-color-1);
    --mixed-local-color-2: var(--local-color-2);
    --mixed-local-color-3: var(--local-color-3);
    --mixed-local-color-4: var(--local-color-4);
    --mixed-local-color-5: var(--local-color-5);
  }

  :host([data-variant='generated']) {
    background: radial-gradient(
      var(--local-radial-circle),
      #fff 0.52%,
      var(--mixed-local-color-5) 31.25%,
      var(--mixed-local-color-3) 51.56%,
      var(--mixed-local-color-2) 65.63%,
      var(--mixed-local-color-1) 82.29%,
      var(--mixed-local-color-4) 100%
    );
  }

  :host([data-variant='default']) {
    background: radial-gradient(
      75.29% 75.29% at 64.96% 24.36%,
      #fff 0.52%,
      #f5ccfc 31.25%,
      #dba4f5 51.56%,
      #9a8ee8 65.63%,
      #6493da 82.29%,
      #6ebdea 100%
    );
  }
`;var UE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let oy=class extends on{constructor(){super(...arguments),this.imageSrc=void 0,this.alt=void 0,this.address=void 0,this.size="xl"}render(){const e={inherit:"inherit",xxs:"3",xs:"5",sm:"6",md:"8",mdl:"8",lg:"10",xl:"16",xxl:"20"};return this.style.cssText=`
    --local-width: var(--apkt-spacing-${e[this.size??"xl"]});
    --local-height: var(--apkt-spacing-${e[this.size??"xl"]});
    `,we`${this.visualTemplate()}`}visualTemplate(){if(this.imageSrc)return this.dataset.variant="image",we`<wui-image src=${this.imageSrc} alt=${this.alt??"avatar"}></wui-image>`;if(this.address){this.dataset.variant="generated";const e=us.generateAvatarColors(this.address);return this.style.cssText+=`
 ${e}`,null}return this.dataset.variant="default",null}};oy.styles=[Ei,r4e];UE([Fe()],oy.prototype,"imageSrc",void 0);UE([Fe()],oy.prototype,"alt",void 0);UE([Fe()],oy.prototype,"address",void 0);UE([Fe()],oy.prototype,"size",void 0);oy=UE([nn("wui-avatar")],oy);const s4e=Fn`
  :host {
    display: block;
  }

  button {
    border-radius: ${({borderRadius:t})=>t[20]};
    background: ${({tokens:t})=>t.theme.foregroundPrimary};
    display: flex;
    gap: ${({spacing:t})=>t[1]};
    padding: ${({spacing:t})=>t[1]};
    color: ${({tokens:t})=>t.theme.textSecondary};
    border-radius: ${({borderRadius:t})=>t[16]};
    height: 32px;
    transition: box-shadow ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: box-shadow;
  }

  button wui-flex.avatar-container {
    width: 28px;
    height: 24px;
    position: relative;

    wui-flex.network-image-container {
      position: absolute;
      bottom: 0px;
      right: 0px;
      width: 12px;
      height: 12px;
    }

    wui-flex.network-image-container wui-icon {
      background: ${({tokens:t})=>t.theme.foregroundPrimary};
    }

    wui-avatar {
      width: 24px;
      min-width: 24px;
      height: 24px;
    }

    wui-icon {
      width: 12px;
      height: 12px;
    }
  }

  wui-image,
  wui-icon {
    border-radius: ${({borderRadius:t})=>t[16]};
  }

  wui-text {
    white-space: nowrap;
  }

  button wui-flex.balance-container {
    height: 100%;
    border-radius: ${({borderRadius:t})=>t[16]};
    padding-left: ${({spacing:t})=>t[1]};
    padding-right: ${({spacing:t})=>t[1]};
    background: ${({tokens:t})=>t.theme.foregroundSecondary};
    color: ${({tokens:t})=>t.theme.textPrimary};
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color;
  }

  /* -- Hover & Active states ----------------------------------------------------------- */
  button:hover:enabled,
  button:focus-visible:enabled,
  button:active:enabled {
    box-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.2);

    wui-flex.balance-container {
      background: ${({tokens:t})=>t.theme.foregroundTertiary};
    }
  }

  /* -- Disabled states --------------------------------------------------- */
  button:disabled wui-text,
  button:disabled wui-flex.avatar-container {
    opacity: 0.3;
  }
`;var Ed=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let jl=class extends on{constructor(){super(...arguments),this.networkSrc=void 0,this.avatarSrc=void 0,this.balance=void 0,this.isUnsupportedChain=void 0,this.disabled=!1,this.loading=!1,this.address="",this.profileName="",this.charsStart=4,this.charsEnd=6}render(){return we`
      <button
        ?disabled=${this.disabled}
        class=${Tn(this.balance?void 0:"local-no-balance")}
        data-error=${Tn(this.isUnsupportedChain)}
      >
        ${this.imageTemplate()} ${this.addressTemplate()} ${this.balanceTemplate()}
      </button>
    `}imageTemplate(){const e=this.networkSrc?we`<wui-image src=${this.networkSrc}></wui-image>`:we` <wui-icon size="inherit" color="inherit" name="networkPlaceholder"></wui-icon> `;return we`<wui-flex class="avatar-container">
      <wui-avatar
        .imageSrc=${this.avatarSrc}
        alt=${this.address}
        address=${this.address}
      ></wui-avatar>

      <wui-flex class="network-image-container">${e}</wui-flex>
    </wui-flex>`}addressTemplate(){return we`<wui-text variant="md-regular" color="inherit">
      ${this.address?us.getTruncateString({string:this.profileName||this.address,charsStart:this.profileName?18:this.charsStart,charsEnd:this.profileName?0:this.charsEnd,truncate:this.profileName?"end":"middle"}):null}
    </wui-text>`}balanceTemplate(){if(this.balance){const e=this.loading?we`<wui-loading-spinner size="md" color="inherit"></wui-loading-spinner>`:we`<wui-text variant="md-regular" color="inherit"> ${this.balance}</wui-text>`;return we`<wui-flex alignItems="center" justifyContent="center" class="balance-container"
        >${e}</wui-flex
      >`}return null}};jl.styles=[Ei,Kr,s4e];Ed([Fe()],jl.prototype,"networkSrc",void 0);Ed([Fe()],jl.prototype,"avatarSrc",void 0);Ed([Fe()],jl.prototype,"balance",void 0);Ed([Fe({type:Boolean})],jl.prototype,"isUnsupportedChain",void 0);Ed([Fe({type:Boolean})],jl.prototype,"disabled",void 0);Ed([Fe({type:Boolean})],jl.prototype,"loading",void 0);Ed([Fe()],jl.prototype,"address",void 0);Ed([Fe()],jl.prototype,"profileName",void 0);Ed([Fe()],jl.prototype,"charsStart",void 0);Ed([Fe()],jl.prototype,"charsEnd",void 0);jl=Ed([nn("wui-account-button")],jl);var Lc=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};class Bc extends on{constructor(){super(...arguments),this.unsubscribe=[],this.disabled=!1,this.balance="show",this.charsStart=4,this.charsEnd=6,this.namespace=void 0,this.isSupported=ut.state.allowUnsupportedChain?!0:ue.state.activeChain?ue.checkIfSupportedNetwork(ue.state.activeChain):!0}connectedCallback(){super.connectedCallback(),this.setAccountData(ue.getAccountData(this.namespace)),this.setNetworkData(ue.getNetworkData(this.namespace))}firstUpdated(){const e=this.namespace;e?this.unsubscribe.push(ue.subscribeChainProp("accountState",n=>{this.setAccountData(n)},e),ue.subscribeChainProp("networkState",n=>{var i;this.setNetworkData(n),this.isSupported=ue.checkIfSupportedNetwork(e,(i=n==null?void 0:n.caipNetwork)==null?void 0:i.caipNetworkId)},e)):this.unsubscribe.push(_o.subscribeNetworkImages(()=>{this.networkImage=Ur.getNetworkImage(this.network)}),ue.subscribeKey("activeCaipAddress",n=>{this.caipAddress=n}),ue.subscribeChainProp("accountState",n=>{this.setAccountData(n)}),ue.subscribeKey("activeCaipNetwork",n=>{this.network=n,this.networkImage=Ur.getNetworkImage(n),this.isSupported=n!=null&&n.chainNamespace?ue.checkIfSupportedNetwork(n==null?void 0:n.chainNamespace):!0,this.fetchNetworkImage(n)}))}updated(){this.fetchNetworkImage(this.network)}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){if(!ue.state.activeChain)return null;const e=this.balance==="show",n=typeof this.balanceVal!="string",{formattedText:i}=Ft.parseBalance(this.balanceVal,this.balanceSymbol);return we`
      <wui-account-button
        .disabled=${!!this.disabled}
        .isUnsupportedChain=${ut.state.allowUnsupportedChain?!1:!this.isSupported}
        address=${Tn(Ft.getPlainAddress(this.caipAddress))}
        profileName=${Tn(this.profileName)}
        networkSrc=${Tn(this.networkImage)}
        avatarSrc=${Tn(this.profileImage)}
        balance=${e?i:""}
        @click=${this.onClick.bind(this)}
        data-testid=${`account-button${this.namespace?`-${this.namespace}`:""}`}
        .charsStart=${this.charsStart}
        .charsEnd=${this.charsEnd}
        ?loading=${n}
      >
      </wui-account-button>
    `}onClick(){this.isSupported||ut.state.allowUnsupportedChain?gi.open({namespace:this.namespace}):gi.open({view:"UnsupportedChain"})}async fetchNetworkImage(e){var n,i;(n=e==null?void 0:e.assets)!=null&&n.imageId&&(this.networkImage=await Ur.fetchNetworkImage((i=e==null?void 0:e.assets)==null?void 0:i.imageId))}setAccountData(e){e&&(this.caipAddress=e.caipAddress,this.balanceVal=e.balance,this.balanceSymbol=e.balanceSymbol,this.profileName=e.profileName,this.profileImage=e.profileImage)}setNetworkData(e){e&&(this.network=e.caipNetwork,this.networkImage=Ur.getNetworkImage(e.caipNetwork))}}Lc([Fe({type:Boolean})],Bc.prototype,"disabled",void 0);Lc([Fe()],Bc.prototype,"balance",void 0);Lc([Fe()],Bc.prototype,"charsStart",void 0);Lc([Fe()],Bc.prototype,"charsEnd",void 0);Lc([Fe()],Bc.prototype,"namespace",void 0);Lc([Lt()],Bc.prototype,"caipAddress",void 0);Lc([Lt()],Bc.prototype,"balanceVal",void 0);Lc([Lt()],Bc.prototype,"balanceSymbol",void 0);Lc([Lt()],Bc.prototype,"profileName",void 0);Lc([Lt()],Bc.prototype,"profileImage",void 0);Lc([Lt()],Bc.prototype,"network",void 0);Lc([Lt()],Bc.prototype,"networkImage",void 0);Lc([Lt()],Bc.prototype,"isSupported",void 0);let bO=class extends Bc{};bO=Lc([nn("w3m-account-button")],bO);let ZA=class extends Bc{};ZA=Lc([nn("appkit-account-button")],ZA);const o4e=rs`
  :host {
    display: block;
    width: max-content;
  }
`;var Cd=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};class Ou extends on{constructor(){super(...arguments),this.unsubscribe=[],this.disabled=!1,this.balance=void 0,this.size=void 0,this.label=void 0,this.loadingLabel=void 0,this.charsStart=4,this.charsEnd=6,this.namespace=void 0}firstUpdated(){var e;this.caipAddress=this.namespace?(e=ue.getAccountData(this.namespace))==null?void 0:e.caipAddress:ue.state.activeCaipAddress,this.namespace?this.unsubscribe.push(ue.subscribeChainProp("accountState",n=>{this.caipAddress=n==null?void 0:n.caipAddress},this.namespace)):this.unsubscribe.push(ue.subscribeKey("activeCaipAddress",n=>this.caipAddress=n))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return this.caipAddress?we`
          <appkit-account-button
            .disabled=${!!this.disabled}
            balance=${Tn(this.balance)}
            .charsStart=${Tn(this.charsStart)}
            .charsEnd=${Tn(this.charsEnd)}
            namespace=${Tn(this.namespace)}
          >
          </appkit-account-button>
        `:we`
          <appkit-connect-button
            size=${Tn(this.size)}
            label=${Tn(this.label)}
            loadingLabel=${Tn(this.loadingLabel)}
            namespace=${Tn(this.namespace)}
          ></appkit-connect-button>
        `}}Ou.styles=o4e;Cd([Fe({type:Boolean})],Ou.prototype,"disabled",void 0);Cd([Fe()],Ou.prototype,"balance",void 0);Cd([Fe()],Ou.prototype,"size",void 0);Cd([Fe()],Ou.prototype,"label",void 0);Cd([Fe()],Ou.prototype,"loadingLabel",void 0);Cd([Fe()],Ou.prototype,"charsStart",void 0);Cd([Fe()],Ou.prototype,"charsEnd",void 0);Cd([Fe()],Ou.prototype,"namespace",void 0);Cd([Lt()],Ou.prototype,"caipAddress",void 0);let vO=class extends Ou{};vO=Cd([nn("w3m-button")],vO);let KA=class extends Ou{};KA=Cd([nn("appkit-button")],KA);const a4e=Fn`
  :host {
    position: relative;
    display: block;
  }

  button {
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  button[data-size='sm'] {
    padding: ${({spacing:t})=>t[2]};
  }

  button[data-size='md'] {
    padding: ${({spacing:t})=>t[3]};
  }

  button[data-size='lg'] {
    padding: ${({spacing:t})=>t[4]};
  }

  button[data-variant='primary'] {
    background: ${({tokens:t})=>t.core.backgroundAccentPrimary};
  }

  button[data-variant='secondary'] {
    background: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  button:hover:enabled {
    border-radius: ${({borderRadius:t})=>t[3]};
  }

  button:disabled {
    cursor: not-allowed;
  }

  button[data-loading='true'] {
    cursor: not-allowed;
  }

  button[data-loading='true'][data-size='sm'] {
    border-radius: ${({borderRadius:t})=>t[32]};
    padding: ${({spacing:t})=>t[2]} ${({spacing:t})=>t[3]};
  }

  button[data-loading='true'][data-size='md'] {
    border-radius: ${({borderRadius:t})=>t[20]};
    padding: ${({spacing:t})=>t[3]} ${({spacing:t})=>t[4]};
  }

  button[data-loading='true'][data-size='lg'] {
    border-radius: ${({borderRadius:t})=>t[16]};
    padding: ${({spacing:t})=>t[4]} ${({spacing:t})=>t[5]};
  }
`;var jE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let ay=class extends on{constructor(){super(...arguments),this.size="md",this.variant="primary",this.loading=!1,this.text="Connect Wallet"}render(){return we`
      <button
        data-loading=${this.loading}
        data-variant=${this.variant}
        data-size=${this.size}
        ?disabled=${this.loading}
      >
        ${this.contentTemplate()}
      </button>
    `}contentTemplate(){const e={lg:"lg-regular",md:"md-regular",sm:"sm-regular"},n={primary:"invert",secondary:"accent-primary"};return this.loading?we`<wui-loading-spinner
      color=${n[this.variant]}
      size=${this.size}
    ></wui-loading-spinner>`:we` <wui-text variant=${e[this.size]} color=${n[this.variant]}>
        ${this.text}
      </wui-text>`}};ay.styles=[Ei,Kr,a4e];jE([Fe()],ay.prototype,"size",void 0);jE([Fe()],ay.prototype,"variant",void 0);jE([Fe({type:Boolean})],ay.prototype,"loading",void 0);jE([Fe()],ay.prototype,"text",void 0);ay=jE([nn("wui-connect-button")],ay);var Jm=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};class Qm extends on{constructor(){super(),this.unsubscribe=[],this.size="md",this.label="Connect Wallet",this.loadingLabel="Connecting...",this.open=gi.state.open,this.loading=this.namespace?gi.state.loadingNamespaceMap.get(this.namespace):gi.state.loading,this.unsubscribe.push(gi.subscribe(e=>{this.open=e.open,this.loading=this.namespace?e.loadingNamespaceMap.get(this.namespace):e.loading}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we`
      <wui-connect-button
        size=${Tn(this.size)}
        .loading=${this.loading}
        @click=${this.onClick.bind(this)}
        data-testid=${`connect-button${this.namespace?`-${this.namespace}`:""}`}
      >
        ${this.loading?this.loadingLabel:this.label}
      </wui-connect-button>
    `}onClick(){this.open?gi.close():this.loading||gi.open({view:"Connect",namespace:this.namespace})}}Jm([Fe()],Qm.prototype,"size",void 0);Jm([Fe()],Qm.prototype,"label",void 0);Jm([Fe()],Qm.prototype,"loadingLabel",void 0);Jm([Fe()],Qm.prototype,"namespace",void 0);Jm([Lt()],Qm.prototype,"open",void 0);Jm([Lt()],Qm.prototype,"loading",void 0);let xO=class extends Qm{};xO=Jm([nn("w3m-connect-button")],xO);let YA=class extends Qm{};YA=Jm([nn("appkit-connect-button")],YA);const c4e=Fn`
  :host {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    border-radius: ${({borderRadius:t})=>t[2]};
    padding: ${({spacing:t})=>t[1]} !important;
    background-color: ${({tokens:t})=>t.theme.backgroundPrimary};
    position: relative;
  }

  :host([data-padding='2']) {
    padding: ${({spacing:t})=>t[2]} !important;
  }

  :host:after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  :host > wui-icon {
    z-index: 10;
  }

  /* -- Colors --------------------------------------------------- */
  :host([data-color='accent-primary']) {
    color: ${({tokens:t})=>t.core.iconAccentPrimary};
  }

  :host([data-color='accent-primary']):after {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  :host([data-color='default']),
  :host([data-color='secondary']) {
    color: ${({tokens:t})=>t.theme.iconDefault};
  }

  :host([data-color='default']):after {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  :host([data-color='secondary']):after {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  :host([data-color='success']) {
    color: ${({tokens:t})=>t.core.iconSuccess};
  }

  :host([data-color='success']):after {
    background-color: ${({tokens:t})=>t.core.backgroundSuccess};
  }

  :host([data-color='error']) {
    color: ${({tokens:t})=>t.core.iconError};
  }

  :host([data-color='error']):after {
    background-color: ${({tokens:t})=>t.core.backgroundError};
  }

  :host([data-color='warning']) {
    color: ${({tokens:t})=>t.core.iconWarning};
  }

  :host([data-color='warning']):after {
    background-color: ${({tokens:t})=>t.core.backgroundWarning};
  }

  :host([data-color='inverse']) {
    color: ${({tokens:t})=>t.theme.iconInverse};
  }

  :host([data-color='inverse']):after {
    background-color: transparent;
  }
`;var VE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let cy=class extends on{constructor(){super(...arguments),this.icon="copy",this.size="md",this.padding="1",this.color="default"}render(){return this.dataset.padding=this.padding,this.dataset.color=this.color,we`
      <wui-icon size=${Tn(this.size)} name=${this.icon} color="inherit"></wui-icon>
    `}};cy.styles=[Ei,Kr,c4e];VE([Fe()],cy.prototype,"icon",void 0);VE([Fe()],cy.prototype,"size",void 0);VE([Fe()],cy.prototype,"padding",void 0);VE([Fe()],cy.prototype,"color",void 0);cy=VE([nn("wui-icon-box")],cy);const l4e=Fn`
  :host {
    display: block;
  }

  button {
    border-radius: ${({borderRadius:t})=>t[32]};
    display: flex;
    gap: ${({spacing:t})=>t[1]};
    padding: ${({spacing:t})=>t[1]} ${({spacing:t})=>t[2]}
      ${({spacing:t})=>t[1]} ${({spacing:t})=>t[1]};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  @media (hover: hover) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    }
  }

  button[data-size='sm'] > wui-icon-box,
  button[data-size='sm'] > wui-image {
    width: 16px;
    height: 16px;
  }

  button[data-size='md'] > wui-icon-box,
  button[data-size='md'] > wui-image {
    width: 20px;
    height: 20px;
  }

  button[data-size='lg'] > wui-icon-box,
  button[data-size='lg'] > wui-image {
    width: 24px;
    height: 24px;
  }

  wui-image,
  wui-icon-box {
    border-radius: ${({borderRadius:t})=>t[32]};
  }
`;var WE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let ly=class extends on{constructor(){super(...arguments),this.imageSrc=void 0,this.isUnsupportedChain=void 0,this.disabled=!1,this.size="lg"}render(){const e={sm:"sm-regular",md:"md-regular",lg:"lg-regular"};return we`
      <button data-size=${this.size} data-testid="wui-network-button" ?disabled=${this.disabled}>
        ${this.visualTemplate()}
        <wui-text variant=${e[this.size]} color="primary">
          <slot></slot>
        </wui-text>
      </button>
    `}visualTemplate(){return this.isUnsupportedChain?we` <wui-icon-box color="error" icon="warningCircle"></wui-icon-box> `:this.imageSrc?we`<wui-image src=${this.imageSrc}></wui-image>`:we` <wui-icon size="xl" color="default" name="networkPlaceholder"></wui-icon> `}};ly.styles=[Ei,Kr,l4e];WE([Fe()],ly.prototype,"imageSrc",void 0);WE([Fe({type:Boolean})],ly.prototype,"isUnsupportedChain",void 0);WE([Fe({type:Boolean})],ly.prototype,"disabled",void 0);WE([Fe()],ly.prototype,"size",void 0);ly=WE([nn("wui-network-button")],ly);const u4e=rs`
  :host {
    display: block;
    width: max-content;
  }
`;var ep=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};class Lh extends on{constructor(){super(),this.unsubscribe=[],this.disabled=!1,this.network=ue.state.activeCaipNetwork,this.networkImage=Ur.getNetworkImage(this.network),this.caipAddress=ue.state.activeCaipAddress,this.loading=gi.state.loading,this.isSupported=ut.state.allowUnsupportedChain?!0:ue.state.activeChain?ue.checkIfSupportedNetwork(ue.state.activeChain):!0,this.unsubscribe.push(_o.subscribeNetworkImages(()=>{this.networkImage=Ur.getNetworkImage(this.network)}),ue.subscribeKey("activeCaipAddress",e=>{this.caipAddress=e}),ue.subscribeKey("activeCaipNetwork",e=>{var n;this.network=e,this.networkImage=Ur.getNetworkImage(e),this.isSupported=e!=null&&e.chainNamespace?ue.checkIfSupportedNetwork(e.chainNamespace):!0,Ur.fetchNetworkImage((n=e==null?void 0:e.assets)==null?void 0:n.imageId)}),gi.subscribeKey("loading",e=>this.loading=e))}firstUpdated(){var e,n;Ur.fetchNetworkImage((n=(e=this.network)==null?void 0:e.assets)==null?void 0:n.imageId)}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){const e=this.network?ue.checkIfSupportedNetwork(this.network.chainNamespace):!0;return we`
      <wui-network-button
        .disabled=${!!(this.disabled||this.loading)}
        .isUnsupportedChain=${ut.state.allowUnsupportedChain?!1:!e}
        imageSrc=${Tn(this.networkImage)}
        @click=${this.onClick.bind(this)}
        data-testid="w3m-network-button"
      >
        ${this.getLabel()}
        <slot></slot>
      </wui-network-button>
    `}getLabel(){return this.network?!this.isSupported&&!ut.state.allowUnsupportedChain?"Switch Network":this.network.name:this.label?this.label:this.caipAddress?"Unknown Network":"Select Network"}onClick(){this.loading||(Sn.sendEvent({type:"track",event:"CLICK_NETWORKS"}),gi.open({view:"Networks"}))}}Lh.styles=u4e;ep([Fe({type:Boolean})],Lh.prototype,"disabled",void 0);ep([Fe({type:String})],Lh.prototype,"label",void 0);ep([Lt()],Lh.prototype,"network",void 0);ep([Lt()],Lh.prototype,"networkImage",void 0);ep([Lt()],Lh.prototype,"caipAddress",void 0);ep([Lt()],Lh.prototype,"loading",void 0);ep([Lt()],Lh.prototype,"isSupported",void 0);let EO=class extends Lh{};EO=ep([nn("w3m-network-button")],EO);let XA=class extends Lh{};XA=ep([nn("appkit-network-button")],XA);const d4e="https://reown.com",h4e=Fn`
  .reown-logo {
    height: 24px;
  }

  a {
    text-decoration: none;
    cursor: pointer;
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  a:hover {
    opacity: 0.9;
  }
`;var f4e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let CO=class extends on{render(){return we`
      <a
        data-testid="ux-branding-reown"
        href=${d4e}
        rel="noreferrer"
        target="_blank"
        style="text-decoration: none;"
      >
        <wui-flex
          justifyContent="center"
          alignItems="center"
          gap="1"
          .padding=${["01","0","3","0"]}
        >
          <wui-text variant="sm-regular" color="inherit"> UX by </wui-text>
          <wui-icon name="reown" size="inherit" class="reown-logo"></wui-icon>
        </wui-flex>
      </a>
    `}};CO.styles=[Ei,Kr,h4e];CO=f4e([nn("wui-ux-by-reown")],CO);const p4e=Fn`
  :host wui-ux-by-reown {
    padding-top: 0;
  }

  :host wui-ux-by-reown.branding-only {
    padding-top: ${({spacing:t})=>t[3]};
  }

  a {
    text-decoration: none;
    color: ${({tokens:t})=>t.core.textAccentPrimary};
    font-weight: 500;
  }
`;var oY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let JA=class extends on{constructor(){super(),this.unsubscribe=[],this.remoteFeatures=ut.state.remoteFeatures,this.unsubscribe.push(ut.subscribeKey("remoteFeatures",e=>this.remoteFeatures=e))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){var l;const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state,i=(l=ut.state.features)==null?void 0:l.legalCheckbox;return!e&&!n||i?we`
        <wui-flex flexDirection="column"> ${this.reownBrandingTemplate(!0)} </wui-flex>
      `:we`
      <wui-flex flexDirection="column">
        <wui-flex .padding=${["4","3","3","3"]} justifyContent="center">
          <wui-text color="secondary" variant="md-regular" align="center">
            By connecting your wallet, you agree to our <br />
            ${this.termsTemplate()} ${this.andTemplate()} ${this.privacyTemplate()}
          </wui-text>
        </wui-flex>
        ${this.reownBrandingTemplate()}
      </wui-flex>
    `}andTemplate(){const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state;return e&&n?"and":""}termsTemplate(){const{termsConditionsUrl:e}=ut.state;return e?we`<a href=${e} target="_blank" rel="noopener noreferrer"
      >Terms of Service</a
    >`:null}privacyTemplate(){const{privacyPolicyUrl:e}=ut.state;return e?we`<a href=${e} target="_blank" rel="noopener noreferrer"
      >Privacy Policy</a
    >`:null}reownBrandingTemplate(e=!1){var n;return(n=this.remoteFeatures)!=null&&n.reownBranding?e?we`<wui-ux-by-reown class="branding-only"></wui-ux-by-reown>`:we`<wui-ux-by-reown></wui-ux-by-reown>`:null}};JA.styles=[p4e];oY([Lt()],JA.prototype,"remoteFeatures",void 0);JA=oY([nn("w3m-legal-footer")],JA);const m4e=Fn`
  button {
    border: none;
    background: transparent;
    height: 20px;
    padding: ${({spacing:t})=>t[2]};
    column-gap: ${({spacing:t})=>t[1]};
    border-radius: ${({borderRadius:t})=>t[1]};
    padding: 0 ${({spacing:t})=>t[1]};
    border-radius: ${({spacing:t})=>t[1]};
  }

  /* -- Variants --------------------------------------------------------- */
  button[data-variant='accent'] {
    color: ${({tokens:t})=>t.core.textAccentPrimary};
  }

  button[data-variant='secondary'] {
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  /* -- Focus states --------------------------------------------------- */
  button:focus-visible:enabled {
    box-shadow: 0px 0px 0px 4px rgba(9, 136, 240, 0.2);
  }

  button[data-variant='accent']:focus-visible:enabled {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  button[data-variant='secondary']:focus-visible:enabled {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  /* -- Hover & Active states ----------------------------------------------------------- */
  button[data-variant='accent']:hover:enabled {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  button[data-variant='secondary']:hover:enabled {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  button[data-variant='accent']:focus-visible {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  button[data-variant='secondary']:focus-visible {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    box-shadow: 0px 0px 0px 4px rgba(9, 136, 240, 0.2);
  }

  button[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
  }
`;var HE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const g4e={sm:"sm-medium",md:"md-medium"},y4e={accent:"accent-primary",secondary:"secondary"};let uy=class extends on{constructor(){super(...arguments),this.size="md",this.disabled=!1,this.variant="accent",this.icon=void 0}render(){return we`
      <button ?disabled=${this.disabled} data-variant=${this.variant}>
        <slot name="iconLeft"></slot>
        <wui-text
          color=${y4e[this.variant]}
          variant=${g4e[this.size]}
        >
          <slot></slot>
        </wui-text>
        ${this.iconTemplate()}
      </button>
    `}iconTemplate(){return this.icon?we`<wui-icon name=${this.icon} size="sm"></wui-icon>`:null}};uy.styles=[Ei,Kr,m4e];HE([Fe()],uy.prototype,"size",void 0);HE([Fe({type:Boolean})],uy.prototype,"disabled",void 0);HE([Fe()],uy.prototype,"variant",void 0);HE([Fe()],uy.prototype,"icon",void 0);uy=HE([nn("wui-link")],uy);const _4e=rs``;var w4e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let TO=class extends on{render(){const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state;return!e&&!n?null:we`
      <wui-flex
        .padding=${["4","3","3","3"]}
        flexDirection="column"
        alignItems="center"
        justifyContent="center"
        gap="3"
      >
        <wui-text color="secondary" variant="md-regular" align="center">
          We work with the best providers to give you the lowest fees and best support. More options
          coming soon!
        </wui-text>

        ${this.howDoesItWorkTemplate()}
      </wui-flex>
    `}howDoesItWorkTemplate(){return we` <wui-link @click=${this.onWhatIsBuy.bind(this)}>
      <wui-icon size="xs" color="accent-primary" slot="iconLeft" name="helpCircle"></wui-icon>
      How does it work?
    </wui-link>`}onWhatIsBuy(){Sn.sendEvent({type:"track",event:"SELECT_WHAT_IS_A_BUY",properties:{isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}),Pt.push("WhatIsABuy")}};TO.styles=[_4e];TO=w4e([nn("w3m-onramp-providers-footer")],TO);var qU={};const ET={ACCOUNT_TABS:[{label:"Tokens"},{label:"Activity"}],SECURE_SITE_ORIGIN:(typeof process<"u"&&typeof qU<"u"?qU.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",VIEW_DIRECTION:{Next:"next",Prev:"prev"},ANIMATION_DURATIONS:{HeaderText:120},VIEWS_WITH_LEGAL_FOOTER:["Connect","ConnectWallets","OnRampTokenSelect","OnRampFiatSelect","OnRampProviders"],VIEWS_WITH_DEFAULT_FOOTER:["Networks"]},Z1={getTabsByNamespace(t){var n;return!!t&&t===at.CHAIN.EVM?((n=ut.state.remoteFeatures)==null?void 0:n.activity)===!1?ET.ACCOUNT_TABS.filter(i=>i.label!=="Activity"):ET.ACCOUNT_TABS:[]},isValidReownName(t){return/^[a-zA-Z0-9]+$/gu.test(t)},isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/gu.test(t)},validateReownName(t){return t.replace(/\^/gu,"").toLowerCase().replace(/[^a-zA-Z0-9]/gu,"")},hasFooter(){var e;const t=Pt.state.view;if(ET.VIEWS_WITH_LEGAL_FOOTER.includes(t)){const{termsConditionsUrl:n,privacyPolicyUrl:i}=ut.state,o=(e=ut.state.features)==null?void 0:e.legalCheckbox;return!(!n&&!i||o)}return ET.VIEWS_WITH_DEFAULT_FOOTER.includes(t)}},b4e=Fn`
  :host {
    display: block;
  }

  div.container {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    overflow: hidden;
    height: auto;
    display: block;
  }

  div.container[status='hide'] {
    animation: fade-out;
    animation-duration: var(--apkt-duration-dynamic);
    animation-timing-function: ${({easings:t})=>t["ease-out-power-2"]};
    animation-fill-mode: both;
    animation-delay: 0s;
  }

  div.container[status='show'] {
    animation: fade-in;
    animation-duration: var(--apkt-duration-dynamic);
    animation-timing-function: ${({easings:t})=>t["ease-out-power-2"]};
    animation-fill-mode: both;
    animation-delay: var(--apkt-duration-dynamic);
  }

  @keyframes fade-in {
    from {
      opacity: 0;
      filter: blur(6px);
    }
    to {
      opacity: 1;
      filter: blur(0px);
    }
  }

  @keyframes fade-out {
    from {
      opacity: 1;
      filter: blur(0px);
    }
    to {
      opacity: 0;
      filter: blur(6px);
    }
  }
`;var ZD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let pw=class extends on{constructor(){super(...arguments),this.resizeObserver=void 0,this.unsubscribe=[],this.status="hide",this.view=Pt.state.view}firstUpdated(){this.status=Z1.hasFooter()?"show":"hide",this.unsubscribe.push(Pt.subscribeKey("view",e=>{this.view=e,this.status=Z1.hasFooter()?"show":"hide",this.status==="hide"&&document.documentElement.style.setProperty("--apkt-footer-height","0px")})),this.resizeObserver=new ResizeObserver(e=>{for(const n of e)if(n.target===this.getWrapper()){const i=`${n.contentRect.height}px`;document.documentElement.style.setProperty("--apkt-footer-height",i)}}),this.resizeObserver.observe(this.getWrapper())}render(){return we`
      <div class="container" status=${this.status}>${this.templatePageContainer()}</div>
    `}templatePageContainer(){return Z1.hasFooter()?we` ${this.templateFooter()}`:null}templateFooter(){switch(this.view){case"Networks":return this.templateNetworksFooter();case"Connect":case"ConnectWallets":case"OnRampFiatSelect":case"OnRampTokenSelect":return we`<w3m-legal-footer></w3m-legal-footer>`;case"OnRampProviders":return we`<w3m-onramp-providers-footer></w3m-onramp-providers-footer>`;default:return null}}templateNetworksFooter(){return we` <wui-flex
      class="footer-in"
      padding="3"
      flexDirection="column"
      gap="3"
      alignItems="center"
    >
      <wui-text variant="md-regular" color="secondary" align="center">
        Your connected wallet may not support some of the networks available for this dApp
      </wui-text>
      <wui-link @click=${this.onNetworkHelp.bind(this)}>
        <wui-icon size="sm" color="accent-primary" slot="iconLeft" name="helpCircle"></wui-icon>
        What is a network
      </wui-link>
    </wui-flex>`}onNetworkHelp(){Sn.sendEvent({type:"track",event:"CLICK_NETWORK_HELP"}),Pt.push("WhatIsANetwork")}getWrapper(){var e;return(e=this.shadowRoot)==null?void 0:e.querySelector("div.container")}};pw.styles=[b4e];ZD([Lt()],pw.prototype,"status",void 0);ZD([Lt()],pw.prototype,"view",void 0);pw=ZD([nn("w3m-footer")],pw);const v4e=Fn`
  :host {
    display: block;
    width: inherit;
  }
`;var KD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let mw=class extends on{constructor(){super(),this.unsubscribe=[],this.viewState=Pt.state.view,this.history=Pt.state.history.join(","),this.unsubscribe.push(Pt.subscribeKey("view",()=>{this.history=Pt.state.history.join(","),document.documentElement.style.setProperty("--apkt-duration-dynamic","var(--apkt-durations-lg)")}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e()),document.documentElement.style.setProperty("--apkt-duration-dynamic","0s")}render(){return we`${this.templatePageContainer()}`}templatePageContainer(){return we`<w3m-router-container
      history=${this.history}
      .setView=${()=>{this.viewState=Pt.state.view}}
    >
      ${this.viewTemplate(this.viewState)}
    </w3m-router-container>`}viewTemplate(e){switch(e){case"AccountSettings":return we`<w3m-account-settings-view></w3m-account-settings-view>`;case"Account":return we`<w3m-account-view></w3m-account-view>`;case"AllWallets":return we`<w3m-all-wallets-view></w3m-all-wallets-view>`;case"ApproveTransaction":return we`<w3m-approve-transaction-view></w3m-approve-transaction-view>`;case"BuyInProgress":return we`<w3m-buy-in-progress-view></w3m-buy-in-progress-view>`;case"ChooseAccountName":return we`<w3m-choose-account-name-view></w3m-choose-account-name-view>`;case"Connect":return we`<w3m-connect-view></w3m-connect-view>`;case"Create":return we`<w3m-connect-view walletGuide="explore"></w3m-connect-view>`;case"ConnectingWalletConnect":return we`<w3m-connecting-wc-view></w3m-connecting-wc-view>`;case"ConnectingWalletConnectBasic":return we`<w3m-connecting-wc-basic-view></w3m-connecting-wc-basic-view>`;case"ConnectingExternal":return we`<w3m-connecting-external-view></w3m-connecting-external-view>`;case"ConnectingSiwe":return we`<w3m-connecting-siwe-view></w3m-connecting-siwe-view>`;case"ConnectWallets":return we`<w3m-connect-wallets-view></w3m-connect-wallets-view>`;case"ConnectSocials":return we`<w3m-connect-socials-view></w3m-connect-socials-view>`;case"ConnectingSocial":return we`<w3m-connecting-social-view></w3m-connecting-social-view>`;case"DataCapture":return we`<w3m-data-capture-view></w3m-data-capture-view>`;case"DataCaptureOtpConfirm":return we`<w3m-data-capture-otp-confirm-view></w3m-data-capture-otp-confirm-view>`;case"Downloads":return we`<w3m-downloads-view></w3m-downloads-view>`;case"EmailLogin":return we`<w3m-email-login-view></w3m-email-login-view>`;case"EmailVerifyOtp":return we`<w3m-email-verify-otp-view></w3m-email-verify-otp-view>`;case"EmailVerifyDevice":return we`<w3m-email-verify-device-view></w3m-email-verify-device-view>`;case"GetWallet":return we`<w3m-get-wallet-view></w3m-get-wallet-view>`;case"Networks":return we`<w3m-networks-view></w3m-networks-view>`;case"SwitchNetwork":return we`<w3m-network-switch-view></w3m-network-switch-view>`;case"ProfileWallets":return we`<w3m-profile-wallets-view></w3m-profile-wallets-view>`;case"Transactions":return we`<w3m-transactions-view></w3m-transactions-view>`;case"OnRampProviders":return we`<w3m-onramp-providers-view></w3m-onramp-providers-view>`;case"OnRampTokenSelect":return we`<w3m-onramp-token-select-view></w3m-onramp-token-select-view>`;case"OnRampFiatSelect":return we`<w3m-onramp-fiat-select-view></w3m-onramp-fiat-select-view>`;case"UpgradeEmailWallet":return we`<w3m-upgrade-wallet-view></w3m-upgrade-wallet-view>`;case"UpdateEmailWallet":return we`<w3m-update-email-wallet-view></w3m-update-email-wallet-view>`;case"UpdateEmailPrimaryOtp":return we`<w3m-update-email-primary-otp-view></w3m-update-email-primary-otp-view>`;case"UpdateEmailSecondaryOtp":return we`<w3m-update-email-secondary-otp-view></w3m-update-email-secondary-otp-view>`;case"UnsupportedChain":return we`<w3m-unsupported-chain-view></w3m-unsupported-chain-view>`;case"Swap":return we`<w3m-swap-view></w3m-swap-view>`;case"SwapSelectToken":return we`<w3m-swap-select-token-view></w3m-swap-select-token-view>`;case"SwapPreview":return we`<w3m-swap-preview-view></w3m-swap-preview-view>`;case"WalletSend":return we`<w3m-wallet-send-view></w3m-wallet-send-view>`;case"WalletSendSelectToken":return we`<w3m-wallet-send-select-token-view></w3m-wallet-send-select-token-view>`;case"WalletSendPreview":return we`<w3m-wallet-send-preview-view></w3m-wallet-send-preview-view>`;case"WalletSendConfirmed":return we`<w3m-send-confirmed-view></w3m-send-confirmed-view>`;case"WhatIsABuy":return we`<w3m-what-is-a-buy-view></w3m-what-is-a-buy-view>`;case"WalletReceive":return we`<w3m-wallet-receive-view></w3m-wallet-receive-view>`;case"WalletCompatibleNetworks":return we`<w3m-wallet-compatible-networks-view></w3m-wallet-compatible-networks-view>`;case"WhatIsAWallet":return we`<w3m-what-is-a-wallet-view></w3m-what-is-a-wallet-view>`;case"ConnectingMultiChain":return we`<w3m-connecting-multi-chain-view></w3m-connecting-multi-chain-view>`;case"WhatIsANetwork":return we`<w3m-what-is-a-network-view></w3m-what-is-a-network-view>`;case"ConnectingFarcaster":return we`<w3m-connecting-farcaster-view></w3m-connecting-farcaster-view>`;case"SwitchActiveChain":return we`<w3m-switch-active-chain-view></w3m-switch-active-chain-view>`;case"RegisterAccountName":return we`<w3m-register-account-name-view></w3m-register-account-name-view>`;case"RegisterAccountNameSuccess":return we`<w3m-register-account-name-success-view></w3m-register-account-name-success-view>`;case"SmartSessionCreated":return we`<w3m-smart-session-created-view></w3m-smart-session-created-view>`;case"SmartSessionList":return we`<w3m-smart-session-list-view></w3m-smart-session-list-view>`;case"SIWXSignMessage":return we`<w3m-siwx-sign-message-view></w3m-siwx-sign-message-view>`;case"Pay":return we`<w3m-pay-view></w3m-pay-view>`;case"PayLoading":return we`<w3m-pay-loading-view></w3m-pay-loading-view>`;case"PayQuote":return we`<w3m-pay-quote-view></w3m-pay-quote-view>`;case"FundWallet":return we`<w3m-fund-wallet-view></w3m-fund-wallet-view>`;case"PayWithExchange":return we`<w3m-deposit-from-exchange-view></w3m-deposit-from-exchange-view>`;case"PayWithExchangeSelectAsset":return we`<w3m-deposit-from-exchange-select-asset-view></w3m-deposit-from-exchange-select-asset-view>`;case"UsageExceeded":return we`<w3m-usage-exceeded-view></w3m-usage-exceeded-view>`;case"SmartAccountSettings":return we`<w3m-smart-account-settings-view></w3m-smart-account-settings-view>`;default:return we`<w3m-connect-view></w3m-connect-view>`}}};mw.styles=[v4e];KD([Lt()],mw.prototype,"viewState",void 0);KD([Lt()],mw.prototype,"history",void 0);mw=KD([nn("w3m-router")],mw);const x4e=Fn`
  button {
    background-color: transparent;
    padding: ${({spacing:t})=>t[1]};
  }

  button:focus-visible {
    box-shadow: 0 0 0 4px ${({tokens:t})=>t.core.foregroundAccent020};
  }

  button[data-variant='accent']:hover:enabled,
  button[data-variant='accent']:focus-visible {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  button[data-variant='primary']:hover:enabled,
  button[data-variant='primary']:focus-visible,
  button[data-variant='secondary']:hover:enabled,
  button[data-variant='secondary']:focus-visible {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  button[data-size='xs'] > wui-icon {
    width: 8px;
    height: 8px;
  }

  button[data-size='sm'] > wui-icon {
    width: 12px;
    height: 12px;
  }

  button[data-size='xs'],
  button[data-size='sm'] {
    border-radius: ${({borderRadius:t})=>t[1]};
  }

  button[data-size='md'],
  button[data-size='lg'] {
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  button[data-size='md'] > wui-icon {
    width: 16px;
    height: 16px;
  }

  button[data-size='lg'] > wui-icon {
    width: 20px;
    height: 20px;
  }

  button:disabled {
    background-color: transparent;
    cursor: not-allowed;
    opacity: 0.5;
  }

  button:hover:not(:disabled) {
    background-color: var(--wui-color-accent-glass-015);
  }

  button:focus-visible:not(:disabled) {
    background-color: var(--wui-color-accent-glass-015);
    box-shadow:
      inset 0 0 0 1px var(--wui-color-accent-100),
      0 0 0 4px var(--wui-color-accent-glass-020);
  }
`;var zw=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Um=class extends on{constructor(){super(...arguments),this.size="md",this.disabled=!1,this.icon="copy",this.iconColor="default",this.variant="accent"}render(){const e={accent:"accent-primary",primary:"inverse",secondary:"default"};return we`
      <button data-variant=${this.variant} ?disabled=${this.disabled} data-size=${this.size}>
        <wui-icon
          color=${e[this.variant]||this.iconColor}
          size=${this.size}
          name=${this.icon}
        ></wui-icon>
      </button>
    `}};Um.styles=[Ei,Kr,x4e];zw([Fe()],Um.prototype,"size",void 0);zw([Fe({type:Boolean})],Um.prototype,"disabled",void 0);zw([Fe()],Um.prototype,"icon",void 0);zw([Fe()],Um.prototype,"iconColor",void 0);zw([Fe()],Um.prototype,"variant",void 0);Um=zw([nn("wui-icon-link")],Um);const E4e=Fn`
  :host {
    width: 100%;
  }

  :host([data-type='primary']) > button {
    background-color: ${({tokens:t})=>t.theme.backgroundPrimary};
  }

  :host([data-type='secondary']) > button {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: ${({spacing:t})=>t[3]};
    width: 100%;
    border-radius: ${({borderRadius:t})=>t[4]};
    transition:
      background-color ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      scale ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color, scale;
  }

  wui-text {
    text-transform: capitalize;
  }

  wui-image {
    color: ${({tokens:t})=>t.theme.textPrimary};
  }

  @media (hover: hover) {
    :host([data-type='primary']) > button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    }

    :host([data-type='secondary']) > button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    }
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`;var ml=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let tc=class extends on{constructor(){super(...arguments),this.type="primary",this.imageSrc="google",this.imageSize=void 0,this.loading=!1,this.boxColor="foregroundPrimary",this.disabled=!1,this.rightIcon=!0,this.boxed=!0,this.rounded=!1,this.fullSize=!1}render(){return this.dataset.rounded=this.rounded?"true":"false",this.dataset.type=this.type,we`
      <button
        ?disabled=${this.loading?!0:!!this.disabled}
        data-loading=${this.loading}
        tabindex=${Tn(this.tabIdx)}
      >
        <wui-flex gap="2" alignItems="center">
          ${this.templateLeftIcon()}
          <wui-flex gap="1">
            <slot></slot>
          </wui-flex>
        </wui-flex>
        ${this.templateRightIcon()}
      </button>
    `}templateLeftIcon(){return this.icon?we`<wui-image
        icon=${this.icon}
        iconColor=${Tn(this.iconColor)}
        ?boxed=${this.boxed}
        ?rounded=${this.rounded}
        boxColor=${this.boxColor}
      ></wui-image>`:we`<wui-image
      ?boxed=${this.boxed}
      ?rounded=${this.rounded}
      ?fullSize=${this.fullSize}
      size=${Tn(this.imageSize)}
      src=${this.imageSrc}
      boxColor=${this.boxColor}
    ></wui-image>`}templateRightIcon(){return this.rightIcon?this.loading?we`<wui-loading-spinner size="md" color="accent-primary"></wui-loading-spinner>`:we`<wui-icon name="chevronRight" size="lg" color="default"></wui-icon>`:null}};tc.styles=[Ei,Kr,E4e];ml([Fe()],tc.prototype,"type",void 0);ml([Fe()],tc.prototype,"imageSrc",void 0);ml([Fe()],tc.prototype,"imageSize",void 0);ml([Fe()],tc.prototype,"icon",void 0);ml([Fe()],tc.prototype,"iconColor",void 0);ml([Fe({type:Boolean})],tc.prototype,"loading",void 0);ml([Fe()],tc.prototype,"tabIdx",void 0);ml([Fe()],tc.prototype,"boxColor",void 0);ml([Fe({type:Boolean})],tc.prototype,"disabled",void 0);ml([Fe({type:Boolean})],tc.prototype,"rightIcon",void 0);ml([Fe({type:Boolean})],tc.prototype,"boxed",void 0);ml([Fe({type:Boolean})],tc.prototype,"rounded",void 0);ml([Fe({type:Boolean})],tc.prototype,"fullSize",void 0);tc=ml([nn("wui-list-item")],tc);const C4e=Fn`
  :host {
    width: var(--local-width);
  }

  button {
    width: var(--local-width);
    white-space: nowrap;
    column-gap: ${({spacing:t})=>t[2]};
    transition:
      scale ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-1"]},
      background-color ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      border-radius ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-1"]};
    will-change: scale, background-color, border-radius;
    cursor: pointer;
  }

  /* -- Sizes --------------------------------------------------- */
  button[data-size='sm'] {
    border-radius: ${({borderRadius:t})=>t[2]};
    padding: 0 ${({spacing:t})=>t[2]};
    height: 28px;
  }

  button[data-size='md'] {
    border-radius: ${({borderRadius:t})=>t[3]};
    padding: 0 ${({spacing:t})=>t[4]};
    height: 38px;
  }

  button[data-size='lg'] {
    border-radius: ${({borderRadius:t})=>t[4]};
    padding: 0 ${({spacing:t})=>t[5]};
    height: 48px;
  }

  /* -- Variants --------------------------------------------------------- */
  button[data-variant='accent-primary'] {
    background-color: ${({tokens:t})=>t.core.backgroundAccentPrimary};
    color: ${({tokens:t})=>t.theme.textInvert};
  }

  button[data-variant='accent-secondary'] {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
    color: ${({tokens:t})=>t.core.textAccentPrimary};
  }

  button[data-variant='neutral-primary'] {
    background-color: ${({tokens:t})=>t.theme.backgroundInvert};
    color: ${({tokens:t})=>t.theme.textInvert};
  }

  button[data-variant='neutral-secondary'] {
    background-color: transparent;
    border: 1px solid ${({tokens:t})=>t.theme.borderSecondary};
    color: ${({tokens:t})=>t.theme.textPrimary};
  }

  button[data-variant='neutral-tertiary'] {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    color: ${({tokens:t})=>t.theme.textPrimary};
  }

  button[data-variant='error-primary'] {
    background-color: ${({tokens:t})=>t.core.textError};
    color: ${({tokens:t})=>t.theme.textInvert};
  }

  button[data-variant='error-secondary'] {
    background-color: ${({tokens:t})=>t.core.backgroundError};
    color: ${({tokens:t})=>t.core.textError};
  }

  button[data-variant='shade'] {
    background: var(--wui-color-gray-glass-002);
    color: var(--wui-color-fg-200);
    border: none;
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-005);
  }

  /* -- Focus states --------------------------------------------------- */
  button[data-size='sm']:focus-visible:enabled {
    border-radius: 28px;
  }

  button[data-size='md']:focus-visible:enabled {
    border-radius: 38px;
  }

  button[data-size='lg']:focus-visible:enabled {
    border-radius: 48px;
  }
  button[data-variant='shade']:focus-visible:enabled {
    background: var(--wui-color-gray-glass-005);
    box-shadow:
      inset 0 0 0 1px var(--wui-color-gray-glass-010),
      0 0 0 4px var(--wui-color-gray-glass-002);
  }

  /* -- Hover & Active states ----------------------------------------------------------- */
  @media (hover: hover) {
    button[data-size='sm']:hover:enabled {
      border-radius: 28px;
    }

    button[data-size='md']:hover:enabled {
      border-radius: 38px;
    }

    button[data-size='lg']:hover:enabled {
      border-radius: 48px;
    }

    button[data-variant='shade']:hover:enabled {
      background: var(--wui-color-gray-glass-002);
    }

    button[data-variant='shade']:active:enabled {
      background: var(--wui-color-gray-glass-005);
    }
  }

  button[data-size='sm']:active:enabled {
    border-radius: 28px;
  }

  button[data-size='md']:active:enabled {
    border-radius: 38px;
  }

  button[data-size='lg']:active:enabled {
    border-radius: 48px;
  }

  /* -- Disabled states --------------------------------------------------- */
  button:disabled {
    opacity: 0.3;
  }
`;var Dy=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const T4e={lg:"lg-regular-mono",md:"md-regular-mono",sm:"sm-regular-mono"},A4e={lg:"md",md:"md",sm:"sm"};let Hf=class extends on{constructor(){super(...arguments),this.size="lg",this.disabled=!1,this.fullWidth=!1,this.loading=!1,this.variant="accent-primary"}render(){this.style.cssText=`
    --local-width: ${this.fullWidth?"100%":"auto"};
     `;const e=this.textVariant??T4e[this.size];return we`
      <button data-variant=${this.variant} data-size=${this.size} ?disabled=${this.disabled}>
        ${this.loadingTemplate()}
        <slot name="iconLeft"></slot>
        <wui-text variant=${e} color="inherit">
          <slot></slot>
        </wui-text>
        <slot name="iconRight"></slot>
      </button>
    `}loadingTemplate(){if(this.loading){const e=A4e[this.size],n=this.variant==="neutral-primary"||this.variant==="accent-primary"?"invert":"primary";return we`<wui-loading-spinner color=${n} size=${e}></wui-loading-spinner>`}return null}};Hf.styles=[Ei,Kr,C4e];Dy([Fe()],Hf.prototype,"size",void 0);Dy([Fe({type:Boolean})],Hf.prototype,"disabled",void 0);Dy([Fe({type:Boolean})],Hf.prototype,"fullWidth",void 0);Dy([Fe({type:Boolean})],Hf.prototype,"loading",void 0);Dy([Fe()],Hf.prototype,"variant",void 0);Dy([Fe()],Hf.prototype,"textVariant",void 0);Hf=Dy([nn("wui-button")],Hf);const S4e=Fn`
  :host {
    display: block;
  }

  button {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: ${({spacing:t})=>t[4]};
    padding: ${({spacing:t})=>t[3]};
    border-radius: ${({borderRadius:t})=>t[4]};
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  wui-flex > wui-icon {
    padding: ${({spacing:t})=>t[2]};
    color: ${({tokens:t})=>t.theme.textInvert};
    background-color: ${({tokens:t})=>t.core.backgroundAccentPrimary};
    border-radius: ${({borderRadius:t})=>t[2]};
    align-items: center;
  }

  @media (hover: hover) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.core.foregroundAccent020};
    }
  }
`;var hI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let gw=class extends on{constructor(){super(...arguments),this.label="",this.description="",this.icon="wallet"}render(){return we`
      <button>
        <wui-flex gap="2" alignItems="center">
          <wui-icon weight="fill" size="lg" name=${this.icon} color="inherit"></wui-icon>
          <wui-flex flexDirection="column" gap="1">
            <wui-text variant="md-medium" color="primary">${this.label}</wui-text>
            <wui-text variant="md-regular" color="tertiary">${this.description}</wui-text>
          </wui-flex>
        </wui-flex>
        <wui-icon size="lg" color="accent-primary" name="chevronRight"></wui-icon>
      </button>
    `}};gw.styles=[Ei,Kr,S4e];hI([Fe()],gw.prototype,"label",void 0);hI([Fe()],gw.prototype,"description",void 0);hI([Fe()],gw.prototype,"icon",void 0);gw=hI([nn("wui-notice-card")],gw);var aY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let AO=class extends on{constructor(){super(),this.unsubscribe=[],this.socialProvider=Jt.getConnectedSocialProvider(),this.socialUsername=Jt.getConnectedSocialUsername(),this.namespace=ue.state.activeChain,this.unsubscribe.push(ue.subscribeKey("activeChain",e=>{this.namespace=e}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){const e=Nt.getConnectorId(this.namespace),n=Nt.getAuthConnector();if(!n||e!==at.CONNECTOR_ID.AUTH)return this.style.cssText="display: none",null;const i=n.provider.getEmail()??"";return!i&&!this.socialUsername?(this.style.cssText="display: none",null):we`
      <wui-list-item
        ?rounded=${!0}
        icon=${this.socialProvider??"mail"}
        data-testid="w3m-account-email-update"
        ?chevron=${!this.socialProvider}
        @click=${()=>{this.onGoToUpdateEmail(i,this.socialProvider)}}
      >
        <wui-text variant="lg-regular" color="primary">${this.getAuthName(i)}</wui-text>
      </wui-list-item>
    `}onGoToUpdateEmail(e,n){n||Pt.push("UpdateEmailWallet",{email:e,redirectView:"Account"})}getAuthName(e){return this.socialUsername?this.socialProvider==="discord"&&this.socialUsername.endsWith("0")?this.socialUsername.slice(0,-1):this.socialUsername:e.length>30?`${e.slice(0,-3)}...`:e}};aY([Lt()],AO.prototype,"namespace",void 0);AO=aY([nn("w3m-account-auth-button")],AO);var Ny=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Gf=class extends on{constructor(){var e,n,i;super(),this.usubscribe=[],this.networkImages=_o.state.networkImages,this.address=(e=ue.getAccountData())==null?void 0:e.address,this.profileImage=(n=ue.getAccountData())==null?void 0:n.profileImage,this.profileName=(i=ue.getAccountData())==null?void 0:i.profileName,this.network=ue.state.activeCaipNetwork,this.disconnecting=!1,this.remoteFeatures=ut.state.remoteFeatures,this.usubscribe.push(ue.subscribeChainProp("accountState",o=>{o&&(this.address=o.address,this.profileImage=o.profileImage,this.profileName=o.profileName)}),ue.subscribeKey("activeCaipNetwork",o=>{o!=null&&o.id&&(this.network=o)}),ut.subscribeKey("remoteFeatures",o=>{this.remoteFeatures=o}))}disconnectedCallback(){this.usubscribe.forEach(e=>e())}render(){var n,i,o;if(!this.address)throw new Error("w3m-account-settings-view: No account provided");const e=this.networkImages[((i=(n=this.network)==null?void 0:n.assets)==null?void 0:i.imageId)??""];return we`
      <wui-flex
        flexDirection="column"
        alignItems="center"
        gap="4"
        .padding=${["0","5","3","5"]}
      >
        <wui-avatar
          alt=${this.address}
          address=${this.address}
          imageSrc=${Tn(this.profileImage)}
          size="lg"
        ></wui-avatar>
        <wui-flex flexDirection="column" alignItems="center">
          <wui-flex gap="1" alignItems="center" justifyContent="center">
            <wui-text variant="h5-medium" color="primary" data-testid="account-settings-address">
              ${us.getTruncateString({string:this.address,charsStart:4,charsEnd:6,truncate:"middle"})}
            </wui-text>
            <wui-icon-link
              size="md"
              icon="copy"
              iconColor="default"
              @click=${this.onCopyAddress}
            ></wui-icon-link>
          </wui-flex>
        </wui-flex>
      </wui-flex>
      <wui-flex flexDirection="column" gap="4">
        <wui-flex flexDirection="column" gap="2" .padding=${["6","4","3","4"]}>
          ${this.authCardTemplate()}
          <w3m-account-auth-button></w3m-account-auth-button>
          <wui-list-item
            imageSrc=${Tn(e)}
            ?chevron=${this.isAllowedNetworkSwitch()}
            ?fullSize=${!0}
            ?rounded=${!0}
            @click=${this.onNetworks.bind(this)}
            data-testid="account-switch-network-button"
          >
            <wui-text variant="lg-regular" color="primary">
              ${((o=this.network)==null?void 0:o.name)??"Unknown"}
            </wui-text>
          </wui-list-item>
          ${this.smartAccountSettingsTemplate()} ${this.chooseNameButtonTemplate()}
          <wui-list-item
            ?rounded=${!0}
            icon="power"
            iconColor="error"
            ?chevron=${!1}
            .loading=${this.disconnecting}
            @click=${this.onDisconnect.bind(this)}
            data-testid="disconnect-button"
          >
            <wui-text variant="lg-regular" color="primary">Disconnect</wui-text>
          </wui-list-item>
        </wui-flex>
      </wui-flex>
    `}chooseNameButtonTemplate(){var l;const e=(l=this.network)==null?void 0:l.chainNamespace,n=Nt.getConnectorId(e),i=Nt.getAuthConnector();return!ue.checkIfNamesSupported()||!i||n!==at.CONNECTOR_ID.AUTH||this.profileName?null:we`
      <wui-list-item
        icon="id"
        ?rounded=${!0}
        ?chevron=${!0}
        @click=${this.onChooseName.bind(this)}
        data-testid="account-choose-name-button"
      >
        <wui-text variant="lg-regular" color="primary">Choose account name </wui-text>
      </wui-list-item>
    `}authCardTemplate(){var o;const e=Nt.getConnectorId((o=this.network)==null?void 0:o.chainNamespace),n=Nt.getAuthConnector(),{origin:i}=location;return!n||e!==at.CONNECTOR_ID.AUTH||i.includes(hi.SECURE_SITE)?null:we`
      <wui-notice-card
        @click=${this.onGoToUpgradeView.bind(this)}
        label="Upgrade your wallet"
        description="Transition to a self-custodial wallet"
        icon="wallet"
        data-testid="w3m-wallet-upgrade-card"
      ></wui-notice-card>
    `}isAllowedNetworkSwitch(){const e=ue.getAllRequestedCaipNetworks(),n=e?e.length>1:!1,i=e==null?void 0:e.find(({id:o})=>{var l;return o===((l=this.network)==null?void 0:l.id)});return n||!i}onCopyAddress(){try{this.address&&(Ft.copyToClopboard(this.address),Ji.showSuccess("Address copied"))}catch{Ji.showError("Failed to copy")}}smartAccountSettingsTemplate(){var l;const e=(l=this.network)==null?void 0:l.chainNamespace,n=ue.checkIfSmartAccountEnabled(),i=Nt.getConnectorId(e);return!Nt.getAuthConnector()||i!==at.CONNECTOR_ID.AUTH||!n?null:we`
      <wui-list-item
        icon="user"
        ?rounded=${!0}
        ?chevron=${!0}
        @click=${this.onSmartAccountSettings.bind(this)}
        data-testid="account-smart-account-settings-button"
      >
        <wui-text variant="lg-regular" color="primary">Smart Account Settings</wui-text>
      </wui-list-item>
    `}onChooseName(){Pt.push("ChooseAccountName")}onNetworks(){this.isAllowedNetworkSwitch()&&Pt.push("Networks")}async onDisconnect(){var e,n;try{this.disconnecting=!0;const i=(e=this.network)==null?void 0:e.chainNamespace,l=Ht.getConnections(i).length>0,h=i&&Nt.state.activeConnectorIds[i],s=(n=this.remoteFeatures)==null?void 0:n.multiWallet;await Ht.disconnect(s?{id:h,namespace:i}:{}),l&&s&&(Pt.push("ProfileWallets"),Ji.showSuccess("Wallet deleted"))}catch{Sn.sendEvent({type:"track",event:"DISCONNECT_ERROR",properties:{message:"Failed to disconnect"}}),Ji.showError("Failed to disconnect")}finally{this.disconnecting=!1}}onGoToUpgradeView(){Sn.sendEvent({type:"track",event:"EMAIL_UPGRADE_FROM_MODAL"}),Pt.push("UpgradeEmailWallet")}onSmartAccountSettings(){Pt.push("SmartAccountSettings")}};Ny([Lt()],Gf.prototype,"address",void 0);Ny([Lt()],Gf.prototype,"profileImage",void 0);Ny([Lt()],Gf.prototype,"profileName",void 0);Ny([Lt()],Gf.prototype,"network",void 0);Ny([Lt()],Gf.prototype,"disconnecting",void 0);Ny([Lt()],Gf.prototype,"remoteFeatures",void 0);Gf=Ny([nn("w3m-account-settings-view")],Gf);const I4e=Fn`
  :host {
    flex: 1;
    height: 100%;
  }

  button {
    width: 100%;
    height: 100%;
    display: inline-flex;
    align-items: center;
    padding: ${({spacing:t})=>t[1]} ${({spacing:t})=>t[2]};
    column-gap: ${({spacing:t})=>t[1]};
    color: ${({tokens:t})=>t.theme.textSecondary};
    border-radius: ${({borderRadius:t})=>t[20]};
    background-color: transparent;
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color;
  }

  /* -- Hover & Active states ----------------------------------------------------------- */
  button[data-active='true'] {
    color: ${({tokens:t})=>t.theme.textPrimary};
    background-color: ${({tokens:t})=>t.theme.foregroundTertiary};
  }

  button:hover:enabled:not([data-active='true']),
  button:active:enabled:not([data-active='true']) {
    wui-text,
    wui-icon {
      color: ${({tokens:t})=>t.theme.textPrimary};
    }
  }
`;var GE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const P4e={lg:"lg-regular",md:"md-regular",sm:"sm-regular"},R4e={lg:"md",md:"sm",sm:"sm"};let dy=class extends on{constructor(){super(...arguments),this.icon="mobile",this.size="md",this.label="",this.active=!1}render(){return we`
      <button data-active=${this.active}>
        ${this.icon?we`<wui-icon size=${R4e[this.size]} name=${this.icon}></wui-icon>`:""}
        <wui-text variant=${P4e[this.size]}> ${this.label} </wui-text>
      </button>
    `}};dy.styles=[Ei,Kr,I4e];GE([Fe()],dy.prototype,"icon",void 0);GE([Fe()],dy.prototype,"size",void 0);GE([Fe()],dy.prototype,"label",void 0);GE([Fe({type:Boolean})],dy.prototype,"active",void 0);dy=GE([nn("wui-tab-item")],dy);const O4e=Fn`
  :host {
    display: inline-flex;
    align-items: center;
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    border-radius: ${({borderRadius:t})=>t[32]};
    padding: ${({spacing:t})=>t["01"]};
    box-sizing: border-box;
  }

  :host([data-size='sm']) {
    height: 26px;
  }

  :host([data-size='md']) {
    height: 36px;
  }
`;var qE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let hy=class extends on{constructor(){super(...arguments),this.tabs=[],this.onTabChange=()=>null,this.size="md",this.activeTab=0}render(){return this.dataset.size=this.size,this.tabs.map((e,n)=>{var o;const i=n===this.activeTab;return we`
        <wui-tab-item
          @click=${()=>this.onTabClick(n)}
          icon=${e.icon}
          size=${this.size}
          label=${e.label}
          ?active=${i}
          data-active=${i}
          data-testid="tab-${(o=e.label)==null?void 0:o.toLowerCase()}"
        ></wui-tab-item>
      `})}onTabClick(e){this.activeTab=e,this.onTabChange(e)}};hy.styles=[Ei,Kr,O4e];qE([Fe({type:Array})],hy.prototype,"tabs",void 0);qE([Fe()],hy.prototype,"onTabChange",void 0);qE([Fe()],hy.prototype,"size",void 0);qE([Lt()],hy.prototype,"activeTab",void 0);hy=qE([nn("wui-tabs")],hy);const k4e=Fn`
  :host {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: ${({spacing:t})=>t[1]};
    text-transform: uppercase;
    white-space: nowrap;
  }

  :host([data-variant='accent']) {
    background-color: ${({tokens:t})=>t.core.foregroundAccent010};
    color: ${({tokens:t})=>t.core.textAccentPrimary};
  }

  :host([data-variant='info']) {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  :host([data-variant='success']) {
    background-color: ${({tokens:t})=>t.core.backgroundSuccess};
    color: ${({tokens:t})=>t.core.textSuccess};
  }

  :host([data-variant='warning']) {
    background-color: ${({tokens:t})=>t.core.backgroundWarning};
    color: ${({tokens:t})=>t.core.textWarning};
  }

  :host([data-variant='error']) {
    background-color: ${({tokens:t})=>t.core.backgroundError};
    color: ${({tokens:t})=>t.core.textError};
  }

  :host([data-variant='certified']) {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  :host([data-size='md']) {
    height: 30px;
    padding: 0 ${({spacing:t})=>t[2]};
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  :host([data-size='sm']) {
    height: 20px;
    padding: 0 ${({spacing:t})=>t[1]};
    border-radius: ${({borderRadius:t})=>t[1]};
  }
`;var fI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let yw=class extends on{constructor(){super(...arguments),this.variant="accent",this.size="md",this.icon=void 0}render(){this.dataset.variant=this.variant,this.dataset.size=this.size;const e=this.size==="md"?"md-medium":"sm-medium",n=this.size==="md"?"md":"sm";return we`
      ${this.icon?we`<wui-icon size=${n} name=${this.icon}></wui-icon>`:null}
      <wui-text
        display="inline"
        data-variant=${this.variant}
        variant=${e}
        color="inherit"
      >
        <slot></slot>
      </wui-text>
    `}};yw.styles=[Ei,k4e];fI([Fe()],yw.prototype,"variant",void 0);fI([Fe()],yw.prototype,"size",void 0);fI([Fe()],yw.prototype,"icon",void 0);yw=fI([nn("wui-tag")],yw);const D4e=Fn`
  button {
    display: flex;
    align-items: center;
    height: 40px;
    padding: ${({spacing:t})=>t[2]};
    border-radius: ${({borderRadius:t})=>t[4]};
    column-gap: ${({spacing:t})=>t[1]};
    background-color: transparent;
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color;
  }

  wui-image,
  .icon-box {
    width: ${({spacing:t})=>t[6]};
    height: ${({spacing:t})=>t[6]};
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  wui-text {
    flex: 1;
  }

  .icon-box {
    position: relative;
  }

  .icon-box[data-active='true'] {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  .circle {
    position: absolute;
    left: 16px;
    top: 15px;
    width: 8px;
    height: 8px;
    background-color: ${({tokens:t})=>t.core.textSuccess};
    box-shadow: 0 0 0 2px ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: 50%;
  }

  /* -- Hover & Active states ----------------------------------------------------------- */
  @media (hover: hover) {
    button:hover:enabled,
    button:active:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    }
  }
`;var Td=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Vl=class extends on{constructor(){super(...arguments),this.address="",this.profileName="",this.alt="",this.imageSrc="",this.icon=void 0,this.iconSize="md",this.enableGreenCircle=!0,this.loading=!1,this.charsStart=4,this.charsEnd=6}render(){return we`
      <button>
        ${this.leftImageTemplate()} ${this.textTemplate()} ${this.rightImageTemplate()}
      </button>
    `}leftImageTemplate(){const e=this.icon?we`<wui-icon
          size=${Tn(this.iconSize)}
          color="default"
          name=${this.icon}
          class="icon"
        ></wui-icon>`:we`<wui-image src=${this.imageSrc} alt=${this.alt}></wui-image>`;return we`
      <wui-flex
        alignItems="center"
        justifyContent="center"
        class="icon-box"
        data-active=${!!this.icon}
      >
        ${e}
        ${this.enableGreenCircle?we`<wui-flex class="circle"></wui-flex>`:null}
      </wui-flex>
    `}textTemplate(){return we`
      <wui-text variant="lg-regular" color="primary">
        ${us.getTruncateString({string:this.profileName||this.address,charsStart:this.profileName?16:this.charsStart,charsEnd:this.profileName?0:this.charsEnd,truncate:this.profileName?"end":"middle"})}
      </wui-text>
    `}rightImageTemplate(){return we`<wui-icon name="chevronBottom" size="sm" color="default"></wui-icon>`}};Vl.styles=[Ei,Kr,D4e];Td([Fe()],Vl.prototype,"address",void 0);Td([Fe()],Vl.prototype,"profileName",void 0);Td([Fe()],Vl.prototype,"alt",void 0);Td([Fe()],Vl.prototype,"imageSrc",void 0);Td([Fe()],Vl.prototype,"icon",void 0);Td([Fe()],Vl.prototype,"iconSize",void 0);Td([Fe({type:Boolean})],Vl.prototype,"enableGreenCircle",void 0);Td([Fe({type:Boolean})],Vl.prototype,"loading",void 0);Td([Fe({type:Number})],Vl.prototype,"charsStart",void 0);Td([Fe({type:Number})],Vl.prototype,"charsEnd",void 0);Vl=Td([nn("wui-wallet-switch")],Vl);const N4e=Fn`
  wui-icon-link {
    margin-right: calc(${({spacing:t})=>t[8]} * -1);
  }

  wui-notice-card {
    margin-bottom: ${({spacing:t})=>t[1]};
  }

  wui-list-item > wui-text {
    flex: 1;
  }

  w3m-transactions-view {
    max-height: 200px;
  }

  .balance-container {
    display: inline;
  }

  .tab-content-container {
    height: 300px;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: none;
  }

  .symbol {
    transform: translateY(-2px);
  }

  .tab-content-container::-webkit-scrollbar {
    display: none;
  }

  .account-button {
    width: auto;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: ${({spacing:t})=>t[3]};
    height: 48px;
    padding: ${({spacing:t})=>t[2]};
    padding-right: ${({spacing:t})=>t[3]};
    box-shadow: inset 0 0 0 1px ${({tokens:t})=>t.theme.foregroundPrimary};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[6]};
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
  }

  .account-button:hover {
    background-color: ${({tokens:t})=>t.core.glass010};
  }

  .avatar-container {
    position: relative;
  }

  wui-avatar.avatar {
    width: 32px;
    height: 32px;
    box-shadow: 0 0 0 2px ${({tokens:t})=>t.core.glass010};
  }

  wui-wallet-switch {
    margin-top: ${({spacing:t})=>t[2]};
  }

  wui-avatar.network-avatar {
    width: 16px;
    height: 16px;
    position: absolute;
    left: 100%;
    top: 100%;
    transform: translate(-75%, -75%);
    box-shadow: 0 0 0 2px ${({tokens:t})=>t.core.glass010};
  }

  .account-links {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .account-links wui-flex {
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
    background: red;
    align-items: center;
    justify-content: center;
    height: 48px;
    padding: 10px;
    flex: 1 0 0;
    border-radius: var(--XS, 16px);
    border: 1px solid var(--dark-accent-glass-010, rgba(71, 161, 255, 0.1));
    background: var(--dark-accent-glass-010, rgba(71, 161, 255, 0.1));
    transition:
      background-color ${({durations:t})=>t.md}
        ${({easings:t})=>t["ease-out-power-1"]},
      opacity ${({durations:t})=>t.md} ${({easings:t})=>t["ease-out-power-1"]};
    will-change: background-color, opacity;
  }

  .account-links wui-flex:hover {
    background: var(--dark-accent-glass-015, rgba(71, 161, 255, 0.15));
  }

  .account-links wui-flex wui-icon {
    width: var(--S, 20px);
    height: var(--S, 20px);
  }

  .account-links wui-flex wui-icon svg path {
    stroke: #667dff;
  }
`;var ku=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let al=class extends on{constructor(){var e,n,i,o,l,h;super(),this.unsubscribe=[],this.caipAddress=(e=ue.getAccountData())==null?void 0:e.caipAddress,this.address=Ft.getPlainAddress((n=ue.getAccountData())==null?void 0:n.caipAddress),this.profileImage=(i=ue.getAccountData())==null?void 0:i.profileImage,this.profileName=(o=ue.getAccountData())==null?void 0:o.profileName,this.disconnecting=!1,this.balance=(l=ue.getAccountData())==null?void 0:l.balance,this.balanceSymbol=(h=ue.getAccountData())==null?void 0:h.balanceSymbol,this.features=ut.state.features,this.remoteFeatures=ut.state.remoteFeatures,this.namespace=ue.state.activeChain,this.activeConnectorIds=Nt.state.activeConnectorIds,this.unsubscribe.push(ue.subscribeChainProp("accountState",s=>{this.address=Ft.getPlainAddress(s==null?void 0:s.caipAddress),this.caipAddress=s==null?void 0:s.caipAddress,this.balance=s==null?void 0:s.balance,this.balanceSymbol=s==null?void 0:s.balanceSymbol,this.profileName=s==null?void 0:s.profileName,this.profileImage=s==null?void 0:s.profileImage}),ut.subscribeKey("features",s=>this.features=s),ut.subscribeKey("remoteFeatures",s=>this.remoteFeatures=s),Nt.subscribeKey("activeConnectorIds",s=>{this.activeConnectorIds=s}),ue.subscribeKey("activeChain",s=>this.namespace=s),ue.subscribeKey("activeCaipNetwork",s=>{s!=null&&s.chainNamespace&&(this.namespace=s==null?void 0:s.chainNamespace)}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){if(!this.caipAddress||!this.namespace)return null;const e=this.activeConnectorIds[this.namespace],n=e?Nt.getConnectorById(e):void 0,i=Ur.getConnectorImage(n),{value:o,decimals:l,symbol:h}=Ft.parseBalance(this.balance,this.balanceSymbol);return we`<wui-flex
        flexDirection="column"
        .padding=${["0","5","4","5"]}
        alignItems="center"
        gap="3"
      >
        <wui-avatar
          alt=${Tn(this.caipAddress)}
          address=${Tn(Ft.getPlainAddress(this.caipAddress))}
          imageSrc=${Tn(this.profileImage===null?void 0:this.profileImage)}
          data-testid="single-account-avatar"
        ></wui-avatar>
        <wui-wallet-switch
          profileName=${this.profileName}
          address=${this.address}
          imageSrc=${i}
          alt=${n==null?void 0:n.name}
          @click=${this.onGoToProfileWalletsView.bind(this)}
          data-testid="wui-wallet-switch"
        ></wui-wallet-switch>
        <div class="balance-container">
          <wui-text variant="h3-regular" color="primary">${o}</wui-text>
          <wui-text variant="h3-regular" color="secondary">.${l}</wui-text>
          <wui-text variant="h6-medium" color="primary" class="symbol">${h}</wui-text>
        </div>
        ${this.explorerBtnTemplate()}
      </wui-flex>

      <wui-flex flexDirection="column" gap="2" .padding=${["0","3","3","3"]}>
        ${this.authCardTemplate()} <w3m-account-auth-button></w3m-account-auth-button>
        ${this.orderedFeaturesTemplate()} ${this.activityTemplate()}
        <wui-list-item
          .rounded=${!0}
          icon="power"
          iconColor="error"
          ?chevron=${!1}
          .loading=${this.disconnecting}
          .rightIcon=${!1}
          @click=${this.onDisconnect.bind(this)}
          data-testid="disconnect-button"
        >
          <wui-text variant="lg-regular" color="primary">Disconnect</wui-text>
        </wui-list-item>
      </wui-flex>`}fundWalletTemplate(){var l,h;if(!this.namespace)return null;const e=hi.ONRAMP_SUPPORTED_CHAIN_NAMESPACES.includes(this.namespace),n=!!((l=this.features)!=null&&l.receive),i=((h=this.remoteFeatures)==null?void 0:h.onramp)&&e,o=ko.isPayWithExchangeEnabled();return!i&&!n&&!o?null:we`
      <wui-list-item
        .rounded=${!0}
        data-testid="w3m-account-default-fund-wallet-button"
        iconVariant="blue"
        icon="dollar"
        ?chevron=${!0}
        @click=${this.handleClickFundWallet.bind(this)}
      >
        <wui-text variant="lg-regular" color="primary">Fund wallet</wui-text>
      </wui-list-item>
    `}orderedFeaturesTemplate(){var n;return(((n=this.features)==null?void 0:n.walletFeaturesOrder)||hi.DEFAULT_FEATURES.walletFeaturesOrder).map(i=>{switch(i){case"onramp":return this.fundWalletTemplate();case"swaps":return this.swapsTemplate();case"send":return this.sendTemplate();default:return null}})}activityTemplate(){var n;return this.namespace&&((n=this.remoteFeatures)==null?void 0:n.activity)&&hi.ACTIVITY_ENABLED_CHAIN_NAMESPACES.includes(this.namespace)?we` <wui-list-item
          .rounded=${!0}
          icon="clock"
          ?chevron=${!0}
          @click=${this.onTransactions.bind(this)}
          data-testid="w3m-account-default-activity-button"
        >
          <wui-text variant="lg-regular" color="primary">Activity</wui-text>
        </wui-list-item>`:null}swapsTemplate(){var i;const e=(i=this.remoteFeatures)==null?void 0:i.swaps,n=ue.state.activeChain===at.CHAIN.EVM;return!e||!n?null:we`
      <wui-list-item
        .rounded=${!0}
        icon="recycleHorizontal"
        ?chevron=${!0}
        @click=${this.handleClickSwap.bind(this)}
        data-testid="w3m-account-default-swaps-button"
      >
        <wui-text variant="lg-regular" color="primary">Swap</wui-text>
      </wui-list-item>
    `}sendTemplate(){var o;const e=(o=this.features)==null?void 0:o.send,n=ue.state.activeChain;if(!n)throw new Error("SendController:sendTemplate - namespace is required");const i=hi.SEND_SUPPORTED_NAMESPACES.includes(n);return!e||!i?null:we`
      <wui-list-item
        .rounded=${!0}
        icon="send"
        ?chevron=${!0}
        @click=${this.handleClickSend.bind(this)}
        data-testid="w3m-account-default-send-button"
      >
        <wui-text variant="lg-regular" color="primary">Send</wui-text>
      </wui-list-item>
    `}authCardTemplate(){const e=ue.state.activeChain;if(!e)throw new Error("AuthCardTemplate:authCardTemplate - namespace is required");const n=Nt.getConnectorId(e),i=Nt.getAuthConnector(),{origin:o}=location;return!i||n!==at.CONNECTOR_ID.AUTH||o.includes(hi.SECURE_SITE)?null:we`
      <wui-notice-card
        @click=${this.onGoToUpgradeView.bind(this)}
        label="Upgrade your wallet"
        description="Transition to a self-custodial wallet"
        icon="wallet"
        data-testid="w3m-wallet-upgrade-card"
      ></wui-notice-card>
    `}handleClickFundWallet(){Pt.push("FundWallet")}handleClickSwap(){Pt.push("Swap")}handleClickSend(){Pt.push("WalletSend")}explorerBtnTemplate(){var n;return((n=ue.getAccountData())==null?void 0:n.addressExplorerUrl)?we`
      <wui-button size="md" variant="accent-primary" @click=${this.onExplorer.bind(this)}>
        <wui-icon size="sm" color="inherit" slot="iconLeft" name="compass"></wui-icon>
        Block Explorer
        <wui-icon size="sm" color="inherit" slot="iconRight" name="externalLink"></wui-icon>
      </wui-button>
    `:null}onTransactions(){Sn.sendEvent({type:"track",event:"CLICK_TRANSACTIONS",properties:{isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}),Pt.push("Transactions")}async onDisconnect(){var e;try{this.disconnecting=!0;const i=Ht.getConnections(this.namespace).length>0,o=this.namespace&&Nt.state.activeConnectorIds[this.namespace],l=(e=this.remoteFeatures)==null?void 0:e.multiWallet;await Ht.disconnect(l?{id:o,namespace:this.namespace}:{}),i&&l&&(Pt.push("ProfileWallets"),Ji.showSuccess("Wallet deleted"))}catch{Sn.sendEvent({type:"track",event:"DISCONNECT_ERROR",properties:{message:"Failed to disconnect"}}),Ji.showError("Failed to disconnect")}finally{this.disconnecting=!1}}onExplorer(){var n;const e=(n=ue.getAccountData())==null?void 0:n.addressExplorerUrl;e&&Ft.openHref(e,"_blank")}onGoToUpgradeView(){Sn.sendEvent({type:"track",event:"EMAIL_UPGRADE_FROM_MODAL"}),Pt.push("UpgradeEmailWallet")}onGoToProfileWalletsView(){Pt.push("ProfileWallets")}};al.styles=N4e;ku([Lt()],al.prototype,"caipAddress",void 0);ku([Lt()],al.prototype,"address",void 0);ku([Lt()],al.prototype,"profileImage",void 0);ku([Lt()],al.prototype,"profileName",void 0);ku([Lt()],al.prototype,"disconnecting",void 0);ku([Lt()],al.prototype,"balance",void 0);ku([Lt()],al.prototype,"balanceSymbol",void 0);ku([Lt()],al.prototype,"features",void 0);ku([Lt()],al.prototype,"remoteFeatures",void 0);ku([Lt()],al.prototype,"namespace",void 0);ku([Lt()],al.prototype,"activeConnectorIds",void 0);al=ku([nn("w3m-account-default-widget")],al);const M4e=Fn`
  span {
    font-weight: 500;
    font-size: 38px;
    color: ${({tokens:t})=>t.theme.textPrimary};
    line-height: 38px;
    letter-spacing: -2%;
    text-align: center;
    font-family: var(--apkt-fontFamily-regular);
  }

  .pennies {
    color: ${({tokens:t})=>t.theme.textSecondary};
  }
`;var YD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Z2=class extends on{constructor(){super(...arguments),this.dollars="0",this.pennies="00"}render(){return we`<span>$${this.dollars}<span class="pennies">.${this.pennies}</span></span>`}};Z2.styles=[Ei,M4e];YD([Fe()],Z2.prototype,"dollars",void 0);YD([Fe()],Z2.prototype,"pennies",void 0);Z2=YD([nn("wui-balance")],Z2);const L4e=Fn`
  :host {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  wui-icon {
    position: absolute;
    width: 12px !important;
    height: 4px !important;
  }

  /* -- Variants --------------------------------------------------------- */
  :host([data-variant='fill']) {
    background-color: ${({colors:t})=>t.neutrals100};
  }

  :host([data-variant='shade']) {
    background-color: ${({colors:t})=>t.neutrals900};
  }

  :host([data-variant='fill']) > wui-text {
    color: ${({colors:t})=>t.black};
  }

  :host([data-variant='shade']) > wui-text {
    color: ${({colors:t})=>t.white};
  }

  :host([data-variant='fill']) > wui-icon {
    color: ${({colors:t})=>t.neutrals100};
  }

  :host([data-variant='shade']) > wui-icon {
    color: ${({colors:t})=>t.neutrals900};
  }

  /* -- Sizes --------------------------------------------------------- */
  :host([data-size='sm']) {
    padding: ${({spacing:t})=>t[1]} ${({spacing:t})=>t[2]};
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  :host([data-size='md']) {
    padding: ${({spacing:t})=>t[2]} ${({spacing:t})=>t[3]};
    border-radius: ${({borderRadius:t})=>t[3]};
  }

  /* -- Placements --------------------------------------------------------- */
  wui-icon[data-placement='top'] {
    bottom: 0px;
    left: 50%;
    transform: translate(-50%, 95%);
  }

  wui-icon[data-placement='bottom'] {
    top: 0;
    left: 50%;
    transform: translate(-50%, -95%) rotate(180deg);
  }

  wui-icon[data-placement='right'] {
    top: 50%;
    left: 0;
    transform: translate(-65%, -50%) rotate(90deg);
  }

  wui-icon[data-placement='left'] {
    top: 50%;
    right: 0%;
    transform: translate(65%, -50%) rotate(270deg);
  }
`;var ZE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const B4e={sm:"sm-regular",md:"md-regular"};let fy=class extends on{constructor(){super(...arguments),this.placement="top",this.variant="fill",this.size="md",this.message=""}render(){return this.dataset.variant=this.variant,this.dataset.size=this.size,we`<wui-icon data-placement=${this.placement} size="inherit" name="cursor"></wui-icon>
      <wui-text variant=${B4e[this.size]}>${this.message}</wui-text>`}};fy.styles=[Ei,Kr,L4e];ZE([Fe()],fy.prototype,"placement",void 0);ZE([Fe()],fy.prototype,"variant",void 0);ZE([Fe()],fy.prototype,"size",void 0);ZE([Fe()],fy.prototype,"message",void 0);fy=ZE([nn("wui-tooltip")],fy);var SO;(function(t){t.approve="approved",t.bought="bought",t.borrow="borrowed",t.burn="burnt",t.cancel="canceled",t.claim="claimed",t.deploy="deployed",t.deposit="deposited",t.execute="executed",t.mint="minted",t.receive="received",t.repay="repaid",t.send="sent",t.sell="sold",t.stake="staked",t.trade="swapped",t.unstake="unstaked",t.withdraw="withdrawn"})(SO||(SO={}));const F4e=Fn`
  :host > wui-flex {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    width: 40px;
    height: 40px;
    box-shadow: inset 0 0 0 1px ${({tokens:t})=>t.core.glass010};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  :host([data-no-images='true']) > wui-flex {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[3]} !important;
  }

  :host > wui-flex wui-image {
    display: block;
  }

  :host > wui-flex,
  :host > wui-flex wui-image,
  .swap-images-container,
  .swap-images-container.nft,
  wui-image.nft {
    border-top-left-radius: var(--local-left-border-radius);
    border-top-right-radius: var(--local-right-border-radius);
    border-bottom-left-radius: var(--local-left-border-radius);
    border-bottom-right-radius: var(--local-right-border-radius);
  }

  .swap-images-container {
    position: relative;
    width: 40px;
    height: 40px;
    overflow: hidden;
  }

  .swap-images-container wui-image:first-child {
    position: absolute;
    width: 40px;
    height: 40px;
    top: 0;
    left: 0%;
    clip-path: inset(0px calc(50% + 2px) 0px 0%);
  }

  .swap-images-container wui-image:last-child {
    clip-path: inset(0px 0px 0px calc(50% + 2px));
  }

  .swap-fallback-container {
    position: absolute;
    inset: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .swap-fallback-container.first {
    clip-path: inset(0px calc(50% + 2px) 0px 0%);
  }

  .swap-fallback-container.last {
    clip-path: inset(0px 0px 0px calc(50% + 2px));
  }

  wui-flex.status-box {
    position: absolute;
    right: 0;
    bottom: 0;
    transform: translate(20%, 20%);
    border-radius: ${({borderRadius:t})=>t[4]};
    background-color: ${({tokens:t})=>t.theme.backgroundPrimary};
    box-shadow: 0 0 0 2px ${({tokens:t})=>t.theme.backgroundPrimary};
    overflow: hidden;
    width: 16px;
    height: 16px;
  }
`;var eg=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Ph=class extends on{constructor(){super(...arguments),this.images=[],this.secondImage={type:void 0,url:""},this.failedImageUrls=new Set}handleImageError(e){return n=>{n.stopPropagation(),this.failedImageUrls.add(e),this.requestUpdate()}}render(){const[e,n]=this.images;this.images.length||(this.dataset.noImages="true");const i=(e==null?void 0:e.type)==="NFT",o=n!=null&&n.url?n.type==="NFT":i,l=i?"var(--apkt-borderRadius-3)":"var(--apkt-borderRadius-5)",h=o?"var(--apkt-borderRadius-3)":"var(--apkt-borderRadius-5)";return this.style.cssText=`
    --local-left-border-radius: ${l};
    --local-right-border-radius: ${h};
    `,we`<wui-flex> ${this.templateVisual()} ${this.templateIcon()} </wui-flex>`}templateVisual(){const[e,n]=this.images;return this.images.length===2&&(e!=null&&e.url||n!=null&&n.url)?this.renderSwapImages(e,n):e!=null&&e.url&&!this.failedImageUrls.has(e.url)?this.renderSingleImage(e):(e==null?void 0:e.type)==="NFT"?this.renderPlaceholderIcon("nftPlaceholder"):this.renderPlaceholderIcon("coinPlaceholder")}renderSwapImages(e,n){return we`<div class="swap-images-container">
      ${e!=null&&e.url?this.renderImageOrFallback(e,"first",!0):null}
      ${n!=null&&n.url?this.renderImageOrFallback(n,"last",!0):null}
    </div>`}renderSingleImage(e){return this.renderImageOrFallback(e,void 0,!1)}renderImageOrFallback(e,n,i=!1){return e.url?this.failedImageUrls.has(e.url)?i&&n?this.renderFallbackIconInContainer(n):this.renderFallbackIcon():we`<wui-image
      src=${e.url}
      alt="Transaction image"
      @onLoadError=${this.handleImageError(e.url)}
    ></wui-image>`:null}renderFallbackIconInContainer(e){return we`<div class="swap-fallback-container ${e}">${this.renderFallbackIcon()}</div>`}renderFallbackIcon(){return we`<wui-icon
      size="xl"
      weight="regular"
      color="default"
      name="networkPlaceholder"
    ></wui-icon>`}renderPlaceholderIcon(e){return we`<wui-icon size="xl" weight="regular" color="default" name=${e}></wui-icon>`}templateIcon(){let e="accent-primary",n;return n=this.getIcon(),this.status&&(e=this.getStatusColor()),n?we`
      <wui-flex alignItems="center" justifyContent="center" class="status-box">
        <wui-icon-box size="sm" color=${e} icon=${n}></wui-icon-box>
      </wui-flex>
    `:null}getDirectionIcon(){switch(this.direction){case"in":return"arrowBottom";case"out":return"arrowTop";default:return}}getIcon(){return this.onlyDirectionIcon?this.getDirectionIcon():this.type==="trade"?"swapHorizontal":this.type==="approve"?"checkmark":this.type==="cancel"?"close":this.getDirectionIcon()}getStatusColor(){switch(this.status){case"confirmed":return"success";case"failed":return"error";case"pending":return"inverse";default:return"accent-primary"}}};Ph.styles=[F4e];eg([Fe()],Ph.prototype,"type",void 0);eg([Fe()],Ph.prototype,"status",void 0);eg([Fe()],Ph.prototype,"direction",void 0);eg([Fe({type:Boolean})],Ph.prototype,"onlyDirectionIcon",void 0);eg([Fe({type:Array})],Ph.prototype,"images",void 0);eg([Fe({type:Object})],Ph.prototype,"secondImage",void 0);eg([Lt()],Ph.prototype,"failedImageUrls",void 0);Ph=eg([nn("wui-transaction-visual")],Ph);const $4e=Fn`
  :host {
    width: 100%;
  }

  :host > wui-flex:first-child {
    align-items: center;
    column-gap: ${({spacing:t})=>t[2]};
    padding: ${({spacing:t})=>t[1]} ${({spacing:t})=>t[2]};
    width: 100%;
  }

  :host > wui-flex:first-child wui-text:nth-child(1) {
    text-transform: capitalize;
  }

  wui-transaction-visual {
    width: 40px;
    height: 40px;
  }

  wui-flex {
    flex: 1;
  }

  :host wui-flex wui-flex {
    overflow: hidden;
  }

  :host .description-container wui-text span {
    word-break: break-all;
  }

  :host .description-container wui-text {
    overflow: hidden;
  }

  :host .description-separator-icon {
    margin: 0px 6px;
  }

  :host wui-text > span {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
  }
`;var tg=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Rh=class extends on{constructor(){super(...arguments),this.type="approve",this.onlyDirectionIcon=!1,this.images=[]}render(){return we`
      <wui-flex>
        <wui-transaction-visual
          .status=${this.status}
          direction=${Tn(this.direction)}
          type=${this.type}
          .onlyDirectionIcon=${this.onlyDirectionIcon}
          .images=${this.images}
        ></wui-transaction-visual>
        <wui-flex flexDirection="column" gap="1">
          <wui-text variant="lg-medium" color="primary">
            ${SO[this.type]||this.type}
          </wui-text>
          <wui-flex class="description-container">
            ${this.templateDescription()} ${this.templateSecondDescription()}
          </wui-flex>
        </wui-flex>
        <wui-text variant="sm-medium" color="secondary"><span>${this.date}</span></wui-text>
      </wui-flex>
    `}templateDescription(){var n;const e=(n=this.descriptions)==null?void 0:n[0];return e?we`
          <wui-text variant="md-regular" color="secondary">
            <span>${e}</span>
          </wui-text>
        `:null}templateSecondDescription(){var n;const e=(n=this.descriptions)==null?void 0:n[1];return e?we`
          <wui-icon class="description-separator-icon" size="sm" name="arrowRight"></wui-icon>
          <wui-text variant="md-regular" color="secondary">
            <span>${e}</span>
          </wui-text>
        `:null}};Rh.styles=[Ei,$4e];tg([Fe()],Rh.prototype,"type",void 0);tg([Fe({type:Array})],Rh.prototype,"descriptions",void 0);tg([Fe()],Rh.prototype,"date",void 0);tg([Fe({type:Boolean})],Rh.prototype,"onlyDirectionIcon",void 0);tg([Fe()],Rh.prototype,"status",void 0);tg([Fe()],Rh.prototype,"direction",void 0);tg([Fe({type:Array})],Rh.prototype,"images",void 0);Rh=tg([nn("wui-transaction-list-item")],Rh);const z4e=Fn`
  :host {
    display: block;
    background: linear-gradient(
      90deg,
      ${({tokens:t})=>t.theme.foregroundPrimary} 0%,
      ${({tokens:t})=>t.theme.foregroundSecondary} 50%,
      ${({tokens:t})=>t.theme.foregroundPrimary} 100%
    );
    background-size: 200% 100%;
    animation: shimmer 2s linear infinite;
    border-radius: ${({borderRadius:t})=>t[1]};
  }

  :host([data-rounded='true']) {
    border-radius: ${({borderRadius:t})=>t[16]};
  }

  @keyframes shimmer {
    0% {
      background-position: 100% 0;
    }
    100% {
      background-position: -100% 0;
    }
  }
`;var KE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let py=class extends on{constructor(){super(...arguments),this.width="",this.height="",this.variant="default",this.rounded=!1}render(){return this.style.cssText=`
      width: ${this.width};
      height: ${this.height};
    `,this.dataset.rounded=this.rounded?"true":"false",we`<slot></slot>`}};py.styles=[z4e];KE([Fe()],py.prototype,"width",void 0);KE([Fe()],py.prototype,"height",void 0);KE([Fe()],py.prototype,"variant",void 0);KE([Fe({type:Boolean})],py.prototype,"rounded",void 0);py=KE([nn("wui-shimmer")],py);const U4e=Fn`
  wui-flex {
    position: relative;
    display: inline-flex;
    justify-content: center;
    align-items: center;
  }

  wui-image {
    border-radius: ${({borderRadius:t})=>t[128]};
  }

  .fallback-icon {
    color: ${({tokens:t})=>t.theme.iconInverse};
    border-radius: ${({borderRadius:t})=>t[3]};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  .direction-icon,
  .status-image {
    position: absolute;
    right: 0;
    bottom: 0;
    border-radius: ${({borderRadius:t})=>t[128]};
    border: 2px solid ${({tokens:t})=>t.theme.backgroundPrimary};
  }

  .direction-icon {
    padding: ${({spacing:t})=>t["01"]};
    color: ${({tokens:t})=>t.core.iconSuccess};

    background-color: color-mix(
      in srgb,
      ${({tokens:t})=>t.core.textSuccess} 30%,
      ${({tokens:t})=>t.theme.backgroundPrimary} 70%
    );
  }

  /* -- Sizes --------------------------------------------------- */
  :host([data-size='sm']) > wui-image:not(.status-image),
  :host([data-size='sm']) > wui-flex {
    width: 24px;
    height: 24px;
  }

  :host([data-size='lg']) > wui-image:not(.status-image),
  :host([data-size='lg']) > wui-flex {
    width: 40px;
    height: 40px;
  }

  :host([data-size='sm']) .fallback-icon {
    height: 16px;
    width: 16px;
    padding: ${({spacing:t})=>t[1]};
  }

  :host([data-size='lg']) .fallback-icon {
    height: 32px;
    width: 32px;
    padding: ${({spacing:t})=>t[1]};
  }

  :host([data-size='sm']) .direction-icon,
  :host([data-size='sm']) .status-image {
    transform: translate(40%, 30%);
  }

  :host([data-size='lg']) .direction-icon,
  :host([data-size='lg']) .status-image {
    transform: translate(40%, 10%);
  }

  :host([data-size='sm']) .status-image {
    height: 14px;
    width: 14px;
  }

  :host([data-size='lg']) .status-image {
    height: 20px;
    width: 20px;
  }

  /* -- Crop effects --------------------------------------------------- */
  .swap-crop-left-image,
  .swap-crop-right-image {
    position: absolute;
    top: 0;
    bottom: 0;
  }

  .swap-crop-left-image {
    left: 0;
    clip-path: inset(0px calc(50% + 1.5px) 0px 0%);
  }

  .swap-crop-right-image {
    right: 0;
    clip-path: inset(0px 0px 0px calc(50% + 1.5px));
  }
`;var YE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const uR={sm:"xxs",lg:"md"};let my=class extends on{constructor(){super(...arguments),this.type="approve",this.size="lg",this.statusImageUrl="",this.images=[]}render(){return we`<wui-flex>${this.templateVisual()} ${this.templateIcon()}</wui-flex>`}templateVisual(){switch(this.dataset.size=this.size,this.type){case"trade":return this.swapTemplate();case"fiat":return this.fiatTemplate();case"unknown":return this.unknownTemplate();default:return this.tokenTemplate()}}swapTemplate(){const[e,n]=this.images;return this.images.length===2&&(e||n)?we`
        <wui-image class="swap-crop-left-image" src=${e} alt="Swap image"></wui-image>
        <wui-image class="swap-crop-right-image" src=${n} alt="Swap image"></wui-image>
      `:e?we`<wui-image src=${e} alt="Swap image"></wui-image>`:null}fiatTemplate(){return we`<wui-icon
      class="fallback-icon"
      size=${uR[this.size]}
      name="dollar"
    ></wui-icon>`}unknownTemplate(){return we`<wui-icon
      class="fallback-icon"
      size=${uR[this.size]}
      name="questionMark"
    ></wui-icon>`}tokenTemplate(){const[e]=this.images;return e?we`<wui-image src=${e} alt="Token image"></wui-image> `:we`<wui-icon
      class="fallback-icon"
      name=${this.type==="nft"?"image":"coinPlaceholder"}
    ></wui-icon>`}templateIcon(){return this.statusImageUrl?we`<wui-image
        class="status-image"
        src=${this.statusImageUrl}
        alt="Status image"
      ></wui-image>`:we`<wui-icon
      class="direction-icon"
      size=${uR[this.size]}
      name=${this.getTemplateIcon()}
    ></wui-icon>`}getTemplateIcon(){return this.type==="trade"?"arrowClockWise":"arrowBottom"}};my.styles=[U4e];YE([Fe()],my.prototype,"type",void 0);YE([Fe()],my.prototype,"size",void 0);YE([Fe()],my.prototype,"statusImageUrl",void 0);YE([Fe({type:Array})],my.prototype,"images",void 0);my=YE([nn("wui-transaction-thumbnail")],my);const j4e=Fn`
  :host > wui-flex:first-child {
    gap: ${({spacing:t})=>t[2]};
    padding: ${({spacing:t})=>t[3]};
    width: 100%;
  }

  wui-flex {
    display: flex;
    flex: 1;
  }
`;var V4e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let IO=class extends on{render(){return we`
      <wui-flex alignItems="center" .padding=${["1","2","1","2"]}>
        <wui-shimmer width="40px" height="40px" rounded></wui-shimmer>
        <wui-flex flexDirection="column" gap="1">
          <wui-shimmer width="124px" height="16px" rounded></wui-shimmer>
          <wui-shimmer width="60px" height="14px" rounded></wui-shimmer>
        </wui-flex>
        <wui-shimmer width="24px" height="12px" rounded></wui-shimmer>
      </wui-flex>
    `}};IO.styles=[Ei,j4e];IO=V4e([nn("wui-transaction-list-item-loader")],IO);const W4e=Fn`
  :host {
    min-height: 100%;
  }

  .group-container[last-group='true'] {
    padding-bottom: ${({spacing:t})=>t[3]};
  }

  .contentContainer {
    height: 280px;
  }

  .contentContainer > wui-icon-box {
    width: 40px;
    height: 40px;
    border-radius: ${({borderRadius:t})=>t[3]};
  }

  .contentContainer > .textContent {
    width: 65%;
  }

  .emptyContainer {
    height: 100%;
  }
`;var My=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const ZU="last-transaction",H4e=7;let qf=class extends on{constructor(){super(),this.unsubscribe=[],this.paginationObserver=void 0,this.page="activity",this.caipAddress=ue.state.activeCaipAddress,this.transactionsByYear=Ec.state.transactionsByYear,this.loading=Ec.state.loading,this.empty=Ec.state.empty,this.next=Ec.state.next,Ec.clearCursor(),this.unsubscribe.push(ue.subscribeKey("activeCaipAddress",e=>{e&&this.caipAddress!==e&&(Ec.resetTransactions(),Ec.fetchTransactions(e)),this.caipAddress=e}),ue.subscribeKey("activeCaipNetwork",()=>{this.updateTransactionView()}),Ec.subscribe(e=>{this.transactionsByYear=e.transactionsByYear,this.loading=e.loading,this.empty=e.empty,this.next=e.next}))}firstUpdated(){this.updateTransactionView(),this.createPaginationObserver()}updated(){this.setPaginationObserver()}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we` ${this.empty?null:this.templateTransactionsByYear()}
    ${this.loading?this.templateLoading():null}
    ${!this.loading&&this.empty?this.templateEmpty():null}`}updateTransactionView(){Ec.resetTransactions(),this.caipAddress&&Ec.fetchTransactions(Ft.getPlainAddress(this.caipAddress))}templateTransactionsByYear(){return Object.keys(this.transactionsByYear).sort().reverse().map(n=>{const i=parseInt(n,10),o=new Array(12).fill(null).map((l,h)=>{var x;const s=R1.getTransactionGroupTitle(i,h),w=(x=this.transactionsByYear[i])==null?void 0:x[h];return{groupTitle:s,transactions:w}}).filter(({transactions:l})=>l).reverse();return o.map(({groupTitle:l,transactions:h},s)=>{const w=s===o.length-1;return h?we`
          <wui-flex
            flexDirection="column"
            class="group-container"
            last-group="${w?"true":"false"}"
            data-testid="month-indexes"
          >
            <wui-flex
              alignItems="center"
              flexDirection="row"
              .padding=${["2","3","3","3"]}
            >
              <wui-text variant="md-medium" color="secondary" data-testid="group-title">
                ${l}
              </wui-text>
            </wui-flex>
            <wui-flex flexDirection="column" gap="2">
              ${this.templateTransactions(h,w)}
            </wui-flex>
          </wui-flex>
        `:null})})}templateRenderTransaction(e,n){const{date:i,descriptions:o,direction:l,images:h,status:s,type:w,transfers:x,isAllNFT:A}=this.getTransactionListItemProps(e);return we`
      <wui-transaction-list-item
        date=${i}
        .direction=${l}
        id=${n&&this.next?ZU:""}
        status=${s}
        type=${w}
        .images=${h}
        .onlyDirectionIcon=${A||x.length===1}
        .descriptions=${o}
      ></wui-transaction-list-item>
    `}templateTransactions(e,n){return e.map((i,o)=>{const l=n&&o===e.length-1;return we`${this.templateRenderTransaction(i,l)}`})}emptyStateActivity(){return we`<wui-flex
      class="emptyContainer"
      flexGrow="1"
      flexDirection="column"
      justifyContent="center"
      alignItems="center"
      .padding=${["10","5","10","5"]}
      gap="5"
      data-testid="empty-activity-state"
    >
      <wui-icon-box color="default" icon="wallet" size="xl"></wui-icon-box>
      <wui-flex flexDirection="column" alignItems="center" gap="2">
        <wui-text align="center" variant="lg-medium" color="primary">No Transactions yet</wui-text>
        <wui-text align="center" variant="lg-regular" color="secondary"
          >Start trading on dApps <br />
          to grow your wallet!</wui-text
        >
      </wui-flex>
    </wui-flex>`}emptyStateAccount(){return we`<wui-flex
      class="contentContainer"
      alignItems="center"
      justifyContent="center"
      flexDirection="column"
      gap="4"
      data-testid="empty-account-state"
    >
      <wui-icon-box icon="swapHorizontal" size="lg" color="default"></wui-icon-box>
      <wui-flex
        class="textContent"
        gap="2"
        flexDirection="column"
        justifyContent="center"
        flexDirection="column"
      >
        <wui-text variant="md-regular" align="center" color="primary">No activity yet</wui-text>
        <wui-text variant="sm-regular" align="center" color="secondary"
          >Your next transactions will appear here</wui-text
        >
      </wui-flex>
      <wui-link @click=${this.onReceiveClick.bind(this)}>Trade</wui-link>
    </wui-flex>`}templateEmpty(){return this.page==="account"?we`${this.emptyStateAccount()}`:we`${this.emptyStateActivity()}`}templateLoading(){return this.page==="activity"?we` <wui-flex flexDirection="column" width="100%">
        <wui-flex .padding=${["2","3","3","3"]}>
          <wui-shimmer width="70px" height="16px" rounded></wui-shimmer>
        </wui-flex>
        <wui-flex flexDirection="column" gap="2" width="100%">
          ${Array(H4e).fill(we` <wui-transaction-list-item-loader></wui-transaction-list-item-loader> `).map(e=>e)}
        </wui-flex>
      </wui-flex>`:null}onReceiveClick(){Pt.push("WalletReceive")}createPaginationObserver(){const{projectId:e}=ut.state;this.paginationObserver=new IntersectionObserver(([n])=>{n!=null&&n.isIntersecting&&!this.loading&&(Ec.fetchTransactions(Ft.getPlainAddress(this.caipAddress)),Sn.sendEvent({type:"track",event:"LOAD_MORE_TRANSACTIONS",properties:{address:Ft.getPlainAddress(this.caipAddress),projectId:e,cursor:this.next,isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}))},{}),this.setPaginationObserver()}setPaginationObserver(){var n,i,o;(n=this.paginationObserver)==null||n.disconnect();const e=(i=this.shadowRoot)==null?void 0:i.querySelector(`#${ZU}`);e&&((o=this.paginationObserver)==null||o.observe(e))}getTransactionListItemProps(e){var w,x,A;const n=GR.formatDate((w=e==null?void 0:e.metadata)==null?void 0:w.minedAt),i=R1.mergeTransfers((e==null?void 0:e.transfers)||[]),o=R1.getTransactionDescriptions(e,i),l=i==null?void 0:i[0],h=!!l&&(i==null?void 0:i.every(P=>!!P.nft_info)),s=R1.getTransactionImages(i);return{date:n,direction:l==null?void 0:l.direction,descriptions:o,isAllNFT:h,images:s,status:(x=e.metadata)==null?void 0:x.status,transfers:i,type:(A=e.metadata)==null?void 0:A.operationType}}};qf.styles=W4e;My([Fe()],qf.prototype,"page",void 0);My([Lt()],qf.prototype,"caipAddress",void 0);My([Lt()],qf.prototype,"transactionsByYear",void 0);My([Lt()],qf.prototype,"loading",void 0);My([Lt()],qf.prototype,"empty",void 0);My([Lt()],qf.prototype,"next",void 0);qf=My([nn("w3m-activity-list")],qf);const G4e=rs`
  :host {
    width: 100%;
    max-height: 280px;
    overflow: scroll;
    scrollbar-width: none;
  }

  :host::-webkit-scrollbar {
    display: none;
  }
`;var q4e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let PO=class extends on{render(){return we`<w3m-activity-list page="account"></w3m-activity-list>`}};PO.styles=G4e;PO=q4e([nn("w3m-account-activity-widget")],PO);const Z4e=Fn`
  :host {
    width: 100%;
  }

  button {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: ${({spacing:t})=>t[4]};
    padding: ${({spacing:t})=>t[4]};
    background-color: transparent;
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  wui-text {
    max-width: 174px;
  }

  .tag-container {
    width: fit-content;
  }

  @media (hover: hover) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    }
  }
`;var Uw=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let jm=class extends on{constructor(){super(...arguments),this.icon="card",this.text="",this.description="",this.tag=void 0,this.disabled=!1}render(){return we`
      <button ?disabled=${this.disabled}>
        <wui-flex alignItems="center" gap="3">
          <wui-icon-box padding="2" color="secondary" icon=${this.icon} size="lg"></wui-icon-box>
          <wui-flex flexDirection="column" gap="1">
            <wui-text variant="md-medium" color="primary">${this.text}</wui-text>
            ${this.description?we`<wui-text variant="md-regular" color="secondary">
                  ${this.description}</wui-text
                >`:null}
          </wui-flex>
        </wui-flex>

        <wui-flex class="tag-container" alignItems="center" gap="1" justifyContent="flex-end">
          ${this.tag?we`<wui-tag tagType="main" size="sm">${this.tag}</wui-tag>`:null}
          <wui-icon size="md" name="chevronRight" color="default"></wui-icon>
        </wui-flex>
      </button>
    `}};jm.styles=[Ei,Kr,Z4e];Uw([Fe()],jm.prototype,"icon",void 0);Uw([Fe()],jm.prototype,"text",void 0);Uw([Fe()],jm.prototype,"description",void 0);Uw([Fe()],jm.prototype,"tag",void 0);Uw([Fe({type:Boolean})],jm.prototype,"disabled",void 0);jm=Uw([nn("wui-list-description")],jm);const K4e=Fn`
  :host {
    width: 100%;
  }

  button {
    padding: ${({spacing:t})=>t[3]};
    display: flex;
    gap: ${({spacing:t})=>t[3]};
    justify-content: space-between;
    width: 100%;
    border-radius: ${({borderRadius:t})=>t[4]};
    background-color: transparent;
  }

  @media (hover: hover) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    }
  }

  button:focus-visible:enabled {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    box-shadow: 0 0 0 4px ${({tokens:t})=>t.core.foregroundAccent040};
  }

  button[data-clickable='false'] {
    pointer-events: none;
    background-color: transparent;
  }

  wui-image,
  wui-icon {
    width: ${({spacing:t})=>t[10]};
    height: ${({spacing:t})=>t[10]};
  }

  wui-image {
    border-radius: ${({borderRadius:t})=>t[16]};
  }

  .token-name-container {
    flex: 1;
  }
`;var Ly=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Zf=class extends on{constructor(){super(...arguments),this.tokenName="",this.tokenImageUrl="",this.tokenValue=0,this.tokenAmount="0.0",this.tokenCurrency="",this.clickable=!1}render(){return we`
      <button data-clickable=${String(this.clickable)}>
        <wui-flex gap="2" alignItems="center">
          ${this.visualTemplate()}
          <wui-flex
            flexDirection="column"
            justifyContent="space-between"
            gap="1"
            class="token-name-container"
          >
            <wui-text variant="md-regular" color="primary" lineClamp="1">
              ${this.tokenName}
            </wui-text>
            <wui-text variant="sm-regular-mono" color="secondary">
              ${Q1.formatNumberToLocalString(this.tokenAmount,4)} ${this.tokenCurrency}
            </wui-text>
          </wui-flex>
        </wui-flex>
        <wui-flex
          flexDirection="column"
          justifyContent="space-between"
          gap="1"
          alignItems="flex-end"
          width="auto"
        >
          <wui-text variant="md-regular-mono" color="primary"
            >$${this.tokenValue.toFixed(2)}</wui-text
          >
          <wui-text variant="sm-regular-mono" color="secondary">
            ${Q1.formatNumberToLocalString(this.tokenAmount,4)}
          </wui-text>
        </wui-flex>
      </button>
    `}visualTemplate(){return this.tokenName&&this.tokenImageUrl?we`<wui-image alt=${this.tokenName} src=${this.tokenImageUrl}></wui-image>`:we`<wui-icon name="coinPlaceholder" color="default"></wui-icon>`}};Zf.styles=[Ei,Kr,K4e];Ly([Fe()],Zf.prototype,"tokenName",void 0);Ly([Fe()],Zf.prototype,"tokenImageUrl",void 0);Ly([Fe({type:Number})],Zf.prototype,"tokenValue",void 0);Ly([Fe()],Zf.prototype,"tokenAmount",void 0);Ly([Fe()],Zf.prototype,"tokenCurrency",void 0);Ly([Fe({type:Boolean})],Zf.prototype,"clickable",void 0);Zf=Ly([nn("wui-list-token")],Zf);const Y4e=rs`
  :host {
    width: 100%;
  }

  wui-flex {
    width: 100%;
  }

  .contentContainer {
    max-height: 280px;
    overflow: scroll;
    scrollbar-width: none;
  }

  .contentContainer::-webkit-scrollbar {
    display: none;
  }
`;var XD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let K2=class extends on{constructor(){var e;super(),this.unsubscribe=[],this.tokenBalance=(e=ue.getAccountData())==null?void 0:e.tokenBalance,this.remoteFeatures=ut.state.remoteFeatures,this.unsubscribe.push(ue.subscribeChainProp("accountState",n=>{this.tokenBalance=n==null?void 0:n.tokenBalance}),ut.subscribeKey("remoteFeatures",n=>{this.remoteFeatures=n}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we`${this.tokenTemplate()}`}tokenTemplate(){var e;return this.tokenBalance&&((e=this.tokenBalance)==null?void 0:e.length)>0?we`<wui-flex class="contentContainer" flexDirection="column" gap="2">
        ${this.tokenItemTemplate()}
      </wui-flex>`:we` <wui-flex flexDirection="column">
      ${this.onRampTemplate()}
      <wui-list-description
        @click=${this.onReceiveClick.bind(this)}
        text="Receive funds"
        description="Scan the QR code and receive funds"
        icon="qrCode"
        iconColor="fg-200"
        iconBackgroundColor="fg-200"
        data-testid="w3m-account-receive-button"
      ></wui-list-description
    ></wui-flex>`}onRampTemplate(){var e;return(e=this.remoteFeatures)!=null&&e.onramp?we`<wui-list-description
        @click=${this.onBuyClick.bind(this)}
        text="Buy Crypto"
        description="Easy with card or bank account"
        icon="card"
        iconColor="success-100"
        iconBackgroundColor="success-100"
        tag="popular"
        data-testid="w3m-account-onramp-button"
      ></wui-list-description>`:we``}tokenItemTemplate(){var e;return(e=this.tokenBalance)==null?void 0:e.map(n=>we`<wui-list-token
          tokenName=${n.name}
          tokenImageUrl=${n.iconUrl}
          tokenAmount=${n.quantity.numeric}
          tokenValue=${n.value}
          tokenCurrency=${n.symbol}
        ></wui-list-token>`)}onReceiveClick(){Pt.push("WalletReceive")}onBuyClick(){Sn.sendEvent({type:"track",event:"SELECT_BUY_CRYPTO",properties:{isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}),Pt.push("OnRampProviders")}};K2.styles=Y4e;XD([Lt()],K2.prototype,"tokenBalance",void 0);XD([Lt()],K2.prototype,"remoteFeatures",void 0);K2=XD([nn("w3m-account-tokens-widget")],K2);const X4e=rs`
  :host {
    width: 100%;
    display: block;
  }
`;var JD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Y2=class extends on{constructor(){super(),this.unsubscribe=[],this.text="",this.open=vu.state.open,this.unsubscribe.push(Pt.subscribeKey("view",()=>{vu.hide()}),gi.subscribeKey("open",e=>{e||vu.hide()}),vu.subscribeKey("open",e=>{this.open=e}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e()),vu.hide()}render(){return we`
      <div
        @pointermove=${this.onMouseEnter.bind(this)}
        @pointerleave=${this.onMouseLeave.bind(this)}
      >
        ${this.renderChildren()}
      </div>
    `}renderChildren(){return we`<slot></slot> `}onMouseEnter(){const e=this.getBoundingClientRect();if(!this.open){const n=document.querySelector("w3m-modal"),i={width:e.width,height:e.height,left:e.left,top:e.top};if(n){const o=n.getBoundingClientRect();i.left=e.left-(window.innerWidth-o.width)/2,i.top=e.top-(window.innerHeight-o.height)/2}vu.showTooltip({message:this.text,triggerRect:i,variant:"shade"})}}onMouseLeave(e){this.contains(e.relatedTarget)||vu.hide()}};Y2.styles=[X4e];JD([Fe()],Y2.prototype,"text",void 0);JD([Lt()],Y2.prototype,"open",void 0);Y2=JD([nn("w3m-tooltip-trigger")],Y2);const J4e=Fn`
  :host {
    pointer-events: none;
  }

  :host > wui-flex {
    display: var(--w3m-tooltip-display);
    opacity: var(--w3m-tooltip-opacity);
    padding: 9px ${({spacing:t})=>t[3]} 10px ${({spacing:t})=>t[3]};
    border-radius: ${({borderRadius:t})=>t[3]};
    color: ${({tokens:t})=>t.theme.backgroundPrimary};
    position: absolute;
    top: var(--w3m-tooltip-top);
    left: var(--w3m-tooltip-left);
    transform: translate(calc(-50% + var(--w3m-tooltip-parent-width)), calc(-100% - 8px));
    max-width: calc(var(--apkt-modal-width) - ${({spacing:t})=>t[5]});
    transition: opacity ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: opacity;
    opacity: 0;
    animation-duration: ${({durations:t})=>t.xl};
    animation-timing-function: ${({easings:t})=>t["ease-out-power-2"]};
    animation-name: fade-in;
    animation-fill-mode: forwards;
  }

  :host([data-variant='shade']) > wui-flex {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  :host([data-variant='shade']) > wui-flex > wui-text {
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  :host([data-variant='fill']) > wui-flex {
    background-color: ${({tokens:t})=>t.theme.backgroundPrimary};
    border: 1px solid ${({tokens:t})=>t.theme.borderPrimary};
  }

  wui-icon {
    position: absolute;
    width: 12px !important;
    height: 4px !important;
    color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  wui-icon[data-placement='top'] {
    bottom: 0px;
    left: 50%;
    transform: translate(-50%, 95%);
  }

  wui-icon[data-placement='bottom'] {
    top: 0;
    left: 50%;
    transform: translate(-50%, -95%) rotate(180deg);
  }

  wui-icon[data-placement='right'] {
    top: 50%;
    left: 0;
    transform: translate(-65%, -50%) rotate(90deg);
  }

  wui-icon[data-placement='left'] {
    top: 50%;
    right: 0%;
    transform: translate(65%, -50%) rotate(270deg);
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`;var XE=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let gy=class extends on{constructor(){super(),this.unsubscribe=[],this.open=vu.state.open,this.message=vu.state.message,this.triggerRect=vu.state.triggerRect,this.variant=vu.state.variant,this.unsubscribe.push(vu.subscribe(e=>{this.open=e.open,this.message=e.message,this.triggerRect=e.triggerRect,this.variant=e.variant}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){this.dataset.variant=this.variant;const e=this.triggerRect.top,n=this.triggerRect.left;return this.style.cssText=`
    --w3m-tooltip-top: ${e}px;
    --w3m-tooltip-left: ${n}px;
    --w3m-tooltip-parent-width: ${this.triggerRect.width/2}px;
    --w3m-tooltip-display: ${this.open?"flex":"none"};
    --w3m-tooltip-opacity: ${this.open?1:0};
    `,we`<wui-flex>
      <wui-icon data-placement="top" size="inherit" name="cursor"></wui-icon>
      <wui-text color="primary" variant="sm-regular">${this.message}</wui-text>
    </wui-flex>`}};gy.styles=[J4e];XE([Lt()],gy.prototype,"open",void 0);XE([Lt()],gy.prototype,"message",void 0);XE([Lt()],gy.prototype,"triggerRect",void 0);XE([Lt()],gy.prototype,"variant",void 0);gy=XE([nn("w3m-tooltip")],gy);const Q4e=Fn`
  wui-flex {
    width: 100%;
  }

  wui-promo {
    position: absolute;
    top: -32px;
  }

  wui-profile-button {
    margin-top: calc(-1 * ${({spacing:t})=>t[4]});
  }

  wui-promo + wui-profile-button {
    margin-top: ${({spacing:t})=>t[4]};
  }

  wui-tabs {
    width: 100%;
  }

  .contentContainer {
    height: 280px;
  }

  .contentContainer > wui-icon-box {
    width: 40px;
    height: 40px;
    border-radius: ${({borderRadius:t})=>t[3]};
  }

  .contentContainer > .textContent {
    width: 65%;
  }
`;var Ad=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Wl=class extends on{constructor(){var e,n,i,o;super(...arguments),this.unsubscribe=[],this.network=ue.state.activeCaipNetwork,this.profileName=(e=ue.getAccountData())==null?void 0:e.profileName,this.address=(n=ue.getAccountData())==null?void 0:n.address,this.currentTab=(i=ue.getAccountData())==null?void 0:i.currentTab,this.tokenBalance=(o=ue.getAccountData())==null?void 0:o.tokenBalance,this.features=ut.state.features,this.namespace=ue.state.activeChain,this.activeConnectorIds=Nt.state.activeConnectorIds,this.remoteFeatures=ut.state.remoteFeatures}firstUpdated(){ue.fetchTokenBalance(),this.unsubscribe.push(ue.subscribeChainProp("accountState",e=>{e!=null&&e.address?(this.address=e.address,this.profileName=e.profileName,this.currentTab=e.currentTab,this.tokenBalance=e.tokenBalance):gi.close()}),Nt.subscribeKey("activeConnectorIds",e=>{this.activeConnectorIds=e}),ue.subscribeKey("activeChain",e=>this.namespace=e),ue.subscribeKey("activeCaipNetwork",e=>this.network=e),ut.subscribeKey("features",e=>this.features=e),ut.subscribeKey("remoteFeatures",e=>this.remoteFeatures=e)),this.watchSwapValues()}disconnectedCallback(){this.unsubscribe.forEach(e=>e()),clearInterval(this.watchTokenBalance)}render(){if(!this.address)throw new Error("w3m-account-features-widget: No account provided");if(!this.namespace)return null;const e=this.activeConnectorIds[this.namespace],n=e?Nt.getConnectorById(e):void 0,{icon:i,iconSize:o}=this.getAuthData();return we`<wui-flex
      flexDirection="column"
      .padding=${["0","3","4","3"]}
      alignItems="center"
      gap="4"
      data-testid="w3m-account-wallet-features-widget"
    >
      <wui-flex flexDirection="column" justifyContent="center" alignItems="center" gap="2">
        <wui-wallet-switch
          profileName=${this.profileName}
          address=${this.address}
          icon=${i}
          iconSize=${o}
          alt=${n==null?void 0:n.name}
          @click=${this.onGoToProfileWalletsView.bind(this)}
          data-testid="wui-wallet-switch"
        ></wui-wallet-switch>

        ${this.tokenBalanceTemplate()}
      </wui-flex>
      ${this.orderedWalletFeatures()} ${this.tabsTemplate()} ${this.listContentTemplate()}
    </wui-flex>`}orderedWalletFeatures(){var l;const e=((l=this.features)==null?void 0:l.walletFeaturesOrder)||hi.DEFAULT_FEATURES.walletFeaturesOrder;if(e.every(h=>{var s,w;return h==="send"||h==="receive"?!((s=this.features)!=null&&s[h]):h==="swaps"||h==="onramp"?!((w=this.remoteFeatures)!=null&&w[h]):!0}))return null;const i=e.map(h=>h==="receive"||h==="onramp"?"fund":h),o=[...new Set(i)];return we`<wui-flex gap="2">
      ${o.map(h=>{switch(h){case"fund":return this.fundWalletTemplate();case"swaps":return this.swapsTemplate();case"send":return this.sendTemplate();default:return null}})}
    </wui-flex>`}fundWalletTemplate(){var l,h;if(!this.namespace)return null;const e=hi.ONRAMP_SUPPORTED_CHAIN_NAMESPACES.includes(this.namespace),n=(l=this.features)==null?void 0:l.receive,i=((h=this.remoteFeatures)==null?void 0:h.onramp)&&e,o=ko.isPayWithExchangeEnabled();return!i&&!n&&!o?null:we`
      <w3m-tooltip-trigger text="Fund wallet">
        <wui-button
          data-testid="wallet-features-fund-wallet-button"
          @click=${this.onFundWalletClick.bind(this)}
          variant="accent-secondary"
          size="lg"
          fullWidth
        >
          <wui-icon name="dollar"></wui-icon>
        </wui-button>
      </w3m-tooltip-trigger>
    `}swapsTemplate(){var i;const e=(i=this.remoteFeatures)==null?void 0:i.swaps,n=ue.state.activeChain===at.CHAIN.EVM;return!e||!n?null:we`
      <w3m-tooltip-trigger text="Swap">
        <wui-button
          fullWidth
          data-testid="wallet-features-swaps-button"
          @click=${this.onSwapClick.bind(this)}
          variant="accent-secondary"
          size="lg"
        >
          <wui-icon name="recycleHorizontal"></wui-icon>
        </wui-button>
      </w3m-tooltip-trigger>
    `}sendTemplate(){var o;const e=(o=this.features)==null?void 0:o.send,n=ue.state.activeChain,i=hi.SEND_SUPPORTED_NAMESPACES.includes(n);return!e||!i?null:we`
      <w3m-tooltip-trigger text="Send">
        <wui-button
          fullWidth
          data-testid="wallet-features-send-button"
          @click=${this.onSendClick.bind(this)}
          variant="accent-secondary"
          size="lg"
        >
          <wui-icon name="send"></wui-icon>
        </wui-button>
      </w3m-tooltip-trigger>
    `}watchSwapValues(){this.watchTokenBalance=setInterval(()=>ue.fetchTokenBalance(e=>this.onTokenBalanceError(e)),1e4)}onTokenBalanceError(e){e instanceof Error&&e.cause instanceof Response&&e.cause.status===at.HTTP_STATUS_CODES.SERVICE_UNAVAILABLE&&clearInterval(this.watchTokenBalance)}listContentTemplate(){return this.currentTab===0?we`<w3m-account-tokens-widget></w3m-account-tokens-widget>`:this.currentTab===1?we`<w3m-account-activity-widget></w3m-account-activity-widget>`:we`<w3m-account-tokens-widget></w3m-account-tokens-widget>`}tokenBalanceTemplate(){var e;if(this.tokenBalance&&((e=this.tokenBalance)==null?void 0:e.length)>=0){const n=Ft.calculateBalance(this.tokenBalance),{dollars:i="0",pennies:o="00"}=Ft.formatTokenBalance(n);return we`<wui-balance dollars=${i} pennies=${o}></wui-balance>`}return we`<wui-balance dollars="0" pennies="00"></wui-balance>`}tabsTemplate(){const e=Z1.getTabsByNamespace(ue.state.activeChain);return e.length===0?null:we`<wui-tabs
      .onTabChange=${this.onTabChange.bind(this)}
      .activeTab=${this.currentTab}
      .tabs=${e}
    ></wui-tabs>`}onTabChange(e){ue.setAccountProp("currentTab",e,this.namespace)}onFundWalletClick(){Pt.push("FundWallet")}onSwapClick(){var e,n,i;(e=this.network)!=null&&e.caipNetworkId&&!hi.SWAP_SUPPORTED_NETWORKS.includes((n=this.network)==null?void 0:n.caipNetworkId)?Pt.push("UnsupportedChain",{swapUnsupportedChain:!0}):(Sn.sendEvent({type:"track",event:"OPEN_SWAP",properties:{network:((i=this.network)==null?void 0:i.caipNetworkId)||"",isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}),Pt.push("Swap"))}getAuthData(){const e=Jt.getConnectedSocialProvider(),n=Jt.getConnectedSocialUsername(),i=Nt.getAuthConnector(),o=(i==null?void 0:i.provider.getEmail())??"";return{name:ia.getAuthName({email:o,socialUsername:n,socialProvider:e}),icon:e??"mail",iconSize:e?"xl":"md"}}onGoToProfileWalletsView(){Pt.push("ProfileWallets")}onSendClick(){var e;Sn.sendEvent({type:"track",event:"OPEN_SEND",properties:{network:((e=this.network)==null?void 0:e.caipNetworkId)||"",isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}}),Pt.push("WalletSend")}};Wl.styles=Q4e;Ad([Lt()],Wl.prototype,"watchTokenBalance",void 0);Ad([Lt()],Wl.prototype,"network",void 0);Ad([Lt()],Wl.prototype,"profileName",void 0);Ad([Lt()],Wl.prototype,"address",void 0);Ad([Lt()],Wl.prototype,"currentTab",void 0);Ad([Lt()],Wl.prototype,"tokenBalance",void 0);Ad([Lt()],Wl.prototype,"features",void 0);Ad([Lt()],Wl.prototype,"namespace",void 0);Ad([Lt()],Wl.prototype,"activeConnectorIds",void 0);Ad([Lt()],Wl.prototype,"remoteFeatures",void 0);Wl=Ad([nn("w3m-account-wallet-features-widget")],Wl);var cY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let QA=class extends on{constructor(){super(),this.unsubscribe=[],this.namespace=ue.state.activeChain,this.unsubscribe.push(ue.subscribeKey("activeChain",e=>{this.namespace=e}))}render(){if(!this.namespace)return null;const e=Nt.getConnectorId(this.namespace),n=Nt.getAuthConnector();return we`
      ${n&&e===at.CONNECTOR_ID.AUTH?this.walletFeaturesTemplate():this.defaultTemplate()}
    `}walletFeaturesTemplate(){return we`<w3m-account-wallet-features-widget></w3m-account-wallet-features-widget>`}defaultTemplate(){return we`<w3m-account-default-widget></w3m-account-default-widget>`}};cY([Lt()],QA.prototype,"namespace",void 0);QA=cY([nn("w3m-account-view")],QA);const ePe=Fn`
  :host {
    position: relative;
    background-color: ${({tokens:t})=>t.theme.foregroundTertiary};
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: inherit;
    border-radius: var(--local-border-radius);
  }

  :host([data-image='true']) {
    background-color: transparent;
  }

  :host > wui-flex {
    overflow: hidden;
    border-radius: inherit;
    border-radius: var(--local-border-radius);
  }

  :host([data-size='sm']) {
    width: 32px;
    height: 32px;
  }

  :host([data-size='md']) {
    width: 40px;
    height: 40px;
  }

  :host([data-size='lg']) {
    width: 56px;
    height: 56px;
  }

  :host([name='Extension'])::after {
    border: 1px solid ${({colors:t})=>t.accent010};
  }

  :host([data-wallet-icon='allWallets'])::after {
    border: 1px solid ${({colors:t})=>t.accent010};
  }

  wui-icon[data-parent-size='inherit'] {
    width: 75%;
    height: 75%;
    align-items: center;
  }

  wui-icon {
    color: ${({tokens:t})=>t.theme.iconDefault};
  }

  wui-icon[data-parent-size='sm'] {
    width: 24px;
    height: 24px;
  }

  wui-icon[data-parent-size='md'] {
    width: 32px;
    height: 32px;
  }

  :host > wui-icon-box {
    position: absolute;
    overflow: hidden;
    right: -1px;
    bottom: -2px;
    z-index: 1;
    border: 2px solid ${({tokens:t})=>t.theme.backgroundPrimary};
    padding: 1px;
  }
`;var By=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Kf=class extends on{constructor(){super(...arguments),this.size="md",this.name="",this.installed=!1,this.badgeSize="xs"}render(){let e="1";return this.size==="lg"?e="4":this.size==="md"?e="2":this.size==="sm"&&(e="1"),this.style.cssText=`
       --local-border-radius: var(--apkt-borderRadius-${e});
   `,this.dataset.size=this.size,this.imageSrc&&(this.dataset.image="true"),this.walletIcon&&(this.dataset.walletIcon=this.walletIcon),we`
      <wui-flex justifyContent="center" alignItems="center"> ${this.templateVisual()} </wui-flex>
    `}templateVisual(){return this.imageSrc?we`<wui-image src=${this.imageSrc} alt=${this.name}></wui-image>`:this.walletIcon?we`<wui-icon size="md" color="default" name=${this.walletIcon}></wui-icon>`:we`<wui-icon
      data-parent-size=${this.size}
      size="inherit"
      color="inherit"
      name="wallet"
    ></wui-icon>`}};Kf.styles=[Ei,ePe];By([Fe()],Kf.prototype,"size",void 0);By([Fe()],Kf.prototype,"name",void 0);By([Fe()],Kf.prototype,"imageSrc",void 0);By([Fe()],Kf.prototype,"walletIcon",void 0);By([Fe({type:Boolean})],Kf.prototype,"installed",void 0);By([Fe()],Kf.prototype,"badgeSize",void 0);Kf=By([nn("wui-wallet-image")],Kf);const tPe=Fn`
  wui-image {
    width: 24px;
    height: 24px;
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  wui-image,
  .icon-box {
    width: 32px;
    height: 32px;
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  wui-icon:not(.custom-icon, .icon-badge) {
    cursor: pointer;
  }

  .icon-box {
    position: relative;
    border-radius: ${({borderRadius:t})=>t[2]};
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  .icon-badge {
    position: absolute;
    top: 18px;
    left: 23px;
    z-index: 3;
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border: 2px solid ${({tokens:t})=>t.theme.backgroundPrimary};
    border-radius: 50%;
    padding: ${({spacing:t})=>t["01"]};
  }

  .icon-badge {
    width: 8px;
    height: 8px;
  }
`;var gl=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let nc=class extends on{constructor(){super(...arguments),this.address="",this.profileName="",this.content=[],this.alt="",this.imageSrc="",this.icon=void 0,this.iconSize="md",this.iconBadge=void 0,this.iconBadgeSize="md",this.buttonVariant="neutral-primary",this.enableMoreButton=!1,this.charsStart=4,this.charsEnd=6}render(){return we`
      <wui-flex flexDirection="column" rowgap="2">
        ${this.topTemplate()} ${this.bottomTemplate()}
      </wui-flex>
    `}topTemplate(){return we`
      <wui-flex alignItems="flex-start" justifyContent="space-between">
        ${this.imageOrIconTemplate()}
        <wui-icon-link
          variant="secondary"
          size="md"
          icon="copy"
          @click=${this.dispatchCopyEvent}
        ></wui-icon-link>
        <wui-icon-link
          variant="secondary"
          size="md"
          icon="externalLink"
          @click=${this.dispatchExternalLinkEvent}
        ></wui-icon-link>
        ${this.enableMoreButton?we`<wui-icon-link
              variant="secondary"
              size="md"
              icon="threeDots"
              @click=${this.dispatchMoreButtonEvent}
              data-testid="wui-active-profile-wallet-item-more-button"
            ></wui-icon-link>`:null}
      </wui-flex>
    `}bottomTemplate(){return we` <wui-flex flexDirection="column">${this.contentTemplate()}</wui-flex> `}imageOrIconTemplate(){return this.icon?we`
        <wui-flex flexGrow="1" alignItems="center">
          <wui-flex alignItems="center" justifyContent="center" class="icon-box">
            <wui-icon size="lg" color="default" name=${this.icon} class="custom-icon"></wui-icon>

            ${this.iconBadge?we`<wui-icon
                  color="accent-primary"
                  size="inherit"
                  name=${this.iconBadge}
                  class="icon-badge"
                ></wui-icon>`:null}
          </wui-flex>
        </wui-flex>
      `:we`
      <wui-flex flexGrow="1" alignItems="center">
        <wui-image objectFit="contain" src=${this.imageSrc} alt=${this.alt}></wui-image>
      </wui-flex>
    `}contentTemplate(){return this.content.length===0?null:we`
      <wui-flex flexDirection="column" rowgap="3">
        ${this.content.map(e=>this.labelAndTagTemplate(e))}
      </wui-flex>
    `}labelAndTagTemplate({address:e,profileName:n,label:i,description:o,enableButton:l,buttonType:h,buttonLabel:s,buttonVariant:w,tagVariant:x,tagLabel:A,alignItems:P="flex-end"}){return we`
      <wui-flex justifyContent="space-between" alignItems=${P} columngap="1">
        <wui-flex flexDirection="column" rowgap="01">
          ${i?we`<wui-text variant="sm-medium" color="secondary">${i}</wui-text>`:null}

          <wui-flex alignItems="center" columngap="1">
            <wui-text variant="md-regular" color="primary">
              ${us.getTruncateString({string:n||e,charsStart:n?16:this.charsStart,charsEnd:n?0:this.charsEnd,truncate:n?"end":"middle"})}
            </wui-text>

            ${x&&A?we`<wui-tag variant=${x} size="sm">${A}</wui-tag>`:null}
          </wui-flex>

          ${o?we`<wui-text variant="sm-regular" color="secondary">${o}</wui-text>`:null}
        </wui-flex>

        ${l?this.buttonTemplate({buttonType:h,buttonLabel:s,buttonVariant:w}):null}
      </wui-flex>
    `}buttonTemplate({buttonType:e,buttonLabel:n,buttonVariant:i}){return we`
      <wui-button
        size="sm"
        variant=${i}
        @click=${e==="disconnect"?this.dispatchDisconnectEvent.bind(this):this.dispatchSwitchEvent.bind(this)}
        data-testid=${e==="disconnect"?"wui-active-profile-wallet-item-disconnect-button":"wui-active-profile-wallet-item-switch-button"}
      >
        ${n}
      </wui-button>
    `}dispatchDisconnectEvent(){this.dispatchEvent(new CustomEvent("disconnect",{bubbles:!0,composed:!0}))}dispatchSwitchEvent(){this.dispatchEvent(new CustomEvent("switch",{bubbles:!0,composed:!0}))}dispatchExternalLinkEvent(){this.dispatchEvent(new CustomEvent("externalLink",{bubbles:!0,composed:!0}))}dispatchMoreButtonEvent(){this.dispatchEvent(new CustomEvent("more",{bubbles:!0,composed:!0}))}dispatchCopyEvent(){this.dispatchEvent(new CustomEvent("copy",{bubbles:!0,composed:!0}))}};nc.styles=[Ei,Kr,tPe];gl([Fe()],nc.prototype,"address",void 0);gl([Fe()],nc.prototype,"profileName",void 0);gl([Fe({type:Array})],nc.prototype,"content",void 0);gl([Fe()],nc.prototype,"alt",void 0);gl([Fe()],nc.prototype,"imageSrc",void 0);gl([Fe()],nc.prototype,"icon",void 0);gl([Fe()],nc.prototype,"iconSize",void 0);gl([Fe()],nc.prototype,"iconBadge",void 0);gl([Fe()],nc.prototype,"iconBadgeSize",void 0);gl([Fe()],nc.prototype,"buttonVariant",void 0);gl([Fe({type:Boolean})],nc.prototype,"enableMoreButton",void 0);gl([Fe({type:Number})],nc.prototype,"charsStart",void 0);gl([Fe({type:Number})],nc.prototype,"charsEnd",void 0);nc=gl([nn("wui-active-profile-wallet-item")],nc);const nPe=Fn`
  wui-image,
  .icon-box {
    width: 32px;
    height: 32px;
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  .right-icon {
    cursor: pointer;
  }

  .icon-box {
    position: relative;
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  .icon-badge {
    position: absolute;
    top: 18px;
    left: 23px;
    z-index: 3;
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border: 2px solid ${({tokens:t})=>t.theme.backgroundPrimary};
    border-radius: 50%;
    padding: ${({spacing:t})=>t["01"]};
  }

  .icon-badge {
    width: 8px;
    height: 8px;
  }
`;var sc=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let aa=class extends on{constructor(){super(...arguments),this.address="",this.profileName="",this.alt="",this.buttonLabel="",this.buttonVariant="accent-primary",this.imageSrc="",this.icon=void 0,this.iconSize="md",this.iconBadgeSize="md",this.rightIcon="signOut",this.rightIconSize="md",this.loading=!1,this.charsStart=4,this.charsEnd=6}render(){return we`
      <wui-flex alignItems="center" columngap="2">
        ${this.imageOrIconTemplate()} ${this.labelAndDescriptionTemplate()}
        ${this.buttonActionTemplate()}
      </wui-flex>
    `}imageOrIconTemplate(){return this.icon?we`
        <wui-flex alignItems="center" justifyContent="center" class="icon-box">
          <wui-flex alignItems="center" justifyContent="center" class="icon-box">
            <wui-icon size="lg" color="default" name=${this.icon} class="custom-icon"></wui-icon>

            ${this.iconBadge?we`<wui-icon
                  color="default"
                  size="inherit"
                  name=${this.iconBadge}
                  class="icon-badge"
                ></wui-icon>`:null}
          </wui-flex>
        </wui-flex>
      `:we`<wui-image objectFit="contain" src=${this.imageSrc} alt=${this.alt}></wui-image>`}labelAndDescriptionTemplate(){return we`
      <wui-flex
        flexDirection="column"
        flexGrow="1"
        justifyContent="flex-start"
        alignItems="flex-start"
      >
        <wui-text variant="lg-regular" color="primary">
          ${us.getTruncateString({string:this.profileName||this.address,charsStart:this.profileName?16:this.charsStart,charsEnd:this.profileName?0:this.charsEnd,truncate:this.profileName?"end":"middle"})}
        </wui-text>
      </wui-flex>
    `}buttonActionTemplate(){return we`
      <wui-flex columngap="1" alignItems="center" justifyContent="center">
        <wui-button
          size="sm"
          variant=${this.buttonVariant}
          .loading=${this.loading}
          @click=${this.handleButtonClick}
          data-testid="wui-inactive-profile-wallet-item-button"
        >
          ${this.buttonLabel}
        </wui-button>

        <wui-icon-link
          variant="secondary"
          size="md"
          icon=${Tn(this.rightIcon)}
          class="right-icon"
          @click=${this.handleIconClick}
        ></wui-icon-link>
      </wui-flex>
    `}handleButtonClick(){this.dispatchEvent(new CustomEvent("buttonClick",{bubbles:!0,composed:!0}))}handleIconClick(){this.dispatchEvent(new CustomEvent("iconClick",{bubbles:!0,composed:!0}))}};aa.styles=[Ei,Kr,nPe];sc([Fe()],aa.prototype,"address",void 0);sc([Fe()],aa.prototype,"profileName",void 0);sc([Fe()],aa.prototype,"alt",void 0);sc([Fe()],aa.prototype,"buttonLabel",void 0);sc([Fe()],aa.prototype,"buttonVariant",void 0);sc([Fe()],aa.prototype,"imageSrc",void 0);sc([Fe()],aa.prototype,"icon",void 0);sc([Fe()],aa.prototype,"iconSize",void 0);sc([Fe()],aa.prototype,"iconBadge",void 0);sc([Fe()],aa.prototype,"iconBadgeSize",void 0);sc([Fe()],aa.prototype,"rightIcon",void 0);sc([Fe()],aa.prototype,"rightIconSize",void 0);sc([Fe({type:Boolean})],aa.prototype,"loading",void 0);sc([Fe({type:Number})],aa.prototype,"charsStart",void 0);sc([Fe({type:Number})],aa.prototype,"charsEnd",void 0);aa=sc([nn("wui-inactive-profile-wallet-item")],aa);const iPe=Fn`
  :host {
    position: relative;
    display: flex;
    width: 100%;
    height: 1px;
    background-color: ${({tokens:t})=>t.theme.borderPrimary};
    justify-content: center;
    align-items: center;
  }

  :host > wui-text {
    position: absolute;
    padding: 0px 8px;
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color;
  }

  :host([data-bg-color='primary']) > wui-text {
    background-color: ${({tokens:t})=>t.theme.backgroundPrimary};
  }

  :host([data-bg-color='secondary']) > wui-text {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }
`;var QD=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let X2=class extends on{constructor(){super(...arguments),this.text="",this.bgColor="primary"}render(){return this.dataset.bgColor=this.bgColor,we`${this.template()}`}template(){return this.text?we`<wui-text variant="md-regular" color="secondary">${this.text}</wui-text>`:null}};X2.styles=[Ei,iPe];QD([Fe()],X2.prototype,"text",void 0);QD([Fe()],X2.prototype,"bgColor",void 0);X2=QD([nn("wui-separator")],X2);const dR={getAuthData(t){var h,s;const e=t.connectorId===at.CONNECTOR_ID.AUTH;if(!e)return{isAuth:!1,icon:void 0,iconSize:void 0,name:void 0};const n=((h=t==null?void 0:t.auth)==null?void 0:h.name)??Jt.getConnectedSocialProvider(),i=((s=t==null?void 0:t.auth)==null?void 0:s.username)??Jt.getConnectedSocialUsername(),o=Nt.getAuthConnector(),l=(o==null?void 0:o.provider.getEmail())??"";return{isAuth:!0,icon:n??"mail",iconSize:n?"xl":"md",name:e?ia.getAuthName({email:l,socialUsername:i,socialProvider:n}):void 0}}},rPe=Fn`
  :host {
    --connect-scroll--top-opacity: 0;
    --connect-scroll--bottom-opacity: 0;
  }

  .balance-amount {
    flex: 1;
  }

  .wallet-list {
    scrollbar-width: none;
    overflow-y: scroll;
    overflow-x: hidden;
    transition: opacity ${({easings:t})=>t["ease-out-power-1"]}
      ${({durations:t})=>t.md};
    will-change: opacity;
    mask-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, calc(1 - var(--connect-scroll--top-opacity))) 0px,
      rgba(200, 200, 200, calc(1 - var(--connect-scroll--top-opacity))) 1px,
      black 40px,
      black calc(100% - 40px),
      rgba(155, 155, 155, calc(1 - var(--connect-scroll--bottom-opacity))) calc(100% - 1px),
      rgba(0, 0, 0, calc(1 - var(--connect-scroll--bottom-opacity))) 100%
    );
  }

  .active-wallets {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  .active-wallets-box {
    height: 330px;
  }

  .empty-wallet-list-box {
    height: 400px;
  }

  .empty-box {
    width: 100%;
    padding: ${({spacing:t})=>t[4]};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  wui-separator {
    margin: ${({spacing:t})=>t[2]} 0 ${({spacing:t})=>t[2]} 0;
  }

  .active-connection {
    padding: ${({spacing:t})=>t[2]};
  }

  .recent-connection {
    padding: ${({spacing:t})=>t[2]} 0 ${({spacing:t})=>t[2]} 0;
  }

  @media (max-width: 430px) {
    .active-wallets-box,
    .empty-wallet-list-box {
      height: auto;
      max-height: clamp(360px, 470px, 80vh);
    }
  }
`;var Gl=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const gu={ADDRESS_DISPLAY:{START:4,END:6},BADGE:{SIZE:"md",ICON:"lightbulb"},SCROLL_THRESHOLD:50,OPACITY_RANGE:[0,1]},O1={eip155:"ethereum",solana:"solana",bip122:"bitcoin",ton:"ton"},sPe=[{namespace:"eip155",icon:O1.eip155,label:"EVM"},{namespace:"solana",icon:O1.solana,label:"Solana"},{namespace:"bip122",icon:O1.bip122,label:"Bitcoin"},{namespace:"ton",icon:O1.ton,label:"Ton"}],oPe={eip155:{title:"Add EVM Wallet",description:"Add your first EVM wallet"},solana:{title:"Add Solana Wallet",description:"Add your first Solana wallet"},bip122:{title:"Add Bitcoin Wallet",description:"Add your first Bitcoin wallet"},ton:{title:"Add TON Wallet",description:"Add your first TON wallet"}};let ic=class extends on{constructor(){var e,n,i;super(),this.unsubscribers=[],this.currentTab=0,this.namespace=ue.state.activeChain,this.namespaces=Array.from(ue.state.chains.keys()),this.caipAddress=void 0,this.profileName=void 0,this.activeConnectorIds=Nt.state.activeConnectorIds,this.lastSelectedAddress="",this.lastSelectedConnectorId="",this.isSwitching=!1,this.caipNetwork=ue.state.activeCaipNetwork,this.user=(e=ue.getAccountData())==null?void 0:e.user,this.remoteFeatures=ut.state.remoteFeatures,this.currentTab=this.namespace?this.namespaces.indexOf(this.namespace):0,this.caipAddress=(n=ue.getAccountData(this.namespace))==null?void 0:n.caipAddress,this.profileName=(i=ue.getAccountData(this.namespace))==null?void 0:i.profileName,this.unsubscribers.push(Ht.subscribeKey("connections",()=>this.onConnectionsChange()),Ht.subscribeKey("recentConnections",()=>this.requestUpdate()),Nt.subscribeKey("activeConnectorIds",o=>{this.activeConnectorIds=o}),ue.subscribeKey("activeCaipNetwork",o=>this.caipNetwork=o),ue.subscribeChainProp("accountState",o=>{this.user=o==null?void 0:o.user}),ut.subscribeKey("remoteFeatures",o=>this.remoteFeatures=o)),this.chainListener=ue.subscribeChainProp("accountState",o=>{this.caipAddress=o==null?void 0:o.caipAddress,this.profileName=o==null?void 0:o.profileName},this.namespace)}disconnectedCallback(){var e,n;this.unsubscribers.forEach(i=>i()),(e=this.resizeObserver)==null||e.disconnect(),this.removeScrollListener(),(n=this.chainListener)==null||n.call(this)}firstUpdated(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector(".wallet-list");if(!e)return;const n=()=>this.updateScrollOpacity(e);requestAnimationFrame(n),e.addEventListener("scroll",n),this.resizeObserver=new ResizeObserver(n),this.resizeObserver.observe(e),n()}render(){const e=this.namespace;if(!e)throw new Error("Namespace is not set");return we`
      <wui-flex flexDirection="column" .padding=${["0","4","4","4"]} gap="4">
        ${this.renderTabs()} ${this.renderHeader(e)} ${this.renderConnections(e)}
        ${this.renderAddConnectionButton(e)}
      </wui-flex>
    `}renderTabs(){const e=this.namespaces.map(i=>sPe.find(o=>o.namespace===i)).filter(Boolean);return e.length>1?we`
        <wui-tabs
          .onTabChange=${i=>this.handleTabChange(i)}
          .activeTab=${this.currentTab}
          .tabs=${e}
        ></wui-tabs>
      `:null}renderHeader(e){const i=this.getActiveConnections(e).flatMap(({accounts:o})=>o).length+(this.caipAddress?1:0);return we`
      <wui-flex alignItems="center" columngap="1">
        <wui-icon
          size="sm"
          name=${O1[e]??O1.eip155}
        ></wui-icon>
        <wui-text color="secondary" variant="lg-regular"
          >${i>1?"Wallets":"Wallet"}</wui-text
        >
        <wui-text
          color="primary"
          variant="lg-regular"
          class="balance-amount"
          data-testid="balance-amount"
        >
          ${i}
        </wui-text>
        <wui-link
          color="secondary"
          variant="secondary"
          @click=${()=>Ht.disconnect({namespace:e})}
          ?disabled=${!this.hasAnyConnections(e)}
          data-testid="disconnect-all-button"
        >
          Disconnect All
        </wui-link>
      </wui-flex>
    `}renderConnections(e){const n=this.hasAnyConnections(e);return we`
      <wui-flex flexDirection="column" class=${qD({"wallet-list":!0,"active-wallets-box":n,"empty-wallet-list-box":!n})} rowgap="3">
        ${n?this.renderActiveConnections(e):this.renderEmptyState(e)}
      </wui-flex>
    `}renderActiveConnections(e){const n=this.getActiveConnections(e),i=this.activeConnectorIds[e],o=this.getPlainAddress();return we`
      ${o||i||n.length>0?we`<wui-flex
            flexDirection="column"
            .padding=${["4","0","4","0"]}
            class="active-wallets"
          >
            ${this.renderActiveProfile(e)} ${this.renderActiveConnectionsList(e)}
          </wui-flex>`:null}
      ${this.renderRecentConnections(e)}
    `}renderActiveProfile(e){const n=this.activeConnectorIds[e];if(!n)return null;const{connections:i}=Bl.getConnectionsData(e),o=Nt.getConnectorById(n),l=Ur.getConnectorImage(o),h=this.getPlainAddress();if(!h)return null;const s=e===at.CHAIN.BITCOIN,w=dR.getAuthData({connectorId:n,accounts:[]}),x=this.getActiveConnections(e).flatMap(D=>D.accounts).length>0,A=i.find(D=>D.connectorId===n),P=A==null?void 0:A.accounts.filter(D=>!no.isLowerCaseMatch(D.address,h));return we`
      <wui-flex flexDirection="column" .padding=${["0","4","0","4"]}>
        <wui-active-profile-wallet-item
          address=${h}
          alt=${o==null?void 0:o.name}
          .content=${this.getProfileContent({address:h,connections:i,connectorId:n,namespace:e})}
          .charsStart=${gu.ADDRESS_DISPLAY.START}
          .charsEnd=${gu.ADDRESS_DISPLAY.END}
          .icon=${w.icon}
          .iconSize=${w.iconSize}
          .iconBadge=${this.isSmartAccount(h)?gu.BADGE.ICON:void 0}
          .iconBadgeSize=${this.isSmartAccount(h)?gu.BADGE.SIZE:void 0}
          imageSrc=${l}
          ?enableMoreButton=${w.isAuth}
          @copy=${()=>this.handleCopyAddress(h)}
          @disconnect=${()=>this.handleDisconnect(e,n)}
          @switch=${()=>{s&&A&&(P!=null&&P[0])&&this.handleSwitchWallet(A,P[0].address,e)}}
          @externalLink=${()=>this.handleExternalLink(h)}
          @more=${()=>this.handleMore()}
          data-testid="wui-active-profile-wallet-item"
        ></wui-active-profile-wallet-item>
        ${x?we`<wui-separator></wui-separator>`:null}
      </wui-flex>
    `}renderActiveConnectionsList(e){const n=this.getActiveConnections(e);return n.length===0?null:we`
      <wui-flex flexDirection="column" .padding=${["0","2","0","2"]}>
        ${this.renderConnectionList(n,!1,e)}
      </wui-flex>
    `}renderRecentConnections(e){const{recentConnections:n}=Bl.getConnectionsData(e);return n.flatMap(o=>o.accounts).length===0?null:we`
      <wui-flex flexDirection="column" .padding=${["0","2","0","2"]} rowGap="2">
        <wui-text color="secondary" variant="sm-medium" data-testid="recently-connected-text"
          >RECENTLY CONNECTED</wui-text
        >
        <wui-flex flexDirection="column" .padding=${["0","2","0","2"]}>
          ${this.renderConnectionList(n,!0,e)}
        </wui-flex>
      </wui-flex>
    `}renderConnectionList(e,n,i){return e.filter(o=>o.accounts.length>0).map((o,l)=>{const h=Nt.getConnectorById(o.connectorId),s=Ur.getConnectorImage(h)??"",w=dR.getAuthData(o);return o.accounts.map((x,A)=>{const P=l!==0||A!==0,D=this.isAccountLoading(o.connectorId,x.address);return we`
            <wui-flex flexDirection="column">
              ${P?we`<wui-separator></wui-separator>`:null}
              <wui-inactive-profile-wallet-item
                address=${x.address}
                alt=${o.connectorId}
                buttonLabel=${n?"Connect":"Switch"}
                buttonVariant=${n?"neutral-secondary":"accent-secondary"}
                rightIcon=${n?"bin":"power"}
                rightIconSize="sm"
                class=${n?"recent-connection":"active-connection"}
                data-testid=${n?"recent-connection":"active-connection"}
                imageSrc=${s}
                .iconBadge=${this.isSmartAccount(x.address)?gu.BADGE.ICON:void 0}
                .iconBadgeSize=${this.isSmartAccount(x.address)?gu.BADGE.SIZE:void 0}
                .icon=${w.icon}
                .iconSize=${w.iconSize}
                .loading=${D}
                .showBalance=${!1}
                .charsStart=${gu.ADDRESS_DISPLAY.START}
                .charsEnd=${gu.ADDRESS_DISPLAY.END}
                @buttonClick=${()=>this.handleSwitchWallet(o,x.address,i)}
                @iconClick=${()=>this.handleWalletAction({connection:o,address:x.address,isRecentConnection:n,namespace:i})}
              ></wui-inactive-profile-wallet-item>
            </wui-flex>
          `})})}renderAddConnectionButton(e){if(!this.isMultiWalletEnabled()&&this.caipAddress||!this.hasAnyConnections(e))return null;const{title:n}=this.getChainLabelInfo(e);return we`
      <wui-list-item
        variant="icon"
        iconVariant="overlay"
        icon="plus"
        iconSize="sm"
        ?chevron=${!0}
        @click=${()=>this.handleAddConnection(e)}
        data-testid="add-connection-button"
      >
        <wui-text variant="md-medium" color="secondary">${n}</wui-text>
      </wui-list-item>
    `}renderEmptyState(e){const{title:n,description:i}=this.getChainLabelInfo(e);return we`
      <wui-flex alignItems="flex-start" class="empty-template" data-testid="empty-template">
        <wui-flex
          flexDirection="column"
          alignItems="center"
          justifyContent="center"
          rowgap="3"
          class="empty-box"
        >
          <wui-icon-box size="xl" icon="wallet" color="secondary"></wui-icon-box>

          <wui-flex flexDirection="column" alignItems="center" justifyContent="center" gap="1">
            <wui-text color="primary" variant="lg-regular" data-testid="empty-state-text"
              >No wallet connected</wui-text
            >
            <wui-text color="secondary" variant="md-regular" data-testid="empty-state-description"
              >${i}</wui-text
            >
          </wui-flex>

          <wui-link
            @click=${()=>this.handleAddConnection(e)}
            data-testid="empty-state-button"
            icon="plus"
          >
            ${n}
          </wui-link>
        </wui-flex>
      </wui-flex>
    `}handleTabChange(e){var i,o,l;const n=this.namespaces[e];n&&((i=this.chainListener)==null||i.call(this),this.currentTab=this.namespaces.indexOf(n),this.namespace=n,this.caipAddress=(o=ue.getAccountData(n))==null?void 0:o.caipAddress,this.profileName=(l=ue.getAccountData(n))==null?void 0:l.profileName,this.chainListener=ue.subscribeChainProp("accountState",h=>{this.caipAddress=h==null?void 0:h.caipAddress},n))}async handleSwitchWallet(e,n,i){var o;try{this.isSwitching=!0,this.lastSelectedConnectorId=e.connectorId,this.lastSelectedAddress=n,((o=this.caipNetwork)==null?void 0:o.chainNamespace)!==i&&(e!=null&&e.caipNetwork)&&(Nt.setFilterByNamespace(i),await ue.switchActiveNetwork(e==null?void 0:e.caipNetwork)),await Ht.switchConnection({connection:e,address:n,namespace:i,closeModalOnConnect:!1,onChange({hasSwitchedAccount:h,hasSwitchedWallet:s}){s?Ji.showSuccess("Wallet switched"):h&&Ji.showSuccess("Account switched")}})}catch{Ji.showError("Failed to switch wallet")}finally{this.isSwitching=!1}}handleWalletAction(e){const{connection:n,address:i,isRecentConnection:o,namespace:l}=e;o?(Jt.deleteAddressFromConnection({connectorId:n.connectorId,address:i,namespace:l}),Ht.syncStorageConnections(),Ji.showSuccess("Wallet deleted")):this.handleDisconnect(l,n.connectorId)}async handleDisconnect(e,n){try{await Ht.disconnect({id:n,namespace:e}),Ji.showSuccess("Wallet disconnected")}catch{Ji.showError("Failed to disconnect wallet")}}handleCopyAddress(e){Ft.copyToClopboard(e),Ji.showSuccess("Address copied")}handleMore(){Pt.push("AccountSettings")}handleExternalLink(e){var i,o;const n=(o=(i=this.caipNetwork)==null?void 0:i.blockExplorers)==null?void 0:o.default.url;n&&Ft.openHref(`${n}/address/${e}`,"_blank")}handleAddConnection(e){Nt.setFilterByNamespace(e),Pt.push("Connect",{addWalletForNamespace:e})}getChainLabelInfo(e){return oPe[e]??{title:"Add Wallet",description:"Add your first wallet"}}isSmartAccount(e){var i,o;if(!this.namespace)return!1;const n=(o=(i=this.user)==null?void 0:i.accounts)==null?void 0:o.find(l=>l.type==="smartAccount");return n&&e?no.isLowerCaseMatch(n.address,e):!1}getPlainAddress(){return this.caipAddress?Ft.getPlainAddress(this.caipAddress):void 0}getActiveConnections(e){const n=this.activeConnectorIds[e],{connections:i}=Bl.getConnectionsData(e),[o]=i.filter(w=>no.isLowerCaseMatch(w.connectorId,n));if(!n)return i;const l=e===at.CHAIN.BITCOIN,{address:h}=this.caipAddress?No.parseCaipAddress(this.caipAddress):{};let s=[...h?[h]:[]];return l&&o&&(s=o.accounts.map(w=>w.address)||[]),Bl.excludeConnectorAddressFromConnections({connectorId:n,addresses:s,connections:i})}hasAnyConnections(e){const n=this.getActiveConnections(e),{recentConnections:i}=Bl.getConnectionsData(e);return!!this.caipAddress||n.length>0||i.length>0}isAccountLoading(e,n){return no.isLowerCaseMatch(this.lastSelectedConnectorId,e)&&no.isLowerCaseMatch(this.lastSelectedAddress,n)&&this.isSwitching}getProfileContent(e){const{address:n,connections:i,connectorId:o,namespace:l}=e,[h]=i.filter(w=>no.isLowerCaseMatch(w.connectorId,o));if(l===at.CHAIN.BITCOIN&&(h!=null&&h.accounts.every(w=>typeof w.type=="string")))return this.getBitcoinProfileContent(h.accounts,n);const s=dR.getAuthData({connectorId:o,accounts:[]});return[{address:n,tagLabel:"Active",tagVariant:"success",enableButton:!0,profileName:this.profileName,buttonType:"disconnect",buttonLabel:"Disconnect",buttonVariant:"neutral-secondary",...s.isAuth?{description:this.isSmartAccount(n)?"Smart Account":"EOA Account"}:{}}]}getBitcoinProfileContent(e,n){const i=e.length>1,o=this.getPlainAddress();return e.map(l=>{const h=no.isLowerCaseMatch(l.address,o);let s="PAYMENT";return l.type==="ordinal"&&(s="ORDINALS"),{address:l.address,tagLabel:no.isLowerCaseMatch(l.address,n)?"Active":void 0,tagVariant:no.isLowerCaseMatch(l.address,n)?"success":void 0,enableButton:!0,...i?{label:s,alignItems:"flex-end",buttonType:h?"disconnect":"switch",buttonLabel:h?"Disconnect":"Switch",buttonVariant:h?"neutral-secondary":"accent-secondary"}:{alignItems:"center",buttonType:"disconnect",buttonLabel:"Disconnect",buttonVariant:"neutral-secondary"}}})}removeScrollListener(){var n;const e=(n=this.shadowRoot)==null?void 0:n.querySelector(".wallet-list");e&&e.removeEventListener("scroll",()=>this.handleConnectListScroll())}handleConnectListScroll(){var n;const e=(n=this.shadowRoot)==null?void 0:n.querySelector(".wallet-list");e&&this.updateScrollOpacity(e)}isMultiWalletEnabled(){var e;return!!((e=this.remoteFeatures)!=null&&e.multiWallet)}updateScrollOpacity(e){e.style.setProperty("--connect-scroll--top-opacity",jA.interpolate([0,gu.SCROLL_THRESHOLD],gu.OPACITY_RANGE,e.scrollTop).toString()),e.style.setProperty("--connect-scroll--bottom-opacity",jA.interpolate([0,gu.SCROLL_THRESHOLD],gu.OPACITY_RANGE,e.scrollHeight-e.scrollTop-e.offsetHeight).toString())}onConnectionsChange(){if(this.isMultiWalletEnabled()&&this.namespace){const{connections:e}=Bl.getConnectionsData(this.namespace);e.length===0&&Pt.reset("ProfileWallets")}this.requestUpdate()}};ic.styles=rPe;Gl([Lt()],ic.prototype,"currentTab",void 0);Gl([Lt()],ic.prototype,"namespace",void 0);Gl([Lt()],ic.prototype,"namespaces",void 0);Gl([Lt()],ic.prototype,"caipAddress",void 0);Gl([Lt()],ic.prototype,"profileName",void 0);Gl([Lt()],ic.prototype,"activeConnectorIds",void 0);Gl([Lt()],ic.prototype,"lastSelectedAddress",void 0);Gl([Lt()],ic.prototype,"lastSelectedConnectorId",void 0);Gl([Lt()],ic.prototype,"isSwitching",void 0);Gl([Lt()],ic.prototype,"caipNetwork",void 0);Gl([Lt()],ic.prototype,"user",void 0);Gl([Lt()],ic.prototype,"remoteFeatures",void 0);ic=Gl([nn("w3m-profile-wallets-view")],ic);var jw=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Vm=class extends on{constructor(){super(),this.unsubscribe=[],this.activeCaipNetwork=ue.state.activeCaipNetwork,this.features=ut.state.features,this.remoteFeatures=ut.state.remoteFeatures,this.exchangesLoading=ko.state.isLoading,this.exchanges=ko.state.exchanges,this.unsubscribe.push(ut.subscribeKey("features",e=>this.features=e),ut.subscribeKey("remoteFeatures",e=>this.remoteFeatures=e),ue.subscribeKey("activeCaipNetwork",e=>{this.activeCaipNetwork=e,this.setDefaultPaymentAsset()}),ko.subscribeKey("isLoading",e=>this.exchangesLoading=e),ko.subscribeKey("exchanges",e=>this.exchanges=e))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}async firstUpdated(){ko.isPayWithExchangeSupported()&&(await this.setDefaultPaymentAsset(),await ko.fetchExchanges())}render(){return we`
      <wui-flex flexDirection="column" .padding=${["1","3","3","3"]} gap="2">
        ${this.onrampTemplate()} ${this.receiveTemplate()} ${this.depositFromExchangeTemplate()}
      </wui-flex>
    `}async setDefaultPaymentAsset(){if(!this.activeCaipNetwork)return;const e=await ko.getAssetsForNetwork(this.activeCaipNetwork.caipNetworkId),n=e.find(i=>i.metadata.symbol==="USDC")||e[0];n&&ko.setPaymentAsset(n)}onrampTemplate(){var i;if(!this.activeCaipNetwork)return null;const e=(i=this.remoteFeatures)==null?void 0:i.onramp,n=hi.ONRAMP_SUPPORTED_CHAIN_NAMESPACES.includes(this.activeCaipNetwork.chainNamespace);return!e||!n?null:we`
      <wui-list-item
        @click=${this.onBuyCrypto.bind(this)}
        icon="card"
        data-testid="wallet-features-onramp-button"
      >
        <wui-text variant="lg-regular" color="primary">Buy crypto</wui-text>
      </wui-list-item>
    `}depositFromExchangeTemplate(){return!this.activeCaipNetwork||!ko.isPayWithExchangeSupported()?null:we`
      <wui-list-item
        @click=${this.onDepositFromExchange.bind(this)}
        icon="arrowBottomCircle"
        data-testid="wallet-features-deposit-from-exchange-button"
        ?loading=${this.exchangesLoading}
        ?disabled=${this.exchangesLoading||!this.exchanges.length}
      >
        <wui-text variant="lg-regular" color="primary">Deposit from exchange</wui-text>
      </wui-list-item>
    `}receiveTemplate(){var n;return!((n=this.features)!=null&&n.receive)?null:we`
      <wui-list-item
        @click=${this.onReceive.bind(this)}
        icon="qrCode"
        data-testid="wallet-features-receive-button"
      >
        <wui-text variant="lg-regular" color="primary">Receive funds</wui-text>
      </wui-list-item>
    `}onBuyCrypto(){Pt.push("OnRampProviders")}onReceive(){Pt.push("WalletReceive")}onDepositFromExchange(){var e;ko.reset(),Pt.push("PayWithExchange",{redirectView:(e=Pt.state.data)==null?void 0:e.redirectView})}};jw([Lt()],Vm.prototype,"activeCaipNetwork",void 0);jw([Lt()],Vm.prototype,"features",void 0);jw([Lt()],Vm.prototype,"remoteFeatures",void 0);jw([Lt()],Vm.prototype,"exchangesLoading",void 0);jw([Lt()],Vm.prototype,"exchanges",void 0);Vm=jw([nn("w3m-fund-wallet-view")],Vm);/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const aPe=t=>t.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Kx=(t,e)=>{var i;const n=t._$AN;if(n===void 0)return!1;for(const o of n)(i=o._$AO)==null||i.call(o,e,!1),Kx(o,e);return!0},eS=t=>{let e,n;do{if((e=t._$AM)===void 0)break;n=e._$AN,n.delete(t),t=e}while((n==null?void 0:n.size)===0)},lY=t=>{for(let e;e=t._$AM;t=e){let n=e._$AN;if(n===void 0)e._$AN=n=new Set;else if(n.has(t))break;n.add(t),uPe(e)}};function cPe(t){this._$AN!==void 0?(eS(this),this._$AM=t,lY(this)):this._$AM=t}function lPe(t,e=!1,n=0){const i=this._$AH,o=this._$AN;if(o!==void 0&&o.size!==0)if(e)if(Array.isArray(i))for(let l=n;l<i.length;l++)Kx(i[l],!1),eS(i[l]);else i!=null&&(Kx(i,!1),eS(i));else Kx(this,t)}const uPe=t=>{t.type==iY.CHILD&&(t._$AP??(t._$AP=lPe),t._$AQ??(t._$AQ=cPe))};class dPe extends sY{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,n,i){super._$AT(e,n,i),lY(this),this.isConnected=e._$AU}_$AO(e,n=!0){var i,o;e!==this.isConnected&&(this.isConnected=e,e?(i=this.reconnected)==null||i.call(this):(o=this.disconnected)==null||o.call(this)),n&&(Kx(this,e),eS(this))}setValue(e){if(aPe(this._$Ct))this._$Ct._$AI(e,this);else{const n=[...this._$Ct._$AH];n[this._$Ci]=e,this._$Ct._$AI(n,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const JE=()=>new hPe;class hPe{}const hR=new WeakMap,QE=rY(class extends dPe{render(t){return ro}update(t,[e]){var i;const n=e!==this.G;return n&&this.G!==void 0&&this.rt(void 0),(n||this.lt!==this.ct)&&(this.G=e,this.ht=(i=t.options)==null?void 0:i.host,this.rt(this.ct=t.element)),ro}rt(t){if(this.isConnected||(t=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let n=hR.get(e);n===void 0&&(n=new WeakMap,hR.set(e,n)),n.get(this.G)!==void 0&&this.G.call(this.ht,void 0),n.set(this.G,t),t!==void 0&&this.G.call(this.ht,t)}else this.G.value=t}get lt(){var t,e;return typeof this.G=="function"?(t=hR.get(this.ht??globalThis))==null?void 0:t.get(this.G):(e=this.G)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}}),fPe=Fn`
  :host {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  label {
    position: relative;
    display: inline-block;
    user-select: none;
    transition:
      background-color ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      color ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      border ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      box-shadow ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      width ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      height ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      transform ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      opacity ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color, color, border, box-shadow, width, height, transform, opacity;
  }

  input {
    width: 0;
    height: 0;
    opacity: 0;
  }

  span {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: ${({colors:t})=>t.neutrals300};
    border-radius: ${({borderRadius:t})=>t.round};
    border: 1px solid transparent;
    will-change: border;
    transition:
      background-color ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      color ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      border ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      box-shadow ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      width ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      height ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      transform ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]},
      opacity ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color, color, border, box-shadow, width, height, transform, opacity;
  }

  span:before {
    content: '';
    position: absolute;
    background-color: ${({colors:t})=>t.white};
    border-radius: 50%;
  }

  /* -- Sizes --------------------------------------------------------- */
  label[data-size='lg'] {
    width: 48px;
    height: 32px;
  }

  label[data-size='md'] {
    width: 40px;
    height: 28px;
  }

  label[data-size='sm'] {
    width: 32px;
    height: 22px;
  }

  label[data-size='lg'] > span:before {
    height: 24px;
    width: 24px;
    left: 4px;
    top: 3px;
  }

  label[data-size='md'] > span:before {
    height: 20px;
    width: 20px;
    left: 4px;
    top: 3px;
  }

  label[data-size='sm'] > span:before {
    height: 16px;
    width: 16px;
    left: 3px;
    top: 2px;
  }

  /* -- Focus states --------------------------------------------------- */
  input:focus-visible:not(:checked) + span,
  input:focus:not(:checked) + span {
    border: 1px solid ${({tokens:t})=>t.core.iconAccentPrimary};
    background-color: ${({tokens:t})=>t.theme.textTertiary};
    box-shadow: 0px 0px 0px 4px rgba(9, 136, 240, 0.2);
  }

  input:focus-visible:checked + span,
  input:focus:checked + span {
    border: 1px solid ${({tokens:t})=>t.core.iconAccentPrimary};
    box-shadow: 0px 0px 0px 4px rgba(9, 136, 240, 0.2);
  }

  /* -- Checked states --------------------------------------------------- */
  input:checked + span {
    background-color: ${({tokens:t})=>t.core.iconAccentPrimary};
  }

  label[data-size='lg'] > input:checked + span:before {
    transform: translateX(calc(100% - 9px));
  }

  label[data-size='md'] > input:checked + span:before {
    transform: translateX(calc(100% - 9px));
  }

  label[data-size='sm'] > input:checked + span:before {
    transform: translateX(calc(100% - 7px));
  }

  /* -- Hover states ------------------------------------------------------- */
  label:hover > input:not(:checked):not(:disabled) + span {
    background-color: ${({colors:t})=>t.neutrals400};
  }

  label:hover > input:checked:not(:disabled) + span {
    background-color: ${({colors:t})=>t.accent080};
  }

  /* -- Disabled state --------------------------------------------------- */
  label:has(input:disabled) {
    pointer-events: none;
    user-select: none;
  }

  input:not(:checked):disabled + span {
    background-color: ${({colors:t})=>t.neutrals700};
  }

  input:checked:disabled + span {
    background-color: ${({colors:t})=>t.neutrals700};
  }

  input:not(:checked):disabled + span::before {
    background-color: ${({colors:t})=>t.neutrals400};
  }

  input:checked:disabled + span::before {
    background-color: ${({tokens:t})=>t.theme.textTertiary};
  }
`;var pI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let _w=class extends on{constructor(){super(...arguments),this.inputElementRef=JE(),this.checked=!1,this.disabled=!1,this.size="md"}render(){return we`
      <label data-size=${this.size}>
        <input
          ${QE(this.inputElementRef)}
          type="checkbox"
          ?checked=${this.checked}
          ?disabled=${this.disabled}
          @change=${this.dispatchChangeEvent.bind(this)}
        />
        <span></span>
      </label>
    `}dispatchChangeEvent(){var e;this.dispatchEvent(new CustomEvent("switchChange",{detail:(e=this.inputElementRef.value)==null?void 0:e.checked,bubbles:!0,composed:!0}))}};_w.styles=[Ei,Kr,fPe];pI([Fe({type:Boolean})],_w.prototype,"checked",void 0);pI([Fe({type:Boolean})],_w.prototype,"disabled",void 0);pI([Fe()],_w.prototype,"size",void 0);_w=pI([nn("wui-toggle")],_w);const pPe=Fn`
  :host {
    height: auto;
  }

  :host > wui-flex {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    column-gap: ${({spacing:t})=>t[2]};
    padding: ${({spacing:t})=>t[2]} ${({spacing:t})=>t[3]};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[4]};
    box-shadow: inset 0 0 0 1px ${({tokens:t})=>t.theme.foregroundPrimary};
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: background-color;
    cursor: pointer;
  }

  wui-switch {
    pointer-events: none;
  }
`;var uY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let tS=class extends on{constructor(){super(...arguments),this.checked=!1}render(){return we`
      <wui-flex>
        <wui-icon size="xl" name="walletConnectBrown"></wui-icon>
        <wui-toggle
          ?checked=${this.checked}
          size="sm"
          @switchChange=${this.handleToggleChange.bind(this)}
        ></wui-toggle>
      </wui-flex>
    `}handleToggleChange(e){e.stopPropagation(),this.checked=e.detail,this.dispatchSwitchEvent()}dispatchSwitchEvent(){this.dispatchEvent(new CustomEvent("certifiedSwitchChange",{detail:this.checked,bubbles:!0,composed:!0}))}};tS.styles=[Ei,Kr,pPe];uY([Fe({type:Boolean})],tS.prototype,"checked",void 0);tS=uY([nn("wui-certified-switch")],tS);const mPe=Fn`
  :host {
    position: relative;
    width: 100%;
    display: inline-flex;
    flex-direction: column;
    gap: ${({spacing:t})=>t[3]};
    color: ${({tokens:t})=>t.theme.textPrimary};
    caret-color: ${({tokens:t})=>t.core.textAccentPrimary};
  }

  .wui-input-text-container {
    position: relative;
    display: flex;
  }

  input {
    width: 100%;
    border-radius: ${({borderRadius:t})=>t[4]};
    color: inherit;
    background: transparent;
    border: 1px solid ${({tokens:t})=>t.theme.borderPrimary};
    caret-color: ${({tokens:t})=>t.core.textAccentPrimary};
    padding: ${({spacing:t})=>t[3]} ${({spacing:t})=>t[3]}
      ${({spacing:t})=>t[3]} ${({spacing:t})=>t[10]};
    font-size: ${({textSize:t})=>t.large};
    line-height: ${({typography:t})=>t["lg-regular"].lineHeight};
    letter-spacing: ${({typography:t})=>t["lg-regular"].letterSpacing};
    font-weight: ${({fontWeight:t})=>t.regular};
    font-family: ${({fontFamily:t})=>t.regular};
  }

  input[data-size='lg'] {
    padding: ${({spacing:t})=>t[4]} ${({spacing:t})=>t[3]}
      ${({spacing:t})=>t[4]} ${({spacing:t})=>t[10]};
  }

  @media (hover: hover) and (pointer: fine) {
    input:hover:enabled {
      border: 1px solid ${({tokens:t})=>t.theme.borderSecondary};
    }
  }

  input:disabled {
    cursor: unset;
    border: 1px solid ${({tokens:t})=>t.theme.borderPrimary};
  }

  input::placeholder {
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  input:focus:enabled {
    border: 1px solid ${({tokens:t})=>t.theme.borderSecondary};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    -webkit-box-shadow: 0px 0px 0px 4px ${({tokens:t})=>t.core.foregroundAccent040};
    -moz-box-shadow: 0px 0px 0px 4px ${({tokens:t})=>t.core.foregroundAccent040};
    box-shadow: 0px 0px 0px 4px ${({tokens:t})=>t.core.foregroundAccent040};
  }

  div.wui-input-text-container:has(input:disabled) {
    opacity: 0.5;
  }

  wui-icon.wui-input-text-left-icon {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    left: ${({spacing:t})=>t[4]};
    color: ${({tokens:t})=>t.theme.iconDefault};
  }

  button.wui-input-text-submit-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    right: ${({spacing:t})=>t[3]};
    width: 24px;
    height: 24px;
    border: none;
    background: transparent;
    border-radius: ${({borderRadius:t})=>t[2]};
    color: ${({tokens:t})=>t.core.textAccentPrimary};
  }

  button.wui-input-text-submit-button:disabled {
    opacity: 1;
  }

  button.wui-input-text-submit-button.loading wui-icon {
    animation: spin 1s linear infinite;
  }

  button.wui-input-text-submit-button:hover {
    background: ${({tokens:t})=>t.core.foregroundAccent010};
  }

  input:has(+ .wui-input-text-submit-button) {
    padding-right: ${({spacing:t})=>t[12]};
  }

  input[type='number'] {
    -moz-appearance: textfield;
  }

  input[type='search']::-webkit-search-decoration,
  input[type='search']::-webkit-search-cancel-button,
  input[type='search']::-webkit-search-results-button,
  input[type='search']::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }

  /* -- Keyframes --------------------------------------------------- */
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
`;var Du=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let cl=class extends on{constructor(){super(...arguments),this.inputElementRef=JE(),this.disabled=!1,this.loading=!1,this.placeholder="",this.type="text",this.value="",this.size="md"}render(){return we` <div class="wui-input-text-container">
        ${this.templateLeftIcon()}
        <input
          data-size=${this.size}
          ${QE(this.inputElementRef)}
          data-testid="wui-input-text"
          type=${this.type}
          enterkeyhint=${Tn(this.enterKeyHint)}
          ?disabled=${this.disabled}
          placeholder=${this.placeholder}
          @input=${this.dispatchInputChangeEvent.bind(this)}
          @keydown=${this.onKeyDown}
          .value=${this.value||""}
        />
        ${this.templateSubmitButton()}
        <slot class="wui-input-text-slot"></slot>
      </div>
      ${this.templateError()} ${this.templateWarning()}`}templateLeftIcon(){return this.icon?we`<wui-icon
        class="wui-input-text-left-icon"
        size="md"
        data-size=${this.size}
        color="inherit"
        name=${this.icon}
      ></wui-icon>`:null}templateSubmitButton(){var e;return this.onSubmit?we`<button
        class="wui-input-text-submit-button ${this.loading?"loading":""}"
        @click=${(e=this.onSubmit)==null?void 0:e.bind(this)}
        ?disabled=${this.disabled||this.loading}
      >
        ${this.loading?we`<wui-icon name="spinner" size="md"></wui-icon>`:we`<wui-icon name="chevronRight" size="md"></wui-icon>`}
      </button>`:null}templateError(){return this.errorText?we`<wui-text variant="sm-regular" color="error">${this.errorText}</wui-text>`:null}templateWarning(){return this.warningText?we`<wui-text variant="sm-regular" color="warning">${this.warningText}</wui-text>`:null}dispatchInputChangeEvent(){var e;this.dispatchEvent(new CustomEvent("inputChange",{detail:(e=this.inputElementRef.value)==null?void 0:e.value,bubbles:!0,composed:!0}))}};cl.styles=[Ei,Kr,mPe];Du([Fe()],cl.prototype,"icon",void 0);Du([Fe({type:Boolean})],cl.prototype,"disabled",void 0);Du([Fe({type:Boolean})],cl.prototype,"loading",void 0);Du([Fe()],cl.prototype,"placeholder",void 0);Du([Fe()],cl.prototype,"type",void 0);Du([Fe()],cl.prototype,"value",void 0);Du([Fe()],cl.prototype,"errorText",void 0);Du([Fe()],cl.prototype,"warningText",void 0);Du([Fe()],cl.prototype,"onSubmit",void 0);Du([Fe()],cl.prototype,"size",void 0);Du([Fe({attribute:!1})],cl.prototype,"onKeyDown",void 0);cl=Du([nn("wui-input-text")],cl);const gPe=Fn`
  :host {
    position: relative;
    display: inline-block;
    width: 100%;
  }

  wui-icon {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    right: ${({spacing:t})=>t[3]};
    color: ${({tokens:t})=>t.theme.iconDefault};
    cursor: pointer;
    padding: ${({spacing:t})=>t[2]};
    background-color: transparent;
    border-radius: ${({borderRadius:t})=>t[4]};
    transition: background-color ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
  }

  @media (hover: hover) {
    wui-icon:hover {
      background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    }
  }
`;var dY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let nS=class extends on{constructor(){super(...arguments),this.inputComponentRef=JE(),this.inputValue=""}render(){return we`
      <wui-input-text
        ${QE(this.inputComponentRef)}
        placeholder="Search wallet"
        icon="search"
        type="search"
        enterKeyHint="search"
        size="sm"
        @inputChange=${this.onInputChange}
      >
        ${this.inputValue?we`<wui-icon
              @click=${this.clearValue}
              color="inherit"
              size="sm"
              name="close"
            ></wui-icon>`:null}
      </wui-input-text>
    `}onInputChange(e){this.inputValue=e.detail||""}clearValue(){const e=this.inputComponentRef.value,n=e==null?void 0:e.inputElementRef.value;n&&(n.value="",this.inputValue="",n.focus(),n.dispatchEvent(new Event("input")))}};nS.styles=[Ei,gPe];dY([Fe()],nS.prototype,"inputValue",void 0);nS=dY([nn("wui-search-bar")],nS);const hY=yi`<svg  viewBox="0 0 48 54" fill="none">
  <path
    d="M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z"
  />
</svg>`,yPe=Fn`
  :host {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 104px;
    width: 104px;
    row-gap: ${({spacing:t})=>t[2]};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[5]};
    position: relative;
  }

  wui-shimmer[data-type='network'] {
    border: none;
    -webkit-clip-path: var(--apkt-path-network);
    clip-path: var(--apkt-path-network);
  }

  svg {
    position: absolute;
    width: 48px;
    height: 54px;
    z-index: 1;
  }

  svg > path {
    stroke: ${({tokens:t})=>t.theme.foregroundSecondary};
    stroke-width: 1px;
  }

  @media (max-width: 350px) {
    :host {
      width: 100%;
    }
  }
`;var fY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let iS=class extends on{constructor(){super(...arguments),this.type="wallet"}render(){return we`
      ${this.shimmerTemplate()}
      <wui-shimmer width="80px" height="20px"></wui-shimmer>
    `}shimmerTemplate(){return this.type==="network"?we` <wui-shimmer data-type=${this.type} width="48px" height="54px"></wui-shimmer>
        ${hY}`:we`<wui-shimmer width="56px" height="56px"></wui-shimmer>`}};iS.styles=[Ei,Kr,yPe];fY([Fe()],iS.prototype,"type",void 0);iS=fY([nn("wui-card-select-loader")],iS);const _Pe=rs`
  :host {
    display: grid;
    width: inherit;
    height: inherit;
  }
`;var Nu=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let ll=class extends on{render(){return this.style.cssText=`
      grid-template-rows: ${this.gridTemplateRows};
      grid-template-columns: ${this.gridTemplateColumns};
      justify-items: ${this.justifyItems};
      align-items: ${this.alignItems};
      justify-content: ${this.justifyContent};
      align-content: ${this.alignContent};
      column-gap: ${this.columnGap&&`var(--apkt-spacing-${this.columnGap})`};
      row-gap: ${this.rowGap&&`var(--apkt-spacing-${this.rowGap})`};
      gap: ${this.gap&&`var(--apkt-spacing-${this.gap})`};
      padding-top: ${this.padding&&us.getSpacingStyles(this.padding,0)};
      padding-right: ${this.padding&&us.getSpacingStyles(this.padding,1)};
      padding-bottom: ${this.padding&&us.getSpacingStyles(this.padding,2)};
      padding-left: ${this.padding&&us.getSpacingStyles(this.padding,3)};
      margin-top: ${this.margin&&us.getSpacingStyles(this.margin,0)};
      margin-right: ${this.margin&&us.getSpacingStyles(this.margin,1)};
      margin-bottom: ${this.margin&&us.getSpacingStyles(this.margin,2)};
      margin-left: ${this.margin&&us.getSpacingStyles(this.margin,3)};
    `,we`<slot></slot>`}};ll.styles=[Ei,_Pe];Nu([Fe()],ll.prototype,"gridTemplateRows",void 0);Nu([Fe()],ll.prototype,"gridTemplateColumns",void 0);Nu([Fe()],ll.prototype,"justifyItems",void 0);Nu([Fe()],ll.prototype,"alignItems",void 0);Nu([Fe()],ll.prototype,"justifyContent",void 0);Nu([Fe()],ll.prototype,"alignContent",void 0);Nu([Fe()],ll.prototype,"columnGap",void 0);Nu([Fe()],ll.prototype,"rowGap",void 0);Nu([Fe()],ll.prototype,"gap",void 0);Nu([Fe()],ll.prototype,"padding",void 0);Nu([Fe()],ll.prototype,"margin",void 0);ll=Nu([nn("wui-grid")],ll);const wPe=Fn`
  button {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    width: 104px;
    row-gap: ${({spacing:t})=>t[2]};
    padding: ${({spacing:t})=>t[3]} ${({spacing:t})=>t[0]};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: clamp(0px, ${({borderRadius:t})=>t[4]}, 20px);
    transition:
      color ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-1"]},
      background-color ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-1"]},
      border-radius ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-1"]};
    will-change: background-color, color, border-radius;
    outline: none;
    border: none;
  }

  button > wui-flex > wui-text {
    color: ${({tokens:t})=>t.theme.textPrimary};
    max-width: 86px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    justify-content: center;
  }

  button > wui-flex > wui-text.certified {
    max-width: 66px;
  }

  @media (hover: hover) and (pointer: fine) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    }
  }

  button:disabled > wui-flex > wui-text {
    color: ${({tokens:t})=>t.core.glass010};
  }

  [data-selected='true'] {
    background-color: ${({colors:t})=>t.accent020};
  }

  @media (hover: hover) and (pointer: fine) {
    [data-selected='true']:hover:enabled {
      background-color: ${({colors:t})=>t.accent010};
    }
  }

  [data-selected='true']:active:enabled {
    background-color: ${({colors:t})=>t.accent010};
  }

  @media (max-width: 350px) {
    button {
      width: 100%;
    }
  }
`;var Bh=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Iu=class extends on{constructor(){super(),this.observer=new IntersectionObserver(()=>{}),this.visible=!1,this.imageSrc=void 0,this.imageLoading=!1,this.isImpressed=!1,this.explorerId="",this.walletQuery="",this.certified=!1,this.displayIndex=0,this.wallet=void 0,this.observer=new IntersectionObserver(e=>{e.forEach(n=>{n.isIntersecting?(this.visible=!0,this.fetchImageSrc(),this.sendImpressionEvent()):this.visible=!1})},{threshold:.01})}firstUpdated(){this.observer.observe(this)}disconnectedCallback(){this.observer.disconnect()}render(){var n,i;const e=((n=this.wallet)==null?void 0:n.badge_type)==="certified";return we`
      <button>
        ${this.imageTemplate()}
        <wui-flex flexDirection="row" alignItems="center" justifyContent="center" gap="1">
          <wui-text
            variant="md-regular"
            color="inherit"
            class=${Tn(e?"certified":void 0)}
            >${(i=this.wallet)==null?void 0:i.name}</wui-text
          >
          ${e?we`<wui-icon size="sm" name="walletConnectBrown"></wui-icon>`:null}
        </wui-flex>
      </button>
    `}imageTemplate(){var e,n;return!this.visible&&!this.imageSrc||this.imageLoading?this.shimmerTemplate():we`
      <wui-wallet-image
        size="lg"
        imageSrc=${Tn(this.imageSrc)}
        name=${Tn((e=this.wallet)==null?void 0:e.name)}
        .installed=${((n=this.wallet)==null?void 0:n.installed)??!1}
        badgeSize="sm"
      >
      </wui-wallet-image>
    `}shimmerTemplate(){return we`<wui-shimmer width="56px" height="56px"></wui-shimmer>`}async fetchImageSrc(){this.wallet&&(this.imageSrc=Ur.getWalletImage(this.wallet),!this.imageSrc&&(this.imageLoading=!0,this.imageSrc=await Ur.fetchWalletImage(this.wallet.image_id),this.imageLoading=!1))}sendImpressionEvent(){!this.wallet||this.isImpressed||(this.isImpressed=!0,Sn.sendWalletImpressionEvent({name:this.wallet.name,walletRank:this.wallet.order,explorerId:this.explorerId,view:Pt.state.view,query:this.walletQuery,certified:this.certified,displayIndex:this.displayIndex}))}};Iu.styles=wPe;Bh([Lt()],Iu.prototype,"visible",void 0);Bh([Lt()],Iu.prototype,"imageSrc",void 0);Bh([Lt()],Iu.prototype,"imageLoading",void 0);Bh([Lt()],Iu.prototype,"isImpressed",void 0);Bh([Fe()],Iu.prototype,"explorerId",void 0);Bh([Fe()],Iu.prototype,"walletQuery",void 0);Bh([Fe()],Iu.prototype,"certified",void 0);Bh([Fe()],Iu.prototype,"displayIndex",void 0);Bh([Fe({type:Object})],Iu.prototype,"wallet",void 0);Iu=Bh([nn("w3m-all-wallets-list-item")],Iu);const bPe=Fn`
  wui-grid {
    max-height: clamp(360px, 400px, 80vh);
    overflow: scroll;
    scrollbar-width: none;
    grid-auto-rows: min-content;
    grid-template-columns: repeat(auto-fill, 104px);
  }

  :host([data-mobile-fullscreen='true']) wui-grid {
    max-height: none;
  }

  @media (max-width: 350px) {
    wui-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  wui-grid[data-scroll='false'] {
    overflow: hidden;
  }

  wui-grid::-webkit-scrollbar {
    display: none;
  }

  w3m-all-wallets-list-item {
    opacity: 0;
    animation-duration: ${({durations:t})=>t.xl};
    animation-timing-function: ${({easings:t})=>t["ease-inout-power-2"]};
    animation-name: fade-in;
    animation-fill-mode: forwards;
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  wui-loading-spinner {
    padding-top: ${({spacing:t})=>t[4]};
    padding-bottom: ${({spacing:t})=>t[4]};
    justify-content: center;
    grid-column: 1 / span 4;
  }
`;var e3=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const KU="local-paginator";let yy=class extends on{constructor(){super(),this.unsubscribe=[],this.paginationObserver=void 0,this.loading=!fn.state.wallets.length,this.wallets=fn.state.wallets,this.mobileFullScreen=ut.state.enableMobileFullScreen,this.unsubscribe.push(fn.subscribeKey("wallets",e=>this.wallets=e))}firstUpdated(){this.initialFetch(),this.createPaginationObserver()}disconnectedCallback(){var e;this.unsubscribe.forEach(n=>n()),(e=this.paginationObserver)==null||e.disconnect()}render(){return this.mobileFullScreen&&this.setAttribute("data-mobile-fullscreen","true"),we`
      <wui-grid
        data-scroll=${!this.loading}
        .padding=${["0","3","3","3"]}
        gap="2"
        justifyContent="space-between"
      >
        ${this.loading?this.shimmerTemplate(16):this.walletsTemplate()}
        ${this.paginationLoaderTemplate()}
      </wui-grid>
    `}async initialFetch(){var n;this.loading=!0;const e=(n=this.shadowRoot)==null?void 0:n.querySelector("wui-grid");e&&(await fn.fetchWalletsByPage({page:1}),await e.animate([{opacity:1},{opacity:0}],{duration:200,fill:"forwards",easing:"ease"}).finished,this.loading=!1,e.animate([{opacity:0},{opacity:1}],{duration:200,fill:"forwards",easing:"ease"}))}shimmerTemplate(e,n){return[...Array(e)].map(()=>we`
        <wui-card-select-loader type="wallet" id=${Tn(n)}></wui-card-select-loader>
      `)}walletsTemplate(){return Fl.getWalletConnectWallets(this.wallets).map((e,n)=>we`
        <w3m-all-wallets-list-item
          data-testid="wallet-search-item-${e.id}"
          @click=${()=>this.onConnectWallet(e)}
          .wallet=${e}
          explorerId=${e.id}
          certified=${this.badge==="certified"}
          displayIndex=${n}
        ></w3m-all-wallets-list-item>
      `)}paginationLoaderTemplate(){const{wallets:e,recommended:n,featured:i,count:o,mobileFilteredOutWalletsLength:l}=fn.state,h=window.innerWidth<352?3:4,s=e.length+n.length;let x=Math.ceil(s/h)*h-s+h;return x-=e.length?i.length%h:0,o===0&&i.length>0?null:o===0||[...i,...e,...n].length<o-(l??0)?this.shimmerTemplate(x,KU):null}createPaginationObserver(){var n;const e=(n=this.shadowRoot)==null?void 0:n.querySelector(`#${KU}`);e&&(this.paginationObserver=new IntersectionObserver(([i])=>{if(i!=null&&i.isIntersecting&&!this.loading){const{page:o,count:l,wallets:h}=fn.state;h.length<l&&fn.fetchWalletsByPage({page:o+1})}}),this.paginationObserver.observe(e))}onConnectWallet(e){Nt.selectWalletConnector(e)}};yy.styles=bPe;e3([Lt()],yy.prototype,"loading",void 0);e3([Lt()],yy.prototype,"wallets",void 0);e3([Lt()],yy.prototype,"badge",void 0);e3([Lt()],yy.prototype,"mobileFullScreen",void 0);yy=e3([nn("w3m-all-wallets-list")],yy);const vPe=rs`
  wui-grid,
  wui-loading-spinner,
  wui-flex {
    height: 360px;
  }

  wui-grid {
    overflow: scroll;
    scrollbar-width: none;
    grid-auto-rows: min-content;
    grid-template-columns: repeat(auto-fill, 104px);
  }

  :host([data-mobile-fullscreen='true']) wui-grid {
    max-height: none;
    height: auto;
  }

  wui-grid[data-scroll='false'] {
    overflow: hidden;
  }

  wui-grid::-webkit-scrollbar {
    display: none;
  }

  wui-loading-spinner {
    justify-content: center;
    align-items: center;
  }

  @media (max-width: 350px) {
    wui-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
`;var t3=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let _y=class extends on{constructor(){super(...arguments),this.prevQuery="",this.prevBadge=void 0,this.loading=!0,this.mobileFullScreen=ut.state.enableMobileFullScreen,this.query=""}render(){return this.mobileFullScreen&&this.setAttribute("data-mobile-fullscreen","true"),this.onSearch(),this.loading?we`<wui-loading-spinner color="accent-primary"></wui-loading-spinner>`:this.walletsTemplate()}async onSearch(){(this.query.trim()!==this.prevQuery.trim()||this.badge!==this.prevBadge)&&(this.prevQuery=this.query,this.prevBadge=this.badge,this.loading=!0,await fn.searchWallet({search:this.query,badge:this.badge}),this.loading=!1)}walletsTemplate(){const{search:e}=fn.state,n=Fl.markWalletsAsInstalled(e),i=Fl.filterWalletsByWcSupport(n);return i.length?we`
      <wui-grid
        data-testid="wallet-list"
        .padding=${["0","3","3","3"]}
        rowGap="4"
        columngap="2"
        justifyContent="space-between"
      >
        ${i.map((o,l)=>we`
            <w3m-all-wallets-list-item
              @click=${()=>this.onConnectWallet(o)}
              .wallet=${o}
              data-testid="wallet-search-item-${o.id}"
              explorerId=${o.id}
              certified=${this.badge==="certified"}
              walletQuery=${this.query}
              displayIndex=${l}
            ></w3m-all-wallets-list-item>
          `)}
      </wui-grid>
    `:we`
        <wui-flex
          data-testid="no-wallet-found"
          justifyContent="center"
          alignItems="center"
          gap="3"
          flexDirection="column"
        >
          <wui-icon-box size="lg" color="default" icon="wallet"></wui-icon-box>
          <wui-text data-testid="no-wallet-found-text" color="secondary" variant="md-medium">
            No Wallet found
          </wui-text>
        </wui-flex>
      `}onConnectWallet(e){Nt.selectWalletConnector(e)}};_y.styles=vPe;t3([Lt()],_y.prototype,"loading",void 0);t3([Lt()],_y.prototype,"mobileFullScreen",void 0);t3([Fe()],_y.prototype,"query",void 0);t3([Fe()],_y.prototype,"badge",void 0);_y=t3([nn("w3m-all-wallets-search")],_y);var eN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let J2=class extends on{constructor(){super(...arguments),this.search="",this.badge=void 0,this.onDebouncedSearch=Ft.debounce(e=>{this.search=e})}render(){const e=this.search.length>=2;return we`
      <wui-flex .padding=${["1","3","3","3"]} gap="2" alignItems="center">
        <wui-search-bar @inputChange=${this.onInputChange.bind(this)}></wui-search-bar>
        <wui-certified-switch
          ?checked=${this.badge==="certified"}
          @certifiedSwitchChange=${this.onCertifiedSwitchChange.bind(this)}
          data-testid="wui-certified-switch"
        ></wui-certified-switch>
        ${this.qrButtonTemplate()}
      </wui-flex>
      ${e||this.badge?we`<w3m-all-wallets-search
            query=${this.search}
            .badge=${this.badge}
          ></w3m-all-wallets-search>`:we`<w3m-all-wallets-list .badge=${this.badge}></w3m-all-wallets-list>`}
    `}onInputChange(e){this.onDebouncedSearch(e.detail)}onCertifiedSwitchChange(e){e.detail?(this.badge="certified",Ji.showSvg("Only WalletConnect certified",{icon:"walletConnectBrown",iconColor:"accent-100"})):this.badge=void 0}qrButtonTemplate(){return Ft.isMobile()?we`
        <wui-icon-box
          size="xl"
          iconSize="xl"
          color="accent-primary"
          icon="qrCode"
          border
          borderColor="wui-accent-glass-010"
          @click=${this.onWalletConnectQr.bind(this)}
        ></wui-icon-box>
      `:null}onWalletConnectQr(){Pt.push("ConnectingWalletConnect")}};eN([Lt()],J2.prototype,"search",void 0);eN([Lt()],J2.prototype,"badge",void 0);J2=eN([nn("w3m-all-wallets-view")],J2);const xPe=Fn`
  button {
    display: flex;
    gap: ${({spacing:t})=>t[1]};
    padding: ${({spacing:t})=>t[4]};
    width: 100%;
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[4]};
    justify-content: center;
    align-items: center;
  }

  :host([data-size='sm']) button {
    padding: ${({spacing:t})=>t[2]};
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  :host([data-size='md']) button {
    padding: ${({spacing:t})=>t[3]};
    border-radius: ${({borderRadius:t})=>t[3]};
  }

  button:hover {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  button:disabled {
    opacity: 0.5;
  }
`;var Vw=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Wm=class extends on{constructor(){super(...arguments),this.text="",this.disabled=!1,this.size="lg",this.icon="copy",this.tabIdx=void 0}render(){this.dataset.size=this.size;const e=`${this.size}-regular`;return we`
      <button ?disabled=${this.disabled} tabindex=${Tn(this.tabIdx)}>
        <wui-icon name=${this.icon} size=${this.size} color="default"></wui-icon>
        <wui-text align="center" variant=${e} color="primary">${this.text}</wui-text>
      </button>
    `}};Wm.styles=[Ei,Kr,xPe];Vw([Fe()],Wm.prototype,"text",void 0);Vw([Fe({type:Boolean})],Wm.prototype,"disabled",void 0);Vw([Fe()],Wm.prototype,"size",void 0);Vw([Fe()],Wm.prototype,"icon",void 0);Vw([Fe()],Wm.prototype,"tabIdx",void 0);Wm=Vw([nn("wui-list-button")],Wm);const EPe=rs`
  :host {
    position: relative;
    display: inline-block;
    width: 100%;
  }
`;var n3=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let wy=class extends on{constructor(){super(...arguments),this.disabled=!1}render(){return we`
      <wui-input-text
        type="email"
        placeholder="Email"
        icon="mail"
        size="lg"
        .disabled=${this.disabled}
        .value=${this.value}
        data-testid="wui-email-input"
        tabIdx=${Tn(this.tabIdx)}
      ></wui-input-text>
      ${this.templateError()}
    `}templateError(){return this.errorMessage?we`<wui-text variant="sm-regular" color="error">${this.errorMessage}</wui-text>`:null}};wy.styles=[Ei,EPe];n3([Fe()],wy.prototype,"errorMessage",void 0);n3([Fe({type:Boolean})],wy.prototype,"disabled",void 0);n3([Fe()],wy.prototype,"value",void 0);n3([Fe()],wy.prototype,"tabIdx",void 0);wy=n3([nn("wui-email-input")],wy);const CPe=Fn`
  wui-separator {
    margin: ${({spacing:t})=>t[3]} calc(${({spacing:t})=>t[3]} * -1);
    width: calc(100% + ${({spacing:t})=>t[3]} * 2);
  }

  wui-email-input {
    width: 100%;
  }

  form {
    width: 100%;
    display: block;
    position: relative;
  }

  wui-icon-link,
  wui-loading-spinner {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
  }

  wui-icon-link {
    right: ${({spacing:t})=>t[2]};
  }

  wui-loading-spinner {
    right: ${({spacing:t})=>t[3]};
  }

  wui-text {
    margin: ${({spacing:t})=>t[2]} ${({spacing:t})=>t[3]}
      ${({spacing:t})=>t[0]} ${({spacing:t})=>t[3]};
  }
`;var Fy=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Yf=class extends on{constructor(){super(),this.unsubscribe=[],this.formRef=JE(),this.email="",this.loading=!1,this.error="",this.remoteFeatures=ut.state.remoteFeatures,this.hasExceededUsageLimit=fn.state.plan.hasExceededUsageLimit,this.unsubscribe.push(ut.subscribeKey("remoteFeatures",e=>{this.remoteFeatures=e}),fn.subscribeKey("plan",e=>this.hasExceededUsageLimit=e.hasExceededUsageLimit))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}firstUpdated(){var e;(e=this.formRef.value)==null||e.addEventListener("keydown",n=>{n.key==="Enter"&&this.onSubmitEmail(n)})}render(){const e=Ht.hasAnyConnection(at.CONNECTOR_ID.AUTH);return we`
      <form ${QE(this.formRef)} @submit=${this.onSubmitEmail.bind(this)}>
        <wui-email-input
          @focus=${this.onFocusEvent.bind(this)}
          .disabled=${this.loading}
          @inputChange=${this.onEmailInputChange.bind(this)}
          tabIdx=${Tn(this.tabIdx)}
          ?disabled=${e||this.hasExceededUsageLimit}
        >
        </wui-email-input>

        ${this.submitButtonTemplate()}${this.loadingTemplate()}
        <input type="submit" hidden />
      </form>
      ${this.templateError()}
    `}submitButtonTemplate(){return!this.loading&&this.email.length>3?we`
          <wui-icon-link
            size="lg"
            icon="chevronRight"
            iconcolor="accent-100"
            @click=${this.onSubmitEmail.bind(this)}
          >
          </wui-icon-link>
        `:null}loadingTemplate(){return this.loading?we`<wui-loading-spinner size="md" color="accent-primary"></wui-loading-spinner>`:null}templateError(){return this.error?we`<wui-text variant="sm-medium" color="error">${this.error}</wui-text>`:null}onEmailInputChange(e){this.email=e.detail.trim(),this.error=""}async onSubmitEmail(e){var i;if(!Z1.isValidEmail(this.email)){Ts.open({displayMessage:vs.ALERT_WARNINGS.INVALID_EMAIL.displayMessage},"warning");return}if(!at.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(o=>o===ue.state.activeChain)){const o=ue.getFirstCaipNetworkSupportsAuthConnector();if(o){Pt.push("SwitchNetwork",{network:o});return}}try{if(this.loading)return;this.loading=!0,e.preventDefault();const o=Nt.getAuthConnector();if(!o)throw new Error("w3m-email-login-widget: Auth connector not found");const{action:l}=await o.provider.connectEmail({email:this.email});if(Sn.sendEvent({type:"track",event:"EMAIL_SUBMITTED"}),l==="VERIFY_OTP")Sn.sendEvent({type:"track",event:"EMAIL_VERIFICATION_CODE_SENT"}),Pt.push("EmailVerifyOtp",{email:this.email});else if(l==="VERIFY_DEVICE")Pt.push("EmailVerifyDevice",{email:this.email});else if(l==="CONNECT"){const h=(i=this.remoteFeatures)==null?void 0:i.multiWallet;await Ht.connectExternal(o,ue.state.activeChain),h?(Pt.replace("ProfileWallets"),Ji.showSuccess("New Wallet Added")):Pt.replace("Account")}}catch(o){const l=Ft.parseError(o);l!=null&&l.includes("Invalid email")?this.error="Invalid email. Try again.":Ji.showError(o)}finally{this.loading=!1}}onFocusEvent(){Sn.sendEvent({type:"track",event:"EMAIL_LOGIN_SELECTED"})}};Yf.styles=CPe;Fy([Fe()],Yf.prototype,"tabIdx",void 0);Fy([Lt()],Yf.prototype,"email",void 0);Fy([Lt()],Yf.prototype,"loading",void 0);Fy([Lt()],Yf.prototype,"error",void 0);Fy([Lt()],Yf.prototype,"remoteFeatures",void 0);Fy([Lt()],Yf.prototype,"hasExceededUsageLimit",void 0);Yf=Fy([nn("w3m-email-login-widget")],Yf);const TPe=Fn`
  label {
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    user-select: none;
    column-gap: ${({spacing:t})=>t[2]};
  }

  label > input[type='checkbox'] {
    height: 0;
    width: 0;
    opacity: 0;
    position: absolute;
  }

  label > span {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    border: 1px solid ${({colors:t})=>t.neutrals400};
    color: ${({colors:t})=>t.white};
    background-color: transparent;
    will-change: border-color, background-color;
  }

  label > span > wui-icon {
    opacity: 0;
    will-change: opacity;
  }

  label > input[type='checkbox']:checked + span > wui-icon {
    color: ${({colors:t})=>t.white};
  }

  label > input[type='checkbox']:not(:checked) > span > wui-icon {
    color: ${({colors:t})=>t.neutrals900};
  }

  label > input[type='checkbox']:checked + span > wui-icon {
    opacity: 1;
  }

  /* -- Sizes --------------------------------------------------- */
  label[data-size='lg'] > span {
    width: 24px;
    height: 24px;
    min-width: 24px;
    min-height: 24px;
    border-radius: ${({borderRadius:t})=>t[10]};
  }

  label[data-size='md'] > span {
    width: 20px;
    height: 20px;
    min-width: 20px;
    min-height: 20px;
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  label[data-size='sm'] > span {
    width: 16px;
    height: 16px;
    min-width: 16px;
    min-height: 16px;
    border-radius: ${({borderRadius:t})=>t[1]};
  }

  /* -- Focus states --------------------------------------------------- */
  label > input[type='checkbox']:focus-visible + span,
  label > input[type='checkbox']:focus + span {
    border: 1px solid ${({tokens:t})=>t.core.borderAccentPrimary};
    box-shadow: 0px 0px 0px 4px rgba(9, 136, 240, 0.2);
  }

  /* -- Checked states --------------------------------------------------- */
  label > input[type='checkbox']:checked + span {
    background-color: ${({tokens:t})=>t.core.iconAccentPrimary};
    border: 1px solid transparent;
  }

  /* -- Hover states --------------------------------------------------- */
  input[type='checkbox']:not(:checked):not(:disabled) + span:hover {
    border: 1px solid ${({colors:t})=>t.neutrals700};
    background-color: ${({colors:t})=>t.neutrals800};
    box-shadow: none;
  }

  input[type='checkbox']:checked:not(:disabled) + span:hover {
    border: 1px solid transparent;
    background-color: ${({colors:t})=>t.accent080};
    box-shadow: none;
  }

  /* -- Disabled state --------------------------------------------------- */
  label > input[type='checkbox']:checked:disabled + span {
    border: 1px solid transparent;
    opacity: 0.3;
  }

  label > input[type='checkbox']:not(:checked):disabled + span {
    border: 1px solid ${({colors:t})=>t.neutrals700};
  }

  label:has(input[type='checkbox']:disabled) {
    cursor: auto;
  }

  label > input[type='checkbox']:disabled + span {
    cursor: not-allowed;
  }
`;var mI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const APe={lg:"md",md:"sm",sm:"sm"};let ww=class extends on{constructor(){super(...arguments),this.inputElementRef=JE(),this.checked=void 0,this.disabled=!1,this.size="md"}render(){const e=APe[this.size];return we`
      <label data-size=${this.size}>
        <input
          ${QE(this.inputElementRef)}
          ?checked=${Tn(this.checked)}
          ?disabled=${this.disabled}
          type="checkbox"
          @change=${this.dispatchChangeEvent}
        />
        <span>
          <wui-icon name="checkmarkBold" size=${e}></wui-icon>
        </span>
        <slot></slot>
      </label>
    `}dispatchChangeEvent(){var e;this.dispatchEvent(new CustomEvent("checkboxChange",{detail:(e=this.inputElementRef.value)==null?void 0:e.checked,bubbles:!0,composed:!0}))}};ww.styles=[Ei,TPe];mI([Fe({type:Boolean})],ww.prototype,"checked",void 0);mI([Fe({type:Boolean})],ww.prototype,"disabled",void 0);mI([Fe()],ww.prototype,"size",void 0);ww=mI([nn("wui-checkbox")],ww);const SPe=Fn`
  :host {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  wui-checkbox {
    padding: ${({spacing:t})=>t[3]};
  }
  a {
    text-decoration: none;
    color: ${({tokens:t})=>t.theme.textSecondary};
    font-weight: 500;
  }
`;var pY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let rS=class extends on{constructor(){super(),this.unsubscribe=[],this.checked=F0.state.isLegalCheckboxChecked,this.unsubscribe.push(F0.subscribeKey("isLegalCheckboxChecked",e=>{this.checked=e}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){var o;const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state,i=(o=ut.state.features)==null?void 0:o.legalCheckbox;return!e&&!n||!i?null:we`
      <wui-checkbox
        ?checked=${this.checked}
        @checkboxChange=${this.onCheckboxChange.bind(this)}
        data-testid="wui-checkbox"
      >
        <wui-text color="secondary" variant="sm-regular" align="left">
          I agree to our ${this.termsTemplate()} ${this.andTemplate()} ${this.privacyTemplate()}
        </wui-text>
      </wui-checkbox>
    `}andTemplate(){const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state;return e&&n?"and":""}termsTemplate(){const{termsConditionsUrl:e}=ut.state;return e?we`<a rel="noreferrer" target="_blank" href=${e}>terms of service</a>`:null}privacyTemplate(){const{privacyPolicyUrl:e}=ut.state;return e?we`<a rel="noreferrer" target="_blank" href=${e}>privacy policy</a>`:null}onCheckboxChange(){F0.setIsLegalCheckboxChecked(!this.checked)}};rS.styles=[SPe];pY([Lt()],rS.prototype,"checked",void 0);rS=pY([nn("w3m-legal-checkbox")],rS);const IPe=Fn`
  :host {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    border-radius: ${({borderRadius:t})=>t[20]};
    overflow: hidden;
  }

  wui-icon {
    width: 100%;
    height: 100%;
  }
`;var mY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let sS=class extends on{constructor(){super(...arguments),this.logo="google"}render(){return we`<wui-icon color="inherit" size="inherit" name=${this.logo}></wui-icon> `}};sS.styles=[Ei,IPe];mY([Fe()],sS.prototype,"logo",void 0);sS=mY([nn("wui-logo")],sS);const PPe=Fn`
  :host {
    width: 100%;
  }

  button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: ${({spacing:t})=>t[3]};
    width: 100%;
    background-color: transparent;
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  wui-text {
    text-transform: capitalize;
  }

  @media (hover: hover) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    }
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`;var i3=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let by=class extends on{constructor(){super(...arguments),this.logo="google",this.name="Continue with google",this.disabled=!1}render(){return we`
      <button ?disabled=${this.disabled} tabindex=${Tn(this.tabIdx)}>
        <wui-flex gap="2" alignItems="center">
          <wui-image ?boxed=${!0} logo=${this.logo}></wui-image>
          <wui-text variant="lg-regular" color="primary">${this.name}</wui-text>
        </wui-flex>
        <wui-icon name="chevronRight" size="lg" color="default"></wui-icon>
      </button>
    `}};by.styles=[Ei,Kr,PPe];i3([Fe()],by.prototype,"logo",void 0);i3([Fe()],by.prototype,"name",void 0);i3([Fe()],by.prototype,"tabIdx",void 0);i3([Fe({type:Boolean})],by.prototype,"disabled",void 0);by=i3([nn("wui-list-social")],by);const RPe=Fn`
  :host {
    display: block;
    width: 100%;
  }

  button {
    width: 100%;
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  @media (hover: hover) {
    button:hover:enabled {
      background: ${({tokens:t})=>t.theme.foregroundSecondary};
    }
  }

  button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
`;var gI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let bw=class extends on{constructor(){super(...arguments),this.logo="google",this.disabled=!1,this.tabIdx=void 0}render(){return we`
      <button ?disabled=${this.disabled} tabindex=${Tn(this.tabIdx)}>
        <wui-icon size="xxl" name=${this.logo}></wui-icon>
      </button>
    `}};bw.styles=[Ei,Kr,RPe];gI([Fe()],bw.prototype,"logo",void 0);gI([Fe({type:Boolean})],bw.prototype,"disabled",void 0);gI([Fe()],bw.prototype,"tabIdx",void 0);bw=gI([nn("wui-logo-select")],bw);const OPe=Fn`
  wui-separator {
    margin: ${({spacing:t})=>t[3]} calc(${({spacing:t})=>t[3]} * -1)
      ${({spacing:t})=>t[3]} calc(${({spacing:t})=>t[3]} * -1);
    width: calc(100% + ${({spacing:t})=>t[3]} * 2);
  }
`;var ng=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const YU=2,XU=6;let Oh=class extends on{constructor(){super(),this.unsubscribe=[],this.walletGuide="get-started",this.tabIdx=void 0,this.connectors=Nt.state.connectors,this.remoteFeatures=ut.state.remoteFeatures,this.authConnector=this.connectors.find(e=>e.type==="AUTH"),this.isPwaLoading=!1,this.hasExceededUsageLimit=fn.state.plan.hasExceededUsageLimit,this.unsubscribe.push(Nt.subscribeKey("connectors",e=>{this.connectors=e,this.authConnector=this.connectors.find(n=>n.type==="AUTH")}),ut.subscribeKey("remoteFeatures",e=>this.remoteFeatures=e),fn.subscribeKey("plan",e=>this.hasExceededUsageLimit=e.hasExceededUsageLimit))}connectedCallback(){super.connectedCallback(),this.handlePwaFrameLoad()}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we`
      <wui-flex
        class="container"
        flexDirection="column"
        gap="2"
        data-testid="w3m-social-login-widget"
      >
        ${this.topViewTemplate()}${this.bottomViewTemplate()}
      </wui-flex>
    `}topViewTemplate(){var i;const e=this.walletGuide==="explore";let n=(i=this.remoteFeatures)==null?void 0:i.socials;return!n&&e?(n=hi.DEFAULT_SOCIALS,this.renderTopViewContent(n)):n?this.renderTopViewContent(n):null}renderTopViewContent(e){return e.length===2?we` <wui-flex gap="2">
        ${e.slice(0,YU).map(n=>we`<wui-logo-select
              data-testid=${`social-selector-${n}`}
              @click=${()=>{this.onSocialClick(n)}}
              logo=${n}
              tabIdx=${Tn(this.tabIdx)}
              ?disabled=${this.isPwaLoading||this.hasConnection()}
            ></wui-logo-select>`)}
      </wui-flex>`:we` <wui-list-button
      data-testid=${`social-selector-${e[0]}`}
      @click=${()=>{this.onSocialClick(e[0])}}
      size="lg"
      icon=${Tn(e[0])}
      text=${`Continue with ${us.capitalize(e[0])}`}
      tabIdx=${Tn(this.tabIdx)}
      ?disabled=${this.isPwaLoading||this.hasConnection()}
    ></wui-list-button>`}bottomViewTemplate(){var o;let e=(o=this.remoteFeatures)==null?void 0:o.socials;const n=this.walletGuide==="explore";return(!this.authConnector||!e||e.length===0)&&n&&(e=hi.DEFAULT_SOCIALS),!e||e.length<=YU?null:e&&e.length>XU?we`<wui-flex gap="2">
        ${e.slice(1,XU-1).map(l=>we`<wui-logo-select
              data-testid=${`social-selector-${l}`}
              @click=${()=>{this.onSocialClick(l)}}
              logo=${l}
              tabIdx=${Tn(this.tabIdx)}
              ?focusable=${this.tabIdx!==void 0&&this.tabIdx>=0}
              ?disabled=${this.isPwaLoading||this.hasConnection()}
            ></wui-logo-select>`)}
        <wui-logo-select
          logo="more"
          tabIdx=${Tn(this.tabIdx)}
          @click=${this.onMoreSocialsClick.bind(this)}
          ?disabled=${this.isPwaLoading||this.hasConnection()}
          data-testid="social-selector-more"
        ></wui-logo-select>
      </wui-flex>`:e?we`<wui-flex gap="2">
      ${e.slice(1,e.length).map(l=>we`<wui-logo-select
            data-testid=${`social-selector-${l}`}
            @click=${()=>{this.onSocialClick(l)}}
            logo=${l}
            tabIdx=${Tn(this.tabIdx)}
            ?focusable=${this.tabIdx!==void 0&&this.tabIdx>=0}
            ?disabled=${this.isPwaLoading||this.hasConnection()}
          ></wui-logo-select>`)}
    </wui-flex>`:null}onMoreSocialsClick(){Pt.push("ConnectSocials")}async onSocialClick(e){if(this.hasExceededUsageLimit){Pt.push("UsageExceeded");return}if(!at.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(i=>i===ue.state.activeChain)){const i=ue.getFirstCaipNetworkSupportsAuthConnector();if(i){Pt.push("SwitchNetwork",{network:i});return}}e&&await TIe(e)}async handlePwaFrameLoad(){var e;if(Ft.isPWA()){this.isPwaLoading=!0;try{((e=this.authConnector)==null?void 0:e.provider)instanceof gW&&await this.authConnector.provider.init()}catch(n){Ts.open({displayMessage:"Error loading embedded wallet in PWA",debugMessage:n.message},"error")}finally{this.isPwaLoading=!1}}}hasConnection(){return Ht.hasAnyConnection(at.CONNECTOR_ID.AUTH)}};Oh.styles=OPe;ng([Fe()],Oh.prototype,"walletGuide",void 0);ng([Fe()],Oh.prototype,"tabIdx",void 0);ng([Lt()],Oh.prototype,"connectors",void 0);ng([Lt()],Oh.prototype,"remoteFeatures",void 0);ng([Lt()],Oh.prototype,"authConnector",void 0);ng([Lt()],Oh.prototype,"isPwaLoading",void 0);ng([Lt()],Oh.prototype,"hasExceededUsageLimit",void 0);Oh=ng([nn("w3m-social-login-widget")],Oh);const kPe=Fn`
  :host {
    position: relative;
    border-radius: ${({borderRadius:t})=>t[2]};
    width: 40px;
    height: 40px;
    overflow: hidden;
    background: ${({tokens:t})=>t.theme.foregroundPrimary};
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    column-gap: ${({spacing:t})=>t[1]};
    padding: ${({spacing:t})=>t[1]};
  }

  :host > wui-wallet-image {
    width: 14px;
    height: 14px;
    border-radius: 2px;
  }
`;var gY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const fR=4;let oS=class extends on{constructor(){super(...arguments),this.walletImages=[]}render(){const e=this.walletImages.length<fR;return we`${this.walletImages.slice(0,fR).map(({src:n,walletName:i})=>we`
          <wui-wallet-image
            size="sm"
            imageSrc=${n}
            name=${Tn(i)}
          ></wui-wallet-image>
        `)}
    ${e?[...Array(fR-this.walletImages.length)].map(()=>we` <wui-wallet-image size="sm" name=""></wui-wallet-image>`):null} `}};oS.styles=[Ei,kPe];gY([Fe({type:Array})],oS.prototype,"walletImages",void 0);oS=gY([nn("wui-all-wallets-image")],oS);const DPe=Fn`
  :host {
    width: 100%;
  }

  button {
    column-gap: ${({spacing:t})=>t[2]};
    padding: ${({spacing:t})=>t[3]};
    width: 100%;
    background-color: transparent;
    border-radius: ${({borderRadius:t})=>t[4]};
    color: ${({tokens:t})=>t.theme.textPrimary};
  }

  button > wui-wallet-image {
    background: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  button > wui-text:nth-child(2) {
    display: flex;
    flex: 1;
  }

  button:hover:enabled {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  button[data-all-wallets='true'] {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  button[data-all-wallets='true']:hover:enabled {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  button:focus-visible:enabled {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    box-shadow: 0 0 0 4px ${({tokens:t})=>t.core.foregroundAccent020};
  }

  button:disabled {
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    opacity: 0.5;
    cursor: not-allowed;
  }

  button:disabled > wui-tag {
    background-color: ${({tokens:t})=>t.core.glass010};
    color: ${({tokens:t})=>t.theme.foregroundTertiary};
  }

  wui-flex.namespace-icon {
    width: 16px;
    height: 16px;
    border-radius: ${({borderRadius:t})=>t.round};
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
    box-shadow: 0 0 0 2px ${({tokens:t})=>t.theme.backgroundPrimary};
    transition: box-shadow var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2);
  }

  button:hover:enabled wui-flex.namespace-icon {
    box-shadow: 0 0 0 2px ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  wui-flex.namespace-icon > wui-icon {
    width: 10px;
    height: 10px;
  }

  wui-flex.namespace-icon:not(:first-child) {
    margin-left: -4px;
  }
`;var yl=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const NPe={eip155:"ethereum",solana:"solana",bip122:"bitcoin",polkadot:void 0,cosmos:void 0,sui:void 0,stacks:void 0,ton:"ton"};let rc=class extends on{constructor(){super(...arguments),this.walletImages=[],this.imageSrc="",this.name="",this.size="md",this.tabIdx=void 0,this.namespaces=[],this.disabled=!1,this.showAllWallets=!1,this.loading=!1,this.loadingSpinnerColor="accent-100"}render(){return this.dataset.size=this.size,we`
      <button
        ?disabled=${this.disabled}
        data-all-wallets=${this.showAllWallets}
        tabindex=${Tn(this.tabIdx)}
      >
        ${this.templateAllWallets()} ${this.templateWalletImage()}
        <wui-flex flexDirection="column" justifyContent="center" alignItems="flex-start" gap="1">
          <wui-text variant="lg-regular" color="inherit">${this.name}</wui-text>
          ${this.templateNamespaces()}
        </wui-flex>
        ${this.templateStatus()}
        <wui-icon name="chevronRight" size="lg" color="default"></wui-icon>
      </button>
    `}templateNamespaces(){var e;return(e=this.namespaces)!=null&&e.length?we`<wui-flex alignItems="center" gap="0">
        ${this.namespaces.map((n,i)=>{var o;return we`<wui-flex
              alignItems="center"
              justifyContent="center"
              zIndex=${(((o=this.namespaces)==null?void 0:o.length)??0)*2-i}
              class="namespace-icon"
            >
              <wui-icon
                name=${Tn(NPe[n])}
                size="sm"
                color="default"
              ></wui-icon>
            </wui-flex>`})}
      </wui-flex>`:null}templateAllWallets(){return this.showAllWallets&&this.imageSrc?we` <wui-all-wallets-image .imageeSrc=${this.imageSrc}> </wui-all-wallets-image> `:this.showAllWallets&&this.walletIcon?we` <wui-wallet-image .walletIcon=${this.walletIcon} size="sm"> </wui-wallet-image> `:null}templateWalletImage(){return!this.showAllWallets&&this.imageSrc?we`<wui-wallet-image
        size=${Tn(this.size==="sm"?"sm":"md")}
        imageSrc=${this.imageSrc}
        name=${this.name}
      ></wui-wallet-image>`:!this.showAllWallets&&!this.imageSrc?we`<wui-wallet-image size="sm" name=${this.name}></wui-wallet-image>`:null}templateStatus(){return this.loading?we`<wui-loading-spinner size="lg" color="accent-primary"></wui-loading-spinner>`:this.tagLabel&&this.tagVariant?we`<wui-tag size="sm" variant=${this.tagVariant}>${this.tagLabel}</wui-tag>`:null}};rc.styles=[Ei,Kr,DPe];yl([Fe({type:Array})],rc.prototype,"walletImages",void 0);yl([Fe()],rc.prototype,"imageSrc",void 0);yl([Fe()],rc.prototype,"name",void 0);yl([Fe()],rc.prototype,"size",void 0);yl([Fe()],rc.prototype,"tagLabel",void 0);yl([Fe()],rc.prototype,"tagVariant",void 0);yl([Fe()],rc.prototype,"walletIcon",void 0);yl([Fe()],rc.prototype,"tabIdx",void 0);yl([Fe({type:Array})],rc.prototype,"namespaces",void 0);yl([Fe({type:Boolean})],rc.prototype,"disabled",void 0);yl([Fe({type:Boolean})],rc.prototype,"showAllWallets",void 0);yl([Fe({type:Boolean})],rc.prototype,"loading",void 0);yl([Fe({type:String})],rc.prototype,"loadingSpinnerColor",void 0);rc=yl([nn("wui-list-wallet")],rc);var Ww=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let vy=class extends on{constructor(){super(),this.unsubscribe=[],this.tabIdx=void 0,this.connectors=Nt.state.connectors,this.count=fn.state.count,this.filteredCount=fn.state.filteredWallets.length,this.isFetchingRecommendedWallets=fn.state.isFetchingRecommendedWallets,this.unsubscribe.push(Nt.subscribeKey("connectors",e=>this.connectors=e),fn.subscribeKey("count",e=>this.count=e),fn.subscribeKey("filteredWallets",e=>this.filteredCount=e.length),fn.subscribeKey("isFetchingRecommendedWallets",e=>this.isFetchingRecommendedWallets=e))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){const e=this.connectors.find(x=>x.id==="walletConnect"),{allWallets:n}=ut.state;if(!e||n==="HIDE"||n==="ONLY_MOBILE"&&!Ft.isMobile())return null;const i=fn.state.featured.length,o=this.count+i,l=o<10?o:Math.floor(o/10)*10,h=this.filteredCount>0?this.filteredCount:l;let s=`${h}`;this.filteredCount>0?s=`${this.filteredCount}`:h<o&&(s=`${h}+`);const w=Ht.hasAnyConnection(at.CONNECTOR_ID.WALLET_CONNECT);return we`
      <wui-list-wallet
        name="Search Wallet"
        walletIcon="search"
        showAllWallets
        @click=${this.onAllWallets.bind(this)}
        tagLabel=${s}
        tagVariant="info"
        data-testid="all-wallets"
        tabIdx=${Tn(this.tabIdx)}
        .loading=${this.isFetchingRecommendedWallets}
        ?disabled=${w}
        size="sm"
      ></wui-list-wallet>
    `}onAllWallets(){var e;Sn.sendEvent({type:"track",event:"CLICK_ALL_WALLETS"}),Pt.push("AllWallets",{redirectView:(e=Pt.state.data)==null?void 0:e.redirectView})}};Ww([Fe()],vy.prototype,"tabIdx",void 0);Ww([Lt()],vy.prototype,"connectors",void 0);Ww([Lt()],vy.prototype,"count",void 0);Ww([Lt()],vy.prototype,"filteredCount",void 0);Ww([Lt()],vy.prototype,"isFetchingRecommendedWallets",void 0);vy=Ww([nn("w3m-all-wallets-widget")],vy);const MPe=Fn`
  :host {
    margin-top: ${({spacing:t})=>t[1]};
  }
  wui-separator {
    margin: ${({spacing:t})=>t[3]} calc(${({spacing:t})=>t[3]} * -1)
      ${({spacing:t})=>t[2]} calc(${({spacing:t})=>t[3]} * -1);
    width: calc(100% + ${({spacing:t})=>t[3]} * 2);
  }
`;var Hw=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Hm=class extends on{constructor(){super(),this.unsubscribe=[],this.explorerWallets=fn.state.explorerWallets,this.connections=Ht.state.connections,this.connectorImages=_o.state.connectorImages,this.loadingTelegram=!1,this.unsubscribe.push(Ht.subscribeKey("connections",e=>this.connections=e),_o.subscribeKey("connectorImages",e=>this.connectorImages=e),fn.subscribeKey("explorerFilteredWallets",e=>{this.explorerWallets=e!=null&&e.length?e:fn.state.explorerWallets}),fn.subscribeKey("explorerWallets",e=>{var n;(n=this.explorerWallets)!=null&&n.length||(this.explorerWallets=e)})),Ft.isTelegram()&&Ft.isIos()&&(this.loadingTelegram=!Ht.state.wcUri,this.unsubscribe.push(Ht.subscribeKey("wcUri",e=>this.loadingTelegram=!e)))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we`
      <wui-flex flexDirection="column" gap="2"> ${this.connectorListTemplate()} </wui-flex>
    `}connectorListTemplate(){return ia.connectorList().map((e,n)=>e.kind==="connector"?this.renderConnector(e,n):this.renderWallet(e,n))}getConnectorNamespaces(e){var n;return e.subtype==="walletConnect"?[]:e.subtype==="multiChain"?((n=e.connector.connectors)==null?void 0:n.map(i=>i.chain))||[]:[e.connector.chain]}renderConnector(e,n){var P,D;const i=e.connector,o=Ur.getConnectorImage(i)||this.connectorImages[(i==null?void 0:i.imageId)??""],h=(this.connections.get(i.chain)??[]).some(M=>no.isLowerCaseMatch(M.connectorId,i.id));let s,w;e.subtype==="walletConnect"?(s="qr code",w="accent"):e.subtype==="injected"||e.subtype==="announced"?(s=h?"connected":"installed",w=h?"info":"success"):(s=void 0,w=void 0);const x=Ht.hasAnyConnection(at.CONNECTOR_ID.WALLET_CONNECT),A=e.subtype==="walletConnect"||e.subtype==="external"?x:!1;return we`
      <w3m-list-wallet
        displayIndex=${n}
        imageSrc=${Tn(o)}
        .installed=${!0}
        name=${i.name??"Unknown"}
        .tagVariant=${w}
        tagLabel=${Tn(s)}
        data-testid=${`wallet-selector-${i.id.toLowerCase()}`}
        size="sm"
        @click=${()=>this.onClickConnector(e)}
        tabIdx=${Tn(this.tabIdx)}
        ?disabled=${A}
        rdnsId=${Tn(((P=i.explorerWallet)==null?void 0:P.rdns)||void 0)}
        walletRank=${Tn((D=i.explorerWallet)==null?void 0:D.order)}
        .namespaces=${this.getConnectorNamespaces(e)}
      >
      </w3m-list-wallet>
    `}onClickConnector(e){var i;const n=(i=Pt.state.data)==null?void 0:i.redirectView;if(e.subtype==="walletConnect"){Nt.setActiveConnector(e.connector),Ft.isMobile()?Pt.push("AllWallets"):Pt.push("ConnectingWalletConnect",{redirectView:n});return}if(e.subtype==="multiChain"){Nt.setActiveConnector(e.connector),Pt.push("ConnectingMultiChain",{redirectView:n});return}if(e.subtype==="injected"){Nt.setActiveConnector(e.connector),Pt.push("ConnectingExternal",{connector:e.connector,redirectView:n,wallet:e.connector.explorerWallet});return}if(e.subtype==="announced"){if(e.connector.id==="walletConnect"){Ft.isMobile()?Pt.push("AllWallets"):Pt.push("ConnectingWalletConnect",{redirectView:n});return}Pt.push("ConnectingExternal",{connector:e.connector,redirectView:n,wallet:e.connector.explorerWallet});return}Pt.push("ConnectingExternal",{connector:e.connector,redirectView:n})}renderWallet(e,n){const i=e.wallet,o=Ur.getWalletImage(i),h=Ht.hasAnyConnection(at.CONNECTOR_ID.WALLET_CONNECT),s=this.loadingTelegram,w=e.subtype==="recent"?"recent":void 0,x=e.subtype==="recent"?"info":void 0;return we`
      <w3m-list-wallet
        displayIndex=${n}
        imageSrc=${Tn(o)}
        name=${i.name??"Unknown"}
        @click=${()=>this.onClickWallet(e)}
        size="sm"
        data-testid=${`wallet-selector-${i.id}`}
        tabIdx=${Tn(this.tabIdx)}
        ?loading=${s}
        ?disabled=${h}
        rdnsId=${Tn(i.rdns||void 0)}
        walletRank=${Tn(i.order)}
        tagLabel=${Tn(w)}
        .tagVariant=${x}
      >
      </w3m-list-wallet>
    `}onClickWallet(e){var l;const n=(l=Pt.state.data)==null?void 0:l.redirectView,i=ue.state.activeChain;if(e.subtype==="featured"){Nt.selectWalletConnector(e.wallet);return}if(e.subtype==="recent"){if(this.loadingTelegram)return;Nt.selectWalletConnector(e.wallet);return}if(e.subtype==="custom"){if(this.loadingTelegram)return;Pt.push("ConnectingWalletConnect",{wallet:e.wallet,redirectView:n});return}if(this.loadingTelegram)return;const o=i?Nt.getConnector({id:e.wallet.id,namespace:i}):void 0;o?Pt.push("ConnectingExternal",{connector:o,redirectView:n}):Pt.push("ConnectingWalletConnect",{wallet:e.wallet,redirectView:n})}};Hm.styles=MPe;Hw([Fe({type:Number})],Hm.prototype,"tabIdx",void 0);Hw([Lt()],Hm.prototype,"explorerWallets",void 0);Hw([Lt()],Hm.prototype,"connections",void 0);Hw([Lt()],Hm.prototype,"connectorImages",void 0);Hw([Lt()],Hm.prototype,"loadingTelegram",void 0);Hm=Hw([nn("w3m-connector-list")],Hm);var yY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let RO=class extends on{constructor(){super(...arguments),this.tabIdx=void 0}render(){return we`
      <wui-flex flexDirection="column" gap="2">
        <w3m-connector-list tabIdx=${Tn(this.tabIdx)}></w3m-connector-list>
        <w3m-all-wallets-widget tabIdx=${Tn(this.tabIdx)}></w3m-all-wallets-widget>
      </wui-flex>
    `}};yY([Fe()],RO.prototype,"tabIdx",void 0);RO=yY([nn("w3m-wallet-login-list")],RO);const LPe=Fn`
  :host {
    --connect-scroll--top-opacity: 0;
    --connect-scroll--bottom-opacity: 0;
    --connect-mask-image: none;
  }

  .connect {
    max-height: clamp(360px, 470px, 80vh);
    scrollbar-width: none;
    overflow-y: scroll;
    overflow-x: hidden;
    transition: opacity ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: opacity;
    mask-image: var(--connect-mask-image);
  }

  .guide {
    transition: opacity ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: opacity;
  }

  .connect::-webkit-scrollbar {
    display: none;
  }

  .all-wallets {
    flex-flow: column;
  }

  .connect.disabled,
  .guide.disabled {
    opacity: 0.3;
    pointer-events: none;
    user-select: none;
  }

  wui-separator {
    margin: ${({spacing:t})=>t[3]} calc(${({spacing:t})=>t[3]} * -1);
    width: calc(100% + ${({spacing:t})=>t[3]} * 2);
  }
`;var Mu=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const BPe=470;let Nc=class extends on{constructor(){var e,n;super(),this.unsubscribe=[],this.connectors=Nt.state.connectors,this.authConnector=this.connectors.find(i=>i.type==="AUTH"),this.features=ut.state.features,this.remoteFeatures=ut.state.remoteFeatures,this.enableWallets=ut.state.enableWallets,this.noAdapters=ue.state.noAdapters,this.walletGuide="get-started",this.checked=F0.state.isLegalCheckboxChecked,this.isEmailEnabled=((e=this.remoteFeatures)==null?void 0:e.email)&&!ue.state.noAdapters,this.isSocialEnabled=((n=this.remoteFeatures)==null?void 0:n.socials)&&this.remoteFeatures.socials.length>0&&!ue.state.noAdapters,this.isAuthEnabled=this.checkIfAuthEnabled(this.connectors),this.unsubscribe.push(Nt.subscribeKey("connectors",i=>{this.connectors=i,this.authConnector=this.connectors.find(o=>o.type==="AUTH"),this.isAuthEnabled=this.checkIfAuthEnabled(this.connectors)}),ut.subscribeKey("features",i=>{this.features=i}),ut.subscribeKey("remoteFeatures",i=>{this.remoteFeatures=i,this.setEmailAndSocialEnableCheck(this.noAdapters,this.remoteFeatures)}),ut.subscribeKey("enableWallets",i=>this.enableWallets=i),ue.subscribeKey("noAdapters",i=>this.setEmailAndSocialEnableCheck(i,this.remoteFeatures)),F0.subscribeKey("isLegalCheckboxChecked",i=>this.checked=i))}disconnectedCallback(){var n,i;this.unsubscribe.forEach(o=>o()),(n=this.resizeObserver)==null||n.disconnect();const e=(i=this.shadowRoot)==null?void 0:i.querySelector(".connect");e==null||e.removeEventListener("scroll",this.handleConnectListScroll.bind(this))}firstUpdated(){var n,i;const e=(n=this.shadowRoot)==null?void 0:n.querySelector(".connect");e&&(requestAnimationFrame(this.handleConnectListScroll.bind(this)),e==null||e.addEventListener("scroll",this.handleConnectListScroll.bind(this)),this.resizeObserver=new ResizeObserver(()=>{this.handleConnectListScroll()}),(i=this.resizeObserver)==null||i.observe(e),this.handleConnectListScroll())}render(){var D;const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state,i=(D=ut.state.features)==null?void 0:D.legalCheckbox,h=!!(e||n)&&!!i&&this.walletGuide==="get-started"&&!this.checked,s={connect:!0,disabled:h},w=ut.state.enableWalletGuide,x=this.enableWallets,A=this.isSocialEnabled||this.authConnector,P=h?-1:void 0;return we`
      <wui-flex flexDirection="column">
        ${this.legalCheckboxTemplate()}
        <wui-flex
          data-testid="w3m-connect-scroll-view"
          flexDirection="column"
          .padding=${["0","0","4","0"]}
          class=${qD(s)}
        >
          <wui-flex
            class="connect-methods"
            flexDirection="column"
            gap="2"
            .padding=${A&&x&&w&&this.walletGuide==="get-started"?["0","3","0","3"]:["0","3","3","3"]}
          >
            ${this.renderConnectMethod(P)}
          </wui-flex>
        </wui-flex>
        ${this.reownBrandingTemplate()}
      </wui-flex>
    `}reownBrandingTemplate(){var e;return Z1.hasFooter()||!((e=this.remoteFeatures)!=null&&e.reownBranding)?null:we`<wui-ux-by-reown></wui-ux-by-reown>`}setEmailAndSocialEnableCheck(e,n){this.isEmailEnabled=(n==null?void 0:n.email)&&!e,this.isSocialEnabled=(n==null?void 0:n.socials)&&n.socials.length>0&&!e,this.remoteFeatures=n,this.noAdapters=e}checkIfAuthEnabled(e){const n=e.filter(o=>o.type===Ya.CONNECTOR_TYPE_AUTH).map(o=>o.chain);return at.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(o=>n.includes(o))}renderConnectMethod(e){const n=Fl.getConnectOrderMethod(this.features,this.connectors);return we`${n.map((i,o)=>{switch(i){case"email":return we`${this.emailTemplate(e)} ${this.separatorTemplate(o,"email")}`;case"social":return we`${this.socialListTemplate(e)}
          ${this.separatorTemplate(o,"social")}`;case"wallet":return we`${this.walletListTemplate(e)}
          ${this.separatorTemplate(o,"wallet")}`;default:return null}})}`}checkMethodEnabled(e){switch(e){case"wallet":return this.enableWallets;case"social":return this.isSocialEnabled&&this.isAuthEnabled;case"email":return this.isEmailEnabled&&this.isAuthEnabled;default:return null}}checkIsThereNextMethod(e){const i=Fl.getConnectOrderMethod(this.features,this.connectors)[e+1];return i?this.checkMethodEnabled(i)?i:this.checkIsThereNextMethod(e+1):void 0}separatorTemplate(e,n){const i=this.checkIsThereNextMethod(e),o=this.walletGuide==="explore";switch(n){case"wallet":return this.enableWallets&&i&&!o?we`<wui-separator data-testid="wui-separator" text="or"></wui-separator>`:null;case"email":{const l=i==="social";return this.isAuthEnabled&&this.isEmailEnabled&&!l&&i?we`<wui-separator
              data-testid="w3m-email-login-or-separator"
              text="or"
            ></wui-separator>`:null}case"social":{const l=i==="email";return this.isAuthEnabled&&this.isSocialEnabled&&!l&&i?we`<wui-separator data-testid="wui-separator" text="or"></wui-separator>`:null}default:return null}}emailTemplate(e){return!this.isEmailEnabled||!this.isAuthEnabled?null:we`<w3m-email-login-widget tabIdx=${Tn(e)}></w3m-email-login-widget>`}socialListTemplate(e){return!this.isSocialEnabled||!this.isAuthEnabled?null:we`<w3m-social-login-widget
      walletGuide=${this.walletGuide}
      tabIdx=${Tn(e)}
    ></w3m-social-login-widget>`}walletListTemplate(e){var s,w;const n=this.enableWallets,i=((s=this.features)==null?void 0:s.emailShowWallets)===!1,o=(w=this.features)==null?void 0:w.collapseWallets,l=i||o;return!n||(Ft.isTelegram()&&(Ft.isSafari()||Ft.isIos())&&Ht.connectWalletConnect().catch(x=>({})),this.walletGuide==="explore")?null:this.isAuthEnabled&&(this.isEmailEnabled||this.isSocialEnabled)&&l?we`<wui-list-button
        data-testid="w3m-collapse-wallets-button"
        tabIdx=${Tn(e)}
        @click=${this.onContinueWalletClick.bind(this)}
        text="Continue with a wallet"
        icon="wallet"
      ></wui-list-button>`:we`<w3m-wallet-login-list tabIdx=${Tn(e)}></w3m-wallet-login-list>`}legalCheckboxTemplate(){return this.walletGuide==="explore"?null:we`<w3m-legal-checkbox data-testid="w3m-legal-checkbox"></w3m-legal-checkbox>`}handleConnectListScroll(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector(".connect");if(!e)return;e.scrollHeight>BPe?(e.style.setProperty("--connect-mask-image",`linear-gradient(
          to bottom,
          rgba(0, 0, 0, calc(1 - var(--connect-scroll--top-opacity))) 0px,
          rgba(200, 200, 200, calc(1 - var(--connect-scroll--top-opacity))) 1px,
          black 100px,
          black calc(100% - 100px),
          rgba(155, 155, 155, calc(1 - var(--connect-scroll--bottom-opacity))) calc(100% - 1px),
          rgba(0, 0, 0, calc(1 - var(--connect-scroll--bottom-opacity))) 100%
        )`),e.style.setProperty("--connect-scroll--top-opacity",jA.interpolate([0,50],[0,1],e.scrollTop).toString()),e.style.setProperty("--connect-scroll--bottom-opacity",jA.interpolate([0,50],[0,1],e.scrollHeight-e.scrollTop-e.offsetHeight).toString())):(e.style.setProperty("--connect-mask-image","none"),e.style.setProperty("--connect-scroll--top-opacity","0"),e.style.setProperty("--connect-scroll--bottom-opacity","0"))}onContinueWalletClick(){Pt.push("ConnectWallets")}};Nc.styles=LPe;Mu([Lt()],Nc.prototype,"connectors",void 0);Mu([Lt()],Nc.prototype,"authConnector",void 0);Mu([Lt()],Nc.prototype,"features",void 0);Mu([Lt()],Nc.prototype,"remoteFeatures",void 0);Mu([Lt()],Nc.prototype,"enableWallets",void 0);Mu([Lt()],Nc.prototype,"noAdapters",void 0);Mu([Fe()],Nc.prototype,"walletGuide",void 0);Mu([Lt()],Nc.prototype,"checked",void 0);Mu([Lt()],Nc.prototype,"isEmailEnabled",void 0);Mu([Lt()],Nc.prototype,"isSocialEnabled",void 0);Mu([Lt()],Nc.prototype,"isAuthEnabled",void 0);Nc=Mu([nn("w3m-connect-view")],Nc);const FPe=Fn`
  :host {
    display: block;
    width: 100px;
    height: 100px;
  }

  svg {
    width: 100px;
    height: 100px;
  }

  rect {
    fill: none;
    stroke: ${t=>t.colors.accent100};
    stroke-width: 3px;
    stroke-linecap: round;
    animation: dash 1s linear infinite;
  }

  @keyframes dash {
    to {
      stroke-dashoffset: 0px;
    }
  }
`;var _Y=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let aS=class extends on{constructor(){super(...arguments),this.radius=36}render(){return this.svgLoaderTemplate()}svgLoaderTemplate(){const e=this.radius>50?50:this.radius,i=36-e,o=116+i,l=245+i,h=360+i*1.75;return we`
      <svg viewBox="0 0 110 110" width="110" height="110">
        <rect
          x="2"
          y="2"
          width="106"
          height="106"
          rx=${e}
          stroke-dasharray="${o} ${l}"
          stroke-dashoffset=${h}
        />
      </svg>
    `}};aS.styles=[Ei,FPe];_Y([Fe({type:Number})],aS.prototype,"radius",void 0);aS=_Y([nn("wui-loading-thumbnail")],aS);const $Pe=Fn`
  wui-flex {
    width: 100%;
    height: 52px;
    box-sizing: border-box;
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: ${({borderRadius:t})=>t[5]};
    padding-left: ${({spacing:t})=>t[3]};
    padding-right: ${({spacing:t})=>t[3]};
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: ${({spacing:t})=>t[6]};
  }

  wui-text {
    color: ${({tokens:t})=>t.theme.textSecondary};
  }

  wui-icon {
    width: 12px;
    height: 12px;
  }
`;var yI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let vw=class extends on{constructor(){super(...arguments),this.disabled=!1,this.label="",this.buttonLabel=""}render(){return we`
      <wui-flex justifyContent="space-between" alignItems="center">
        <wui-text variant="lg-regular" color="inherit">${this.label}</wui-text>
        <wui-button variant="accent-secondary" size="sm">
          ${this.buttonLabel}
          <wui-icon name="chevronRight" color="inherit" size="inherit" slot="iconRight"></wui-icon>
        </wui-button>
      </wui-flex>
    `}};vw.styles=[Ei,Kr,$Pe];yI([Fe({type:Boolean})],vw.prototype,"disabled",void 0);yI([Fe()],vw.prototype,"label",void 0);yI([Fe()],vw.prototype,"buttonLabel",void 0);vw=yI([nn("wui-cta-button")],vw);const zPe=Fn`
  :host {
    display: block;
    padding: 0 ${({spacing:t})=>t[5]} ${({spacing:t})=>t[5]};
  }
`;var wY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let cS=class extends on{constructor(){super(...arguments),this.wallet=void 0}render(){if(!this.wallet)return this.style.display="none",null;const{name:e,app_store:n,play_store:i,chrome_store:o,homepage:l}=this.wallet,h=Ft.isMobile(),s=Ft.isIos(),w=Ft.isAndroid(),x=[n,i,l,o].filter(Boolean).length>1,A=us.getTruncateString({string:e,charsStart:12,charsEnd:0,truncate:"end"});return x&&!h?we`
        <wui-cta-button
          label=${`Don't have ${A}?`}
          buttonLabel="Get"
          @click=${()=>Pt.push("Downloads",{wallet:this.wallet})}
        ></wui-cta-button>
      `:!x&&l?we`
        <wui-cta-button
          label=${`Don't have ${A}?`}
          buttonLabel="Get"
          @click=${this.onHomePage.bind(this)}
        ></wui-cta-button>
      `:n&&s?we`
        <wui-cta-button
          label=${`Don't have ${A}?`}
          buttonLabel="Get"
          @click=${this.onAppStore.bind(this)}
        ></wui-cta-button>
      `:i&&w?we`
        <wui-cta-button
          label=${`Don't have ${A}?`}
          buttonLabel="Get"
          @click=${this.onPlayStore.bind(this)}
        ></wui-cta-button>
      `:(this.style.display="none",null)}onAppStore(){var e;(e=this.wallet)!=null&&e.app_store&&Ft.openHref(this.wallet.app_store,"_blank")}onPlayStore(){var e;(e=this.wallet)!=null&&e.play_store&&Ft.openHref(this.wallet.play_store,"_blank")}onHomePage(){var e;(e=this.wallet)!=null&&e.homepage&&Ft.openHref(this.wallet.homepage,"_blank")}};cS.styles=[zPe];wY([Fe({type:Object})],cS.prototype,"wallet",void 0);cS=wY([nn("w3m-mobile-download-links")],cS);const UPe=Fn`
  @keyframes shake {
    0% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(3px);
    }
    50% {
      transform: translateX(-3px);
    }
    75% {
      transform: translateX(3px);
    }
    100% {
      transform: translateX(0);
    }
  }

  wui-flex:first-child:not(:only-child) {
    position: relative;
  }

  wui-wallet-image {
    width: 56px;
    height: 56px;
  }

  wui-loading-thumbnail {
    position: absolute;
  }

  wui-icon-box {
    position: absolute;
    right: calc(${({spacing:t})=>t[1]} * -1);
    bottom: calc(${({spacing:t})=>t[1]} * -1);
    opacity: 0;
    transform: scale(0.5);
    transition-property: opacity, transform;
    transition-duration: ${({durations:t})=>t.lg};
    transition-timing-function: ${({easings:t})=>t["ease-out-power-2"]};
    will-change: opacity, transform;
  }

  wui-text[align='center'] {
    width: 100%;
    padding: 0px ${({spacing:t})=>t[4]};
  }

  [data-error='true'] wui-icon-box {
    opacity: 1;
    transform: scale(1);
  }

  [data-error='true'] > wui-flex:first-child {
    animation: shake 250ms ${({easings:t})=>t["ease-out-power-2"]} both;
  }

  [data-retry='false'] wui-link {
    display: none;
  }

  [data-retry='true'] wui-link {
    display: block;
    opacity: 1;
  }

  w3m-mobile-download-links {
    padding: 0px;
    width: 100%;
  }
`;var Sd=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};class ca extends on{constructor(){var e,n,i,o,l;super(),this.wallet=(e=Pt.state.data)==null?void 0:e.wallet,this.connector=(n=Pt.state.data)==null?void 0:n.connector,this.timeout=void 0,this.secondaryBtnIcon="refresh",this.onConnect=void 0,this.onRender=void 0,this.onAutoConnect=void 0,this.isWalletConnect=!0,this.unsubscribe=[],this.imageSrc=Ur.getConnectorImage(this.connector)??Ur.getWalletImage(this.wallet),this.name=((i=this.wallet)==null?void 0:i.name)??((o=this.connector)==null?void 0:o.name)??"Wallet",this.isRetrying=!1,this.uri=Ht.state.wcUri,this.error=Ht.state.wcError,this.ready=!1,this.showRetry=!1,this.label=void 0,this.secondaryBtnLabel="Try again",this.secondaryLabel="Accept connection request in the wallet",this.isLoading=!1,this.isMobile=!1,this.onRetry=void 0,this.unsubscribe.push(Ht.subscribeKey("wcUri",h=>{var s;this.uri=h,this.isRetrying&&this.onRetry&&(this.isRetrying=!1,(s=this.onConnect)==null||s.call(this))}),Ht.subscribeKey("wcError",h=>this.error=h)),(Ft.isTelegram()||Ft.isSafari())&&Ft.isIos()&&Ht.state.wcUri&&((l=this.onConnect)==null||l.call(this))}firstUpdated(){var e;(e=this.onAutoConnect)==null||e.call(this),this.showRetry=!this.onAutoConnect}disconnectedCallback(){this.unsubscribe.forEach(e=>e()),Ht.setWcError(!1),clearTimeout(this.timeout)}render(){var i;(i=this.onRender)==null||i.call(this),this.onShowRetry();const e=this.error?"Connection can be declined if a previous request is still active":this.secondaryLabel;let n="";return this.label?n=this.label:(n=`Continue in ${this.name}`,this.error&&(n="Connection declined")),we`
      <wui-flex
        data-error=${Tn(this.error)}
        data-retry=${this.showRetry}
        flexDirection="column"
        alignItems="center"
        .padding=${["10","5","5","5"]}
        gap="6"
      >
        <wui-flex gap="2" justifyContent="center" alignItems="center">
          <wui-wallet-image size="lg" imageSrc=${Tn(this.imageSrc)}></wui-wallet-image>

          ${this.error?null:this.loaderTemplate()}

          <wui-icon-box
            color="error"
            icon="close"
            size="sm"
            border
            borderColor="wui-color-bg-125"
          ></wui-icon-box>
        </wui-flex>

        <wui-flex flexDirection="column" alignItems="center" gap="6"> <wui-flex
          flexDirection="column"
          alignItems="center"
          gap="2"
          .padding=${["2","0","0","0"]}
        >
          <wui-text align="center" variant="lg-medium" color=${this.error?"error":"primary"}>
            ${n}
          </wui-text>
          <wui-text align="center" variant="lg-regular" color="secondary">${e}</wui-text>
        </wui-flex>

        ${this.secondaryBtnLabel?we`
                <wui-button
                  variant="neutral-secondary"
                  size="md"
                  ?disabled=${this.isRetrying||this.isLoading}
                  @click=${this.onTryAgain.bind(this)}
                  data-testid="w3m-connecting-widget-secondary-button"
                >
                  <wui-icon
                    color="inherit"
                    slot="iconLeft"
                    name=${this.secondaryBtnIcon}
                  ></wui-icon>
                  ${this.secondaryBtnLabel}
                </wui-button>
              `:null}
      </wui-flex>

      ${this.isWalletConnect?we`
              <wui-flex .padding=${["0","5","5","5"]} justifyContent="center">
                <wui-link
                  @click=${this.onCopyUri}
                  variant="secondary"
                  icon="copy"
                  data-testid="wui-link-copy"
                >
                  Copy link
                </wui-link>
              </wui-flex>
            `:null}

      <w3m-mobile-download-links .wallet=${this.wallet}></w3m-mobile-download-links></wui-flex>
      </wui-flex>
    `}onShowRetry(){var e;if(this.error&&!this.showRetry){this.showRetry=!0;const n=(e=this.shadowRoot)==null?void 0:e.querySelector("wui-button");n==null||n.animate([{opacity:0},{opacity:1}],{fill:"forwards",easing:"ease"})}}onTryAgain(){var e,n;Ht.setWcError(!1),this.onRetry?(this.isRetrying=!0,(e=this.onRetry)==null||e.call(this)):(n=this.onConnect)==null||n.call(this)}loaderTemplate(){const e=ra.state.themeVariables["--w3m-border-radius-master"],n=e?parseInt(e.replace("px",""),10):4;return we`<wui-loading-thumbnail radius=${n*9}></wui-loading-thumbnail>`}onCopyUri(){try{this.uri&&(Ft.copyToClopboard(this.uri),Ji.showSuccess("Link copied"))}catch{Ji.showError("Failed to copy")}}}ca.styles=UPe;Sd([Lt()],ca.prototype,"isRetrying",void 0);Sd([Lt()],ca.prototype,"uri",void 0);Sd([Lt()],ca.prototype,"error",void 0);Sd([Lt()],ca.prototype,"ready",void 0);Sd([Lt()],ca.prototype,"showRetry",void 0);Sd([Lt()],ca.prototype,"label",void 0);Sd([Lt()],ca.prototype,"secondaryBtnLabel",void 0);Sd([Lt()],ca.prototype,"secondaryLabel",void 0);Sd([Lt()],ca.prototype,"isLoading",void 0);Sd([Fe({type:Boolean})],ca.prototype,"isMobile",void 0);Sd([Fe()],ca.prototype,"onRetry",void 0);var jPe=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let OO=class extends ca{constructor(){var n,i,o,l,h;if(super(),this.externalViewUnsubscribe=[],this.connectionsByNamespace=Ht.getConnections((n=this.connector)==null?void 0:n.chain),this.hasMultipleConnections=this.connectionsByNamespace.length>0,this.remoteFeatures=ut.state.remoteFeatures,this.currentActiveConnectorId=Nt.state.activeConnectorIds[(i=this.connector)==null?void 0:i.chain],!this.connector)throw new Error("w3m-connecting-view: No connector provided");const e=(o=this.connector)==null?void 0:o.chain;this.isAlreadyConnected(this.connector)&&(this.secondaryBtnLabel=void 0,this.label=`This account is already linked, change your account in ${this.connector.name}`,this.secondaryLabel=`To link a new account, open ${this.connector.name} and switch to the account you want to link`),Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:this.connector.name??"Unknown",platform:"browser",displayIndex:(l=this.wallet)==null?void 0:l.display_index,walletRank:(h=this.wallet)==null?void 0:h.order,view:Pt.state.view}}),this.onConnect=this.onConnectProxy.bind(this),this.onAutoConnect=this.onConnectProxy.bind(this),this.isWalletConnect=!1,this.externalViewUnsubscribe.push(Nt.subscribeKey("activeConnectorIds",s=>{var P;const w=s[e],x=(P=this.remoteFeatures)==null?void 0:P.multiWallet,{redirectView:A}=Pt.state.data??{};w!==this.currentActiveConnectorId&&(this.hasMultipleConnections&&x?(Pt.replace("ProfileWallets"),Ji.showSuccess("New Wallet Added")):A?Pt.replace(A):gi.close())}),Ht.subscribeKey("connections",this.onConnectionsChange.bind(this)))}disconnectedCallback(){this.externalViewUnsubscribe.forEach(e=>e())}async onConnectProxy(){try{if(this.error=!1,this.connector){if(this.isAlreadyConnected(this.connector))return;(this.connector.id!==at.CONNECTOR_ID.COINBASE_SDK||!this.error)&&await Ht.connectExternal(this.connector,this.connector.chain)}}catch(e){e instanceof Sh&&e.originalName===nl.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST?Sn.sendEvent({type:"track",event:"USER_REJECTED",properties:{message:e.message}}):Sn.sendEvent({type:"track",event:"CONNECT_ERROR",properties:{message:(e==null?void 0:e.message)??"Unknown"}}),this.error=!0}}onConnectionsChange(e){var n,i;if((n=this.connector)!=null&&n.chain&&e.get(this.connector.chain)&&this.isAlreadyConnected(this.connector)){const o=e.get(this.connector.chain)??[],l=(i=this.remoteFeatures)==null?void 0:i.multiWallet;if(o.length===0)Pt.replace("Connect");else{const h=Bl.getConnectionsByConnectorId(this.connectionsByNamespace,this.connector.id).flatMap(w=>w.accounts),s=Bl.getConnectionsByConnectorId(o,this.connector.id).flatMap(w=>w.accounts);s.length===0?this.hasMultipleConnections&&l?(Pt.replace("ProfileWallets"),Ji.showSuccess("Wallet deleted")):gi.close():!h.every(x=>s.some(A=>no.isLowerCaseMatch(x.address,A.address)))&&l&&Pt.replace("ProfileWallets")}}}isAlreadyConnected(e){return!!e&&this.connectionsByNamespace.some(n=>no.isLowerCaseMatch(n.connectorId,e.id))}};OO=jPe([nn("w3m-connecting-external-view")],OO);const VPe=rs`
  wui-flex,
  wui-list-wallet {
    width: 100%;
  }
`;var bY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Q2=class extends on{constructor(){super(),this.unsubscribe=[],this.activeConnector=Nt.state.activeConnector,this.unsubscribe.push(Nt.subscribeKey("activeConnector",e=>this.activeConnector=e))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){var e;return we`
      <wui-flex
        flexDirection="column"
        alignItems="center"
        .padding=${["3","5","5","5"]}
        gap="5"
      >
        <wui-flex justifyContent="center" alignItems="center">
          <wui-wallet-image
            size="lg"
            imageSrc=${Tn(Ur.getConnectorImage(this.activeConnector))}
          ></wui-wallet-image>
        </wui-flex>
        <wui-flex
          flexDirection="column"
          alignItems="center"
          gap="2"
          .padding=${["0","3","0","3"]}
        >
          <wui-text variant="lg-medium" color="primary">
            Select Chain for ${(e=this.activeConnector)==null?void 0:e.name}
          </wui-text>
          <wui-text align="center" variant="lg-regular" color="secondary"
            >Select which chain to connect to your multi chain wallet</wui-text
          >
        </wui-flex>
        <wui-flex
          flexGrow="1"
          flexDirection="column"
          alignItems="center"
          gap="2"
          .padding=${["2","0","2","0"]}
        >
          ${this.networksTemplate()}
        </wui-flex>
      </wui-flex>
    `}networksTemplate(){var e,n;return(n=(e=this.activeConnector)==null?void 0:e.connectors)==null?void 0:n.map((i,o)=>{var l;return i.name?we`
            <w3m-list-wallet
              displayIndex=${o}
              imageSrc=${Tn(Ur.getChainImage(i.chain))}
              name=${at.CHAIN_NAME_MAP[i.chain]}
              @click=${()=>this.onConnector(i)}
              size="sm"
              data-testid="wui-list-chain-${i.chain}"
              rdnsId=${(l=i.explorerWallet)==null?void 0:l.rdns}
            ></w3m-list-wallet>
          `:null})}onConnector(e){var o,l,h,s;const n=(l=(o=this.activeConnector)==null?void 0:o.connectors)==null?void 0:l.find(w=>w.chain===e.chain),i=(h=Pt.state.data)==null?void 0:h.redirectView;if(!n){Ji.showError("Failed to find connector");return}n.id==="walletConnect"?Ft.isMobile()?Pt.push("AllWallets"):Pt.push("ConnectingWalletConnect",{redirectView:i}):Pt.push("ConnectingExternal",{connector:n,redirectView:i,wallet:(s=this.activeConnector)==null?void 0:s.explorerWallet})}};Q2.styles=VPe;bY([Lt()],Q2.prototype,"activeConnector",void 0);Q2=bY([nn("w3m-connecting-multi-chain-view")],Q2);var tN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let lS=class extends on{constructor(){super(...arguments),this.platformTabs=[],this.unsubscribe=[],this.platforms=[],this.onSelectPlatfrom=void 0}disconnectCallback(){this.unsubscribe.forEach(e=>e())}render(){const e=this.generateTabs();return we`
      <wui-flex justifyContent="center" .padding=${["0","0","4","0"]}>
        <wui-tabs .tabs=${e} .onTabChange=${this.onTabChange.bind(this)}></wui-tabs>
      </wui-flex>
    `}generateTabs(){const e=this.platforms.map(n=>n==="browser"?{label:"Browser",icon:"extension",platform:"browser"}:n==="mobile"?{label:"Mobile",icon:"mobile",platform:"mobile"}:n==="qrcode"?{label:"Mobile",icon:"mobile",platform:"qrcode"}:n==="web"?{label:"Webapp",icon:"browser",platform:"web"}:n==="desktop"?{label:"Desktop",icon:"desktop",platform:"desktop"}:{label:"Browser",icon:"extension",platform:"unsupported"});return this.platformTabs=e.map(({platform:n})=>n),e}onTabChange(e){var i;const n=this.platformTabs[e];n&&((i=this.onSelectPlatfrom)==null||i.call(this,n))}};tN([Fe({type:Array})],lS.prototype,"platforms",void 0);tN([Fe()],lS.prototype,"onSelectPlatfrom",void 0);lS=tN([nn("w3m-connecting-header")],lS);var WPe=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let JU=class extends ca{constructor(){var e;if(super(),!this.wallet)throw new Error("w3m-connecting-wc-browser: No wallet provided");this.onConnect=this.onConnectProxy.bind(this),this.onAutoConnect=this.onConnectProxy.bind(this),Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:this.wallet.name,platform:"browser",displayIndex:(e=this.wallet)==null?void 0:e.display_index,walletRank:this.wallet.order,view:Pt.state.view}})}async onConnectProxy(){try{this.error=!1;const{connectors:e}=Nt.state,n=e.find(i=>{var o,l,h;return i.type==="ANNOUNCED"&&((o=i.info)==null?void 0:o.rdns)===((l=this.wallet)==null?void 0:l.rdns)||i.type==="INJECTED"||i.name===((h=this.wallet)==null?void 0:h.name)});if(n)await Ht.connectExternal(n,n.chain);else throw new Error("w3m-connecting-wc-browser: No connector found");gi.close()}catch(e){e instanceof Sh&&e.originalName===nl.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST?Sn.sendEvent({type:"track",event:"USER_REJECTED",properties:{message:e.message}}):Sn.sendEvent({type:"track",event:"CONNECT_ERROR",properties:{message:(e==null?void 0:e.message)??"Unknown"}}),this.error=!0}}};JU=WPe([nn("w3m-connecting-wc-browser")],JU);var HPe=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let QU=class extends ca{constructor(){var e;if(super(),!this.wallet)throw new Error("w3m-connecting-wc-desktop: No wallet provided");this.onConnect=this.onConnectProxy.bind(this),this.onRender=this.onRenderProxy.bind(this),Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:this.wallet.name,platform:"desktop",displayIndex:(e=this.wallet)==null?void 0:e.display_index,walletRank:this.wallet.order,view:Pt.state.view}})}onRenderProxy(){var e;!this.ready&&this.uri&&(this.ready=!0,(e=this.onConnect)==null||e.call(this))}onConnectProxy(){var e;if((e=this.wallet)!=null&&e.desktop_link&&this.uri)try{this.error=!1;const{desktop_link:n,name:i}=this.wallet,{redirect:o,href:l}=Ft.formatNativeUrl(n,this.uri);Ht.setWcLinking({name:i,href:l}),Ht.setRecentWallet(this.wallet),Ft.openHref(o,"_blank")}catch{this.error=!0}}};QU=HPe([nn("w3m-connecting-wc-desktop")],QU);var Gw=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let xy=class extends ca{constructor(){var e;if(super(),this.btnLabelTimeout=void 0,this.redirectDeeplink=void 0,this.redirectUniversalLink=void 0,this.target=void 0,this.preferUniversalLinks=ut.state.experimental_preferUniversalLinks,this.isLoading=!0,this.onConnect=()=>{Bl.onConnectMobile(this.wallet)},!this.wallet)throw new Error("w3m-connecting-wc-mobile: No wallet provided");this.secondaryBtnLabel="Open",this.secondaryLabel=hi.CONNECT_LABELS.MOBILE,this.secondaryBtnIcon="externalLink",this.onHandleURI(),this.unsubscribe.push(Ht.subscribeKey("wcUri",()=>{this.onHandleURI()})),Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:this.wallet.name,platform:"mobile",displayIndex:(e=this.wallet)==null?void 0:e.display_index,walletRank:this.wallet.order,view:Pt.state.view}})}disconnectedCallback(){super.disconnectedCallback(),clearTimeout(this.btnLabelTimeout)}onHandleURI(){var e;this.isLoading=!this.uri,!this.ready&&this.uri&&(this.ready=!0,(e=this.onConnect)==null||e.call(this))}onTryAgain(){var e;Ht.setWcError(!1),(e=this.onConnect)==null||e.call(this)}};Gw([Lt()],xy.prototype,"redirectDeeplink",void 0);Gw([Lt()],xy.prototype,"redirectUniversalLink",void 0);Gw([Lt()],xy.prototype,"target",void 0);Gw([Lt()],xy.prototype,"preferUniversalLinks",void 0);Gw([Lt()],xy.prototype,"isLoading",void 0);xy=Gw([nn("w3m-connecting-wc-mobile")],xy);var r3={},GPe=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},vY={},ql={};let nN;const qPe=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];ql.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};ql.getSymbolTotalCodewords=function(e){return qPe[e]};ql.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};ql.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');nN=e};ql.isKanjiModeEnabled=function(){return typeof nN<"u"};ql.toSJIS=function(e){return nN(e)};var _I={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},t.from=function(i,o){if(t.isValid(i))return i;try{return e(i)}catch{return o}}})(_I);function xY(){this.buffer=[],this.length=0}xY.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let n=0;n<e;n++)this.putBit((t>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var ZPe=xY;function s3(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}s3.prototype.set=function(t,e,n,i){const o=t*this.size+e;this.data[o]=n,i&&(this.reservedBit[o]=!0)};s3.prototype.get=function(t,e){return this.data[t*this.size+e]};s3.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n};s3.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var KPe=s3,EY={};(function(t){const e=ql.getSymbolSize;t.getRowColCoords=function(i){if(i===1)return[];const o=Math.floor(i/7)+2,l=e(i),h=l===145?26:Math.ceil((l-13)/(2*o-2))*2,s=[l-7];for(let w=1;w<o-1;w++)s[w]=s[w-1]-h;return s.push(6),s.reverse()},t.getPositions=function(i){const o=[],l=t.getRowColCoords(i),h=l.length;for(let s=0;s<h;s++)for(let w=0;w<h;w++)s===0&&w===0||s===0&&w===h-1||s===h-1&&w===0||o.push([l[s],l[w]]);return o}})(EY);var CY={};const YPe=ql.getSymbolSize,ej=7;CY.getPositions=function(e){const n=YPe(e);return[[0,0],[n-ej,0],[0,n-ej]]};var TY={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},t.from=function(o){return t.isValid(o)?parseInt(o,10):void 0},t.getPenaltyN1=function(o){const l=o.size;let h=0,s=0,w=0,x=null,A=null;for(let P=0;P<l;P++){s=w=0,x=A=null;for(let D=0;D<l;D++){let M=o.get(P,D);M===x?s++:(s>=5&&(h+=e.N1+(s-5)),x=M,s=1),M=o.get(D,P),M===A?w++:(w>=5&&(h+=e.N1+(w-5)),A=M,w=1)}s>=5&&(h+=e.N1+(s-5)),w>=5&&(h+=e.N1+(w-5))}return h},t.getPenaltyN2=function(o){const l=o.size;let h=0;for(let s=0;s<l-1;s++)for(let w=0;w<l-1;w++){const x=o.get(s,w)+o.get(s,w+1)+o.get(s+1,w)+o.get(s+1,w+1);(x===4||x===0)&&h++}return h*e.N2},t.getPenaltyN3=function(o){const l=o.size;let h=0,s=0,w=0;for(let x=0;x<l;x++){s=w=0;for(let A=0;A<l;A++)s=s<<1&2047|o.get(x,A),A>=10&&(s===1488||s===93)&&h++,w=w<<1&2047|o.get(A,x),A>=10&&(w===1488||w===93)&&h++}return h*e.N3},t.getPenaltyN4=function(o){let l=0;const h=o.data.length;for(let w=0;w<h;w++)l+=o.data[w];return Math.abs(Math.ceil(l*100/h/5)-10)*e.N4};function n(i,o,l){switch(i){case t.Patterns.PATTERN000:return(o+l)%2===0;case t.Patterns.PATTERN001:return o%2===0;case t.Patterns.PATTERN010:return l%3===0;case t.Patterns.PATTERN011:return(o+l)%3===0;case t.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(l/3))%2===0;case t.Patterns.PATTERN101:return o*l%2+o*l%3===0;case t.Patterns.PATTERN110:return(o*l%2+o*l%3)%2===0;case t.Patterns.PATTERN111:return(o*l%3+(o+l)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}t.applyMask=function(o,l){const h=l.size;for(let s=0;s<h;s++)for(let w=0;w<h;w++)l.isReserved(w,s)||l.xor(w,s,n(o,w,s))},t.getBestMask=function(o,l){const h=Object.keys(t.Patterns).length;let s=0,w=1/0;for(let x=0;x<h;x++){l(x),t.applyMask(x,o);const A=t.getPenaltyN1(o)+t.getPenaltyN2(o)+t.getPenaltyN3(o)+t.getPenaltyN4(o);t.applyMask(x,o),A<w&&(w=A,s=x)}return s}})(TY);var wI={};const bm=_I,CT=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],TT=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];wI.getBlocksCount=function(e,n){switch(n){case bm.L:return CT[(e-1)*4+0];case bm.M:return CT[(e-1)*4+1];case bm.Q:return CT[(e-1)*4+2];case bm.H:return CT[(e-1)*4+3];default:return}};wI.getTotalCodewordsCount=function(e,n){switch(n){case bm.L:return TT[(e-1)*4+0];case bm.M:return TT[(e-1)*4+1];case bm.Q:return TT[(e-1)*4+2];case bm.H:return TT[(e-1)*4+3];default:return}};var AY={},bI={};const Yx=new Uint8Array(512),uS=new Uint8Array(256);(function(){let e=1;for(let n=0;n<255;n++)Yx[n]=e,uS[e]=n,e<<=1,e&256&&(e^=285);for(let n=255;n<512;n++)Yx[n]=Yx[n-255]})();bI.log=function(e){if(e<1)throw new Error("log("+e+")");return uS[e]};bI.exp=function(e){return Yx[e]};bI.mul=function(e,n){return e===0||n===0?0:Yx[uS[e]+uS[n]]};(function(t){const e=bI;t.mul=function(i,o){const l=new Uint8Array(i.length+o.length-1);for(let h=0;h<i.length;h++)for(let s=0;s<o.length;s++)l[h+s]^=e.mul(i[h],o[s]);return l},t.mod=function(i,o){let l=new Uint8Array(i);for(;l.length-o.length>=0;){const h=l[0];for(let w=0;w<o.length;w++)l[w]^=e.mul(o[w],h);let s=0;for(;s<l.length&&l[s]===0;)s++;l=l.slice(s)}return l},t.generateECPolynomial=function(i){let o=new Uint8Array([1]);for(let l=0;l<i;l++)o=t.mul(o,new Uint8Array([1,e.exp(l)]));return o}})(AY);const SY=AY;function iN(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}iN.prototype.initialize=function(e){this.degree=e,this.genPoly=SY.generateECPolynomial(this.degree)};iN.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(e.length+this.degree);n.set(e);const i=SY.mod(n,this.genPoly),o=this.degree-i.length;if(o>0){const l=new Uint8Array(this.degree);return l.set(i,o),l}return i};var XPe=iN,IY={},ig={},rN={};rN.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var Fh={};const PY="[0-9]+",JPe="[A-Z $%*+\\-./:]+";let eE="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";eE=eE.replace(/u/g,"\\u");const QPe="(?:(?![A-Z0-9 $%*+\\-./:]|"+eE+`)(?:.|[\r
]))+`;Fh.KANJI=new RegExp(eE,"g");Fh.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Fh.BYTE=new RegExp(QPe,"g");Fh.NUMERIC=new RegExp(PY,"g");Fh.ALPHANUMERIC=new RegExp(JPe,"g");const eRe=new RegExp("^"+eE+"$"),tRe=new RegExp("^"+PY+"$"),nRe=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Fh.testKanji=function(e){return eRe.test(e)};Fh.testNumeric=function(e){return tRe.test(e)};Fh.testAlphanumeric=function(e){return nRe.test(e)};(function(t){const e=rN,n=Fh;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(l,h){if(!l.ccBits)throw new Error("Invalid mode: "+l);if(!e.isValid(h))throw new Error("Invalid version: "+h);return h>=1&&h<10?l.ccBits[0]:h<27?l.ccBits[1]:l.ccBits[2]},t.getBestModeForData=function(l){return n.testNumeric(l)?t.NUMERIC:n.testAlphanumeric(l)?t.ALPHANUMERIC:n.testKanji(l)?t.KANJI:t.BYTE},t.toString=function(l){if(l&&l.id)return l.id;throw new Error("Invalid mode")},t.isValid=function(l){return l&&l.bit&&l.ccBits};function i(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+o)}}t.from=function(l,h){if(t.isValid(l))return l;try{return i(l)}catch{return h}}})(ig);(function(t){const e=ql,n=wI,i=_I,o=ig,l=rN,h=7973,s=e.getBCHDigit(h);function w(D,M,z){for(let U=1;U<=40;U++)if(M<=t.getCapacity(U,z,D))return U}function x(D,M){return o.getCharCountIndicator(D,M)+4}function A(D,M){let z=0;return D.forEach(function(U){const G=x(U.mode,M);z+=G+U.getBitsLength()}),z}function P(D,M){for(let z=1;z<=40;z++)if(A(D,z)<=t.getCapacity(z,M,o.MIXED))return z}t.from=function(M,z){return l.isValid(M)?parseInt(M,10):z},t.getCapacity=function(M,z,U){if(!l.isValid(M))throw new Error("Invalid QR Code version");typeof U>"u"&&(U=o.BYTE);const G=e.getSymbolTotalCodewords(M),ne=n.getTotalCodewordsCount(M,z),oe=(G-ne)*8;if(U===o.MIXED)return oe;const Q=oe-x(U,M);switch(U){case o.NUMERIC:return Math.floor(Q/10*3);case o.ALPHANUMERIC:return Math.floor(Q/11*2);case o.KANJI:return Math.floor(Q/13);case o.BYTE:default:return Math.floor(Q/8)}},t.getBestVersionForData=function(M,z){let U;const G=i.from(z,i.M);if(Array.isArray(M)){if(M.length>1)return P(M,G);if(M.length===0)return 1;U=M[0]}else U=M;return w(U.mode,U.getLength(),G)},t.getEncodedBits=function(M){if(!l.isValid(M)||M<7)throw new Error("Invalid QR Code version");let z=M<<12;for(;e.getBCHDigit(z)-s>=0;)z^=h<<e.getBCHDigit(z)-s;return M<<12|z}})(IY);var RY={};const kO=ql,OY=1335,iRe=21522,tj=kO.getBCHDigit(OY);RY.getEncodedBits=function(e,n){const i=e.bit<<3|n;let o=i<<10;for(;kO.getBCHDigit(o)-tj>=0;)o^=OY<<kO.getBCHDigit(o)-tj;return(i<<10|o)^iRe};var kY={};const rRe=ig;function xw(t){this.mode=rRe.NUMERIC,this.data=t.toString()}xw.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};xw.prototype.getLength=function(){return this.data.length};xw.prototype.getBitsLength=function(){return xw.getBitsLength(this.data.length)};xw.prototype.write=function(e){let n,i,o;for(n=0;n+3<=this.data.length;n+=3)i=this.data.substr(n,3),o=parseInt(i,10),e.put(o,10);const l=this.data.length-n;l>0&&(i=this.data.substr(n),o=parseInt(i,10),e.put(o,l*3+1))};var sRe=xw;const oRe=ig,pR=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ew(t){this.mode=oRe.ALPHANUMERIC,this.data=t}Ew.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Ew.prototype.getLength=function(){return this.data.length};Ew.prototype.getBitsLength=function(){return Ew.getBitsLength(this.data.length)};Ew.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let i=pR.indexOf(this.data[n])*45;i+=pR.indexOf(this.data[n+1]),e.put(i,11)}this.data.length%2&&e.put(pR.indexOf(this.data[n]),6)};var aRe=Ew,cRe=function(e){for(var n=[],i=e.length,o=0;o<i;o++){var l=e.charCodeAt(o);if(l>=55296&&l<=56319&&i>o+1){var h=e.charCodeAt(o+1);h>=56320&&h<=57343&&(l=(l-55296)*1024+h-56320+65536,o+=1)}if(l<128){n.push(l);continue}if(l<2048){n.push(l>>6|192),n.push(l&63|128);continue}if(l<55296||l>=57344&&l<65536){n.push(l>>12|224),n.push(l>>6&63|128),n.push(l&63|128);continue}if(l>=65536&&l<=1114111){n.push(l>>18|240),n.push(l>>12&63|128),n.push(l>>6&63|128),n.push(l&63|128);continue}n.push(239,191,189)}return new Uint8Array(n).buffer};const lRe=cRe,uRe=ig;function Cw(t){this.mode=uRe.BYTE,typeof t=="string"&&(t=lRe(t)),this.data=new Uint8Array(t)}Cw.getBitsLength=function(e){return e*8};Cw.prototype.getLength=function(){return this.data.length};Cw.prototype.getBitsLength=function(){return Cw.getBitsLength(this.data.length)};Cw.prototype.write=function(t){for(let e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)};var dRe=Cw;const hRe=ig,fRe=ql;function Tw(t){this.mode=hRe.KANJI,this.data=t}Tw.getBitsLength=function(e){return e*13};Tw.prototype.getLength=function(){return this.data.length};Tw.prototype.getBitsLength=function(){return Tw.getBitsLength(this.data.length)};Tw.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let n=fRe.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),t.put(n,13)}};var pRe=Tw,DY={exports:{}};(function(t){var e={single_source_shortest_paths:function(n,i,o){var l={},h={};h[i]=0;var s=e.PriorityQueue.make();s.push(i,0);for(var w,x,A,P,D,M,z,U,G;!s.empty();){w=s.pop(),x=w.value,P=w.cost,D=n[x]||{};for(A in D)D.hasOwnProperty(A)&&(M=D[A],z=P+M,U=h[A],G=typeof h[A]>"u",(G||U>z)&&(h[A]=z,s.push(A,z),l[A]=x))}if(typeof o<"u"&&typeof h[o]>"u"){var ne=["Could not find a path from ",i," to ",o,"."].join("");throw new Error(ne)}return l},extract_shortest_path_from_predecessor_list:function(n,i){for(var o=[],l=i;l;)o.push(l),n[l],l=n[l];return o.reverse(),o},find_path:function(n,i,o){var l=e.single_source_shortest_paths(n,i,o);return e.extract_shortest_path_from_predecessor_list(l,o)},PriorityQueue:{make:function(n){var i=e.PriorityQueue,o={},l;n=n||{};for(l in i)i.hasOwnProperty(l)&&(o[l]=i[l]);return o.queue=[],o.sorter=n.sorter||i.default_sorter,o},default_sorter:function(n,i){return n.cost-i.cost},push:function(n,i){var o={value:n,cost:i};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(DY);var mRe=DY.exports;(function(t){const e=ig,n=sRe,i=aRe,o=dRe,l=pRe,h=Fh,s=ql,w=mRe;function x(ne){return unescape(encodeURIComponent(ne)).length}function A(ne,oe,Q){const de=[];let he;for(;(he=ne.exec(Q))!==null;)de.push({data:he[0],index:he.index,mode:oe,length:he[0].length});return de}function P(ne){const oe=A(h.NUMERIC,e.NUMERIC,ne),Q=A(h.ALPHANUMERIC,e.ALPHANUMERIC,ne);let de,he;return s.isKanjiModeEnabled()?(de=A(h.BYTE,e.BYTE,ne),he=A(h.KANJI,e.KANJI,ne)):(de=A(h.BYTE_KANJI,e.BYTE,ne),he=[]),oe.concat(Q,de,he).sort(function(ke,Ue){return ke.index-Ue.index}).map(function(ke){return{data:ke.data,mode:ke.mode,length:ke.length}})}function D(ne,oe){switch(oe){case e.NUMERIC:return n.getBitsLength(ne);case e.ALPHANUMERIC:return i.getBitsLength(ne);case e.KANJI:return l.getBitsLength(ne);case e.BYTE:return o.getBitsLength(ne)}}function M(ne){return ne.reduce(function(oe,Q){const de=oe.length-1>=0?oe[oe.length-1]:null;return de&&de.mode===Q.mode?(oe[oe.length-1].data+=Q.data,oe):(oe.push(Q),oe)},[])}function z(ne){const oe=[];for(let Q=0;Q<ne.length;Q++){const de=ne[Q];switch(de.mode){case e.NUMERIC:oe.push([de,{data:de.data,mode:e.ALPHANUMERIC,length:de.length},{data:de.data,mode:e.BYTE,length:de.length}]);break;case e.ALPHANUMERIC:oe.push([de,{data:de.data,mode:e.BYTE,length:de.length}]);break;case e.KANJI:oe.push([de,{data:de.data,mode:e.BYTE,length:x(de.data)}]);break;case e.BYTE:oe.push([{data:de.data,mode:e.BYTE,length:x(de.data)}])}}return oe}function U(ne,oe){const Q={},de={start:{}};let he=["start"];for(let Ie=0;Ie<ne.length;Ie++){const ke=ne[Ie],Ue=[];for(let ze=0;ze<ke.length;ze++){const ht=ke[ze],ft=""+Ie+ze;Ue.push(ft),Q[ft]={node:ht,lastCount:0},de[ft]={};for(let ct=0;ct<he.length;ct++){const je=he[ct];Q[je]&&Q[je].node.mode===ht.mode?(de[je][ft]=D(Q[je].lastCount+ht.length,ht.mode)-D(Q[je].lastCount,ht.mode),Q[je].lastCount+=ht.length):(Q[je]&&(Q[je].lastCount=ht.length),de[je][ft]=D(ht.length,ht.mode)+4+e.getCharCountIndicator(ht.mode,oe))}}he=Ue}for(let Ie=0;Ie<he.length;Ie++)de[he[Ie]].end=0;return{map:de,table:Q}}function G(ne,oe){let Q;const de=e.getBestModeForData(ne);if(Q=e.from(oe,de),Q!==e.BYTE&&Q.bit<de.bit)throw new Error('"'+ne+'" cannot be encoded with mode '+e.toString(Q)+`.
 Suggested mode is: `+e.toString(de));switch(Q===e.KANJI&&!s.isKanjiModeEnabled()&&(Q=e.BYTE),Q){case e.NUMERIC:return new n(ne);case e.ALPHANUMERIC:return new i(ne);case e.KANJI:return new l(ne);case e.BYTE:return new o(ne)}}t.fromArray=function(oe){return oe.reduce(function(Q,de){return typeof de=="string"?Q.push(G(de,null)):de.data&&Q.push(G(de.data,de.mode)),Q},[])},t.fromString=function(oe,Q){const de=P(oe,s.isKanjiModeEnabled()),he=z(de),Ie=U(he,Q),ke=w.find_path(Ie.map,"start","end"),Ue=[];for(let ze=1;ze<ke.length-1;ze++)Ue.push(Ie.table[ke[ze]].node);return t.fromArray(M(Ue))},t.rawSplit=function(oe){return t.fromArray(P(oe,s.isKanjiModeEnabled()))}})(kY);const vI=ql,mR=_I,gRe=ZPe,yRe=KPe,_Re=EY,wRe=CY,DO=TY,NO=wI,bRe=XPe,dS=IY,vRe=RY,xRe=ig,gR=kY;function ERe(t,e){const n=t.size,i=wRe.getPositions(e);for(let o=0;o<i.length;o++){const l=i[o][0],h=i[o][1];for(let s=-1;s<=7;s++)if(!(l+s<=-1||n<=l+s))for(let w=-1;w<=7;w++)h+w<=-1||n<=h+w||(s>=0&&s<=6&&(w===0||w===6)||w>=0&&w<=6&&(s===0||s===6)||s>=2&&s<=4&&w>=2&&w<=4?t.set(l+s,h+w,!0,!0):t.set(l+s,h+w,!1,!0))}}function CRe(t){const e=t.size;for(let n=8;n<e-8;n++){const i=n%2===0;t.set(n,6,i,!0),t.set(6,n,i,!0)}}function TRe(t,e){const n=_Re.getPositions(e);for(let i=0;i<n.length;i++){const o=n[i][0],l=n[i][1];for(let h=-2;h<=2;h++)for(let s=-2;s<=2;s++)h===-2||h===2||s===-2||s===2||h===0&&s===0?t.set(o+h,l+s,!0,!0):t.set(o+h,l+s,!1,!0)}}function ARe(t,e){const n=t.size,i=dS.getEncodedBits(e);let o,l,h;for(let s=0;s<18;s++)o=Math.floor(s/3),l=s%3+n-8-3,h=(i>>s&1)===1,t.set(o,l,h,!0),t.set(l,o,h,!0)}function yR(t,e,n){const i=t.size,o=vRe.getEncodedBits(e,n);let l,h;for(l=0;l<15;l++)h=(o>>l&1)===1,l<6?t.set(l,8,h,!0):l<8?t.set(l+1,8,h,!0):t.set(i-15+l,8,h,!0),l<8?t.set(8,i-l-1,h,!0):l<9?t.set(8,15-l-1+1,h,!0):t.set(8,15-l-1,h,!0);t.set(i-8,8,1,!0)}function SRe(t,e){const n=t.size;let i=-1,o=n-1,l=7,h=0;for(let s=n-1;s>0;s-=2)for(s===6&&s--;;){for(let w=0;w<2;w++)if(!t.isReserved(o,s-w)){let x=!1;h<e.length&&(x=(e[h]>>>l&1)===1),t.set(o,s-w,x),l--,l===-1&&(h++,l=7)}if(o+=i,o<0||n<=o){o-=i,i=-i;break}}}function IRe(t,e,n){const i=new gRe;n.forEach(function(w){i.put(w.mode.bit,4),i.put(w.getLength(),xRe.getCharCountIndicator(w.mode,t)),w.write(i)});const o=vI.getSymbolTotalCodewords(t),l=NO.getTotalCodewordsCount(t,e),h=(o-l)*8;for(i.getLengthInBits()+4<=h&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const s=(h-i.getLengthInBits())/8;for(let w=0;w<s;w++)i.put(w%2?17:236,8);return PRe(i,t,e)}function PRe(t,e,n){const i=vI.getSymbolTotalCodewords(e),o=NO.getTotalCodewordsCount(e,n),l=i-o,h=NO.getBlocksCount(e,n),s=i%h,w=h-s,x=Math.floor(i/h),A=Math.floor(l/h),P=A+1,D=x-A,M=new bRe(D);let z=0;const U=new Array(h),G=new Array(h);let ne=0;const oe=new Uint8Array(t.buffer);for(let ke=0;ke<h;ke++){const Ue=ke<w?A:P;U[ke]=oe.slice(z,z+Ue),G[ke]=M.encode(U[ke]),z+=Ue,ne=Math.max(ne,Ue)}const Q=new Uint8Array(i);let de=0,he,Ie;for(he=0;he<ne;he++)for(Ie=0;Ie<h;Ie++)he<U[Ie].length&&(Q[de++]=U[Ie][he]);for(he=0;he<D;he++)for(Ie=0;Ie<h;Ie++)Q[de++]=G[Ie][he];return Q}function RRe(t,e,n,i){let o;if(Array.isArray(t))o=gR.fromArray(t);else if(typeof t=="string"){let x=e;if(!x){const A=gR.rawSplit(t);x=dS.getBestVersionForData(A,n)}o=gR.fromString(t,x||40)}else throw new Error("Invalid data");const l=dS.getBestVersionForData(o,n);if(!l)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=l;else if(e<l)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+l+`.
`);const h=IRe(e,n,o),s=vI.getSymbolSize(e),w=new yRe(s);return ERe(w,e),CRe(w),TRe(w,e),yR(w,n,0),e>=7&&ARe(w,e),SRe(w,h),isNaN(i)&&(i=DO.getBestMask(w,yR.bind(null,w,n))),DO.applyMask(i,w),yR(w,n,i),{modules:w,version:e,errorCorrectionLevel:n,maskPattern:i,segments:o}}vY.create=function(e,n){if(typeof e>"u"||e==="")throw new Error("No input text");let i=mR.M,o,l;return typeof n<"u"&&(i=mR.from(n.errorCorrectionLevel,mR.M),o=dS.from(n.version),l=DO.from(n.maskPattern),n.toSJISFunc&&vI.setToSJISFunction(n.toSJISFunc)),RRe(e,o,i,l)};var NY={},sN={};(function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let i=n.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+n);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(l){return[l,l]}))),i.length===6&&i.push("F","F");const o=parseInt(i.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+i.slice(0,6).join("")}}t.getOptions=function(i){i||(i={}),i.color||(i.color={});const o=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,l=i.width&&i.width>=21?i.width:void 0,h=i.scale||4;return{width:l,scale:l?4:h,margin:o,color:{dark:e(i.color.dark||"#000000ff"),light:e(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},t.getScale=function(i,o){return o.width&&o.width>=i+o.margin*2?o.width/(i+o.margin*2):o.scale},t.getImageWidth=function(i,o){const l=t.getScale(i,o);return Math.floor((i+o.margin*2)*l)},t.qrToImageData=function(i,o,l){const h=o.modules.size,s=o.modules.data,w=t.getScale(h,l),x=Math.floor((h+l.margin*2)*w),A=l.margin*w,P=[l.color.light,l.color.dark];for(let D=0;D<x;D++)for(let M=0;M<x;M++){let z=(D*x+M)*4,U=l.color.light;if(D>=A&&M>=A&&D<x-A&&M<x-A){const G=Math.floor((D-A)/w),ne=Math.floor((M-A)/w);U=P[s[G*h+ne]?1:0]}i[z++]=U.r,i[z++]=U.g,i[z++]=U.b,i[z]=U.a}}})(sN);(function(t){const e=sN;function n(o,l,h){o.clearRect(0,0,l.width,l.height),l.style||(l.style={}),l.height=h,l.width=h,l.style.height=h+"px",l.style.width=h+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(l,h,s){let w=s,x=h;typeof w>"u"&&(!h||!h.getContext)&&(w=h,h=void 0),h||(x=i()),w=e.getOptions(w);const A=e.getImageWidth(l.modules.size,w),P=x.getContext("2d"),D=P.createImageData(A,A);return e.qrToImageData(D.data,l,w),n(P,x,A),P.putImageData(D,0,0),x},t.renderToDataURL=function(l,h,s){let w=s;typeof w>"u"&&(!h||!h.getContext)&&(w=h,h=void 0),w||(w={});const x=t.render(l,h,w),A=w.type||"image/png",P=w.rendererOpts||{};return x.toDataURL(A,P.quality)}})(NY);var MY={};const ORe=sN;function nj(t,e){const n=t.a/255,i=e+'="'+t.hex+'"';return n<1?i+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':i}function _R(t,e,n){let i=t+e;return typeof n<"u"&&(i+=" "+n),i}function kRe(t,e,n){let i="",o=0,l=!1,h=0;for(let s=0;s<t.length;s++){const w=Math.floor(s%e),x=Math.floor(s/e);!w&&!l&&(l=!0),t[s]?(h++,s>0&&w>0&&t[s-1]||(i+=l?_R("M",w+n,.5+x+n):_R("m",o,0),o=0,l=!1),w+1<e&&t[s+1]||(i+=_R("h",h),h=0)):o++}return i}MY.render=function(e,n,i){const o=ORe.getOptions(n),l=e.modules.size,h=e.modules.data,s=l+o.margin*2,w=o.color.light.a?"<path "+nj(o.color.light,"fill")+' d="M0 0h'+s+"v"+s+'H0z"/>':"",x="<path "+nj(o.color.dark,"stroke")+' d="'+kRe(h,l,o.margin)+'"/>',A='viewBox="0 0 '+s+" "+s+'"',D='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+A+' shape-rendering="crispEdges">'+w+x+`</svg>
`;return typeof i=="function"&&i(null,D),D};const DRe=GPe,MO=vY,LY=NY,NRe=MY;function oN(t,e,n,i,o){const l=[].slice.call(arguments,1),h=l.length,s=typeof l[h-1]=="function";if(!s&&!DRe())throw new Error("Callback required as last argument");if(s){if(h<2)throw new Error("Too few arguments provided");h===2?(o=n,n=e,e=i=void 0):h===3&&(e.getContext&&typeof o>"u"?(o=i,i=void 0):(o=i,i=n,n=e,e=void 0))}else{if(h<1)throw new Error("Too few arguments provided");return h===1?(n=e,e=i=void 0):h===2&&!e.getContext&&(i=n,n=e,e=void 0),new Promise(function(w,x){try{const A=MO.create(n,i);w(t(A,e,i))}catch(A){x(A)}})}try{const w=MO.create(n,i);o(null,t(w,e,i))}catch(w){o(w)}}r3.create=MO.create;r3.toCanvas=oN.bind(null,LY.render);r3.toDataURL=oN.bind(null,LY.renderToDataURL);r3.toString=oN.bind(null,function(t,e,n){return NRe.render(t,n)});const MRe=.1,ij=2.5,xf=7;function wR(t,e,n){return t===e?!1:(t-e<0?e-t:t-e)<=n+MRe}function LRe(t,e){const n=Array.prototype.slice.call(r3.create(t,{errorCorrectionLevel:e}).modules.data,0),i=Math.sqrt(n.length);return n.reduce((o,l,h)=>(h%i===0?o.push([l]):o[o.length-1].push(l))&&o,[])}const BRe={generate({uri:t,size:e,logoSize:n,padding:i=8,dotColor:o="var(--apkt-colors-black)"}){const h=[],s=LRe(t,"Q"),w=(e-2*i)/s.length,x=[{x:0,y:0},{x:1,y:0},{x:0,y:1}];x.forEach(({x:U,y:G})=>{const ne=(s.length-xf)*w*U+i,oe=(s.length-xf)*w*G+i,Q=.45;for(let de=0;de<x.length;de+=1){const he=w*(xf-de*2);h.push(yi`
            <rect
              fill=${de===2?"var(--apkt-colors-black)":"var(--apkt-colors-white)"}
              width=${de===0?he-10:he}
              rx= ${de===0?(he-10)*Q:he*Q}
              ry= ${de===0?(he-10)*Q:he*Q}
              stroke=${o}
              stroke-width=${de===0?10:0}
              height=${de===0?he-10:he}
              x= ${de===0?oe+w*de+10/2:oe+w*de}
              y= ${de===0?ne+w*de+10/2:ne+w*de}
            />
          `)}});const A=Math.floor((n+25)/w),P=s.length/2-A/2,D=s.length/2+A/2-1,M=[];s.forEach((U,G)=>{U.forEach((ne,oe)=>{if(s[G][oe]&&!(G<xf&&oe<xf||G>s.length-(xf+1)&&oe<xf||G<xf&&oe>s.length-(xf+1))&&!(G>P&&G<D&&oe>P&&oe<D)){const Q=G*w+w/2+i,de=oe*w+w/2+i;M.push([Q,de])}})});const z={};return M.forEach(([U,G])=>{var ne;z[U]?(ne=z[U])==null||ne.push(G):z[U]=[G]}),Object.entries(z).map(([U,G])=>{const ne=G.filter(oe=>G.every(Q=>!wR(oe,Q,w)));return[Number(U),ne]}).forEach(([U,G])=>{G.forEach(ne=>{h.push(yi`<circle cx=${U} cy=${ne} fill=${o} r=${w/ij} />`)})}),Object.entries(z).filter(([U,G])=>G.length>1).map(([U,G])=>{const ne=G.filter(oe=>G.some(Q=>wR(oe,Q,w)));return[Number(U),ne]}).map(([U,G])=>{G.sort((oe,Q)=>oe<Q?-1:1);const ne=[];for(const oe of G){const Q=ne.find(de=>de.some(he=>wR(oe,he,w)));Q?Q.push(oe):ne.push([oe])}return[U,ne.map(oe=>[oe[0],oe[oe.length-1]])]}).forEach(([U,G])=>{G.forEach(([ne,oe])=>{h.push(yi`
              <line
                x1=${U}
                x2=${U}
                y1=${ne}
                y2=${oe}
                stroke=${o}
                stroke-width=${w/(ij/2)}
                stroke-linecap="round"
              />
            `)})}),h}},FRe=Fn`
  :host {
    position: relative;
    user-select: none;
    display: block;
    overflow: hidden;
    aspect-ratio: 1 / 1;
    width: 100%;
    height: 100%;
    background-color: ${({colors:t})=>t.white};
    border: 1px solid ${({tokens:t})=>t.theme.borderPrimary};
  }

  :host {
    border-radius: ${({borderRadius:t})=>t[4]};
    display: flex;
    align-items: center;
    justify-content: center;
  }

  :host([data-clear='true']) > wui-icon {
    display: none;
  }

  svg:first-child,
  wui-image,
  wui-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translateY(-50%) translateX(-50%);
    background-color: ${({tokens:t})=>t.theme.backgroundPrimary};
    box-shadow: inset 0 0 0 4px ${({tokens:t})=>t.theme.backgroundPrimary};
    border-radius: ${({borderRadius:t})=>t[6]};
  }

  wui-image {
    width: 25%;
    height: 25%;
    border-radius: ${({borderRadius:t})=>t[2]};
  }

  wui-icon {
    width: 100%;
    height: 100%;
    color: #3396ff !important;
    transform: translateY(-50%) translateX(-50%) scale(0.25);
  }

  wui-icon > svg {
    width: inherit;
    height: inherit;
  }
`;var rg=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let kh=class extends on{constructor(){super(...arguments),this.uri="",this.size=500,this.theme="dark",this.imageSrc=void 0,this.alt=void 0,this.arenaClear=void 0,this.farcaster=void 0}render(){return this.dataset.theme=this.theme,this.dataset.clear=String(this.arenaClear),we`<wui-flex
      alignItems="center"
      justifyContent="center"
      class="wui-qr-code"
      direction="column"
      gap="4"
      width="100%"
      style="height: 100%"
    >
      ${this.templateVisual()} ${this.templateSvg()}
    </wui-flex>`}templateSvg(){return yi`
      <svg viewBox="0 0 ${this.size} ${this.size}" width="100%" height="100%">
        ${BRe.generate({uri:this.uri,size:this.size,logoSize:this.arenaClear?0:this.size/4})}
      </svg>
    `}templateVisual(){return this.imageSrc?we`<wui-image src=${this.imageSrc} alt=${this.alt??"logo"}></wui-image>`:this.farcaster?we`<wui-icon
        class="farcaster"
        size="inherit"
        color="inherit"
        name="farcaster"
      ></wui-icon>`:we`<wui-icon size="inherit" color="inherit" name="walletConnect"></wui-icon>`}};kh.styles=[Ei,FRe];rg([Fe()],kh.prototype,"uri",void 0);rg([Fe({type:Number})],kh.prototype,"size",void 0);rg([Fe()],kh.prototype,"theme",void 0);rg([Fe()],kh.prototype,"imageSrc",void 0);rg([Fe()],kh.prototype,"alt",void 0);rg([Fe({type:Boolean})],kh.prototype,"arenaClear",void 0);rg([Fe({type:Boolean})],kh.prototype,"farcaster",void 0);kh=rg([nn("wui-qr-code")],kh);const $Re=Fn`
  wui-shimmer {
    width: 100%;
    aspect-ratio: 1 / 1;
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  wui-qr-code {
    opacity: 0;
    animation-duration: ${({durations:t})=>t.xl};
    animation-timing-function: ${({easings:t})=>t["ease-out-power-2"]};
    animation-name: fade-in;
    animation-fill-mode: forwards;
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`;var BY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let hS=class extends ca{constructor(){super(),this.basic=!1}firstUpdated(){var e,n,i;this.basic||Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:((e=this.wallet)==null?void 0:e.name)??"WalletConnect",platform:"qrcode",displayIndex:(n=this.wallet)==null?void 0:n.display_index,walletRank:(i=this.wallet)==null?void 0:i.order,view:Pt.state.view}})}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.unsubscribe)==null||e.forEach(n=>n())}render(){return this.onRenderProxy(),we`
      <wui-flex
        flexDirection="column"
        alignItems="center"
        .padding=${["0","5","5","5"]}
        gap="5"
      >
        <wui-shimmer width="100%"> ${this.qrCodeTemplate()} </wui-shimmer>
        <wui-text variant="lg-medium" color="primary"> Scan this QR Code with your phone </wui-text>
        ${this.copyTemplate()}
      </wui-flex>
      <w3m-mobile-download-links .wallet=${this.wallet}></w3m-mobile-download-links>
    `}onRenderProxy(){!this.ready&&this.uri&&(this.ready=!0)}qrCodeTemplate(){if(!this.uri||!this.ready)return null;const e=this.wallet?this.wallet.name:void 0;Ht.setWcLinking(void 0),Ht.setRecentWallet(this.wallet);const n=ra.state.themeVariables["--apkt-qr-color"]??ra.state.themeVariables["--w3m-qr-color"];return we` <wui-qr-code
      theme=${ra.state.themeMode}
      uri=${this.uri}
      imageSrc=${Tn(Ur.getWalletImage(this.wallet))}
      color=${Tn(n)}
      alt=${Tn(e)}
      data-testid="wui-qr-code"
    ></wui-qr-code>`}copyTemplate(){const e=!this.uri||!this.ready;return we`<wui-button
      .disabled=${e}
      @click=${this.onCopyUri}
      variant="neutral-secondary"
      size="sm"
      data-testid="copy-wc2-uri"
    >
      Copy link
      <wui-icon size="sm" color="inherit" name="copy" slot="iconRight"></wui-icon>
    </wui-button>`}};hS.styles=$Re;BY([Fe({type:Boolean})],hS.prototype,"basic",void 0);hS=BY([nn("w3m-connecting-wc-qrcode")],hS);var zRe=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let rj=class extends on{constructor(){var e,n,i;if(super(),this.wallet=(e=Pt.state.data)==null?void 0:e.wallet,!this.wallet)throw new Error("w3m-connecting-wc-unsupported: No wallet provided");Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:this.wallet.name,platform:"browser",displayIndex:(n=this.wallet)==null?void 0:n.display_index,walletRank:(i=this.wallet)==null?void 0:i.order,view:Pt.state.view}})}render(){return we`
      <wui-flex
        flexDirection="column"
        alignItems="center"
        .padding=${["10","5","5","5"]}
        gap="5"
      >
        <wui-wallet-image
          size="lg"
          imageSrc=${Tn(Ur.getWalletImage(this.wallet))}
        ></wui-wallet-image>

        <wui-text variant="md-regular" color="primary">Not Detected</wui-text>
      </wui-flex>

      <w3m-mobile-download-links .wallet=${this.wallet}></w3m-mobile-download-links>
    `}};rj=zRe([nn("w3m-connecting-wc-unsupported")],rj);var FY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let LO=class extends ca{constructor(){var e,n;if(super(),this.isLoading=!0,!this.wallet)throw new Error("w3m-connecting-wc-web: No wallet provided");this.onConnect=this.onConnectProxy.bind(this),this.secondaryBtnLabel="Open",this.secondaryLabel=hi.CONNECT_LABELS.MOBILE,this.secondaryBtnIcon="externalLink",this.updateLoadingState(),this.unsubscribe.push(Ht.subscribeKey("wcUri",()=>{this.updateLoadingState()})),Sn.sendEvent({type:"track",event:"SELECT_WALLET",properties:{name:this.wallet.name,platform:"web",displayIndex:(e=this.wallet)==null?void 0:e.display_index,walletRank:(n=this.wallet)==null?void 0:n.order,view:Pt.state.view}})}updateLoadingState(){this.isLoading=!this.uri}onConnectProxy(){var e;if((e=this.wallet)!=null&&e.webapp_link&&this.uri)try{this.error=!1;const{webapp_link:n,name:i}=this.wallet,{redirect:o,href:l}=Ft.formatUniversalUrl(n,this.uri);Ht.setWcLinking({name:i,href:l}),Ht.setRecentWallet(this.wallet),Ft.openHref(o,"_blank")}catch{this.error=!0}}};FY([Lt()],LO.prototype,"isLoading",void 0);LO=FY([nn("w3m-connecting-wc-web")],LO);const URe=Fn`
  :host([data-mobile-fullscreen='true']) {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  :host([data-mobile-fullscreen='true']) wui-ux-by-reown {
    margin-top: auto;
  }
`;var $y=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Dh=class extends on{constructor(){var e;super(),this.wallet=(e=Pt.state.data)==null?void 0:e.wallet,this.unsubscribe=[],this.platform=void 0,this.platforms=[],this.isSiwxEnabled=!!ut.state.siwx,this.remoteFeatures=ut.state.remoteFeatures,this.displayBranding=!0,this.basic=!1,this.determinePlatforms(),this.initializeConnection(),this.unsubscribe.push(ut.subscribeKey("remoteFeatures",n=>this.remoteFeatures=n))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return ut.state.enableMobileFullScreen&&this.setAttribute("data-mobile-fullscreen","true"),we`
      ${this.headerTemplate()}
      <div class="platform-container">${this.platformTemplate()}</div>
      ${this.reownBrandingTemplate()}
    `}reownBrandingTemplate(){var e;return!((e=this.remoteFeatures)!=null&&e.reownBranding)||!this.displayBranding?null:we`<wui-ux-by-reown></wui-ux-by-reown>`}async initializeConnection(e=!1){var n,i;if(!(this.platform==="browser"||ut.state.manualWCControl&&!e))try{const{wcPairingExpiry:o,status:l}=Ht.state,{redirectView:h}=Pt.state.data??{};if(e||ut.state.enableEmbedded||Ft.isPairingExpired(o)||l==="connecting"){const s=Ht.getConnections(ue.state.activeChain),w=(n=this.remoteFeatures)==null?void 0:n.multiWallet,x=s.length>0;await Ht.connectWalletConnect({cache:"never"}),this.isSiwxEnabled||(x&&w?(Pt.replace("ProfileWallets"),Ji.showSuccess("New Wallet Added")):h?Pt.replace(h):gi.close())}}catch(o){if(o instanceof Error&&o.message.includes("An error occurred when attempting to switch chain")&&!ut.state.enableNetworkSwitch&&ue.state.activeChain){ue.setActiveCaipNetwork(hd.getUnsupportedNetwork(`${ue.state.activeChain}:${(i=ue.state.activeCaipNetwork)==null?void 0:i.id}`)),ue.showUnsupportedChainUI();return}o instanceof Sh&&o.originalName===nl.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST?Sn.sendEvent({type:"track",event:"USER_REJECTED",properties:{message:o.message}}):Sn.sendEvent({type:"track",event:"CONNECT_ERROR",properties:{message:(o==null?void 0:o.message)??"Unknown"}}),Ht.setWcError(!0),Ji.showError(o.message??"Connection error"),Ht.resetWcConnection(),Pt.goBack()}}determinePlatforms(){if(!this.wallet){this.platforms.push("qrcode"),this.platform="qrcode";return}if(this.platform)return;const{mobile_link:e,desktop_link:n,webapp_link:i,injected:o,rdns:l}=this.wallet,h=o==null?void 0:o.map(({injected_id:U})=>U).filter(Boolean),s=[...l?[l]:h??[]],w=ut.state.isUniversalProvider?!1:s.length,x=e,A=i,P=Ht.checkInstalled(s),D=w&&P,M=n&&!Ft.isMobile();D&&!ue.state.noAdapters&&this.platforms.push("browser"),x&&this.platforms.push(Ft.isMobile()?"mobile":"qrcode"),A&&this.platforms.push("web"),M&&this.platforms.push("desktop");const z=bG.isCustomDeeplinkWallet(this.wallet.id,ue.state.activeChain);!D&&w&&!ue.state.noAdapters&&!z&&this.platforms.push("unsupported"),this.platform=this.platforms[0]}platformTemplate(){switch(this.platform){case"browser":return we`<w3m-connecting-wc-browser></w3m-connecting-wc-browser>`;case"web":return we`<w3m-connecting-wc-web></w3m-connecting-wc-web>`;case"desktop":return we`
          <w3m-connecting-wc-desktop .onRetry=${()=>this.initializeConnection(!0)}>
          </w3m-connecting-wc-desktop>
        `;case"mobile":return we`
          <w3m-connecting-wc-mobile isMobile .onRetry=${()=>this.initializeConnection(!0)}>
          </w3m-connecting-wc-mobile>
        `;case"qrcode":return we`<w3m-connecting-wc-qrcode ?basic=${this.basic}></w3m-connecting-wc-qrcode>`;default:return we`<w3m-connecting-wc-unsupported></w3m-connecting-wc-unsupported>`}}headerTemplate(){return this.platforms.length>1?we`
      <w3m-connecting-header
        .platforms=${this.platforms}
        .onSelectPlatfrom=${this.onSelectPlatform.bind(this)}
      >
      </w3m-connecting-header>
    `:null}async onSelectPlatform(e){var i;const n=(i=this.shadowRoot)==null?void 0:i.querySelector("div");n&&(await n.animate([{opacity:1},{opacity:0}],{duration:200,fill:"forwards",easing:"ease"}).finished,this.platform=e,n.animate([{opacity:0},{opacity:1}],{duration:200,fill:"forwards",easing:"ease"}))}};Dh.styles=URe;$y([Lt()],Dh.prototype,"platform",void 0);$y([Lt()],Dh.prototype,"platforms",void 0);$y([Lt()],Dh.prototype,"isSiwxEnabled",void 0);$y([Lt()],Dh.prototype,"remoteFeatures",void 0);$y([Fe({type:Boolean})],Dh.prototype,"displayBranding",void 0);$y([Fe({type:Boolean})],Dh.prototype,"basic",void 0);Dh=$y([nn("w3m-connecting-wc-view")],Dh);var aN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let tE=class extends on{constructor(){super(),this.unsubscribe=[],this.isMobile=Ft.isMobile(),this.remoteFeatures=ut.state.remoteFeatures,this.unsubscribe.push(ut.subscribeKey("remoteFeatures",e=>this.remoteFeatures=e))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){if(this.isMobile){const{featured:e,recommended:n}=fn.state,{customWallets:i}=ut.state,o=Jt.getRecentWallets(),l=e.length||n.length||(i==null?void 0:i.length)||o.length;return we`<wui-flex flexDirection="column" gap="2" .margin=${["1","3","3","3"]}>
        ${l?we`<w3m-connector-list></w3m-connector-list>`:null}
        <w3m-all-wallets-widget></w3m-all-wallets-widget>
      </wui-flex>`}return we`<wui-flex flexDirection="column" .padding=${["0","0","4","0"]}>
        <w3m-connecting-wc-view ?basic=${!0} .displayBranding=${!1}></w3m-connecting-wc-view>
        <wui-flex flexDirection="column" .padding=${["0","3","0","3"]}>
          <w3m-all-wallets-widget></w3m-all-wallets-widget>
        </wui-flex>
      </wui-flex>
      ${this.reownBrandingTemplate()} `}reownBrandingTemplate(){var e;return(e=this.remoteFeatures)!=null&&e.reownBranding?we` <wui-flex flexDirection="column" .padding=${["1","0","1","0"]}>
      <wui-ux-by-reown></wui-ux-by-reown>
    </wui-flex>`:null}};aN([Lt()],tE.prototype,"isMobile",void 0);aN([Lt()],tE.prototype,"remoteFeatures",void 0);tE=aN([nn("w3m-connecting-wc-basic-view")],tE);const jRe=rs`
  .continue-button-container {
    width: 100%;
  }
`;var $Y=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let nE=class extends on{constructor(){super(...arguments),this.loading=!1}render(){return we`
      <wui-flex
        flexDirection="column"
        alignItems="center"
        gap="6"
        .padding=${["0","0","4","0"]}
      >
        ${this.onboardingTemplate()} ${this.buttonsTemplate()}
        <wui-link
          @click=${()=>{Ft.openHref(lse.URLS.FAQ,"_blank")}}
        >
          Learn more about names
          <wui-icon color="inherit" slot="iconRight" name="externalLink"></wui-icon>
        </wui-link>
      </wui-flex>
    `}onboardingTemplate(){return we` <wui-flex
      flexDirection="column"
      gap="6"
      alignItems="center"
      .padding=${["0","6","0","6"]}
    >
      <wui-flex gap="3" alignItems="center" justifyContent="center">
        <wui-icon-box icon="id" size="xl" iconSize="xxl" color="default"></wui-icon-box>
      </wui-flex>
      <wui-flex flexDirection="column" alignItems="center" gap="3">
        <wui-text align="center" variant="lg-medium" color="primary">
          Choose your account name
        </wui-text>
        <wui-text align="center" variant="md-regular" color="primary">
          Finally say goodbye to 0x addresses, name your account to make it easier to exchange
          assets
        </wui-text>
      </wui-flex>
    </wui-flex>`}buttonsTemplate(){return we`<wui-flex
      .padding=${["0","8","0","8"]}
      gap="3"
      class="continue-button-container"
    >
      <wui-button
        fullWidth
        .loading=${this.loading}
        size="lg"
        borderRadius="xs"
        @click=${this.handleContinue.bind(this)}
        >Choose name
      </wui-button>
    </wui-flex>`}handleContinue(){Pt.push("RegisterAccountName"),Sn.sendEvent({type:"track",event:"OPEN_ENS_FLOW",properties:{isSmartAccount:Fs(ue.state.activeChain)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT}})}};nE.styles=jRe;$Y([Lt()],nE.prototype,"loading",void 0);nE=$Y([nn("w3m-choose-account-name-view")],nE);var VRe=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let BO=class extends on{constructor(){var e;super(...arguments),this.wallet=(e=Pt.state.data)==null?void 0:e.wallet}render(){if(!this.wallet)throw new Error("w3m-downloads-view");return we`
      <wui-flex gap="2" flexDirection="column" .padding=${["3","3","4","3"]}>
        ${this.chromeTemplate()} ${this.iosTemplate()} ${this.androidTemplate()}
        ${this.homepageTemplate()}
      </wui-flex>
    `}chromeTemplate(){var e;return(e=this.wallet)!=null&&e.chrome_store?we`<wui-list-item
      variant="icon"
      icon="chromeStore"
      iconVariant="square"
      @click=${this.onChromeStore.bind(this)}
      chevron
    >
      <wui-text variant="md-medium" color="primary">Chrome Extension</wui-text>
    </wui-list-item>`:null}iosTemplate(){var e;return(e=this.wallet)!=null&&e.app_store?we`<wui-list-item
      variant="icon"
      icon="appStore"
      iconVariant="square"
      @click=${this.onAppStore.bind(this)}
      chevron
    >
      <wui-text variant="md-medium" color="primary">iOS App</wui-text>
    </wui-list-item>`:null}androidTemplate(){var e;return(e=this.wallet)!=null&&e.play_store?we`<wui-list-item
      variant="icon"
      icon="playStore"
      iconVariant="square"
      @click=${this.onPlayStore.bind(this)}
      chevron
    >
      <wui-text variant="md-medium" color="primary">Android App</wui-text>
    </wui-list-item>`:null}homepageTemplate(){var e;return(e=this.wallet)!=null&&e.homepage?we`
      <wui-list-item
        variant="icon"
        icon="browser"
        iconVariant="square-blue"
        @click=${this.onHomePage.bind(this)}
        chevron
      >
        <wui-text variant="md-medium" color="primary">Website</wui-text>
      </wui-list-item>
    `:null}openStore(e){e.href&&this.wallet&&(Sn.sendEvent({type:"track",event:"GET_WALLET",properties:{name:this.wallet.name,walletRank:this.wallet.order,explorerId:this.wallet.id,type:e.type}}),Ft.openHref(e.href,"_blank"))}onChromeStore(){var e;(e=this.wallet)!=null&&e.chrome_store&&this.openStore({href:this.wallet.chrome_store,type:"chrome_store"})}onAppStore(){var e;(e=this.wallet)!=null&&e.app_store&&this.openStore({href:this.wallet.app_store,type:"app_store"})}onPlayStore(){var e;(e=this.wallet)!=null&&e.play_store&&this.openStore({href:this.wallet.play_store,type:"play_store"})}onHomePage(){var e;(e=this.wallet)!=null&&e.homepage&&this.openStore({href:this.wallet.homepage,type:"homepage"})}};BO=VRe([nn("w3m-downloads-view")],BO);var WRe=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const HRe="https://walletconnect.com/explorer";let FO=class extends on{render(){return we`
      <wui-flex flexDirection="column" .padding=${["0","3","3","3"]} gap="2">
        ${this.recommendedWalletsTemplate()}
        <w3m-list-wallet
          name="Explore all"
          showAllWallets
          walletIcon="allWallets"
          icon="externalLink"
          size="sm"
          @click=${()=>{Ft.openHref("https://walletconnect.com/explorer?type=wallet","_blank")}}
        ></w3m-list-wallet>
      </wui-flex>
    `}recommendedWalletsTemplate(){const{recommended:e,featured:n}=fn.state,{customWallets:i}=ut.state;return[...n,...i??[],...e].slice(0,4).map((l,h)=>we`
        <w3m-list-wallet
          displayIndex=${h}
          name=${l.name??"Unknown"}
          tagVariant="accent"
          size="sm"
          imageSrc=${Tn(Ur.getWalletImage(l))}
          @click=${()=>{this.onWalletClick(l)}}
        ></w3m-list-wallet>
      `)}onWalletClick(e){Sn.sendEvent({type:"track",event:"GET_WALLET",properties:{name:e.name,walletRank:void 0,explorerId:e.id,type:"homepage"}}),Ft.openHref(e.homepage??HRe,"_blank")}};FO=WRe([nn("w3m-get-wallet-view")],FO);const GRe=yi`<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="64" height="64" fill="#F7931A"/>
  <g clip-path="url(#clip0_1045_17)">
    <path d="M63.0394 39.7409C58.7654 56.8839 41.4024 67.3169 24.2574 63.0419C7.11937 58.7679 -3.31363 41.4039 0.962367 24.2619C5.23437 7.11686 22.5974 -3.31714 39.7374 0.956863C56.8814 5.23086 67.3134 22.5969 63.0394 39.7409Z" fill="#F7931A"/>
    <path d="M46.1092 27.4409C46.7462 23.1829 43.5042 20.8939 39.0712 19.3669L40.5092 13.5989L36.9982 12.7239L35.5982 18.3399C34.6752 18.1099 33.7272 17.8929 32.7852 17.6779L34.1952 12.0249L30.6862 11.1499L29.2472 16.9159C28.4832 16.7419 27.7332 16.5699 27.0052 16.3889L27.0092 16.3709L22.1672 15.1619L21.2332 18.9119C21.2332 18.9119 23.8382 19.5089 23.7832 19.5459C25.2052 19.9009 25.4622 20.8419 25.4192 21.5879L23.7812 28.1589C23.8792 28.1839 24.0062 28.2199 24.1462 28.2759C24.0292 28.2469 23.9042 28.2149 23.7752 28.1839L21.4792 37.3889C21.3052 37.8209 20.8642 38.4689 19.8702 38.2229C19.9052 38.2739 17.3182 37.5859 17.3182 37.5859L15.5752 41.6049L20.1442 42.7439C20.9942 42.9569 21.8272 43.1799 22.6472 43.3899L21.1942 49.2239L24.7012 50.0989L26.1402 44.3269C27.0982 44.5869 28.0282 44.8269 28.9382 45.0529L27.5042 50.7979L31.0152 51.6729L32.4682 45.8499C38.4552 46.9829 42.9572 46.5259 44.8522 41.1109C46.3792 36.7509 44.7762 34.2359 41.6262 32.5959C43.9202 32.0669 45.6482 30.5579 46.1092 27.4409ZM38.0872 38.6899C37.0022 43.0499 29.6612 40.6929 27.2812 40.1019L29.2092 32.3729C31.5892 32.9669 39.2212 34.1429 38.0872 38.6899ZM39.1732 27.3779C38.1832 31.3439 32.0732 29.3289 30.0912 28.8349L31.8392 21.8249C33.8212 22.3189 40.2042 23.2409 39.1732 27.3779Z" fill="white"/>
  </g>
  <defs>
    <clipPath id="clip0_1045_17">
      <rect width="64" height="64" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,qRe=yi`<svg fill="none" viewBox="0 0 60 60">
  <rect width="60" height="60" fill="#1DC956" rx="30" />
  <circle cx="30" cy="30" r="3" fill="#fff" />
  <path
    fill="#2BEE6C"
    stroke="#fff"
    stroke-width="2"
    d="m45.32 17.9-.88-.42.88.42.02-.05c.1-.2.21-.44.26-.7l-.82-.15.82.16a2 2 0 0 0-.24-1.4c-.13-.23-.32-.42-.47-.57a8.42 8.42 0 0 1-.04-.04l-.04-.04a2.9 2.9 0 0 0-.56-.47l-.51.86.5-.86a2 2 0 0 0-1.4-.24c-.26.05-.5.16-.69.26l-.05.02-15.05 7.25-.1.05c-1.14.55-1.85.89-2.46 1.37a7 7 0 0 0-1.13 1.14c-.5.6-.83 1.32-1.38 2.45l-.05.11-7.25 15.05-.02.05c-.1.2-.21.43-.26.69a2 2 0 0 0 .24 1.4l.85-.5-.85.5c.13.23.32.42.47.57l.04.04.04.04c.15.15.34.34.56.47a2 2 0 0 0 1.41.24l-.2-.98.2.98c.25-.05.5-.17.69-.26l.05-.02-.42-.87.42.87 15.05-7.25.1-.05c1.14-.55 1.85-.89 2.46-1.38a7 7 0 0 0 1.13-1.13 12.87 12.87 0 0 0 1.43-2.56l7.25-15.05Z"
  />
  <path
    fill="#1DC956"
    d="M33.38 32.72 30.7 29.3 15.86 44.14l.2.2a1 1 0 0 0 1.14.2l15.1-7.27a3 3 0 0 0 1.08-4.55Z"
  />
  <path
    fill="#86F999"
    d="m26.62 27.28 2.67 3.43 14.85-14.85-.2-.2a1 1 0 0 0-1.14-.2l-15.1 7.27a3 3 0 0 0-1.08 4.55Z"
  />
  <circle cx="30" cy="30" r="3" fill="#fff" transform="rotate(45 30 30)" />
  <rect width="59" height="59" x=".5" y=".5" stroke="#062B2B" stroke-opacity=".1" rx="29.5" />
</svg> `,ZRe=yi`<svg viewBox="0 0 60 60" fill="none">
  <g clip-path="url(#clip0_7734_50402)">
    <path
      d="M0 24.9C0 15.6485 0 11.0228 1.97053 7.56812C3.3015 5.23468 5.23468 3.3015 7.56812 1.97053C11.0228 0 15.6485 0 24.9 0H35.1C44.3514 0 48.9772 0 52.4319 1.97053C54.7653 3.3015 56.6985 5.23468 58.0295 7.56812C60 11.0228 60 15.6485 60 24.9V35.1C60 44.3514 60 48.9772 58.0295 52.4319C56.6985 54.7653 54.7653 56.6985 52.4319 58.0295C48.9772 60 44.3514 60 35.1 60H24.9C15.6485 60 11.0228 60 7.56812 58.0295C5.23468 56.6985 3.3015 54.7653 1.97053 52.4319C0 48.9772 0 44.3514 0 35.1V24.9Z"
      fill="#EB8B47"
    />
    <path
      d="M0.5 24.9C0.5 20.2652 0.50047 16.8221 0.744315 14.105C0.987552 11.3946 1.46987 9.45504 2.40484 7.81585C3.69145 5.56019 5.56019 3.69145 7.81585 2.40484C9.45504 1.46987 11.3946 0.987552 14.105 0.744315C16.8221 0.50047 20.2652 0.5 24.9 0.5H35.1C39.7348 0.5 43.1779 0.50047 45.895 0.744315C48.6054 0.987552 50.545 1.46987 52.1841 2.40484C54.4398 3.69145 56.3086 5.56019 57.5952 7.81585C58.5301 9.45504 59.0124 11.3946 59.2557 14.105C59.4995 16.8221 59.5 20.2652 59.5 24.9V35.1C59.5 39.7348 59.4995 43.1779 59.2557 45.895C59.0124 48.6054 58.5301 50.545 57.5952 52.1841C56.3086 54.4398 54.4398 56.3086 52.1841 57.5952C50.545 58.5301 48.6054 59.0124 45.895 59.2557C43.1779 59.4995 39.7348 59.5 35.1 59.5H24.9C20.2652 59.5 16.8221 59.4995 14.105 59.2557C11.3946 59.0124 9.45504 58.5301 7.81585 57.5952C5.56019 56.3086 3.69145 54.4398 2.40484 52.1841C1.46987 50.545 0.987552 48.6054 0.744315 45.895C0.50047 43.1779 0.5 39.7348 0.5 35.1V24.9Z"
      stroke="#062B2B"
      stroke-opacity="0.1"
    />
    <path
      d="M19 52C24.5228 52 29 47.5228 29 42C29 36.4772 24.5228 32 19 32C13.4772 32 9 36.4772 9 42C9 47.5228 13.4772 52 19 52Z"
      fill="#FF974C"
      stroke="white"
      stroke-width="2"
    />
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M42.8437 8.3264C42.4507 7.70891 41.5493 7.70891 41.1564 8.32641L28.978 27.4638C28.5544 28.1295 29.0326 29.0007 29.8217 29.0007H54.1783C54.9674 29.0007 55.4456 28.1295 55.022 27.4638L42.8437 8.3264Z"
      fill="white"
    />
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M42.3348 11.6456C42.659 11.7608 42.9061 12.1492 43.4005 12.926L50.7332 24.4488C51.2952 25.332 51.5763 25.7737 51.5254 26.1382C51.4915 26.3808 51.3698 26.6026 51.1833 26.7614C50.9031 27 50.3796 27 49.3327 27H34.6673C33.6204 27 33.0969 27 32.8167 26.7614C32.6302 26.6026 32.5085 26.3808 32.4746 26.1382C32.4237 25.7737 32.7048 25.332 33.2669 24.4488L40.5995 12.926C41.0939 12.1492 41.341 11.7608 41.6652 11.6456C41.8818 11.5687 42.1182 11.5687 42.3348 11.6456ZM35.0001 26.999C38.8661 26.999 42.0001 23.865 42.0001 19.999C42.0001 23.865 45.1341 26.999 49.0001 26.999H35.0001Z"
      fill="#FF974C"
    />
    <path
      d="M10.1061 9.35712C9.9973 9.67775 9.99867 10.0388 9.99978 10.3323C9.99989 10.3611 10 10.3893 10 10.4167V25.5833C10 25.6107 9.99989 25.6389 9.99978 25.6677C9.99867 25.9612 9.9973 26.3222 10.1061 26.6429C10.306 27.2317 10.7683 27.694 11.3571 27.8939C11.6777 28.0027 12.0388 28.0013 12.3323 28.0002C12.3611 28.0001 12.3893 28 12.4167 28H19C24.5228 28 29 23.5228 29 18C29 12.4772 24.5228 8 19 8H12.4167C12.3893 8 12.3611 7.99989 12.3323 7.99978C12.0388 7.99867 11.6778 7.9973 11.3571 8.10614C10.7683 8.306 10.306 8.76834 10.1061 9.35712Z"
      fill="#FF974C"
      stroke="white"
      stroke-width="2"
    />
    <circle cx="19" cy="18" r="4" fill="#EB8B47" stroke="white" stroke-width="2" />
    <circle cx="19" cy="42" r="4" fill="#EB8B47" stroke="white" stroke-width="2" />
  </g>
  <defs>
    <clipPath id="clip0_7734_50402">
      <rect width="60" height="60" fill="white" />
    </clipPath>
  </defs>
</svg> `,KRe=yi`<svg fill="none" viewBox="0 0 60 60">
  <g clip-path="url(#a)">
    <path
      fill="#1DC956"
      d="M0 25.01c0-9.25 0-13.88 1.97-17.33a15 15 0 0 1 5.6-5.6C11.02.11 15.65.11 24.9.11h10.2c9.25 0 13.88 0 17.33 1.97a15 15 0 0 1 5.6 5.6C60 11.13 60 15.76 60 25v10.2c0 9.25 0 13.88-1.97 17.33a15 15 0 0 1-5.6 5.6c-3.45 1.97-8.08 1.97-17.33 1.97H24.9c-9.25 0-13.88 0-17.33-1.97a15 15 0 0 1-5.6-5.6C0 49.1 0 44.46 0 35.21v-10.2Z"
    />
    <path
      fill="#2BEE6C"
      d="M16.1 60c-3.82-.18-6.4-.64-8.53-1.86a15 15 0 0 1-5.6-5.6C.55 50.06.16 46.97.04 41.98L4.2 40.6a4 4 0 0 0 2.48-2.39l4.65-12.4a2 2 0 0 1 2.5-1.2l2.53.84a2 2 0 0 0 2.43-1l2.96-5.94a2 2 0 0 1 3.7.32l3.78 12.58a2 2 0 0 0 3.03 1.09l3.34-2.23a2 2 0 0 0 .65-.7l5.3-9.72a2 2 0 0 1 1.42-1.01l4.14-.69a2 2 0 0 1 1.6.44l3.9 3.24a2 2 0 0 0 2.7-.12l4.62-4.63c.08 2.2.08 4.8.08 7.93v10.2c0 9.25 0 13.88-1.97 17.33a15 15 0 0 1-5.6 5.6c-2.13 1.22-4.7 1.68-8.54 1.86H16.11Z"
    />
    <path
      fill="#fff"
      d="m.07 43.03-.05-2.1 3.85-1.28a3 3 0 0 0 1.86-1.79l4.66-12.4a3 3 0 0 1 3.75-1.8l2.53.84a1 1 0 0 0 1.21-.5l2.97-5.94a3 3 0 0 1 5.56.48l3.77 12.58a1 1 0 0 0 1.51.55l3.34-2.23a1 1 0 0 0 .33-.35l5.3-9.71a3 3 0 0 1 2.14-1.53l4.13-.69a3 3 0 0 1 2.41.66l3.9 3.24a1 1 0 0 0 1.34-.06l5.28-5.28c.05.85.08 1.75.1 2.73L56 22.41a3 3 0 0 1-4.04.19l-3.9-3.25a1 1 0 0 0-.8-.21l-4.13.69a1 1 0 0 0-.72.5l-5.3 9.72a3 3 0 0 1-.97 1.05l-3.34 2.23a3 3 0 0 1-4.53-1.63l-3.78-12.58a1 1 0 0 0-1.85-.16l-2.97 5.94a3 3 0 0 1-3.63 1.5l-2.53-.84a1 1 0 0 0-1.25.6l-4.65 12.4a5 5 0 0 1-3.1 3L.07 43.02Z"
    />
    <path
      fill="#fff"
      fill-rule="evenodd"
      d="M49.5 19a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Z"
      clip-rule="evenodd"
    />
    <path fill="#fff" d="M45 .28v59.66l-2 .1V.19c.7.02 1.37.05 2 .1Z" />
    <path fill="#2BEE6C" d="M47.5 19a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z" />
    <path
      stroke="#fff"
      stroke-opacity=".1"
      d="M.5 25.01c0-4.63 0-8.08.24-10.8.25-2.7.73-4.64 1.66-6.28a14.5 14.5 0 0 1 5.42-5.41C9.46 1.58 11.39 1.1 14.1.85A133 133 0 0 1 24.9.61h10.2c4.63 0 8.08 0 10.8.24 2.7.25 4.65.73 6.28 1.67a14.5 14.5 0 0 1 5.42 5.4c.93 1.65 1.41 3.58 1.66 6.3.24 2.71.24 6.16.24 10.79v10.2c0 4.64 0 8.08-.24 10.8-.25 2.7-.73 4.65-1.66 6.28a14.5 14.5 0 0 1-5.42 5.42c-1.63.93-3.57 1.41-6.28 1.66-2.72.24-6.17.24-10.8.24H24.9c-4.63 0-8.08 0-10.8-.24-2.7-.25-4.64-.73-6.28-1.66a14.5 14.5 0 0 1-5.42-5.42C1.47 50.66 1 48.72.74 46.01A133 133 0 0 1 .5 35.2v-10.2Z"
    />
  </g>
  <defs>
    <clipPath id="a"><path fill="#fff" d="M0 0h60v60H0z" /></clipPath>
  </defs>
</svg>`,YRe=yi`<svg fill="none" viewBox="0 0 60 60">
  <g clip-path="url(#a)">
    <rect width="60" height="60" fill="#C653C6" rx="30" />
    <path
      fill="#E87DE8"
      d="M57.98.01v19.5a4.09 4.09 0 0 0-2.63 2.29L50.7 34.2a2 2 0 0 1-2.5 1.2l-2.53-.84a2 2 0 0 0-2.42 1l-2.97 5.94a2 2 0 0 1-3.7-.32L32.8 28.6a2 2 0 0 0-3.02-1.09l-3.35 2.23a2 2 0 0 0-.64.7l-5.3 9.72a2 2 0 0 1-1.43 1.01l-4.13.69a2 2 0 0 1-1.61-.44l-3.9-3.24a2 2 0 0 0-2.69.12L2.1 42.93.02 43V.01h57.96Z"
    />
    <path
      fill="#fff"
      d="m61.95 16.94.05 2.1-3.85 1.28a3 3 0 0 0-1.86 1.79l-4.65 12.4a3 3 0 0 1-3.76 1.8l-2.53-.84a1 1 0 0 0-1.2.5l-2.98 5.94a3 3 0 0 1-5.55-.48l-3.78-12.58a1 1 0 0 0-1.5-.55l-3.35 2.23a1 1 0 0 0-.32.35l-5.3 9.72a3 3 0 0 1-2.14 1.52l-4.14.69a3 3 0 0 1-2.41-.66l-3.9-3.24a1 1 0 0 0-1.34.06l-5.28 5.28c-.05-.84-.08-1.75-.1-2.73l3.97-3.96a3 3 0 0 1 4.04-.19l3.89 3.25a1 1 0 0 0 .8.21l4.14-.68a1 1 0 0 0 .71-.51l5.3-9.71a3 3 0 0 1 .97-1.06l3.34-2.23a3 3 0 0 1 4.54 1.63l3.77 12.58a1 1 0 0 0 1.86.16l2.96-5.93a3 3 0 0 1 3.64-1.5l2.52.83a1 1 0 0 0 1.25-.6l4.66-12.4a5 5 0 0 1 3.1-2.99l4.43-1.48Z"
    />
    <path
      fill="#fff"
      fill-rule="evenodd"
      d="M35.5 27a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Z"
      clip-rule="evenodd"
    />
    <path fill="#fff" d="M31 0v60h-2V0h2Z" />
    <path fill="#E87DE8" d="M33.5 27a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z" />
  </g>
  <rect width="59" height="59" x=".5" y=".5" stroke="#fff" stroke-opacity=".1" rx="29.5" />
  <defs>
    <clipPath id="a"><rect width="60" height="60" fill="#fff" rx="30" /></clipPath>
  </defs>
</svg> `,XRe=yi`<svg fill="none" viewBox="0 0 60 60">
  <g clip-path="url(#a)">
    <rect width="60" height="60" fill="#987DE8" rx="30" />
    <path
      fill="#fff"
      fill-rule="evenodd"
      d="m15.48 28.37 11.97-19.3a3 3 0 0 1 5.1 0l11.97 19.3a6 6 0 0 1 .9 3.14v.03a6 6 0 0 1-1.16 3.56L33.23 50.2a4 4 0 0 1-6.46 0L15.73 35.1a6 6 0 0 1-1.15-3.54v-.03a6 6 0 0 1 .9-3.16Z"
      clip-rule="evenodd"
    />
    <path
      fill="#643CDD"
      d="M30.84 10.11a1 1 0 0 0-.84-.46V24.5l12.6 5.53a2 2 0 0 0-.28-1.4L30.84 10.11Z"
    />
    <path
      fill="#BDADEB"
      d="M30 9.65a1 1 0 0 0-.85.46L17.66 28.64a2 2 0 0 0-.26 1.39L30 24.5V9.65Z"
    />
    <path
      fill="#643CDD"
      d="M30 50.54a1 1 0 0 0 .8-.4l11.24-15.38c.3-.44-.2-1-.66-.73l-9.89 5.68a3 3 0 0 1-1.5.4v10.43Z"
    />
    <path
      fill="#BDADEB"
      d="m17.97 34.76 11.22 15.37c.2.28.5.41.8.41V40.11a3 3 0 0 1-1.49-.4l-9.88-5.68c-.47-.27-.97.3-.65.73Z"
    />
    <path
      fill="#401AB3"
      d="M42.6 30.03 30 24.5v13.14a3 3 0 0 0 1.5-.4l10.14-5.83a2 2 0 0 0 .95-1.38Z"
    />
    <path
      fill="#7C5AE2"
      d="M30 37.64V24.46l-12.6 5.57a2 2 0 0 0 .97 1.39l10.13 5.82a3 3 0 0 0 1.5.4Z"
    />
  </g>
  <rect width="59" height="59" x=".5" y=".5" stroke="#fff" stroke-opacity=".1" rx="29.5" />
  <defs>
    <clipPath id="a"><rect width="60" height="60" fill="#fff" rx="30" /></clipPath>
  </defs>
</svg> `,JRe=yi`<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="64" height="64" rx="30" fill="#1DC956"/>
  <rect x="0.5" y="0.5" width="63" height="63" rx="29.5" stroke="#141414" stroke-opacity="0.1"/>
  <path d="M32.4053 19.8031C35.3901 19.8031 38.0431 20.8349 40.1619 22.8247L45.9656 17.0211C42.4465 13.7416 37.8773 11.7333 32.4053 11.7333C24.4829 11.7333 17.6475 16.2841 14.3127 22.9168L21.056 28.1493C22.6589 23.359 27.136 19.8031 32.4053 19.8031Z" fill="#1DC956" stroke="white" stroke-width="2" stroke-linejoin="round"/>
  <path d="M32.4053 52.2667C37.8773 52.2667 42.465 50.4611 45.8182 47.3658L39.2407 42.2623C37.4351 43.4783 35.1321 44.2153 32.4053 44.2153C27.136 44.2153 22.6589 40.6594 21.056 35.8691L14.3127 41.1016C17.6475 47.7159 24.4829 52.2667 32.4053 52.2667Z" fill="#2BEE6C"/>
  <path d="M21.056 35.8507L19.5636 36.993L14.3127 41.0832M39.2407 42.2623L45.8182 47.3658C42.465 50.4611 37.8773 52.2667 32.4053 52.2667C24.4829 52.2667 17.6475 47.7159 14.3127 41.1016L21.056 35.8691C22.6589 40.6594 27.136 44.2153 32.4053 44.2153C35.1321 44.2153 37.4351 43.4783 39.2407 42.2623Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
  <path d="M51.8613 32.4606C51.8613 31.0235 51.7323 29.6417 51.4928 28.3151H32.4053V36.1638H43.3124C42.8334 38.688 41.3963 40.8252 39.2407 42.2623L45.8181 47.3658C49.6503 43.8283 51.8613 38.6327 51.8613 32.4606Z" fill="#1FAD7E" stroke="white" stroke-width="2" stroke-linejoin="round"/>
  <path d="M21.056 35.8507C20.6507 34.6347 20.4111 33.345 20.4111 32C20.4111 30.655 20.6507 29.3653 21.056 28.1493L14.3127 22.9169C12.9309 25.6437 12.1387 28.7205 12.1387 32C12.1387 35.2795 12.9309 38.3564 14.3127 41.0831L19.5636 36.993L21.056 35.8507Z" fill="#86F999"/>
  <path d="M21.056 35.8691L14.3127 41.1016M21.056 35.8507C20.6507 34.6347 20.4111 33.345 20.4111 32C20.4111 30.655 20.6507 29.3653 21.056 28.1493L14.3127 22.9169C12.9309 25.6437 12.1387 28.7205 12.1387 32C12.1387 35.2795 12.9309 38.3564 14.3127 41.0831L19.5636 36.993L21.056 35.8507Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
</svg>
`,QRe=yi`<svg fill="none" viewBox="0 0 60 60">
  <rect width="60" height="60" fill="#1DC956" rx="3" />
  <path
    fill="#1FAD7E"
    stroke="#fff"
    stroke-width="2"
    d="m30.49 29.13-.49-.27-.49.27-12.77 7.1-.05.02c-.86.48-1.58.88-2.1 1.24-.54.37-1.04.81-1.28 1.45a3 3 0 0 0 0 2.12c.24.63.74 1.08 1.27 1.45.53.36 1.25.76 2.11 1.24l.05.03 6.33 3.51.17.1c2.33 1.3 3.72 2.06 5.22 2.32a9 9 0 0 0 3.08 0c1.5-.26 2.9-1.03 5.22-2.32l.18-.1 6.32-3.51.05-.03a26.9 26.9 0 0 0 2.1-1.24 3.21 3.21 0 0 0 1.28-1.45l-.94-.35.94.35a3 3 0 0 0 0-2.12l-.94.35.94-.35a3.21 3.21 0 0 0-1.27-1.45c-.53-.36-1.25-.76-2.11-1.24l-.05-.03-12.77-7.1Z"
  />
  <path
    fill="#2BEE6C"
    stroke="#fff"
    stroke-width="2"
    d="m30.49 19.13-.49-.27-.49.27-12.77 7.1-.05.02c-.86.48-1.58.88-2.1 1.24-.54.37-1.04.81-1.28 1.45a3 3 0 0 0 0 2.12c.24.63.74 1.08 1.27 1.45.53.36 1.25.76 2.11 1.24l.05.03 6.33 3.51.17.1c2.33 1.3 3.72 2.06 5.22 2.32a9 9 0 0 0 3.08 0c1.5-.26 2.9-1.03 5.22-2.32l.18-.1 6.32-3.51.05-.03a26.9 26.9 0 0 0 2.1-1.24 3.21 3.21 0 0 0 1.28-1.45l-.94-.35.94.35a3 3 0 0 0 0-2.12l-.94.35.94-.35a3.21 3.21 0 0 0-1.27-1.45c-.53-.36-1.25-.76-2.11-1.24l-.05-.03-12.77-7.1Z"
  />
  <path
    fill="#86F999"
    stroke="#fff"
    stroke-width="2"
    d="m46.69 21.06-.94-.35.94.35a3 3 0 0 0 0-2.12l-.94.35.94-.35a3.21 3.21 0 0 0-1.27-1.45c-.53-.36-1.25-.76-2.11-1.24l-.05-.03-6.32-3.51-.18-.1c-2.33-1.3-3.72-2.06-5.22-2.33a9 9 0 0 0-3.08 0c-1.5.27-2.9 1.04-5.22 2.33l-.17.1-6.33 3.51-.05.03c-.86.48-1.58.88-2.1 1.24-.54.37-1.04.81-1.28 1.45a3 3 0 0 0 0 2.12c.24.63.74 1.08 1.27 1.45.53.36 1.25.76 2.11 1.24l.05.03 6.33 3.51.17.1c2.33 1.3 3.72 2.06 5.22 2.32a9 9 0 0 0 3.08 0c1.5-.26 2.9-1.03 5.22-2.32l.18-.1 6.32-3.51.05-.03a26.9 26.9 0 0 0 2.1-1.24 3.21 3.21 0 0 0 1.28-1.45Z"
  />
  <rect width="59" height="59" x=".5" y=".5" stroke="#fff" stroke-opacity=".1" rx="2.5" />
</svg>`,e8e=yi`<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g clip-path="url(#clip0_241_31636)">
    <path d="M0 26.5595C0 16.6913 0 11.7572 2.1019 8.07217C3.5216 5.58318 5.58366 3.52111 8.07266 2.10141C11.7577 -0.000488281 16.6918 -0.000488281 26.56 -0.000488281H37.44C47.3082 -0.000488281 52.2423 -0.000488281 55.9273 2.10141C58.4163 3.52111 60.4784 5.58318 61.8981 8.07217C64 11.7572 64 16.6913 64 26.5595V37.4395C64 47.3077 64 52.2418 61.8981 55.9269C60.4784 58.4159 58.4163 60.4779 55.9273 61.8976C52.2423 63.9995 47.3082 63.9995 37.44 63.9995H26.56C16.6918 63.9995 11.7577 63.9995 8.07266 61.8976C5.58366 60.4779 3.5216 58.4159 2.1019 55.9269C0 52.2418 0 47.3077 0 37.4395V26.5595Z" fill="#794CFF"/>
    <path d="M0.5 26.5595C0.5 21.6163 0.50047 17.942 0.760736 15.0418C1.02039 12.1485 1.53555 10.0742 2.53621 8.3199C3.91155 5.90869 5.90917 3.91106 8.32039 2.53572C10.0747 1.53506 12.1489 1.01991 15.0423 0.760247C17.9425 0.499981 21.6168 0.499512 26.56 0.499512H37.44C42.3832 0.499512 46.0575 0.499981 48.9577 0.760247C51.8511 1.01991 53.9253 1.53506 55.6796 2.53572C58.0908 3.91106 60.0885 5.90869 61.4638 8.3199C62.4645 10.0742 62.9796 12.1485 63.2393 15.0418C63.4995 17.942 63.5 21.6163 63.5 26.5595V37.4395C63.5 42.3827 63.4995 46.057 63.2393 48.9572C62.9796 51.8506 62.4645 53.9248 61.4638 55.6791C60.0885 58.0903 58.0908 60.088 55.6796 61.4633C53.9253 62.464 51.8511 62.9791 48.9577 63.2388C46.0575 63.499 42.3832 63.4995 37.44 63.4995H26.56C21.6168 63.4995 17.9425 63.499 15.0423 63.2388C12.1489 62.9791 10.0747 62.464 8.32039 61.4633C5.90917 60.088 3.91155 58.0903 2.53621 55.6791C1.53555 53.9248 1.02039 51.8506 0.760736 48.9572C0.50047 46.057 0.5 42.3827 0.5 37.4395V26.5595Z" stroke="#141414" stroke-opacity="0.1"/>
    <path d="M40 39.4595C44.7824 36.693 48 31.5222 48 25.6C48 16.7634 40.8366 9.59998 32 9.59998C23.1634 9.59998 16 16.7634 16 25.6C16 31.5222 19.2176 36.693 24 39.4595V45.8144H40V39.4595Z" fill="#906EF7"/>
    <path d="M24 49.9689C24 51.8192 24 52.7444 24.3941 53.4353C24.6603 53.902 25.0469 54.2886 25.5136 54.5548C26.2046 54.9489 27.1297 54.9489 28.98 54.9489H35.02C36.8703 54.9489 37.7954 54.9489 38.4864 54.5548C38.9531 54.2886 39.3397 53.902 39.6059 53.4353C40 52.7444 40 51.8192 40 49.9689V45.8144H24V49.9689Z" fill="#906EF7"/>
    <path d="M24 45.8144V39.4595C19.2176 36.693 16 31.5222 16 25.6C16 16.7634 23.1634 9.59998 32 9.59998C40.8366 9.59998 48 16.7634 48 25.6C48 31.5222 44.7824 36.693 40 39.4595V45.8144M24 45.8144H40M24 45.8144V49.9689C24 51.8192 24 52.7444 24.3941 53.4353C24.6603 53.902 25.0469 54.2886 25.5136 54.5548C26.2046 54.9489 27.1297 54.9489 28.98 54.9489H35.02C36.8703 54.9489 37.7954 54.9489 38.4864 54.5548C38.9531 54.2886 39.3397 53.902 39.6059 53.4353C40 52.7444 40 51.8192 40 49.9689V45.8144" stroke="white" stroke-width="2" stroke-linejoin="round"/>
    <path d="M24 49.9689C24 51.8192 24 52.7444 24.3941 53.4353C24.6603 53.902 25.0469 54.2886 25.5136 54.5548C26.2046 54.9489 27.1297 54.9489 28.98 54.9489H35.02C36.8703 54.9489 37.7954 54.9489 38.4864 54.5548C38.9531 54.2886 39.3397 53.902 39.6059 53.4353C40 52.7444 40 51.8192 40 49.9689V45.8144H24V49.9689Z" fill="#643CDD" stroke="white" stroke-width="2" stroke-linejoin="round"/>
    <path d="M29.6735 26.9101V29.1109H34.0753V26.9101C34.0753 25.6945 35.0607 24.7092 36.2762 24.7092C37.4917 24.7092 38.4771 25.6945 38.4771 26.9101C38.4771 28.1256 37.4917 29.1109 36.2762 29.1109H34.0753H29.6735H27.4726C26.2571 29.1109 25.2717 28.1256 25.2717 26.9101C25.2717 25.6945 26.2571 24.7092 27.4726 24.7092C28.6881 24.7092 29.6735 25.6945 29.6735 26.9101Z" fill="#906EF7"/>
    <path d="M29.6735 45.3183V26.9101C29.6735 25.6945 28.6881 24.7092 27.4726 24.7092V24.7092C26.2571 24.7092 25.2717 25.6945 25.2717 26.9101V26.9101C25.2717 28.1256 26.2571 29.1109 27.4726 29.1109H36.2762C37.4917 29.1109 38.4771 28.1256 38.4771 26.9101V26.9101C38.4771 25.6945 37.4917 24.7092 36.2762 24.7092V24.7092C35.0607 24.7092 34.0753 25.6945 34.0753 26.9101V45.3183" stroke="white" stroke-width="2" stroke-linejoin="round"/>
  </g>
  <defs>
    <clipPath id="clip0_241_31636">
      <rect width="64" height="64" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,t8e=yi`<svg fill="none" viewBox="0 0 60 60">
  <rect width="60" height="60" fill="#C653C6" rx="3" />
  <path
    fill="#fff"
    d="M20.03 15.22C20 15.6 20 16.07 20 17v2.8c0 1.14 0 1.7-.2 2.12-.15.31-.3.5-.58.71-.37.28-1.06.42-2.43.7-.59.12-1.11.29-1.6.51a9 9 0 0 0-4.35 4.36C10 30 10 32.34 10 37c0 4.66 0 7 .84 8.8a9 9 0 0 0 4.36 4.36C17 51 19.34 51 24 51h12c4.66 0 7 0 8.8-.84a9 9 0 0 0 4.36-4.36C50 44 50 41.66 50 37c0-4.66 0-7-.84-8.8a9 9 0 0 0-4.36-4.36c-.48-.22-1-.39-1.6-.5-1.36-.29-2.05-.43-2.42-.7-.27-.22-.43-.4-.58-.72-.2-.42-.2-.98-.2-2.11V17c0-.93 0-1.4-.03-1.78a9 9 0 0 0-8.19-8.19C31.4 7 30.93 7 30 7s-1.4 0-1.78.03a9 9 0 0 0-8.19 8.19Z"
  />
  <path
    fill="#E87DE8"
    d="M22 17c0-.93 0-1.4.04-1.78a7 7 0 0 1 6.18-6.18C28.6 9 29.07 9 30 9s1.4 0 1.78.04a7 7 0 0 1 6.18 6.18c.04.39.04.85.04 1.78v4.5a1.5 1.5 0 0 1-3 0V17c0-.93 0-1.4-.08-1.78a4 4 0 0 0-3.14-3.14C31.39 12 30.93 12 30 12s-1.4 0-1.78.08a4 4 0 0 0-3.14 3.14c-.08.39-.08.85-.08 1.78v4.5a1.5 1.5 0 0 1-3 0V17Z"
  />
  <path
    fill="#E87DE8"
    fill-rule="evenodd"
    d="M12 36.62c0-4.32 0-6.48.92-8.09a7 7 0 0 1 2.61-2.61C17.14 25 19.3 25 23.62 25h6.86c.46 0 .7 0 .9.02 2.73.22 4.37 2.43 4.62 4.98.27-2.7 2.11-5 5.02-5A6.98 6.98 0 0 1 48 31.98v5.4c0 4.32 0 6.48-.92 8.09a7 7 0 0 1-2.61 2.61c-1.61.92-3.77.92-8.09.92h-5.86c-.46 0-.7 0-.9-.02-2.73-.22-4.37-2.43-4.62-4.98-.26 2.58-1.94 4.82-4.71 4.99l-.7.01c-.55 0-.82 0-1.05-.02a7 7 0 0 1-6.52-6.52c-.02-.23-.02-.5-.02-1.05v-4.79Zm21.24-.27a4 4 0 1 0-6.48 0 31.28 31.28 0 0 1 1.57 2.23c.17.4.17.81.17 1.24V42.5a1.5 1.5 0 0 0 3 0V39.82c0-.43 0-.85.17-1.24.09-.2.58-.87 1.57-2.23Z"
    clip-rule="evenodd"
  />
  <rect width="59" height="59" x=".5" y=".5" stroke="#fff" stroke-opacity=".1" rx="2.5" />
</svg>`,n8e=yi`<svg fill="none" viewBox="0 0 60 60">
  <g clip-path="url(#a)">
    <path
      fill="#EB8B47"
      d="M0 24.9c0-9.25 0-13.88 1.97-17.33a15 15 0 0 1 5.6-5.6C11.02 0 15.65 0 24.9 0h10.2c9.25 0 13.88 0 17.33 1.97a15 15 0 0 1 5.6 5.6C60 11.02 60 15.65 60 24.9v10.2c0 9.25 0 13.88-1.97 17.33a15 15 0 0 1-5.6 5.6C48.98 60 44.35 60 35.1 60H24.9c-9.25 0-13.88 0-17.33-1.97a15 15 0 0 1-5.6-5.6C0 48.98 0 44.35 0 35.1V24.9Z"
    />
    <path
      stroke="#062B2B"
      stroke-opacity=".1"
      d="M.5 24.9c0-4.64 0-8.08.24-10.8.25-2.7.73-4.65 1.66-6.28A14.5 14.5 0 0 1 7.82 2.4C9.46 1.47 11.39 1 14.1.74A133 133 0 0 1 24.9.5h10.2c4.63 0 8.08 0 10.8.24 2.7.25 4.65.73 6.28 1.66a14.5 14.5 0 0 1 5.42 5.42c.93 1.63 1.41 3.57 1.66 6.28.24 2.72.24 6.16.24 10.8v10.2c0 4.63 0 8.08-.24 10.8-.25 2.7-.73 4.64-1.66 6.28a14.5 14.5 0 0 1-5.42 5.41c-1.63.94-3.57 1.42-6.28 1.67-2.72.24-6.17.24-10.8.24H24.9c-4.63 0-8.08 0-10.8-.24-2.7-.25-4.64-.73-6.28-1.67a14.5 14.5 0 0 1-5.42-5.4C1.47 50.53 1 48.6.74 45.88A133 133 0 0 1 .5 35.1V24.9Z"
    />
    <path
      fill="#FF974C"
      stroke="#fff"
      stroke-width="2"
      d="M39.2 29.2a13 13 0 1 0-18.4 0l1.3 1.28a12.82 12.82 0 0 1 2.1 2.39 6 6 0 0 1 .6 1.47c.2.76.2 1.56.2 3.17v11.24c0 1.08 0 1.61.13 2.12a4 4 0 0 0 .41.98c.26.45.64.83 1.4 1.6l.3.29c.65.65.98.98 1.36 1.09.26.07.54.07.8 0 .38-.11.7-.44 1.36-1.1l3.48-3.47c.65-.65.98-.98 1.09-1.36a1.5 1.5 0 0 0 0-.8c-.1-.38-.44-.7-1.1-1.36l-.47-.48c-.65-.65-.98-.98-1.09-1.36a1.5 1.5 0 0 1 0-.8c.1-.38.44-.7 1.1-1.36l.47-.48c.65-.65.98-.98 1.09-1.36a1.5 1.5 0 0 0 0-.8c-.1-.38-.44-.7-1.1-1.36l-.48-.5c-.65-.64-.98-.97-1.08-1.35a1.5 1.5 0 0 1 0-.79c.1-.38.42-.7 1.06-1.36l5.46-5.55Z"
    />
    <circle cx="30" cy="17" r="4" fill="#EB8B47" stroke="#fff" stroke-width="2" />
  </g>
  <defs>
    <clipPath id="a"><path fill="#fff" d="M0 0h60v60H0z" /></clipPath>
  </defs>
</svg> `,i8e=yi`<svg width="40" height="42" viewBox="0 0 40 42" fill="none">
<path opacity="0.7" d="M19.9526 41.9076L7.3877 34.655V26.1226L19.9526 33.3751V41.9076Z" fill="url(#paint0_linear_2113_32117)"/>
<path opacity="0.7" d="M19.9521 41.9076L32.5171 34.655V26.1226L19.9521 33.3751V41.9076Z" fill="url(#paint1_linear_2113_32117)"/>
<path opacity="0.7" d="M39.9095 7.34521V21.8562L32.5166 26.1225V11.6114L39.9095 7.34521Z" fill="url(#paint2_linear_2113_32117)"/>
<path d="M39.9099 7.34536L27.345 0.0927734L19.9521 4.359L32.5171 11.6116L39.9099 7.34536Z" fill="url(#paint3_linear_2113_32117)"/>
<path d="M0 7.34536L12.5649 0.0927734L19.9519 4.359L7.387 11.6116L0 7.34536Z" fill="#F969D3"/>
<path opacity="0.7" d="M0 7.34521V21.8562L7.387 26.1225V11.6114L0 7.34521Z" fill="url(#paint4_linear_2113_32117)"/>
<defs>
<linearGradient id="paint0_linear_2113_32117" x1="18.6099" y1="41.8335" x2="7.73529" y2="8.31842" gradientUnits="userSpaceOnUse">
<stop stop-color="#E98ADA"/>
<stop offset="1" stop-color="#7E4DBD"/>
</linearGradient>
<linearGradient id="paint1_linear_2113_32117" x1="26.2346" y1="26.1226" x2="26.2346" y2="41.9076" gradientUnits="userSpaceOnUse">
<stop stop-color="#719DED"/>
<stop offset="1" stop-color="#2545BE"/>
</linearGradient>
<linearGradient id="paint2_linear_2113_32117" x1="36.213" y1="7.34521" x2="36.213" y2="26.1225" gradientUnits="userSpaceOnUse">
<stop stop-color="#93EBFF"/>
<stop offset="1" stop-color="#197DDB"/>
</linearGradient>
<linearGradient id="paint3_linear_2113_32117" x1="29.931" y1="0.0927734" x2="38.2156" y2="14.8448" gradientUnits="userSpaceOnUse">
<stop stop-color="#F969D3"/>
<stop offset="1" stop-color="#4F51C0"/>
</linearGradient>
<linearGradient id="paint4_linear_2113_32117" x1="18.1251" y1="44.2539" x2="-7.06792" y2="15.2763" gradientUnits="userSpaceOnUse">
<stop stop-color="#E98ADA"/>
<stop offset="1" stop-color="#7E4DBD"/>
</linearGradient>
</defs>
</svg>`,r8e=yi`<svg fill="none" viewBox="0 0 60 60">
  <g clip-path="url(#a)">
    <rect width="60" height="60" fill="#00ACE6" rx="30" />
    <circle cx="64" cy="39" r="50" fill="#1AC6FF" stroke="#fff" stroke-width="2" />
    <circle cx="78" cy="30" r="50" fill="#4DD2FF" stroke="#fff" stroke-width="2" />
    <circle cx="72" cy="15" r="35" fill="#80DFFF" stroke="#fff" stroke-width="2" />
    <circle cx="34" cy="-17" r="45" stroke="#fff" stroke-width="2" />
    <circle cx="34" cy="-5" r="50" stroke="#fff" stroke-width="2" />
    <circle cx="30" cy="45" r="4" fill="#4DD2FF" stroke="#fff" stroke-width="2" />
    <circle cx="39.5" cy="27.5" r="4" fill="#80DFFF" stroke="#fff" stroke-width="2" />
    <circle cx="16" cy="24" r="4" fill="#19C6FF" stroke="#fff" stroke-width="2" />
  </g>
  <rect width="59" height="59" x=".5" y=".5" stroke="#062B2B" stroke-opacity=".1" rx="29.5" />
  <defs>
    <clipPath id="a"><rect width="60" height="60" fill="#fff" rx="30" /></clipPath>
  </defs>
</svg>`,s8e=yi`<svg fill="none" viewBox="0 0 60 60">
  <g clip-path="url(#a)">
    <rect width="60" height="60" fill="#C653C6" rx="3" />
    <path
      fill="#E87DE8"
      stroke="#fff"
      stroke-width="2"
      d="M52.1 47.34c0-4.24-1.44-9.55-5.9-12.4a2.86 2.86 0 0 0-1.6-3.89v-.82c0-1.19-.52-2.26-1.35-3a4.74 4.74 0 0 0-2.4-6.26v-5.5a11.31 11.31 0 1 0-22.63 0v2.15a3.34 3.34 0 0 0-1.18 5.05 4.74 4.74 0 0 0-.68 6.44A5.22 5.22 0 0 0 14 35.92c-3.06 4.13-6.1 8.3-6.1 15.64 0 2.67.37 4.86.74 6.39a20.3 20.3 0 0 0 .73 2.39l.02.04v.01l.92-.39-.92.4.26.6h38.26l.3-.49-.87-.51.86.5.02-.01.03-.07a16.32 16.32 0 0 0 .57-1.05c.36-.72.85-1.74 1.33-2.96a25.51 25.51 0 0 0 1.94-9.07Z"
    />
    <path
      fill="#fff"
      fill-rule="evenodd"
      d="M26.5 29.5c-3-.5-5.5-3-5.5-7v-7c0-.47 0-.7.03-.9a3 3 0 0 1 2.58-2.57c.2-.03.42-.03.89-.03 2 0 2.5-2.5 2.5-2.5s0 2.5 2.5 2.5c1.4 0 2.1 0 2.65.23a3 3 0 0 1 1.62 1.62c.23.55.23 1.25.23 2.65v6c0 4-3 7-6.5 7 1.35.23 4 0 6.5-2v9.53C34 38.5 31.5 40 28 40s-6-1.5-6-2.97L24 34l2.5 1.5v-6ZM26 47h4.5c2.5 0 3 4 3 5.5h-3l-1-1.5H26v-4Zm-6.25 5.5H24V57h-8c0-1 1-4.5 3.75-4.5Z"
      clip-rule="evenodd"
    />
  </g>
  <rect width="59" height="59" x=".5" y=".5" stroke="#fff" stroke-opacity=".1" rx="2.5" />
  <defs>
    <clipPath id="a"><rect width="60" height="60" fill="#fff" rx="3" /></clipPath>
  </defs>
</svg> `,o8e=yi`<svg fill="none" viewBox="0 0 60 60">
  <rect width="60" height="60" fill="#794CFF" rx="3" />
  <path
    fill="#987DE8"
    stroke="#fff"
    stroke-width="2"
    d="M33 22.5v-1H16v5H8.5V36H13v-5h3v7.5h17V31h1v7.5h17v-17H34v5h-1v-4Z"
  />
  <path fill="#fff" d="M37.5 25h10v10h-10z" />
  <path fill="#4019B2" d="M42.5 25h5v10h-5z" />
  <path fill="#fff" d="M19.5 25h10v10h-10z" />
  <path fill="#4019B2" d="M24.5 25h5v10h-5z" />
  <path fill="#fff" d="M12 30.5h4V37h-4v-6.5Z" />
  <rect width="59" height="59" x=".5" y=".5" stroke="#fff" stroke-opacity=".1" rx="2.5" />
</svg>`,a8e=yi`<svg width="60" height="60" viewBox="0 0 60 60" fill="none">
<g clip-path="url(#clip0_13859_31161)">
  <path d="M0 24.8995C0 15.6481 0 11.0223 1.97053 7.56763C3.3015 5.2342 5.23468 3.30101 7.56812 1.97004C11.0228 -0.000488281 15.6485 -0.000488281 24.9 -0.000488281H35.1C44.3514 -0.000488281 48.9772 -0.000488281 52.4319 1.97004C54.7653 3.30101 56.6985 5.2342 58.0295 7.56763C60 11.0223 60 15.6481 60 24.8995V35.0995C60 44.351 60 48.9767 58.0295 52.4314C56.6985 54.7648 54.7653 56.698 52.4319 58.029C48.9772 59.9995 44.3514 59.9995 35.1 59.9995H24.9C15.6485 59.9995 11.0228 59.9995 7.56812 58.029C5.23468 56.698 3.3015 54.7648 1.97053 52.4314C0 48.9767 0 44.351 0 35.0995V24.8995Z" fill="#EB8B47"/>
  <path d="M0.5 24.8995C0.5 20.2647 0.50047 16.8216 0.744315 14.1045C0.987552 11.3941 1.46987 9.45455 2.40484 7.81536C3.69145 5.55971 5.56019 3.69096 7.81585 2.40435C9.45504 1.46938 11.3946 0.987064 14.105 0.743826C16.8221 0.499981 20.2652 0.499512 24.9 0.499512H35.1C39.7348 0.499512 43.1779 0.499981 45.895 0.743826C48.6054 0.987064 50.545 1.46938 52.1841 2.40435C54.4398 3.69096 56.3086 5.55971 57.5952 7.81536C58.5301 9.45455 59.0124 11.3941 59.2557 14.1045C59.4995 16.8216 59.5 20.2647 59.5 24.8995V35.0995C59.5 39.7343 59.4995 43.1774 59.2557 45.8945C59.0124 48.6049 58.5301 50.5445 57.5952 52.1837C56.3086 54.4393 54.4398 56.3081 52.1841 57.5947C50.545 58.5296 48.6054 59.012 45.895 59.2552C43.1779 59.499 39.7348 59.4995 35.1 59.4995H24.9C20.2652 59.4995 16.8221 59.499 14.105 59.2552C11.3946 59.012 9.45504 58.5296 7.81585 57.5947C5.56019 56.3081 3.69145 54.4393 2.40484 52.1837C1.46987 50.5445 0.987552 48.6049 0.744315 45.8945C0.50047 43.1774 0.5 39.7343 0.5 35.0995V24.8995Z" stroke="#141414" stroke-opacity="0.1"/>
  <path d="M13 26.0335C13 21.7838 13 19.659 14.0822 18.1694C14.4318 17.6883 14.8548 17.2653 15.3359 16.9157C16.8255 15.8335 18.9503 15.8335 23.2 15.8335H36.8C41.0497 15.8335 43.1745 15.8335 44.6641 16.9157C45.1452 17.2653 45.5682 17.6883 45.9178 18.1694C47 19.659 47 21.7838 47 26.0335V33.9668C47 38.2165 47 40.3414 45.9178 41.831C45.5682 42.312 45.1452 42.7351 44.6641 43.0846C43.1745 44.1668 41.0497 44.1668 36.8 44.1668H23.2C18.9503 44.1668 16.8255 44.1668 15.3359 43.0846C14.8548 42.7351 14.4318 42.312 14.0822 41.831C13 40.3414 13 38.2165 13 33.9668V26.0335Z" fill="#FF974C" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M39.5 36.667H36.6666" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M45.2 23.0645H14.8C14.0501 23.0645 13.6751 23.0645 13.4122 23.2554C13.3273 23.3171 13.2527 23.3918 13.191 23.4767C13 23.7395 13 24.1145 13 24.8645V27.2645C13 28.0144 13 28.3894 13.191 28.6522C13.2527 28.7371 13.3273 28.8118 13.4122 28.8735C13.6751 29.0645 14.0501 29.0645 14.8 29.0645H45.2C45.9499 29.0645 46.3249 29.0645 46.5878 28.8735C46.6727 28.8118 46.7473 28.7371 46.809 28.6522C47 28.3894 47 28.0144 47 27.2645V24.8645C47 24.1145 47 23.7395 46.809 23.4767C46.7473 23.3918 46.6727 23.3171 46.5878 23.2554C46.3249 23.0645 45.9499 23.0645 45.2 23.0645Z" fill="white" fill-opacity="0.4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</g>
<defs>
  <clipPath id="clip0_13859_31161">
    <rect width="60" height="60" fill="white"/>
  </clipPath>
</defs>
</svg>`,c8e=yi`<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g clip-path="url(#clip0_241_31635)">
    <path d="M0 26.5595C0 16.6913 0 11.7572 2.1019 8.07217C3.5216 5.58317 5.58366 3.52111 8.07266 2.10141C11.7577 -0.000488281 16.6918 -0.000488281 26.56 -0.000488281H37.44C47.3082 -0.000488281 52.2423 -0.000488281 55.9273 2.10141C58.4163 3.52111 60.4784 5.58317 61.8981 8.07217C64 11.7572 64 16.6913 64 26.5595V37.4395C64 47.3077 64 52.2418 61.8981 55.9268C60.4784 58.4158 58.4163 60.4779 55.9273 61.8976C52.2423 63.9995 47.3082 63.9995 37.44 63.9995H26.56C16.6918 63.9995 11.7577 63.9995 8.07266 61.8976C5.58366 60.4779 3.5216 58.4158 2.1019 55.9268C0 52.2418 0 47.3077 0 37.4395V26.5595Z" fill="#EB8B47"/>
    <path d="M0.5 26.5595C0.5 21.6163 0.50047 17.942 0.760736 15.0418C1.02039 12.1485 1.53555 10.0742 2.53621 8.3199C3.91155 5.90869 5.90917 3.91106 8.32039 2.53572C10.0747 1.53506 12.1489 1.01991 15.0423 0.760247C17.9425 0.499981 21.6168 0.499512 26.56 0.499512H37.44C42.3832 0.499512 46.0575 0.499981 48.9577 0.760247C51.8511 1.01991 53.9253 1.53506 55.6796 2.53572C58.0908 3.91106 60.0885 5.90869 61.4638 8.3199C62.4645 10.0742 62.9796 12.1485 63.2393 15.0418C63.4995 17.942 63.5 21.6163 63.5 26.5595V37.4395C63.5 42.3827 63.4995 46.057 63.2393 48.9572C62.9796 51.8506 62.4645 53.9248 61.4638 55.6791C60.0885 58.0903 58.0908 60.088 55.6796 61.4633C53.9253 62.464 51.8511 62.9791 48.9577 63.2388C46.0575 63.499 42.3832 63.4995 37.44 63.4995H26.56C21.6168 63.4995 17.9425 63.499 15.0423 63.2388C12.1489 62.9791 10.0747 62.464 8.32039 61.4633C5.90917 60.088 3.91155 58.0903 2.53621 55.6791C1.53555 53.9248 1.02039 51.8506 0.760736 48.9572C0.50047 46.057 0.5 42.3827 0.5 37.4395V26.5595Z" stroke="#141414" stroke-opacity="0.1"/>
    <path d="M28.1042 49.2329L13.1024 51.2077L15.0772 36.2059L37.1015 14.1815C39.2441 12.039 40.3154 10.9677 41.5718 10.624C42.4205 10.3918 43.3159 10.3918 44.1645 10.624C45.421 10.9677 46.4922 12.039 48.6348 14.1815L50.1286 15.6753C52.2711 17.8179 53.3424 18.8891 53.6861 20.1456C53.9183 20.9942 53.9183 21.8896 53.6861 22.7383C53.3424 23.9947 52.2711 25.066 50.1286 27.2086L28.1042 49.2329Z" fill="#FF974C" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M38.5962 20.5376L22.4199 36.7139" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M43.7727 25.714L27.5964 41.8903" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M22.3703 36.7635C19.3258 39.808 16.0198 36.6395 16.2616 35.0324" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M27.5466 41.9399C24.5034 44.9831 28.155 48.7098 29.2738 48.0475" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M27.5468 41.9398C23.428 46.0586 18.2516 40.8822 22.3704 36.7634" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M15.8191 50.5214C15.4711 49.5823 14.728 48.8392 13.7889 48.4912" stroke="#E4E7E7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M49.2862 29.5805L34.7275 15.0219" stroke="#E4E7E7" stroke-width="2" stroke-linejoin="round"/>
  </g>
  <defs>
    <clipPath id="clip0_241_31635">
      <rect width="64" height="64" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,l8e=yi`<svg
  viewBox="0 0 60 60"
  fill="none"
>
  <g clip-path="url(#1)">
    <rect width="60" height="60" rx="30" fill="#00ACE6" />
    <path
      d="M59 73C59 89.0163 46.0163 102 30 102C13.9837 102 1 89.0163 1 73C1 56.9837 12 44 30 44C48 44 59 56.9837 59 73Z"
      fill="#1AC6FF"
      stroke="white"
      stroke-width="2"
    />
    <path
      d="M18.6904 19.9015C19.6264 15.3286 23.3466 11.8445 27.9708 11.2096C29.3231 11.024 30.6751 11.0238 32.0289 11.2096C36.6532 11.8445 40.3733 15.3286 41.3094 19.9015C41.4868 20.7681 41.6309 21.6509 41.7492 22.5271C41.8811 23.5041 41.8811 24.4944 41.7492 25.4715C41.6309 26.3476 41.4868 27.2304 41.3094 28.097C40.3733 32.6699 36.6532 36.154 32.0289 36.7889C30.6772 36.9744 29.3216 36.9743 27.9708 36.7889C23.3466 36.154 19.6264 32.6699 18.6904 28.097C18.513 27.2304 18.3689 26.3476 18.2506 25.4715C18.1186 24.4944 18.1186 23.5041 18.2506 22.5271C18.3689 21.6509 18.513 20.7681 18.6904 19.9015Z"
      fill="#1AC6FF"
      stroke="white"
      stroke-width="2"
    />
    <circle cx="24.5" cy="23.5" r="1.5" fill="white" />
    <circle cx="35.5" cy="23.5" r="1.5" fill="white" />
    <path
      d="M31 20L28 28H32"
      stroke="white"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </g>
  <rect x="0.5" y="0.5" width="59" height="59" rx="29.5" stroke="white" stroke-opacity="0.1" />
  <defs>
    <clipPath id="1">
      <rect width="60" height="60" rx="30" fill="white" />
    </clipPath>
  </defs>
</svg> `,u8e=yi`<svg fill="none" viewBox="0 0 80 80">
  <g clip-path="url(#a)">
    <path fill="url(#b)" d="M40 80a40 40 0 1 0 0-80 40 40 0 0 0 0 80Z" />
    <path
      stroke="#fff"
      stroke-opacity=".1"
      d="M79.5 40a39.5 39.5 0 1 1-79 0 39.5 39.5 0 0 1 79 0Z"
    />
    <path
      fill="#fff"
      d="m62.62 51.54-7.54 7.91a1.75 1.75 0 0 1-1.29.55H18.02a.9.9 0 0 1-.8-.52.84.84 0 0 1 .16-.92l7.55-7.92a1.75 1.75 0 0 1 1.28-.55h35.77a.87.87 0 0 1 .8.52.84.84 0 0 1-.16.93Zm-7.54-15.95a1.75 1.75 0 0 0-1.29-.54H18.02a.89.89 0 0 0-.8.51.84.84 0 0 0 .16.93l7.55 7.92a1.75 1.75 0 0 0 1.28.54h35.77a.89.89 0 0 0 .8-.51.84.84 0 0 0-.16-.93l-7.54-7.92ZM18.02 29.9h35.77a1.79 1.79 0 0 0 1.29-.54l7.54-7.92a.85.85 0 0 0 .16-.93.87.87 0 0 0-.8-.51H26.21a1.79 1.79 0 0 0-1.28.54l-7.55 7.92a.85.85 0 0 0-.16.93.89.89 0 0 0 .8.52Z"
    />
  </g>
  <defs>
    <linearGradient id="b" x1="6.75" x2="80.68" y1="81.91" y2="7.37" gradientUnits="userSpaceOnUse">
      <stop offset=".08" stop-color="#9945FF" />
      <stop offset=".3" stop-color="#8752F3" />
      <stop offset=".5" stop-color="#5497D5" />
      <stop offset=".6" stop-color="#43B4CA" />
      <stop offset=".72" stop-color="#28E0B9" />
      <stop offset=".97" stop-color="#19FB9B" />
    </linearGradient>
    <clipPath id="a"><path fill="#fff" d="M0 0h80v80H0z" /></clipPath>
  </defs>
</svg> `,d8e=yi`<svg viewBox="0 0 60 60" fill="none">
  <g clip-path="url(#1)">
    <path
      d="M0 24.9C0 15.6485 0 11.0228 1.97053 7.56812C3.3015 5.23468 5.23468 3.3015 7.56812 1.97053C11.0228 0 15.6485 0 24.9 0H35.1C44.3514 0 48.9772 0 52.4319 1.97053C54.7653 3.3015 56.6985 5.23468 58.0295 7.56812C60 11.0228 60 15.6485 60 24.9V35.1C60 44.3514 60 48.9772 58.0295 52.4319C56.6985 54.7653 54.7653 56.6985 52.4319 58.0295C48.9772 60 44.3514 60 35.1 60H24.9C15.6485 60 11.0228 60 7.56812 58.0295C5.23468 56.6985 3.3015 54.7653 1.97053 52.4319C0 48.9772 0 44.3514 0 35.1V24.9Z"
      fill="#794CFF"
    />
    <path
      d="M0.5 24.9C0.5 20.2652 0.50047 16.8221 0.744315 14.105C0.987552 11.3946 1.46987 9.45504 2.40484 7.81585C3.69145 5.56019 5.56019 3.69145 7.81585 2.40484C9.45504 1.46987 11.3946 0.987552 14.105 0.744315C16.8221 0.50047 20.2652 0.5 24.9 0.5H35.1C39.7348 0.5 43.1779 0.50047 45.895 0.744315C48.6054 0.987552 50.545 1.46987 52.1841 2.40484C54.4398 3.69145 56.3086 5.56019 57.5952 7.81585C58.5301 9.45504 59.0124 11.3946 59.2557 14.105C59.4995 16.8221 59.5 20.2652 59.5 24.9V35.1C59.5 39.7348 59.4995 43.1779 59.2557 45.895C59.0124 48.6054 58.5301 50.545 57.5952 52.1841C56.3086 54.4398 54.4398 56.3086 52.1841 57.5952C50.545 58.5301 48.6054 59.0124 45.895 59.2557C43.1779 59.4995 39.7348 59.5 35.1 59.5H24.9C20.2652 59.5 16.8221 59.4995 14.105 59.2557C11.3946 59.0124 9.45504 58.5301 7.81585 57.5952C5.56019 56.3086 3.69145 54.4398 2.40484 52.1841C1.46987 50.545 0.987552 48.6054 0.744315 45.895C0.50047 43.1779 0.5 39.7348 0.5 35.1V24.9Z"
      stroke="#062B2B"
      stroke-opacity="0.1"
    />
    <path
      d="M35.1403 31.5016C35.1193 30.9637 35.388 30.4558 35.8446 30.1707C36.1207 29.9982 36.4761 29.8473 36.7921 29.7685C37.3143 29.6382 37.8664 29.7977 38.2386 30.1864C38.8507 30.8257 39.3004 31.6836 39.8033 32.408C40.2796 33.0942 41.4695 33.2512 41.9687 32.5047C42.4839 31.7341 42.9405 30.8229 43.572 30.1399C43.9375 29.7447 44.4866 29.5756 45.0111 29.6967C45.3283 29.7701 45.6863 29.9147 45.9655 30.0823C46.4269 30.3595 46.7045 30.8626 46.6928 31.4008C46.6731 32.3083 46.3764 33.2571 46.2158 34.1473C46.061 35.0048 46.9045 35.8337 47.7592 35.664C48.6464 35.4878 49.5899 35.1747 50.497 35.1391C51.0348 35.1181 51.5427 35.3868 51.8279 35.8433C52.0004 36.1195 52.1513 36.4749 52.2301 36.7908C52.3604 37.3131 52.2009 37.8651 51.8121 38.2374C51.1729 38.8495 50.3151 39.2991 49.5908 39.8019C48.9046 40.2782 48.7473 41.4683 49.4939 41.9675C50.2644 42.4827 51.1757 42.9393 51.8587 43.5708C52.2539 43.9362 52.423 44.4854 52.3018 45.0099C52.2285 45.3271 52.0839 45.6851 51.9162 45.9642C51.6391 46.4257 51.1359 46.7032 50.5978 46.6916C49.6903 46.6719 48.7417 46.3753 47.8516 46.2146C46.9939 46.0598 46.1648 46.9035 46.3346 47.7583C46.5108 48.6454 46.8239 49.5888 46.8594 50.4958C46.8805 51.0336 46.6117 51.5415 46.1552 51.8267C45.879 51.9992 45.5236 52.15 45.2077 52.2289C44.6854 52.3592 44.1334 52.1997 43.7611 51.8109C43.1491 51.1718 42.6996 50.314 42.1968 49.5897C41.7203 48.9034 40.5301 48.7463 40.0309 49.493C39.5157 50.2634 39.0592 51.1746 38.4278 51.8574C38.0623 52.2527 37.5132 52.4218 36.9887 52.3006C36.6715 52.2273 36.3135 52.0826 36.0343 51.915C35.5729 51.6379 35.2953 51.1347 35.307 50.5966C35.3267 49.6891 35.6233 48.7405 35.7839 47.8505C35.9388 46.9928 35.0951 46.1636 34.2402 46.3334C33.3531 46.5096 32.4098 46.8227 31.5028 46.8582C30.9649 46.8793 30.457 46.6105 30.1719 46.154C29.9994 45.8778 29.8485 45.5224 29.7697 45.2065C29.6394 44.6842 29.7989 44.1322 30.1877 43.7599C30.8269 43.1479 31.6847 42.6982 32.4091 42.1954C33.0954 41.7189 33.2522 40.5289 32.5056 40.0297C31.7351 39.5145 30.824 39.058 30.1411 38.4265C29.7459 38.0611 29.5768 37.5119 29.698 36.9875C29.7713 36.6702 29.9159 36.3122 30.0836 36.0331C30.3607 35.5717 30.8638 35.2941 31.402 35.3058C32.3095 35.3255 33.2583 35.6221 34.1485 35.7828C35.006 35.9376 35.8349 35.094 35.6652 34.2393C35.489 33.3521 35.1759 32.4087 35.1403 31.5016Z"
      fill="#906EF7"
      stroke="white"
      stroke-width="2"
    />
    <path
      d="M20.7706 8.22357C20.9036 7.51411 21.5231 7 22.2449 7H23.7551C24.4769 7 25.0964 7.51411 25.2294 8.22357C25.5051 9.69403 25.4829 11.6321 27.1202 12.2606C27.3092 12.3331 27.4958 12.4105 27.6798 12.4926C29.2818 13.2072 30.6374 11.8199 31.8721 10.9752C32.4678 10.5676 33.2694 10.6421 33.7798 11.1525L34.8477 12.2204C35.3581 12.7308 35.4326 13.5323 35.025 14.128C34.1802 15.3627 32.7931 16.7183 33.5077 18.3202C33.5898 18.5043 33.6672 18.6909 33.7398 18.88C34.3683 20.5171 36.3061 20.4949 37.7764 20.7706C38.4859 20.9036 39 21.5231 39 22.2449V23.7551C39 24.4769 38.4859 25.0964 37.7764 25.2294C36.3061 25.5051 34.3685 25.483 33.7401 27.1201C33.6675 27.3093 33.59 27.4961 33.5079 27.6803C32.7934 29.282 34.1803 30.6374 35.025 31.8719C35.4326 32.4677 35.3581 33.2692 34.8477 33.7796L33.7798 34.8475C33.2694 35.3579 32.4678 35.4324 31.8721 35.0248C30.6376 34.1801 29.2823 32.7934 27.6806 33.508C27.4962 33.5903 27.3093 33.6678 27.12 33.7405C25.483 34.3688 25.5051 36.3062 25.2294 37.7764C25.0964 38.4859 24.4769 39 23.7551 39H22.2449C21.5231 39 20.9036 38.4859 20.7706 37.7764C20.4949 36.3062 20.517 34.3688 18.88 33.7405C18.6908 33.6678 18.5039 33.5903 18.3196 33.5081C16.7179 32.7936 15.3625 34.1804 14.1279 35.0251C13.5322 35.4327 12.7307 35.3582 12.2203 34.8478L11.1524 33.7799C10.642 33.2695 10.5675 32.4679 10.9751 31.8722C11.8198 30.6376 13.2067 29.2822 12.4922 27.6804C12.41 27.4962 12.3325 27.3093 12.2599 27.1201C11.6315 25.483 9.69392 25.5051 8.22357 25.2294C7.51411 25.0964 7 24.4769 7 23.7551V22.2449C7 21.5231 7.51411 20.9036 8.22357 20.7706C9.69394 20.4949 11.6317 20.5171 12.2602 18.88C12.3328 18.6909 12.4103 18.5042 12.4924 18.3201C13.207 16.7181 11.8198 15.3625 10.975 14.1278C10.5674 13.5321 10.6419 12.7305 11.1523 12.2201L12.2202 11.1522C12.7306 10.6418 13.5322 10.5673 14.1279 10.9749C15.3626 11.8197 16.7184 13.2071 18.3204 12.4925C18.5044 12.4105 18.6909 12.3331 18.8799 12.2606C20.5171 11.6321 20.4949 9.69403 20.7706 8.22357Z"
      fill="#906EF7"
      stroke="white"
      stroke-width="2"
    />
    <circle cx="23" cy="23" r="6" fill="#794CFF" stroke="white" stroke-width="2" />
    <circle cx="41" cy="41" r="4" fill="#794CFF" stroke="white" stroke-width="2" />
  </g>
  <defs>
    <clipPath id="1">
      <rect width="60" height="60" fill="white" />
    </clipPath>
  </defs>
</svg> `,h8e=rs`
  :host {
    display: block;
    width: var(--local-size);
    height: var(--local-size);
  }

  :host svg {
    width: 100%;
    height: 100%;
  }
`;var cN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const f8e={browser:qRe,dao:ZRe,defi:KRe,defiAlt:YRe,eth:XRe,layers:QRe,lock:t8e,login:n8e,network:r8e,nft:s8e,noun:o8e,profile:l8e,system:d8e,meld:i8e,onrampCard:a8e,google:JRe,pencil:c8e,lightbulb:e8e,solana:u8e,ton:nY,bitcoin:GRe};let iE=class extends on{constructor(){super(...arguments),this.name="browser",this.size="md"}render(){return this.style.cssText=`
       --local-size: var(--apkt-visual-size-${this.size});
   `,we`${f8e[this.name]}`}};iE.styles=[Ei,h8e];cN([Fe()],iE.prototype,"name",void 0);cN([Fe()],iE.prototype,"size",void 0);iE=cN([nn("wui-visual")],iE);var zY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let $O=class extends on{constructor(){super(...arguments),this.data=[]}render(){return we`
      <wui-flex flexDirection="column" alignItems="center" gap="4">
        ${this.data.map(e=>we`
            <wui-flex flexDirection="column" alignItems="center" gap="5">
              <wui-flex flexDirection="row" justifyContent="center" gap="1">
                ${e.images.map(n=>we`<wui-visual size="sm" name=${n}></wui-visual>`)}
              </wui-flex>
            </wui-flex>
            <wui-flex flexDirection="column" alignItems="center" gap="1">
              <wui-text variant="md-regular" color="primary" align="center">${e.title}</wui-text>
              <wui-text variant="sm-regular" color="secondary" align="center"
                >${e.text}</wui-text
              >
            </wui-flex>
          `)}
      </wui-flex>
    `}};zY([Fe({type:Array})],$O.prototype,"data",void 0);$O=zY([nn("w3m-help-widget")],$O);var p8e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const m8e=[{images:["login","profile","lock"],title:"One login for all of web3",text:"Log in to any app by connecting your wallet. Say goodbye to countless passwords!"},{images:["defi","nft","eth"],title:"A home for your digital assets",text:"A wallet lets you store, send and receive digital assets like cryptocurrencies and NFTs."},{images:["browser","noun","dao"],title:"Your gateway to a new web",text:"With your wallet, you can explore and interact with DeFi, NFTs, DAOs, and much more."}];let zO=class extends on{render(){return we`
      <wui-flex
        flexDirection="column"
        .padding=${["6","5","5","5"]}
        alignItems="center"
        gap="5"
      >
        <w3m-help-widget .data=${m8e}></w3m-help-widget>
        <wui-button variant="accent-primary" size="md" @click=${this.onGetWallet.bind(this)}>
          <wui-icon color="inherit" slot="iconLeft" name="wallet"></wui-icon>
          Get a wallet
        </wui-button>
      </wui-flex>
    `}onGetWallet(){Sn.sendEvent({type:"track",event:"CLICK_GET_WALLET_HELP"}),Pt.push("GetWallet")}};zO=p8e([nn("w3m-what-is-a-wallet-view")],zO);const g8e=Fn`
  wui-flex {
    max-height: clamp(360px, 540px, 80vh);
    overflow: scroll;
    scrollbar-width: none;
    transition: opacity ${({durations:t})=>t.lg}
      ${({easings:t})=>t["ease-out-power-2"]};
    will-change: opacity;
  }
  wui-flex::-webkit-scrollbar {
    display: none;
  }
  wui-flex.disabled {
    opacity: 0.3;
    pointer-events: none;
    user-select: none;
  }
`;var UY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let rE=class extends on{constructor(){super(),this.unsubscribe=[],this.checked=F0.state.isLegalCheckboxChecked,this.unsubscribe.push(F0.subscribeKey("isLegalCheckboxChecked",e=>{this.checked=e}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){var w;const{termsConditionsUrl:e,privacyPolicyUrl:n}=ut.state,i=(w=ut.state.features)==null?void 0:w.legalCheckbox,l=!!(e||n)&&!!i,h=l&&!this.checked,s=h?-1:void 0;return we`
      <w3m-legal-checkbox></w3m-legal-checkbox>
      <wui-flex
        flexDirection="column"
        .padding=${l?["0","3","3","3"]:"3"}
        gap="2"
        class=${Tn(h?"disabled":void 0)}
      >
        <w3m-wallet-login-list tabIdx=${Tn(s)}></w3m-wallet-login-list>
      </wui-flex>
    `}};rE.styles=g8e;UY([Lt()],rE.prototype,"checked",void 0);rE=UY([nn("w3m-connect-wallets-view")],rE);const y8e=Fn`
  :host {
    display: block;
    width: 120px;
    height: 120px;
  }

  svg {
    width: 120px;
    height: 120px;
    fill: none;
    stroke: transparent;
    stroke-linecap: round;
  }

  use {
    stroke: ${t=>t.colors.accent100};
    stroke-width: 2px;
    stroke-dasharray: 54, 118;
    stroke-dashoffset: 172;
    animation: dash 1s linear infinite;
  }

  @keyframes dash {
    to {
      stroke-dashoffset: 0px;
    }
  }
`;var _8e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let UO=class extends on{render(){return we`
      <svg viewBox="0 0 54 59">
        <path
          id="wui-loader-path"
          d="M17.22 5.295c3.877-2.277 5.737-3.363 7.72-3.726a11.44 11.44 0 0 1 4.12 0c1.983.363 3.844 1.45 7.72 3.726l6.065 3.562c3.876 2.276 5.731 3.372 7.032 4.938a11.896 11.896 0 0 1 2.06 3.63c.683 1.928.688 4.11.688 8.663v7.124c0 4.553-.005 6.735-.688 8.664a11.896 11.896 0 0 1-2.06 3.63c-1.3 1.565-3.156 2.66-7.032 4.937l-6.065 3.563c-3.877 2.276-5.737 3.362-7.72 3.725a11.46 11.46 0 0 1-4.12 0c-1.983-.363-3.844-1.449-7.72-3.726l-6.065-3.562c-3.876-2.276-5.731-3.372-7.032-4.938a11.885 11.885 0 0 1-2.06-3.63c-.682-1.928-.688-4.11-.688-8.663v-7.124c0-4.553.006-6.735.688-8.664a11.885 11.885 0 0 1 2.06-3.63c1.3-1.565 3.156-2.66 7.032-4.937l6.065-3.562Z"
        />
        <use xlink:href="#wui-loader-path"></use>
      </svg>
    `}};UO.styles=[Ei,y8e];UO=_8e([nn("wui-loading-hexagon")],UO);const w8e=yi`<svg width="86" height="96" fill="none">
  <path
    d="M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z"
  />
</svg>`,b8e=yi`
  <svg fill="none" viewBox="0 0 36 40">
    <path
      d="M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z"
    />
  </svg>
`,v8e=Fn`
  :host {
    position: relative;
    border-radius: inherit;
    display: flex;
    justify-content: center;
    align-items: center;
    width: var(--local-width);
    height: var(--local-height);
  }

  :host([data-round='true']) {
    background: ${({tokens:t})=>t.theme.foregroundPrimary};
    border-radius: 100%;
    outline: 1px solid ${({tokens:t})=>t.core.glass010};
  }

  svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  svg > path {
    stroke: var(--local-stroke);
  }

  wui-image {
    width: 100%;
    height: 100%;
    -webkit-clip-path: var(--local-path);
    clip-path: var(--local-path);
    background: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  wui-icon {
    transform: translateY(-5%);
    width: var(--local-icon-size);
    height: var(--local-icon-size);
  }
`;var zy=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Xf=class extends on{constructor(){super(...arguments),this.size="md",this.name="uknown",this.networkImagesBySize={sm:b8e,md:hY,lg:w8e},this.selected=!1,this.round=!1}render(){const e={sm:"4",md:"6",lg:"10"};return this.round?(this.dataset.round="true",this.style.cssText=`
      --local-width: var(--apkt-spacing-10);
      --local-height: var(--apkt-spacing-10);
      --local-icon-size: var(--apkt-spacing-4);
    `):this.style.cssText=`

      --local-path: var(--apkt-path-network-${this.size});
      --local-width:  var(--apkt-width-network-${this.size});
      --local-height:  var(--apkt-height-network-${this.size});
      --local-icon-size:  var(--apkt-spacing-${e[this.size]});
    `,we`${this.templateVisual()} ${this.svgTemplate()} `}svgTemplate(){return this.round?null:this.networkImagesBySize[this.size]}templateVisual(){return this.imageSrc?we`<wui-image src=${this.imageSrc} alt=${this.name}></wui-image>`:we`<wui-icon size="inherit" color="default" name="networkPlaceholder"></wui-icon>`}};Xf.styles=[Ei,v8e];zy([Fe()],Xf.prototype,"size",void 0);zy([Fe()],Xf.prototype,"name",void 0);zy([Fe({type:Object})],Xf.prototype,"networkImagesBySize",void 0);zy([Fe()],Xf.prototype,"imageSrc",void 0);zy([Fe({type:Boolean})],Xf.prototype,"selected",void 0);zy([Fe({type:Boolean})],Xf.prototype,"round",void 0);Xf=zy([nn("wui-network-image")],Xf);const x8e=rs`
  @keyframes shake {
    0% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(3px);
    }
    50% {
      transform: translateX(-3px);
    }
    75% {
      transform: translateX(3px);
    }
    100% {
      transform: translateX(0);
    }
  }

  wui-flex:first-child:not(:only-child) {
    position: relative;
  }

  wui-loading-hexagon {
    position: absolute;
  }

  wui-icon-box {
    position: absolute;
    right: 4px;
    bottom: 0;
    opacity: 0;
    transform: scale(0.5);
    z-index: 1;
  }

  wui-button {
    display: none;
  }

  [data-error='true'] wui-icon-box {
    opacity: 1;
    transform: scale(1);
  }

  [data-error='true'] > wui-flex:first-child {
    animation: shake 250ms cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
  }

  wui-button[data-retry='true'] {
    display: block;
    opacity: 1;
  }
`;var lN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Aw=class extends on{constructor(){var e;super(),this.network=(e=Pt.state.data)==null?void 0:e.network,this.unsubscribe=[],this.showRetry=!1,this.error=!1}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}firstUpdated(){this.onSwitchNetwork()}render(){if(!this.network)throw new Error("w3m-network-switch-view: No network provided");this.onShowRetry();const e=this.getLabel(),n=this.getSubLabel();return we`
      <wui-flex
        data-error=${this.error}
        flexDirection="column"
        alignItems="center"
        .padding=${["10","5","10","5"]}
        gap="7"
      >
        <wui-flex justifyContent="center" alignItems="center">
          <wui-network-image
            size="lg"
            imageSrc=${Tn(Ur.getNetworkImage(this.network))}
          ></wui-network-image>

          ${this.error?null:we`<wui-loading-hexagon></wui-loading-hexagon>`}

          <wui-icon-box color="error" icon="close" size="sm"></wui-icon-box>
        </wui-flex>

        <wui-flex flexDirection="column" alignItems="center" gap="2">
          <wui-text align="center" variant="h6-regular" color="primary">${e}</wui-text>
          <wui-text align="center" variant="md-regular" color="secondary">${n}</wui-text>
        </wui-flex>

        <wui-button
          data-retry=${this.showRetry}
          variant="accent-primary"
          size="md"
          .disabled=${!this.error}
          @click=${this.onSwitchNetwork.bind(this)}
        >
          <wui-icon color="inherit" slot="iconLeft" name="refresh"></wui-icon>
          Try again
        </wui-button>
      </wui-flex>
    `}getSubLabel(){const e=Nt.getConnectorId(ue.state.activeChain);return Nt.getAuthConnector()&&e===at.CONNECTOR_ID.AUTH?"":this.error?"Switch can be declined if chain is not supported by a wallet or previous request is still active":"Accept connection request in your wallet"}getLabel(){var i;const e=Nt.getConnectorId(ue.state.activeChain);return Nt.getAuthConnector()&&e===at.CONNECTOR_ID.AUTH?`Switching to ${((i=this.network)==null?void 0:i.name)??"Unknown"} network...`:this.error?"Switch declined":"Approve in wallet"}onShowRetry(){var e;if(this.error&&!this.showRetry){this.showRetry=!0;const n=(e=this.shadowRoot)==null?void 0:e.querySelector("wui-button");n==null||n.animate([{opacity:0},{opacity:1}],{fill:"forwards",easing:"ease"})}}async onSwitchNetwork(){var e;try{this.error=!1,ue.state.activeChain!==((e=this.network)==null?void 0:e.chainNamespace)&&ue.setIsSwitchingNamespace(!0),this.network&&(await ue.switchActiveNetwork(this.network),await Xa.isAuthenticated()&&Pt.goBack())}catch{this.error=!0}}};Aw.styles=x8e;lN([Lt()],Aw.prototype,"showRetry",void 0);lN([Lt()],Aw.prototype,"error",void 0);Aw=lN([nn("w3m-network-switch-view")],Aw);const E8e=Fn`
  :host {
    width: 100%;
  }

  button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: ${({spacing:t})=>t[3]};
    width: 100%;
    background-color: transparent;
    border-radius: ${({borderRadius:t})=>t[4]};
  }

  wui-text {
    text-transform: capitalize;
  }

  @media (hover: hover) {
    button:hover:enabled {
      background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
    }
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`;var o3=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Ey=class extends on{constructor(){super(...arguments),this.imageSrc=void 0,this.name="Ethereum",this.disabled=!1}render(){return we`
      <button ?disabled=${this.disabled} tabindex=${Tn(this.tabIdx)}>
        <wui-flex gap="2" alignItems="center">
          ${this.imageTemplate()}
          <wui-text variant="lg-regular" color="primary">${this.name}</wui-text>
        </wui-flex>
        <wui-icon name="chevronRight" size="lg" color="default"></wui-icon>
      </button>
    `}imageTemplate(){return this.imageSrc?we`<wui-image ?boxed=${!0} src=${this.imageSrc}></wui-image>`:we`<wui-image
      ?boxed=${!0}
      icon="networkPlaceholder"
      size="lg"
      iconColor="default"
    ></wui-image>`}};Ey.styles=[Ei,Kr,E8e];o3([Fe()],Ey.prototype,"imageSrc",void 0);o3([Fe()],Ey.prototype,"name",void 0);o3([Fe()],Ey.prototype,"tabIdx",void 0);o3([Fe({type:Boolean})],Ey.prototype,"disabled",void 0);Ey=o3([nn("wui-list-network")],Ey);const C8e=rs`
  .container {
    max-height: 360px;
    overflow: auto;
  }

  .container::-webkit-scrollbar {
    display: none;
  }
`;var a3=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Gm=class extends on{constructor(){super(),this.unsubscribe=[],this.network=ue.state.activeCaipNetwork,this.requestedCaipNetworks=ue.getCaipNetworks(),this.search="",this.onDebouncedSearch=Ft.debounce(e=>{this.search=e},100),this.unsubscribe.push(_o.subscribeNetworkImages(()=>this.requestUpdate()),ue.subscribeKey("activeCaipNetwork",e=>this.network=e),ue.subscribe(()=>{this.requestedCaipNetworks=ue.getAllRequestedCaipNetworks()}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we`
      ${this.templateSearchInput()}
      <wui-flex
        class="container"
        .padding=${["0","3","3","3"]}
        flexDirection="column"
        gap="2"
      >
        ${this.networksTemplate()}
      </wui-flex>
    `}templateSearchInput(){return we`
      <wui-flex gap="2" .padding=${["0","3","3","3"]}>
        <wui-input-text
          @inputChange=${this.onInputChange.bind(this)}
          class="network-search-input"
          size="md"
          placeholder="Search network"
          icon="search"
        ></wui-input-text>
      </wui-flex>
    `}onInputChange(e){this.onDebouncedSearch(e.detail)}networksTemplate(){var i;const e=ue.getAllApprovedCaipNetworkIds(),n=Ft.sortRequestedNetworks(e,this.requestedCaipNetworks);return this.search?this.filteredNetworks=n==null?void 0:n.filter(o=>{var l;return(l=o==null?void 0:o.name)==null?void 0:l.toLowerCase().includes(this.search.toLowerCase())}):this.filteredNetworks=n,(i=this.filteredNetworks)==null?void 0:i.map(o=>{var l;return we`
        <wui-list-network
          .selected=${((l=this.network)==null?void 0:l.id)===o.id}
          imageSrc=${Tn(Ur.getNetworkImage(o))}
          type="network"
          name=${o.name??o.id}
          @click=${()=>this.onSwitchNetwork(o)}
          .disabled=${ue.isCaipNetworkDisabled(o)}
          data-testid=${`w3m-network-switch-${o.name??o.id}`}
        ></wui-list-network>
      `})}onSwitchNetwork(e){CG.onSwitchNetwork({network:e})}};Gm.styles=C8e;a3([Lt()],Gm.prototype,"network",void 0);a3([Lt()],Gm.prototype,"requestedCaipNetworks",void 0);a3([Lt()],Gm.prototype,"filteredNetworks",void 0);a3([Lt()],Gm.prototype,"search",void 0);Gm=a3([nn("w3m-networks-view")],Gm);const T8e=Fn`
  @keyframes shake {
    0% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(3px);
    }
    50% {
      transform: translateX(-3px);
    }
    75% {
      transform: translateX(3px);
    }
    100% {
      transform: translateX(0);
    }
  }

  wui-flex:first-child:not(:only-child) {
    position: relative;
  }

  wui-loading-thumbnail {
    position: absolute;
  }

  wui-visual {
    border-radius: calc(
      ${({borderRadius:t})=>t[1]} * 9 - ${({borderRadius:t})=>t[3]}
    );
    position: relative;
    overflow: hidden;
  }

  wui-visual::after {
    content: '';
    display: block;
    width: 100%;
    height: 100%;
    position: absolute;
    inset: 0;
    border-radius: calc(
      ${({borderRadius:t})=>t[1]} * 9 - ${({borderRadius:t})=>t[3]}
    );
    box-shadow: inset 0 0 0 1px ${({tokens:t})=>t.core.glass010};
  }

  wui-icon-box {
    position: absolute;
    right: calc(${({spacing:t})=>t[1]} * -1);
    bottom: calc(${({spacing:t})=>t[1]} * -1);
    opacity: 0;
    transform: scale(0.5);
    transition:
      opacity ${({durations:t})=>t.lg} ${({easings:t})=>t["ease-out-power-2"]},
      transform ${({durations:t})=>t.lg}
        ${({easings:t})=>t["ease-out-power-2"]};
    will-change: opacity, transform;
  }

  wui-text[align='center'] {
    width: 100%;
    padding: 0px ${({spacing:t})=>t[4]};
  }

  [data-error='true'] wui-icon-box {
    opacity: 1;
    transform: scale(1);
  }

  [data-error='true'] > wui-flex:first-child {
    animation: shake 250ms ${({easings:t})=>t["ease-out-power-2"]} both;
  }

  [data-retry='false'] wui-link {
    display: none;
  }

  [data-retry='true'] wui-link {
    display: block;
    opacity: 1;
  }

  wui-link {
    padding: ${({spacing:t})=>t["01"]} ${({spacing:t})=>t[2]};
  }

  .capitalize {
    text-transform: capitalize;
  }
`;var jY=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const A8e={eip155:"eth",solana:"solana",bip122:"bitcoin",polkadot:void 0};let sE=class extends on{constructor(){var e,n;super(...arguments),this.unsubscribe=[],this.switchToChain=(e=Pt.state.data)==null?void 0:e.switchToChain,this.caipNetwork=(n=Pt.state.data)==null?void 0:n.network,this.activeChain=ue.state.activeChain}firstUpdated(){this.unsubscribe.push(ue.subscribeKey("activeChain",e=>this.activeChain=e))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){const e=this.switchToChain?at.CHAIN_NAME_MAP[this.switchToChain]:"supported";if(!this.switchToChain)return null;const n=at.CHAIN_NAME_MAP[this.switchToChain];return we`
      <wui-flex
        flexDirection="column"
        alignItems="center"
        .padding=${["4","2","2","2"]}
        gap="4"
      >
        <wui-flex justifyContent="center" flexDirection="column" alignItems="center" gap="2">
          <wui-visual
            size="md"
            name=${Tn(A8e[this.switchToChain])}
          ></wui-visual>
          <wui-flex gap="2" flexDirection="column" alignItems="center">
            <wui-text
              data-testid=${`w3m-switch-active-chain-to-${n}`}
              variant="lg-regular"
              color="primary"
              align="center"
              >Switch to <span class="capitalize">${n}</span></wui-text
            >
            <wui-text variant="md-regular" color="secondary" align="center">
              Connected wallet doesn't support connecting to ${e} chain. You
              need to connect with a different wallet.
            </wui-text>
          </wui-flex>
          <wui-button
            data-testid="w3m-switch-active-chain-button"
            size="md"
            @click=${this.switchActiveChain.bind(this)}
            >Switch</wui-button
          >
        </wui-flex>
      </wui-flex>
    `}async switchActiveChain(){this.switchToChain&&(ue.setIsSwitchingNamespace(!0),Nt.setFilterByNamespace(this.switchToChain),this.caipNetwork?await ue.switchActiveNetwork(this.caipNetwork):ue.setActiveNamespace(this.switchToChain),Pt.reset("Connect"))}};sE.styles=T8e;jY([Fe()],sE.prototype,"activeChain",void 0);sE=jY([nn("w3m-switch-active-chain-view")],sE);var S8e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};const I8e=[{images:["network","layers","system"],title:"The systems nuts and bolts",text:"A network is what brings the blockchain to life, as this technical infrastructure allows apps to access the ledger and smart contract services."},{images:["noun","defiAlt","dao"],title:"Designed for different uses",text:"Each network is designed differently, and may therefore suit certain apps and experiences."}];let jO=class extends on{render(){return we`
      <wui-flex
        flexDirection="column"
        .padding=${["6","5","5","5"]}
        alignItems="center"
        gap="5"
      >
        <w3m-help-widget .data=${I8e}></w3m-help-widget>
        <wui-button
          variant="accent-primary"
          size="md"
          @click=${()=>{Ft.openHref("https://ethereum.org/en/developers/docs/networks/","_blank")}}
        >
          Learn more
          <wui-icon color="inherit" slot="iconRight" name="externalLink"></wui-icon>
        </wui-button>
      </wui-flex>
    `}};jO=S8e([nn("w3m-what-is-a-network-view")],jO);const P8e=rs`
  :host > wui-flex {
    max-height: clamp(360px, 540px, 80vh);
    overflow: scroll;
    scrollbar-width: none;
  }

  :host > wui-flex::-webkit-scrollbar {
    display: none;
  }
`;var uN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Sw=class extends on{constructor(){var e;super(),this.swapUnsupportedChain=(e=Pt.state.data)==null?void 0:e.swapUnsupportedChain,this.unsubscribe=[],this.disconnecting=!1,this.remoteFeatures=ut.state.remoteFeatures,this.unsubscribe.push(_o.subscribeNetworkImages(()=>this.requestUpdate()),ut.subscribeKey("remoteFeatures",n=>{this.remoteFeatures=n}))}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we`
      <wui-flex class="container" flexDirection="column" gap="0">
        <wui-flex
          class="container"
          flexDirection="column"
          .padding=${["3","5","2","5"]}
          alignItems="center"
          gap="5"
        >
          ${this.descriptionTemplate()}
        </wui-flex>

        <wui-flex flexDirection="column" padding="3" gap="2"> ${this.networksTemplate()} </wui-flex>

        <wui-separator text="or"></wui-separator>
        <wui-flex flexDirection="column" padding="3" gap="2">
          <wui-list-item
            variant="icon"
            iconVariant="overlay"
            icon="signOut"
            ?chevron=${!1}
            .loading=${this.disconnecting}
            @click=${this.onDisconnect.bind(this)}
            data-testid="disconnect-button"
          >
            <wui-text variant="md-medium" color="secondary">Disconnect</wui-text>
          </wui-list-item>
        </wui-flex>
      </wui-flex>
    `}descriptionTemplate(){return this.swapUnsupportedChain?we`
        <wui-text variant="sm-regular" color="secondary" align="center">
          The swap feature doesnt support your current network. Switch to an available option to
          continue.
        </wui-text>
      `:we`
      <wui-text variant="sm-regular" color="secondary" align="center">
        This app doesnt support your current network. Switch to an available option to continue.
      </wui-text>
    `}networksTemplate(){const e=ue.getAllRequestedCaipNetworks(),n=ue.getAllApprovedCaipNetworkIds(),i=Ft.sortRequestedNetworks(n,e);return(this.swapUnsupportedChain?i.filter(l=>hi.SWAP_SUPPORTED_NETWORKS.includes(l.caipNetworkId)):i).map(l=>we`
        <wui-list-network
          imageSrc=${Tn(Ur.getNetworkImage(l))}
          name=${l.name??"Unknown"}
          @click=${()=>this.onSwitchNetwork(l)}
        >
        </wui-list-network>
      `)}async onDisconnect(){var e;try{this.disconnecting=!0;const n=ue.state.activeChain,o=Ht.getConnections(n).length>0,l=n&&Nt.state.activeConnectorIds[n],h=(e=this.remoteFeatures)==null?void 0:e.multiWallet;await Ht.disconnect(h?{id:l,namespace:n}:{}),o&&h&&(Pt.push("ProfileWallets"),Ji.showSuccess("Wallet deleted"))}catch{Sn.sendEvent({type:"track",event:"DISCONNECT_ERROR",properties:{message:"Failed to disconnect"}}),Ji.showError("Failed to disconnect")}finally{this.disconnecting=!1}}async onSwitchNetwork(e){const n=ue.getActiveCaipAddress(),i=ue.getAllApprovedCaipNetworkIds(),o=ue.getNetworkProp("supportsAllNetworks",e.chainNamespace),l=Pt.state.data;n?i!=null&&i.includes(e.caipNetworkId)?await ue.switchActiveNetwork(e):o?Pt.push("SwitchNetwork",{...l,network:e}):Pt.push("SwitchNetwork",{...l,network:e}):n||(ue.setActiveCaipNetwork(e),Pt.push("Connect"))}};Sw.styles=P8e;uN([Lt()],Sw.prototype,"disconnecting",void 0);uN([Lt()],Sw.prototype,"remoteFeatures",void 0);Sw=uN([nn("w3m-unsupported-chain-view")],Sw);const R8e=Fn`
  wui-flex {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: ${({spacing:t})=>t[2]};
    border-radius: ${({borderRadius:t})=>t[4]};
    padding: ${({spacing:t})=>t[3]};
  }

  /* -- Types --------------------------------------------------------- */
  wui-flex[data-type='info'] {
    color: ${({tokens:t})=>t.theme.textSecondary};
    background-color: ${({tokens:t})=>t.theme.foregroundPrimary};
  }

  wui-flex[data-type='success'] {
    color: ${({tokens:t})=>t.core.textSuccess};
    background-color: ${({tokens:t})=>t.core.backgroundSuccess};
  }

  wui-flex[data-type='error'] {
    color: ${({tokens:t})=>t.core.textError};
    background-color: ${({tokens:t})=>t.core.backgroundError};
  }

  wui-flex[data-type='warning'] {
    color: ${({tokens:t})=>t.core.textWarning};
    background-color: ${({tokens:t})=>t.core.backgroundWarning};
  }

  wui-flex[data-type='info'] wui-icon-box {
    background-color: ${({tokens:t})=>t.theme.foregroundSecondary};
  }

  wui-flex[data-type='success'] wui-icon-box {
    background-color: ${({tokens:t})=>t.core.backgroundSuccess};
  }

  wui-flex[data-type='error'] wui-icon-box {
    background-color: ${({tokens:t})=>t.core.backgroundError};
  }

  wui-flex[data-type='warning'] wui-icon-box {
    background-color: ${({tokens:t})=>t.core.backgroundWarning};
  }

  wui-text {
    flex: 1;
  }
`;var xI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Iw=class extends on{constructor(){super(...arguments),this.icon="externalLink",this.text="",this.type="info"}render(){return we`
      <wui-flex alignItems="center" data-type=${this.type}>
        <wui-icon-box size="sm" color="inherit" icon=${this.icon}></wui-icon-box>
        <wui-text variant="md-regular" color="inherit">${this.text}</wui-text>
      </wui-flex>
    `}};Iw.styles=[Ei,Kr,R8e];xI([Fe()],Iw.prototype,"icon",void 0);xI([Fe()],Iw.prototype,"text",void 0);xI([Fe()],Iw.prototype,"type",void 0);Iw=xI([nn("wui-banner")],Iw);const O8e=rs`
  :host > wui-flex {
    max-height: clamp(360px, 540px, 80vh);
    overflow: scroll;
    scrollbar-width: none;
  }

  :host > wui-flex::-webkit-scrollbar {
    display: none;
  }
`;var k8e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let fS=class extends on{constructor(){super(),this.unsubscribe=[]}disconnectedCallback(){this.unsubscribe.forEach(e=>e())}render(){return we` <wui-flex flexDirection="column" .padding=${["2","3","3","3"]} gap="2">
      <wui-banner
        icon="warningCircle"
        text="You can only receive assets on these networks"
      ></wui-banner>
      ${this.networkTemplate()}
    </wui-flex>`}networkTemplate(){const e=ue.getAllRequestedCaipNetworks(),n=ue.getAllApprovedCaipNetworkIds(),i=ue.state.activeCaipNetwork,o=ue.checkIfSmartAccountEnabled();let l=Ft.sortRequestedNetworks(n,e);if(o&&Fs(i==null?void 0:i.chainNamespace)===Gr.ACCOUNT_TYPES.SMART_ACCOUNT){if(!i)return null;l=[i]}return l.filter(s=>s.chainNamespace===(i==null?void 0:i.chainNamespace)).map(s=>we`
        <wui-list-network
          imageSrc=${Tn(Ur.getNetworkImage(s))}
          name=${s.name??"Unknown"}
          ?transparent=${!0}
        >
        </wui-list-network>
      `)}};fS.styles=O8e;fS=k8e([nn("w3m-wallet-compatible-networks-view")],fS);const D8e=Fn`
  :host {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 56px;
    height: 56px;
    box-shadow: 0 0 0 8px ${({tokens:t})=>t.theme.borderPrimary};
    border-radius: ${({borderRadius:t})=>t[4]};
    overflow: hidden;
  }

  :host([data-border-radius-full='true']) {
    border-radius: 50px;
  }

  wui-icon {
    width: 32px;
    height: 32px;
  }
`;var EI=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let Pw=class extends on{render(){return this.dataset.borderRadiusFull=this.borderRadiusFull?"true":"false",we`${this.templateVisual()}`}templateVisual(){return this.imageSrc?we`<wui-image src=${this.imageSrc} alt=${this.alt??""}></wui-image>`:we`<wui-icon
      data-parent-size="md"
      size="inherit"
      color="inherit"
      name="wallet"
    ></wui-icon>`}};Pw.styles=[Ei,D8e];EI([Fe()],Pw.prototype,"imageSrc",void 0);EI([Fe()],Pw.prototype,"alt",void 0);EI([Fe({type:Boolean})],Pw.prototype,"borderRadiusFull",void 0);Pw=EI([nn("wui-visual-thumbnail")],Pw);const N8e=Fn`
  :host {
    display: flex;
    justify-content: center;
    gap: ${({spacing:t})=>t[4]};
  }

  wui-visual-thumbnail:nth-child(1) {
    z-index: 1;
  }
`;var M8e=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let VO=class extends on{constructor(){var e,n,i;super(...arguments),this.dappImageUrl=(e=ut.state.metadata)==null?void 0:e.icons,this.walletImageUrl=(i=(n=ue.getAccountData())==null?void 0:n.connectedWalletInfo)==null?void 0:i.icon}firstUpdated(){var n;const e=(n=this.shadowRoot)==null?void 0:n.querySelectorAll("wui-visual-thumbnail");e!=null&&e[0]&&this.createAnimation(e[0],"translate(18px)"),e!=null&&e[1]&&this.createAnimation(e[1],"translate(-18px)")}render(){var e;return we`
      <wui-visual-thumbnail
        ?borderRadiusFull=${!0}
        .imageSrc=${(e=this.dappImageUrl)==null?void 0:e[0]}
      ></wui-visual-thumbnail>
      <wui-visual-thumbnail .imageSrc=${this.walletImageUrl}></wui-visual-thumbnail>
    `}createAnimation(e,n){e.animate([{transform:"translateX(0px)"},{transform:n}],{duration:1600,easing:"cubic-bezier(0.56, 0, 0.48, 1)",direction:"alternate",iterations:1/0})}};VO.styles=N8e;VO=M8e([nn("w3m-siwx-sign-message-thumbnails")],VO);var dN=function(t,e,n,i){var o=arguments.length,l=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(h=t[s])&&(l=(o<3?h(l):o>3?h(e,n,l):h(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};let oE=class extends on{constructor(){var e;super(...arguments),this.dappName=(e=ut.state.metadata)==null?void 0:e.name,this.isCancelling=!1,this.isSigning=!1}render(){return we`
      <wui-flex justifyContent="center" .padding=${["8","0","6","0"]}>
        <w3m-siwx-sign-message-thumbnails></w3m-siwx-sign-message-thumbnails>
      </wui-flex>
      <wui-flex .padding=${["0","20","5","20"]} gap="3" justifyContent="space-between">
        <wui-text variant="lg-medium" align="center" color="primary"
          >${this.dappName??"Dapp"} needs to connect to your wallet</wui-text
        >
      </wui-flex>
      <wui-flex .padding=${["0","10","4","10"]} gap="3" justifyContent="space-between">
        <wui-text variant="md-regular" align="center" color="secondary"
          >Sign this message to prove you own this wallet and proceed. Canceling will disconnect
          you.</wui-text
        >
      </wui-flex>
      <wui-flex .padding=${["4","5","5","5"]} gap="3" justifyContent="space-between">
        <wui-button
          size="lg"
          borderRadius="xs"
          fullWidth
          variant="neutral-secondary"
          ?loading=${this.isCancelling}
          @click=${this.onCancel.bind(this)}
          data-testid="w3m-connecting-siwe-cancel"
        >
          ${this.isCancelling?"Cancelling...":"Cancel"}
        </wui-button>
        <wui-button
          size="lg"
          borderRadius="xs"
          fullWidth
          variant="neutral-primary"
          @click=${this.onSign.bind(this)}
          ?loading=${this.isSigning}
          data-testid="w3m-connecting-siwe-sign"
        >
          ${this.isSigning?"Signing...":"Sign"}
        </wui-button>
      </wui-flex>
    `}async onSign(){this.isSigning=!0;try{await Xa.requestSignMessage()}catch(e){if(e instanceof Error&&e.message.includes("OTP is required")){Ji.showError({message:"Something went wrong. We need to verify your account again."}),Pt.replace("DataCapture");return}throw e}finally{this.isSigning=!1}}async onCancel(){this.isCancelling=!0,await Xa.cancelSignMessage().finally(()=>this.isCancelling=!1)}};dN([Lt()],oE.prototype,"isCancelling",void 0);dN([Lt()],oE.prototype,"isSigning",void 0);oE=dN([nn("w3m-siwx-sign-message-view")],oE);const L8e=Object.freeze(Object.defineProperty({__proto__:null,get AppKitAccountButton(){return ZA},get AppKitButton(){return KA},get AppKitConnectButton(){return YA},get AppKitNetworkButton(){return XA},get W3mAccountButton(){return bO},get W3mAccountSettingsView(){return Gf},get W3mAccountView(){return QA},get W3mAllWalletsView(){return J2},get W3mButton(){return vO},get W3mChooseAccountNameView(){return nE},get W3mConnectButton(){return xO},get W3mConnectView(){return Nc},get W3mConnectWalletsView(){return rE},get W3mConnectingExternalView(){return OO},get W3mConnectingMultiChainView(){return Q2},get W3mConnectingWcBasicView(){return tE},get W3mConnectingWcView(){return Dh},get W3mDownloadsView(){return BO},get W3mFooter(){return pw},get W3mFundWalletView(){return Vm},get W3mGetWalletView(){return FO},get W3mNetworkButton(){return EO},get W3mNetworkSwitchView(){return Aw},get W3mNetworksView(){return Gm},get W3mProfileWalletsView(){return ic},get W3mRouter(){return mw},get W3mSIWXSignMessageView(){return oE},get W3mSwitchActiveChainView(){return sE},get W3mUnsupportedChainView(){return Sw},get W3mWalletCompatibleNetworksView(){return fS},get W3mWhatIsANetworkView(){return jO},get W3mWhatIsAWalletView(){return zO}},Symbol.toStringTag,{value:"Module"}));dI({tagName:"appkit-button",elementClass:KA,react:On});dI({tagName:"appkit-network-button",elementClass:XA,react:On});dI({tagName:"appkit-connect-button",elementClass:YA,react:On});dI({tagName:"appkit-account-button",elementClass:ZA,react:On});let AT;function B8e(t){return AT||(AT=new h6e({...t,sdkVersion:Ft.generateSdkVersion(t.adapters??[],"react",m6e)}),f6e(AT)),AT}const F8e=OV("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),K1=qt.forwardRef(({className:t,variant:e,size:n,asChild:i=!1,...o},l)=>{const h=i?Fne:"button";return ot.jsx(h,{className:ES(F8e({variant:e,size:n,className:t})),ref:l,...o})});K1.displayName="Button";const $8e=OV("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function z8e({className:t,variant:e,...n}){return ot.jsx("div",{className:ES($8e({variant:e}),t),...n})}const U8e=({cartCount:t,onCartClick:e})=>{const{open:n}=p6e(),{address:i,isConnected:o}=qK();return ot.jsxs("nav",{className:"fixed top-0 left-0 right-0 h-16 bg-background/80 backdrop-blur-md border-b border-white/5 z-50 flex items-center justify-between px-6",children:[ot.jsxs("div",{className:"flex items-center gap-8",children:[ot.jsxs(ym,{to:"/",className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[ot.jsx("img",{src:"/assets/verland-logo.png",alt:"Neoverse Logo",className:"w-8 h-8 rounded-lg object-contain bg-transparent"}),ot.jsxs("span",{className:"text-xl font-bold tracking-tighter uppercase",children:["NEO",ot.jsx("span",{className:"text-primary",children:"VERSE"})]})]}),ot.jsxs("div",{className:"hidden md:flex items-center gap-6 text-sm font-medium text-white/60",children:[ot.jsx(ym,{to:"/",className:"hover:text-primary transition-colors",children:"Home"}),ot.jsx(ym,{to:"/map",className:"hover:text-primary transition-colors",children:"Map"}),ot.jsx("a",{href:"#",className:"hover:text-primary transition-colors",children:"Marketplace"})]})]}),ot.jsxs("div",{className:"flex items-center gap-4",children:[ot.jsxs("div",{className:"relative group hidden sm:block",children:[ot.jsx(Une,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40 group-focus-within:text-primary transition-colors"}),ot.jsx("input",{type:"text",placeholder:"Search coordinates...",className:"h-10 w-64 bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 text-sm focus:outline-none focus:border-primary/50 transition-all"})]}),ot.jsxs(K1,{variant:"outline",size:"icon",className:"relative rounded-xl border-white/10 hover:border-primary/50 hover:bg-primary/5",onClick:e,children:[ot.jsx(jne,{className:"w-5 h-5"}),t>0&&ot.jsx(z8e,{className:"absolute -top-2 -right-2 px-1.5 min-w-[20px] h-5 bg-primary text-black hover:bg-primary border-2 border-background font-bold",children:t})]}),ot.jsxs(K1,{onClick:()=>{console.log("Opening wallet modal..."),n()},className:"relative overflow-hidden bg-primary hover:bg-primary/90 text-black font-black rounded-xl px-6 gap-2 group transition-all duration-300 hover:scale-[1.05] active:scale-[0.95] shadow-[0_0_20px_rgba(182,254,5,0.2)] hover:shadow-[0_0_40px_rgba(182,254,5,0.4)]",children:[ot.jsx("div",{className:"absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-500 skew-x-[-20deg]"}),ot.jsx(Vne,{className:"w-4 h-4 relative z-10"}),ot.jsx("span",{className:"relative z-10",children:o?`${i==null?void 0:i.slice(0,6)}...${i==null?void 0:i.slice(-4)}`:"Connect Wallet"})]}),ot.jsx(K1,{variant:"ghost",size:"icon",className:"md:hidden text-white/60",children:ot.jsx(Wne,{className:"w-6 h-6"})})]})]})},hN=qt.createContext({});function fN(t){const e=qt.useRef(null);return e.current===null&&(e.current=t()),e.current}const VY=typeof window<"u",WY=VY?qt.useLayoutEffect:qt.useEffect,CI=qt.createContext(null);function pN(t,e){t.indexOf(e)===-1&&t.push(e)}function pS(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Nh=(t,e,n)=>n>e?e:n<t?t:n;let mN=()=>{};const Jf={},HY=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function GY(t){return typeof t=="object"&&t!==null}const qY=t=>/^0[^.\s]+$/u.test(t);function ZY(t){let e;return()=>(e===void 0&&(e=t()),e)}const Cu=t=>t,j8e=(t,e)=>n=>e(t(n)),c3=(...t)=>t.reduce(j8e),aE=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i};class gN{constructor(){this.subscriptions=[]}add(e){return pN(this.subscriptions,e),()=>pS(this.subscriptions,e)}notify(e,n,i){const o=this.subscriptions.length;if(o)if(o===1)this.subscriptions[0](e,n,i);else for(let l=0;l<o;l++){const h=this.subscriptions[l];h&&h(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const yd=t=>t*1e3,Eu=t=>t/1e3;function KY(t,e){return e?t*(1e3/e):0}const YY=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,V8e=1e-7,W8e=12;function H8e(t,e,n,i,o){let l,h,s=0;do h=e+(n-e)/2,l=YY(h,i,o)-t,l>0?n=h:e=h;while(Math.abs(l)>V8e&&++s<W8e);return h}function l3(t,e,n,i){if(t===e&&n===i)return Cu;const o=l=>H8e(l,0,1,t,n);return l=>l===0||l===1?l:YY(o(l),e,i)}const XY=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,JY=t=>e=>1-t(1-e),QY=l3(.33,1.53,.69,.99),yN=JY(QY),eX=XY(yN),tX=t=>(t*=2)<1?.5*yN(t):.5*(2-Math.pow(2,-10*(t-1))),_N=t=>1-Math.sin(Math.acos(t)),nX=JY(_N),iX=XY(_N),G8e=l3(.42,0,1,1),q8e=l3(0,0,.58,1),rX=l3(.42,0,.58,1),Z8e=t=>Array.isArray(t)&&typeof t[0]!="number",sX=t=>Array.isArray(t)&&typeof t[0]=="number",K8e={linear:Cu,easeIn:G8e,easeInOut:rX,easeOut:q8e,circIn:_N,circInOut:iX,circOut:nX,backIn:yN,backInOut:eX,backOut:QY,anticipate:tX},Y8e=t=>typeof t=="string",sj=t=>{if(sX(t)){mN(t.length===4);const[e,n,i,o]=t;return l3(e,n,i,o)}else if(Y8e(t))return K8e[t];return t},ST=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function X8e(t,e){let n=new Set,i=new Set,o=!1,l=!1;const h=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1};function w(A){h.has(A)&&(x.schedule(A),t()),A(s)}const x={schedule:(A,P=!1,D=!1)=>{const z=D&&o?n:i;return P&&h.add(A),z.has(A)||z.add(A),A},cancel:A=>{i.delete(A),h.delete(A)},process:A=>{if(s=A,o){l=!0;return}o=!0,[n,i]=[i,n],n.forEach(w),n.clear(),o=!1,l&&(l=!1,x.process(A))}};return x}const J8e=40;function oX(t,e){let n=!1,i=!0;const o={delta:0,timestamp:0,isProcessing:!1},l=()=>n=!0,h=ST.reduce((Q,de)=>(Q[de]=X8e(l),Q),{}),{setup:s,read:w,resolveKeyframes:x,preUpdate:A,update:P,preRender:D,render:M,postRender:z}=h,U=()=>{const Q=Jf.useManualTiming?o.timestamp:performance.now();n=!1,Jf.useManualTiming||(o.delta=i?1e3/60:Math.max(Math.min(Q-o.timestamp,J8e),1)),o.timestamp=Q,o.isProcessing=!0,s.process(o),w.process(o),x.process(o),A.process(o),P.process(o),D.process(o),M.process(o),z.process(o),o.isProcessing=!1,n&&e&&(i=!1,t(U))},G=()=>{n=!0,i=!0,o.isProcessing||t(U)};return{schedule:ST.reduce((Q,de)=>{const he=h[de];return Q[de]=(Ie,ke=!1,Ue=!1)=>(n||G(),he.schedule(Ie,ke,Ue)),Q},{}),cancel:Q=>{for(let de=0;de<ST.length;de++)h[ST[de]].cancel(Q)},state:o,steps:h}}const{schedule:ds,cancel:qm,state:Aa,steps:bR}=oX(typeof requestAnimationFrame<"u"?requestAnimationFrame:Cu,!0);let qT;function Q8e(){qT=void 0}const Ac={now:()=>(qT===void 0&&Ac.set(Aa.isProcessing||Jf.useManualTiming?Aa.timestamp:performance.now()),qT),set:t=>{qT=t,queueMicrotask(Q8e)}},aX=t=>e=>typeof e=="string"&&e.startsWith(t),cX=aX("--"),eOe=aX("var(--"),wN=t=>eOe(t)?tOe.test(t.split("/*")[0].trim()):!1,tOe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function oj(t){return typeof t!="string"?!1:t.split("/*")[0].includes("var(--")}const qw={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},cE={...qw,transform:t=>Nh(0,1,t)},IT={...qw,default:1},Xx=t=>Math.round(t*1e5)/1e5,bN=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function nOe(t){return t==null}const iOe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,vN=(t,e)=>n=>!!(typeof n=="string"&&iOe.test(n)&&n.startsWith(t)||e&&!nOe(n)&&Object.prototype.hasOwnProperty.call(n,e)),lX=(t,e,n)=>i=>{if(typeof i!="string")return i;const[o,l,h,s]=i.match(bN);return{[t]:parseFloat(o),[e]:parseFloat(l),[n]:parseFloat(h),alpha:s!==void 0?parseFloat(s):1}},rOe=t=>Nh(0,255,t),vR={...qw,transform:t=>Math.round(rOe(t))},D0={test:vN("rgb","red"),parse:lX("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+vR.transform(t)+", "+vR.transform(e)+", "+vR.transform(n)+", "+Xx(cE.transform(i))+")"};function sOe(t){let e="",n="",i="",o="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),o=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),o=t.substring(4,5),e+=e,n+=n,i+=i,o+=o),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:o?parseInt(o,16)/255:1}}const WO={test:vN("#"),parse:sOe,transform:D0.transform},u3=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),sm=u3("deg"),vh=u3("%"),ti=u3("px"),oOe=u3("vh"),aOe=u3("vw"),aj={...vh,parse:t=>vh.parse(t)/100,transform:t=>vh.transform(t*100)},k1={test:vN("hsl","hue"),parse:lX("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+vh.transform(Xx(e))+", "+vh.transform(Xx(n))+", "+Xx(cE.transform(i))+")"},go={test:t=>D0.test(t)||WO.test(t)||k1.test(t),parse:t=>D0.test(t)?D0.parse(t):k1.test(t)?k1.parse(t):WO.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?D0.transform(t):k1.transform(t),getAnimatableNone:t=>{const e=go.parse(t);return e.alpha=0,go.transform(e)}},cOe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function lOe(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(bN))==null?void 0:e.length)||0)+(((n=t.match(cOe))==null?void 0:n.length)||0)>0}const uX="number",dX="color",uOe="var",dOe="var(",cj="${}",hOe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function lE(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},o=[];let l=0;const s=e.replace(hOe,w=>(go.test(w)?(i.color.push(l),o.push(dX),n.push(go.parse(w))):w.startsWith(dOe)?(i.var.push(l),o.push(uOe),n.push(w)):(i.number.push(l),o.push(uX),n.push(parseFloat(w))),++l,cj)).split(cj);return{values:n,split:s,indexes:i,types:o}}function hX(t){return lE(t).values}function fX(t){const{split:e,types:n}=lE(t),i=e.length;return o=>{let l="";for(let h=0;h<i;h++)if(l+=e[h],o[h]!==void 0){const s=n[h];s===uX?l+=Xx(o[h]):s===dX?l+=go.transform(o[h]):l+=o[h]}return l}}const fOe=t=>typeof t=="number"?0:go.test(t)?go.getAnimatableNone(t):t;function pOe(t){const e=hX(t);return fX(t)(e.map(fOe))}const _d={test:lOe,parse:hX,createTransformer:fX,getAnimatableNone:pOe};function xR(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function mOe({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let o=0,l=0,h=0;if(!e)o=l=h=n;else{const s=n<.5?n*(1+e):n+e-n*e,w=2*n-s;o=xR(w,s,t+1/3),l=xR(w,s,t),h=xR(w,s,t-1/3)}return{red:Math.round(o*255),green:Math.round(l*255),blue:Math.round(h*255),alpha:i}}function mS(t,e){return n=>n>0?e:t}const Bs=(t,e,n)=>t+(e-t)*n,ER=(t,e,n)=>{const i=t*t,o=n*(e*e-i)+i;return o<0?0:Math.sqrt(o)},gOe=[WO,D0,k1],yOe=t=>gOe.find(e=>e.test(t));function lj(t){const e=yOe(t);if(!e)return!1;let n=e.parse(t);return e===k1&&(n=mOe(n)),n}const uj=(t,e)=>{const n=lj(t),i=lj(e);if(!n||!i)return mS(t,e);const o={...n};return l=>(o.red=ER(n.red,i.red,l),o.green=ER(n.green,i.green,l),o.blue=ER(n.blue,i.blue,l),o.alpha=Bs(n.alpha,i.alpha,l),D0.transform(o))},HO=new Set(["none","hidden"]);function _Oe(t,e){return HO.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function wOe(t,e){return n=>Bs(t,e,n)}function xN(t){return typeof t=="number"?wOe:typeof t=="string"?wN(t)?mS:go.test(t)?uj:xOe:Array.isArray(t)?pX:typeof t=="object"?go.test(t)?uj:bOe:mS}function pX(t,e){const n=[...t],i=n.length,o=t.map((l,h)=>xN(l)(l,e[h]));return l=>{for(let h=0;h<i;h++)n[h]=o[h](l);return n}}function bOe(t,e){const n={...t,...e},i={};for(const o in n)t[o]!==void 0&&e[o]!==void 0&&(i[o]=xN(t[o])(t[o],e[o]));return o=>{for(const l in i)n[l]=i[l](o);return n}}function vOe(t,e){const n=[],i={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const l=e.types[o],h=t.indexes[l][i[l]],s=t.values[h]??0;n[o]=s,i[l]++}return n}const xOe=(t,e)=>{const n=_d.createTransformer(e),i=lE(t),o=lE(e);return i.indexes.var.length===o.indexes.var.length&&i.indexes.color.length===o.indexes.color.length&&i.indexes.number.length>=o.indexes.number.length?HO.has(t)&&!o.values.length||HO.has(e)&&!i.values.length?_Oe(t,e):c3(pX(vOe(i,o),o.values),n):mS(t,e)};function mX(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?Bs(t,e,n):xN(t)(t,e)}const EOe=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>ds.update(e,n),stop:()=>qm(e),now:()=>Aa.isProcessing?Aa.timestamp:Ac.now()}},gX=(t,e,n=10)=>{let i="";const o=Math.max(Math.round(e/n),2);for(let l=0;l<o;l++)i+=Math.round(t(l/(o-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},gS=2e4;function EN(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<gS;)e+=n,i=t.next(e);return e>=gS?1/0:e}function COe(t,e=100,n){const i=n({...t,keyframes:[0,e]}),o=Math.min(EN(i),gS);return{type:"keyframes",ease:l=>i.next(o*l).value/e,duration:Eu(o)}}const TOe=5;function yX(t,e,n){const i=Math.max(e-TOe,0);return KY(n-t(i),e-i)}const Ys={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},CR=.001;function AOe({duration:t=Ys.duration,bounce:e=Ys.bounce,velocity:n=Ys.velocity,mass:i=Ys.mass}){let o,l,h=1-e;h=Nh(Ys.minDamping,Ys.maxDamping,h),t=Nh(Ys.minDuration,Ys.maxDuration,Eu(t)),h<1?(o=x=>{const A=x*h,P=A*t,D=A-n,M=GO(x,h),z=Math.exp(-P);return CR-D/M*z},l=x=>{const P=x*h*t,D=P*n+n,M=Math.pow(h,2)*Math.pow(x,2)*t,z=Math.exp(-P),U=GO(Math.pow(x,2),h);return(-o(x)+CR>0?-1:1)*((D-M)*z)/U}):(o=x=>{const A=Math.exp(-x*t),P=(x-n)*t+1;return-CR+A*P},l=x=>{const A=Math.exp(-x*t),P=(n-x)*(t*t);return A*P});const s=5/t,w=IOe(o,l,s);if(t=yd(t),isNaN(w))return{stiffness:Ys.stiffness,damping:Ys.damping,duration:t};{const x=Math.pow(w,2)*i;return{stiffness:x,damping:h*2*Math.sqrt(i*x),duration:t}}}const SOe=12;function IOe(t,e,n){let i=n;for(let o=1;o<SOe;o++)i=i-t(i)/e(i);return i}function GO(t,e){return t*Math.sqrt(1-e*e)}const POe=["duration","bounce"],ROe=["stiffness","damping","mass"];function dj(t,e){return e.some(n=>t[n]!==void 0)}function OOe(t){let e={velocity:Ys.velocity,stiffness:Ys.stiffness,damping:Ys.damping,mass:Ys.mass,isResolvedFromDuration:!1,...t};if(!dj(t,ROe)&&dj(t,POe))if(e.velocity=0,t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),o=i*i,l=2*Nh(.05,1,1-(t.bounce||0))*Math.sqrt(o);e={...e,mass:Ys.mass,stiffness:o,damping:l}}else{const n=AOe({...t,velocity:0});e={...e,...n,mass:Ys.mass},e.isResolvedFromDuration=!0}return e}function yS(t=Ys.visualDuration,e=Ys.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:o}=n;const l=n.keyframes[0],h=n.keyframes[n.keyframes.length-1],s={done:!1,value:l},{stiffness:w,damping:x,mass:A,duration:P,velocity:D,isResolvedFromDuration:M}=OOe({...n,velocity:-Eu(n.velocity||0)}),z=D||0,U=x/(2*Math.sqrt(w*A)),G=h-l,ne=Eu(Math.sqrt(w/A)),oe=Math.abs(G)<5;i||(i=oe?Ys.restSpeed.granular:Ys.restSpeed.default),o||(o=oe?Ys.restDelta.granular:Ys.restDelta.default);let Q;if(U<1){const he=GO(ne,U);Q=Ie=>{const ke=Math.exp(-U*ne*Ie);return h-ke*((z+U*ne*G)/he*Math.sin(he*Ie)+G*Math.cos(he*Ie))}}else if(U===1)Q=he=>h-Math.exp(-ne*he)*(G+(z+ne*G)*he);else{const he=ne*Math.sqrt(U*U-1);Q=Ie=>{const ke=Math.exp(-U*ne*Ie),Ue=Math.min(he*Ie,300);return h-ke*((z+U*ne*G)*Math.sinh(Ue)+he*G*Math.cosh(Ue))/he}}const de={calculatedDuration:M&&P||null,next:he=>{const Ie=Q(he);if(M)s.done=he>=P;else{let ke=he===0?z:0;U<1&&(ke=he===0?yd(z):yX(Q,he,Ie));const Ue=Math.abs(ke)<=i,ze=Math.abs(h-Ie)<=o;s.done=Ue&&ze}return s.value=s.done?h:Ie,s},toString:()=>{const he=Math.min(EN(de),gS),Ie=gX(ke=>de.next(he*ke).value,he,30);return he+"ms "+Ie},toTransition:()=>{}};return de}yS.applyToOptions=t=>{const e=COe(t,100,yS);return t.ease=e.ease,t.duration=yd(e.duration),t.type="keyframes",t};function qO({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:o=10,bounceStiffness:l=500,modifyTarget:h,min:s,max:w,restDelta:x=.5,restSpeed:A}){const P=t[0],D={done:!1,value:P},M=Ue=>s!==void 0&&Ue<s||w!==void 0&&Ue>w,z=Ue=>s===void 0?w:w===void 0||Math.abs(s-Ue)<Math.abs(w-Ue)?s:w;let U=n*e;const G=P+U,ne=h===void 0?G:h(G);ne!==G&&(U=ne-P);const oe=Ue=>-U*Math.exp(-Ue/i),Q=Ue=>ne+oe(Ue),de=Ue=>{const ze=oe(Ue),ht=Q(Ue);D.done=Math.abs(ze)<=x,D.value=D.done?ne:ht};let he,Ie;const ke=Ue=>{M(D.value)&&(he=Ue,Ie=yS({keyframes:[D.value,z(D.value)],velocity:yX(Q,Ue,D.value),damping:o,stiffness:l,restDelta:x,restSpeed:A}))};return ke(0),{calculatedDuration:null,next:Ue=>{let ze=!1;return!Ie&&he===void 0&&(ze=!0,de(Ue),ke(Ue)),he!==void 0&&Ue>=he?Ie.next(Ue-he):(!ze&&de(Ue),D)}}}function kOe(t,e,n){const i=[],o=n||Jf.mix||mX,l=t.length-1;for(let h=0;h<l;h++){let s=o(t[h],t[h+1]);if(e){const w=Array.isArray(e)?e[h]||Cu:e;s=c3(w,s)}i.push(s)}return i}function DOe(t,e,{clamp:n=!0,ease:i,mixer:o}={}){const l=t.length;if(mN(l===e.length),l===1)return()=>e[0];if(l===2&&e[0]===e[1])return()=>e[1];const h=t[0]===t[1];t[0]>t[l-1]&&(t=[...t].reverse(),e=[...e].reverse());const s=kOe(e,i,o),w=s.length,x=A=>{if(h&&A<t[0])return e[0];let P=0;if(w>1)for(;P<t.length-2&&!(A<t[P+1]);P++);const D=aE(t[P],t[P+1],A);return s[P](D)};return n?A=>x(Nh(t[0],t[l-1],A)):x}function NOe(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const o=aE(0,e,i);t.push(Bs(n,1,o))}}function MOe(t){const e=[0];return NOe(e,t.length-1),e}function LOe(t,e){return t.map(n=>n*e)}function BOe(t,e){return t.map(()=>e||rX).splice(0,t.length-1)}function Jx({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const o=Z8e(i)?i.map(sj):sj(i),l={done:!1,value:e[0]},h=LOe(n&&n.length===e.length?n:MOe(e),t),s=DOe(h,e,{ease:Array.isArray(o)?o:BOe(e,o)});return{calculatedDuration:t,next:w=>(l.value=s(w),l.done=w>=t,l)}}const FOe=t=>t!==null;function CN(t,{repeat:e,repeatType:n="loop"},i,o=1){const l=t.filter(FOe),s=o<0||e&&n!=="loop"&&e%2===1?0:l.length-1;return!s||i===void 0?l[s]:i}const $Oe={decay:qO,inertia:qO,tween:Jx,keyframes:Jx,spring:yS};function _X(t){typeof t.type=="string"&&(t.type=$Oe[t.type])}class TN{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const zOe=t=>t/100;class AN extends TN{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var i,o;const{motionValue:n}=this.options;n&&n.updatedAt!==Ac.now()&&this.tick(Ac.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(o=(i=this.options).onStop)==null||o.call(i))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;_X(e);const{type:n=Jx,repeat:i=0,repeatDelay:o=0,repeatType:l,velocity:h=0}=e;let{keyframes:s}=e;const w=n||Jx;w!==Jx&&typeof s[0]!="number"&&(this.mixKeyframes=c3(zOe,mX(s[0],s[1])),s=[0,100]);const x=w({...e,keyframes:s});l==="mirror"&&(this.mirroredGenerator=w({...e,keyframes:[...s].reverse(),velocity:-h})),x.calculatedDuration===null&&(x.calculatedDuration=EN(x));const{calculatedDuration:A}=x;this.calculatedDuration=A,this.resolvedDuration=A+o,this.totalDuration=this.resolvedDuration*(i+1)-o,this.generator=x}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:i,totalDuration:o,mixKeyframes:l,mirroredGenerator:h,resolvedDuration:s,calculatedDuration:w}=this;if(this.startTime===null)return i.next(0);const{delay:x=0,keyframes:A,repeat:P,repeatType:D,repeatDelay:M,type:z,onUpdate:U,finalKeyframe:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-o/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const ne=this.currentTime-x*(this.playbackSpeed>=0?1:-1),oe=this.playbackSpeed>=0?ne<0:ne>o;this.currentTime=Math.max(ne,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=o);let Q=this.currentTime,de=i;if(P){const Ue=Math.min(this.currentTime,o)/s;let ze=Math.floor(Ue),ht=Ue%1;!ht&&Ue>=1&&(ht=1),ht===1&&ze--,ze=Math.min(ze,P+1),!!(ze%2)&&(D==="reverse"?(ht=1-ht,M&&(ht-=M/s)):D==="mirror"&&(de=h)),Q=Nh(0,1,ht)*s}const he=oe?{done:!1,value:A[0]}:de.next(Q);l&&(he.value=l(he.value));let{done:Ie}=he;!oe&&w!==null&&(Ie=this.playbackSpeed>=0?this.currentTime>=o:this.currentTime<=0);const ke=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ie);return ke&&z!==qO&&(he.value=CN(A,this.options,G,this.speed)),U&&U(he.value),ke&&this.finish(),he}then(e,n){return this.finished.then(e,n)}get duration(){return Eu(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Eu(e)}get time(){return Eu(this.currentTime)}set time(e){var n;e=yd(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Ac.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Eu(this.currentTime))}play(){var o,l;if(this.isStopped)return;const{driver:e=EOe,startTime:n}=this.options;this.driver||(this.driver=e(h=>this.tick(h))),(l=(o=this.options).onPlay)==null||l.call(o);const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ac.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function UOe(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const N0=t=>t*180/Math.PI,ZO=t=>{const e=N0(Math.atan2(t[1],t[0]));return KO(e)},jOe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:ZO,rotateZ:ZO,skewX:t=>N0(Math.atan(t[1])),skewY:t=>N0(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},KO=t=>(t=t%360,t<0&&(t+=360),t),hj=ZO,fj=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),pj=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),VOe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:fj,scaleY:pj,scale:t=>(fj(t)+pj(t))/2,rotateX:t=>KO(N0(Math.atan2(t[6],t[5]))),rotateY:t=>KO(N0(Math.atan2(-t[2],t[0]))),rotateZ:hj,rotate:hj,skewX:t=>N0(Math.atan(t[4])),skewY:t=>N0(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function YO(t){return t.includes("scale")?1:0}function XO(t,e){if(!t||t==="none")return YO(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,o;if(n)i=VOe,o=n;else{const s=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=jOe,o=s}if(!o)return YO(e);const l=i[e],h=o[1].split(",").map(HOe);return typeof l=="function"?l(h):h[l]}const WOe=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return XO(n,e)};function HOe(t){return parseFloat(t.trim())}const Zw=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Kw=new Set(Zw),mj=t=>t===qw||t===ti,GOe=new Set(["x","y","z"]),qOe=Zw.filter(t=>!GOe.has(t));function ZOe(t){const e=[];return qOe.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const vm={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>XO(e,"x"),y:(t,{transform:e})=>XO(e,"y")};vm.translateX=vm.x;vm.translateY=vm.y;const U0=new Set;let JO=!1,QO=!1,ek=!1;function wX(){if(QO){const t=Array.from(U0).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const o=ZOe(i);o.length&&(n.set(i,o),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const o=n.get(i);o&&o.forEach(([l,h])=>{var s;(s=i.getValue(l))==null||s.set(h)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}QO=!1,JO=!1,U0.forEach(t=>t.complete(ek)),U0.clear()}function bX(){U0.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(QO=!0)})}function KOe(){ek=!0,bX(),wX(),ek=!1}class SN{constructor(e,n,i,o,l,h=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=o,this.element=l,this.isAsync=h}scheduleResolve(){this.state="scheduled",this.isAsync?(U0.add(this),JO||(JO=!0,ds.read(bX),ds.resolveKeyframes(wX))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:o}=this;if(e[0]===null){const l=o==null?void 0:o.get(),h=e[e.length-1];if(l!==void 0)e[0]=l;else if(i&&n){const s=i.readValue(n,h);s!=null&&(e[0]=s)}e[0]===void 0&&(e[0]=h),o&&l===void 0&&o.set(e[0])}UOe(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),U0.delete(this)}cancel(){this.state==="scheduled"&&(U0.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const YOe=t=>t.startsWith("--");function XOe(t,e,n){YOe(e)?t.style.setProperty(e,n):t.style[e]=n}const JOe={};function vX(t,e){const n=ZY(t);return()=>JOe[e]??n()}const QOe=vX(()=>window.ScrollTimeline!==void 0,"scrollTimeline"),xX=vX(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Lx=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,gj={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Lx([0,.65,.55,1]),circOut:Lx([.55,0,1,.45]),backIn:Lx([.31,.01,.66,-.59]),backOut:Lx([.33,1.53,.69,.99])};function EX(t,e){if(t)return typeof t=="function"?xX()?gX(t,e):"ease-out":sX(t)?Lx(t):Array.isArray(t)?t.map(n=>EX(n,e)||gj.easeOut):gj[t]}function eke(t,e,n,{delay:i=0,duration:o=300,repeat:l=0,repeatType:h="loop",ease:s="easeOut",times:w}={},x=void 0){const A={[e]:n};w&&(A.offset=w);const P=EX(s,o);Array.isArray(P)&&(A.easing=P);const D={delay:i,duration:o,easing:Array.isArray(P)?"linear":P,fill:"both",iterations:l+1,direction:h==="reverse"?"alternate":"normal"};return x&&(D.pseudoElement=x),t.animate(A,D)}function CX(t){return typeof t=="function"&&"applyToOptions"in t}function tke({type:t,...e}){return CX(t)&&xX()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class TX extends TN{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:n,name:i,keyframes:o,pseudoElement:l,allowFlatten:h=!1,finalKeyframe:s,onComplete:w}=e;this.isPseudoElement=!!l,this.allowFlatten=h,this.options=e,mN(typeof e.type!="string");const x=tke(e);this.animation=eke(n,i,o,x,l),x.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!l){const A=CN(o,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(A):XOe(n,i,A),this.animation.cancel()}w==null||w(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,i,o;const e=(n=this.options)==null?void 0:n.element;!this.isPseudoElement&&(e!=null&&e.isConnected)&&((o=(i=this.animation).commitStyles)==null||o.call(i))}get duration(){var n,i;const e=((i=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:i.call(n).duration)||0;return Eu(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Eu(e)}get time(){return Eu(Number(this.animation.currentTime)||0)}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=yd(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var i;return this.allowFlatten&&((i=this.animation.effect)==null||i.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&QOe()?(this.animation.timeline=e,Cu):n(this)}}const AX={anticipate:tX,backInOut:eX,circInOut:iX};function nke(t){return t in AX}function ike(t){typeof t.ease=="string"&&nke(t.ease)&&(t.ease=AX[t.ease])}const TR=10;class rke extends TX{constructor(e){ike(e),_X(e),super(e),e.startTime!==void 0&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:i,onComplete:o,element:l,...h}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const s=new AN({...h,autoplay:!1}),w=Math.max(TR,Ac.now()-this.startTime),x=Nh(0,TR,w-TR);n.setWithVelocity(s.sample(Math.max(0,w-x)).value,s.sample(w).value,x),s.stop()}}const yj=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(_d.test(t)||t==="0")&&!t.startsWith("url("));function ske(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function oke(t,e,n,i){const o=t[0];if(o===null)return!1;if(e==="display"||e==="visibility")return!0;const l=t[t.length-1],h=yj(o,e),s=yj(l,e);return!h||!s?!1:ske(t)||(n==="spring"||CX(n))&&i}function tk(t){t.duration=0,t.type="keyframes"}const ake=new Set(["opacity","clipPath","filter","transform"]),cke=ZY(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function lke(t){var A;const{motionValue:e,name:n,repeatDelay:i,repeatType:o,damping:l,type:h}=t;if(!(((A=e==null?void 0:e.owner)==null?void 0:A.current)instanceof HTMLElement))return!1;const{onUpdate:w,transformTemplate:x}=e.owner.getProps();return cke()&&n&&ake.has(n)&&(n!=="transform"||!x)&&!w&&!i&&o!=="mirror"&&l!==0&&h!=="inertia"}const uke=40;class dke extends TN{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:h="loop",keyframes:s,name:w,motionValue:x,element:A,...P}){var z;super(),this.stop=()=>{var U,G;this._animation&&(this._animation.stop(),(U=this.stopTimeline)==null||U.call(this)),(G=this.keyframeResolver)==null||G.cancel()},this.createdAt=Ac.now();const D={autoplay:e,delay:n,type:i,repeat:o,repeatDelay:l,repeatType:h,name:w,motionValue:x,element:A,...P},M=(A==null?void 0:A.KeyframeResolver)||SN;this.keyframeResolver=new M(s,(U,G,ne)=>this.onKeyframesResolved(U,G,D,!ne),w,x,A),(z=this.keyframeResolver)==null||z.scheduleResolve()}onKeyframesResolved(e,n,i,o){var G,ne;this.keyframeResolver=void 0;const{name:l,type:h,velocity:s,delay:w,isHandoff:x,onUpdate:A}=i;this.resolvedAt=Ac.now(),oke(e,l,h,s)||((Jf.instantAnimations||!w)&&(A==null||A(CN(e,i,n))),e[0]=e[e.length-1],tk(i),i.repeat=0);const D={startTime:o?this.resolvedAt?this.resolvedAt-this.createdAt>uke?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:e},M=!x&&lke(D),z=(ne=(G=D.motionValue)==null?void 0:G.owner)==null?void 0:ne.current,U=M?new rke({...D,element:z}):new AN(D);U.finished.then(()=>{this.notifyFinished()}).catch(Cu),this.pendingTimeline&&(this.stopTimeline=U.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=U}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),KOe()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}function SX(t,e,n,i=0,o=1){const l=Array.from(t).sort((x,A)=>x.sortNodePosition(A)).indexOf(e),h=t.size,s=(h-1)*i;return typeof n=="function"?n(l,h):o===1?l*i:s-l*i}const hke=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fke(t){const e=hke.exec(t);if(!e)return[,];const[,n,i,o]=e;return[`--${n??i}`,o]}function IX(t,e,n=1){const[i,o]=fke(t);if(!i)return;const l=window.getComputedStyle(e).getPropertyValue(i);if(l){const h=l.trim();return HY(h)?parseFloat(h):h}return wN(o)?IX(o,e,n+1):o}const pke={type:"spring",stiffness:500,damping:25,restSpeed:10},mke=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),gke={type:"keyframes",duration:.8},yke={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},_ke=(t,{keyframes:e})=>e.length>2?gke:Kw.has(t)?t.startsWith("scale")?mke(e[1]):pke:yke,wke=t=>t!==null;function bke(t,{repeat:e,repeatType:n="loop"},i){const o=t.filter(wke),l=e&&n!=="loop"&&e%2===1?0:o.length-1;return o[l]}function PX(t,e){if(t!=null&&t.inherit&&e){const{inherit:n,...i}=t;return{...e,...i}}return t}function IN(t,e){const n=(t==null?void 0:t[e])??(t==null?void 0:t.default)??t;return n!==t?PX(n,t):n}function vke({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:o,repeat:l,repeatType:h,repeatDelay:s,from:w,elapsed:x,...A}){return!!Object.keys(A).length}const PN=(t,e,n,i={},o,l)=>h=>{const s=IN(i,t)||{},w=s.delay||i.delay||0;let{elapsed:x=0}=i;x=x-yd(w);const A={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...s,delay:-x,onUpdate:D=>{e.set(D),s.onUpdate&&s.onUpdate(D)},onComplete:()=>{h(),s.onComplete&&s.onComplete()},name:t,motionValue:e,element:l?void 0:o};vke(s)||Object.assign(A,_ke(t,A)),A.duration&&(A.duration=yd(A.duration)),A.repeatDelay&&(A.repeatDelay=yd(A.repeatDelay)),A.from!==void 0&&(A.keyframes[0]=A.from);let P=!1;if((A.type===!1||A.duration===0&&!A.repeatDelay)&&(tk(A),A.delay===0&&(P=!0)),(Jf.instantAnimations||Jf.skipAnimations||o!=null&&o.shouldSkipAnimations)&&(P=!0,tk(A),A.delay=0),A.allowFlatten=!s.type&&!s.ease,P&&!l&&e.get()!==void 0){const D=bke(A.keyframes,s);if(D!==void 0){ds.update(()=>{A.onUpdate(D),A.onComplete()});return}}return s.isSync?new AN(A):new dke(A)};function _j(t){const e=[{},{}];return t==null||t.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function RN(t,e,n,i){if(typeof e=="function"){const[o,l]=_j(i);e=e(n!==void 0?n:t.custom,o,l)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[o,l]=_j(i);e=e(n!==void 0?n:t.custom,o,l)}return e}function Y1(t,e,n){const i=t.getProps();return RN(i,e,n!==void 0?n:i.custom,t)}const RX=new Set(["width","height","top","left","right","bottom",...Zw]),wj=30,xke=t=>!isNaN(parseFloat(t));class Eke{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{var l;const o=Ac.now();if(this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&((l=this.events.change)==null||l.notify(this.current),this.dependents))for(const h of this.dependents)h.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=Ac.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=xke(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new gN);const i=this.events[e].add(n);return e==="change"?()=>{i(),ds.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ac.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>wj)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,wj);return KY(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Rw(t,e){return new Eke(t,e)}const nk=t=>Array.isArray(t);function Cke(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Rw(n))}function Tke(t){return nk(t)?t[t.length-1]||0:t}function Ake(t,e){const n=Y1(t,e);let{transitionEnd:i={},transition:o={},...l}=n||{};l={...l,...i};for(const h in l){const s=Tke(l[h]);Cke(t,h,s)}}const Ja=t=>!!(t&&t.getVelocity);function Ske(t){return!!(Ja(t)&&t.add)}function ik(t,e){const n=t.getValue("willChange");if(Ske(n))return n.add(e);if(!n&&Jf.WillChange){const i=new Jf.WillChange("auto");t.addValue("willChange",i),i.add(e)}}function ON(t){return t.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}const Ike="framerAppearId",OX="data-"+ON(Ike);function kX(t){return t.props[OX]}function Pke({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function DX(t,e,{delay:n=0,transitionOverride:i,type:o}={}){let{transition:l,transitionEnd:h,...s}=e;const w=t.getDefaultTransition();l=l?PX(l,w):w;const x=l==null?void 0:l.reduceMotion;i&&(l=i);const A=[],P=o&&t.animationState&&t.animationState.getState()[o];for(const D in s){const M=t.getValue(D,t.latestValues[D]??null),z=s[D];if(z===void 0||P&&Pke(P,D))continue;const U={delay:n,...IN(l||{},D)},G=M.get();if(G!==void 0&&!M.isAnimating&&!Array.isArray(z)&&z===G&&!U.velocity)continue;let ne=!1;if(window.MotionHandoffAnimation){const de=kX(t);if(de){const he=window.MotionHandoffAnimation(de,D,ds);he!==null&&(U.startTime=he,ne=!0)}}ik(t,D);const oe=x??t.shouldReduceMotion;M.start(PN(D,M,z,oe&&RX.has(D)?{type:!1}:U,t,ne));const Q=M.animation;Q&&A.push(Q)}if(h){const D=()=>ds.update(()=>{h&&Ake(t,h)});A.length?Promise.all(A).then(D):D()}return A}function rk(t,e,n={}){var w;const i=Y1(t,e,n.type==="exit"?(w=t.presenceContext)==null?void 0:w.custom:void 0);let{transition:o=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(o=n.transitionOverride);const l=i?()=>Promise.all(DX(t,i,n)):()=>Promise.resolve(),h=t.variantChildren&&t.variantChildren.size?(x=0)=>{const{delayChildren:A=0,staggerChildren:P,staggerDirection:D}=o;return Rke(t,e,x,A,P,D,n)}:()=>Promise.resolve(),{when:s}=o;if(s){const[x,A]=s==="beforeChildren"?[l,h]:[h,l];return x().then(()=>A())}else return Promise.all([l(),h(n.delay)])}function Rke(t,e,n=0,i=0,o=0,l=1,h){const s=[];for(const w of t.variantChildren)w.notify("AnimationStart",e),s.push(rk(w,e,{...h,delay:n+(typeof i=="function"?0:i)+SX(t.variantChildren,w,i,o,l)}).then(()=>w.notify("AnimationComplete",e)));return Promise.all(s)}function Oke(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const o=e.map(l=>rk(t,l,n));i=Promise.all(o)}else if(typeof e=="string")i=rk(t,e,n);else{const o=typeof e=="function"?Y1(t,e,n.custom):e;i=Promise.all(DX(t,o,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}const kke={test:t=>t==="auto",parse:t=>t},NX=t=>e=>e.test(t),MX=[qw,ti,vh,sm,aOe,oOe,kke],bj=t=>MX.find(NX(t));function Dke(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||qY(t):!0}const Nke=new Set(["brightness","contrast","saturate","opacity"]);function Mke(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(bN)||[];if(!i)return t;const o=n.replace(i,"");let l=Nke.has(e)?1:0;return i!==n&&(l*=100),e+"("+l+o+")"}const Lke=/\b([a-z-]*)\(.*?\)/gu,sk={..._d,getAnimatableNone:t=>{const e=t.match(Lke);return e?e.map(Mke).join(" "):t}},ok={..._d,getAnimatableNone:t=>{const e=_d.parse(t);return _d.createTransformer(t)(e.map(i=>typeof i=="number"?0:typeof i=="object"?{...i,alpha:1}:i))}},vj={...qw,transform:Math.round},Bke={rotate:sm,rotateX:sm,rotateY:sm,rotateZ:sm,scale:IT,scaleX:IT,scaleY:IT,scaleZ:IT,skew:sm,skewX:sm,skewY:sm,distance:ti,translateX:ti,translateY:ti,translateZ:ti,x:ti,y:ti,z:ti,perspective:ti,transformPerspective:ti,opacity:cE,originX:aj,originY:aj,originZ:ti},kN={borderWidth:ti,borderTopWidth:ti,borderRightWidth:ti,borderBottomWidth:ti,borderLeftWidth:ti,borderRadius:ti,borderTopLeftRadius:ti,borderTopRightRadius:ti,borderBottomRightRadius:ti,borderBottomLeftRadius:ti,width:ti,maxWidth:ti,height:ti,maxHeight:ti,top:ti,right:ti,bottom:ti,left:ti,inset:ti,insetBlock:ti,insetBlockStart:ti,insetBlockEnd:ti,insetInline:ti,insetInlineStart:ti,insetInlineEnd:ti,padding:ti,paddingTop:ti,paddingRight:ti,paddingBottom:ti,paddingLeft:ti,paddingBlock:ti,paddingBlockStart:ti,paddingBlockEnd:ti,paddingInline:ti,paddingInlineStart:ti,paddingInlineEnd:ti,margin:ti,marginTop:ti,marginRight:ti,marginBottom:ti,marginLeft:ti,marginBlock:ti,marginBlockStart:ti,marginBlockEnd:ti,marginInline:ti,marginInlineStart:ti,marginInlineEnd:ti,fontSize:ti,backgroundPositionX:ti,backgroundPositionY:ti,...Bke,zIndex:vj,fillOpacity:cE,strokeOpacity:cE,numOctaves:vj},Fke={...kN,color:go,backgroundColor:go,outlineColor:go,fill:go,stroke:go,borderColor:go,borderTopColor:go,borderRightColor:go,borderBottomColor:go,borderLeftColor:go,filter:sk,WebkitFilter:sk,mask:ok,WebkitMask:ok},LX=t=>Fke[t],$ke=new Set([sk,ok]);function BX(t,e){let n=LX(t);return $ke.has(n)||(n=_d),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const zke=new Set(["auto","none","0"]);function Uke(t,e,n){let i=0,o;for(;i<t.length&&!o;){const l=t[i];typeof l=="string"&&!zke.has(l)&&lE(l).values.length&&(o=t[i]),i++}if(o&&n)for(const l of e)t[l]=BX(n,o)}class jke extends SN{constructor(e,n,i,o,l){super(e,n,i,o,l,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let A=0;A<e.length;A++){let P=e[A];if(typeof P=="string"&&(P=P.trim(),wN(P))){const D=IX(P,n.current);D!==void 0&&(e[A]=D),A===e.length-1&&(this.finalKeyframe=P)}}if(this.resolveNoneKeyframes(),!RX.has(i)||e.length!==2)return;const[o,l]=e,h=bj(o),s=bj(l),w=oj(o),x=oj(l);if(w!==x&&vm[i]){this.needsMeasurement=!0;return}if(h!==s)if(mj(h)&&mj(s))for(let A=0;A<e.length;A++){const P=e[A];typeof P=="string"&&(e[A]=parseFloat(P))}else vm[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let o=0;o<e.length;o++)(e[o]===null||Dke(e[o]))&&i.push(o);i.length&&Uke(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=vm[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const o=n[n.length-1];o!==void 0&&e.getValue(i,o).jump(o,!1)}measureEndState(){var s;const{element:e,name:n,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const o=e.getValue(n);o&&o.jump(this.measuredOrigin,!1);const l=i.length-1,h=i[l];i[l]=vm[n](e.measureViewportBox(),window.getComputedStyle(e.current)),h!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=h),(s=this.removedTransforms)!=null&&s.length&&this.removedTransforms.forEach(([w,x])=>{e.getValue(w).set(x)}),this.resolveNoneKeyframes()}}const Vke=new Set(["opacity","clipPath","filter","transform"]);function FX(t,e,n){if(t==null)return[];if(t instanceof EventTarget)return[t];if(typeof t=="string"){let i=document;const o=(n==null?void 0:n[t])??i.querySelectorAll(t);return o?Array.from(o):[]}return Array.from(t).filter(i=>i!=null)}const $X=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function ak(t){return GY(t)&&"offsetHeight"in t}const{schedule:DN}=oX(queueMicrotask,!1),cd={x:!1,y:!1};function zX(){return cd.x||cd.y}function Wke(t){return t==="x"||t==="y"?cd[t]?null:(cd[t]=!0,()=>{cd[t]=!1}):cd.x||cd.y?null:(cd.x=cd.y=!0,()=>{cd.x=cd.y=!1})}function UX(t,e){const n=FX(t),i=new AbortController,o={passive:!0,...e,signal:i.signal};return[n,o,()=>i.abort()]}function Hke(t){return!(t.pointerType==="touch"||zX())}function Gke(t,e,n={}){const[i,o,l]=UX(t,n);return i.forEach(h=>{let s=!1,w=!1,x;const A=()=>{h.removeEventListener("pointerleave",z)},P=G=>{x&&(x(G),x=void 0),A()},D=G=>{s=!1,window.removeEventListener("pointerup",D),window.removeEventListener("pointercancel",D),w&&(w=!1,P(G))},M=()=>{s=!0,window.addEventListener("pointerup",D,o),window.addEventListener("pointercancel",D,o)},z=G=>{if(G.pointerType!=="touch"){if(s){w=!0;return}P(G)}},U=G=>{if(!Hke(G))return;w=!1;const ne=e(h,G);typeof ne=="function"&&(x=ne,h.addEventListener("pointerleave",z,o))};h.addEventListener("pointerenter",U,o),h.addEventListener("pointerdown",M,o)}),l}const jX=(t,e)=>e?t===e?!0:jX(t,e.parentElement):!1,NN=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,qke=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Zke(t){return qke.has(t.tagName)||t.isContentEditable===!0}const Kke=new Set(["INPUT","SELECT","TEXTAREA"]);function Yke(t){return Kke.has(t.tagName)||t.isContentEditable===!0}const ZT=new WeakSet;function xj(t){return e=>{e.key==="Enter"&&t(e)}}function AR(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Xke=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=xj(()=>{if(ZT.has(n))return;AR(n,"down");const o=xj(()=>{AR(n,"up")}),l=()=>AR(n,"cancel");n.addEventListener("keyup",o,e),n.addEventListener("blur",l,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function Ej(t){return NN(t)&&!zX()}const Cj=new WeakSet;function Jke(t,e,n={}){const[i,o,l]=UX(t,n),h=s=>{const w=s.currentTarget;if(!Ej(s)||Cj.has(s))return;ZT.add(w),n.stopPropagation&&Cj.add(s);const x=e(w,s),A=(M,z)=>{window.removeEventListener("pointerup",P),window.removeEventListener("pointercancel",D),ZT.has(w)&&ZT.delete(w),Ej(M)&&typeof x=="function"&&x(M,{success:z})},P=M=>{A(M,w===window||w===document||n.useGlobalTarget||jX(w,M.target))},D=M=>{A(M,!1)};window.addEventListener("pointerup",P,o),window.addEventListener("pointercancel",D,o)};return i.forEach(s=>{(n.useGlobalTarget?window:s).addEventListener("pointerdown",h,o),ak(s)&&(s.addEventListener("focus",x=>Xke(x,o)),!Zke(s)&&!s.hasAttribute("tabindex")&&(s.tabIndex=0))}),l}function MN(t){return GY(t)&&"ownerSVGElement"in t}const KT=new WeakMap;let om;const VX=(t,e,n)=>(i,o)=>o&&o[0]?o[0][t+"Size"]:MN(i)&&"getBBox"in i?i.getBBox()[e]:i[n],Qke=VX("inline","width","offsetWidth"),eDe=VX("block","height","offsetHeight");function tDe({target:t,borderBoxSize:e}){var n;(n=KT.get(t))==null||n.forEach(i=>{i(t,{get width(){return Qke(t,e)},get height(){return eDe(t,e)}})})}function nDe(t){t.forEach(tDe)}function iDe(){typeof ResizeObserver>"u"||(om=new ResizeObserver(nDe))}function rDe(t,e){om||iDe();const n=FX(t);return n.forEach(i=>{let o=KT.get(i);o||(o=new Set,KT.set(i,o)),o.add(e),om==null||om.observe(i)}),()=>{n.forEach(i=>{const o=KT.get(i);o==null||o.delete(e),o!=null&&o.size||om==null||om.unobserve(i)})}}const YT=new Set;let D1;function sDe(){D1=()=>{const t={get width(){return window.innerWidth},get height(){return window.innerHeight}};YT.forEach(e=>e(t))},window.addEventListener("resize",D1)}function oDe(t){return YT.add(t),D1||sDe(),()=>{YT.delete(t),!YT.size&&typeof D1=="function"&&(window.removeEventListener("resize",D1),D1=void 0)}}function Tj(t,e){return typeof t=="function"?oDe(t):rDe(t,e)}function aDe(t){return MN(t)&&t.tagName==="svg"}const cDe=[...MX,go,_d],lDe=t=>cDe.find(NX(t)),Aj=()=>({translate:0,scale:1,origin:0,originPoint:0}),N1=()=>({x:Aj(),y:Aj()}),Sj=()=>({min:0,max:0}),Oo=()=>({x:Sj(),y:Sj()}),uDe=new WeakMap;function TI(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function uE(t){return typeof t=="string"||Array.isArray(t)}const LN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],BN=["initial",...LN];function AI(t){return TI(t.animate)||BN.some(e=>uE(t[e]))}function WX(t){return!!(AI(t)||t.variants)}function dDe(t,e,n){for(const i in e){const o=e[i],l=n[i];if(Ja(o))t.addValue(i,o);else if(Ja(l))t.addValue(i,Rw(o,{owner:t}));else if(l!==o)if(t.hasValue(i)){const h=t.getValue(i);h.liveStyle===!0?h.jump(o):h.hasAnimated||h.set(o)}else{const h=t.getStaticValue(i);t.addValue(i,Rw(h!==void 0?h:o,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const ck={current:null},HX={current:!1},hDe=typeof window<"u";function fDe(){if(HX.current=!0,!!hDe)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>ck.current=t.matches;t.addEventListener("change",e),e()}else ck.current=!1}const Ij=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let _S={};function GX(t){_S=t}function pDe(){return _S}class mDe{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:o,skipAnimations:l,blockInitialAnimation:h,visualState:s},w={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=SN,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const M=Ac.now();this.renderScheduledAt<M&&(this.renderScheduledAt=M,ds.render(this.render,!1,!0))};const{latestValues:x,renderState:A}=s;this.latestValues=x,this.baseTarget={...x},this.initialValues=n.initial?{...x}:{},this.renderState=A,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=o,this.skipAnimationsConfig=l,this.options=w,this.blockInitialAnimation=!!h,this.isControllingVariants=AI(n),this.isVariantNode=WX(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:P,...D}=this.scrapeMotionValuesFromProps(n,{},this);for(const M in D){const z=D[M];x[M]!==void 0&&Ja(z)&&z.set(x[M])}}mount(e){var n,i;if(this.hasBeenMounted)for(const o in this.initialValues)(n=this.values.get(o))==null||n.jump(this.initialValues[o]),this.latestValues[o]=this.initialValues[o];this.current=e,uDe.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((o,l)=>this.bindToMotionValue(l,o)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(HX.current||fDe(),this.shouldReduceMotion=ck.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(i=this.parent)==null||i.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var e;this.projection&&this.projection.unmount(),qm(this.notifyUpdate),qm(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const i=this.features[n];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){if(this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)(),n.accelerate&&Vke.has(e)&&this.current instanceof HTMLElement){const{factory:h,keyframes:s,times:w,ease:x,duration:A}=n.accelerate,P=new TX({element:this.current,name:e,keyframes:s,times:w,ease:x,duration:yd(A)}),D=h(P);this.valueSubscriptions.set(e,()=>{D(),P.cancel()});return}const i=Kw.has(e);i&&this.onBindTransform&&this.onBindTransform();const o=n.on("change",h=>{this.latestValues[e]=h,this.props.onUpdate&&ds.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let l;typeof window<"u"&&window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{o(),l&&l(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in _S){const n=_S[e];if(!n)continue;const{isEnabled:i,Feature:o}=n;if(!this.features[e]&&o&&i(this.props)&&(this.features[e]=new o(this)),this.features[e]){const l=this.features[e];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Oo()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Ij.length;i++){const o=Ij[i];this.propEventSubscriptions[o]&&(this.propEventSubscriptions[o](),delete this.propEventSubscriptions[o]);const l="on"+o,h=e[l];h&&(this.propEventSubscriptions[o]=this.on(o,h))}this.prevMotionValues=dDe(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=Rw(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(HY(i)||qY(i))?i=parseFloat(i):!lDe(i)&&_d.test(n)&&(i=BX(e,n)),this.setBaseTarget(e,Ja(i)?i.get():i)),Ja(i)?i.get():i}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var l;const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const h=RN(this.props,n,(l=this.presenceContext)==null?void 0:l.custom);h&&(i=h[e])}if(n&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!Ja(o)?o:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new gN),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){DN.render(this.render)}}class qX extends mDe{constructor(){super(...arguments),this.KeyframeResolver=jke}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){const i=e.style;return i?i[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ja(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class sg{constructor(e){this.isMounted=!1,this.node=e}update(){}}function ZX({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function gDe({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function yDe(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function SR(t){return t===void 0||t===1}function lk({scale:t,scaleX:e,scaleY:n}){return!SR(t)||!SR(e)||!SR(n)}function _0(t){return lk(t)||KX(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function KX(t){return Pj(t.x)||Pj(t.y)}function Pj(t){return t&&t!=="0%"}function wS(t,e,n){const i=t-n,o=e*i;return n+o}function Rj(t,e,n,i,o){return o!==void 0&&(t=wS(t,o,i)),wS(t,n,i)+e}function uk(t,e=0,n=1,i,o){t.min=Rj(t.min,e,n,i,o),t.max=Rj(t.max,e,n,i,o)}function YX(t,{x:e,y:n}){uk(t.x,e.translate,e.scale,e.originPoint),uk(t.y,n.translate,n.scale,n.originPoint)}const Oj=.999999999999,kj=1.0000000000001;function _De(t,e,n,i=!1){const o=n.length;if(!o)return;e.x=e.y=1;let l,h;for(let s=0;s<o;s++){l=n[s],h=l.projectionDelta;const{visualElement:w}=l.options;w&&w.props.style&&w.props.style.display==="contents"||(i&&l.options.layoutScroll&&l.scroll&&l!==l.root&&L1(t,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),h&&(e.x*=h.x.scale,e.y*=h.y.scale,YX(t,h)),i&&_0(l.latestValues)&&L1(t,l.latestValues))}e.x<kj&&e.x>Oj&&(e.x=1),e.y<kj&&e.y>Oj&&(e.y=1)}function M1(t,e){t.min=t.min+e,t.max=t.max+e}function Dj(t,e,n,i,o=.5){const l=Bs(t.min,t.max,o);uk(t,e,n,l,i)}function L1(t,e){Dj(t.x,e.x,e.scaleX,e.scale,e.originX),Dj(t.y,e.y,e.scaleY,e.scale,e.originY)}function XX(t,e){return ZX(yDe(t.getBoundingClientRect(),e))}function wDe(t,e,n){const i=XX(t,n),{scroll:o}=e;return o&&(M1(i.x,o.offset.x),M1(i.y,o.offset.y)),i}const bDe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},vDe=Zw.length;function xDe(t,e,n){let i="",o=!0;for(let l=0;l<vDe;l++){const h=Zw[l],s=t[h];if(s===void 0)continue;let w=!0;if(typeof s=="number")w=s===(h.startsWith("scale")?1:0);else{const x=parseFloat(s);w=h.startsWith("scale")?x===1:x===0}if(!w||n){const x=$X(s,kN[h]);if(!w){o=!1;const A=bDe[h]||h;i+=`${A}(${x}) `}n&&(e[h]=x)}}return i=i.trim(),n?i=n(e,o?"":i):o&&(i="none"),i}function FN(t,e,n){const{style:i,vars:o,transformOrigin:l}=t;let h=!1,s=!1;for(const w in e){const x=e[w];if(Kw.has(w)){h=!0;continue}else if(cX(w)){o[w]=x;continue}else{const A=$X(x,kN[w]);w.startsWith("origin")?(s=!0,l[w]=A):i[w]=A}}if(e.transform||(h||n?i.transform=xDe(e,t.transform,n):i.transform&&(i.transform="none")),s){const{originX:w="50%",originY:x="50%",originZ:A=0}=l;i.transformOrigin=`${w} ${x} ${A}`}}function JX(t,{style:e,vars:n},i,o){const l=t.style;let h;for(h in e)l[h]=e[h];o==null||o.applyProjectionStyles(l,i);for(h in n)l.setProperty(h,n[h])}function Nj(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ix={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(ti.test(t))t=parseFloat(t);else return t;const n=Nj(t,e.target.x),i=Nj(t,e.target.y);return`${n}% ${i}%`}},EDe={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,o=_d.parse(t);if(o.length>5)return i;const l=_d.createTransformer(t),h=typeof o[0]!="number"?1:0,s=n.x.scale*e.x,w=n.y.scale*e.y;o[0+h]/=s,o[1+h]/=w;const x=Bs(s,w,.5);return typeof o[2+h]=="number"&&(o[2+h]/=x),typeof o[3+h]=="number"&&(o[3+h]/=x),l(o)}},dk={borderRadius:{...Ix,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ix,borderTopRightRadius:Ix,borderBottomLeftRadius:Ix,borderBottomRightRadius:Ix,boxShadow:EDe};function QX(t,{layout:e,layoutId:n}){return Kw.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!dk[t]||t==="opacity")}function $N(t,e,n){var h;const i=t.style,o=e==null?void 0:e.style,l={};if(!i)return l;for(const s in i)(Ja(i[s])||o&&Ja(o[s])||QX(s,t)||((h=n==null?void 0:n.getValue(s))==null?void 0:h.liveStyle)!==void 0)&&(l[s]=i[s]);return l}function CDe(t){return window.getComputedStyle(t)}class TDe extends qX{constructor(){super(...arguments),this.type="html",this.renderInstance=JX}readValueFromInstance(e,n){var i;if(Kw.has(n))return(i=this.projection)!=null&&i.isProjecting?YO(n):WOe(e,n);{const o=CDe(e),l=(cX(n)?o.getPropertyValue(n):o[n])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:n}){return XX(e,n)}build(e,n,i){FN(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return $N(e,n,i)}}const ADe={offset:"stroke-dashoffset",array:"stroke-dasharray"},SDe={offset:"strokeDashoffset",array:"strokeDasharray"};function IDe(t,e,n=1,i=0,o=!0){t.pathLength=1;const l=o?ADe:SDe;t[l.offset]=`${-i}`,t[l.array]=`${e} ${n}`}const PDe=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function eJ(t,{attrX:e,attrY:n,attrScale:i,pathLength:o,pathSpacing:l=1,pathOffset:h=0,...s},w,x,A){if(FN(t,s,x),w){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:P,style:D}=t;P.transform&&(D.transform=P.transform,delete P.transform),(D.transform||P.transformOrigin)&&(D.transformOrigin=P.transformOrigin??"50% 50%",delete P.transformOrigin),D.transform&&(D.transformBox=(A==null?void 0:A.transformBox)??"fill-box",delete P.transformBox);for(const M of PDe)P[M]!==void 0&&(D[M]=P[M],delete P[M]);e!==void 0&&(P.x=e),n!==void 0&&(P.y=n),i!==void 0&&(P.scale=i),o!==void 0&&IDe(P,o,l,h,!1)}const tJ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),nJ=t=>typeof t=="string"&&t.toLowerCase()==="svg";function RDe(t,e,n,i){JX(t,e,void 0,i);for(const o in e.attrs)t.setAttribute(tJ.has(o)?o:ON(o),e.attrs[o])}function iJ(t,e,n){const i=$N(t,e,n);for(const o in t)if(Ja(t[o])||Ja(e[o])){const l=Zw.indexOf(o)!==-1?"attr"+o.charAt(0).toUpperCase()+o.substring(1):o;i[l]=t[o]}return i}class ODe extends qX{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Oo}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Kw.has(n)){const i=LX(n);return i&&i.default||0}return n=tJ.has(n)?n:ON(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return iJ(e,n,i)}build(e,n,i){eJ(e,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,n,i,o){RDe(e,n,i,o)}mount(e){this.isSVGTag=nJ(e.tagName),super.mount(e)}}const kDe=BN.length;function rJ(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?rJ(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<kDe;n++){const i=BN[n],o=t.props[i];(uE(o)||o===!1)&&(e[i]=o)}return e}function sJ(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}const DDe=[...LN].reverse(),NDe=LN.length;function MDe(t){return e=>Promise.all(e.map(({animation:n,options:i})=>Oke(t,n,i)))}function LDe(t){let e=MDe(t),n=Mj(),i=!0;const o=w=>(x,A)=>{var D;const P=Y1(t,A,w==="exit"?(D=t.presenceContext)==null?void 0:D.custom:void 0);if(P){const{transition:M,transitionEnd:z,...U}=P;x={...x,...U,...z}}return x};function l(w){e=w(t)}function h(w){const{props:x}=t,A=rJ(t.parent)||{},P=[],D=new Set;let M={},z=1/0;for(let G=0;G<NDe;G++){const ne=DDe[G],oe=n[ne],Q=x[ne]!==void 0?x[ne]:A[ne],de=uE(Q),he=ne===w?oe.isActive:null;he===!1&&(z=G);let Ie=Q===A[ne]&&Q!==x[ne]&&de;if(Ie&&i&&t.manuallyAnimateOnMount&&(Ie=!1),oe.protectedKeys={...M},!oe.isActive&&he===null||!Q&&!oe.prevProp||TI(Q)||typeof Q=="boolean")continue;if(ne==="exit"&&oe.isActive&&he!==!0){oe.prevResolvedValues&&(M={...M,...oe.prevResolvedValues});continue}const ke=BDe(oe.prevProp,Q);let Ue=ke||ne===w&&oe.isActive&&!Ie&&de||G>z&&de,ze=!1;const ht=Array.isArray(Q)?Q:[Q];let ft=ht.reduce(o(ne),{});he===!1&&(ft={});const{prevResolvedValues:ct={}}=oe,je={...ct,...ft},Ye=Ae=>{Ue=!0,D.has(Ae)&&(ze=!0,D.delete(Ae)),oe.needsAnimating[Ae]=!0;const Le=t.getValue(Ae);Le&&(Le.liveStyle=!1)};for(const Ae in je){const Le=ft[Ae],De=ct[Ae];if(M.hasOwnProperty(Ae))continue;let He=!1;nk(Le)&&nk(De)?He=!sJ(Le,De):He=Le!==De,He?Le!=null?Ye(Ae):D.add(Ae):Le!==void 0&&D.has(Ae)?Ye(Ae):oe.protectedKeys[Ae]=!0}oe.prevProp=Q,oe.prevResolvedValues=ft,oe.isActive&&(M={...M,...ft}),i&&t.blockInitialAnimation&&(Ue=!1);const re=Ie&&ke;Ue&&(!re||ze)&&P.push(...ht.map(Ae=>{const Le={type:ne};if(typeof Ae=="string"&&i&&!re&&t.manuallyAnimateOnMount&&t.parent){const{parent:De}=t,He=Y1(De,Ae);if(De.enteringChildren&&He){const{delayChildren:Et}=He.transition||{};Le.delay=SX(De.enteringChildren,t,Et)}}return{animation:Ae,options:Le}}))}if(D.size){const G={};if(typeof x.initial!="boolean"){const ne=Y1(t,Array.isArray(x.initial)?x.initial[0]:x.initial);ne&&ne.transition&&(G.transition=ne.transition)}D.forEach(ne=>{const oe=t.getBaseTarget(ne),Q=t.getValue(ne);Q&&(Q.liveStyle=!0),G[ne]=oe??null}),P.push({animation:G})}let U=!!P.length;return i&&(x.initial===!1||x.initial===x.animate)&&!t.manuallyAnimateOnMount&&(U=!1),i=!1,U?e(P):Promise.resolve()}function s(w,x){var P;if(n[w].isActive===x)return Promise.resolve();(P=t.variantChildren)==null||P.forEach(D=>{var M;return(M=D.animationState)==null?void 0:M.setActive(w,x)}),n[w].isActive=x;const A=h(w);for(const D in n)n[D].protectedKeys={};return A}return{animateChanges:h,setActive:s,setAnimateFunction:l,getState:()=>n,reset:()=>{n=Mj()}}}function BDe(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!sJ(e,t):!1}function m0(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Mj(){return{animate:m0(!0),whileInView:m0(),whileHover:m0(),whileTap:m0(),whileDrag:m0(),whileFocus:m0(),exit:m0()}}function Lj(t,e){t.min=e.min,t.max=e.max}function sd(t,e){Lj(t.x,e.x),Lj(t.y,e.y)}function Bj(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}const oJ=1e-4,FDe=1-oJ,$De=1+oJ,aJ=.01,zDe=0-aJ,UDe=0+aJ;function Sc(t){return t.max-t.min}function jDe(t,e,n){return Math.abs(t-e)<=n}function Fj(t,e,n,i=.5){t.origin=i,t.originPoint=Bs(e.min,e.max,t.origin),t.scale=Sc(n)/Sc(e),t.translate=Bs(n.min,n.max,t.origin)-t.originPoint,(t.scale>=FDe&&t.scale<=$De||isNaN(t.scale))&&(t.scale=1),(t.translate>=zDe&&t.translate<=UDe||isNaN(t.translate))&&(t.translate=0)}function Qx(t,e,n,i){Fj(t.x,e.x,n.x,i?i.originX:void 0),Fj(t.y,e.y,n.y,i?i.originY:void 0)}function $j(t,e,n){t.min=n.min+e.min,t.max=t.min+Sc(e)}function VDe(t,e,n){$j(t.x,e.x,n.x),$j(t.y,e.y,n.y)}function zj(t,e,n){t.min=e.min-n.min,t.max=t.min+Sc(e)}function bS(t,e,n){zj(t.x,e.x,n.x),zj(t.y,e.y,n.y)}function Uj(t,e,n,i,o){return t-=e,t=wS(t,1/n,i),o!==void 0&&(t=wS(t,1/o,i)),t}function WDe(t,e=0,n=1,i=.5,o,l=t,h=t){if(vh.test(e)&&(e=parseFloat(e),e=Bs(h.min,h.max,e/100)-h.min),typeof e!="number")return;let s=Bs(l.min,l.max,i);t===l&&(s-=e),t.min=Uj(t.min,e,n,s,o),t.max=Uj(t.max,e,n,s,o)}function jj(t,e,[n,i,o],l,h){WDe(t,e[n],e[i],e[o],e.scale,l,h)}const HDe=["x","scaleX","originX"],GDe=["y","scaleY","originY"];function Vj(t,e,n,i){jj(t.x,e,HDe,n?n.x:void 0,i?i.x:void 0),jj(t.y,e,GDe,n?n.y:void 0,i?i.y:void 0)}function Wj(t){return t.translate===0&&t.scale===1}function cJ(t){return Wj(t.x)&&Wj(t.y)}function Hj(t,e){return t.min===e.min&&t.max===e.max}function qDe(t,e){return Hj(t.x,e.x)&&Hj(t.y,e.y)}function Gj(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function lJ(t,e){return Gj(t.x,e.x)&&Gj(t.y,e.y)}function qj(t){return Sc(t.x)/Sc(t.y)}function Zj(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}function dh(t){return[t("x"),t("y")]}function ZDe(t,e,n){let i="";const o=t.x.translate/e.x,l=t.y.translate/e.y,h=(n==null?void 0:n.z)||0;if((o||l||h)&&(i=`translate3d(${o}px, ${l}px, ${h}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:x,rotate:A,rotateX:P,rotateY:D,skewX:M,skewY:z}=n;x&&(i=`perspective(${x}px) ${i}`),A&&(i+=`rotate(${A}deg) `),P&&(i+=`rotateX(${P}deg) `),D&&(i+=`rotateY(${D}deg) `),M&&(i+=`skewX(${M}deg) `),z&&(i+=`skewY(${z}deg) `)}const s=t.x.scale*e.x,w=t.y.scale*e.y;return(s!==1||w!==1)&&(i+=`scale(${s}, ${w})`),i||"none"}const uJ=["TopLeft","TopRight","BottomLeft","BottomRight"],KDe=uJ.length,Kj=t=>typeof t=="string"?parseFloat(t):t,Yj=t=>typeof t=="number"||ti.test(t);function YDe(t,e,n,i,o,l){o?(t.opacity=Bs(0,n.opacity??1,XDe(i)),t.opacityExit=Bs(e.opacity??1,0,JDe(i))):l&&(t.opacity=Bs(e.opacity??1,n.opacity??1,i));for(let h=0;h<KDe;h++){const s=`border${uJ[h]}Radius`;let w=Xj(e,s),x=Xj(n,s);if(w===void 0&&x===void 0)continue;w||(w=0),x||(x=0),w===0||x===0||Yj(w)===Yj(x)?(t[s]=Math.max(Bs(Kj(w),Kj(x),i),0),(vh.test(x)||vh.test(w))&&(t[s]+="%")):t[s]=x}(e.rotate||n.rotate)&&(t.rotate=Bs(e.rotate||0,n.rotate||0,i))}function Xj(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const XDe=dJ(0,.5,nX),JDe=dJ(.5,.95,Cu);function dJ(t,e,n){return i=>i<t?0:i>e?1:n(aE(t,e,i))}function QDe(t,e,n){const i=Ja(t)?t:Rw(t);return i.start(PN("",i,e,n)),i.animation}function dE(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}const eNe=(t,e)=>t.depth-e.depth;class tNe{constructor(){this.children=[],this.isDirty=!1}add(e){pN(this.children,e),this.isDirty=!0}remove(e){pS(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(eNe),this.isDirty=!1,this.children.forEach(e)}}function nNe(t,e){const n=Ac.now(),i=({timestamp:o})=>{const l=o-n;l>=e&&(qm(i),t(l-e))};return ds.setup(i,!0),()=>qm(i)}function XT(t){return Ja(t)?t.get():t}class iNe{constructor(){this.members=[]}add(e){pN(this.members,e);for(let n=this.members.length-1;n>=0;n--){const i=this.members[n];if(i===e||i===this.lead||i===this.prevLead)continue;const o=i.instance;o&&o.isConnected===!1&&i.isPresent!==!1&&!i.snapshot&&pS(this.members,i)}e.scheduleRender()}remove(e){if(pS(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(o=>e===o);if(n===0)return!1;let i;for(let o=n;o>=0;o--){const l=this.members[o],h=l.instance;if(l.isPresent!==!1&&(!h||h.isConnected!==!1)){i=l;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender();const o=i.options.layoutDependency,l=e.options.layoutDependency;if(!(o!==void 0&&l!==void 0&&o===l)){const w=i.instance;w&&w.isConnected===!1&&!i.snapshot||(e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0))}const{crossfade:s}=e.options;s===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const JT={hasAnimatedSinceResize:!0,hasEverUpdated:!1},IR=["","X","Y","Z"],rNe=1e3;let sNe=0;function PR(t,e,n,i){const{latestValues:o}=e;o[t]&&(n[t]=o[t],e.setStaticValue(t,0),i&&(i[t]=0))}function hJ(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=kX(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:o,layoutId:l}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",ds,!(o||l))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&hJ(i)}function fJ({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:o}){return class{constructor(h={},s=e==null?void 0:e()){this.id=sNe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(cNe),this.nodes.forEach(hNe),this.nodes.forEach(fNe),this.nodes.forEach(lNe)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=h,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let w=0;w<this.path.length;w++)this.path[w].shouldResetTransform=!0;this.root===this&&(this.nodes=new tNe)}addEventListener(h,s){return this.eventHandlers.has(h)||this.eventHandlers.set(h,new gN),this.eventHandlers.get(h).add(s)}notifyListeners(h,...s){const w=this.eventHandlers.get(h);w&&w.notify(...s)}hasListeners(h){return this.eventHandlers.has(h)}mount(h){if(this.instance)return;this.isSVG=MN(h)&&!aDe(h),this.instance=h;const{layoutId:s,layout:w,visualElement:x}=this.options;if(x&&!x.current&&x.mount(h),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(w||s)&&(this.isLayoutDirty=!0),t){let A,P=0;const D=()=>this.root.updateBlockedByResize=!1;ds.read(()=>{P=window.innerWidth}),t(h,()=>{const M=window.innerWidth;M!==P&&(P=M,this.root.updateBlockedByResize=!0,A&&A(),A=nNe(D,250),JT.hasAnimatedSinceResize&&(JT.hasAnimatedSinceResize=!1,this.nodes.forEach(eV)))})}s&&this.root.registerSharedNode(s,this),this.options.animate!==!1&&x&&(s||w)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:P,hasRelativeLayoutChanged:D,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const z=this.options.transition||x.getDefaultTransition()||_Ne,{onLayoutAnimationStart:U,onLayoutAnimationComplete:G}=x.getProps(),ne=!this.targetLayout||!lJ(this.targetLayout,M),oe=!P&&D;if(this.options.layoutRoot||this.resumeFrom||oe||P&&(ne||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Q={...IN(z,"layout"),onPlay:U,onComplete:G};(x.shouldReduceMotion||this.options.layoutRoot)&&(Q.delay=0,Q.type=!1),this.startAnimation(Q),this.setAnimationOrigin(A,oe)}else P||eV(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const h=this.getStack();h&&h.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),qm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(pNe),this.animationId++)}getTransformTemplate(){const{visualElement:h}=this.options;return h&&h.getProps().transformTemplate}willUpdate(h=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&hJ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let A=0;A<this.path.length;A++){const P=this.path[A];P.shouldResetTransform=!0,P.updateScroll("snapshot"),P.options.layoutRoot&&P.willUpdate(!1)}const{layoutId:s,layout:w}=this.options;if(s===void 0&&!w)return;const x=this.getTransformTemplate();this.prevTransformTemplateValue=x?x(this.latestValues,""):void 0,this.updateSnapshot(),h&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Jj);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Qj);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(dNe),this.nodes.forEach(oNe),this.nodes.forEach(aNe)):this.nodes.forEach(Qj),this.clearAllSnapshots();const s=Ac.now();Aa.delta=Nh(0,1e3/60,s-Aa.timestamp),Aa.timestamp=s,Aa.isProcessing=!0,bR.update.process(Aa),bR.preRender.process(Aa),bR.render.process(Aa),Aa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,DN.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(uNe),this.sharedNodes.forEach(mNe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ds.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ds.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Sc(this.snapshot.measuredBox.x)&&!Sc(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let w=0;w<this.path.length;w++)this.path[w].updateScroll();const h=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Oo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,h?h.layoutBox:void 0)}updateScroll(h="measure"){let s=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===h&&(s=!1),s&&this.instance){const w=i(this.instance);this.scroll={animationId:this.root.animationId,phase:h,isRoot:w,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:w}}}resetTransform(){if(!o)return;const h=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,s=this.projectionDelta&&!cJ(this.projectionDelta),w=this.getTransformTemplate(),x=w?w(this.latestValues,""):void 0,A=x!==this.prevTransformTemplateValue;h&&this.instance&&(s||_0(this.latestValues)||A)&&(o(this.instance,x),this.shouldResetTransform=!1,this.scheduleRender())}measure(h=!0){const s=this.measurePageBox();let w=this.removeElementScroll(s);return h&&(w=this.removeTransform(w)),wNe(w),{animationId:this.root.animationId,measuredBox:s,layoutBox:w,latestValues:{},source:this.id}}measurePageBox(){var x;const{visualElement:h}=this.options;if(!h)return Oo();const s=h.measureViewportBox();if(!(((x=this.scroll)==null?void 0:x.wasRoot)||this.path.some(bNe))){const{scroll:A}=this.root;A&&(M1(s.x,A.offset.x),M1(s.y,A.offset.y))}return s}removeElementScroll(h){var w;const s=Oo();if(sd(s,h),(w=this.scroll)!=null&&w.wasRoot)return s;for(let x=0;x<this.path.length;x++){const A=this.path[x],{scroll:P,options:D}=A;A!==this.root&&P&&D.layoutScroll&&(P.wasRoot&&sd(s,h),M1(s.x,P.offset.x),M1(s.y,P.offset.y))}return s}applyTransform(h,s=!1){const w=Oo();sd(w,h);for(let x=0;x<this.path.length;x++){const A=this.path[x];!s&&A.options.layoutScroll&&A.scroll&&A!==A.root&&L1(w,{x:-A.scroll.offset.x,y:-A.scroll.offset.y}),_0(A.latestValues)&&L1(w,A.latestValues)}return _0(this.latestValues)&&L1(w,this.latestValues),w}removeTransform(h){const s=Oo();sd(s,h);for(let w=0;w<this.path.length;w++){const x=this.path[w];if(!x.instance||!_0(x.latestValues))continue;lk(x.latestValues)&&x.updateSnapshot();const A=Oo(),P=x.measurePageBox();sd(A,P),Vj(s,x.latestValues,x.snapshot?x.snapshot.layoutBox:void 0,A)}return _0(this.latestValues)&&Vj(s,this.latestValues),s}setTargetDelta(h){this.targetDelta=h,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(h){this.options={...this.options,...h,crossfade:h.crossfade!==void 0?h.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Aa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(h=!1){var M;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==s;if(!(h||w&&this.isSharedProjectionDirty||this.isProjectionDirty||(M=this.parent)!=null&&M.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:P}=this.options;if(!this.layout||!(A||P))return;this.resolvedRelativeTargetAt=Aa.timestamp;const D=this.getClosestProjectingParent();D&&this.linkedParentVersion!==D.layoutVersion&&!D.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(D&&D.layout?this.createRelativeTarget(D,this.layout.layoutBox,D.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Oo(),this.targetWithTransforms=Oo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),VDe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):sd(this.target,this.layout.layoutBox),YX(this.target,this.targetDelta)):sd(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,D&&!!D.resumingFrom==!!this.resumingFrom&&!D.options.layoutScroll&&D.target&&this.animationProgress!==1?this.createRelativeTarget(D,this.target,D.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||lk(this.parent.latestValues)||KX(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(h,s,w){this.relativeParent=h,this.linkedParentVersion=h.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Oo(),this.relativeTargetOrigin=Oo(),bS(this.relativeTargetOrigin,s,w),sd(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var z;const h=this.getLead(),s=!!this.resumingFrom||this!==h;let w=!0;if((this.isProjectionDirty||(z=this.parent)!=null&&z.isProjectionDirty)&&(w=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===Aa.timestamp&&(w=!1),w)return;const{layout:x,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(x||A))return;sd(this.layoutCorrected,this.layout.layoutBox);const P=this.treeScale.x,D=this.treeScale.y;_De(this.layoutCorrected,this.treeScale,this.path,s),h.layout&&!h.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(h.target=h.layout.layoutBox,h.targetWithTransforms=Oo());const{target:M}=h;if(!M){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Bj(this.prevProjectionDelta.x,this.projectionDelta.x),Bj(this.prevProjectionDelta.y,this.projectionDelta.y)),Qx(this.projectionDelta,this.layoutCorrected,M,this.latestValues),(this.treeScale.x!==P||this.treeScale.y!==D||!Zj(this.projectionDelta.x,this.prevProjectionDelta.x)||!Zj(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(h=!0){var s;if((s=this.options.visualElement)==null||s.scheduleRender(),h){const w=this.getStack();w&&w.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=N1(),this.projectionDelta=N1(),this.projectionDeltaWithTransform=N1()}setAnimationOrigin(h,s=!1){const w=this.snapshot,x=w?w.latestValues:{},A={...this.latestValues},P=N1();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const D=Oo(),M=w?w.source:void 0,z=this.layout?this.layout.source:void 0,U=M!==z,G=this.getStack(),ne=!G||G.members.length<=1,oe=!!(U&&!ne&&this.options.crossfade===!0&&!this.path.some(yNe));this.animationProgress=0;let Q;this.mixTargetDelta=de=>{const he=de/1e3;tV(P.x,h.x,he),tV(P.y,h.y,he),this.setTargetDelta(P),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(bS(D,this.layout.layoutBox,this.relativeParent.layout.layoutBox),gNe(this.relativeTarget,this.relativeTargetOrigin,D,he),Q&&qDe(this.relativeTarget,Q)&&(this.isProjectionDirty=!1),Q||(Q=Oo()),sd(Q,this.relativeTarget)),U&&(this.animationValues=A,YDe(A,x,this.latestValues,he,oe,ne)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=he},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(h){var s,w,x;this.notifyListeners("animationStart"),(s=this.currentAnimation)==null||s.stop(),(x=(w=this.resumingFrom)==null?void 0:w.currentAnimation)==null||x.stop(),this.pendingAnimation&&(qm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ds.update(()=>{JT.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Rw(0)),this.motionValue.jump(0,!1),this.currentAnimation=QDe(this.motionValue,[0,1e3],{...h,velocity:0,isSync:!0,onUpdate:A=>{this.mixTargetDelta(A),h.onUpdate&&h.onUpdate(A)},onStop:()=>{},onComplete:()=>{h.onComplete&&h.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const h=this.getStack();h&&h.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(rNe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const h=this.getLead();let{targetWithTransforms:s,target:w,layout:x,latestValues:A}=h;if(!(!s||!w||!x)){if(this!==h&&this.layout&&x&&pJ(this.options.animationType,this.layout.layoutBox,x.layoutBox)){w=this.target||Oo();const P=Sc(this.layout.layoutBox.x);w.x.min=h.target.x.min,w.x.max=w.x.min+P;const D=Sc(this.layout.layoutBox.y);w.y.min=h.target.y.min,w.y.max=w.y.min+D}sd(s,w),L1(s,A),Qx(this.projectionDeltaWithTransform,this.layoutCorrected,s,A)}}registerSharedNode(h,s){this.sharedNodes.has(h)||this.sharedNodes.set(h,new iNe),this.sharedNodes.get(h).add(s);const x=s.options.initialPromotionConfig;s.promote({transition:x?x.transition:void 0,preserveFollowOpacity:x&&x.shouldPreserveFollowOpacity?x.shouldPreserveFollowOpacity(s):void 0})}isLead(){const h=this.getStack();return h?h.lead===this:!0}getLead(){var s;const{layoutId:h}=this.options;return h?((s=this.getStack())==null?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:h}=this.options;return h?(s=this.getStack())==null?void 0:s.prevLead:void 0}getStack(){const{layoutId:h}=this.options;if(h)return this.root.sharedNodes.get(h)}promote({needsReset:h,transition:s,preserveFollowOpacity:w}={}){const x=this.getStack();x&&x.promote(this,w),h&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const h=this.getStack();return h?h.relegate(this):!1}resetSkewAndRotation(){const{visualElement:h}=this.options;if(!h)return;let s=!1;const{latestValues:w}=h;if((w.z||w.rotate||w.rotateX||w.rotateY||w.rotateZ||w.skewX||w.skewY)&&(s=!0),!s)return;const x={};w.z&&PR("z",h,x,this.animationValues);for(let A=0;A<IR.length;A++)PR(`rotate${IR[A]}`,h,x,this.animationValues),PR(`skew${IR[A]}`,h,x,this.animationValues);h.render();for(const A in x)h.setStaticValue(A,x[A]),this.animationValues&&(this.animationValues[A]=x[A]);h.scheduleRender()}applyProjectionStyles(h,s){if(!this.instance||this.isSVG)return;if(!this.isVisible){h.visibility="hidden";return}const w=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,h.visibility="",h.opacity="",h.pointerEvents=XT(s==null?void 0:s.pointerEvents)||"",h.transform=w?w(this.latestValues,""):"none";return}const x=this.getLead();if(!this.projectionDelta||!this.layout||!x.target){this.options.layoutId&&(h.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,h.pointerEvents=XT(s==null?void 0:s.pointerEvents)||""),this.hasProjected&&!_0(this.latestValues)&&(h.transform=w?w({},""):"none",this.hasProjected=!1);return}h.visibility="";const A=x.animationValues||x.latestValues;this.applyTransformsToTarget();let P=ZDe(this.projectionDeltaWithTransform,this.treeScale,A);w&&(P=w(A,P)),h.transform=P;const{x:D,y:M}=this.projectionDelta;h.transformOrigin=`${D.origin*100}% ${M.origin*100}% 0`,x.animationValues?h.opacity=x===this?A.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:A.opacityExit:h.opacity=x===this?A.opacity!==void 0?A.opacity:"":A.opacityExit!==void 0?A.opacityExit:0;for(const z in dk){if(A[z]===void 0)continue;const{correct:U,applyTo:G,isCSSVariable:ne}=dk[z],oe=P==="none"?A[z]:U(A[z],x);if(G){const Q=G.length;for(let de=0;de<Q;de++)h[G[de]]=oe}else ne?this.options.visualElement.renderState.vars[z]=oe:h[z]=oe}this.options.layoutId&&(h.pointerEvents=x===this?XT(s==null?void 0:s.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(h=>{var s;return(s=h.currentAnimation)==null?void 0:s.stop()}),this.root.nodes.forEach(Jj),this.root.sharedNodes.clear()}}}function oNe(t){t.updateLayout()}function aNe(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:o}=t.layout,{animationType:l}=t.options,h=e.source!==t.layout.source;l==="size"?dh(P=>{const D=h?e.measuredBox[P]:e.layoutBox[P],M=Sc(D);D.min=i[P].min,D.max=D.min+M}):pJ(l,e.layoutBox,i)&&dh(P=>{const D=h?e.measuredBox[P]:e.layoutBox[P],M=Sc(i[P]);D.max=D.min+M,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[P].max=t.relativeTarget[P].min+M)});const s=N1();Qx(s,i,e.layoutBox);const w=N1();h?Qx(w,t.applyTransform(o,!0),e.measuredBox):Qx(w,i,e.layoutBox);const x=!cJ(s);let A=!1;if(!t.resumeFrom){const P=t.getClosestProjectingParent();if(P&&!P.resumeFrom){const{snapshot:D,layout:M}=P;if(D&&M){const z=Oo();bS(z,e.layoutBox,D.layoutBox);const U=Oo();bS(U,i,M.layoutBox),lJ(z,U)||(A=!0),P.options.layoutRoot&&(t.relativeTarget=U,t.relativeTargetOrigin=z,t.relativeParent=P)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:e,delta:w,layoutDelta:s,hasLayoutChanged:x,hasRelativeLayoutChanged:A})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function cNe(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function lNe(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function uNe(t){t.clearSnapshot()}function Jj(t){t.clearMeasurements()}function Qj(t){t.isLayoutDirty=!1}function dNe(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function eV(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function hNe(t){t.resolveTargetDelta()}function fNe(t){t.calcProjection()}function pNe(t){t.resetSkewAndRotation()}function mNe(t){t.removeLeadSnapshot()}function tV(t,e,n){t.translate=Bs(e.translate,0,n),t.scale=Bs(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function nV(t,e,n,i){t.min=Bs(e.min,n.min,i),t.max=Bs(e.max,n.max,i)}function gNe(t,e,n,i){nV(t.x,e.x,n.x,i),nV(t.y,e.y,n.y,i)}function yNe(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const _Ne={duration:.45,ease:[.4,0,.1,1]},iV=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),rV=iV("applewebkit/")&&!iV("chrome/")?Math.round:Cu;function sV(t){t.min=rV(t.min),t.max=rV(t.max)}function wNe(t){sV(t.x),sV(t.y)}function pJ(t,e,n){return t==="position"||t==="preserve-aspect"&&!jDe(qj(e),qj(n),.2)}function bNe(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const vNe=fJ({attachResizeListener:(t,e)=>dE(t,"resize",e),measureScroll:()=>{var t,e;return{x:document.documentElement.scrollLeft||((t=document.body)==null?void 0:t.scrollLeft)||0,y:document.documentElement.scrollTop||((e=document.body)==null?void 0:e.scrollTop)||0}},checkIsScrollRoot:()=>!0}),RR={current:void 0},mJ=fJ({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!RR.current){const t=new vNe({});t.mount(window),t.setOptions({layoutScroll:!0}),RR.current=t}return RR.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),zN=qt.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function oV(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function xNe(...t){return e=>{let n=!1;const i=t.map(o=>{const l=oV(o,e);return!n&&typeof l=="function"&&(n=!0),l});if(n)return()=>{for(let o=0;o<i.length;o++){const l=i[o];typeof l=="function"?l():oV(t[o],null)}}}}function ENe(...t){return qt.useCallback(xNe(...t),t)}class CNe extends qt.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const i=n.offsetParent,o=ak(i)&&i.offsetWidth||0,l=ak(i)&&i.offsetHeight||0,h=this.props.sizeRef.current;h.height=n.offsetHeight||0,h.width=n.offsetWidth||0,h.top=n.offsetTop,h.left=n.offsetLeft,h.right=o-h.width-h.left,h.bottom=l-h.height-h.top}return null}componentDidUpdate(){}render(){return this.props.children}}function TNe({children:t,isPresent:e,anchorX:n,anchorY:i,root:o,pop:l}){var D;const h=qt.useId(),s=qt.useRef(null),w=qt.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:x}=qt.useContext(zN),A=((D=t.props)==null?void 0:D.ref)??(t==null?void 0:t.ref),P=ENe(s,A);return qt.useInsertionEffect(()=>{const{width:M,height:z,top:U,left:G,right:ne,bottom:oe}=w.current;if(e||l===!1||!s.current||!M||!z)return;const Q=n==="left"?`left: ${G}`:`right: ${ne}`,de=i==="bottom"?`bottom: ${oe}`:`top: ${U}`;s.current.dataset.motionPopId=h;const he=document.createElement("style");x&&(he.nonce=x);const Ie=o??document.head;return Ie.appendChild(he),he.sheet&&he.sheet.insertRule(`
          [data-motion-pop-id="${h}"] {
            position: absolute !important;
            width: ${M}px !important;
            height: ${z}px !important;
            ${Q}px !important;
            ${de}px !important;
          }
        `),()=>{Ie.contains(he)&&Ie.removeChild(he)}},[e]),ot.jsx(CNe,{isPresent:e,childRef:s,sizeRef:w,pop:l,children:l===!1?t:qt.cloneElement(t,{ref:P})})}const ANe=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:o,presenceAffectsLayout:l,mode:h,anchorX:s,anchorY:w,root:x})=>{const A=fN(SNe),P=qt.useId();let D=!0,M=qt.useMemo(()=>(D=!1,{id:P,initial:e,isPresent:n,custom:o,onExitComplete:z=>{A.set(z,!0);for(const U of A.values())if(!U)return;i&&i()},register:z=>(A.set(z,!1),()=>A.delete(z))}),[n,A,i]);return l&&D&&(M={...M}),qt.useMemo(()=>{A.forEach((z,U)=>A.set(U,!1))},[n]),qt.useEffect(()=>{!n&&!A.size&&i&&i()},[n]),t=ot.jsx(TNe,{pop:h==="popLayout",isPresent:n,anchorX:s,anchorY:w,root:x,children:t}),ot.jsx(CI.Provider,{value:M,children:t})};function SNe(){return new Map}function gJ(t=!0){const e=qt.useContext(CI);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:o}=e,l=qt.useId();qt.useEffect(()=>{if(t)return o(l)},[t]);const h=qt.useCallback(()=>t&&i&&i(l),[l,i,t]);return!n&&i?[!1,h]:[!0]}const PT=t=>t.key||"";function aV(t){const e=[];return qt.Children.forEach(t,n=>{qt.isValidElement(n)&&e.push(n)}),e}const INe=({children:t,custom:e,initial:n=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:l="sync",propagate:h=!1,anchorX:s="left",anchorY:w="top",root:x})=>{const[A,P]=gJ(h),D=qt.useMemo(()=>aV(t),[t]),M=h&&!A?[]:D.map(PT),z=qt.useRef(!0),U=qt.useRef(D),G=fN(()=>new Map),ne=qt.useRef(new Set),[oe,Q]=qt.useState(D),[de,he]=qt.useState(D);WY(()=>{z.current=!1,U.current=D;for(let Ue=0;Ue<de.length;Ue++){const ze=PT(de[Ue]);M.includes(ze)?(G.delete(ze),ne.current.delete(ze)):G.get(ze)!==!0&&G.set(ze,!1)}},[de,M.length,M.join("-")]);const Ie=[];if(D!==oe){let Ue=[...D];for(let ze=0;ze<de.length;ze++){const ht=de[ze],ft=PT(ht);M.includes(ft)||(Ue.splice(ze,0,ht),Ie.push(ht))}return l==="wait"&&Ie.length&&(Ue=Ie),he(aV(Ue)),Q(D),null}const{forceRender:ke}=qt.useContext(hN);return ot.jsx(ot.Fragment,{children:de.map(Ue=>{const ze=PT(Ue),ht=h&&!A?!1:D===de||M.includes(ze),ft=()=>{if(ne.current.has(ze))return;if(ne.current.add(ze),G.has(ze))G.set(ze,!0);else return;let ct=!0;G.forEach(je=>{je||(ct=!1)}),ct&&(ke==null||ke(),he(U.current),h&&(P==null||P()),i&&i())};return ot.jsx(ANe,{isPresent:ht,initial:!z.current||n?void 0:!1,custom:e,presenceAffectsLayout:o,mode:l,root:x,onExitComplete:ht?void 0:ft,anchorX:s,anchorY:w,children:Ue},ze)})})},yJ=qt.createContext({strict:!1}),cV={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let lV=!1;function PNe(){if(lV)return;const t={};for(const e in cV)t[e]={isEnabled:n=>cV[e].some(i=>!!n[i])};GX(t),lV=!0}function _J(){return PNe(),pDe()}function RNe(t){const e=_J();for(const n in t)e[n]={...e[n],...t[n]};GX(e)}const ONe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function vS(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||ONe.has(t)}let wJ=t=>!vS(t);function kNe(t){typeof t=="function"&&(wJ=e=>e.startsWith("on")?!vS(e):t(e))}try{kNe(require("@emotion/is-prop-valid").default)}catch{}function DNe(t,e,n){const i={};for(const o in t)o==="values"&&typeof t.values=="object"||(wJ(o)||n===!0&&vS(o)||!e&&!vS(o)||t.draggable&&o.startsWith("onDrag"))&&(i[o]=t[o]);return i}const SI=qt.createContext({});function NNe(t,e){if(AI(t)){const{initial:n,animate:i}=t;return{initial:n===!1||uE(n)?n:void 0,animate:uE(i)?i:void 0}}return t.inherit!==!1?e:{}}function MNe(t){const{initial:e,animate:n}=NNe(t,qt.useContext(SI));return qt.useMemo(()=>({initial:e,animate:n}),[uV(e),uV(n)])}function uV(t){return Array.isArray(t)?t.join(" "):t}const UN=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function bJ(t,e,n){for(const i in e)!Ja(e[i])&&!QX(i,n)&&(t[i]=e[i])}function LNe({transformTemplate:t},e){return qt.useMemo(()=>{const n=UN();return FN(n,e,t),Object.assign({},n.vars,n.style)},[e])}function BNe(t,e){const n=t.style||{},i={};return bJ(i,n,t),Object.assign(i,LNe(t,e)),i}function FNe(t,e){const n={},i=BNe(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}const vJ=()=>({...UN(),attrs:{}});function $Ne(t,e,n,i){const o=qt.useMemo(()=>{const l=vJ();return eJ(l,e,nJ(i),t.transformTemplate,t.style),{...l.attrs,style:{...l.style}}},[e]);if(t.style){const l={};bJ(l,t.style,t),o.style={...l,...o.style}}return o}const zNe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jN(t){return typeof t!="string"||t.includes("-")?!1:!!(zNe.indexOf(t)>-1||/[A-Z]/u.test(t))}function UNe(t,e,n,{latestValues:i},o,l=!1,h){const w=(h??jN(t)?$Ne:FNe)(e,i,o,t),x=DNe(e,typeof t=="string",l),A=t!==qt.Fragment?{...x,...w,ref:n}:{},{children:P}=e,D=qt.useMemo(()=>Ja(P)?P.get():P,[P]);return qt.createElement(t,{...A,children:D})}function jNe({scrapeMotionValuesFromProps:t,createRenderState:e},n,i,o){return{latestValues:VNe(n,i,o,t),renderState:e()}}function VNe(t,e,n,i){const o={},l=i(t,{});for(const D in l)o[D]=XT(l[D]);let{initial:h,animate:s}=t;const w=AI(t),x=WX(t);e&&x&&!w&&t.inherit!==!1&&(h===void 0&&(h=e.initial),s===void 0&&(s=e.animate));let A=n?n.initial===!1:!1;A=A||h===!1;const P=A?s:h;if(P&&typeof P!="boolean"&&!TI(P)){const D=Array.isArray(P)?P:[P];for(let M=0;M<D.length;M++){const z=RN(t,D[M]);if(z){const{transitionEnd:U,transition:G,...ne}=z;for(const oe in ne){let Q=ne[oe];if(Array.isArray(Q)){const de=A?Q.length-1:0;Q=Q[de]}Q!==null&&(o[oe]=Q)}for(const oe in U)o[oe]=U[oe]}}}return o}const xJ=t=>(e,n)=>{const i=qt.useContext(SI),o=qt.useContext(CI),l=()=>jNe(t,e,i,o);return n?l():fN(l)},WNe=xJ({scrapeMotionValuesFromProps:$N,createRenderState:UN}),HNe=xJ({scrapeMotionValuesFromProps:iJ,createRenderState:vJ}),GNe=Symbol.for("motionComponentSymbol");function qNe(t,e,n){const i=qt.useRef(n);qt.useInsertionEffect(()=>{i.current=n});const o=qt.useRef(null);return qt.useCallback(l=>{var s;l&&((s=t.onMount)==null||s.call(t,l)),e&&(l?e.mount(l):e.unmount());const h=i.current;if(typeof h=="function")if(l){const w=h(l);typeof w=="function"&&(o.current=w)}else o.current?(o.current(),o.current=null):h(l);else h&&(h.current=l)},[e])}const EJ=qt.createContext({});function C1(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function ZNe(t,e,n,i,o,l){var Q,de;const{visualElement:h}=qt.useContext(SI),s=qt.useContext(yJ),w=qt.useContext(CI),x=qt.useContext(zN),A=x.reducedMotion,P=x.skipAnimations,D=qt.useRef(null),M=qt.useRef(!1);i=i||s.renderer,!D.current&&i&&(D.current=i(t,{visualState:e,parent:h,props:n,presenceContext:w,blockInitialAnimation:w?w.initial===!1:!1,reducedMotionConfig:A,skipAnimations:P,isSVG:l}),M.current&&D.current&&(D.current.manuallyAnimateOnMount=!0));const z=D.current,U=qt.useContext(EJ);z&&!z.projection&&o&&(z.type==="html"||z.type==="svg")&&KNe(D.current,n,o,U);const G=qt.useRef(!1);qt.useInsertionEffect(()=>{z&&G.current&&z.update(n,w)});const ne=n[OX],oe=qt.useRef(!!ne&&!((Q=window.MotionHandoffIsComplete)!=null&&Q.call(window,ne))&&((de=window.MotionHasOptimisedAnimation)==null?void 0:de.call(window,ne)));return WY(()=>{M.current=!0,z&&(G.current=!0,window.MotionIsMounted=!0,z.updateFeatures(),z.scheduleRenderMicrotask(),oe.current&&z.animationState&&z.animationState.animateChanges())}),qt.useEffect(()=>{z&&(!oe.current&&z.animationState&&z.animationState.animateChanges(),oe.current&&(queueMicrotask(()=>{var he;(he=window.MotionHandoffMarkAsComplete)==null||he.call(window,ne)}),oe.current=!1),z.enteringChildren=void 0)}),z}function KNe(t,e,n,i){const{layoutId:o,layout:l,drag:h,dragConstraints:s,layoutScroll:w,layoutRoot:x,layoutCrossfade:A}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:CJ(t.parent)),t.projection.setOptions({layoutId:o,layout:l,alwaysMeasureLayout:!!h||s&&C1(s),visualElement:t,animationType:typeof l=="string"?l:"both",initialPromotionConfig:i,crossfade:A,layoutScroll:w,layoutRoot:x})}function CJ(t){if(t)return t.options.allowProjection!==!1?t.projection:CJ(t.parent)}function OR(t,{forwardMotionProps:e=!1,type:n}={},i,o){i&&RNe(i);const l=n?n==="svg":jN(t),h=l?HNe:WNe;function s(x,A){let P;const D={...qt.useContext(zN),...x,layoutId:YNe(x)},{isStatic:M}=D,z=MNe(x),U=h(x,M);if(!M&&VY){XNe();const G=JNe(D);P=G.MeasureLayout,z.visualElement=ZNe(t,U,D,o,G.ProjectionNode,l)}return ot.jsxs(SI.Provider,{value:z,children:[P&&z.visualElement?ot.jsx(P,{visualElement:z.visualElement,...D}):null,UNe(t,x,qNe(U,z.visualElement,A),U,M,e,l)]})}s.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const w=qt.forwardRef(s);return w[GNe]=t,w}function YNe({layoutId:t}){const e=qt.useContext(hN).id;return e&&t!==void 0?e+"-"+t:t}function XNe(t,e){qt.useContext(yJ).strict}function JNe(t){const e=_J(),{drag:n,layout:i}=e;if(!n&&!i)return{};const o={...n,...i};return{MeasureLayout:n!=null&&n.isEnabled(t)||i!=null&&i.isEnabled(t)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}function QNe(t,e){if(typeof Proxy>"u")return OR;const n=new Map,i=(l,h)=>OR(l,h,t,e),o=(l,h)=>i(l,h);return new Proxy(o,{get:(l,h)=>h==="create"?i:(n.has(h)||n.set(h,OR(h,void 0,t,e)),n.get(h))})}const eMe=(t,e)=>e.isSVG??jN(t)?new ODe(e):new TDe(e,{allowProjection:t!==qt.Fragment});class tMe extends sg{constructor(e){super(e),e.animationState||(e.animationState=LDe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();TI(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let nMe=0;class iMe extends sg{constructor(){super(...arguments),this.id=nMe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const o=this.node.animationState.setActive("exit",!e);n&&!e&&o.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const rMe={animation:{Feature:tMe},exit:{Feature:iMe}};function d3(t){return{point:{x:t.pageX,y:t.pageY}}}const sMe=t=>e=>NN(e)&&t(e,d3(e));function e2(t,e,n,i){return dE(t,e,sMe(n),i)}const TJ=({current:t})=>t?t.ownerDocument.defaultView:null,dV=(t,e)=>Math.abs(t-e);function oMe(t,e){const n=dV(t.x,e.x),i=dV(t.y,e.y);return Math.sqrt(n**2+i**2)}const hV=new Set(["auto","scroll"]);class AJ{constructor(e,n,{transformPagePoint:i,contextWindow:o=window,dragSnapToOrigin:l=!1,distanceThreshold:h=3,element:s}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=M=>{this.handleScroll(M.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const M=DR(this.lastMoveEventInfo,this.history),z=this.startEvent!==null,U=oMe(M.offset,{x:0,y:0})>=this.distanceThreshold;if(!z&&!U)return;const{point:G}=M,{timestamp:ne}=Aa;this.history.push({...G,timestamp:ne});const{onStart:oe,onMove:Q}=this.handlers;z||(oe&&oe(this.lastMoveEvent,M),this.startEvent=this.lastMoveEvent),Q&&Q(this.lastMoveEvent,M)},this.handlePointerMove=(M,z)=>{this.lastMoveEvent=M,this.lastMoveEventInfo=kR(z,this.transformPagePoint),ds.update(this.updatePoint,!0)},this.handlePointerUp=(M,z)=>{this.end();const{onEnd:U,onSessionEnd:G,resumeAnimation:ne}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&ne&&ne(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const oe=DR(M.type==="pointercancel"?this.lastMoveEventInfo:kR(z,this.transformPagePoint),this.history);this.startEvent&&U&&U(M,oe),G&&G(M,oe)},!NN(e))return;this.dragSnapToOrigin=l,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=h,this.contextWindow=o||window;const w=d3(e),x=kR(w,this.transformPagePoint),{point:A}=x,{timestamp:P}=Aa;this.history=[{...A,timestamp:P}];const{onSessionStart:D}=n;D&&D(e,DR(x,this.history)),this.removeListeners=c3(e2(this.contextWindow,"pointermove",this.handlePointerMove),e2(this.contextWindow,"pointerup",this.handlePointerUp),e2(this.contextWindow,"pointercancel",this.handlePointerUp)),s&&this.startScrollTracking(s)}startScrollTracking(e){let n=e.parentElement;for(;n;){const i=getComputedStyle(n);(hV.has(i.overflowX)||hV.has(i.overflowY))&&this.scrollPositions.set(n,{x:n.scrollLeft,y:n.scrollTop}),n=n.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0}),window.addEventListener("scroll",this.onWindowScroll),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){const n=this.scrollPositions.get(e);if(!n)return;const i=e===window,o=i?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},l={x:o.x-n.x,y:o.y-n.y};l.x===0&&l.y===0||(i?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=l.x,this.lastMoveEventInfo.point.y+=l.y):this.history.length>0&&(this.history[0].x-=l.x,this.history[0].y-=l.y),this.scrollPositions.set(e,o),ds.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),qm(this.updatePoint)}}function kR(t,e){return e?{point:e(t.point)}:t}function fV(t,e){return{x:t.x-e.x,y:t.y-e.y}}function DR({point:t},e){return{point:t,delta:fV(t,SJ(e)),offset:fV(t,aMe(e)),velocity:cMe(e,.1)}}function aMe(t){return t[0]}function SJ(t){return t[t.length-1]}function cMe(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const o=SJ(t);for(;n>=0&&(i=t[n],!(o.timestamp-i.timestamp>yd(e)));)n--;if(!i)return{x:0,y:0};i===t[0]&&t.length>2&&o.timestamp-i.timestamp>yd(e)*2&&(i=t[1]);const l=Eu(o.timestamp-i.timestamp);if(l===0)return{x:0,y:0};const h={x:(o.x-i.x)/l,y:(o.y-i.y)/l};return h.x===1/0&&(h.x=0),h.y===1/0&&(h.y=0),h}function lMe(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?Bs(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?Bs(n,t,i.max):Math.min(t,n)),t}function pV(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function uMe(t,{top:e,left:n,bottom:i,right:o}){return{x:pV(t.x,n,o),y:pV(t.y,e,i)}}function mV(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function dMe(t,e){return{x:mV(t.x,e.x),y:mV(t.y,e.y)}}function hMe(t,e){let n=.5;const i=Sc(t),o=Sc(e);return o>i?n=aE(e.min,e.max-i,t.min):i>o&&(n=aE(t.min,t.max-o,e.min)),Nh(0,1,n)}function fMe(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const hk=.35;function pMe(t=hk){return t===!1?t=0:t===!0&&(t=hk),{x:gV(t,"left","right"),y:gV(t,"top","bottom")}}function gV(t,e,n){return{min:yV(t,e),max:yV(t,n)}}function yV(t,e){return typeof t=="number"?t:t[e]||0}const mMe=new WeakMap;class gMe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Oo(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=P=>{n&&this.snapToCursor(d3(P).point),this.stopAnimation()},h=(P,D)=>{const{drag:M,dragPropagation:z,onDragStart:U}=this.getProps();if(M&&!z&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Wke(M),!this.openDragLock))return;this.latestPointerEvent=P,this.latestPanInfo=D,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),dh(ne=>{let oe=this.getAxisMotionValue(ne).get()||0;if(vh.test(oe)){const{projection:Q}=this.visualElement;if(Q&&Q.layout){const de=Q.layout.layoutBox[ne];de&&(oe=Sc(de)*(parseFloat(oe)/100))}}this.originPoint[ne]=oe}),U&&ds.update(()=>U(P,D),!1,!0),ik(this.visualElement,"transform");const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},s=(P,D)=>{this.latestPointerEvent=P,this.latestPanInfo=D;const{dragPropagation:M,dragDirectionLock:z,onDirectionLock:U,onDrag:G}=this.getProps();if(!M&&!this.openDragLock)return;const{offset:ne}=D;if(z&&this.currentDirection===null){this.currentDirection=_Me(ne),this.currentDirection!==null&&U&&U(this.currentDirection);return}this.updateAxis("x",D.point,ne),this.updateAxis("y",D.point,ne),this.visualElement.render(),G&&ds.update(()=>G(P,D),!1,!0)},w=(P,D)=>{this.latestPointerEvent=P,this.latestPanInfo=D,this.stop(P,D),this.latestPointerEvent=null,this.latestPanInfo=null},x=()=>{const{dragSnapToOrigin:P}=this.getProps();(P||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:A}=this.getProps();this.panSession=new AJ(e,{onSessionStart:l,onStart:h,onMove:s,onSessionEnd:w,resumeAnimation:x},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:A,distanceThreshold:i,contextWindow:TJ(this.visualElement),element:this.visualElement.current})}stop(e,n){const i=e||this.latestPointerEvent,o=n||this.latestPanInfo,l=this.isDragging;if(this.cancel(),!l||!o||!i)return;const{velocity:h}=o;this.startAnimation(h);const{onDragEnd:s}=this.getProps();s&&ds.postRender(()=>s(i,o))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,n,i){const{drag:o}=this.getProps();if(!i||!RT(e,o,this.currentDirection))return;const l=this.getAxisMotionValue(e);let h=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(h=lMe(h,this.constraints[e],this.elastic[e])),l.set(h)}resolveConstraints(){var l;const{dragConstraints:e,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(l=this.visualElement.projection)==null?void 0:l.layout,o=this.constraints;e&&C1(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=uMe(i.layoutBox,e):this.constraints=!1,this.elastic=pMe(n),o!==this.constraints&&!C1(e)&&i&&this.constraints&&!this.hasMutatedConstraints&&dh(h=>{this.constraints!==!1&&this.getAxisMotionValue(h)&&(this.constraints[h]=fMe(i.layoutBox[h],this.constraints[h]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!C1(e))return!1;const i=e.current,{projection:o}=this.visualElement;if(!o||!o.layout)return!1;const l=wDe(i,o.root,this.visualElement.getTransformPagePoint());let h=dMe(o.layout.layoutBox,l);if(n){const s=n(gDe(h));this.hasMutatedConstraints=!!s,s&&(h=ZX(s))}return h}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:o,dragTransition:l,dragSnapToOrigin:h,onDragTransitionEnd:s}=this.getProps(),w=this.constraints||{},x=dh(A=>{if(!RT(A,n,this.currentDirection))return;let P=w&&w[A]||{};h&&(P={min:0,max:0});const D=o?200:1e6,M=o?40:1e7,z={type:"inertia",velocity:i?e[A]:0,bounceStiffness:D,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...l,...P};return this.startAxisValueAnimation(A,z)});return Promise.all(x).then(s)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return ik(this.visualElement,e),i.start(PN(e,i,0,n,this.visualElement,!1))}stopAnimation(){dh(e=>this.getAxisMotionValue(e).stop())}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),o=i[n];return o||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){dh(n=>{const{drag:i}=this.getProps();if(!RT(n,i,this.currentDirection))return;const{projection:o}=this.visualElement,l=this.getAxisMotionValue(n);if(o&&o.layout){const{min:h,max:s}=o.layout.layoutBox[n],w=l.get()||0;l.set(e[n]-Bs(h,s,.5)+w)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!C1(n)||!i||!this.constraints)return;this.stopAnimation();const o={x:0,y:0};dh(h=>{const s=this.getAxisMotionValue(h);if(s&&this.constraints!==!1){const w=s.get();o[h]=hMe({min:w,max:w},this.constraints[h])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.constraints=!1,this.resolveConstraints(),dh(h=>{if(!RT(h,e,null))return;const s=this.getAxisMotionValue(h),{min:w,max:x}=this.constraints[h];s.set(Bs(w,x,o[h]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;mMe.set(this.visualElement,this);const e=this.visualElement.current,n=e2(e,"pointerdown",x=>{const{drag:A,dragListener:P=!0}=this.getProps(),D=x.target,M=D!==e&&Yke(D);A&&P&&!M&&this.start(x)});let i;const o=()=>{const{dragConstraints:x}=this.getProps();C1(x)&&x.current&&(this.constraints=this.resolveRefConstraints(),i||(i=yMe(e,x.current,()=>this.scalePositionWithinConstraints())))},{projection:l}=this.visualElement,h=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ds.read(o);const s=dE(window,"resize",()=>this.scalePositionWithinConstraints()),w=l.addEventListener("didUpdate",({delta:x,hasLayoutChanged:A})=>{this.isDragging&&A&&(dh(P=>{const D=this.getAxisMotionValue(P);D&&(this.originPoint[P]+=x[P].translate,D.set(D.get()+x[P].translate))}),this.visualElement.render())});return()=>{s(),n(),h(),w&&w(),i&&i()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:o=!1,dragConstraints:l=!1,dragElastic:h=hk,dragMomentum:s=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:o,dragConstraints:l,dragElastic:h,dragMomentum:s}}}function _V(t){let e=!0;return()=>{if(e){e=!1;return}t()}}function yMe(t,e,n){const i=Tj(t,_V(n)),o=Tj(e,_V(n));return()=>{i(),o()}}function RT(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function _Me(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class wMe extends sg{constructor(e){super(e),this.removeGroupControls=Cu,this.removeListeners=Cu,this.controls=new gMe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Cu}update(){const{dragControls:e}=this.node.getProps(),{dragControls:n}=this.node.prevProps||{};e!==n&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const NR=t=>(e,n)=>{t&&ds.update(()=>t(e,n),!1,!0)};class bMe extends sg{constructor(){super(...arguments),this.removePointerDownListener=Cu}onPointerDown(e){this.session=new AJ(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:TJ(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:o}=this.node.getProps();return{onSessionStart:NR(e),onStart:NR(n),onMove:NR(i),onEnd:(l,h)=>{delete this.session,o&&ds.postRender(()=>o(l,h))}}}mount(){this.removePointerDownListener=e2(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let MR=!1;class vMe extends qt.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:o}=this.props,{projection:l}=e;l&&(n.group&&n.group.add(l),i&&i.register&&o&&i.register(l),MR&&l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),JT.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:o,isPresent:l}=this.props,{projection:h}=i;return h&&(h.isPresent=l,e.layoutDependency!==n&&h.setOptions({...h.options,layoutDependency:n}),MR=!0,o||e.layoutDependency!==n||n===void 0||e.isPresent!==l?h.willUpdate():this.safeToRemove(),e.isPresent!==l&&(l?h.promote():h.relegate()||ds.postRender(()=>{const s=h.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),DN.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:o}=e;MR=!0,o&&(o.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(o),i&&i.deregister&&i.deregister(o))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function IJ(t){const[e,n]=gJ(),i=qt.useContext(hN);return ot.jsx(vMe,{...t,layoutGroup:i,switchLayoutGroup:qt.useContext(EJ),isPresent:e,safeToRemove:n})}const xMe={pan:{Feature:bMe},drag:{Feature:wMe,ProjectionNode:mJ,MeasureLayout:IJ}};function wV(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const o="onHover"+n,l=i[o];l&&ds.postRender(()=>l(e,d3(e)))}class EMe extends sg{mount(){const{current:e}=this.node;e&&(this.unmount=Gke(e,(n,i)=>(wV(this.node,i,"Start"),o=>wV(this.node,o,"End"))))}unmount(){}}class CMe extends sg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=c3(dE(this.node.current,"focus",()=>this.onFocus()),dE(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function bV(t,e,n){const{props:i}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const o="onTap"+(n==="End"?"":n),l=i[o];l&&ds.postRender(()=>l(e,d3(e)))}class TMe extends sg{mount(){const{current:e}=this.node;if(!e)return;const{globalTapTarget:n,propagate:i}=this.node.props;this.unmount=Jke(e,(o,l)=>(bV(this.node,l,"Start"),(h,{success:s})=>bV(this.node,h,s?"End":"Cancel")),{useGlobalTarget:n,stopPropagation:(i==null?void 0:i.tap)===!1})}unmount(){}}const fk=new WeakMap,LR=new WeakMap,AMe=t=>{const e=fk.get(t.target);e&&e(t)},SMe=t=>{t.forEach(AMe)};function IMe({root:t,...e}){const n=t||document;LR.has(n)||LR.set(n,{});const i=LR.get(n),o=JSON.stringify(e);return i[o]||(i[o]=new IntersectionObserver(SMe,{root:t,...e})),i[o]}function PMe(t,e,n){const i=IMe(e);return fk.set(t,n),i.observe(t),()=>{fk.delete(t),i.unobserve(t)}}const RMe={some:0,all:1};class OMe extends sg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:o="some",once:l}=e,h={root:n?n.current:void 0,rootMargin:i,threshold:typeof o=="number"?o:RMe[o]},s=w=>{const{isIntersecting:x}=w;if(this.isInView===x||(this.isInView=x,l&&!x&&this.hasEnteredView))return;x&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",x);const{onViewportEnter:A,onViewportLeave:P}=this.node.getProps(),D=x?A:P;D&&D(w)};return PMe(this.node.current,h,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(kMe(e,n))&&this.startObserver()}unmount(){}}function kMe({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const DMe={inView:{Feature:OMe},tap:{Feature:TMe},focus:{Feature:CMe},hover:{Feature:EMe}},NMe={layout:{ProjectionNode:mJ,MeasureLayout:IJ}},MMe={...rMe,...DMe,...xMe,...NMe},vV=QNe(MMe,eMe),pk=qt.forwardRef(({className:t,orientation:e="horizontal",decorative:n=!0,...i},o)=>ot.jsx(RV,{ref:o,decorative:n,orientation:e,className:ES("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...i}));pk.displayName=RV.displayName;const LMe=({isOpen:t,onClose:e,selectedTiles:n,onRemoveTile:i,onConfirmPurchase:o})=>{const h=n.length*.02,s=.002;return ot.jsx(INe,{children:t&&ot.jsxs(ot.Fragment,{children:[ot.jsx(vV.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100]"}),ot.jsxs(vV.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed top-0 right-0 h-full w-full max-w-md bg-zinc-950 border-l border-white/5 z-[101] flex flex-col",children:[ot.jsxs("div",{className:"p-6 flex items-center justify-between border-b border-white/5 bg-primary/5",children:[ot.jsxs("div",{className:"flex items-center gap-3",children:[ot.jsx(Hne,{className:"w-5 h-5 text-primary"}),ot.jsx("h2",{className:"text-xl font-bold",children:"Purchase Land"})]}),ot.jsx(K1,{variant:"ghost",size:"icon",onClick:e,className:"rounded-full hover:bg-white/5",children:ot.jsx(sF,{className:"w-5 h-5"})})]}),ot.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[ot.jsxs("section",{className:"space-y-4",children:[ot.jsx("h3",{className:"text-sm font-semibold text-white/40 uppercase tracking-wider",children:"Selected Parcels"}),n.length===0?ot.jsx("div",{className:"text-center py-12 border-2 border-dashed border-white/5 rounded-2xl",children:ot.jsx("p",{className:"text-white/40",children:"No land selected on map"})}):ot.jsx("div",{className:"grid grid-cols-2 gap-3",children:n.map(w=>ot.jsxs("div",{className:"p-3 bg-white/5 rounded-xl border border-white/5 flex items-center justify-between group",children:[ot.jsxs("span",{className:"text-xs font-mono text-white/60",children:["ID: ",w]}),ot.jsx("button",{onClick:()=>i(w),className:"text-white/20 hover:text-destructive transition-colors",children:ot.jsx(sF,{className:"w-4 h-4"})})]},w))})]}),ot.jsx(pk,{className:"bg-white/5"}),ot.jsxs("section",{className:"space-y-4",children:[ot.jsx("h3",{className:"text-sm font-semibold text-white/40 uppercase tracking-wider",children:"Payment Method"}),ot.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[ot.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 bg-primary/10 border-2 border-primary rounded-2xl",children:[ot.jsx(Gne,{className:"w-6 h-6 text-primary"}),ot.jsx("span",{className:"text-xs font-bold",children:"ETH"})]}),ot.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 bg-white/5 border-2 border-transparent hover:border-white/10 rounded-2xl grayscale",children:[ot.jsx(qne,{className:"w-6 h-6 text-white/40"}),ot.jsx("span",{className:"text-xs font-bold text-white/40",children:"CARD"})]}),ot.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 bg-white/5 border-2 border-transparent hover:border-white/10 rounded-2xl grayscale",children:[ot.jsx(oF,{className:"w-6 h-6 text-white/40"}),ot.jsx("span",{className:"text-xs font-bold text-white/40",children:"USDT"})]})]})]}),ot.jsxs("section",{className:"p-6 bg-primary/5 rounded-2xl border border-primary/20 space-y-3",children:[ot.jsxs("div",{className:"flex justify-between text-sm",children:[ot.jsxs("span",{className:"text-white/60",children:["Selected Tiles (",n.length,")"]}),ot.jsxs("span",{className:"font-bold",children:[h.toFixed(3)," ETH"]})]}),ot.jsxs("div",{className:"flex justify-between text-sm",children:[ot.jsx("span",{className:"text-white/60",children:"Network Fee"}),ot.jsxs("span",{className:"font-bold",children:["~",s," ETH"]})]}),ot.jsx(pk,{className:"bg-white/10"}),ot.jsxs("div",{className:"flex justify-between items-center",children:[ot.jsx("span",{className:"text-base font-bold text-primary",children:"Total Price"}),ot.jsxs("span",{className:"text-2xl font-black text-primary",children:[(h+s).toFixed(3)," ETH"]})]})]}),ot.jsxs("div",{className:"flex items-start gap-3 p-4 bg-zinc-900 rounded-xl",children:[ot.jsx(Zne,{className:"w-5 h-5 text-emerald-500 mt-0.5"}),ot.jsxs("div",{className:"space-y-1",children:[ot.jsx("p",{className:"text-xs font-bold text-emerald-500",children:"Secure Transaction"}),ot.jsx("p",{className:"text-[10px] text-white/40",children:"Smart contract verified on mainnet. All purchases are final and minted as NFTs."})]})]})]}),ot.jsx("div",{className:"p-6 border-t border-white/5 bg-zinc-950",children:ot.jsxs(K1,{disabled:n.length===0,onClick:o,className:"relative overflow-hidden w-full h-16 bg-primary hover:bg-primary/90 text-black font-black text-lg rounded-2xl shadow-[0_0_30px_rgba(182,254,5,0.2)] hover:shadow-[0_0_50px_rgba(182,254,5,0.4)] transition-all duration-300 group",children:[ot.jsx("div",{className:"absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 skew-x-[-20deg]"}),ot.jsxs("span",{className:"relative z-10 flex items-center justify-center gap-2",children:[ot.jsx(oF,{className:"w-5 h-5 fill-current"}),"Confirm Land Purchase"]})]})})]})]})})};function BMe(){const[t,e]=qt.useState([]),[n,i]=qt.useState(!1),{isConnected:o}=qK(),l=qt.useCallback(w=>{e(w)},[]),h=w=>{e(x=>x.filter(A=>A!==w))},s=async()=>{if(!o){Ls.error("Connect your wallet to participate in the presale",{style:{background:"#09090b",color:"#fff",border:"1px solid rgba(182, 254, 5, 0.2)"}});return}const w=Ls.loading("Waiting for wallet confirmation...",{style:{background:"#09090b",color:"#fff",border:"1px solid rgba(182, 254, 5, 0.2)"}});try{await new Promise(x=>setTimeout(x,2e3)),Ls.loading("Minting your Land NFT...",{id:w}),await new Promise(x=>setTimeout(x,3e3)),Ls.success("Minting Successful! Welcome to Neoverse.",{id:w,duration:5e3,icon:""}),e([]),i(!1)}catch{Ls.error("Minting failed. Please check your balance and try again.",{id:w})}};return ot.jsxs("div",{className:"relative min-h-screen bg-background overflow-hidden selection:bg-primary selection:text-black",children:[ot.jsx(U8e,{cartCount:t.length,onCartClick:()=>i(!0)}),ot.jsxs("main",{className:"w-full h-screen relative",children:[ot.jsx(Ere,{onTileSelect:l,selectedTiles:t}),ot.jsx("div",{className:"absolute top-24 right-8 z-30 pointer-events-none",children:ot.jsxs("div",{className:"bg-black/40 backdrop-blur-xl border border-white/10 rounded-2xl p-4 space-y-4",children:[ot.jsxs("div",{className:"flex items-center justify-between gap-8",children:[ot.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-widest",children:"Map Mode"}),ot.jsx("span",{className:"text-[10px] font-bold text-primary uppercase",children:"Presale"})]}),ot.jsx("div",{className:"w-full h-px bg-white/5"}),ot.jsxs("div",{className:"space-y-1",children:[ot.jsxs("div",{className:"flex justify-between items-center text-xs",children:[ot.jsx("span",{className:"text-white/40",children:"Scale"}),ot.jsx("span",{className:"text-white/80",children:"1 : 500"})]}),ot.jsxs("div",{className:"flex justify-between items-center text-xs",children:[ot.jsx("span",{className:"text-white/40",children:"Grid"}),ot.jsx("span",{className:"text-white/80",children:"10m x 10m"})]})]})]})})]}),t.length>0&&!n&&ot.jsx("div",{className:"fixed bottom-24 right-8 p-6 bg-zinc-950/80 backdrop-blur-xl border border-primary/20 rounded-3xl shadow-2xl animate-slide-up z-40",children:ot.jsxs("div",{className:"flex items-center gap-6",children:[ot.jsxs("div",{children:[ot.jsx("p",{className:"text-[10px] text-white/40 uppercase font-bold tracking-widest",children:"Selected Land"}),ot.jsxs("p",{className:"text-xl font-black text-primary",children:[t.length," Tiles"]})]}),ot.jsx("div",{className:"w-px h-8 bg-white/10"}),ot.jsxs("div",{children:[ot.jsx("p",{className:"text-[10px] text-white/40 uppercase font-bold tracking-widest",children:"Subtotal"}),ot.jsxs("p",{className:"text-xl font-black text-white",children:[(t.length*.02).toFixed(2)," ETH"]})]}),ot.jsxs("button",{onClick:()=>i(!0),className:"relative overflow-hidden px-8 py-4 bg-primary text-black font-black rounded-2xl hover:scale-105 active:scale-95 transition-all duration-300 shadow-[0_0_40px_rgba(182,254,5,0.2)] hover:shadow-[0_0_60px_rgba(182,254,5,0.4)] group",children:[ot.jsx("div",{className:"absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 skew-x-[-20deg]"}),ot.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:["Review Selection",ot.jsx("div",{className:"w-6 h-6 bg-black/10 rounded-full flex items-center justify-center text-[10px]",children:t.length})]})]})]})}),ot.jsx(LMe,{isOpen:n,onClose:()=>i(!1),selectedTiles:t,onRemoveTile:h,onConfirmPurchase:s}),ot.jsx("div",{className:"fixed inset-0 pointer-events-none border-[12px] border-white/5 z-40"}),ot.jsxs("div",{className:"fixed top-20 left-8 z-40 space-y-2",children:[ot.jsx("div",{className:"px-3 py-1 bg-primary text-black text-[10px] font-black uppercase tracking-tighter rounded-sm animate-pulse",children:"Phase 1: Presale"}),ot.jsx("div",{className:"px-3 py-1 bg-white/5 backdrop-blur-md text-white/60 text-[10px] font-bold uppercase tracking-tighter rounded-sm border border-white/5",children:"Available: 8,421 / 10,000"}),o&&ot.jsxs("div",{className:"px-3 py-1 bg-emerald-500/10 backdrop-blur-md text-emerald-500 text-[10px] font-bold uppercase tracking-tighter rounded-sm border border-emerald-500/20 flex items-center gap-2",children:[ot.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),"Wallet Connected"]})]})]})}function FMe(){return ot.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center text-center px-6",children:[ot.jsx("h1",{className:"text-8xl font-black text-primary mb-4",children:"404"}),ot.jsx("p",{className:"text-xl text-white/60 mb-8",children:"This sector of the metaverse hasn't been discovered yet."}),ot.jsx(ym,{to:"/",className:"px-8 py-4 bg-primary text-black font-black rounded-2xl hover:scale-105 active:scale-95 transition-all duration-300 shadow-[0_0_30px_rgba(182,254,5,0.2)] hover:shadow-[0_0_50px_rgba(182,254,5,0.4)]",children:"Return Home"})]})}function xh(t,e,n){const i=t[e.name];if(typeof i=="function")return i;const o=t[n];return typeof o=="function"?o:l=>e(t,l)}const QT="3.4.0",$Me=()=>`@wagmi/core@${QT}`;var PJ=function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)},xS,RJ;class xd extends Error{get docsBaseUrl(){return"https://wagmi.sh/core"}get version(){return $Me()}constructor(e,n={}){var l;super(),xS.add(this),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WagmiCoreError"});const i=n.cause instanceof xd?n.cause.details:(l=n.cause)!=null&&l.message?n.cause.message:n.details,o=n.cause instanceof xd&&n.cause.docsPath||n.docsPath;this.message=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...o?[`Docs: ${this.docsBaseUrl}${o}.html${n.docsSlug?`#${n.docsSlug}`:""}`]:[],...i?[`Details: ${i}`]:[],`Version: ${this.version}`].join(`
`),n.cause&&(this.cause=n.cause),this.details=i,this.docsPath=o,this.metaMessages=n.metaMessages,this.shortMessage=e}walk(e){return PJ(this,xS,"m",RJ).call(this,this,e)}}xS=new WeakSet,RJ=function t(e,n){return n!=null&&n(e)?e:e.cause?PJ(this,xS,"m",t).call(this,e.cause,n):e};class hE extends xd{constructor(){super("Chain not configured."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ChainNotConfiguredError"})}}class zMe extends xd{constructor(){super("Connector already connected."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorAlreadyConnectedError"})}}class UMe extends xd{constructor(){super("Connector not connected."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorNotConnectedError"})}}class jMe extends xd{constructor({address:e,connector:n}){super(`Account "${e}" not found for connector "${n.name}".`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorAccountNotFoundError"})}}class VMe extends xd{constructor({connectionChainId:e,connectorChainId:n}){super(`The current chain of the connector (id: ${n}) does not match the connection's chain (id: ${e}).`,{metaMessages:[`Current Chain ID:  ${n}`,`Expected Chain ID: ${e}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorChainMismatchError"})}}class WMe extends xd{constructor({connector:e}){super(`Connector "${e.name}" unavailable while reconnecting.`,{details:["During the reconnection step, the only connector methods guaranteed to be available are: `id`, `name`, `type`, `uid`.","All other methods are not guaranteed to be available until reconnection completes and connectors are fully restored.","This error commonly occurs for connectors that asynchronously inject after reconnection has already started."].join(" ")}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ConnectorUnavailableReconnectingError"})}}async function BR(t,e){var i;let n;if(typeof e.connector=="function"?n=t._internal.connectors.setup(e.connector):n=e.connector,n.uid===t.state.current)throw new zMe;try{t.setState(s=>({...s,status:"connecting"})),n.emitter.emit("message",{type:"connecting"});const{connector:o,...l}=e,h=await n.connect(l);return n.emitter.off("connect",t._internal.events.connect),n.emitter.on("change",t._internal.events.change),n.emitter.on("disconnect",t._internal.events.disconnect),await((i=t.storage)==null?void 0:i.setItem("recentConnectorId",n.id)),t.setState(s=>({...s,connections:new Map(s.connections).set(n.uid,{accounts:l.withCapabilities?h.accounts.map(w=>typeof w=="object"?w.address:w):h.accounts,chainId:h.chainId,connector:n}),current:n.uid,status:"connected"})),{accounts:l.withCapabilities?h.accounts.map(s=>typeof s=="object"?s:{address:s,capabilities:{}}):h.accounts,chainId:h.chainId}}catch(o){throw t.setState(l=>({...l,status:l.current?"connected":"disconnected"})),o}}async function II(t,e={}){const{assertChainId:n=!0}=e;let i;if(e.connector){const{connector:A}=e;if(t.state.status==="reconnecting"&&!A.getAccounts&&!A.getChainId)throw new WMe({connector:A});const[P,D]=await Promise.all([A.getAccounts().catch(M=>{if(e.account===null)return[];throw M}),A.getChainId()]);i={accounts:P,chainId:D,connector:A}}else i=t.state.connections.get(t.state.current);if(!i)throw new UMe;const o=e.chainId??i.chainId,l=await i.connector.getChainId();if(n&&l!==o)throw new VMe({connectionChainId:o,connectorChainId:l});const h=i.connector;if(h.getClient)return h.getClient({chainId:o});const s=Tu(e.account??i.accounts[0]);if(s&&(s.address=E0(s.address)),e.account&&!i.accounts.some(A=>A.toLowerCase()===s.address.toLowerCase()))throw new jMe({address:s.address,connector:h});const w=t.chains.find(A=>A.id===o),x=await i.connector.getProvider({chainId:o});return tG({account:s,chain:w,name:"Connector Client",transport:A=>kfe(x)({...A,retryCount:0})})}async function xV(t,e={}){var o,l;let n;if(e.connector)n=e.connector;else{const{connections:h,current:s}=t.state,w=h.get(s);n=w==null?void 0:w.connector}const i=t.state.connections;n&&(await n.disconnect(),n.emitter.off("change",t._internal.events.change),n.emitter.off("disconnect",t._internal.events.disconnect),n.emitter.on("connect",t._internal.events.connect),i.delete(n.uid)),t.setState(h=>{if(i.size===0)return{...h,connections:new Map,current:null,status:"disconnected"};const s=i.values().next().value;return{...h,connections:new Map(i),current:s.connector.uid}});{const h=t.state.current;if(!h)return;const s=(o=t.state.connections.get(h))==null?void 0:o.connector;if(!s)return;await((l=t.storage)==null?void 0:l.setItem("recentConnectorId",s.id))}}async function HMe(t,e){const{chainId:n,connector:i,...o}=e;let l;e.account?l=e.account:l=(await II(t,{account:e.account,assertChainId:!1,chainId:n,connector:i})).account;const h=t.getClient({chainId:n});return xh(h,SH,"estimateGas")({...o,account:l})}async function GMe(t,e){const{address:n,blockNumber:i,blockTag:o,chainId:l}=e,h=t.getClient({chainId:l}),w=await xh(h,Khe,"getBalance")(i?{address:n,blockNumber:i}:{address:n,blockTag:o}),x=t.chains.find(A=>A.id===l)??h.chain;return{decimals:x.nativeCurrency.decimals,symbol:x.nativeCurrency.symbol,value:w}}function fE(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;let n,i;if(Array.isArray(t)&&Array.isArray(e)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!fE(t[i],e[i]))return!1;return!0}if(typeof t.valueOf=="function"&&t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(typeof t.toString=="function"&&t.toString!==Object.prototype.toString)return t.toString()===e.toString();const o=Object.keys(t);if(n=o.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!Object.hasOwn(e,o[i]))return!1;for(i=n;i--!==0;){const l=o[i];if(l&&!fE(t[l],e[l]))return!1}return!0}return t!==t&&e!==e}function t2(t){const e=t.state.current,n=t.state.connections.get(e),i=n==null?void 0:n.accounts,o=i==null?void 0:i[0],l=t.chains.find(s=>s.id===(n==null?void 0:n.chainId)),h=t.state.status;switch(h){case"connected":return{address:o,addresses:i,chain:l,chainId:n==null?void 0:n.chainId,connector:n==null?void 0:n.connector,isConnected:!0,isConnecting:!1,isDisconnected:!1,isReconnecting:!1,status:h};case"reconnecting":return{address:o,addresses:i,chain:l,chainId:n==null?void 0:n.chainId,connector:n==null?void 0:n.connector,isConnected:!!o,isConnecting:!1,isDisconnected:!1,isReconnecting:!0,status:h};case"connecting":return{address:o,addresses:i,chain:l,chainId:n==null?void 0:n.chainId,connector:n==null?void 0:n.connector,isConnected:!1,isConnecting:!0,isDisconnected:!1,isReconnecting:!1,status:h};case"disconnected":return{address:void 0,addresses:void 0,chain:void 0,chainId:void 0,connector:void 0,isConnected:!1,isConnecting:!1,isDisconnected:!0,isReconnecting:!1,status:h}}}let OT=[];function Sf(t){const e=[...t.state.connections.values()];return t.state.status==="reconnecting"||fE(OT,e)?OT:(OT=e,e)}async function qMe(t,e){const{account:n,chainId:i,...o}=e,l=n??t2(t).address,h=t.getClient({chainId:i});return xh(h,qk,"prepareTransactionRequest")({...o,...l?{account:l}:{}})}let FR=!1;async function eA(t,e={}){var x,A;if(FR)return[];FR=!0,t.setState(P=>({...P,status:P.current?"reconnecting":"connecting"}));const n=[];if((x=e.connectors)!=null&&x.length)for(const P of e.connectors){let D;typeof P=="function"?D=t._internal.connectors.setup(P):D=P,n.push(D)}else n.push(...t.connectors);let i;try{i=await((A=t.storage)==null?void 0:A.getItem("recentConnectorId"))}catch{}const o={};for(const[,P]of t.state.connections)o[P.connector.id]=1;i&&(o[i]=0);const l=Object.keys(o).length>0?[...n].sort((P,D)=>(o[P.id]??10)-(o[D.id]??10)):n;let h=!1;const s=[],w=[];for(const P of l){const D=await P.getProvider().catch(()=>{});if(!D||w.some(U=>U===D)||!await P.isAuthorized())continue;const z=await P.connect({isReconnecting:!0}).catch(()=>null);z&&(P.emitter.off("connect",t._internal.events.connect),P.emitter.on("change",t._internal.events.change),P.emitter.on("disconnect",t._internal.events.disconnect),t.setState(U=>{const G=new Map(h?U.connections:new Map).set(P.uid,{accounts:z.accounts,chainId:z.chainId,connector:P});return{...U,current:h?U.current:P.uid,connections:G}}),s.push({accounts:z.accounts,chainId:z.chainId,connector:P}),w.push(D),h=!0)}return(t.state.status==="reconnecting"||t.state.status==="connecting")&&(h?t.setState(P=>({...P,status:"connected"})):t.setState(P=>({...P,connections:new Map,current:null,status:"disconnected"}))),FR=!1,s}async function ZMe(t,e){const{account:n,chainId:i,connector:o,...l}=e;let h;typeof n=="object"&&(n==null?void 0:n.type)==="local"?h=t.getClient({chainId:i}):h=await II(t,{account:n??void 0,assertChainId:!1,chainId:i,connector:o});const s=(()=>{var A;return!i||((A=h.chain)==null?void 0:A.id)===i?h.chain:{id:i}})();return await xh(h,JH,"sendTransaction")({...l,...n?{account:n}:{},assertChainId:!!i,chain:s,gas:l.gas??void 0})}async function KMe(t,e){const{account:n,connector:i,...o}=e;let l;return typeof n=="object"&&n.type==="local"?l=t.getClient():l=await II(t,{account:n,connector:i}),xh(l,Ofe,"signMessage")({...o,...n?{account:n}:{}})}class um extends xd{constructor(){super("Provider not found."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderNotFoundError"})}}class YMe extends xd{constructor({connector:e}){super(`"${e.name}" does not support programmatic chain switching.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SwitchChainNotSupportedError"})}}async function EV(t,e){var h;const{addEthereumChainParameter:n,chainId:i}=e,o=t.state.connections.get(((h=e.connector)==null?void 0:h.uid)??t.state.current);if(o){const s=o.connector;if(!s.switchChain)throw new YMe({connector:s});return await s.switchChain({addEthereumChainParameter:n,chainId:i})}const l=t.chains.find(s=>s.id===i);if(!l)throw new hE;return t.setState(s=>({...s,chainId:i})),l}async function XMe(t,e){const{chainId:n,timeout:i=0,...o}=e,l=t.getClient({chainId:n}),s=await xh(l,Pfe,"waitForTransactionReceipt")({...o,timeout:i});if(s.status==="reverted"){const w=xh(l,_G,"getTransaction"),{from:x,...A}=await w({hash:s.transactionHash}),D=await xh(l,KH,"call")({...A,account:x,data:A.input,gasPrice:A.type!=="eip1559"?A.gasPrice:void 0,maxFeePerGas:A.type==="eip1559"?A.maxFeePerGas:void 0,maxPriorityFeePerGas:A.type==="eip1559"?A.maxPriorityFeePerGas:void 0}),M=D!=null&&D.data?LW(`0x${D.data.substring(138)}`):"unknown reason";throw new Error(M)}return{...s,chainId:l.chain.id}}function JMe(t,e){const{onChange:n}=e;return t.subscribe(()=>t2(t),n,{equalityFn(i,o){const{connector:l,...h}=i,{connector:s,...w}=o;return fE(h,w)&&(l==null?void 0:l.id)===(s==null?void 0:s.id)&&(l==null?void 0:l.uid)===(s==null?void 0:s.uid)}})}function QMe(t,e){const{onChange:n}=e;return t.subscribe(()=>Sf(t),n,{equalityFn:fE})}function e9e(t,e){const{onChange:n}=e;return t._internal.connectors.subscribe((i,o)=>{n(Object.values(i),o)})}function t9e(t,e){const{syncConnectedChain:n=t._internal.syncConnectedChain,...i}=e;let o;const l=w=>{o&&o();const x=t.getClient({chainId:w});return o=xh(x,Rfe,"watchPendingTransactions")(i),o},h=l(e.chainId);let s;return n&&!e.chainId&&(s=t.subscribe(({chainId:w})=>w,async w=>l(w))),()=>{h==null||h(),s==null||s()}}async function n9e(t,e){const{account:n,chainId:i,connector:o,...l}=e;let h;typeof n=="object"&&(n==null?void 0:n.type)==="local"?h=t.getClient({chainId:i}):h=await II(t,{account:n??void 0,assertChainId:!1,chainId:i,connector:o});const s=(()=>{var A;return!i||((A=h.chain)==null?void 0:A.id)===i?h.chain:{id:i}})();return await xh(h,EA,"writeContract")({...l,...n?{account:n}:{},assertChainId:!!i,chain:s})}function TUe(t){return t}PI.type="injected";function PI(t={}){const{shimDisconnect:e=!0,unstable_shimAsyncInject:n}=t;function i(){const w=t.target;if(typeof w=="function"){const x=w();if(x)return x}return typeof w=="object"?w:typeof w=="string"?{...i9e[w]??{id:w,name:`${w[0].toUpperCase()}${w.slice(1)}`,provider:`is${w[0].toUpperCase()}${w.slice(1)}`}}:{id:"injected",name:"Injected",provider(x){return x==null?void 0:x.ethereum}}}let o,l,h,s;return w=>({get icon(){return i().icon},get id(){return i().id},get name(){return i().name},type:PI.type,async setup(){const x=await this.getProvider();x!=null&&x.on&&t.target&&(h||(h=this.onConnect.bind(this),x.on("connect",h)),o||(o=this.onAccountsChanged.bind(this),x.on("accountsChanged",o)))},async connect({chainId:x,isReconnecting:A,withCapabilities:P}={}){var z,U,G,ne,oe,Q;const D=await this.getProvider();if(!D)throw new um;let M=[];if(A)M=await this.getAccounts().catch(()=>[]);else if(e)try{M=(ne=(G=(U=(z=(await D.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}))[0])==null?void 0:z.caveats)==null?void 0:U[0])==null?void 0:G.value)==null?void 0:ne.map(he=>E0(he)),M.length>0&&(M=await this.getAccounts())}catch(de){const he=de;if(he.code===to.code)throw new to(he);if(he.code===Tm.code)throw he}try{!(M!=null&&M.length)&&!A&&(M=(await D.request({method:"eth_requestAccounts"})).map(Ie=>E0(Ie))),h&&(D.removeListener("connect",h),h=void 0),o||(o=this.onAccountsChanged.bind(this),D.on("accountsChanged",o)),l||(l=this.onChainChanged.bind(this),D.on("chainChanged",l)),s||(s=this.onDisconnect.bind(this),D.on("disconnect",s));let de=await this.getChainId();if(x&&de!==x){const he=await this.switchChain({chainId:x}).catch(Ie=>{if(Ie.code===to.code)throw Ie;return{id:de}});de=(he==null?void 0:he.id)??de}return e&&await((oe=w.storage)==null?void 0:oe.removeItem(`${this.id}.disconnected`)),t.target||await((Q=w.storage)==null?void 0:Q.setItem("injected.connected",!0)),{accounts:P?M.map(he=>({address:he,capabilities:{}})):M,chainId:de}}catch(de){const he=de;throw he.code===to.code?new to(he):he.code===Tm.code?new Tm(he):he}},async disconnect(){var A,P;const x=await this.getProvider();if(!x)throw new um;l&&(x.removeListener("chainChanged",l),l=void 0),s&&(x.removeListener("disconnect",s),s=void 0),h||(h=this.onConnect.bind(this),x.on("connect",h));try{await nG(()=>x.request({method:"wallet_revokePermissions",params:[{eth_accounts:{}}]}),{timeout:100})}catch{}e&&await((A=w.storage)==null?void 0:A.setItem(`${this.id}.disconnected`,!0)),t.target||await((P=w.storage)==null?void 0:P.removeItem("injected.connected"))},async getAccounts(){const x=await this.getProvider();if(!x)throw new um;return(await x.request({method:"eth_accounts"})).map(P=>E0(P))},async getChainId(){const x=await this.getProvider();if(!x)throw new um;const A=await x.request({method:"eth_chainId"});return Number(A)},async getProvider(){if(typeof window>"u")return;let x;const A=i();return typeof A.provider=="function"?x=A.provider(window):typeof A.provider=="string"?x=tA(window,A.provider):x=A.provider,x&&!x.removeListener&&("off"in x&&typeof x.off=="function"?x.removeListener=x.off:x.removeListener=()=>{}),x},async isAuthorized(){var x,A;try{if(e&&await((x=w.storage)==null?void 0:x.getItem(`${this.id}.disconnected`))||!t.target&&!await((A=w.storage)==null?void 0:A.getItem("injected.connected")))return!1;if(!await this.getProvider()){if(n!==void 0&&n!==!1){const z=async()=>(typeof window<"u"&&window.removeEventListener("ethereum#initialized",z),!!await this.getProvider()),U=typeof n=="number"?n:1e3;if(await Promise.race([...typeof window<"u"?[new Promise(ne=>window.addEventListener("ethereum#initialized",()=>ne(z()),{once:!0}))]:[],new Promise(ne=>setTimeout(()=>ne(z()),U))]))return!0}throw new um}return!!(await CA(()=>this.getAccounts())).length}catch{return!1}},async switchChain({addEthereumChainParameter:x,chainId:A}){var z,U,G,ne;const P=await this.getProvider();if(!P)throw new um;const D=w.chains.find(oe=>oe.id===A);if(!D)throw new Ah(new hE);const M=new Promise(oe=>{const Q=de=>{"chainId"in de&&de.chainId===A&&(w.emitter.off("change",Q),oe())};w.emitter.on("change",Q)});try{return await Promise.all([P.request({method:"wallet_switchEthereumChain",params:[{chainId:ar(A)}]}).then(async()=>{await this.getChainId()===A&&w.emitter.emit("change",{chainId:A})}),M]),D}catch(oe){const Q=oe;if(Q.code===4902||((U=(z=Q==null?void 0:Q.data)==null?void 0:z.originalError)==null?void 0:U.code)===4902)try{const{default:de,...he}=D.blockExplorers??{};let Ie;x!=null&&x.blockExplorerUrls?Ie=x.blockExplorerUrls:de&&(Ie=[de.url,...Object.values(he).map(ze=>ze.url)]);let ke;(G=x==null?void 0:x.rpcUrls)!=null&&G.length?ke=x.rpcUrls:ke=[((ne=D.rpcUrls.default)==null?void 0:ne.http[0])??""];const Ue={blockExplorerUrls:Ie,chainId:ar(A),chainName:(x==null?void 0:x.chainName)??D.name,iconUrls:x==null?void 0:x.iconUrls,nativeCurrency:(x==null?void 0:x.nativeCurrency)??D.nativeCurrency,rpcUrls:ke};return await Promise.all([P.request({method:"wallet_addEthereumChain",params:[Ue]}).then(async()=>{if(await this.getChainId()===A)w.emitter.emit("change",{chainId:A});else throw new to(new Error("User rejected switch after adding network."))}),M]),D}catch(de){throw new to(de)}throw Q.code===to.code?new to(Q):new Ah(Q)}},async onAccountsChanged(x){var A;if(x.length===0)this.onDisconnect();else if(w.emitter.listenerCount("connect")){const P=(await this.getChainId()).toString();this.onConnect({chainId:P}),e&&await((A=w.storage)==null?void 0:A.removeItem(`${this.id}.disconnected`))}else w.emitter.emit("change",{accounts:x.map(P=>E0(P))})},onChainChanged(x){const A=Number(x);w.emitter.emit("change",{chainId:A})},async onConnect(x){const A=await this.getAccounts();if(A.length===0)return;const P=Number(x.chainId);w.emitter.emit("connect",{accounts:A,chainId:P});const D=await this.getProvider();D&&(h&&(D.removeListener("connect",h),h=void 0),o||(o=this.onAccountsChanged.bind(this),D.on("accountsChanged",o)),l||(l=this.onChainChanged.bind(this),D.on("chainChanged",l)),s||(s=this.onDisconnect.bind(this),D.on("disconnect",s)))},async onDisconnect(x){const A=await this.getProvider();x&&x.code===1013&&A&&(await this.getAccounts()).length||(w.emitter.emit("disconnect"),A&&(l&&(A.removeListener("chainChanged",l),l=void 0),s&&(A.removeListener("disconnect",s),s=void 0),h||(h=this.onConnect.bind(this),A.on("connect",h))))}})}const i9e={coinbaseWallet:{id:"coinbaseWallet",name:"Coinbase Wallet",provider(t){return t!=null&&t.coinbaseWalletExtension?t.coinbaseWalletExtension:tA(t,"isCoinbaseWallet")}},metaMask:{id:"metaMask",name:"MetaMask",provider(t){return tA(t,e=>{if(!e.isMetaMask||e.isBraveWallet&&!e._events&&!e._state)return!1;const n=["isApexWallet","isAvalanche","isBitKeep","isBlockWallet","isKuCoinWallet","isMathWallet","isOkxWallet","isOKExWallet","isOneInchIOSWallet","isOneInchAndroidWallet","isOpera","isPhantom","isPortal","isRabby","isTokenPocket","isTokenary","isUniswapWallet","isZerion"];for(const i of n)if(e[i])return!1;return!0})}},phantom:{id:"phantom",name:"Phantom",provider(t){var e,n;return(e=t==null?void 0:t.phantom)!=null&&e.ethereum?(n=t.phantom)==null?void 0:n.ethereum:tA(t,"isPhantom")}}};function tA(t,e){function n(o){return typeof e=="function"?e(o):typeof e=="string"?o[e]:!0}const i=t.ethereum;if(i!=null&&i.providers)return i.providers.find(o=>n(o));if(i&&n(i))return i}function r9e(t){if(typeof window>"u")return;const e=n=>t(n.detail);return window.addEventListener("eip6963:announceProvider",e),window.dispatchEvent(new CustomEvent("eip6963:requestProvider")),()=>window.removeEventListener("eip6963:announceProvider",e)}function s9e(){const t=new Set;let e=[];const n=()=>r9e(o=>{e.some(({info:l})=>l.uuid===o.info.uuid)||(e=[...e,o],t.forEach(l=>l(e,{added:[o]})))});let i=n();return{_listeners(){return t},clear(){t.forEach(o=>o([],{removed:[...e]})),e=[]},destroy(){this.clear(),t.clear(),i==null||i()},findProvider({rdns:o}){return e.find(l=>l.info.rdns===o)},getProviders(){return e},reset(){this.clear(),i==null||i(),i=n()},subscribe(o,{emitImmediately:l}={}){return t.add(o),l&&o(e,{added:e}),()=>t.delete(o)}}}const o9e=t=>(e,n,i)=>{const o=i.subscribe;return i.subscribe=(h,s,w)=>{let x=h;if(s){const A=(w==null?void 0:w.equalityFn)||Object.is;let P=h(i.getState());x=D=>{const M=h(D);if(!A(P,M)){const z=P;s(P=M,z)}},w!=null&&w.fireImmediately&&s(P,P)}return o(x)},t(e,n,i)},a9e=o9e;function c9e(t,e){let n;try{n=t()}catch{return}return{getItem:o=>{var l;const h=w=>w===null?null:JSON.parse(w,void 0),s=(l=n.getItem(o))!=null?l:null;return s instanceof Promise?s.then(h):h(s)},setItem:(o,l)=>n.setItem(o,JSON.stringify(l,void 0)),removeItem:o=>n.removeItem(o)}}const mk=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(i){return mk(i)(n)},catch(i){return this}}}catch(n){return{then(i){return this},catch(i){return mk(i)(n)}}}},l9e=(t,e)=>(n,i,o)=>{let l={storage:c9e(()=>localStorage),partialize:U=>U,version:0,merge:(U,G)=>({...G,...U}),...e},h=!1;const s=new Set,w=new Set;let x=l.storage;if(!x)return t((...U)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),n(...U)},i,o);const A=()=>{const U=l.partialize({...i()});return x.setItem(l.name,{state:U,version:l.version})},P=o.setState;o.setState=(U,G)=>{P(U,G),A()};const D=t((...U)=>{n(...U),A()},i,o);o.getInitialState=()=>D;let M;const z=()=>{var U,G;if(!x)return;h=!1,s.forEach(oe=>{var Q;return oe((Q=i())!=null?Q:D)});const ne=((G=l.onRehydrateStorage)==null?void 0:G.call(l,(U=i())!=null?U:D))||void 0;return mk(x.getItem.bind(x))(l.name).then(oe=>{if(oe)if(typeof oe.version=="number"&&oe.version!==l.version){if(l.migrate)return[!0,l.migrate(oe.state,oe.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,oe.state];return[!1,void 0]}).then(oe=>{var Q;const[de,he]=oe;if(M=l.merge(he,(Q=i())!=null?Q:D),n(M,!0),de)return A()}).then(()=>{ne==null||ne(M,void 0),M=i(),h=!0,w.forEach(oe=>oe(M))}).catch(oe=>{ne==null||ne(void 0,oe)})};return o.persist={setOptions:U=>{l={...l,...U},U.storage&&(x=U.storage)},clearStorage:()=>{x==null||x.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>z(),hasHydrated:()=>h,onHydrate:U=>(s.add(U),()=>{s.delete(U)}),onFinishHydration:U=>(w.add(U),()=>{w.delete(U)})},l.skipHydration||z(),M||D},u9e=l9e,CV=t=>{let e;const n=new Set,i=(x,A)=>{const P=typeof x=="function"?x(e):x;if(!Object.is(P,e)){const D=e;e=A??(typeof P!="object"||P===null)?P:Object.assign({},e,P),n.forEach(M=>M(e,D))}},o=()=>e,s={setState:i,getState:o,getInitialState:()=>w,subscribe:x=>(n.add(x),()=>n.delete(x))},w=e=t(i,o,s);return s},$R=t=>t?CV(t):CV;class d9e{constructor(e){Object.defineProperty(this,"uid",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"_emitter",{enumerable:!0,configurable:!0,writable:!0,value:new l1e})}on(e,n){this._emitter.on(e,n)}once(e,n){this._emitter.once(e,n)}off(e,n){this._emitter.off(e,n)}emit(e,...n){const i=n[0];this._emitter.emit(e,{uid:this.uid,...i})}listenerCount(e){return this._emitter.listenerCount(e)}}function h9e(t){return new d9e(t)}function f9e(t,e){return JSON.parse(t,(n,i)=>{let o=i;return(o==null?void 0:o.__type)==="bigint"&&(o=BigInt(o.value)),(o==null?void 0:o.__type)==="Map"&&(o=new Map(o.value)),(e==null?void 0:e(n,o))??o})}function TV(t,e){return t.slice(0,e).join(".")||"."}function AV(t,e){const{length:n}=t;for(let i=0;i<n;++i)if(t[i]===e)return i+1;return 0}function p9e(t,e){const n=typeof t=="function",i=typeof e=="function",o=[],l=[];return function(s,w){if(typeof w=="object")if(o.length){const x=AV(o,this);x===0?o[o.length]=this:(o.splice(x),l.splice(x)),l[l.length]=s;const A=AV(o,w);if(A!==0)return i?e.call(this,s,w,TV(l,A)):`[ref=${TV(l,A)}]`}else o[0]=w,l[0]=s;return n?t.call(this,s,w):w}}function m9e(t,e,n,i){return JSON.stringify(t,p9e((o,l)=>{let h=l;return typeof h=="bigint"&&(h={__type:"bigint",value:l.toString()}),h instanceof Map&&(h={__type:"Map",value:Array.from(l.entries())}),(e==null?void 0:e(o,h))??h},i),n??void 0)}function g9e(t){const{deserialize:e=f9e,key:n="wagmi",serialize:i=m9e,storage:o=OJ}=t;function l(h){return h instanceof Promise?h.then(s=>s).catch(()=>null):h}return{...o,key:n,async getItem(h,s){const w=o.getItem(`${n}.${h}`),x=await l(w);return x?e(x)??null:s??null},async setItem(h,s){const w=`${n}.${h}`;s===null?await l(o.removeItem(w)):await l(o.setItem(w,i(s)))},async removeItem(h){await l(o.removeItem(`${n}.${h}`))}}}const OJ={getItem:()=>null,setItem:()=>{},removeItem:()=>{}};function y9e(){const t=typeof window<"u"&&window.localStorage?window.localStorage:OJ;return{getItem(e){return t.getItem(e)},removeItem(e){t.removeItem(e)},setItem(e,n){try{t.setItem(e,n)}catch{}}}}const gk=256;let kT=gk,DT;function _9e(t=11){if(!DT||kT+t>gk*2){DT="",kT=0;for(let e=0;e<gk;e++)DT+=(256+Math.random()*256|0).toString(16).substring(1)}return DT.substring(kT,kT+++t)}function w9e(t){const{multiInjectedProviderDiscovery:e=!0,storage:n=g9e({storage:y9e()}),syncConnectedChain:i=!0,ssr:o=!1,...l}=t,h=typeof window<"u"&&e?s9e():void 0,s=$R(()=>l.chains),w=$R(()=>{const he=[],Ie=new Set;for(const ke of l.connectors??[]){const Ue=x(ke);if(he.push(Ue),!o&&Ue.rdns){const ze=typeof Ue.rdns=="string"?[Ue.rdns]:Ue.rdns;for(const ht of ze)Ie.add(ht)}}if(!o&&h){const ke=h.getProviders();for(const Ue of ke)Ie.has(Ue.info.rdns)||he.push(x(A(Ue)))}return he});function x(he){var Ue;const Ie=h9e(_9e()),ke={...he({emitter:Ie,chains:s.getState(),storage:n,transports:l.transports}),emitter:Ie,uid:Ie.uid};return Ie.on("connect",Q),(Ue=ke.setup)==null||Ue.call(ke),ke}function A(he){const{info:Ie}=he,ke=he.provider;return PI({target:{...Ie,id:Ie.rdns,provider:ke}})}const P=new Map;function D(he={}){const Ie=he.chainId??G.getState().chainId,ke=s.getState().find(ze=>ze.id===Ie);if(he.chainId&&!ke)throw new hE;{const ze=P.get(G.getState().chainId);if(ze&&!ke)return ze;if(!ke)throw new hE}{const ze=P.get(Ie);if(ze)return ze}let Ue;if(l.client)Ue=l.client({chain:ke});else{const ze=ke.id,ht=s.getState().map(je=>je.id),ft={},ct=Object.entries(l);for(const[je,Ye]of ct)if(!(je==="chains"||je==="client"||je==="connectors"||je==="transports"))if(typeof Ye=="object")if(ze in Ye)ft[je]=Ye[ze];else{if(ht.some(le=>le in Ye))continue;ft[je]=Ye}else ft[je]=Ye;Ue=tG({...ft,chain:ke,batch:ft.batch??{multicall:!0},transport:je=>l.transports[ze]({...je,connectors:w})})}return P.set(Ie,Ue),Ue}function M(){return{chainId:s.getState()[0].id,connections:new Map,current:null,status:"disconnected"}}let z;const U="0.0.0-canary-";QT.startsWith(U)?z=Number.parseInt(QT.replace(U,""),10):z=Number.parseInt(QT.split(".")[0]??"0",10);const G=$R(a9e(n?u9e(M,{migrate(he,Ie){if(Ie===z)return he;const ke=M(),Ue=ne(he,ke.chainId);return{...ke,chainId:Ue}},name:"store",partialize(he){return{connections:{__type:"Map",value:Array.from(he.connections.entries()).map(([Ie,ke])=>{const{id:Ue,name:ze,type:ht,uid:ft}=ke.connector;return[Ie,{...ke,connector:{id:Ue,name:ze,type:ht,uid:ft}}]})},chainId:he.chainId,current:he.current}},merge(he,Ie){typeof he=="object"&&he&&"status"in he&&delete he.status;const ke=ne(he,Ie.chainId);return{...Ie,...he,chainId:ke}},skipHydration:o,storage:n,version:z}):M));G.setState(M());function ne(he,Ie){return he&&typeof he=="object"&&"chainId"in he&&typeof he.chainId=="number"&&s.getState().some(ke=>ke.id===he.chainId)?he.chainId:Ie}i&&G.subscribe(({connections:he,current:Ie})=>{var ke;return Ie?(ke=he.get(Ie))==null?void 0:ke.chainId:void 0},he=>{if(s.getState().some(ke=>ke.id===he))return G.setState(ke=>({...ke,chainId:he??ke.chainId}))}),h==null||h.subscribe(he=>{const Ie=new Set,ke=new Set;for(const ze of w.getState())if(Ie.add(ze.id),ze.rdns){const ht=typeof ze.rdns=="string"?[ze.rdns]:ze.rdns;for(const ft of ht)ke.add(ft)}const Ue=[];for(const ze of he){if(ke.has(ze.info.rdns))continue;const ht=x(A(ze));Ie.has(ht.id)||Ue.push(ht)}n&&!G.persist.hasHydrated()||w.setState(ze=>[...ze,...Ue],!0)});function oe(he){G.setState(Ie=>{const ke=Ie.connections.get(he.uid);return ke?{...Ie,connections:new Map(Ie.connections).set(he.uid,{accounts:he.accounts??ke.accounts,chainId:he.chainId??ke.chainId,connector:ke.connector})}:Ie})}function Q(he){G.getState().status==="connecting"||G.getState().status==="reconnecting"||G.setState(Ie=>{const ke=w.getState().find(Ue=>Ue.uid===he.uid);return ke?(ke.emitter.listenerCount("connect")&&ke.emitter.off("connect",oe),ke.emitter.listenerCount("change")||ke.emitter.on("change",oe),ke.emitter.listenerCount("disconnect")||ke.emitter.on("disconnect",de),{...Ie,connections:new Map(Ie.connections).set(he.uid,{accounts:he.accounts,chainId:he.chainId,connector:ke}),current:he.uid,status:"connected"}):Ie})}function de(he){G.setState(Ie=>{const ke=Ie.connections.get(he.uid);if(ke){const ze=ke.connector;ze.emitter.listenerCount("change")&&ke.connector.emitter.off("change",oe),ze.emitter.listenerCount("disconnect")&&ke.connector.emitter.off("disconnect",de),ze.emitter.listenerCount("connect")||ke.connector.emitter.on("connect",Q)}if(Ie.connections.delete(he.uid),Ie.connections.size===0)return{...Ie,connections:new Map,current:null,status:"disconnected"};const Ue=Ie.connections.values().next().value;return{...Ie,connections:new Map(Ie.connections),current:Ue.connector.uid}})}return{get chains(){return s.getState()},get connectors(){return w.getState()},storage:n,getClient:D,get state(){return G.getState()},setState(he){let Ie;typeof he=="function"?Ie=he(G.getState()):Ie=he;const ke=M();typeof Ie!="object"&&(Ie=ke),Object.keys(ke).some(ze=>!(ze in Ie))&&(Ie=ke),G.setState(Ie,!0)},subscribe(he,Ie,ke){return G.subscribe(he,Ie,ke?{...ke,fireImmediately:ke.emitImmediately}:void 0)},_internal:{mipd:h,async revalidate(){const he=G.getState(),Ie=he.connections;let ke=he.current;for(const[,Ue]of Ie){const ze=Ue.connector;ze.isAuthorized&&await ze.isAuthorized()||(Ie.delete(ze.uid),ke===ze.uid&&(ke=null))}G.setState(Ue=>({...Ue,connections:Ie,current:ke}))},store:G,ssr:!!o,syncConnectedChain:i,transports:l.transports,chains:{setState(he){const Ie=typeof he=="function"?he(s.getState()):he;if(Ie.length!==0)return s.setState(Ie,!0)},subscribe(he){return s.subscribe(he)}},connectors:{providerDetailToConnector:A,setup:x,setState(he){return w.setState(typeof he=="function"?he(w.getState()):he,!0)},subscribe(he){return w.subscribe(he)}},events:{change:oe,connect:Q,disconnect:de}}}}function b9e(t,e){const{initialState:n,reconnectOnMount:i}=e;return n&&!t._internal.store.persist.hasHydrated()&&t.setState({...n,chainId:t.chains.some(o=>o.id===n.chainId)?n.chainId:t.chains[0].id,connections:i?n.connections:new Map,status:i?"reconnecting":"disconnected"}),{async onMount(){t._internal.ssr&&(await t._internal.store.persist.rehydrate(),t._internal.mipd&&t._internal.connectors.setState(o=>{var w;const l=new Set;for(const x of o??[])if(x.rdns){const A=Array.isArray(x.rdns)?x.rdns:[x.rdns];for(const P of A)l.add(P)}const h=[],s=((w=t._internal.mipd)==null?void 0:w.getProviders())??[];for(const x of s){if(l.has(x.info.rdns))continue;const A=t._internal.connectors.providerDetailToConnector(x),P=t._internal.connectors.setup(A);h.push(P)}return[...o,...h]})),i?eA(t):t.storage&&t.setState(o=>({...o,connections:new Map}))}}}const v9e=Jk({id:42161,name:"Arbitrum One",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockTime:250,rpcUrls:{default:{http:["https://arb1.arbitrum.io/rpc"]}},blockExplorers:{default:{name:"Arbiscan",url:"https://arbiscan.io",apiUrl:"https://api.arbiscan.io/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:7654707}}}),x9e=Jk({id:1,name:"Ethereum",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockTime:12e3,rpcUrls:{default:{http:["https://eth.merkle.io"]}},blockExplorers:{default:{name:"Etherscan",url:"https://etherscan.io",apiUrl:"https://api.etherscan.io/api"}},contracts:{ensUniversalResolver:{address:"0xeeeeeeee14d718c2b47d9923deab1335e144eeee",blockCreated:23085558},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:14353601}}}),E9e=Jk({id:137,name:"Polygon",blockTime:2e3,nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:25770160}}});function C9e(t){let e=[],n,i;function o(s){var A,P;const w=ue.getCaipNetworks(at.CHAIN.EVM);let x=Number(i2.parseEvmChainId(s));if(!w.some(D=>String(D.id)===String(s))){const D=((A=ue.getActiveCaipNetwork(at.CHAIN.EVM))==null?void 0:A.id)||((P=w[0])==null?void 0:P.id);D&&Number.isInteger(Number(D))&&(x=Number(D))}if(!x)throw new Error("ChainId not found in networks");return x}function l(){var s;return n||(n=$0.getInstance({projectId:t.options.projectId,chainId:(s=Nf())==null?void 0:s.caipNetworkId,enableLogger:t.options.enableAuthLogger,onTimeout:w=>{w==="iframe_load_failed"?Ts.open(vs.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):w==="iframe_request_timeout"?Ts.open(vs.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):w==="unverified_domain"&&Ts.open(vs.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},abortController:vs.EmbeddedWalletAbortController,getActiveCaipNetwork:w=>Nf(w),getCaipNetworks:w=>ue.getCaipNetworks(w)})),n}async function h(s={}){var U;const w=l();let x=s.chainId;if(s.isReconnecting){const G=i2.parseEvmChainId(w.getLastUsedChainId()||""),ne=(U=t.chains)==null?void 0:U[0].id;if(x=G||ne,!x)throw new Error("ChainId not found in provider")}const A=Fs("eip155"),{address:P,chainId:D,accounts:M}=await Xa.authConnectorAuthenticate({authConnector:w,chainId:x,preferredAccountType:A,socialUri:s.socialUri,chainNamespace:at.CHAIN.EVM});e=(M==null?void 0:M.map(G=>G.address))||[P];const z=o(D);return{accounts:e,account:P,chainId:z,chain:{id:z,unsupported:!1}}}return s=>({id:at.CONNECTOR_ID.AUTH,name:at.CONNECTOR_NAMES.AUTH,type:"AUTH",chain:at.CHAIN.EVM,async connect(w={}){if(i){const A=await i;return{accounts:w.withCapabilities?A.accounts.map(P=>({address:P,capabilities:{}})):A.accounts,chainId:A.chainId}}i||(i=new Promise(A=>{A(h(w))}));const x=await i;return i=void 0,{accounts:w.withCapabilities?x.accounts.map(A=>({address:A,capabilities:{}})):x.accounts,chainId:x.chainId}},async disconnect(){await(await this.getProvider()).disconnect()},getAccounts(){return e!=null&&e.length?(s.emitter.emit("change",{accounts:e}),Promise.resolve(e)):Promise.resolve([])},async getProvider(){var w;return this.provider||(this.provider=$0.getInstance({projectId:t.options.projectId,chainId:(w=Nf())==null?void 0:w.caipNetworkId,enableLogger:t.options.enableAuthLogger,abortController:vs.EmbeddedWalletAbortController,onTimeout:x=>{x==="iframe_load_failed"?Ts.open(vs.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):x==="iframe_request_timeout"?Ts.open(vs.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):x==="unverified_domain"&&Ts.open(vs.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},getActiveCaipNetwork:x=>Nf(x),getCaipNetworks:x=>ue.getCaipNetworks(x)})),Promise.resolve(this.provider)},async getChainId(){const w=await this.getProvider(),{chainId:x}=await w.getChainId();return o(x)},async isAuthorized(){const x=ue.state.activeChain===at.CHAIN.EVM;if(at.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(D=>Nt.getConnectorId(D)===at.CONNECTOR_ID.AUTH)&&!x)return!1;const P=await this.getProvider();return Promise.resolve(P.getLoginEmailUsed())},async switchChain({chainId:w}){var x;try{const A=s.chains.find(z=>z.id===w);if(!A)throw new Ah(new Error("chain not found on connector."));const P=await this.getProvider(),D=Fs("eip155"),M=await P.connect({chainId:w,preferredAccountType:D});return e=((x=M==null?void 0:M.accounts)==null?void 0:x.map(z=>z.address))||[M.address],s.emitter.emit("change",{chainId:Number(w),accounts:e}),A}catch(A){throw A instanceof Error?new Ah(A):A}},onAccountsChanged(w){w.length===0?this.onDisconnect():s.emitter.emit("change",{accounts:w.map(E0)})},onChainChanged(w){const x=Number(w);s.emitter.emit("change",{chainId:x})},async onDisconnect(w){await(await this.getProvider()).disconnect()}})}VN.type="walletConnect";function VN(t){const e=t.isNewChainsStale??!0;let n,i,o,l,h,s,w;return x=>({id:"walletConnect",name:"WalletConnect",type:VN.type,provider:t.universalProvider,async setup(){const A=await this.getProvider().catch(()=>null);A&&(l||(l=this.onConnect.bind(this),A.on("connect",l)),s||(s=this.onSessionDelete.bind(this),A.on("session_delete",s)))},async connect({...A}={}){var P,D,M;try{const z=ue.getCaipNetworks(),U=await this.getProvider();if(!U)throw new um;h||(h=this.onDisplayUri,U.on("display_uri",h));const G=await this.isChainsStale();U.session&&G&&await U.disconnect();const ne=ut.state.universalProviderConfigOverride;if(!U.session||G){const Ue=Uf.createNamespaces(z,ne);await U.connect({optionalNamespaces:Ue,..."pairingTopic"in A?{pairingTopic:A.pairingTopic}:{}}),this.setRequestedChainsIds(z.map(ze=>Number(ze.id)))}const oe=await this.getAccounts(),Q=await this.getChainId(),de=(M=(D=(P=U.session)==null?void 0:P.namespaces)==null?void 0:D.eip155)==null?void 0:M.chains,he=de==null?void 0:de.some(Ue=>Number(Ue.split(":")[1])===Q);let Ie=1;he?Ie=Q:de!=null&&de[0]&&(Ie=Number(de[0].split(":")[1])),h&&(U.removeListener("display_uri",h),h=void 0),l&&(U.removeListener("connect",l),l=void 0),i||(i=this.onAccountsChanged.bind(this),U.on("accountsChanged",i)),o||(o=this.onChainChanged.bind(this),U.on("chainChanged",o)),w||(w=this.onDisconnect.bind(this),U.on("disconnect",w)),s||(s=this.onSessionDelete.bind(this),U.on("session_delete",s));const ke=ne==null?void 0:ne.defaultChain;return U.setDefaultChain(ke??`eip155:${Ie}`),{accounts:oe,chainId:Ie}}catch(z){throw/(user rejected|connection request reset)/i.test(z==null?void 0:z.message)?new to(z):z}},async disconnect(){const A=await this.getProvider();try{await(A==null?void 0:A.disconnect())}catch(P){if(!/No matching key/i.test(P.message))throw P}finally{o&&(A==null||A.removeListener("chainChanged",o),o=void 0),w&&(A==null||A.removeListener("disconnect",w),w=void 0),l||(l=this.onConnect.bind(this),A==null||A.on("connect",l)),i&&(A==null||A.removeListener("accountsChanged",i),i=void 0),s&&(A==null||A.removeListener("session_delete",s),s=void 0),this.setRequestedChainsIds([])}},async getAccounts(){var U,G,ne;const A=await this.getProvider();if(!((U=A==null?void 0:A.session)!=null&&U.namespaces))return[];const P=(ne=(G=A==null?void 0:A.session)==null?void 0:G.namespaces[at.CHAIN.EVM])==null?void 0:ne.accounts,D=(P==null?void 0:P.map(oe=>oe.split(":")[2]))??[],M=new Set;return D.filter(oe=>{const Q=oe==null?void 0:oe.toLowerCase();return M.has(Q)?!1:(M.add(Q),!0)})},async getProvider({chainId:A}={}){var M,z;n||(n=t.universalProvider,n==null||n.events.setMaxListeners(Number.POSITIVE_INFINITY));const P=Jt.getActiveNamespace(),D=(M=ue.getActiveCaipNetwork())==null?void 0:M.id;if(A&&D!==A&&P){const U=Jt.getStoredActiveCaipNetworkId(),G=P?ue.getCaipNetworks(P):[],ne=G==null?void 0:G.find(oe=>oe.id===U);ne&&ne.chainNamespace===at.CHAIN.EVM&&await((z=this.switchChain)==null?void 0:z.call(this,{chainId:Number(ne.id)}))}return n},async getChainId(){var z,U,G,ne;const A=(z=ue.getActiveCaipNetwork(at.CHAIN.EVM))==null?void 0:z.id;if(A)return A;const D=(ne=(G=(U=(await this.getProvider()).session)==null?void 0:U.namespaces[at.CHAIN.EVM])==null?void 0:G.chains)==null?void 0:ne[0],M=ue.getCaipNetworks().find(oe=>oe.id===D);return M==null?void 0:M.id},async isAuthorized(){try{const[A,P]=await Promise.all([this.getAccounts(),this.getProvider()]);return A.length?await this.isChainsStale()&&P.session?(await P.disconnect().catch(()=>{}),!1):!0:!1}catch{return!1}},async switchChain({addEthereumChainParameter:A,chainId:P}){var z,U,G,ne;const D=await this.getProvider();if(!D)throw new um;const M=ue.getCaipNetworks().find(oe=>oe.id===P);if(!M)throw new Ah(new hE);try{await D.request({method:"wallet_switchEthereumChain",params:[{chainId:ar(P)}]}),M!=null&&M.caipNetworkId&&D.setDefaultChain(M==null?void 0:M.caipNetworkId),x.emitter.emit("change",{chainId:Number(P)});const oe=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...oe,P]),{...M,id:M.id}}catch(oe){const Q=oe;if(/(?:user rejected)/iu.test(Q.message))throw new to(Q);try{let de;A!=null&&A.blockExplorerUrls?de=A.blockExplorerUrls:de=(z=M.blockExplorers)!=null&&z.default.url?[(U=M.blockExplorers)==null?void 0:U.default.url]:[];const he=((ne=(G=M.rpcUrls)==null?void 0:G.chainDefault)==null?void 0:ne.http)||[],Ie={blockExplorerUrls:de,chainId:ar(P),chainName:M.name,iconUrls:A==null?void 0:A.iconUrls,nativeCurrency:M.nativeCurrency,rpcUrls:he};await D.request({method:"wallet_addEthereumChain",params:[Ie]});const ke=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...ke,P]),{...M,id:M.id}}catch(de){throw new to(de)}}},onAccountsChanged(A){A.length===0?this.onDisconnect():x.emitter.emit("change",{accounts:A.map(P=>E0(P))})},onChainChanged(A){const P=Number(A);x.emitter.emit("change",{chainId:P})},onConnect(A){this.setRequestedChainsIds(ue.getCaipNetworks().map(P=>Number(P.id)))},async onDisconnect(A){this.setRequestedChainsIds([]),x.emitter.emit("disconnect");const P=await this.getProvider();i&&(P.removeListener("accountsChanged",i),i=void 0),o&&(P.removeListener("chainChanged",o),o=void 0),w&&(P.removeListener("disconnect",w),w=void 0),s&&(P.removeListener("session_delete",s),s=void 0),l||(l=this.onConnect.bind(this),P.on("connect",l))},onDisplayUri(A){x.emitter.emit("message",{type:"display_uri",data:A})},onSessionDelete(){this.onDisconnect()},getNamespaceChainsIds(){var D,M,z;if(!((D=n==null?void 0:n.session)!=null&&D.namespaces))return[];const A=(z=(M=n==null?void 0:n.session)==null?void 0:M.namespaces[at.CHAIN.EVM])==null?void 0:z.accounts;return(A==null?void 0:A.map(U=>Number.parseInt(U.split(":")[1]??"")))??[]},async getRequestedChainsIds(){var P;const A=await((P=x.storage)==null?void 0:P.getItem(this.requestedChainsStorageKey))??[];return[...new Set(A)]},async isChainsStale(){if(!e)return!1;const A=x.chains.map(M=>M.id),P=this.getNamespaceChainsIds();if(P.length&&!P.some(M=>A.includes(M)))return!1;const D=await this.getRequestedChainsIds();return!A.every(M=>D.includes(Number(M)))},async setRequestedChainsIds(A){var P;await((P=x.storage)==null?void 0:P.setItem(this.requestedChainsStorageKey,A))},get requestedChainsStorageKey(){return`${this.id}.requestedChains`}})}const Px=Zr({pendingTransactions:0}),SV={state:Px,subscribeKey(t,e){return oo(Px,t,e)},increase(t){Px[t]+=1},decrease(t){Px[t]-=1},reset(t){Px[t]=0}};async function T9e(t){if(Ft.isSafeApp()){const{safe:e}=await Un(async()=>{const{safe:n}=await import("./index-BAfHE5_y.js");return{safe:n}},__vite__mapDeps([80,2,3,4,5]));if(e&&!t.some(n=>n.type==="safe"))return e()}return null}async function A9e(t){try{const{baseAccount:e}=await Un(async()=>{const{baseAccount:n}=await import("./index-BAfHE5_y.js");return{baseAccount:n}},__vite__mapDeps([80,2,3,4,5]));if(e&&!t.some(n=>n.id==="baseAccount"))return e()}catch(e){console.error("Failed to import Coinbase Wallet SDK:",e)}return null}const S9e={enable:!1,pollingInterval:3e4};class I9e extends VK{constructor(e){const n=hd.extendCaipNetworks(e.networks,{projectId:e.projectId,customNetworkImageUrls:{},customRpcUrls:e.customRpcUrls});super(),this.balancePromises={},this.namespace=at.CHAIN.EVM,this.adapterType=at.ADAPTER_TYPES.WAGMI,this.projectId=e.projectId,this.pendingTransactionsFilter={...S9e,...e.pendingTransactionsFilter??{}},this.createConfig({...e,networks:n}),this.checkChainId()}construct(e){this.checkChainId(),this.setupWatchers()}async getAccounts(e){const n=this.getWagmiConnector(e.id);if(!n)return{accounts:[]};if(n.id===at.CONNECTOR_ID.AUTH){const l=await n.getProvider();if(!(l!=null&&l.user))return{accounts:[]};const{address:h,accounts:s}=l.user;return Promise.resolve({accounts:(s||[{address:h,type:"eoa"}]).map(w=>Ft.createAccount("eip155",w.address,w.type))})}const{addresses:i,address:o}=t2(this.wagmiConfig);return Promise.resolve({accounts:[...new Set(i||[o])].map(l=>Ft.createAccount("eip155",l||"","eoa"))})}checkChainId(){const{chainId:e}=t2(this.wagmiConfig);e&&this.emit("switchNetwork",{chainId:e})}getWagmiConnector(e){return this.wagmiConfig.connectors.find(n=>n.id===e)}createConfig(e){this.wagmiChains=e.networks.filter(o=>o.chainNamespace===at.CHAIN.EVM);const n={},i=[...e.connectors??[]];this.wagmiChains.forEach(o=>{var s,w;const l=(s=e.transports)==null?void 0:s[o.id],h=hd.getCaipNetworkId(o);l?n[o.id]=hd.extendWagmiTransports(o,e.projectId,l):n[o.id]=hd.getViemTransport(o,e.projectId,(w=e.customRpcUrls)==null?void 0:w[h])}),this.wagmiConfig=w9e({...e,chains:this.wagmiChains,connectors:i,transports:n})}setupWatchPendingTransactions(){if(!this.pendingTransactionsFilter.enable||this.unwatchPendingTransactions)return;this.unwatchPendingTransactions=t9e(this.wagmiConfig,{pollingInterval:this.pendingTransactionsFilter.pollingInterval,onError:()=>{},onTransactions:()=>{this.emit("pendingTransactions"),SV.increase("pendingTransactions")}});const e=SV.subscribeKey("pendingTransactions",n=>{var i;n>=at.LIMITS.PENDING_TRANSACTIONS&&((i=this.unwatchPendingTransactions)==null||i.call(this),e())})}setupWatchers(){QMe(this.wagmiConfig,{onChange:e=>{this.clearConnections(),this.addConnection(...e.map(n=>{const i=this.getCaipNetworks().find(l=>l.id===n.chainId),o=n.connector.id===at.CONNECTOR_ID.AUTH;return{accounts:n.accounts.map(l=>({address:this.toChecksummedAddress(l)})),caipNetwork:i,connectorId:n.connector.id,auth:o?{name:Jt.getConnectedSocialProvider(),username:Jt.getConnectedSocialUsername()}:void 0}}))}}),JMe(this.wagmiConfig,{onChange:(e,n)=>{var i;if(e.status==="disconnected"&&n.address&&this.emit("disconnect"),e!=null&&e.chainId&&(e==null?void 0:e.chainId)!==(n==null?void 0:n.chainId)&&this.emit("switchNetwork",{chainId:e.chainId}),e.status==="connected"){const o=e.address!==(n==null?void 0:n.address),l=e.connector.id!==((i=n.connector)==null?void 0:i.id),h=n.status!=="connected";(o||l||h)&&(this.setupWatchPendingTransactions(),this.handleAccountChanged({address:e.address,chainId:e.chainId,connector:e.connector}))}}})}async addThirdPartyConnectors(){const e=[],{enableCoinbase:n}=ut.state||{};if(n!==!1){const o=await A9e(this.wagmiConfig.connectors);o&&e.push(o)}const i=await T9e(this.wagmiConfig.connectors);i&&e.push(i),await Promise.all(e.map(o=>{const l=this.configureInternalConnector(o);return this.addWagmiConnector(l)}))}addWagmiConnectors(){const e=[];ut.state.enableInjected!==!1&&e.push(PI({shimDisconnect:!0}));const{features:n,remoteFeatures:i,projectId:o,enableAuthLogger:l}=ut.state,h=(i==null?void 0:i.email)??(n==null?void 0:n.email)??!0,s=(i==null?void 0:i.socials)??(n==null?void 0:n.socials),w=Array.isArray(s)&&(s==null?void 0:s.length)>0;(h||w)&&e.push(C9e({chains:this.wagmiChains,options:{projectId:o,enableAuthLogger:l}})),e.forEach(x=>{this.configureInternalConnector(x)})}configureInternalConnector(e){const n=this.wagmiConfig._internal.connectors.setup(e);return this.wagmiConfig._internal.connectors.setState(i=>[...i,n]),n}async handleAccountChanged({address:e,chainId:n,connector:i}){if(!this.namespace)throw new Error("WagmiAdapter:handleAccountChanged - namespace is required");const o=await i.getProvider().catch(()=>{});this.emit("accountChanged",{address:this.toChecksummedAddress(e),chainId:n,connector:{id:i.id,name:Cc.ConnectorNamesMap[i.id]??i.name,imageId:Cc.ConnectorImageIds[i.id],type:Cc.ConnectorTypesMap[i.type]??"EXTERNAL",info:i.id===at.CONNECTOR_ID.INJECTED?void 0:{rdns:i.id},provider:o,chain:this.namespace,chains:[]}})}async writeSolanaTransaction(){return Promise.resolve({hash:""})}async signMessage(e){try{return{signature:await KMe(this.wagmiConfig,{message:e.message,account:e.address})}}catch{throw new Error("WagmiAdapter:signMessage - Sign message failed")}}async sendTransaction(e){var s;const{chainId:n,address:i}=t2(this.wagmiConfig),o=(s=this.wagmiChains)==null?void 0:s.find(w=>w.id===n),l={account:i,to:e.to,value:Number.isNaN(Number(e.value))?BigInt(0):BigInt(e.value),gas:e.gas?BigInt(e.gas):void 0,gasPrice:e.gasPrice?BigInt(e.gasPrice):void 0,data:e.data,chain:o,type:"legacy",parameters:["nonce"]};await qMe(this.wagmiConfig,l);const h=await ZMe(this.wagmiConfig,l);return await XMe(this.wagmiConfig,{hash:h,timeout:25e3}),{hash:h}}async writeContract(e){var s;const{caipNetwork:n,...i}=e,o=Number(i2.caipNetworkIdToNumber(n.caipNetworkId)),l=(s=this.wagmiChains)==null?void 0:s.find(w=>w.id===o);return{hash:await n9e(this.wagmiConfig,{chain:l,address:i.tokenAddress,account:i.fromAddress,abi:i.abi,functionName:i.method,args:i.args,__mode:"prepared"})}}async estimateGas(e){try{return{gas:await HMe(this.wagmiConfig,{account:e.address,to:e.to,data:e.data,type:"legacy"})}}catch{throw new Error("WagmiAdapter:estimateGas - error estimating gas")}}parseUnits(e){return Sfe(e.value,e.decimals)}formatUnits(e){return vE(e.value,e.decimals)}async addWagmiConnector(e){if(!this.namespace)throw new Error("WagmiAdapter:addWagmiConnector - namespace is required");const{enableEIP6963:n}=ut.state||{};if(e.type===at.CONNECTOR_ID.INJECTED&&n===!1||e.id===at.CONNECTOR_ID.AUTH||e.id===at.CONNECTOR_ID.WALLET_CONNECT)return;let i;e.id!==at.CONNECTOR_ID.BASE_ACCOUNT&&(i=await e.getProvider().catch(()=>{}));const o=_o.state.connectorImages;this.addConnector({id:e.id,explorerId:Cc.ConnectorExplorerIds[e.id]??Cc.ConnectorExplorerIds[e.name],imageUrl:(o==null?void 0:o[e.id])??e.icon,name:Cc.ConnectorNamesMap[e.id]??e.name,imageId:Cc.ConnectorImageIds[e.id],type:Cc.ConnectorTypesMap[e.type]??"EXTERNAL",info:e.id===at.CONNECTOR_ID.INJECTED?void 0:{rdns:e.id},provider:i,chain:this.namespace,chains:[]})}async syncConnectors(){e9e(this.wagmiConfig,{onChange:e=>{e.forEach(n=>this.addWagmiConnector(n))}}),this.addWagmiConnectors(),await Promise.all(this.wagmiConfig.connectors.map(e=>this.addWagmiConnector(e))),await this.addThirdPartyConnectors()}async syncConnections(){const e=this.connectors.filter(n=>{const{hasDisconnected:i,hasConnected:o}=no.getConnectorStorageInfo(n.id,this.namespace);return!i&&o}).map(n=>this.getWagmiConnector(n.id)).filter(Boolean);await eA(this.wagmiConfig,{connectors:e})}async syncConnection(e){var x,A;const{id:n,chainId:i}=e,l=Sf(this.wagmiConfig).find(P=>P.connector.id===n),h=this.getWagmiConnector(n),s=await(h==null?void 0:h.getProvider());if(Ft.isSafeApp()&&n===at.CONNECTOR_ID.SAFE&&!(l!=null&&l.accounts.length)){const P=this.getWagmiConnector("safe");if(P){const D=await BR(this.wagmiConfig,{connector:P,chainId:Number(i)}),M=await P.getProvider();return{chainId:Number(i),address:this.toChecksummedAddress(D.accounts[0]),provider:M,type:(x=l==null?void 0:l.connector.type)==null?void 0:x.toUpperCase(),id:l==null?void 0:l.connector.id}}}return{chainId:Number(l==null?void 0:l.chainId),address:this.toChecksummedAddress(l==null?void 0:l.accounts[0]),provider:s,type:(A=l==null?void 0:l.connector.type)==null?void 0:A.toUpperCase(),id:l==null?void 0:l.connector.id}}async connectWalletConnect(e){try{const n=this.getWalletConnectConnector();await n.authenticate();const i=this.getWagmiConnector("walletConnect");if(!i)throw new Error("UniversalAdapter:connectWalletConnect - connector not found");const o=await BR(this.wagmiConfig,{connector:i,chainId:e?Number(e):void 0});return o.chainId!==Number(e)&&await EV(this.wagmiConfig,{chainId:o.chainId}),{clientId:await n.provider.client.core.crypto.getClientId()}}catch(n){throw n instanceof to?new T1(n):nl.isUserRejectedRequestError(n)?new T1(n):n}}async connect(e){var n,i,o,l,h;try{const{id:s,address:w,provider:x,type:A,info:P,chainId:D,socialUri:M}=e,z=this.getWagmiConnector(s);if(!z)throw new Error("connectionControllerClient:connectExternal - connector is undefined");x&&P&&z.id===at.CONNECTOR_ID.EIP6963&&((n=z.setEip6963Wallet)==null||n.call(z,{provider:x,info:P}));const U=(o=(i=this.wagmiConfig.state)==null?void 0:i.connections)==null?void 0:o.get(z.uid);if(U){await((l=this.wagmiConfig.storage)==null?void 0:l.setItem("recentConnectorId",z.id));const oe=[...U.accounts].sort((Q,de)=>no.isLowerCaseMatch(Q,w)?-1:no.isLowerCaseMatch(de,w)?1:0);return(h=this.wagmiConfig)==null||h.setState(Q=>({...Q,connections:new Map(Q.connections).set(z.uid,{accounts:oe,chainId:U.chainId,connector:U.connector}),current:z.uid,status:"connected"})),{address:this.toChecksummedAddress(oe[0]),chainId:U.chainId,provider:x,type:A,id:s}}const G=await BR(this.wagmiConfig,{connector:z,chainId:D?Number(D):void 0,socialUri:M}),ne=x??await z.getProvider();return{address:this.toChecksummedAddress(G.accounts[0]),chainId:G.chainId,provider:ne,type:A,id:s}}catch(s){throw s instanceof to?new T1(s):nl.isUserRejectedRequestError(s)?new T1(s):s}}get connections(){return Array.from(this.wagmiConfig.state.connections.values()).map(e=>({accounts:e.accounts.map(n=>({address:this.toChecksummedAddress(n)})),connectorId:e.connector.id}))}async reconnect(e){const{id:n}=e,i=this.getWagmiConnector(n);if(!i)throw new Error("connectionControllerClient:connectExternal - connector is undefined");await eA(this.wagmiConfig,{connectors:[i]})}async getBalance(e){const n=e.address,i=this.getCaipNetworks().find(o=>o.id===e.chainId);if(!n)return Promise.resolve({balance:"0.00",symbol:"ETH"});if(i&&this.wagmiConfig){const o=`${i.caipNetworkId}:${e.address}`,l=this.balancePromises[o];if(l)return l;const h=Jt.getNativeBalanceCacheForCaipAddress(o);return h?{balance:h.balance,symbol:h.symbol}:(this.balancePromises[o]=new Promise(async s=>{var w,x;try{const A=Number(e.chainId),P=await GMe(this.wagmiConfig,{address:e.address,chainId:A,token:(x=(w=e.tokens)==null?void 0:w[i.caipNetworkId])==null?void 0:x.address});Jt.updateNativeBalanceCache({caipAddress:o,balance:P.formatted,symbol:P.symbol,timestamp:Date.now()}),s({balance:P.formatted,symbol:P.symbol})}catch(A){console.warn("Appkit:WagmiAdapter:getBalance - Error getting balance",A),s({balance:"0.00",symbol:"ETH"})}}).finally(()=>{delete this.balancePromises[o]}),this.balancePromises[o]||{balance:"0.00",symbol:"ETH"})}return{balance:"",symbol:""}}getWalletConnectProvider(){var e;return(e=this.getWagmiConnector("walletConnect"))==null?void 0:e.provider}async disconnect(e){if(e.id){const n=this.getWagmiConnector(e.id),o=Sf(this.wagmiConfig).find(l=>no.isLowerCaseMatch(l.connector.id,e.id));return await xV(this.wagmiConfig,{connector:n}),ut.state.enableReconnect===!1&&this.deleteConnection(e.id),o?{connections:[{accounts:o.accounts.map(l=>({address:this.toChecksummedAddress(l)})),connectorId:o.connector.id}]}:{connections:[]}}return this.disconnectAll()}async disconnectAll(){const e=Sf(this.wagmiConfig),n=await Promise.allSettled(e.map(async i=>{const o=this.getWagmiConnector(i.connector.id);return o&&await xV(this.wagmiConfig,{connector:o}),i}));return this.wagmiConfig.state.connections.clear(),{connections:n.filter(i=>i.status==="fulfilled").map(({value:i})=>({accounts:i.accounts.map(o=>({address:this.toChecksummedAddress(o)})),connectorId:i.connector.id}))}}async switchNetwork(e){var M,z,U,G,ne;const{caipNetwork:n}=e,i=this.wagmiConfig.chains.find(oe=>oe.id.toString()===n.id.toString());if(!i)throw new Error("connectionControllerClient:switchNetwork - wagmiChain is undefined");const{name:o,nativeCurrency:l,rpcUrls:h,blockExplorers:s,id:w}=i,x=((U=(z=(M=n.rpcUrls)==null?void 0:M.chainDefault)==null?void 0:z.http)==null?void 0:U[0])??h.default.http[0]??"",A=(s==null?void 0:s.default.url)??((ne=(G=n.blockExplorers)==null?void 0:G.default)==null?void 0:ne.url)??"",P=l??n.nativeCurrency,D=o??n.name;await EV(this.wagmiConfig,{chainId:w,addEthereumChainParameter:{chainName:D,nativeCurrency:P,rpcUrls:[x],blockExplorerUrls:[A]}}),await super.switchNetwork(e)}async getCapabilities(e){if(!this.wagmiConfig)throw new Error("connectionControllerClient:getCapabilities - wagmiConfig is undefined");const i=Sf(this.wagmiConfig)[0],o=i?this.getWagmiConnector(i.connector.id):null;if(!o)throw new Error("connectionControllerClient:getCapabilities - connector is undefined");const l=await o.getProvider();if(!l)throw new Error("connectionControllerClient:getCapabilities - provider is undefined");return await l.request({method:"wallet_getCapabilities",params:[e]})}async grantPermissions(e){if(!this.wagmiConfig)throw new Error("connectionControllerClient:grantPermissions - wagmiConfig is undefined");const i=Sf(this.wagmiConfig)[0],o=i?this.getWagmiConnector(i.connector.id):null;if(!o)throw new Error("connectionControllerClient:grantPermissions - connector is undefined");const l=await o.getProvider();if(!l)throw new Error("connectionControllerClient:grantPermissions - provider is undefined");return l.request({method:"wallet_grantPermissions",params:e})}async revokePermissions(e){if(!this.wagmiConfig)throw new Error("connectionControllerClient:revokePermissions - wagmiConfig is undefined");const i=Sf(this.wagmiConfig)[0],o=i?this.getWagmiConnector(i.connector.id):null;if(!o)throw new Error("connectionControllerClient:revokePermissions - connector is undefined");const l=await o.getProvider();if(!l)throw new Error("connectionControllerClient:revokePermissions - provider is undefined");return l.request({method:"wallet_revokePermissions",params:e})}async walletGetAssets(e){if(!this.wagmiConfig)throw new Error("connectionControllerClient:walletGetAssets - wagmiConfig is undefined");const i=Sf(this.wagmiConfig)[0],o=i?this.getWagmiConnector(i.connector.id):null;if(!o)throw new Error("connectionControllerClient:walletGetAssets - connector is undefined");const l=await o.getProvider();if(!l)throw new Error("connectionControllerClient:walletGetAssets - provider is undefined");return l.request({method:"wallet_getAssets",params:[e]})}setAuthProvider(e){if(!this.namespace)throw new Error("WagmiAdapter:setAuthProvider - namespace is required");this.addConnector({id:at.CONNECTOR_ID.AUTH,type:"AUTH",name:at.CONNECTOR_NAMES.AUTH,provider:e,imageId:Cc.ConnectorImageIds[at.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}async setUniversalProvider(e){e.on("connect",()=>{const i=Sf(this.wagmiConfig),o=this.getWagmiConnector("walletConnect");if(o&&!i.find(l=>l.connector.id===o.id)){if(ue.state.activeChain==="eip155")return;eA(this.wagmiConfig,{connectors:[o]})}});const n=VN({universalProvider:e});return this.configureInternalConnector(n),this.addConnector(new WK({provider:e,caipNetworks:this.getCaipNetworks(),namespace:"eip155"})),Promise.resolve()}toChecksummedAddress(e){return bE(e.toLowerCase())}}function og(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}og({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"});og({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});og({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});og({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});og({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});og({id:"00000008819873e925422c1ff0f99f7c",caipNetworkId:"bip122:00000008819873e925422c1ff0f99f7c",chainNamespace:"bip122",name:"Bitcoin Signet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});og({id:"-239",name:"TON",network:"ton-mainnet",nativeCurrency:{name:"TON",symbol:"TON",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Tonscan",url:"https://tonscan.org"}},testnet:!1,chainNamespace:"ton",caipNetworkId:"ton:-239"});og({id:"-3",name:"TON Testnet",network:"ton-testnet",nativeCurrency:{name:"TON",symbol:"TON",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Tonscan",url:"https://testnet.tonscan.org"}},testnet:!0,chainNamespace:"ton",caipNetworkId:"ton:-3"});function P9e(t){const{children:e,config:n,initialState:i,reconnectOnMount:o=!0}=t,{onMount:l}=b9e(n,{initialState:i,reconnectOnMount:o});n._internal.ssr||l();const h=qt.useRef(!0);return qt.useEffect(()=>{if(h.current&&n._internal.ssr)return l(),()=>{h.current=!1}},[]),e}const R9e=qt.createContext(void 0);function O9e(t){const{children:e,config:n}=t,i={value:n};return qt.createElement(P9e,t,qt.createElement(R9e.Provider,i,e))}const kJ="b5ca09c8577900b9982fd8c18742880c",k9e={name:"Neoverse Presale",description:"Neoverse Land Presale Portal",url:window.location.origin,icons:["https://avatars.githubusercontent.com/u/37784886"]},DJ=[x9e,E9e,v9e],NJ=new I9e({networks:DJ,projectId:kJ,ssr:!1});B8e({adapters:[NJ],networks:DJ,projectId:kJ,metadata:k9e,features:{analytics:!0},themeMode:"dark",themeVariables:{"--w3m-accent":"#B6FE05","--w3m-border-radius-master":"12px"}});const D9e=new Xne;function N9e({children:t}){return ot.jsx(O9e,{config:NJ.wagmiConfig,children:ot.jsx(Jne,{client:D9e,children:t})})}const M9e=()=>ot.jsx(N9e,{children:ot.jsxs(Oie,{children:[ot.jsx(Rie,{}),ot.jsx(bre,{position:"top-right"}),ot.jsx(Kne,{children:ot.jsxs(Yne,{children:[ot.jsx(F4,{path:"/",element:ot.jsx(vre,{})}),ot.jsx(F4,{path:"/map",element:ot.jsx(BMe,{})}),ot.jsx(F4,{path:"*",element:ot.jsx(FMe,{})})]})})]})});let L9e=null;async function B9e(){try{console.log(" DEBUG: Starting to load runtime config...");const t=await fetch("/api/config");if(t.ok){const e=t.headers.get("content-type");e&&e.includes("application/json")?(L9e=await t.json(),console.log("Runtime config loaded successfully")):console.log("Config endpoint returned non-JSON response, skipping runtime config")}else console.log(" DEBUG: Config fetch failed with status:",t.status)}catch(t){console.log("Failed to load runtime config, using defaults:",t)}finally{console.log(" DEBUG: Config loading finished, configLoading set to false")}}async function F9e(){try{await B9e(),console.log("Runtime configuration loaded successfully")}catch(t){console.warn("Failed to load runtime configuration, using defaults:",t)}kV(document.getElementById("root")).render(ot.jsx(M9e,{}))}F9e();export{Ur as $,Ts as A,Ci as B,Ht as C,Ah as D,Sn as E,hE as F,ar as G,to as H,nG as I,PI as J,ln as K,EE as L,Ul as M,Q1 as N,Vue as O,um as P,Wde as Q,Pt as R,Ji as S,KH as T,us as U,Bm as V,Gr as W,XW as X,Fx as Y,Dm as Z,Un as _,nn as a,Ru as a$,ra as a0,Tn as a1,Lt as a2,mA as a3,Lk as a4,km as a5,aLe as a6,BS as a7,Bk as a8,sLe as a9,gW as aA,F0 as aB,ET as aC,Jt as aD,vs as aE,r2 as aF,Ro as aG,Xi as aH,Gx as aI,Z1 as aJ,lse as aK,T8 as aL,_o as aM,Fk as aN,jA as aO,Sh as aP,nl as aQ,Xa as aR,p7e as aS,xG as aT,Qr as aU,cse as aV,No as aW,IE as aX,no as aY,E$e as aZ,qD as a_,rLe as aa,LS as ab,pA as ac,ble as ad,Tle as ae,a$e as af,kue as ag,Ll as ah,kS as ai,kc as aj,Mo as ak,_E as al,bue as am,Th as an,Y0 as ao,CLe as ap,cLe as aq,K0 as ar,ko as as,ut as at,ei as au,ri as av,gi as aw,Ya as ax,fn as ay,TIe as az,we as b,OLe as b$,Qce as b0,dle as b1,CW as b2,Q9e as b3,dd as b4,q0 as b5,J9e as b6,tLe as b7,oLe as b8,kk as b9,wue as bA,qH as bB,CA as bC,tde as bD,FW as bE,Rhe as bF,d$e as bG,c$e as bH,u$e as bI,l$e as bJ,TE as bK,CE as bL,$S as bM,Ohe as bN,yle as bO,kw as bP,BW as bQ,ELe as bR,lLe as bS,w$e as bT,vde as bU,gA as bV,yA as bW,$de as bX,OFe as bY,Bde as bZ,kFe as b_,DS as ba,Pue as bb,is as bc,SH as bd,Tu as be,ade as bf,IH as bg,Gde as bh,PH as bi,vA as bj,XH as bk,Vhe as bl,jhe as bm,rw as bn,Whe as bo,n$ as bp,NF as bq,xle as br,R2 as bs,L2 as bt,JH as bu,Z0 as bv,TH as bw,qhe as bx,Nm as by,L0 as bz,Fn as c,cw as c$,jde as c0,jk as c1,yH as c2,Lde as c3,_H as c4,Ude as c5,ILe as c6,lH as c7,wE as c8,Cde as c9,a$ as cA,ax as cB,i$e as cC,XFe as cD,yG as cE,_he as cF,bd as cG,_G as cH,bA as cI,She as cJ,Ik as cK,oH as cL,Ehe as cM,uH as cN,pH as cO,Vk as cP,FS as cQ,Ace as cR,The as cS,hde as cT,h$e as cU,f$e as cV,GH as cW,_$e as cX,Que as cY,Ole as cZ,ede as c_,GW as ca,NFe as cb,lw as cc,Dde as cd,QFe as ce,uw as cf,HFe as cg,Rf as ch,FH as ci,Dc as cj,BH as ck,UFe as cl,YFe as cm,GFe as cn,MFe as co,$Fe as cp,LFe as cq,FFe as cr,BFe as cs,zFe as ct,dhe as cu,zH as cv,qFe as cw,whe as cx,UH as cy,ZFe as cz,JE as d,m8 as d$,QH as d0,kLe as d1,Rfe as d2,Ife as d3,Pfe as d4,Ghe as d5,qk as d6,uP as d7,Vde as d8,SFe as d9,Hue as dA,bE as dB,Hhe as dC,AH as dD,nP as dE,Ofe as dF,Mfe as dG,eD as dH,Uk as dI,ple as dJ,DF as dK,Mde as dL,Jk as dM,Y5 as dN,iLe as dO,kW as dP,mle as dQ,gle as dR,DW as dS,_le as dT,wle as dU,Gue as dV,M2 as dW,dH as dX,hH as dY,N2 as dZ,P2 as d_,mH as da,IFe as db,Gk as dc,Khe as dd,Zhe as de,tG as df,Xk as dg,eLe as dh,EA as di,pLe as dj,$k as dk,MS as dl,wH as dm,_Le as dn,Lm as dp,ZH as dq,ZF as dr,d$ as ds,NLe as dt,DLe as du,PLe as dv,RLe as dw,Cm as dx,Sfe as dy,Wue as dz,Kr as e,S2 as e$,Ihe as e0,Phe as e1,Yce as e2,HH as e3,nde as e4,ide as e5,k2 as e6,Wk as e7,gde as e8,T0 as e9,x2 as eA,C0 as eB,c8 as eC,o8 as eD,a8 as eE,b2 as eF,I2 as eG,fl as eH,C2 as eI,Tm as eJ,hl as eK,MW as eL,Rle as eM,NW as eN,Wce as eO,que as eP,Yue as eQ,rH as eR,sH as eS,sw as eT,h8 as eU,A2 as eV,D2 as eW,sde as eX,Zce as eY,Uce as eZ,O2 as e_,s8 as ea,SLe as eb,l8 as ec,Pk as ed,X0 as ee,u8 as ef,d8 as eg,Cle as eh,Ele as ei,qce as ej,Ile as ek,Afe as el,Ale as em,Gce as en,Ple as eo,Hce as ep,Vce as eq,E2 as er,Xce as es,v2 as et,Kue as eu,Ow as ev,Kce as ew,T2 as ex,ow as ey,xde as ez,QE as f,aFe as f$,Xue as f0,Mle as f1,eH as f2,tH as f3,_h as f4,MLe as f5,nH as f6,_ue as f7,kfe as f8,AFe as f9,nBe as fA,$Le as fB,iBe as fC,rBe as fD,sBe as fE,oBe as fF,aBe as fG,cBe as fH,lBe as fI,uBe as fJ,dBe as fK,hBe as fL,zLe as fM,fBe as fN,pBe as fO,mBe as fP,ULe as fQ,jLe as fR,VLe as fS,WLe as fT,HLe as fU,GLe as fV,FLe as fW,qLe as fX,ZLe as fY,KLe as fZ,oFe as f_,TFe as fa,b$e as fb,BLe as fc,Ahe as fd,m$e as fe,G5 as ff,p$e as fg,y$e as fh,g$e as fi,x$e as fj,_$ as fk,zk as fl,sl as fm,US as fn,vE as fo,TLe as fp,yLe as fq,gue as fr,LLe as fs,LW as ft,YLe as fu,XLe as fv,JLe as fw,QLe as fx,eBe as fy,tBe as fz,rs as g,PW as g$,cFe as g0,lFe as g1,uFe as g2,dFe as g3,hFe as g4,KBe as g5,fFe as g6,pFe as g7,mFe as g8,gFe as g9,yBe as gA,MBe as gB,LBe as gC,BBe as gD,FBe as gE,$Be as gF,zBe as gG,UBe as gH,jBe as gI,VBe as gJ,WBe as gK,_Be as gL,HBe as gM,GBe as gN,qBe as gO,wBe as gP,bBe as gQ,vBe as gR,xBe as gS,EBe as gT,CBe as gU,gBe as gV,TBe as gW,ABe as gX,SBe as gY,Lle as gZ,Sle as g_,yFe as ga,_Fe as gb,wFe as gc,bFe as gd,vFe as ge,xFe as gf,YBe as gg,EFe as gh,CFe as gi,XBe as gj,JBe as gk,QBe as gl,eFe as gm,tFe as gn,nFe as go,ZBe as gp,iFe as gq,rFe as gr,sFe as gs,IBe as gt,PBe as gu,RBe as gv,OBe as gw,kBe as gx,DBe as gy,NBe as gz,at as h,Rue as h0,dde as h1,v$e as h2,_de as h3,nLe as h4,Nde as h5,Dfe as h6,YW as h7,zde as h8,qW as h9,i2 as hA,Nf as hB,fH as ha,ALe as hb,zhe as hc,vfe as hd,Qk as he,xH as hf,RFe as hg,PFe as hh,DFe as hi,jH as hj,JFe as hk,KFe as hl,v9e as hm,x9e as hn,E9e as ho,l1e as hp,xE as hq,wLe as hr,Zle as hs,bLe as ht,Mm as hu,nue as hv,_2 as hw,Kle as hx,iue as hy,rG as hz,on as i,Fs as j,ue as k,Ft as l,rpe as m,Fe as n,tD as o,hi as p,TA as q,Ei as r,Nt as s,oo as t,so as u,Ss as v,Hl as w,Zr as x,TUe as y,E0 as z};
